
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Outdoor Coverage Knife-Edge Model &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../index.html" />
    <link rel="up" title="1   Overview" href="../TOC.html" />
    <link rel="next" title="Slabs and Materials" href="../2-AP/SlabsMaterials.html" />
    <link rel="prev" title="Geographical Information and the Earth Zone class : Ezone" href="Ezone.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../index.html">
            <img src="../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../download.html">Download</a></li>
            <li><a href="../TOC.html">User Guide</a></li>
            <li><a href="../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	  <div class="rel">
	   
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="Ezone.html" title="Geographical Information and the Earth Zone class : Ezone"
	    accesskey="P">Previous
	    <br>
	    <span class="smallrellink">
	    Geographical ...
	    </span>
	    <span class="hiddenrellink">
	    Geographical Information and the Earth Zone class : Ezone
	    </span>
	    
	    </a>
	</div>
	    <div class="spacer">
	    &nbsp;
	    </div>
	
	<div class="rellink">
	<a href="../2-AP/SlabsMaterials.html" title="Slabs and Materials"
	    accesskey="N">Next
	    <br>
	    <span class="smallrellink">
	    Slabs and Materials
	    </span>
	    <span class="hiddenrellink">
	    Slabs and Materials
	    </span>
	    
	    </a>
	</div>
	    <div class="spacer">
	    &nbsp;
	    </div>
	
	<div class="rellink">
	<a href="../../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module Index
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
	<div class="spacer">
	&nbsp;
	</div>
	<div class="rellink">
	<a href="../TOC.html" title="1   Overview" >
	Up
	<br>
	<span class="smallrellink">
	1   Overview
	</span>
	<span class="hiddenrellink">
	1   Overview
	</span>
	
	</a>
	</div>
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	<ul>
<li><a class="reference internal" href="#">Outdoor Coverage Knife-Edge Model</a></li>
</ul>

    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="code highlight-none"><div class="highlight"><pre><span></span>!date
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>samedi 4 novembre 2017, 22:47:17 (UTC+0100)
</pre></div>
</div>
<div class="section" id="outdoor-coverage-knife-edge-model">
<h1>Outdoor Coverage Knife-Edge Model<a class="headerlink" href="#outdoor-coverage-knife-edge-model" title="Permalink to this headline">¶</a></h1>
<div class="code highlight-none"><div class="highlight"><pre><span></span>from pylayers.gis.ezone import *
import matplotlib.tri as tri
%matplotlib inline
</pre></div>
</div>
<p>We load a earth zone from its name in srtm file convention</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>z = Ezone(&#39;N48W002&#39;)
z.loadh5()
z.rebase()
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span># x,y,r,R,dem,LOS,h_earth,diff,fac,nu,numax,LFS,Ltot= z.cov(pc=(11000,45000),Ht=2,Hr=2,Rmax=10000)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>pc=(11000,45000)
Rmax = 10000
fGHz=0.3
Ht = 2
Hr =2
K = 4/3.
Nphi = 45
Nr = 50
</pre></div>
</div>
<p>Then the coverage zone is defined</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>lmbda = 0.3/fGHz
phi  = np.linspace(0,2*np.pi,Nphi)[:,None]
r  = np.linspace(0,Rmax,Nr)[None,:]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span> # cartesian
x  = pc[0] + r*np.cos(phi)
y  = pc[1] + r*np.sin(phi)
extent_c = np.array([x.min(),x.max(),y.min(),y.max()])
lon,lat = z.m(x,y,inverse=True)
# Triangulation
triang = tri.Triangulation(x.flatten(),y.flatten())
# back in lon,lat coordinates
triang.x = x
triang.y = y
rx = np.round((lon - z.extent[0]) / z.lonstep).astype(int)
ry = np.round((z.extent[3]-lat) / z.latstep).astype(int)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>x.max()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>21000.0
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>x.min()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>1000.0
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span> # dem
dem = z.hgts[ry,rx]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>dem.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>X=expand(x)
Y=expand(y)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>X0=expand(pc[0]*np.ones((Nphi,Nr)))
Y0=expand(pc[1]*np.ones((Nphi,Nr)))
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>R=np.sqrt((X0-X)**2+(Y0-Y)**2)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>R.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.plot(R[0,8,:],&#39;or&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12d07c5790&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_18_1.png" src="../../_images/Coverage_18_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>r
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>array([[     0.        ,    204.08163265,    408.16326531,    612.24489796,
           816.32653061,   1020.40816327,   1224.48979592,   1428.57142857,
          1632.65306122,   1836.73469388,   2040.81632653,   2244.89795918,
          2448.97959184,   2653.06122449,   2857.14285714,   3061.2244898 ,
          3265.30612245,   3469.3877551 ,   3673.46938776,   3877.55102041,
          4081.63265306,   4285.71428571,   4489.79591837,   4693.87755102,
          4897.95918367,   5102.04081633,   5306.12244898,   5510.20408163,
          5714.28571429,   5918.36734694,   6122.44897959,   6326.53061224,
          6530.6122449 ,   6734.69387755,   6938.7755102 ,   7142.85714286,
          7346.93877551,   7551.02040816,   7755.10204082,   7959.18367347,
          8163.26530612,   8367.34693878,   8571.42857143,   8775.51020408,
          8979.59183673,   9183.67346939,   9387.75510204,   9591.83673469,
          9795.91836735,  10000.        ]])
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>B=r.T[None,1:]-R
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(B[0,:,:],cmap=plt.cm.jet,vmax=10000)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d3d8af10&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_21_1.png" src="../../_images/Coverage_21_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>h_earth=(R*B)/(2*K*6375e3)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(h_earth[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d04f7510&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_23_1.png" src="../../_images/Coverage_23_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span># ground height + antenna height
Ha = expand((Ht + z.hgts[ry[0,0],rx[0,0]])*np.ones((Nphi,Nr)))
Hb = expand(Hr + dem)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span># LOS line
LOS  = Ha+(Hb-Ha)*R/r.T[None,1:]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>LOS.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(LOS[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d0350510&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_27_1.png" src="../../_images/Coverage_27_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>diff = expand(dem)+h_earth-LOS
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(diff[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d0229b10&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_29_1.png" src="../../_images/Coverage_29_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>fac  = np.sqrt(2*r.T[None,1:]/(lmbda*R*B))
nu   = diff*fac
#num,ind  = maxloc(nu)
numax = np.nanmax(nu,axis=2)
u = np.where(numax&gt;-0.7)
w = numax -0.1
L = np.zeros(w.shape)
L[u] = 6.9 + 20*np.log10(np.sqrt(w[u]**2+1)-w[u])
LFS = 32.4 + 20*np.log10(r[0,1:])+20*np.log10(fGHz)
Ltot = LFS+L
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: divide by zero encountered in divide
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:1: RuntimeWarning: invalid value encountered in sqrt
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:2: RuntimeWarning: invalid value encountered in multiply
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>numax
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>array([[       -inf, -0.48965701, -0.28230755, ...,  0.24972005,
         0.25062671,  0.25151559],
       [       -inf, -0.41965701, -0.32272207, ...,  0.24151194,
         0.24269898,  0.24386059],
       [       -inf, -0.41965701, -0.20147851, ...,  0.35027767,
         0.35234104,  0.35434705],
       ...,
       [       -inf, -0.48965701, -0.12064947, ...,  0.55829095,
         0.56043653,  0.56251895],
       [       -inf, -0.48965701, -0.28230755, ...,  0.27134908,
         0.27288219,  0.27437836],
       [       -inf, -0.48965701, -0.28230755, ...,  0.24972005,
         0.25062671,  0.25151559]])
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>Ltot.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>LOS.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.figure(figsize=(15,8))
plt.imshow(dem,cmap=plt.cm.jet)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f12d016aad0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_34_1.png" src="../../_images/Coverage_34_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.figure(figsize=(15,8))
plt.imshow(Ltot,cmap=plt.cm.jet)
plt.colorbar()
plt.axis(&#39;auto&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(-10.0, 50.0, 50.0, -10.0)
</pre></div>
</div>
<img alt="../../_images/Coverage_35_1.png" src="../../_images/Coverage_35_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>u=np.argmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(nu[0,:,:],vmin=-0.3,vmax=0.3,cmap=plt.cm.BrBG)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12d048f650&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_37_1.png" src="../../_images/Coverage_37_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>#plt.plot(h_earth[0,30,:])
#plt.plot(LOS[0,30,:])
#plt.plot(diff[0,30,:])
#plt.plot(dem[0,:])
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>#plt.plot(nu[0,30,:])
#plt.ylim(0,1)
#plt.plot(8,nu[0,30,8],&#39;or&#39;)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>nu.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>numax2=np.nanmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>numax2.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(numax2,cmap=plt.cm.jet,vmin=-1.4)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce6d6c50&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_43_1.png" src="../../_images/Coverage_43_1.png" />
<p>imax indique le point d&#8217;engagement maximum</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>imax=np.nanargmax(nu,axis=2)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>imax
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>array([[ 0,  1,  2, ...,  4,  4,  4],
       [ 0,  1,  2, ...,  6,  6,  6],
       [ 0,  1,  2, ..., 10, 10, 10],
       ...,
       [ 0,  1,  2, ...,  8,  8,  8],
       [ 0,  1,  2, ...,  8,  8,  8],
       [ 0,  1,  2, ...,  4,  4,  4]])
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(imax,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce5a34d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_47_1.png" src="../../_images/Coverage_47_1.png" />
<p>Recherche des coordonn??es du point diffractant pour toutes les
directions et pour tous les ranges.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>imax.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>iphi = np.arange(Nphi)[:,None]
it = np.arange(0,Nr-1)[None,:]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(imax,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce47cc50&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_51_1.png" src="../../_images/Coverage_51_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>for k in range(2,Nphi-1):
    for l in range(1,Nr-1):
        if imax[k,l]!=0:
            t1 = np.arange(0,1,imax[k,l])
            t2 = np.arange(1,0,Nr-imax[k,l])
            t = np.hstack((t1,t2))
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>XM = x[iphi,imax[iphi,it]]
YM = y[iphi,imax[iphi,it]]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>XM.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(XM,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce2e8150&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_55_1.png" src="../../_images/Coverage_55_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(YM,cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12ce1bd990&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_56_1.png" src="../../_images/Coverage_56_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.figure(figsize=(20,20))
ik = 3
#plt.tripcolor(triang,dem.flatten())
f,a,d=z.show(coord=&#39;cartesian&#39;,extent=extent_c)
a.plot(XM[:,ik],YM[:,ik],&#39;.r&#39;)
a.plot(x[:,ik],y[:,ik],&#39;.b&#39;)
#plt.axis(&#39;equal&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12ce0799d0&gt;]
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.figure.Figure at 0x7f12ce6540d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_57_2.png" src="../../_images/Coverage_57_2.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>RF=np.sqrt((XM[...,None]-x[:,None,:])**2+(YM[...,None]-y[:,None,:])**2)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(RF[0,:,:],cmap=plt.cm.jet)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f12cdec30d0&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_59_1.png" src="../../_images/Coverage_59_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.plot(x[0,:],y[0,:])
plt.plot(XM[0,:],YM[0,:],&#39;or&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12cde5cf50&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_60_1.png" src="../../_images/Coverage_60_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>RF.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(45, 49, 50)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>P=RF[:,0:-1,:]-RF[:,1:,:]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
@jit
def splitMDA(imax):
    Nphi,Nl = imax.shape
    N = Nphi*Nl*(Nl+1)
    Ntot = imax.sum()
    u = np.empty((3,Ntot),dtype=int)
    #u1 = np.empty(Ntot)
    #u2 = np.empty(Ntot)
    v = np.empty((3,N-Ntot),dtype=int)
    #v1 = np.empty(N-Ntot)
    #v2 = np.empty(N-Ntot)
    indu = 0
    indv = 0
    for ip in range(Nphi):
        for il in range(Nl):
            for k in range(Nr):
                if k&lt;imax[ip,il]:
                    u[0,indu] = ip
                    u[1,indu] = il
                    u[2,indu] = k
                    indu = indu+1
                else:
                    v[0,indv] = ip
                    v[1,indv] = il
                    v[2,indv] = k
                    indv = indv+1
    #return (u0,u1,u2),(v0,v1,v2)
    return u,v

tic = time.time()
u,v = splitMDA(imax)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>0.395106077194
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.plot(RF[0,4,:])
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12c57eb950&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_64_1.png" src="../../_images/Coverage_64_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>UL=np.zeros(RF.shape)
UR=np.zeros(RF.shape)
UL[(u[0,:],u[1,:],u[2,:])]=RF[(u[0,:],u[1,:],u[2,:])]
UR[(v[0,:],v[1,:],v[2,:])]=RF[(v[0,:],v[1,:],v[2,:])]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.plot(UL[0,4,:])
plt.plot(UR[0,4,:],&#39;r&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f12cde65490&gt;]
</pre></div>
</div>
<img alt="../../_images/Coverage_66_1.png" src="../../_images/Coverage_66_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
@jit
def splitMDA(imax):
    Nphi,Nl = imax.shape
    N = Nphi*Nl*(Nl+1)
    Ntot = imax.sum()
    u = np.empty((3,Ntot),dtype=int)
    #u1 = np.empty(Ntot)
    #u2 = np.empty(Ntot)
    v = np.empty((3,N-Ntot),dtype=int)
    #v1 = np.empty(N-Ntot)
    #v2 = np.empty(N-Ntot)
    indu = 0
    indv = 0
    for ip in range(Nphi):
        for il in range(Nl):
            for k in range(Nr):
                if k&lt;imax[ip,il]:
                    u[0,indu] = ip
                    u[1,indu] = il
                    u[2,indu] = k
                    indu = indu+1
                else:
                    v[0,indv] = ip
                    v[1,indv] = il
                    v[2,indv] = k
                    indv = indv+1
    #return (u0,u1,u2),(v0,v1,v2)
    return u,v

tic = time.time()
u,v = splitMDA(imax)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>0.28248000145
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>import numpy as np
import time
import pdb
from numba import jit
#@jit
def cover(dem,X,Y,Ha,Hb,fGHz):
    Nphi,Nl = dem.shape
    #pdb.set_trace()
    print Nphi,Nl
    L = np.zeros((Nphi,Nl,Nl+1))
    for ip in range(Nphi):
        for il in range(Nl):
            uk = range(1,il+2)
            z = np.empty(len(uk))
            for k in uk:
                x = X[ip,:k]
                y = Y[ip,:k]
                z[:k] = dem[ip,:k]
            d = np.sqrt((x-x[0])**2+(y-y[0])**2)
            u = np.arange(len(z))/(len(z)-1.0)
            z[0]  = z[0] + Ha
            z[-1] = z[-1] + Hb
            plt.plot(d,z)
            L[ip,il,k]=interv(z,d,fGHz,0,0)
    return(L)

#@jit
def interv(z,d,fGHz,L,depth):
    lmbda = 0.3/fGHz
    depth = depth+1
    if depth &lt;3:
        if len(z)&gt;3:
            u = np.arange(len(z))/(len(z)-1.0)
            l = (z[0])*(1-u)+(z[-1])*u
            h = z[1:-1]-l[1:-1]
            nu = h*np.sqrt((2/lmbda)*(1/d[1:-1]+1/(d[-1]-d[1:-1])))
            imax = np.nanargmax(nu)
            numax = nu[imax]
        else:
            numax = -10
        if numax&gt;-0.78:
            w  = numax -0.1
            L  = L + 6.9 + 20*np.log10(np.sqrt(w**2+1)+w)
            z1 = z[0:imax]
            d1 = d[0:imax]
            Ll = interv(z1,d1,fGHz,0,depth)
            z2 = z[imax:]
            d2 = d[imax:]

            Lr = interv(z2,d2,fGHz,0,depth)

            L  = L+Lr+Ll
    return(L)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>tic = time.time()
L=cover(dem,x,y,1,1,2)
toc=time.time()
print toc-tic
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>45 50
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>/home/uguen/anaconda2/lib/python2.7/site-packages/ipykernel_launcher.py:20: RuntimeWarning: invalid value encountered in divide
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>2.30528688431
</pre></div>
</div>
<img alt="../../_images/Coverage_69_3.png" src="../../_images/Coverage_69_3.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>x
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>array([[ 11000.        ,  11204.08163265,  11408.16326531, ...,
         20591.83673469,  20795.91836735,  21000.        ],
       [ 11000.        ,  11202.00437589,  11404.00875179, ...,
         20494.20566702,  20696.21004292,  20898.21441881],
       [ 11000.        ,  11195.81489257,  11391.62978515, ...,
         20203.299951  ,  20399.11484357,  20594.92973614],
       ...,
       [ 11000.        ,  11195.81489257,  11391.62978515, ...,
         20203.299951  ,  20399.11484357,  20594.92973614],
       [ 11000.        ,  11202.00437589,  11404.00875179, ...,
         20494.20566702,  20696.21004292,  20898.21441881],
       [ 11000.        ,  11204.08163265,  11408.16326531, ...,
         20591.83673469,  20795.91836735,  21000.        ]])
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>plt.imshow(L[0,:,:],cmap=plt.cm.jet)
plt.colorbar()
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f12be98b610&gt;
</pre></div>
</div>
<img alt="../../_images/Coverage_71_1.png" src="../../_images/Coverage_71_1.png" />
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2016, PyLayers developer team.
      Last updated on Nov 06, 2017.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5a0. Design by <a href="http://desgrana.es">Desgrana</a>.
    <span style="padding-left: 5ex;">
    <a href="../../_sources/notebook/1-GIS/Coverage.rst.txt"
	    rel="nofollow">Show this page source</a>
    </span>
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="Ezone.html">
        Previous
      </a>  
    </div>
    <div class="buttonNext">
      <a href="../2-AP/SlabsMaterials.html">
        Next
      </a>  
    </div>
    <div class="buttonPrevious">
      <a href="../../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>