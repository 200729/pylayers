
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Geographical Information and the Earth Zone class : Ezone &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../index.html" />
    <link rel="up" title="1   Overview" href="../TOC.html" />
    <link rel="next" title="Outdoor Coverage Knife-Edge Model" href="Coverage.html" />
    <link rel="prev" title="Modifying the segment nature" href="Multisubsegments.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../index.html">
            <img src="../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../download.html">Download</a></li>
            <li><a href="../TOC.html">User Guide</a></li>
            <li><a href="../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	  <div class="rel">
	   
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="Multisubsegments.html" title="Modifying the segment nature"
	    accesskey="P">Previous
	    <br>
	    <span class="smallrellink">
	    Modifying the...
	    </span>
	    <span class="hiddenrellink">
	    Modifying the segment nature
	    </span>
	    
	    </a>
	</div>
	    <div class="spacer">
	    &nbsp;
	    </div>
	
	<div class="rellink">
	<a href="Coverage.html" title="Outdoor Coverage Knife-Edge Model"
	    accesskey="N">Next
	    <br>
	    <span class="smallrellink">
	    Outdoor Cover...
	    </span>
	    <span class="hiddenrellink">
	    Outdoor Coverage Knife-Edge Model
	    </span>
	    
	    </a>
	</div>
	    <div class="spacer">
	    &nbsp;
	    </div>
	
	<div class="rellink">
	<a href="../../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module Index
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
	<div class="spacer">
	&nbsp;
	</div>
	<div class="rellink">
	<a href="../TOC.html" title="1   Overview" >
	Up
	<br>
	<span class="smallrellink">
	1   Overview
	</span>
	<span class="hiddenrellink">
	1   Overview
	</span>
	
	</a>
	</div>
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	<ul>
<li><a class="reference internal" href="#">Geographical Information and the Earth Zone class : <code class="docutils literal"><span class="pre">Ezone</span></code></a><ul>
<li><a class="reference internal" href="#zooming-in">Zooming in</a></li>
<li><a class="reference internal" href="#ground-height-profile-extraction">Ground Height Profile Extraction</a></li>
</ul>
</li>
</ul>

    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; !date
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>samedi 4 novembre 2017, 10:23:14 (UTC+0100)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import pylayers.gis.ezone as ez
&gt;&gt;&gt; from pylayers.gis.gisutil import ent,ext2qt
&gt;&gt;&gt; import matplotlib.pyplot as plt
&gt;&gt;&gt; import numpy as np
&gt;&gt;&gt; import seaborn as sns
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; %matplotlib inline
</pre></div>
</div>
<div class="section" id="geographical-information-and-the-earth-zone-class-ezone">
<h1>Geographical Information and the Earth Zone class : <code class="docutils literal"><span class="pre">Ezone</span></code><a class="headerlink" href="#geographical-information-and-the-earth-zone-class-ezone" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal"><span class="pre">Ezone</span></code> class handles an earth zone which corresponds to the
<code class="docutils literal"><span class="pre">srtm</span></code> or <code class="docutils literal"><span class="pre">aster</span></code> DEM data. It has the same naming convention as
<code class="docutils literal"><span class="pre">srtm</span></code> files and corresponds to a portion of earth corresponding to 1
latitude and 1 of longitude. An <code class="docutils literal"><span class="pre">Ezone</span></code> is an heterogeneous dataset
stored in <code class="docutils literal"><span class="pre">hdf5</span></code> format. Let see an example with the file
<code class="docutils literal"><span class="pre">N48W002.h5</span></code>.</p>
<p>By default files are placed in directory <code class="docutils literal"><span class="pre">gis/h5</span></code> of the current
project tree.</p>
<p>The command h5ls allows to see the hierarchical structure of the file</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; !h5ls $BASENAME/gis/h5/N48W002.h5
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>bldg                     Group
dem                      Group
extent                   Dataset {4}
</pre></div>
</div>
<p>Invoking an earth zone requires to specify the tile prefix with the same
naming convention as with SRTM files. For example let consider the earth
zone from -2 to -1 in west longitude and from 48 to 49 in North latitude
this corresponds to the <code class="docutils literal"><span class="pre">N48W002</span></code> tile, so the ezone <code class="docutils literal"><span class="pre">z</span></code> is invoked
as :</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z = ez.Ezone(&#39;N48W002&#39;)
</pre></div>
</div>
<p>In this initial phase no data is loaded yet, to load all the data
gathered for this <code class="docutils literal"><span class="pre">Ezone</span></code> in an existing HDF5 file let invoque the
<code class="docutils literal"><span class="pre">loadh5</span></code> method.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z.loadh5()
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>N48W002
--------
latlon (deg) : [-2 -1 48 49]
cartesian (meters) : [0.000 73676.623 0.000 111194.358 ]

Buildings
---------
i-longitude : 64 96
i-latitude  : 19 38
</pre></div>
</div>
<p>This object contains the <code class="docutils literal"><span class="pre">srtm</span></code> DEM data, the aster data and a
filtration of the <code class="docutils literal"><span class="pre">open</span> <span class="pre">street</span> <span class="pre">map</span></code> database selecting only the ways
with <code class="docutils literal"><span class="pre">building</span></code> attribute. Let&#8217;s have a look to the data with the
<code class="docutils literal"><span class="pre">show</span></code> method.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd=z.show(source=&#39;srtm&#39;,bldg=False,height=True,clim=[150,350],cmap=plt.cm.hot,alpha=1)
</pre></div>
</div>
<img alt="../../_images/Ezone_11_0.png" src="../../_images/Ezone_11_0.png" />
<p>The <code class="docutils literal"><span class="pre">Ezone</span></code> object has a member extent which gives
[lonmin,lonmax,latmin,latmax]</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z.extent
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>array([-2, -1, 48, 49])
</pre></div>
</div>
<p>The shape of hgta data is larger (3601,3601) than the srtm data
(1201,1201)</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z.hgta.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(3601, 3601)
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z.hgts.shape
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(1201, 1201)
</pre></div>
</div>
<p>The aster DEM can also be shown.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd=z.show(source=&#39;aster&#39;,bldg=False,clim=[0,320])
</pre></div>
</div>
<img alt="../../_images/Ezone_18_0.png" src="../../_images/Ezone_18_0.png" />
<p>An earth zone has an attached dictionary of buildings, which contains
the data of all the set of building footprints of the city extracted out
of open street map data. Below is shown an example for the city of
Rennes in Brittany (France).</p>
<div class="section" id="zooming-in">
<h2>Zooming in<a class="headerlink" href="#zooming-in" title="Permalink to this headline">¶</a></h2>
<p>For zooming into a smaller region, we define the zone to visualize a
given rectangular region with <code class="docutils literal"><span class="pre">(lonmin,lonmax,latmin,latmax)</span></code>.</p>
<p>This region can be converted into Cartesian coordinates with the
<code class="docutils literal"><span class="pre">conv</span></code> method.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; extent1 = (-1.8,-1.6,48.05,48.15)
&gt;&gt;&gt; extent1_cart  = ez.conv(extent1,z.m)
&gt;&gt;&gt; print &quot;latlon extent :&quot;,extent1
&gt;&gt;&gt; print &quot;Cartesian extent (meters):&quot;,extent1_cart
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>latlon extent : (-1.8, -1.6, 48.05, 48.15)
Cartesian extent (meters): [ 14902.21631869  29782.9577558    5482.53114884  16563.42201909]
</pre></div>
</div>
<p>Once the selected extent has been chosen, it is possible to pass it to
the <code class="docutils literal"><span class="pre">show</span></code> method for zooming in the map.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd = z.show(title=&#39;Rennes City Center (ASTER data)&#39;,
...              extent=extent1,
...              bldg=True,
...              height=True,
...              contour=False,
...              source=&#39;aster&#39;,
...              clim=[0,105],
...              figsize=(20,20)
...              )
&gt;&gt;&gt; f,a,axd = z.show(title=&#39;Rennes City Center (SRTM data)&#39;,
...              extent=extent1,
...              bldg=True,
...              height=True,
...              contour=False,
...              source=&#39;srtm&#39;,
...              clim=[0,105],
...              figsize=(20,20)
...              )
</pre></div>
</div>
<img alt="../../_images/Ezone_22_0.png" src="../../_images/Ezone_22_0.png" />
<img alt="../../_images/Ezone_22_1.png" src="../../_images/Ezone_22_1.png" />
<p>The maps diplayed above are labeled in longitude (horizontal axis) and
latitude (vertical axis) but it is also possible to label it in
cartesian coordinates as below</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; z.rebase()
&gt;&gt;&gt; z.tocart()
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd = z.show(title=&#39;Rennes City Center&#39;,
...              extent=extent1_cart,coord=&#39;cartesian&#39;,
...              bldg=True,height=True,
...              clim=[0,100])
</pre></div>
</div>
<img alt="../../_images/Ezone_25_0.png" src="../../_images/Ezone_25_0.png" />
<p>Let zoom to the University of Rennes 1 campus in the North-East region
of the city.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; extent2 = (-1.645,-1.62,48.111,48.125)
&gt;&gt;&gt; extent2_cart = ez.conv(extent2,z.m)
&gt;&gt;&gt; print extent2
&gt;&gt;&gt; print extent2_cart
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>(-1.645, -1.62, 48.111, 48.125)
[ 26436.36082372  28294.87716101  12232.14024036  13785.67272683]
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd = z.show(title=&#39;Beaulieu Campus&#39;,
              extent=extent2_cart,
              coord=&#39;cartesian&#39;,
              height=False,
              bldg=True,
              clim=[0,40])
</pre></div>
</div>
<img alt="../../_images/Ezone_28_0.png" src="../../_images/Ezone_28_0.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f,a,axd = z.show(title=&#39;Beaulieu Campus&#39;,
              extent=extent2_cart,
              coord=&#39;cartesian&#39;,
              bldg=True,
              height=True,
              clim=[0,80])
</pre></div>
</div>
<img alt="../../_images/Ezone_29_0.png" src="../../_images/Ezone_29_0.png" />
</div>
<div class="section" id="ground-height-profile-extraction">
<h2>Ground Height Profile Extraction<a class="headerlink" href="#ground-height-profile-extraction" title="Permalink to this headline">¶</a></h2>
<p>For predicting the radio propagation, it is necessary to retrieve the
height profile between 2 points on the earth surface. The <code class="docutils literal"><span class="pre">profile</span></code>
method does a profile extraction and geometrical calculation for further
propagation loss determination using the Deygout method. Points have to
be expressed in (lon,lat) coordinates in WGS84 system.</p>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; h,d,dh,nu,num,m,LOS = z.profile(pa=(-1.645,48.111),
                                 pb=(-1.62,48.325),
                                 fGHz=0.3,
                                 source=&#39;srtm&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>/home/uguen/Documents/rch/devel/pylayers/pylayers/gis/ezone.py:725: RuntimeWarning: divide by zero encountered in divide
  fac  = np.sqrt(2*d[-1]/(lmbda*d*d[::-1]))
</pre></div>
</div>
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f = plt.figure(figsize=(15,5))
&gt;&gt;&gt; a=plt.plot(d,dh,&#39;r&#39;,d,h,&#39;b&#39;,d,m[0,:],&#39;g&#39;,d,LOS,&#39;k&#39;)
&gt;&gt;&gt; plt.xlabel(&#39;distance (meters)&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x7fae96621750&gt;
</pre></div>
</div>
<img alt="../../_images/Ezone_32_1.png" src="../../_images/Ezone_32_1.png" />
<div class="code highlight-none"><div class="highlight"><pre><span></span>&gt;&gt;&gt; f = plt.figure(figsize=(15,5))
&gt;&gt;&gt; a=plt.plot(d,nu)
&gt;&gt;&gt; a = plt.axis([0,25000,-2,2])
&gt;&gt;&gt; plt.title(r&#39;Fresnel parameter $\nu$&#39;)
&gt;&gt;&gt; plt.xlabel(&#39;Distance (meters)&#39;)
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x7fae96551b10&gt;
</pre></div>
</div>
<img alt="../../_images/Ezone_33_1.png" src="../../_images/Ezone_33_1.png" />
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2016, PyLayers developer team.
      Last updated on Nov 06, 2017.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5a0. Design by <a href="http://desgrana.es">Desgrana</a>.
    <span style="padding-left: 5ex;">
    <a href="../../_sources/notebook/1-GIS/Ezone.rst.txt"
	    rel="nofollow">Show this page source</a>
    </span>
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="Multisubsegments.html">
        Previous
      </a>  
    </div>
    <div class="buttonNext">
      <a href="Coverage.html">
        Next
      </a>  
    </div>
    <div class="buttonPrevious">
      <a href="../../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>