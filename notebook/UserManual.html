
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1. What is PyLayers about ? &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="Python 1 documentation" href="../index.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img src="../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../download.html">Download</a></li>
            <li><a href="TOC.html">User Guide</a></li>
            <li><a href="../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>
<script type="text/javascript">
  google.load('search', '1', {language : 'en'});
  google.setOnLoadCallback(function() {
    var customSearchControl = new google.search.CustomSearchControl('016639176250731907682:tjtqbvtvij0');
    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
    var options = new google.search.DrawOptions();
    options.setAutoComplete(true);
    customSearchControl.draw('cse', options);
  }, true);
</script>

</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	   <div class="rel rellarge">
	     
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module In...
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	<ul>
<li><a class="reference internal" href="#">1. What is PyLayers about ?</a><ul>
<li><a class="reference internal" href="#keywords">1.1. Keywords</a></li>
</ul>
</li>
<li><a class="reference internal" href="#warnings">2. Warnings</a></li>
<li><a class="reference internal" href="#installation">3. Installation</a><ul>
<li><a class="reference internal" href="#dependencies">3.1. Dependencies</a></li>
<li><a class="reference internal" href="#setting-of-environment-variables-basename-and-pylayers">3.2. Setting of environment variables $BASENAME and $PYLAYERS</a></li>
<li><a class="reference internal" href="#testing">3.3. Testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#description-of-antennas">4. Description of Antennas</a><ul>
<li><a class="reference internal" href="#defining-antenna-gain-from-closed-form-formulas">4.1. Defining Antenna gain from closed form formulas</a></li>
<li><a class="reference internal" href="#description-with-scalar-spherical-harmonics">4.2. Description With Scalar Spherical Harmonics</a></li>
<li><a class="reference internal" href="#description-of-antennas-with-vector-spherical-harmonics">4.3. Description of Antennas with Vector Spherical Harmonics</a></li>
<li><a class="reference internal" href="#evaluation-of-vector-spherical-harmonics-coefficients">4.4. Evaluation of Vector Spherical Harmonics Coefficients</a></li>
</ul>
</li>
<li><a class="reference internal" href="#slabs-and-materials">5. Slabs and Materials</a><ul>
<li><a class="reference internal" href="#defining-a-new-slab-and-a-new-material">5.1. Defining a New Slab and a New Material</a></li>
<li><a class="reference internal" href="#slab-information">5.2. Slab Information</a></li>
<li><a class="reference internal" href="#slab-evaluation">5.3. Slab evaluation</a></li>
<li><a class="reference internal" href="#transmission-and-reflexion-coefficients">5.4. Transmission and Reflexion coefficients</a><ul>
<li><a class="reference internal" href="#ploting-coefficients">5.4.1. Ploting Coefficients</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evaluation-without-phase-compensation">5.5. Evaluation without phase compensation</a></li>
<li><a class="reference internal" href="#double-glass-example-from-litterature-1-in-sub-terahertz-d-band-120ghz">5.6. Double Glass example from litterature [1] in sub TeraHertz D-band &#64; 120GHz</a></li>
<li><a class="reference internal" href="#references">5.7. References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-layout-class">6. The Layout class</a><ul>
<li><a class="reference internal" href="#structure-of-a-layout">6.1. Structure of a Layout</a></li>
<li><a class="reference internal" href="#subsegments">6.2. Subsegments</a></li>
<li><a class="reference internal" href="#layout-file-formats">6.3. Layout file formats</a></li>
<li><a class="reference internal" href="#reading-an-exiting-layout">6.4. Reading an exiting Layout</a></li>
<li><a class="reference internal" href="#the-display-options-dictionnary">6.5. The display options dictionnary</a></li>
<li><a class="reference internal" href="#interactive-editor">6.6. Interactive editor</a><ul>
<li><a class="reference internal" href="#image-overlay">6.6.1. Image overlay</a></li>
<li><a class="reference internal" href="#scaling-the-figure-overlay">6.6.2. Scaling the figure overlay</a></li>
<li><a class="reference internal" href="#visualisation-of-the-layout">6.6.3. Visualisation of the layout</a></li>
<li><a class="reference internal" href="#segment-and-sub-segments">6.6.4. Segment and sub-segments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#channel-variability-due-to-different-layout-constitutive-materials">6.7. Channel variability due to different <tt class="docutils literal"><span class="pre">Layout</span></tt> constitutive materials</a></li>
</ul>
</li>
<li><a class="reference internal" href="#electromagnetic-simulation">7. Electromagnetic Simulation</a><ul>
<li><a class="reference internal" href="#mutliwall-model">7.1. Mutliwall Model</a><ul>
<li><a class="reference internal" href="#computing-the-multi-wall-model">7.1.1. Computing the Multi-wall model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-coverage-class">7.2. The Coverage class</a></li>
<li><a class="reference internal" href="#ray-signatures">7.3. Ray Signatures</a></li>
<li><a class="reference internal" href="#synthesis-of-ultra-wide-band-waveforms">7.4. Synthesis of Ultra Wide Band Waveforms</a><ul>
<li><a class="reference internal" href="#calculation-of-uwb-channel-impulse-response">7.4.1. Calculation of UWB channel impulse response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#construction-of-the-propagation-channel">7.5. Construction of the propagation channel</a></li>
<li><a class="reference internal" href="#construction-of-the-transmission-channel">7.6. Construction of the transmission channel</a></li>
<li><a class="reference internal" href="#calculate-uwb-channel-impulse-response">7.7. Calculate UWB Channel Impulse Response</a></li>
<li><a class="reference internal" href="#hermitian-symetry-enforcment">7.8. Hermitian symetry enforcment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#example-of-an-uwb-channel-ray-tracing-simulation">8. Example of an UWB channel Ray Tracing simulation</a><ul>
<li><a class="reference internal" href="#adding-coordinates-of-transmiting-and-receiving-points">8.1. Adding coordinates of transmiting and receiving points</a></li>
<li><a class="reference internal" href="#signatures-rays-and-propagation-and-transmission-channel">8.2. Signatures, rays and propagation and transmission channel</a></li>
<li><a class="reference internal" href="#calculating-the-propagation-channel">8.3. Calculating the Propagation Channel</a></li>
<li><a class="reference internal" href="#apply-waveform">8.4. Apply waveform</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulation-creation">9. Simulation Creation</a><ul>
<li><a class="reference internal" href="#id3">9.1. Adding coordinates of transmiting and receiving points</a></li>
<li><a class="reference internal" href="#signatures-rays-and-channel">9.2. Signatures, Rays and channel</a></li>
<li><a class="reference internal" href="#id4">9.3. Apply waveform</a></li>
<li><a class="reference internal" href="#example-of-a-trajectory-synthesis-in-dlr-where2-environment">9.4. Example of a trajectory synthesis in DLR WHERE2 environment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-human-mobility">10. Handling Human mobility</a><ul>
<li><a class="reference internal" href="#body-mobility">10.1. Body Mobility</a><ul>
<li><a class="reference internal" href="#bodycylinder-data-structure">10.1.1. <tt class="docutils literal"><span class="pre">BodyCylinder</span></tt> data structure</a></li>
<li><a class="reference internal" href="#description-of-a-body-file">10.1.2. Description of a body file</a></li>
<li><a class="reference internal" href="#loading-a-motion-capture-file">10.1.3. Loading a Motion Capture File</a></li>
<li><a class="reference internal" href="#defining-a-trajectory">10.1.4. Defining a trajectory</a></li>
<li><a class="reference internal" href="#settopos-method">10.1.5. settopos () method</a></li>
<li><a class="reference internal" href="#defining-a-large-scale-trajectory">10.1.6. Defining a large scale trajectory</a></li>
<li><a class="reference internal" href="#trajectory">10.1.7. Trajectory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#posvel">10.2. <tt class="docutils literal"><span class="pre">posvel()</span></tt></a><ul>
<li><a class="reference internal" href="#definition-of-several-coordinates-systems">10.2.1. Definition of Several Coordinates systems</a></li>
<li><a class="reference internal" href="#construction-of-the-cylinder-coordinate-system-ccs">10.2.2. Construction of the Cylinder Coordinate System (CCS)</a></li>
<li><a class="reference internal" href="#placing-a-dcs-device-coordinate-system-on-the-cylinder">10.2.3. Placing a dcs (Device Coordinate System ) on the cylinder</a></li>
</ul>
</li>
<li><a class="reference internal" href="#large-scale-mobility">10.3. Large Scale Mobility</a></li>
</ul>
</li>
<li><a class="reference internal" href="#algebraic-localization-class">11. Algebraic Localization Class</a><ul>
<li><a class="reference internal" href="#example-of-tdoa">11.1. Example of TDOA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rgpa-robust-geometric-positioning-algorithm">12. RGPA (Robust Geometric Positioning Algorithm)</a><ul>
<li><a class="reference internal" href="#exploiting-time-of-arrival-toa-only">12.1. Exploiting Time of Arrival (ToA) only</a></li>
<li><a class="reference internal" href="#rss">12.2. RSS</a></li>
<li><a class="reference internal" href="#tdoa">12.3. TDOA</a></li>
</ul>
</li>
<li><a class="reference internal" href="#network-simulation-configuration">13. Network Simulation Configuration</a><ul>
<li><a class="reference internal" href="#layout">13.1. Layout</a></li>
<li><a class="reference internal" href="#network">13.2. Network</a></li>
<li><a class="reference internal" href="#mechanics">13.3. Mechanics</a></li>
<li><a class="reference internal" href="#localization">13.4. Localization</a></li>
<li><a class="reference internal" href="#simulation">13.5. Simulation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#geomutil-class">14. Geomutil Class</a></li>
<li><a class="reference internal" href="#class-polygon">15. Class Polygon</a><ul>
<li><a class="reference internal" href="#ploting-polygons">15.1. ploting polygons</a></li>
<li><a class="reference internal" href="#buildgv">15.2. <tt class="docutils literal"><span class="pre">buildGv()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#geomview-classes">16. Geomview classes</a><ul>
<li><a class="reference internal" href="#geomvect-class">16.1. GeomVect class</a><ul>
<li><a class="reference internal" href="#geombase">16.1.1. geomBase</a></li>
<li><a class="reference internal" href="#points">16.1.2. points</a></li>
<li><a class="reference internal" href="#plotting-a-box">16.1.3. plotting a box</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility-functions">16.2. Utility functions</a><ul>
<li><a class="reference internal" href="#angledir">16.2.1. angledir</a></li>
<li><a class="reference internal" href="#linet">16.2.2. linet</a></li>
<li><a class="reference internal" href="#dptseg-p-pt-ph">16.2.3. dptseg(p,pt,ph)</a></li>
<li><a class="reference internal" href="#displot">16.2.4. displot</a></li>
<li><a class="reference internal" href="#ptonseg-pta-phe-pt">16.2.5. ptonseg(pta,phe,pt)</a></li>
<li><a class="reference internal" href="#ptconvex">16.2.6. ptconvex</a></li>
<li><a class="reference internal" href="#intersect">16.2.7. intersect</a></li>
</ul>
</li>
<li><a class="reference internal" href="#useful-functions">16.3. Useful functions</a></li>
</ul>
</li>
</ul>

    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="what-is-pylayers-about">
<h1>1. What is PyLayers about ?<a class="headerlink" href="#what-is-pylayers-about" title="Permalink to this headline">¶</a></h1>
<p>PyLayers is an ongoing endeavour to build a versatile, intuitive and
efficient open-source platform for cross layer studies, deeply rooted in
the physics of wireless propagation.</p>
<p>In the short term, the major targeted applications are in the field of
wireless indoor radio localization and navigation.
Further evolutions of the PyLayers platform
could also help for tackling other related problems as designing energy
efficient wireless 5G networks, smart grids and cities in a cooperative,
parcimonious and resiliant way.</p>
<p>PyLayers owes immensly to two former FP7 European Projects
(WHERE1 and <a class="reference external" href="http://www.kn-s.dlr.de/where2/">WHERE2</a> ) which run between 2008 and 2013.
Several examples provided and currently studied comes out from those 2 projects.</p>
<p>PyLayers is currently developped in the frame of the CORMORAN French ANR
project.</p>
<p>An other purpose of PyLayers is engineering education. So, if you are a
curious student who can see the fun of surfing radio waves with python,
please have a look inside and join !</p>
<p>Bernard Uguen</p>
<p>Professor &#64; University of Rennes, ESIR, IETR CNRS, Brittany Region,
France</p>
<div class="section" id="keywords">
<h2>1.1. Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Python scientific framework</li>
<li>Computational Electromagnetism</li>
<li>Site specific Channel Modeling</li>
<li>Ray Tracing</li>
<li>Indoor Radio Propagation Modelling</li>
<li>Impulse Radio Ultra Wide Band IR-UWB (IEEE 802.15.4a)</li>
<li>Efficient handling of antenna patterns for UWB scenario</li>
<li>Indoor Localisation</li>
<li>Exploiting Multi Path Components (MPC) for positioning</li>
<li>Cooperative Positioning</li>
<li>Robust Geometric Positioning Algorithm (RGPA)</li>
<li>Radio channel modeling (site specific and statistical)</li>
<li>Channel Sounding</li>
<li>MIMO channel</li>
<li>PHY/MAC/NET</li>
<li>Wireless Body Area Network (IEEE 802.15.6)</li>
<li>Human mobility simulation</li>
<li>Motion capture</li>
</ul>
</div>
</div>
<div class="section" id="warnings">
<h1>2. Warnings<a class="headerlink" href="#warnings" title="Permalink to this headline">¶</a></h1>
<p>This documentation is generated automatically with sphinx from the
PyLayers source code files on github
(<a class="reference external" href="https://github.com/pylayers/pylayers">https://github.com/pylayers/pylayers</a>).</p>
<p>The collection of .s in the doc directory is used as a
complementary battery of tests using
<a class="reference external" href="https://pypi.python.org/pypi/runipy">runipy</a>, it is used to track
regressions and broken functionalities as it happens on a regular basis
in a living project.</p>
<p>It is expected that the magic of <tt class="docutils literal"><span class="pre">git</span></tt> will gradually improves
this document and the code at the same time.</p>
<p>Nothing in PyLayers is guarantee, nothing should be taken for granted. This
documention is by far not sufficiently peer reviewed at that time to
have reach a sufficient level of quality. It is expected that there are
engineers and scientists out there, interested by the PyLayers endeavour
curious to have a try, which will provide feed back and will contribute to
the necessary continuous improvement of the PyLayers platform.</p>
<p>So, if you see any wrong assertion or have any suggestion
please do not hesitate to provide a feed back on the <a class="reference external" href="https://github.com/pylayers/pylayers/issues?milestone=1&amp;state=open">issues
page of the
project</a></p>
<p>If you find a bug, please keep track of it in a .
and <tt class="docutils literal"><span class="pre">gist</span></tt> it and send the link on the issues page.</p>
<p>Any feedback from users is more than welcome for any suggestions of
improvement about the source code.</p>
<p>If you have any interest to be involved and to participate to the
<tt class="docutils literal"><span class="pre">PyLayers</span></tt> project, the best way is to open a <tt class="docutils literal"><span class="pre">github</span></tt> account and
to fork the project on your own machine. Use PyLayers for your own
needs, and if you wish provide feedback to the project with a <strong>pull
request</strong>.</p>
</div>
<div class="section" id="installation">
<h1>3. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>PyLayers is developped on Linux platform but should also work on windows
platform. If you are working on Windows and are not familiar with the Python ecosystem, a
good idea is to install first
<a class="reference external" href="https://store.continuum.io/cshop/anaconda/">Anaconda</a>. It provides
you most of the required dependencies.</p>
<div class="section" id="dependencies">
<h2>3.1. Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>Before to install pylayers you need to install the following dependencies


numpy&gt;=1.6.1
scipy&gt;=0.10.1
networkx&gt;=1.7
matplotlib&gt;=1.1.0
shapely&gt;=1.2.14
descartes&gt;=1.0
SimPy&gt;=2.2
PIL&gt;=1.1.5
bitstring&gt;=3.0.2
pyintervall&gt;=1.0
pandas &gt;=0.12.0

The installation of matplotlib basemap requires installation of libraries GEOS
and PROJ4. The installation procedure is well described in
</pre></div>
</div>
<p><a class="reference external" href="http://matplotlib.org/basemap/users/installing.html">http://matplotlib.org/basemap/users/installing.html</a></p>
<div class="highlight-python"><div class="highlight"><pre>For supporting the osm format PyLayers is relying on imposm. The installation
of imposm is not straighforward it requires to install first Tokyo-Cabinet
and Google-Protobuf library. PyLayers can work without imposm you need to
comment the only import to the module in pylayers/gis/osmparser.py.
</pre></div>
</div>
<p><a class="reference external" href="http://imposm.org/docs/imposm/latest/install.html#id1">http://imposm.org/docs/imposm/latest/install.html#id1</a></p>
<div class="highlight-python"><div class="highlight"><pre>Most of these dependencies are handled in the setup.py script.

python setup.py install
</pre></div>
</div>
</div>
<div class="section" id="setting-of-environment-variables-basename-and-pylayers">
<h2>3.2. Setting of environment variables $BASENAME and $PYLAYERS<a class="headerlink" href="#setting-of-environment-variables-basename-and-pylayers" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>It is required to define the two enviroment variables $PYLAYERS and $BASENAME

in your .bashrc add those 2 lines

#export PYLAYERS = &lt;path to the directory where pylayers is installed&gt;

for example if you install PyLyers in your home directory

export PYLAYERS=~/pylayers
export BASENAME=~/plproject
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h2>3.3. Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>make test-code
</pre></div>
</div>
</div>
</div>
<div class="section" id="description-of-antennas">
<h1>4. Description of Antennas<a class="headerlink" href="#description-of-antennas" title="Permalink to this headline">¶</a></h1>
<p>PyLayers accepts various descriptions of the antenna radiation pattern.
It goes from a simple antenna gain formula to a full polarization description.</p>
<ul class="simple">
<li>Full description on a grid (.mat,.trx)</li>
<li>Scalar Harmonics decomposition (.sh2,.sh3)</li>
<li>Vector Harmonics decomposition  (.vsh2,.vsh3)</li>
<li>Closed form formula for simplified antenna models (Omni,Gauss,WirePlate,...)</li>
</ul>
<p>The following examples illustrates some features of the Antenna class.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/usr/local/lib/python2.7/dist-packages/pkg_resources.py:991: UserWarning: /home/uguen/.python-eggs is writable by group/others and vulnerable to attack when used with get_resource_filename. Consider a more secure location (set with .set_extraction_path or the PYTHON_EGG_CACHE environment variable).
  warnings.warn(msg, UserWarning)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.figure.Figure at 0x79a8990&gt;
</pre></div>
</div>
<p>Lets start by loading an antenna from a <tt class="docutils literal"><span class="pre">vsh3</span></tt> file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span> <span class="o">=</span> <span class="n">Antenna</span><span class="p">(</span><span class="s">&#39;S1R1.vsh3&#39;</span><span class="p">)</span>
<span class="n">A</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FileName : S1R1.vsh3
-----------------------
fmin : 0.80GHz
fmax : 5.95GHz
step : 50.00MHz
Nf : 104
Not evaluated
</pre></div>
</div>
<p>In fact this is not a void antenna. There is a default file which has
been loaded and there is an antenna down there. The only thing we know
at that point is the name of the file which has extension &#8216;.vsh3&#8217; which
means vector spherical harmonics in shape 3. To list all the availble
antenna files in the dedicated directory of the project it i possible to
invoke the <tt class="docutils literal"><span class="pre">ls()</span></tt> method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s">&#39;sh3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;S1R1.sh3&#39;</span><span class="p">,</span> <span class="s">&#39;S2R2.sh3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">ls</span><span class="p">(</span><span class="s">&#39;vsh3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;S1R1.vsh3&#39;</span><span class="p">,</span>
 <span class="s">&#39;S1R10.vsh3&#39;</span><span class="p">,</span>
 <span class="s">&#39;S1R11.vsh3&#39;</span><span class="p">,</span>
 <span class="s">&#39;S1R12.vsh3&#39;</span><span class="p">,</span>
 <span class="s">&#39;S1R13.vsh3&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>At that point the radiation pattern of the antenna has not yet been
evaluated. For a shape 3 pattern the method to calculate the pattern is
<tt class="docutils literal"><span class="pre">Fsynth3()</span></tt> with the <tt class="docutils literal"><span class="pre">pattern</span></tt> option set to true.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">polar()</span></tt> method allows to superpose different pattern for a list o
frequecies <tt class="docutils literal"><span class="pre">fGHz</span></tt> + If <tt class="docutils literal"><span class="pre">phd</span></tt> is precised the diagram is given as a
function of <img src="../_images/mathmpl/math-5dc8912759.png" style="position: relative; bottom: -3px"/> + If <tt class="docutils literal"><span class="pre">thd</span></tt> is precised the diagram is given
as a function of <img src="../_images/mathmpl/math-e22cc525ec.png" style="position: relative; bottom: -7px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">a1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f1</span><span class="p">,</span><span class="n">a1</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">fGHz</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">phd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">GmaxdB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a1</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">f2</span><span class="p">,</span><span class="n">a2</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">fGHz</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="n">thd</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span><span class="n">GmaxdB</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-Antenna1_files/AP-Antenna1_11_0.png" src="./AP-Antenna1_files/AP-Antenna1_11_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FileName : S1R1.vsh3
-----------------------
fmin : 0.80GHz
fmax : 5.95GHz
step : 50.00MHz
Nf : 104
-----------------------
Ntheta : 45
Nphi : 90
GmaxDB : 2.23 dB
   f = 5.60 GHz
   theta = 69.55 (degrees)
   phi = 271.01  (degrees)
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-Antenna1_files/AP-Antenna1_13_0.png" src="./AP-Antenna1_files/AP-Antenna1_13_0.png" />
<div class="section" id="defining-antenna-gain-from-closed-form-formulas">
<h2>4.1. Defining Antenna gain from closed form formulas<a class="headerlink" href="#defining-antenna-gain-from-closed-form-formulas" title="Permalink to this headline">¶</a></h2>
<p>An antenna can be defined from closed-form expressions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span> <span class="o">=</span> <span class="n">Antenna</span><span class="p">(</span><span class="s">&#39;Omni&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">Fpatt</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">polar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>(&lt;matplotlib.figure.Figure at 0x7f991c9aa0d0&gt;,
 &lt;matplotlib.projections.polar.PolarAxes at 0x7f995bc67450&gt;)
</pre></div>
</div>
<img alt="./AP-Antenna1_files/AP-Antenna1_18_1.png" src="./AP-Antenna1_files/AP-Antenna1_18_1.png" />
</div>
<div class="section" id="description-with-scalar-spherical-harmonics">
<h2>4.2. Description With Scalar Spherical Harmonics<a class="headerlink" href="#description-with-scalar-spherical-harmonics" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.antssh</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.figure.Figure at 0x7936310&gt;
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span> <span class="o">=</span> <span class="n">Antenna</span><span class="p">(</span><span class="s">&#39;S1R1.mat&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s">&#39;ant/UWBAN/Matfile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FileName : S1R1.mat
-----------------------
fmin : 0.80GHz
fmax : 5.95GHz
step : 50.00MHz
Nf : 104
-----------------------
Ntheta : 91
Nphi : 180
GmaxDB : 2.23 dB
   f = 5.60 GHz
   theta = 70.00 (degrees)
   phi = 272.00  (degrees)
antenna name : Th1
date : 04/12/12
time : 15:55
Notes : Mohamed at the log

Serie : 1
Run : 1
Nb theta (lat) : 91
Nb phi (lon) :180
</pre></div>
</div>
<p>To calculate scalar spherical harmonics coefficient the method <tt class="docutils literal"><span class="pre">ssh(A,L)</span></tt> is
used.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">ssh</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>FileName : S1R1.mat
-----------------------
fmin : 0.80GHz
fmax : 5.95GHz
step : 50.00MHz
Nf : 104
-----------------------
Ntheta : 91
Nphi : 180
GmaxDB : 2.23 dB
   f = 5.60 GHz
   theta = 70.00 (degrees)
   phi = 272.00  (degrees)
antenna name : Th1
date : 04/12/12
time : 15:55
Notes : Mohamed at the log

Serie : 1
Run : 1
Nb theta (lat) : 91
Nb phi (lon) :180
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x83090d0&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_6_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_6_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">savesh2</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/home/uguen/Bureau/P1/ant/S1R1.sh2  already exist
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">loadsh2</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x84115d0&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_9_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_9_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">s2tos3</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x87e8550&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_11_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_11_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">ind2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">savesh3</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/home/uguen/Bureau/P1/ant/S1R1.sh3  already exist
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x8a0fb90&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_14_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_14_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">loadsh3</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span><span class="p">[</span><span class="mi">100</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x8a45210&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_16_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_16_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">[</span><span class="mi">100</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x8cf9b50&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaSSH_files/AP-AntennaSSH_17_1.png" src="./AP-AntennaSSH_files/AP-AntennaSSH_17_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;Nf&#39;</span><span class="p">,</span>
 <span class="s">&#39;PhotoFile&#39;</span><span class="p">,</span>
 <span class="s">&#39;Np&#39;</span><span class="p">,</span>
 <span class="s">&#39;SqG&#39;</span><span class="p">,</span>
 <span class="s">&#39;Run&#39;</span><span class="p">,</span>
 <span class="s">&#39;Nt&#39;</span><span class="p">,</span>
 <span class="s">&#39;Serie&#39;</span><span class="p">,</span>
 <span class="s">&#39;Ftheta&#39;</span><span class="p">,</span>
 <span class="s">&#39;theta&#39;</span><span class="p">,</span>
 <span class="s">&#39;fromfile&#39;</span><span class="p">,</span>
 <span class="s">&#39;phi&#39;</span><span class="p">,</span>
 <span class="s">&#39;Fphi&#39;</span><span class="p">,</span>
 <span class="s">&#39;Notes&#39;</span><span class="p">,</span>
 <span class="s">&#39;Date&#39;</span><span class="p">,</span>
 <span class="s">&#39;S&#39;</span><span class="p">,</span>
 <span class="s">&#39;AntennaName&#39;</span><span class="p">,</span>
 <span class="s">&#39;typ&#39;</span><span class="p">,</span>
 <span class="s">&#39;DataFile&#39;</span><span class="p">,</span>
 <span class="s">&#39;fa&#39;</span><span class="p">,</span>
 <span class="s">&#39;evaluated&#39;</span><span class="p">,</span>
 <span class="s">&#39;StartTime&#39;</span><span class="p">,</span>
 <span class="s">&#39;_filename&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;k2&#39;</span><span class="p">,</span> <span class="s">&#39;ind3&#39;</span><span class="p">,</span> <span class="s">&#39;ind2&#39;</span><span class="p">,</span> <span class="s">&#39;fmax&#39;</span><span class="p">,</span> <span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="s">&#39;Nf&#39;</span><span class="p">,</span> <span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="s">&#39;lmax&#39;</span><span class="p">,</span> <span class="s">&#39;fmin&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Nf   : 104
fmin (GHz) : 0.8
fmax (GHz) : 5.95
NCoeff s2  : 36
Ncoeff s3 : 32
</pre></div>
</div>
</div>
<div class="section" id="description-of-antennas-with-vector-spherical-harmonics">
<h2>4.3. Description of Antennas with Vector Spherical Harmonics<a class="headerlink" href="#description-of-antennas-with-vector-spherical-harmonics" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.antvsh</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.figure.Figure at 0x85a9310&gt;
</pre></div>
</div>
<p>Read a trx file. This file has no header, it contains 7 columns :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span> <span class="o">=</span> <span class="n">Antenna</span><span class="p">(</span><span class="s">&#39;S1R1.mat&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s">&#39;ant/UWBAN/Matfile&#39;</span><span class="p">)</span>
<span class="c">#A = Antenna(&#39;trx1&#39;,&#39;UWB_CEA.trx&#39;)</span>
</pre></div>
</div>
<p>The shape of the <img src="../_images/mathmpl/math-d026c61aa2.png" style="position: relative; bottom: -10px"/> functions indicates :</p>
<ul class="simple">
<li><img src="../_images/mathmpl/math-4bc7f0f356.png" style="position: relative; bottom: -10px"/></li>
<li><img src="../_images/mathmpl/math-1858bfe838.png" style="position: relative; bottom: -7px"/></li>
<li>:math:<a href="#id1"><span class="problematic" id="id2">`</span></a>N_{phi} = 180 `</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">shape</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">Fphi</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
</pre></div>
</div>
<p>The frequency ramp is converted in <img src="../_images/mathmpl/math-d0b9a6e023.png" style="position: relative; bottom: -3px"/>. In practice we always
handles frequency expressed in <img src="../_images/mathmpl/math-d0b9a6e023.png" style="position: relative; bottom: -3px"/> and delays expressed in
<img src="../_images/mathmpl/math-2af81ea4e1.png" style="position: relative; bottom: -3px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">fa</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">104</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span>
</pre></div>
</div>
<p>Then an electrical delay of <img src="../_images/mathmpl/math-1ab8cb242a.png" style="position: relative; bottom: -3px"/> is applied on the
<img src="../_images/mathmpl/math-c0d5dfcc3f.png" style="position: relative; bottom: -7px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tau</span><span class="o">=</span><span class="mf">4.185</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,:,:]</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="o">*</span><span class="n">tau</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">imshow</span><span class="p">(</span><span class="n">unwrap</span><span class="p">(</span><span class="n">angle</span><span class="p">(</span><span class="n">I</span><span class="p">[:,</span><span class="mi">45</span><span class="p">,:])))</span>
<span class="n">title</span><span class="p">(</span><span class="s">r&#39;Unwrapped phase of $F_{\theta}$ w.r.t frequency and phi for $\theta=\frac{pi}{2}$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;f index&#39;</span><span class="p">)</span>
<span class="n">colorbar</span><span class="p">()</span>
<span class="n">figure</span><span class="p">()</span>
<span class="n">plot</span><span class="p">(</span><span class="n">fGHz</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">unwrap</span><span class="p">(</span><span class="n">angle</span><span class="p">(</span><span class="n">I</span><span class="p">[:,</span><span class="mi">45</span><span class="p">,</span><span class="mi">85</span><span class="p">])))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x9782b50&gt;]
</pre></div>
</div>
<img alt="./AP-AntennaVSH_files/AP-AntennaVSH_9_1.png" src="./AP-AntennaVSH_files/AP-AntennaVSH_9_1.png" />
<img alt="./AP-AntennaVSH_files/AP-AntennaVSH_9_2.png" src="./AP-AntennaVSH_files/AP-AntennaVSH_9_2.png" />
<p>Display of the radiation pattern for all frequencies</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">nf</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">104</span><span class="p">):</span>
    <span class="n">polar</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">nf</span><span class="p">,</span><span class="mi">45</span><span class="p">,:]))</span>
</pre></div>
</div>
<img alt="./AP-AntennaVSH_files/AP-AntennaVSH_11_0.png" src="./AP-AntennaVSH_files/AP-AntennaVSH_11_0.png" />
</div>
<div class="section" id="evaluation-of-vector-spherical-harmonics-coefficients">
<h2>4.4. Evaluation of Vector Spherical Harmonics Coefficients<a class="headerlink" href="#evaluation-of-vector-spherical-harmonics-coefficients" title="Permalink to this headline">¶</a></h2>
<p>At that stage we compute the Vector Spherical Harmonics coefficients</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">=</span><span class="n">vsh</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>S1R1.mat
type :  mat
S1R1
Th1
04/12/12
15:55
Mohamed at the log

1
1
Nb theta (lat) : 91
Nb phi (lon) : 180
No vsh coefficient calculated yet
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Br
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495

Bi
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495

Cr
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495

Ci
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">A</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;s2&#39;</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-AntennaVSH_files/AP-AntennaVSH_19_0.png" src="./AP-AntennaVSH_files/AP-AntennaVSH_19_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">s2tos3</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Br
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495
Ncoeff s3 : 86

Bi
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495
Ncoeff s3 : 86

Cr
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495
Ncoeff s3 : 86

Ci
-------------
N1  : 90
M1  : 89
Ncoeff s1 8010
NCoeff s2  : 495
Ncoeff s3 : 86
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-AntennaVSH_files/AP-AntennaVSH_22_0.png" src="./AP-AntennaVSH_files/AP-AntennaVSH_22_0.png" />
<div class="highlight-python"><div class="highlight"><pre>
</pre></div>
</div>
</div>
</div>
<div class="section" id="slabs-and-materials">
<h1>5. Slabs and Materials<a class="headerlink" href="#slabs-and-materials" title="Permalink to this headline">¶</a></h1>
<p>Before introducing any model, lets start by introducing two major classes of
the PyLayers platform on which is relying the electromagnetic field
calculation.</p>
<p>A <cite>Slab</cite> is a set of several layers of materials with specified thickness.
Slabs are used to describe properties of the different constitutive
elements of a building such as wall, windows ,...</p>
<p>In practice when describing a specific building, we specify a set of different slabs with different
dielectric characteristics.</p>
<p>The structure which gathers <cite>Slab</cite> is <tt class="docutils literal"><span class="pre">SlabDB</span></tt>. If no file argument
is given, this structure is initialized with the default file:</p>
<p><a class="reference external" href="https://github.com/pylayers/pylayers/blob/master/data/ini/slabDB.ini">slabDB.ini</a></p>
<p>We illustrates below some features of the <tt class="docutils literal"><span class="pre">pylayers.antprop.slab</span></tt> module.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.slab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<p>The Class <tt class="docutils literal"><span class="pre">SlabDB</span></tt> contains a dictionnary of all available Slab. This
information is read in the file <tt class="docutils literal"><span class="pre">slabDB.ini</span></tt> of the current project
pointed by environment variable <tt class="docutils literal"><span class="pre">$BASENAME</span></tt></p>
<p>A <tt class="docutils literal"><span class="pre">__repr__</span></tt> method provides a visual indication of the thichness and
materials of a <tt class="docutils literal"><span class="pre">Slab</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">SlabDB</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;WINDOW_GLASS&#39;</span><span class="p">,</span>
 <span class="s">&#39;PLASTERBOARD_7CM&#39;</span><span class="p">,</span>
 <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
 <span class="s">&#39;AIR&#39;</span><span class="p">,</span>
 <span class="s">&#39;WINDOW&#39;</span><span class="p">,</span>
 <span class="s">&#39;METALIC&#39;</span><span class="p">,</span>
 <span class="s">&#39;PLASTERBOARD_14CM&#39;</span><span class="p">,</span>
 <span class="s">&#39;DOOR&#39;</span><span class="p">,</span>
 <span class="s">&#39;FLOOR&#39;</span><span class="p">,</span>
 <span class="s">&#39;METAL&#39;</span><span class="p">,</span>
 <span class="s">&#39;PARTITION&#39;</span><span class="p">,</span>
 <span class="s">&#39;CONCRETE_20CM3D&#39;</span><span class="p">,</span>
 <span class="s">&#39;PLASTERBOARD_10CM&#39;</span><span class="p">,</span>
 <span class="s">&#39;CEIL&#39;</span><span class="p">,</span>
 <span class="s">&#39;CONCRETE_6CM3D&#39;</span><span class="p">,</span>
 <span class="s">&#39;CONCRETE_15CM3D&#39;</span><span class="p">,</span>
 <span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">,</span>
 <span class="s">&#39;WALLS&#39;</span><span class="p">,</span>
 <span class="s">&#39;WOOD&#39;</span><span class="p">,</span>
 <span class="s">&#39;CONCRETE_7CM3D&#39;</span><span class="p">,</span>
 <span class="s">&#39;PILLAR&#39;</span><span class="p">,</span>
 <span class="s">&#39;ABSORBENT&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="section" id="defining-a-new-slab-and-a-new-material">
<h2>5.1. Defining a New Slab and a New Material<a class="headerlink" href="#defining-a-new-slab-and-a-new-material" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;wall2&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;reim&#39;</span><span class="p">,</span><span class="n">cval</span><span class="o">=</span><span class="mf">2.6</span><span class="o">-</span><span class="mf">0.026</span><span class="o">*</span><span class="mi">1j</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;slab2&#39;</span><span class="p">,[</span><span class="s">&#39;wall2&#39;</span><span class="p">],[</span><span class="mf">0.15</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="s">&#39;wall2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;epr&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="mf">2.6</span><span class="p">),</span>
 <span class="s">&#39;epr2&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">(</span><span class="o">-</span><span class="mf">0.026</span><span class="p">),</span>
 <span class="s">&#39;epsr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.6</span><span class="o">-</span><span class="mf">0.026j</span><span class="p">),</span>
 <span class="s">&#39;fGHz&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
 <span class="s">&#39;mur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s">&#39;n&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.612</span><span class="o">-</span><span class="mf">0.00806j</span><span class="p">),</span>
 <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;wall2&#39;</span><span class="p">,</span>
 <span class="s">&#39;roughness&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
 <span class="s">&#39;sigma&#39;</span><span class="p">:</span> <span class="mf">0.0057</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;slab2&#39;</span><span class="p">][</span><span class="s">&#39;lmatname&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;wall2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><cite>ev</cite> method is used to evaluate a Slab for a given range of frequencies and angles</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">S</span><span class="p">[</span><span class="s">&#39;slab2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>pcolor()</cite> display the magnitude or phase of reflection ant transmission
coefficients w.r.t angle anf frequency.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;slab2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_15_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_15_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">=</span><span class="n">S</span><span class="p">[</span><span class="s">&#39;slab2&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">R</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">R</span>
</pre></div>
</div>
</div>
<div class="section" id="slab-information">
<h2>5.2. Slab Information<a class="headerlink" href="#slab-information" title="Permalink to this headline">¶</a></h2>
<p>Each slab contains informations about the electromagnetic properties of its constitutive materials.</p>
<p>Below is presented an example for a simple slab, constituted with a single material.
The slab &#8216;WOOD&#8217; is defined as a layer of 4cm &#8216;WOOD&#8217; material.</p>
<p><tt class="docutils literal"><span class="pre">lmatname</span></tt> list of material names</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">][</span><span class="s">&#39;lmatname&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">lithickname</span></tt> list of slab thickness</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">][</span><span class="s">&#39;lthick&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mf">0.04</span><span class="p">]</span>
</pre></div>
</div>
<p>There is also a <tt class="docutils literal"><span class="pre">color</span></tt> attribute</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;maroon&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">][</span><span class="s">&#39;linewidth&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">2</span>
</pre></div>
</div>
<p>Multi layers Slab, using different stacks of materials can be easily
defined using the two lists <strong>lmatname</strong> and <strong>lthick</strong>.</p>
<blockquote>
<div>Notice the adopted convention naming lists starting with letter &#8216;l&#8217;
and dictionnaries starting with letter &#8216;d&#8217;</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">][</span><span class="s">&#39;lmatname&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;GLASS&#39;</span><span class="p">,</span> <span class="s">&#39;AIR&#39;</span><span class="p">,</span> <span class="s">&#39;GLASS&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">][</span><span class="s">&#39;lthick&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>
</pre></div>
</div>
<p>For each constitutive material of a slab, their electromagnetic
properties can be obtained as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="p">[</span><span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">][</span><span class="s">&#39;lmat&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[{</span><span class="s">&#39;epr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.79999995232</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s">&#39;mur&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;GLASS&#39;</span><span class="p">,</span>
  <span class="s">&#39;roughness&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s">&#39;sigma&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
 <span class="p">{</span><span class="s">&#39;epr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s">&#39;mur&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;AIR&#39;</span><span class="p">,</span>
  <span class="s">&#39;roughness&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s">&#39;sigma&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span>
 <span class="p">{</span><span class="s">&#39;epr&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">3.79999995232</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s">&#39;mur&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">0j</span><span class="p">),</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;GLASS&#39;</span><span class="p">,</span>
  <span class="s">&#39;roughness&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
  <span class="s">&#39;sigma&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}]</span>
</pre></div>
</div>
</div>
<div class="section" id="slab-evaluation">
<h2>5.3. Slab evaluation<a class="headerlink" href="#slab-evaluation" title="Permalink to this headline">¶</a></h2>
<p>Each Slab can be evaluated to obtain the Transmission and Reflexion
coefficients for</p>
<ul class="simple">
<li>a given frequency range</li>
<li>a given incidence angle range (<img src="../_images/mathmpl/math-583b4bed9e.png" />)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Here, slab is evaluted for&#39;</span><span class="p">,</span><span class="n">sR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;frequency(ies)&#39;</span><span class="p">,</span> <span class="s">&#39;and&#39;</span><span class="p">,</span><span class="n">sR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;angle(s)</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Here, slab is evaluted for 200 frequency(ies) and 158 angle(s)
</pre></div>
</div>
</div>
<div class="section" id="transmission-and-reflexion-coefficients">
<h2>5.4. Transmission and Reflexion coefficients<a class="headerlink" href="#transmission-and-reflexion-coefficients" title="Permalink to this headline">¶</a></h2>
<p>Relexion and transmission coefficient are computed for the given
frequency range and theta range</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ifreq</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ithet</span><span class="o">=</span><span class="mi">10</span>

<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Reflection coefficient @&#39;</span><span class="p">,</span><span class="n">fGHz</span><span class="p">[</span><span class="n">ifreq</span><span class="p">],</span><span class="s">&#39;GHz and theta=&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">[</span><span class="n">ithet</span><span class="p">],</span><span class="s">&#39;:</span><span class="se">\n\n</span><span class="s"> R=&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Transmission coefficient @&#39;</span><span class="p">,</span><span class="n">fGHz</span><span class="p">[</span><span class="n">ifreq</span><span class="p">],</span><span class="s">&#39;GHz and theta=&#39;</span><span class="p">,</span><span class="n">theta</span><span class="p">[</span><span class="n">ithet</span><span class="p">],</span><span class="s">&#39;:</span><span class="se">\n\n</span><span class="s"> T=&#39;</span><span class="p">,</span><span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Reflection coefficient @ 3.01 GHz and theta= 0.1 :

 R= [[-0.39396205-0.17289585j  0.00000000+0.j        ]
 [ 0.00000000+0.j          0.39396205+0.17289585j]]

Transmission coefficient @ 3.01 GHz and theta= 0.1 :

 T= [[-0.17594898-0.86927604j -0.00000000+0.j        ]
 [-0.00000000+0.j         -0.17594898-0.86927604j]]
</pre></div>
</div>
<div class="section" id="ploting-coefficients">
<h3>5.4.1. Ploting Coefficients<a class="headerlink" href="#ploting-coefficients" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre>plotwrt (plot with respect to)

Parameters
----------

 kv  : int
    variable index
 polar: string
        &#39;po&#39;, # po | p | o   (parallel+ortho | parallel | ortogonal)
 coeff: string
        &#39;RT&#39;, # RT | R | T   (Reflexion &amp; Transmission ) | Reflexion | Transmission
 var:  string
        &#39;a&#39;,    # a | f       angle | frequency
 types : string
        &#39;m&#39; | &#39;r&#39; | &#39;d&#39; | &#39;l20&#39;
        mod   rad    deg   dB
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_36_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_36_0.png" />
<p>with respect to angle</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fGHz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">])</span>
<span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_38_1.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_38_1.png" />
<p>wrt to angle and frequency</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">fGHz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">5.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">S</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_40_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_40_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="n">SlabDB</span><span class="p">(</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">)</span>
<span class="n">mat</span>   <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">mat</span>
<span class="n">lmat</span>  <span class="o">=</span> <span class="p">[</span><span class="n">mat</span><span class="p">[</span><span class="s">&#39;AIR&#39;</span><span class="p">],</span><span class="n">mat</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">]]</span>
<span class="n">II</span>    <span class="o">=</span> <span class="n">MatInterface</span><span class="p">(</span><span class="n">lmat</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">II</span><span class="o">.</span><span class="n">RT</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">II</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">kv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">])</span>
<span class="n">tight_layout</span><span class="p">()</span>
<span class="n">air</span> <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="s">&#39;AIR&#39;</span><span class="p">]</span>
<span class="n">brick</span>  <span class="o">=</span> <span class="n">mat</span><span class="p">[</span><span class="s">&#39;BRICK&#39;</span><span class="p">]</span>
<span class="n">II</span>  <span class="o">=</span> <span class="n">MatInterface</span><span class="p">([</span><span class="n">air</span><span class="p">,</span><span class="n">brick</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">II</span><span class="o">.</span><span class="n">RT</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">II</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;m&#39;</span><span class="p">])</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_41_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_41_0.png" />
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_41_1.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_41_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="c">## Adding new materials</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TESS-p50&#39;</span><span class="p">,</span><span class="n">cval</span><span class="o">=</span><span class="mi">3</span><span class="o">+</span><span class="mi">0j</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;epsr&#39;</span><span class="p">)</span>

<span class="n">sl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">,</span><span class="n">lmatname</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;TESS-p50&#39;</span><span class="p">],</span><span class="n">lthick</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">])</span>
<span class="n">sl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">,</span><span class="n">lmatname</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;TESS-p50&#39;</span><span class="p">],</span><span class="n">lthick</span><span class="o">=</span><span class="p">[</span><span class="mf">0.10</span><span class="p">])</span>
<span class="n">sl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">,</span><span class="n">lmatname</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;TESS-p50&#39;</span><span class="p">],</span><span class="n">lthick</span><span class="o">=</span><span class="p">[</span><span class="mf">0.15</span><span class="p">])</span>
<span class="n">fGHz</span><span class="o">=</span><span class="mi">4</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="c">#figure(figsize=(8,8))</span>
<span class="c"># These Tessereau page 50</span>

<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># by default var=&#39;a&#39; and kv = 0</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashdot&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/usr/local/lib/python2.7/dist-packages/matplotlib/axes.py:4747: UserWarning: No labeled objects found. Use label=&#39;...&#39; kwarg on individual plots.
  warnings.warn(&quot;No labeled objects found. &quot;
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_43_1.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_43_1.png" />
</div>
</div>
<div class="section" id="evaluation-without-phase-compensation">
<h2>5.5. Evaluation without phase compensation<a class="headerlink" href="#evaluation-without-phase-compensation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ru&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">ax</span>
<span class="c">#fig,ax = sl[&#39;TESS-p50-10cm&#39;].plotwrt(&#39;f&#39;,coeff=&#39;T&#39;,types=[&#39;ru&#39;],labels=[&#39;&#39;],color=&#39;k&#39;,linestyle=&#39;dashed&#39;,fig=fig,ax=ax)</span>
<span class="c">#fig,ax = sl[&#39;TESS-p50-15cm&#39;].plotwrt(&#39;f&#39;,coeff=&#39;T&#39;,types=[&#39;ru&#39;],labels=[&#39;&#39;],color=&#39;k&#39;,linestyle=&#39;dashdot&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_45_1.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_45_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">compensate</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ru&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;5cm compensated&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ru&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;10cm compensated&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ru&#39;</span><span class="p">],</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;15cm not compensated&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashdot&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-5cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-10cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashed&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;TESS-p50-15cm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">coeff</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;dashdot&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_46_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_46_0.png" />
</div>
<div class="section" id="double-glass-example-from-litterature-1-in-sub-terahertz-d-band-120ghz">
<h2>5.6. Double Glass example from litterature [1] in sub TeraHertz D-band &#64; 120GHz<a class="headerlink" href="#double-glass-example-from-litterature-1-in-sub-terahertz-d-band-120ghz" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;ConcreteJc&#39;</span><span class="p">,</span><span class="n">cval</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span><span class="n">alpha_cmm1</span><span class="o">=</span><span class="mf">1.9</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;THz&#39;</span><span class="p">)</span>
<span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;GlassJc&#39;</span><span class="p">,</span><span class="n">cval</span><span class="o">=</span><span class="mf">2.55</span><span class="p">,</span><span class="n">alpha_cmm1</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;THz&#39;</span><span class="p">)</span>
<span class="n">sl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;ConcreteJc&#39;</span><span class="p">,[</span><span class="s">&#39;ConcreteJc&#39;</span><span class="p">],[</span><span class="mf">0.049</span><span class="p">])</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;ConcreteJc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;ConcreteJc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_48_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_48_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">sl</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">,[</span><span class="s">&#39;GlassJc&#39;</span><span class="p">,</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="s">&#39;GlassJc&#39;</span><span class="p">],[</span><span class="mf">0.0029</span><span class="p">,</span><span class="mf">0.0102</span><span class="p">,</span><span class="mf">0.0029</span><span class="p">])</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_49_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_49_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_50_1.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_50_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;DoubleGlass&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plotwrt</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>  <span class="c"># @20°</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-SlabsMaterials_files/AP-SlabsMaterials_51_0.png" src="./AP-SlabsMaterials_files/AP-SlabsMaterials_51_0.png" />
</div>
<div class="section" id="references">
<h2>5.7. References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1]. <a class="reference external" href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?tp=&amp;arnumber=5505315&amp;queryText%3DReflection+ant+Transmission+Properties+of+Building+Materials+in+D-Band+for+Modeling+Future+mm-Wave+Communication+Systems.QT.+Antennas+and+Propagation">Jacob, M. ; Kurner, T. ; Geise, R. ; Piesiewicz, R. &#8220;Reflection
ant Transmission Properties of Building Materials in D-Band for Modeling
Future mm-Wave Communication Systems&#8221; Antennas and Propagation (EuCAP),
2010 Proceedings of the Fourth European Conference
on</a></p>
<p>[2]. <a class="reference external" href="https://www.google.fr/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CCwQFjAA&amp;url=http%3A%2F%2Fwww-ece.rice.edu%2F~daniel%2Fpapers%2FnormanElecLett.pdf&amp;ei=Tr_eUe6EG-OM0AWA0IAw&amp;usg=AFQjCNHzt9H3RkLAtws51E9EpEgyqh-6LA&amp;sig2=QLZlhoTJtiuHAW5Zzg_xOw&amp;bvm=bv.48705608,d.d2k">R.Piesiewicz &#8216;Terahertz characterization of building materials&#8217;
Electronics .Letters Jan 2005 Vol 41
N°18</a></p>
</div>
</div>
<div class="section" id="the-layout-class">
<h1>6. The Layout class<a class="headerlink" href="#the-layout-class" title="Permalink to this headline">¶</a></h1>
<p>This section explains the main features of the <strong>Layout</strong> class.</p>
<p>A Layout is a representation of a floorplan, it is handled by the module
<strong>pylayers.gis.layout</strong>.</p>
<p>This module recognizes different file formats including geo-referenced
files in open street map format <tt class="docutils literal"><span class="pre">.osm</span></tt>.</p>
<p>Using osm allows to take advantage of a mature floor plan editor <em>JOSM</em>
with the plugin <em>PicLayer</em>. This is well described in
<a class="reference external" href="http://wiki.openstreetmap.org/wiki/IndoorOSM">http://wiki.openstreetmap.org/wiki/IndoorOSM</a></p>
<p>The <tt class="docutils literal"><span class="pre">pylayers.gis.osmparser</span></tt> module parses <tt class="docutils literal"><span class="pre">osm</span></tt> files.</p>
<p>See the following methods of the layout object</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">loadosm()</span></tt></li>
<li><tt class="docutils literal"><span class="pre">saveosm()</span></tt></li>
</ul>
<div class="section" id="structure-of-a-layout">
<h2>6.1. Structure of a Layout<a class="headerlink" href="#structure-of-a-layout" title="Permalink to this headline">¶</a></h2>
<p>A Layout is firstly described by a set of points (negative index) and a
set of segments (positive index).</p>
<p>Both points and segments are nodes of the <img src="../_images/mathmpl/math-8d9bbde6dd.png" style="position: relative; bottom: -7px"/> graph.</p>
<p>It is required to respect a strict non overlapping rule. <strong>No segments
can recover partially or totally an other segment</strong>.</p>
<p>This rule allows to capture topological relations of the network which
are exploited for further analysis.</p>
</div>
<div class="section" id="subsegments">
<h2>6.2. Subsegments<a class="headerlink" href="#subsegments" title="Permalink to this headline">¶</a></h2>
<p>To describe doors and windows, the concept of <tt class="docutils literal"><span class="pre">subsegment</span></tt> is
introduced.</p>
<p>A <tt class="docutils literal"><span class="pre">segment</span></tt> has attributes :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">name</span></tt> : slab name</li>
<li><tt class="docutils literal"><span class="pre">z</span></tt> : tuple of minimum and maximum heights with respect to ground
(meters)</li>
<li><tt class="docutils literal"><span class="pre">transition</span></tt> : a boolean indicating if a human can cross this
segment. For example, segments associated with a door are transition
segments but we will see later that it may be judicious to split
space with transparent segments which have the name &#8216;AIR&#8217;. Those
segments are also <tt class="docutils literal"><span class="pre">transition=True</span></tt></li>
</ul>
<p>A <tt class="docutils literal"><span class="pre">subsegment</span></tt> belongs to a <tt class="docutils literal"><span class="pre">segment</span></tt>, it has mainly 2 attached
parameters :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ss_name</span></tt> : subsegment slab name</li>
<li><tt class="docutils literal"><span class="pre">ss_z</span></tt> : [(zmin1,zmax1),(zmin2,zmax2),...,(zminK,zmaxK))] list of
minimum and maximum heights of associated subsegments (meters)</li>
</ul>
<p>When appearing in a 3D ray a subsegment has a unique index
different from the segment index.</p>
</div>
<div class="section" id="layout-file-formats">
<h2>6.3. Layout file formats<a class="headerlink" href="#layout-file-formats" title="Permalink to this headline">¶</a></h2>
<p>The layout format has regularly evolved over time and is going to evolve
again. Currently, the different recognized file extensions are the
following :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">.str2</span></tt>: a ASCII file (Node list + edge list)</li>
<li><tt class="docutils literal"><span class="pre">.str</span></tt> : a binary file which includes visibility relations between
point and segments</li>
<li><tt class="docutils literal"><span class="pre">.ini</span></tt> : an ini file which gather node list and edge list as well
as the state of the current <tt class="docutils literal"><span class="pre">display</span></tt> dictionnary</li>
<li><tt class="docutils literal"><span class="pre">.osm</span></tt> : an xml file which can be edited with
<a class="reference external" href="http://josm.openstreetmap.de/">JOSM</a></li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-an-exiting-layout">
<h2>6.4. Reading an exiting Layout<a class="headerlink" href="#reading-an-exiting-layout" title="Permalink to this headline">¶</a></h2>
<p>To read an existing layout it is sufficient to create a Layout object
with, as an argument, a file name with one of the recognized extension.
All files are stored in the <tt class="docutils literal"><span class="pre">pstruc['DIRSTRUC']</span></tt> directory of the
project. The project root directory is defined in the <tt class="docutils literal"><span class="pre">$BASENAME</span></tt>
environment variable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">struc</span><span class="o">/</span><span class="nb">str</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">pstruc</span></tt> is a dictionnary which gathers all directories which are used
in <tt class="docutils literal"><span class="pre">PyLayers</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pstruc</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;DIRANT&#39;</span><span class="p">:</span> <span class="s">&#39;ant&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRCIR&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRFUR&#39;</span><span class="p">:</span> <span class="s">&#39;struc/furnitures&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRGEOM&#39;</span><span class="p">:</span> <span class="s">&#39;geom&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRIMAGE&#39;</span><span class="p">:</span> <span class="s">&#39;struc/images&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRINI&#39;</span><span class="p">:</span> <span class="s">&#39;struc/ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRLCH&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRMAT&#39;</span><span class="p">:</span> <span class="s">&#39;ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRMAT2&#39;</span><span class="p">:</span> <span class="s">&#39;ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRMES&#39;</span><span class="p">:</span> <span class="s">&#39;meas&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRNETSAVE&#39;</span><span class="p">:</span> <span class="s">&#39;netsave&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIROSM&#39;</span><span class="p">:</span> <span class="s">&#39;struc/osm&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRPICKLE&#39;</span><span class="p">:</span> <span class="s">&#39;struc/gpickle&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRR2D&#39;</span><span class="p">:</span> <span class="s">&#39;output/r2d&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRR3D&#39;</span><span class="p">:</span> <span class="s">&#39;output/r3d&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSIG&#39;</span><span class="p">:</span> <span class="s">&#39;output/sig&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSIMUL&#39;</span><span class="p">:</span> <span class="s">&#39;ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSLAB&#39;</span><span class="p">:</span> <span class="s">&#39;ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSLAB2&#39;</span><span class="p">:</span> <span class="s">&#39;ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSTRUC&#39;</span><span class="p">:</span> <span class="s">&#39;struc/str&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRSTRUC2&#39;</span><span class="p">:</span> <span class="s">&#39;struc/str&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRTRA&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRTUD&#39;</span><span class="p">:</span> <span class="s">&#39;output&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRTx&#39;</span><span class="p">:</span> <span class="s">&#39;output/Tx001&#39;</span><span class="p">,</span>
 <span class="s">&#39;DIRWRL&#39;</span><span class="p">:</span> <span class="s">&#39;struc/wrl&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The structure of the <tt class="docutils literal"><span class="pre">.osm</span></tt> file is shown below</p>
<div class="highlight-python"><div class="highlight"><pre>%%bash

    cd $BASENAME/struc
    ls *.osm
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DLR</span><span class="o">.</span><span class="n">osm</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>%%bash
    cd $BASENAME/struc
    head DLR.osm
    echo &#39;---&#39;
    tail -17 DLR.osm
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;
&lt;osm version=&#39;0.6&#39; upload=&#39;false&#39; generator=&#39;PyLayers&#39;&gt;
&lt;node id=&#39;-212&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0100855114&#39; lon=&#39;-1.98980710934&#39; /&gt;
&lt;node id=&#39;-210&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0100789151&#39; lon=&#39;-1.9897910381&#39; /&gt;
&lt;node id=&#39;-208&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0100738861&#39; lon=&#39;-1.98977878545&#39; /&gt;
&lt;node id=&#39;-206&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0100616861&#39; lon=&#39;-1.98982814281&#39; /&gt;
&lt;node id=&#39;-204&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0101583649&#39; lon=&#39;-1.98982436917&#39; /&gt;
&lt;node id=&#39;-202&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0101656174&#39; lon=&#39;-1.98981796656&#39; /&gt;
&lt;node id=&#39;-200&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0101843662&#39; lon=&#39;-1.98977935424&#39; /&gt;
&lt;node id=&#39;-198&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;47.0101791636&#39; lon=&#39;-1.98982426816&#39; /&gt;
---
&lt;tag k=&#39;transition&#39; v=&#39;False&#39; /&gt;
&lt;/way&gt;
&lt;way id=&#39;-10000123&#39; action=&#39;modify&#39; visible=&#39;true&#39;&gt;
&lt;nd ref=&#39;-200&#39; /&gt;
&lt;nd ref=&#39;-100&#39; /&gt;
&lt;tag k=&#39;name&#39; v=&#39;WALL&#39; /&gt;
&lt;tag k=&#39;z&#39; v=&quot;(&#39;0.0&#39;, &#39;3.0&#39;)&quot; /&gt;
&lt;tag k=&#39;transition&#39; v=&#39;False&#39; /&gt;
&lt;/way&gt;
&lt;way id=&#39;-10000124&#39; action=&#39;modify&#39; visible=&#39;true&#39;&gt;
&lt;nd ref=&#39;-166&#39; /&gt;
&lt;nd ref=&#39;-188&#39; /&gt;
&lt;tag k=&#39;name&#39; v=&#39;WALL&#39; /&gt;
&lt;tag k=&#39;z&#39; v=&quot;(&#39;0.0&#39;, &#39;3.0&#39;)&quot; /&gt;
&lt;tag k=&#39;transition&#39; v=&#39;False&#39; /&gt;
&lt;/way&gt;
&lt;/osm&gt;
</pre></div>
</div>
<p>To read a new layout in osm format :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="s">&#39;DLR.osm&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_20_0.png" src="./GIS-editor_files/GIS-editor_20_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>filestr :  DLR.osm
filematini :  matDB.ini
fileslabini :  slabDB.ini
filegeom :  DLR.off
boundaries  (758.35005883924691, 794.77088532257221, 1111.8980005947324, 1138.9865273726507)
number of Points : 105
number of Segments : 124
number of Sub-Segments : 30
Gs Nodes :  229
Gs Edges :  248
Gt Nodes :  0
Gt Edges :  0
vnodes = Gt.node[Nc][&#39;cycles&#39;].cycle
poly = Gt.node[Nc][&#39;cycle&#39;].polyg
Gr Nodes    : 0
Gr Edges    : 0
Nc  = Gr.node[nroom][&#39;cycles&#39;]
</pre></div>
</div>
<p>The different graphs associated with the layout are then built</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>The topological graph <img src="../_images/mathmpl/math-3604bc74d1.png" style="position: relative; bottom: -7px"/> or graph of non overlapping
cycles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_25_0.png" src="./GIS-editor_files/GIS-editor_25_0.png" />
<p>The graph of room <img src="../_images/mathmpl/math-ba7f66fdf0.png" style="position: relative; bottom: -7px"/>. Two rooms which share at least
a wall are connected. Two rooms which share only a corner (punctual
connection) are not connected</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_27_0.png" src="./GIS-editor_files/GIS-editor_27_0.png" />
<p>The graph of waypath <img src="../_images/mathmpl/math-4c02c53444.png" style="position: relative; bottom: -7px"/>. This graph is used for agent
mobility. This allows to determine the shortest path between 2 rooms.
This information could be included in the osm file. This is not the case
yet</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_29_0.png" src="./GIS-editor_files/GIS-editor_29_0.png" />
<p>The graph of visibility <img src="../_images/mathmpl/math-d3189f9945.png" style="position: relative; bottom: -13px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_31_0.png" src="./GIS-editor_files/GIS-editor_31_0.png" />
<p>The graph of interactions <img src="../_images/mathmpl/math-4c79050f98.png" style="position: relative; bottom: -7px"/> used to determine the
ray signatures.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_33_0.png" src="./GIS-editor_files/GIS-editor_33_0.png" />
</div>
<div class="section" id="the-display-options-dictionnary">
<h2>6.5. The display options dictionnary<a class="headerlink" href="#the-display-options-dictionnary" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>filestr :  DLR.osm
filematini :  matDB.ini
fileslabini :  slabDB.ini
filegeom :  DLR.off
boundaries  (758.35005883924691, 794.77088532257221, 1111.8980005947324, 1138.9865273726507)
number of Points : 105
number of Segments : 124
number of Sub-Segments : 30
Gs Nodes :  229
Gs Edges :  248
Gt Nodes :  20
Gt Edges :  48
vnodes = Gt.node[Nc][&#39;cycles&#39;].cycle
poly = Gt.node[Nc][&#39;cycle&#39;].polyg
Gr Nodes    : 16
Gr Edges    : 16
Nc  = Gr.node[nroom][&#39;cycles&#39;]
</pre></div>
</div>
<p>The layout can be displayed using matplotlib ploting primitive. Several
display options are specified in the display dictionnary. Those options
are exploited in <tt class="docutils literal"><span class="pre">showGs()</span></tt> vizualisation method.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">display</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;activelayer&#39;</span><span class="p">:</span> <span class="s">&#39;WINDOW_GLASS&#39;</span><span class="p">,</span>
 <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
 <span class="s">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
 <span class="s">&#39;clear&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&#39;edlabel&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;edlblsize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
 <span class="s">&#39;ednodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;fileoverlay&#39;</span><span class="p">:</span> <span class="s">&#39;TA-Office.png&#39;</span><span class="p">,</span>
 <span class="s">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
 <span class="s">&#39;inverse&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;layer&#39;</span><span class="p">:</span> <span class="p">[],</span>
 <span class="s">&#39;layers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;WALL&#39;</span><span class="p">,</span> <span class="s">&#39;PARTITION&#39;</span><span class="p">,</span> <span class="s">&#39;AIR&#39;</span><span class="p">,</span> <span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">],</span>
 <span class="s">&#39;layerset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;WINDOW_GLASS&#39;</span><span class="p">,</span>
  <span class="s">&#39;PLASTERBOARD_7CM&#39;</span><span class="p">,</span>
  <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;AIR&#39;</span><span class="p">,</span>
  <span class="s">&#39;WINDOW&#39;</span><span class="p">,</span>
  <span class="s">&#39;METALIC&#39;</span><span class="p">,</span>
  <span class="s">&#39;PLASTERBOARD_14CM&#39;</span><span class="p">,</span>
  <span class="s">&#39;DOOR&#39;</span><span class="p">,</span>
  <span class="s">&#39;FLOOR&#39;</span><span class="p">,</span>
  <span class="s">&#39;METAL&#39;</span><span class="p">,</span>
  <span class="s">&#39;PARTITION&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCRETE_20CM3D&#39;</span><span class="p">,</span>
  <span class="s">&#39;PLASTERBOARD_10CM&#39;</span><span class="p">,</span>
  <span class="s">&#39;CEIL&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCRETE_6CM3D&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCRETE_15CM3D&#39;</span><span class="p">,</span>
  <span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">,</span>
  <span class="s">&#39;WALLS&#39;</span><span class="p">,</span>
  <span class="s">&#39;WOOD&#39;</span><span class="p">,</span>
  <span class="s">&#39;CONCRETE_7CM3D&#39;</span><span class="p">,</span>
  <span class="s">&#39;PILLAR&#39;</span><span class="p">,</span>
  <span class="s">&#39;ABSORBENT&#39;</span><span class="p">],</span>
 <span class="s">&#39;ndlabel&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;ndlblsize&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
 <span class="s">&#39;ndsize&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;overlay&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;scaled&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&#39;subseg&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&#39;thin&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
 <span class="s">&#39;ticksoff&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
 <span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="s">&#39;visu&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="interactive-editor">
<h2>6.6. Interactive editor<a class="headerlink" href="#interactive-editor" title="Permalink to this headline">¶</a></h2>
<p>The command <cite>L.editor()</cite> launches a simple Layout interactive editor.
The state machine is implemented in module <tt class="docutils literal"><span class="pre">pylayers.gis.selectl.py</span></tt>.</p>
<p>To have an idea of all available options, look in the
<tt class="docutils literal"><span class="pre">`pylayers.gis.SelectL</span></tt> &lt;<a class="reference external" href="http://pylayers.github.io/pylayers/_modules/pylayers/gis/selectl.html#SelectL.new_state">http://pylayers.github.io/pylayers/_modules/pylayers/gis/selectl.html#SelectL.new_state</a>&gt;`__
module</p>
<p>All ergonomic improvement of this editor is welcome.
Just pull request your modifications.</p>
<p>PyLayers comes along with a low level structure editor based on
<tt class="docutils literal"><span class="pre">matplotlib</span></tt> which can be invoqued using the <tt class="docutils literal"><span class="pre">editor()</span></tt> method. This
editor is more suited for modyfing constitutive properties of walls.</p>
<p>An alternative editing solution is to use the open street map editor <tt class="docutils literal"><span class="pre">JOSM</span></tt></p>
<p>There are two different modes of edition</p>
<ul class="simple">
<li>A create points mode CP<ul>
<li>left clic : free point</li>
<li>right clic : same x point</li>
<li>center clic : same y point</li>
</ul>
</li>
<li>A create segments mode<ul>
<li>left clic : select point 1</li>
<li>left clic : select point 2</li>
<li>left clic : create a segment between point 1 and point 2</li>
</ul>
</li>
</ul>
<p><strong>m</strong> : to switch from one mode to an other</p>
<p><strong>i</strong> : to return to init state</p>
<div class="section" id="image-overlay">
<h3>6.6.1. Image overlay<a class="headerlink" href="#image-overlay" title="Permalink to this headline">¶</a></h3>
<p>It is useful while editing a layout to have an overlay of an image in
order to help placing points. The image overlay can either be an url or
a filename. In that case the file is stored in</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">=</span><span class="n">Layout</span><span class="p">()</span>
<span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;http://images.wikia.com/theoffice/images/9/9e/Layout.jpg&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
<span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
<span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ticksoff&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;inverse&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./GIS-editor_files/GIS-editor_53_1.png" src="./GIS-editor_files/GIS-editor_53_1.png" />
</div>
<div class="section" id="scaling-the-figure-overlay">
<h3>6.6.2. Scaling the figure overlay<a class="headerlink" href="#scaling-the-figure-overlay" title="Permalink to this headline">¶</a></h3>
<p>Before going further it is necessary :</p>
<ul class="simple">
<li>to place the global origin</li>
<li>to precise the vertical and horizontal scale of the image</li>
</ul>
<p>This is done by the following commands :</p>
<ul class="simple">
<li>&#8216;i&#8217; : back to init state</li>
<li>&#8216;m&#8217; : goes to CP state</li>
<li>&#8216;o&#8217; : define the origin</li>
<li>&#8216;left click&#8217; on the point of the figure chasen as the origin</li>
<li>&#8216;left click&#8217; on a point at a known distance from the origin along x
axis. Fill the dialog box with the actual distance (expressed in
meters) between the two points.</li>
<li>&#8216;left click&#8217; on a point at a known distance from the origin along y
axis. Fill the dialog box with the actual distance (expressed in
meters) between the two points.</li>
</ul>
<p>In that sequence of operation it is useful to rescale the figure with
&#8216;r&#8217;.</p>
<p>At that stage, it is possible to start creating points</p>
<div class="highlight-python"><div class="highlight"><pre>&#39;b&#39;  : selct a segment
&#39;l&#39;  : select activelayer
&#39;i&#39;  : back to init state
&#39;e&#39;  : edit segment
&#39;t&#39;  : translate  structure
&#39;h&#39;  : add subsegment
&#39;d&#39;  : delete subsegment
&#39;r&#39;  : refresh
&#39;o&#39;  : toggle overlay
&#39;m&#39;  : toggle mode (point or segment)
&#39;z&#39;  : change display parameters
&#39;q&#39;  : quit interactive mode
&#39;x&#39;  : save .str2 file
&#39;w&#39;  : display all layers
</pre></div>
</div>
</div>
<div class="section" id="visualisation-of-the-layout">
<h3>6.6.3. Visualisation of the layout<a class="headerlink" href="#visualisation-of-the-layout" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="s">&#39;TA-Office.ini&#39;</span><span class="p">)</span>
<span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">font_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="./GIS-editor_files/GIS-editor_59_0.png"><img alt="./GIS-editor_files/GIS-editor_59_0.png" src="./GIS-editor_files/GIS-editor_59_0.png" /></a>
<p>Each node of <img src="../_images/mathmpl/math-8d9bbde6dd.png" style="position: relative; bottom: -7px"/> with a negative index is a point.</p>
<p>Each node of <img src="../_images/mathmpl/math-8d9bbde6dd.png" style="position: relative; bottom: -7px"/> with a positive index corresponds to
a segment (wall,door,window,...).</p>
<p>The segment name is the key of the <strong>slab</strong> dictionnary.</p>
<p><a class="reference external" href="MultiSubsegments.ipynb">Multi Subsegments</a></p>
</div>
<div class="section" id="segment-and-sub-segments">
<h3>6.6.4. Segment and sub-segments<a class="headerlink" href="#segment-and-sub-segments" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.waveform</span> <span class="kn">as</span> <span class="nn">wvf</span>
<span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="n">filestr</span> <span class="o">=</span> <span class="s">&#39;defstr3&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">filestr</span><span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">,</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The studied configuration is composed of a simple 2 rooms building
separated by a subsegment which has a multi subsegment attribute. The
attribute of the subsegment can be changed with the method <tt class="docutils literal"><span class="pre">chgmss</span></tt>
(change multisubsegment)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">chgmss</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ss_name</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">,</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="s">&#39;WOOD&#39;</span><span class="p">],</span><span class="n">ss_z</span> <span class="o">=</span><span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.7</span><span class="p">),(</span><span class="mf">2.7</span><span class="p">,</span><span class="mf">2.8</span><span class="p">),(</span><span class="mf">2.8</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>structure saved in  defstr3.str2
structure saved in  defstr3.ini
</pre></div>
</div>
<p>The <img src="../_images/mathmpl/math-8d9bbde6dd.png" style="position: relative; bottom: -7px"/> graph dictionnary has the following structure</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">7</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">5</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">{},</span>
 <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;PARTITION&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.999982</span>  <span class="p">,</span> <span class="o">-</span><span class="mf">0.00599989</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;ss_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">,</span> <span class="s">&#39;AIR&#39;</span><span class="p">,</span> <span class="s">&#39;WOOD&#39;</span><span class="p">],</span>
  <span class="s">&#39;ss_z&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997778</span><span class="p">,</span>  <span class="mf">0.00666652</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.99997775</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00667097</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997888</span><span class="p">,</span>  <span class="mf">0.00649986</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.00619988</span><span class="p">,</span>  <span class="mf">0.99998078</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.00639987</span><span class="p">,</span>  <span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">7</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997887</span><span class="p">,</span>  <span class="mf">0.00650149</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.00639987</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">9</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.00639987</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)}}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>default.ini
------------------------------------------
Layout Info :
filestr :  defstr3.ini
filematini :  matDB.ini
fileslabini :  slabDB.ini
filegeom :  defstr3.off
boundaries  (758.49, 768.516, 1111.9, 1115.963)
number of Points : 8
number of Segments : 9
number of Sub-Segments : 3
Gs Nodes :  17
Gs Edges :  18
Gt Nodes :  2
Gt Edges :  1
vnodes = Gt.node[Nc][&#39;cycles&#39;].cycle
poly = Gt.node[Nc][&#39;cycle&#39;].polyg
Gr Nodes    : 2
Gr Edges    : 1
Nc  = Gr.node[nroom][&#39;cycles&#39;]
None
Tx Info :
npos       :  2
position   :  [[  0.     19.52 ]
 [  0.     -0.69 ]
 [  0.      1.446]]
name       :
type       :  tx
fileini    :  radiotx.ini
filespa    :  radiotx.spa
filegeom   :  radiotx.vect
fileant    :  defant.vsh3
filestr    :  defstr.str2
None
Rx Info :
npos       :  350
position   :  [[  0.      0.1     0.2   ...,  28.9    28.9    28.9  ]
 [  0.      0.      0.    ...,   5.7     5.8     5.9  ]
 [  1.275   1.275   1.275 ...,   1.275   1.275   1.275]]
name       :
type       :  rx
fileini    :  radiorx.ini
filespa    :  radiorx.spa
filegeom   :  radiorx.vect
fileant    :  defant.vsh3
filestr    :  defstr.str2
None
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c">#</span>
<span class="n">tx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">759</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">rx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">767</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="c">#</span>
<span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
<span class="c"># getting cycles from tx</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="c"># getting cycles from rx</span>
<span class="n">crx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_9_1.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_9_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(</span><span class="n">fcGHz</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">bandGHz</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_10_0.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_10_0.png" />
<p>The different steps are :</p>
<ul class="simple">
<li>determine the signatures</li>
<li>determine the 2d rays</li>
<li>determine the 3d rays</li>
<li>determine local basis on 3D rays</li>
<li>fill interactions</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
<span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
<span class="n">r3d</span> <span class="o">=</span> <span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="channel-variability-due-to-different-layout-constitutive-materials">
<h2>6.7. Channel variability due to different <tt class="docutils literal"><span class="pre">Layout</span></tt> constitutive materials<a class="headerlink" href="#channel-variability-due-to-different-layout-constitutive-materials" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Rays3D
----------
1 / 1 : [0]
2 / 6 : [1 2 3 4 5 6]
3 / 18 : [ 7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24]
4 / 38 : [25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49
 50 51 52 53 54 55 56 57 58 59 60 61 62]
5 / 59 : [ 63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80
  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98
  99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116
 117 118 119 120 121]
6 / 80 : [122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139
 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175
 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193
 194 195 196 197 198 199 200 201]
7 / 74 : [202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219
 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237
 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255
 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273
 274 275]
8 / 44 : [276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293
 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311
 312 313 314 315 316 317 318 319]
-----
ni : 1864
nl : 4048
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="s">&#39;AIR&#39;</span><span class="p">]</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">chgmss</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ss_name</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layer</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
<span class="c"># graph to numpy</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Cair</span> <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
<span class="n">scair</span> <span class="o">=</span> <span class="n">Cair</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">cirair</span> <span class="o">=</span> <span class="n">scair</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
<span class="c">#cirair = evcir(r3d,wav)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">cirair</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span><span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_16_1.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_16_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="nb">type</span><span class="p">(</span><span class="n">cirair</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pylayers</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">bsignal</span><span class="o">.</span><span class="n">Usignal</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PARTITION&#39;</span><span class="p">,</span><span class="s">&#39;PARTITION&#39;</span><span class="p">,</span><span class="s">&#39;PARTITION&#39;</span><span class="p">]</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">chgmss</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ss_name</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layer</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
<span class="c"># graph to numpy</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Cwood</span><span class="o">=</span><span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
<span class="n">scwood</span><span class="o">=</span><span class="n">Cwood</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">cirwood</span> <span class="o">=</span> <span class="n">scwood</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
<span class="n">cirwood</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span><span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x7fe8029fb310&gt;
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_18_1.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_18_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;METAL&#39;</span><span class="p">,</span><span class="s">&#39;METAL&#39;</span><span class="p">,</span><span class="s">&#39;METAL&#39;</span><span class="p">]</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">chgmss</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ss_name</span><span class="o">=</span><span class="n">layer</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">layer</span>
<span class="c"># graph to numpy</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">append</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Cmetal</span><span class="o">=</span><span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
<span class="n">scmetal</span><span class="o">=</span><span class="n">Cmetal</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">cirmetal</span> <span class="o">=</span> <span class="n">scmetal</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
<span class="n">cirmetal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">],</span><span class="n">xmin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_19_0.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_19_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="c">#fig2=plt.figure()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">cirair</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;A simple illustration of shadowing effect&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;air&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">cirwood</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;wood&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">cirmetal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;metal&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_20_1.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_20_1.png" />
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_20_2.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_20_2.png" />
<img alt="./GIS-multisubsegments_files/GIS-multisubsegments_20_3.png" src="./GIS-multisubsegments_files/GIS-multisubsegments_20_3.png" />
</div>
</div>
<div class="section" id="electromagnetic-simulation">
<h1>7. Electromagnetic Simulation<a class="headerlink" href="#electromagnetic-simulation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mutliwall-model">
<h2>7.1. Mutliwall Model<a class="headerlink" href="#mutliwall-model" title="Permalink to this headline">¶</a></h2>
<p>The multiwall model is an adaptation of the Motley Keenan model. It determines the LOS attenuation between Tx and Rx in adding to the free space attenuation, the aggregated losses in crossed walls takinig into account :</p>
<blockquote>
<div><ul class="simple">
<li>incidence angle</li>
<li>frequency,</li>
<li>polarisation</li>
<li>constitutive properties of slabs.</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.util.utilnet</span> <span class="kn">import</span> <span class="n">str2bool</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.multiwall</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.coverage</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.network.model</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>The layout is loaded from an <cite>ini</cite> file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="s">&#39;TA-Office.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The 2 extremities of the radio link are coordinates in <tt class="docutils literal"><span class="pre">numpy.array</span></tt>
of transmitter and receiver. <cite>A</cite> and  <cite>B</cite> are radionodes at the two
termination of the radio link.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="c"># defining transmitter position</span>
<span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span> <span class="c"># defining receiver position</span>
</pre></div>
</div>
<p>The scene is plotted with the <tt class="docutils literal"><span class="pre">showG</span></tt> method of the Layout.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># figure instanciation</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
<span class="c"># plotting the Layout</span>
<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">graph</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c"># plotting the Tx and Rx</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;ob&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
<span class="c"># plotting the LOS</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">r</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-multiwallmodel_files/AP-multiwallmodel_9_0.png" src="./AP-multiwallmodel_files/AP-multiwallmodel_9_0.png" />
<p>The function <tt class="docutils literal"><span class="pre">angleonlink</span></tt> returns the list of intersected segments
and the corresponding incidence angles (in radians) with respect to the
segment normal.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">data</span><span class="o">=</span><span class="n">L</span><span class="o">.</span><span class="n">angleonlink</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="computing-the-multi-wall-model">
<h3>7.1.1. Computing the Multi-wall model<a class="headerlink" href="#computing-the-multi-wall-model" title="Permalink to this headline">¶</a></h3>
<p>The multi-wall model computation returns losses and LOS excess delay for
orthogonal and parallel polarization</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="mf">2.4</span>
<span class="c"># observation grid</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">B</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>

<span class="n">Lwo</span><span class="p">,</span><span class="n">Lwp</span><span class="p">,</span><span class="n">Edo</span><span class="p">,</span><span class="n">Edp</span> <span class="o">=</span> <span class="n">Losst</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;Losses orthogonal polarization </span><span class="se">\t</span><span class="s"> </span><span class="si">%g</span><span class="s"> dB&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Lwo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;Losses parallel polarization </span><span class="se">\t</span><span class="s"> </span><span class="si">%g</span><span class="s">  dB&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Lwp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;Excess delay orthogonal polarization  </span><span class="se">\t</span><span class="s"> </span><span class="si">%g</span><span class="s"> ns&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Edo</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="s">&#39;Excess delay parallel polarization   </span><span class="se">\t</span><span class="s"> </span><span class="si">%g</span><span class="s"> ns&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">Edp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Losses orthogonal polarization       27.7333 dB
Losses parallel polarization         16.0573  dB
Excess delay orthogonal polarization         2.23113 ns
Excess delay parallel polarization           2.12364 ns
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-coverage-class">
<h2>7.2. The Coverage class<a class="headerlink" href="#the-coverage-class" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it might be useful to get a fast estimate about losses in
a given indoor environment. Ray tracing is generally time consuming
and depending on the purpose of the study it could be relevant to
proceed with a simpler approach while staying site-specific.
<tt class="docutils literal"><span class="pre">PyLayers</span></tt> provides such a tool which heavily relies on the core
module <tt class="docutils literal"><span class="pre">slab.py</span></tt></p>
<p>The multi-wall model can also be used to perform a full
coverage of a Layout given a transmitter position.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">L</span>  <span class="o">=</span> <span class="n">L</span> <span class="c"># set layout</span>
<span class="n">C</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">A</span> <span class="c"># set the transmitter</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">creategrid</span><span class="p">()</span>
</pre></div>
</div>
<p>The coverage is performed on grid. The boundaries can be specified in
the coverage.ini file</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">grid</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span>  <span class="mf">1.00000000e-02</span><span class="p">,</span>   <span class="mf">1.00000000e-02</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">1.00000000e-02</span><span class="p">,</span>   <span class="mf">3.94102564e-01</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">1.00000000e-02</span><span class="p">,</span>   <span class="mf">7.78205128e-01</span><span class="p">],</span>
       <span class="o">...</span><span class="p">,</span>
       <span class="p">[</span>  <span class="mf">3.99900000e+01</span><span class="p">,</span>   <span class="mf">1.42217949e+01</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">3.99900000e+01</span><span class="p">,</span>   <span class="mf">1.46058974e+01</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">3.99900000e+01</span><span class="p">,</span>   <span class="mf">1.49900000e+01</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t1</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
<span class="n">t2</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;Coverage performed in &#39;</span><span class="p">,</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">,</span> <span class="s">&#39;s&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Coverage performed in  1.34146499634 s

For Orthogonal polarization
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig1</span><span class="p">)</span>

<span class="n">fig2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">C</span><span class="o">.</span><span class="n">showEd</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-multiwallmodel_files/AP-multiwallmodel_26_0.png" src="./AP-multiwallmodel_files/AP-multiwallmodel_26_0.png" />
<img alt="./AP-multiwallmodel_files/AP-multiwallmodel_26_1.png" src="./AP-multiwallmodel_files/AP-multiwallmodel_26_1.png" />
<p>For parallel polarization</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig1</span><span class="p">)</span>

<span class="n">fig2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">C</span><span class="o">.</span><span class="n">showEd</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig2</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-multiwallmodel_files/AP-multiwallmodel_28_0.png" src="./AP-multiwallmodel_files/AP-multiwallmodel_28_0.png" />
<img alt="./AP-multiwallmodel_files/AP-multiwallmodel_28_1.png" src="./AP-multiwallmodel_files/AP-multiwallmodel_28_1.png" />
<p>First let&#8217;s import the <tt class="docutils literal"><span class="pre">coverage</span></tt> module</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.coverage</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
<p>Instantiate a coverage object. By defaut, <tt class="docutils literal"><span class="pre">TA-Office.str</span></tt> layout
strucure is loaded.</p>
<p>This information can be modified in the <strong>coverage.ini</strong> file in the
project directory.</p>
<p>Below is an example of how the content of the file looks like</p>
<div class="highlight-python"><div class="highlight"><pre>!cat $BASENAME/ini/coverage.ini
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[pl_model]
sigrss = 3.0
fGHz = 3.0
rssnp = 2.64
d0 = 1.0


[grid]
nx = 80
ny = 40
boundary = [20,0,30,20]
full = True

[layout]
filename = TA-Office.ini
;filename = W2PTIN.ini
;filename = Lstruc.str

[tx]
fGHz = 3.0
x = 25
y = 5
;transmitted power (dBm)
ptdbm = 0
; frame length in bytes
framelengthbytes = 50000

[rx]
sensitivity  = -80
bandwidthmhz = 3
temperaturek = 300
noisefactordb = 13

[show]
show = True
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Create a Coverage object from coverag.ini file</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">()</span>
</pre></div>
</div>
<p>The coverage object has a <tt class="docutils literal"><span class="pre">__repr__</span></tt> which summarizes the different
parameters of the current coverage object</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Layout file : TA-Office.ini

-----Tx------
tx (coord) : [25  5]
fghz : 3.0
Pt (dBm) : 0

-----Rx------
rxsens (dBm) : -80
bandwith (Mhz) : 3
temperature (K) : 300
noisefactor (dB) : 13

--- Grid ----
nx : 80
ny : 40
full grid : True
boundary (xmin,ymin,xmax,ymax) : [20, 0, 30, 20]

---- PL Model------
plm : {&#39;fghz&#39;: &#39;3.0&#39;, &#39;rssnp&#39;: &#39;2.64&#39;, &#39;d0&#39;: &#39;1.0&#39;, &#39;sigrss&#39;: &#39;3.0&#39;}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># evaluate coverage</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
</pre></div>
</div>
<p>Calculating Received Power Coverage</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">C</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">C</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./AP-coverage_files/AP-coverage_11_1.png" src="./AP-coverage_files/AP-coverage_11_1.png" />
<p>The coverage calculation is launched by calling the <tt class="docutils literal"><span class="pre">cover()</span></tt>
method</p>
<p>The shadowing map coverage results can be displayed by invoquing various
functions.</p>
<ul class="simple">
<li>showLoss : display the path loss</li>
<li>showPower : display the received powercover</li>
</ul>
<p>The following examples represent the estimated received power for 3
different frequencies</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="mf">0.400</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">toc</span> <span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;Elapsed time : {0:.2f} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-coverage_files/AP-coverage_15_1.png" src="./AP-coverage_files/AP-coverage_15_1.png" />
<div class="highlight-python"><div class="highlight"><pre>Elapsed time : 1.07 seconds
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="mf">2.4</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">toc</span> <span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;Elapsed time : {0:.2f} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-coverage_files/AP-coverage_16_0.png" src="./AP-coverage_files/AP-coverage_16_0.png" />
<div class="highlight-python"><div class="highlight"><pre>Elapsed time : 1.07 seconds
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="mf">2.4</span>
<span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">toc</span> <span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&#39;Elapsed time : {0:.2f} seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-coverage_files/AP-coverage_17_0.png" src="./AP-coverage_files/AP-coverage_17_0.png" />
<div class="highlight-python"><div class="highlight"><pre>Elapsed time : 1.07 seconds
</pre></div>
</div>
<p>The transmitter coordinates are :</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">tx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span><span class="mi">25</span><span class="p">,</span>  <span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>This can be modified on the flight, and the coverage is updated accordingly</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="mi">100</span>
<span class="n">C</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">21</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="o">%</span><span class="n">timeit</span>
<span class="n">C</span><span class="o">.</span><span class="n">cover</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">C</span><span class="o">.</span><span class="n">showPower</span><span class="p">(</span><span class="n">polar</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./AP-coverage_files/AP-coverage_21_0.png" src="./AP-coverage_files/AP-coverage_21_0.png" />
<img alt="./AP-coverage_files/AP-coverage_21_1.png" src="./AP-coverage_files/AP-coverage_21_1.png" />
<p>The excess delay due to crossing the wall can also be evaluted.</p>
</div>
<div class="section" id="ray-signatures">
<h2>7.3. Ray Signatures<a class="headerlink" href="#ray-signatures" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="s">&#39;defstr.ini&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>
</pre></div>
</div>
<p>Showing the graph of rooms with 2 rooms separated by a DOOR segment</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-signatures_files/AP-signatures_4_0.png" src="./AP-signatures_files/AP-signatures_4_0.png" />
<p>The graph of interactions is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">a</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./AP-signatures_files/AP-signatures_6_0.png" src="./AP-signatures_files/AP-signatures_6_0.png" />
<p>All the interactions of a given cycle are stored as meta information in
nodes of <tt class="docutils literal"><span class="pre">Gt</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;inter&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;(3, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(4, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(7, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(7, 0, 1)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(7, 1, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(9, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(9, 0, 1)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(9, 1, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(8, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(8, 0, 1)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(8, 1, 0)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(2, 0)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>The signature is calculated with as parameters the Layout object and two
cycle numbers. In example below it is 0 and 1.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The cold start determination of the signature is done with a <tt class="docutils literal"><span class="pre">run</span></tt>
function. The code is not in its final shape here and there is room for
significant acceleration in incorporating propagation based heuristics.
The mitigation of graph exploration depth is done in setting a
<tt class="docutils literal"><span class="pre">cutoff</span></tt> value which limits the exploration in the interaction graph.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The representation method of a signature gives varous informations about
the different signatures. Signatures are grouped by number of
interactions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">)}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ptx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">prx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="k">print</span> <span class="n">ptx</span>
<span class="k">print</span> <span class="n">prx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 8.35174751  0.30020702]
[ 3.43281369  0.44106546]
</pre></div>
</div>
</div>
<div class="section" id="synthesis-of-ultra-wide-band-waveforms">
<h2>7.4. Synthesis of Ultra Wide Band Waveforms<a class="headerlink" href="#synthesis-of-ultra-wide-band-waveforms" title="Permalink to this headline">¶</a></h2>
<p>Once the propagation channel has been evaluated. This is done in the
<tt class="docutils literal"><span class="pre">pylayers.antprop.channel</span></tt> module. The received signal is evaluated in
applying a convolution product of each ray tranfer function with a
specific IR-UWB waveform. The necessary modules are</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pylayers.signal.bsignal</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">pylayers.signal.waveform</span></tt></li>
<li><tt class="docutils literal"><span class="pre">pylayers.signal.channel</span></tt></li>
</ul>
<p>The module <tt class="docutils literal"><span class="pre">pylayers.simul.simulem</span></tt> is for definition of
electromagnetic simulation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.signal.waveform</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>Generation of a pulse of normalized energy</p>
<p>One possible manner to define an energy normalized short UWB pulse is
as follows using <tt class="docutils literal"><span class="pre">bsignal.EnImpulse</span></tt> function.</p>
<p>The default waveform is a gaussian windowing of a sine wave of frequency
<img src="../_images/mathmpl/math-e5c4897d65.png" style="position: relative; bottom: -7px"/>. The normalization term depends on the exponential scaling
factor <img src="../_images/mathmpl/math-f970af607c.png" style="position: relative; bottom: -3px"/>.</p>
<p><img src="../_images/mathmpl/math-37b287b3bf.png" style="position: relative; bottom: -12px"/></p>
<p><img src="../_images/mathmpl/math-a1202c7aca.png" style="position: relative; bottom: -11px"/></p>
<p>where <img src="../_images/mathmpl/math-957afab571.png" style="position: relative; bottom: -3px"/> is the desired bandwidth defined at <img src="../_images/mathmpl/math-7b431e1910.png" style="position: relative; bottom: -7px"/>
below the spectrum maximum and <img src="../_images/mathmpl/math-e5c4897d65.png" style="position: relative; bottom: -7px"/> is the central frequency of
the pulse.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fc</span>     <span class="o">=</span> <span class="mi">4</span>
<span class="n">band</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">fe</span>     <span class="o">=</span> <span class="mi">100</span>
<span class="n">ip</span>     <span class="o">=</span> <span class="n">EnImpulse</span><span class="p">([],</span><span class="n">fc</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">thresh</span><span class="p">,</span><span class="n">fe</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ip</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>TUsignal
--------
shx :  (343,)
shy :  (343,)
dx :   0.01
xmin : -1.71
xmax : 1.71
ymin : -1.89545539648
ymax : 2.16154131873
</pre></div>
</div>
<p>Verification of energy normalization in both domains</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">E1</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">ip</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">ip</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Integration in time&quot;</span><span class="p">,</span><span class="n">E1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Integration in time 1.0
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">P</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">esd</span><span class="p">()</span>
<span class="n">E2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Integration in frequency domain &quot;</span><span class="p">,</span><span class="n">E2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Integration in frequency domain  1.0
</pre></div>
</div>
<div class="section" id="calculation-of-uwb-channel-impulse-response">
<h3>7.4.1. Calculation of UWB channel impulse response<a class="headerlink" href="#calculation-of-uwb-channel-impulse-response" title="Permalink to this headline">¶</a></h3>
<p>We choose to load a simple floor plan.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="s">&#39;defstr3.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A simulation object has an <tt class="docutils literal"><span class="pre">info</span></tt> method providing a summary of
simulation informations.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>default.ini
------------------------------------------
Layout Info :
filestr :  defstr3.ini
filematini :  matDB.ini
fileslabini :  slabDB.ini
filegeom :  defstr3.off
boundaries  (758.49, 768.516, 1111.9, 1115.963)
number of Points : 8
number of Segments : 9
number of Sub-Segments : 3
Gs Nodes :  17
Gs Edges :  18
Gt Nodes :  0
Gt Edges :  0
vnodes = Gt.node[Nc][&#39;cycles&#39;].cycle
poly = Gt.node[Nc][&#39;cycle&#39;].polyg
Gr Nodes    : 0
Gr Edges    : 0
Nc  = Gr.node[nroom][&#39;cycles&#39;]
None
Tx Info :
npos       :  1
position   :  [[  7.59000000e+02]
 [  1.11400000e+03]
 [  1.00000000e+00]]
name       :
type       :  tx
fileini    :  radiotx.ini
filespa    :  radiotx.spa
filegeom   :  radiotx.off
fileant    :  defant.vsh3
filestr    :  defstr.str2
None
Rx Info :
npos       :  1
position   :  [[  767. ]
 [ 1114. ]
 [    1.5]]
name       :
type       :  rx
fileini    :  radiorx.ini
filespa    :  radiorx.spa
filegeom   :  radiorx.off
fileant    :  defant.vsh3
filestr    :  defstr.str2
None
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">7</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">5</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">4</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">3</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">2</span><span class="p">:</span> <span class="p">{},</span>
 <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="p">{},</span>
 <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;PARTITION&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.999982</span>  <span class="p">,</span> <span class="o">-</span><span class="mf">0.00599989</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;ss_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;WOOD&#39;</span><span class="p">,</span> <span class="s">&#39;AIR&#39;</span><span class="p">,</span> <span class="s">&#39;WOOD&#39;</span><span class="p">],</span>
  <span class="s">&#39;ss_z&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.7</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997778</span><span class="p">,</span>  <span class="mf">0.00666652</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.99997775</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00667097</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997888</span><span class="p">,</span>  <span class="mf">0.00649986</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.00619988</span><span class="p">,</span>  <span class="mf">0.99998078</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">6</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.00639987</span><span class="p">,</span>  <span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">7</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.99997887</span><span class="p">,</span>  <span class="mf">0.00650149</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">8</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">0.00639987</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)},</span>
 <span class="mi">9</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;connect&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;WALL&#39;</span><span class="p">,</span>
  <span class="s">&#39;ncycles&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
  <span class="s">&#39;norm&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.00639987</span><span class="p">,</span>  <span class="mf">0.99997952</span><span class="p">,</span>  <span class="mf">0.</span>        <span class="p">]),</span>
  <span class="s">&#39;transition&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
  <span class="s">&#39;z&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)}}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">st</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sf</span>
<span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>fcGHz  :  4.493
typ  :  generic
feGHz  :  100
Np  :  3000
twns  :  30
te  :  0.01
threshdB  :  3
bandGHz  :  0.499
</pre></div>
</div>
<p>The waveform associated with the simulation object is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;Np&#39;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>
 <span class="s">&#39;bandGHz&#39;</span><span class="p">:</span> <span class="mf">0.499</span><span class="p">,</span>
 <span class="s">&#39;fcGHz&#39;</span><span class="p">:</span> <span class="mf">4.493</span><span class="p">,</span>
 <span class="s">&#39;feGHz&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s">&#39;te&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
 <span class="s">&#39;threshdB&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s">&#39;twns&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
 <span class="s">&#39;typ&#39;</span><span class="p">:</span> <span class="s">&#39;generic&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_18_0.png" src="./PHY-signal_files/PHY-signal_18_0.png" />
<p>Above the waveform is a generic UWB waveform. The interested user can
add easily any other mathematical expression of UWB waveform for
investigation on pulse waveform modulation for example. The waveform can
also comes from measurement. For now there are two versions of this
waveform which has been used during the M1 measurement campaign. One is
not compensated <tt class="docutils literal"><span class="pre">W1compensate</span></tt> for an extra short delay which can
introduce a bias when interpreting the observed delay in terms of
distance. The non compensated version is <tt class="docutils literal"><span class="pre">W1offset</span></tt> from the time
origin about 0.7 ns.</p>
<p>The waveform class should grow for incorporating more waveforms,
especially waveforms compliant with the current IEEE 802.15.4a and IEEE
802.15.6 standards.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wavmeasured</span> <span class="o">=</span> <span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;W1compensate&#39;</span><span class="p">)</span>
<span class="n">wavmeasured</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_20_0.png" src="./PHY-signal_files/PHY-signal_20_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">wavmeasured</span> <span class="o">=</span> <span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;W1offset&#39;</span><span class="p">)</span>
<span class="n">wavmeasured</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_21_0.png" src="./PHY-signal_files/PHY-signal_21_0.png" />
<p>Here the time domain waveform is measured and the anticausal part of the
signal is artificially set to 0.</p>
<p>To handle properly the time domain wavefom in PyLayers, it is required
to center the signal in the middle of the array. The waveform has
embedded in the object its frequency domain and time domain
representation.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">st</span></tt> member stands for signal in time domain</li>
<li><tt class="docutils literal"><span class="pre">sf</span></tt> member stands for signal in frequency domain</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sf</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;class &#39;pylayers.signal.bsignal.FUsignal&#39;&gt;
&lt;class &#39;pylayers.signal.bsignal.EnImpulse&#39;&gt;
</pre></div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">FUsignal</span></tt> Frequency domain uniformly sampled base signal</li>
<li><tt class="docutils literal"><span class="pre">TUsignal</span></tt> Time domain uniformly sampled base signal</li>
</ul>
</div>
</div>
<div class="section" id="construction-of-the-propagation-channel">
<h2>7.5. Construction of the propagation channel<a class="headerlink" href="#construction-of-the-propagation-channel" title="Permalink to this headline">¶</a></h2>
<p>The following representation shows the spatial spreading of the
propagation channel. On the left are scattered the intensity of rays wrt
to angles of departure (in azimut and elevation). On the right is the
intensity of rays wrt to angles of arrival. It misses the application
between the 2 planes as well as the delay dimension of the propagation
channel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>----------------
defstr3.ini
Image(&#39;/home/uguen/Bureau/P1/struc/images/TA-Office.png&#39;)
----------------

Number of points  : 8
Number of segments  : 9
Number of sub segments  : 3
Number of cycles  : 2
Number of rooms  : 2
degree 0 : []
degree 1 : [-8 -7]
degree 2 : 4
degree 3 : 2

xrange :(758.49, 768.516)
yrange :(1111.9, 1115.963)

Useful dictionnaries
----------------
di {interaction : [nstr,typi]}
sl {slab name : slab dictionary}
name :  {slab :seglist}

Useful arrays
----------------
tsg : get segment index in Gs from tahe
isss :  sub-segment index above Nsmax
tgs : get segment index in tahe from Gs
lsss : list of segments with sub-segment
sla : list of all slab names (Nsmax+Nss+1)
degree : degree of nodes
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="mf">766.00300113353387</span><span class="p">,</span> <span class="mf">1113.947479109665</span><span class="p">),</span>
 <span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="mf">761.00289669547806</span><span class="p">,</span> <span class="mf">1113.915769812613</span><span class="p">)}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">759</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">rx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">767</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="n">ctx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="n">crx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
</pre></div>
</div>
<p>The sequence of command below :</p>
<ul class="simple">
<li>initialize a signature between cycle ctx and cycle crx</li>
<li>evaluates the signature with a given cutoff value</li>
<li>calculates a set of 2D rays from signature and tx/rx coordinates</li>
<li>calculates a set of 3D ray from 2D rays and layout and ceil height
(default H=3m)</li>
<li>calculates local basis and various geometric information out of the
3D ray and Layout</li>
<li>fill and reorganize the interactions object with proper material
chararcteristics</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
<span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
<span class="n">r3d</span> <span class="o">=</span> <span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<p>Define a frequency base in GHz.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<p>Evaluate the propagation channel <img src="../_images/mathmpl/math-c2b5c6f441.png" style="position: relative; bottom: -3px"/>. Here the
meaning of tilde is that the complex value of the channel do not include
the phase term due to delay along the ray.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span> <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;class &#39;pylayers.antprop.channel.Ctilde&#39;&gt;
</pre></div>
</div>
</div>
<div class="section" id="construction-of-the-transmission-channel">
<h2>7.6. Construction of the transmission channel<a class="headerlink" href="#construction-of-the-transmission-channel" title="Permalink to this headline">¶</a></h2>
<p>The transmission channel is obtained from the combination of the
propagation channel <img src="../_images/mathmpl/math-c2b5c6f441.png" style="position: relative; bottom: -3px"/> and the vector antenna
pattern at both side of the radio link. This operation is implemented in
the <tt class="docutils literal"><span class="pre">prop2tran</span></tt> method of the <tt class="docutils literal"><span class="pre">Ctilde</span></tt> class.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sc</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">()</span>
</pre></div>
</div>
<p>The ScalChannel object contains all the information about the ray
transfer functions. The transmission channel is obtained by applying a
vector radiation pattern using an antenna file.</p>
<p>In the presented case, it comes from a real antenna which has been used
during the <strong>FP7 project WHERE1</strong> measurement campaign M1.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sc</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>freq :2.0 9.99 800
shape  :(315, 800)
tau :26.7186992365 105.599656025
dist :8.01560977094 31.6798968075
</pre></div>
</div>
<p>The antenna radiation pattern is stored in a very compact way thanks to
Vector Spherical Harmonics decomposition. The following gives
information about the content of the antenna object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>defant.vsh3
type :  vsh3
No vsh coefficient calculated yet
</pre></div>
</div>
<p>The figure below plot on a same graph all the tansfer function in
modulus and phase of the ray transfer function.</p>
<p>If a realistic antenna is applied it gives</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sca</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="calculate-uwb-channel-impulse-response">
<h2>7.7. Calculate UWB Channel Impulse Response<a class="headerlink" href="#calculate-uwb-channel-impulse-response" title="Permalink to this headline">¶</a></h2>
<p>Once the transmission channel has been evaluated on can convolved the
waveform with the channel impulse response to get the received waveform.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span>  <span class="mf">0.00000000e+00</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">,</span>   <span class="mf">0.00000000e+00</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">2.06305673e-12</span><span class="p">,</span>  <span class="o">-</span><span class="mf">2.85965052e-13</span><span class="p">,</span>   <span class="mf">6.80134567e-13</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">u&#39;Received Waveform $r(t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x4cc2750&gt;
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_53_2.png" src="./PHY-signal_files/PHY-signal_53_2.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">r</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3</span>
          <span class="p">,</span><span class="mf">0.3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">u&#39;Received Waveform $r(t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x7f6c579f1e90&gt;
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_54_1.png" src="./PHY-signal_files/PHY-signal_54_1.png" />
</div>
<div class="section" id="hermitian-symetry-enforcment">
<h2>7.8. Hermitian symetry enforcment<a class="headerlink" href="#hermitian-symetry-enforcment" title="Permalink to this headline">¶</a></h2>
<p>If the number of point for the transmission channel and the waveform
were the same the mathematical operation is an Hadamard-Shur product
between <img src="../_images/mathmpl/math-c7217de4b7.png" style="position: relative; bottom: -3px"/> and <img src="../_images/mathmpl/math-9b5e528324.png" style="position: relative; bottom: -3px"/>.</p>
<p><img src="../_images/mathmpl/math-50aab38b79.png" style="position: relative; bottom: -4px"/></p>
<p>In practice this is what is done after a resampling of the time base
with a reinterpolated time step.</p>
<p>The process which consists in going from time domain to frequency domain
is delegated to a specialized class <tt class="docutils literal"><span class="pre">pylayers.signal.bsignal.Bsignal</span></tt>
which maintains the proper binding between signal samples and their
indexation either in time or in frequency domain.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wgam</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span>
<span class="n">Y</span>    <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wgam</span><span class="p">)</span>
<span class="n">tau</span>  <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">tau0</span>
<span class="n">dod</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">dod</span>
<span class="n">doa</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">doa</span>
</pre></div>
</div>
<p>The transmission channel has a member data which is the time delay of
each path in nano seconds. Notice that by default those delay are not
sorted.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;tau =&#39;</span><span class="p">,</span> <span class="n">tau</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>tau = [ 26.71869924  27.93842436  29.10708199  29.64889324  30.03048589
  30.075433    36.72255959  30.75261837  31.12068041  31.1640552
  31.81807982  32.17395555  32.21591227  32.36081306  32.66533294
  33.05244038  34.35921355  37.6193175   37.86521462  38.49519081]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">h</span> <span class="o">=</span> <span class="n">hist</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_61_0.png" src="./PHY-signal_files/PHY-signal_61_0.png" />
<p>Direction of arrival <img src="../_images/mathmpl/math-69ee887da1.png" style="position: relative; bottom: -8px"/> in radians</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;doa = &quot;</span><span class="p">,</span> <span class="n">doa</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,:]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>doa =  [[ 1.8736812  -3.14159265]
 [ 1.15838589 -3.14159265]
 [ 1.62703943  2.69865609]
 [ 1.62632401 -3.14087348]
 [ 1.62624094 -2.65738656]
 [ 1.61619728  0.01122758]
 [ 1.84520693  2.69865609]
 [ 1.84187905 -3.14087348]
 [ 1.84149225 -2.65738656]]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">ht</span> <span class="o">=</span> <span class="n">hist</span><span class="p">(</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$</span><span class="se">\\</span><span class="s">theta_r$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">hp</span> <span class="o">=</span> <span class="n">hist</span><span class="p">(</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$\phi_r$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">ht</span> <span class="o">=</span> <span class="n">hist</span><span class="p">(</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$</span><span class="se">\\</span><span class="s">theta_t$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">hp</span> <span class="o">=</span> <span class="n">hist</span><span class="p">(</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$\phi_t$&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_64_0.png" src="./PHY-signal_files/PHY-signal_64_0.png" />
<p>symHz force the Hermitian symetry of Y with as an argument here a zero
padding of 500 points</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">UH</span>   <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">symHz</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#%psource Y.symHz</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">uh</span>   <span class="o">=</span> <span class="n">UH</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ips</span>  <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span>    <span class="o">=</span> <span class="n">ips</span><span class="o">.</span><span class="n">x</span>
<span class="n">ip0</span>  <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">ips</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">UH</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">real</span><span class="p">(</span><span class="n">UH</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]),</span><span class="n">UH</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">imag</span><span class="p">(</span><span class="n">UH</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]))</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;Re&#39;</span><span class="p">,</span><span class="s">&#39;Im&#39;</span><span class="p">])</span>
<span class="n">U0</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">(</span><span class="n">UH</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">UH</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
<span class="n">u0</span> <span class="o">=</span> <span class="n">U0</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">U0</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;checking Hermitian Symetry in frequency domain fc=4.49GHz&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;f (GHz)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x51fb750&gt;
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_70_1.png" src="./PHY-signal_files/PHY-signal_70_1.png" />
<p>The ray channel has been applied to the UWB waveform. Notice the small
delay introduced by dielectrics material crossing.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">uh</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">uh</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="mf">0.0012</span><span class="o">+</span><span class="mf">0.0034</span><span class="p">)</span>
<span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.002</span><span class="p">,</span><span class="mf">0.008</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;Ray channel filtered waveform&#39;</span><span class="p">,</span><span class="s">&#39;Original Waveform *1.2e-3 +0.0034&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time (ns)&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Inverse Fourier Transform of an FH signal&#39;</span><span class="p">)</span>
<span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./PHY-signal_files/PHY-signal_72_0.png" src="./PHY-signal_files/PHY-signal_72_0.png" />
</div>
</div>
<div class="section" id="example-of-an-uwb-channel-ray-tracing-simulation">
<h1>8. Example of an UWB channel Ray Tracing simulation<a class="headerlink" href="#example-of-an-uwb-channel-ray-tracing-simulation" title="Permalink to this headline">¶</a></h1>
<p>In the following, all steps required for going from the descrpition of
the radio scene until the calculation of the UWB channel impulse
response is described on a simple example.</p>
<p>A ray-tracing simulation is controlled via a configuration file which is
stored in the <em>ini</em> directory of the project directory. By default, a
default configuration file named <strong>default.ini</strong> is loaded.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.measures.mesuwb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
</pre></div>
</div>
<p>A first step consists in loading a layout associated with the
simulation. Here the <tt class="docutils literal"><span class="pre">WHERE1.ini</span></tt> layout is chosen along with the
corresponding slabs and materials files <tt class="docutils literal"><span class="pre">matDB.ini</span></tt> and
<tt class="docutils literal"><span class="pre">slabDB.ini</span></tt>.</p>
<p>This layout corresponds to the office building where the first WHERE1
UWB measurement campaign has been conducted.</p>
<p>The layout method loads those in a member layout object <strong>L</strong> of the
simulation object <strong>S</strong>.</p>
<p>If not already available, the layout associated graphs are built.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="c"># loading a layout</span>
<span class="n">filestr</span> <span class="o">=</span> <span class="s">&#39;WHERE1&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">filestr</span><span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">,</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>
</pre></div>
</div>
<p>The layout display is fully parameterized via the embedded <strong>display</strong>
dictionnary member of the Layout object.which allows to configure the
<tt class="docutils literal"><span class="pre">showGs()</span></tt> method behavior.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;WHERE1 Project Office Measurement Site&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_7_0.png" src="./SIM-raytracing_files/SIM-raytracing_7_0.png" />
<div class="section" id="adding-coordinates-of-transmiting-and-receiving-points">
<h2>8.1. Adding coordinates of transmiting and receiving points<a class="headerlink" href="#adding-coordinates-of-transmiting-and-receiving-points" title="Permalink to this headline">¶</a></h2>
<p>Coordinates of transmitters and receivers for the simulation are stored
in <strong>.ini</strong> files. Transmitter and Receiver are instances of the class
RadioNode which offers different methods for specifying nodes positions.
The stucture of this <strong>.ini</strong> file presented below. The node Id is
associated with the 3 coordinates <img src="../_images/mathmpl/math-aaef4cabe9.png" style="position: relative; bottom: -7px"/> separated by white
spaces.</p>
<div class="highlight-python"><div class="highlight"><pre>[coordinates]
1 = -12.2724 7.76319999993 1.2
2 = -18.7747 15.1779999998 1.2
3 = -4.14179999998 8.86029999983 1.2
4 = -9.09139999998 15.1899000001 1.2
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">_fileini</span><span class="o">=</span><span class="s">&#39;w2m1rx.ini&#39;</span><span class="p">,</span><span class="n">_fileant</span><span class="o">=</span><span class="s">&#39;defant.vsh3&#39;</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">_fileini</span><span class="o">=</span><span class="s">&#39;w2m1tx.ini&#39;</span><span class="p">,</span><span class="n">_fileant</span><span class="o">=</span><span class="s">&#39;defant.vsh3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The whole simulation setup can then be displayed using the <strong>show</strong>
method of the Simulation object</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_13_1.png" src="./SIM-raytracing_files/SIM-raytracing_13_1.png" />
<p>The different object of the simulation cans be accessed to obtain
different information. Below the number of transmitter and receiver.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;number of Tx :&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&#39;number of rx :&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>number of Tx : 302
number of rx : 4
</pre></div>
</div>
<p>The decomposition of the layout in a set of disjoint cycles is
represented below. Not all cycles are rooms.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_17_1.png" src="./SIM-raytracing_files/SIM-raytracing_17_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">40.0</span><span class="p">,</span> <span class="mf">40.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">18.0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_18_1.png" src="./SIM-raytracing_files/SIM-raytracing_18_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">istup</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="nb">tuple</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">cy5</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">5</span><span class="p">,</span><span class="n">istup</span><span class="p">)</span>
<span class="k">print</span> <span class="n">cy5</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;(15, 5, 76)&#39;</span><span class="p">,</span> <span class="s">&#39;(12, 5, 4)&#39;</span><span class="p">,</span> <span class="s">&#39;(13, 5, 6)&#39;</span><span class="p">,</span> <span class="s">&#39;(13, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(12, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(2, 5, 0)&#39;</span><span class="p">,</span> <span class="s">&#39;(331, 5, 6)&#39;</span><span class="p">,</span> <span class="s">&#39;(4, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(4, 5, 1)&#39;</span><span class="p">,</span> <span class="s">&#39;(156, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(15, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(2, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(5, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(156, 5, 75)&#39;</span><span class="p">,</span> <span class="s">&#39;(331, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(330, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(329, 5, 0)&#39;</span><span class="p">,</span> <span class="s">&#39;(329, 5)&#39;</span><span class="p">,</span> <span class="s">&#39;(140, 5, 78)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span><span class="s">&#39;(140, 5, 78)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;(38, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(14, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(135, 78, 22)&#39;</span><span class="p">,</span>
 <span class="s">&#39;-253&#39;</span><span class="p">,</span>
 <span class="s">&#39;-250&#39;</span><span class="p">,</span>
 <span class="s">&#39;(32, 78, 76)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(42, 78, 21)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(36, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(37, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(36, 78, 2)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(32, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(14, 78, 76)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(38, 78, 2)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(43, 78)&#39;</span><span class="p">,</span>
 <span class="s">&#39;(42, 78)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="s">&#39;(140, 5, 78)&#39;</span><span class="p">][</span><span class="s">&#39;(38, 78)&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;output&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;(135, 78, 22)&#39;</span><span class="p">:</span> <span class="mf">0.35579843644453529</span><span class="p">,</span>
  <span class="s">&#39;(140, 78, 5)&#39;</span><span class="p">:</span> <span class="mf">0.20141398602845637</span><span class="p">,</span>
  <span class="s">&#39;(42, 78)&#39;</span><span class="p">:</span> <span class="mf">0.4427875775270072</span><span class="p">,</span>
  <span class="s">&#39;(42, 78, 21)&#39;</span><span class="p">:</span> <span class="mf">0.4427875775270072</span><span class="p">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="signatures-rays-and-propagation-and-transmission-channel">
<h2>8.2. Signatures, rays and propagation and transmission channel<a class="headerlink" href="#signatures-rays-and-propagation-and-transmission-channel" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Choose Tx and Rx coordinates</span>
<span class="n">itx</span><span class="o">=</span><span class="mi">10</span>
<span class="n">irx</span><span class="o">=</span><span class="mi">2</span>
<span class="n">tx</span><span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span>
<span class="n">rx</span><span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">irx</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">24.867</span> <span class="p">,</span>  <span class="mf">12.3097</span><span class="p">,</span>   <span class="mf">1.2</span>   <span class="p">])</span>
</pre></div>
</div>
<p>A signature is a sequence of layout objects (points and segments) which
are involved in a given optical ray, relating the transmiter and the
receiver. The signatutre is calculated from a layout cycle to an other
layout cycle. This means that is is required first to retrieve the cycle
number from point coordinates. This is done thanks to the <strong>pt2cy</strong>,
point to cycle function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ctx</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="n">crx</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;tx point belongs to cycle &#39;</span><span class="p">,</span><span class="n">ctx</span>
<span class="k">print</span> <span class="s">&#39;rx point belongs to cycle &#39;</span><span class="p">,</span><span class="n">crx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>tx point belongs to cycle  5
rx point belongs to cycle  4
</pre></div>
</div>
<p>Then the signature between cycle 5 and cycle 4 can be calculated. This
is done by instantiating a Signature object with a given layout and the
2 cycle number.</p>
<p>The representaion of a signature object provides information about the
number of signatures for each number of interactions.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">algo</span><span class="o">=</span><span class="s">&#39;old&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Signatures
----------
from cycle : 5 to cycle 4
1 : 1
   [12]
   [2]
2 : 21
   [ 12  12  12  12  12  12  12  12  12  13  13 331 331 329   5   4 156  15
  13 330   2]
   [2 2 2 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1]
   [ 29  30  16 333  22 328  23 335 334  11 342  11 342  12  12  12  12  12
  12  12  12]
   [1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 2 2]

...
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#Si.run4(cutoff=5)</span>
</pre></div>
</div>
<p>Once the signature has been obtained, 2D rays are calculated with the
<tt class="docutils literal"><span class="pre">rays()</span></tt> method of the signature <strong>Si</strong>. The coordinates of a
transmitter and a receiver should be parameters of the function. <strong>r2d</strong>
object has a <tt class="docutils literal"><span class="pre">show</span></tt> and <tt class="docutils literal"><span class="pre">show3</span></tt> method</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">24.867</span> <span class="p">,</span>  <span class="mf">12.3097</span><span class="p">,</span>   <span class="mf">1.2</span>   <span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">r2d</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_34_1.png" src="./SIM-raytracing_files/SIM-raytracing_34_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>N2Drays : 42
from 24395 signatures
#Rays/#Sig: 0.00172166427547
pTx : [-24.867   12.3097   1.2   ]
pRx : [-18.7747  15.178    1.2   ]
1: [[12]]
2: [[ 12  12   5]
 [333 335  12]]
3: [[ 12  12  12   5   5   4  12  13]
 [335 335  30  12  12   5   5  12]
 [ 12  23 335 333 335  12  12  30]]
4: [[ 12  12  12   5   5 156  12   2]
 [335  30 335  12  15   5   5 330]
 [283 335 333 335  12  12  12  12]
 [335  12 342  12 335 333 335  30]]
5: [[ 12  12  12  12  12  12  12  13   5   5   5   5  15  12  12  12  12 330]
 [328  22  30 328 335  30 333   3  12  12 156 330   5   5   5  15   5  12]
 [339 339 335 335 283 335 334  13 335 335  12  12 330 331  12   5  12  30]
 [ 24 328 283  30 335 333 335  12 283 333 335 334  12   8 335  12  23  21]
 [328  24 335  12  12 342 328  30 335  11  23 335  30 342  12 335 335  30]]
...
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># r2d.show3(strucname=&#39;WHERE1&#39;)</span>
</pre></div>
</div>
<p>Then, the <strong>r2d</strong> object is transformed in 3D ray, taking into account
the reflection on ceil and floor.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">=</span><span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="c"># r3d.show3(strucname=&#39;WHERE1&#39;)</span>
</pre></div>
</div>
<p>Once the 3D rays are obtained the local basis are determined</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<p>and the the interaction matrices are filled.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<p>Below <tt class="docutils literal"><span class="pre">ni</span></tt> is the number of interactions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Rays3D
----------
1 / 1 : [0]
2 / 5 : [1 2 3 4 5]
3 / 16 : [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
4 / 30 : [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46
 47 48 49 50 51]
5 / 50 : [ 52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69
  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87
  88  89  90  91  92  93  94  95  96  97  98  99 100 101]
6 / 54 : [102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119
 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137
 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155]
7 / 42 : [156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191
 192 193 194 195 196 197]
8 / 8 : [198 199 200 201 202 203 204 205]
9 / 4 : [206 207 208 209]
-----
ni : 1147
nl : 2504
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">6</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="mi">18</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">13</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">268</span>
</pre></div>
</div>
</div>
<div class="section" id="calculating-the-propagation-channel">
<h2>8.3. Calculating the Propagation Channel<a class="headerlink" href="#calculating-the-propagation-channel" title="Permalink to this headline">¶</a></h2>
<p>The propagation channel is a <tt class="docutils literal"><span class="pre">Ctilde</span></tt> object. This object can be
evaluated for different frequency point thanks to the <tt class="docutils literal"><span class="pre">eval()</span></tt> method
with a frequency array as argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span>  <span class="mf">2.</span>  <span class="p">,</span>   <span class="mf">2.05</span><span class="p">,</span>   <span class="mf">2.1</span> <span class="p">,</span>   <span class="mf">2.15</span><span class="p">,</span>   <span class="mf">2.2</span> <span class="p">,</span>   <span class="mf">2.25</span><span class="p">,</span>   <span class="mf">2.3</span> <span class="p">,</span>   <span class="mf">2.35</span><span class="p">,</span>
         <span class="mf">2.4</span> <span class="p">,</span>   <span class="mf">2.45</span><span class="p">,</span>   <span class="mf">2.5</span> <span class="p">,</span>   <span class="mf">2.55</span><span class="p">,</span>   <span class="mf">2.6</span> <span class="p">,</span>   <span class="mf">2.65</span><span class="p">,</span>   <span class="mf">2.7</span> <span class="p">,</span>   <span class="mf">2.75</span><span class="p">,</span>
         <span class="mf">2.8</span> <span class="p">,</span>   <span class="mf">2.85</span><span class="p">,</span>   <span class="mf">2.9</span> <span class="p">,</span>   <span class="mf">2.95</span><span class="p">,</span>   <span class="mf">3.</span>  <span class="p">,</span>   <span class="mf">3.05</span><span class="p">,</span>   <span class="mf">3.1</span> <span class="p">,</span>   <span class="mf">3.15</span><span class="p">,</span>
         <span class="mf">3.2</span> <span class="p">,</span>   <span class="mf">3.25</span><span class="p">,</span>   <span class="mf">3.3</span> <span class="p">,</span>   <span class="mf">3.35</span><span class="p">,</span>   <span class="mf">3.4</span> <span class="p">,</span>   <span class="mf">3.45</span><span class="p">,</span>   <span class="mf">3.5</span> <span class="p">,</span>   <span class="mf">3.55</span><span class="p">,</span>
         <span class="mf">3.6</span> <span class="p">,</span>   <span class="mf">3.65</span><span class="p">,</span>   <span class="mf">3.7</span> <span class="p">,</span>   <span class="mf">3.75</span><span class="p">,</span>   <span class="mf">3.8</span> <span class="p">,</span>   <span class="mf">3.85</span><span class="p">,</span>   <span class="mf">3.9</span> <span class="p">,</span>   <span class="mf">3.95</span><span class="p">,</span>
         <span class="mf">4.</span>  <span class="p">,</span>   <span class="mf">4.05</span><span class="p">,</span>   <span class="mf">4.1</span> <span class="p">,</span>   <span class="mf">4.15</span><span class="p">,</span>   <span class="mf">4.2</span> <span class="p">,</span>   <span class="mf">4.25</span><span class="p">,</span>   <span class="mf">4.3</span> <span class="p">,</span>   <span class="mf">4.35</span><span class="p">,</span>
         <span class="mf">4.4</span> <span class="p">,</span>   <span class="mf">4.45</span><span class="p">,</span>   <span class="mf">4.5</span> <span class="p">,</span>   <span class="mf">4.55</span><span class="p">,</span>   <span class="mf">4.6</span> <span class="p">,</span>   <span class="mf">4.65</span><span class="p">,</span>   <span class="mf">4.7</span> <span class="p">,</span>   <span class="mf">4.75</span><span class="p">,</span>
         <span class="mf">4.8</span> <span class="p">,</span>   <span class="mf">4.85</span><span class="p">,</span>   <span class="mf">4.9</span> <span class="p">,</span>   <span class="mf">4.95</span><span class="p">,</span>   <span class="mf">5.</span>  <span class="p">,</span>   <span class="mf">5.05</span><span class="p">,</span>   <span class="mf">5.1</span> <span class="p">,</span>   <span class="mf">5.15</span><span class="p">,</span>
         <span class="mf">5.2</span> <span class="p">,</span>   <span class="mf">5.25</span><span class="p">,</span>   <span class="mf">5.3</span> <span class="p">,</span>   <span class="mf">5.35</span><span class="p">,</span>   <span class="mf">5.4</span> <span class="p">,</span>   <span class="mf">5.45</span><span class="p">,</span>   <span class="mf">5.5</span> <span class="p">,</span>   <span class="mf">5.55</span><span class="p">,</span>
         <span class="mf">5.6</span> <span class="p">,</span>   <span class="mf">5.65</span><span class="p">,</span>   <span class="mf">5.7</span> <span class="p">,</span>   <span class="mf">5.75</span><span class="p">,</span>   <span class="mf">5.8</span> <span class="p">,</span>   <span class="mf">5.85</span><span class="p">,</span>   <span class="mf">5.9</span> <span class="p">,</span>   <span class="mf">5.95</span><span class="p">,</span>
         <span class="mf">6.</span>  <span class="p">,</span>   <span class="mf">6.05</span><span class="p">,</span>   <span class="mf">6.1</span> <span class="p">,</span>   <span class="mf">6.15</span><span class="p">,</span>   <span class="mf">6.2</span> <span class="p">,</span>   <span class="mf">6.25</span><span class="p">,</span>   <span class="mf">6.3</span> <span class="p">,</span>   <span class="mf">6.35</span><span class="p">,</span>
         <span class="mf">6.4</span> <span class="p">,</span>   <span class="mf">6.45</span><span class="p">,</span>   <span class="mf">6.5</span> <span class="p">,</span>   <span class="mf">6.55</span><span class="p">,</span>   <span class="mf">6.6</span> <span class="p">,</span>   <span class="mf">6.65</span><span class="p">,</span>   <span class="mf">6.7</span> <span class="p">,</span>   <span class="mf">6.75</span><span class="p">,</span>
         <span class="mf">6.8</span> <span class="p">,</span>   <span class="mf">6.85</span><span class="p">,</span>   <span class="mf">6.9</span> <span class="p">,</span>   <span class="mf">6.95</span><span class="p">,</span>   <span class="mf">7.</span>  <span class="p">,</span>   <span class="mf">7.05</span><span class="p">,</span>   <span class="mf">7.1</span> <span class="p">,</span>   <span class="mf">7.15</span><span class="p">,</span>
         <span class="mf">7.2</span> <span class="p">,</span>   <span class="mf">7.25</span><span class="p">,</span>   <span class="mf">7.3</span> <span class="p">,</span>   <span class="mf">7.35</span><span class="p">,</span>   <span class="mf">7.4</span> <span class="p">,</span>   <span class="mf">7.45</span><span class="p">,</span>   <span class="mf">7.5</span> <span class="p">,</span>   <span class="mf">7.55</span><span class="p">,</span>
         <span class="mf">7.6</span> <span class="p">,</span>   <span class="mf">7.65</span><span class="p">,</span>   <span class="mf">7.7</span> <span class="p">,</span>   <span class="mf">7.75</span><span class="p">,</span>   <span class="mf">7.8</span> <span class="p">,</span>   <span class="mf">7.85</span><span class="p">,</span>   <span class="mf">7.9</span> <span class="p">,</span>   <span class="mf">7.95</span><span class="p">,</span>
         <span class="mf">8.</span>  <span class="p">,</span>   <span class="mf">8.05</span><span class="p">,</span>   <span class="mf">8.1</span> <span class="p">,</span>   <span class="mf">8.15</span><span class="p">,</span>   <span class="mf">8.2</span> <span class="p">,</span>   <span class="mf">8.25</span><span class="p">,</span>   <span class="mf">8.3</span> <span class="p">,</span>   <span class="mf">8.35</span><span class="p">,</span>
         <span class="mf">8.4</span> <span class="p">,</span>   <span class="mf">8.45</span><span class="p">,</span>   <span class="mf">8.5</span> <span class="p">,</span>   <span class="mf">8.55</span><span class="p">,</span>   <span class="mf">8.6</span> <span class="p">,</span>   <span class="mf">8.65</span><span class="p">,</span>   <span class="mf">8.7</span> <span class="p">,</span>   <span class="mf">8.75</span><span class="p">,</span>
         <span class="mf">8.8</span> <span class="p">,</span>   <span class="mf">8.85</span><span class="p">,</span>   <span class="mf">8.9</span> <span class="p">,</span>   <span class="mf">8.95</span><span class="p">,</span>   <span class="mf">9.</span>  <span class="p">,</span>   <span class="mf">9.05</span><span class="p">,</span>   <span class="mf">9.1</span> <span class="p">,</span>   <span class="mf">9.15</span><span class="p">,</span>
         <span class="mf">9.2</span> <span class="p">,</span>   <span class="mf">9.25</span><span class="p">,</span>   <span class="mf">9.3</span> <span class="p">,</span>   <span class="mf">9.35</span><span class="p">,</span>   <span class="mf">9.4</span> <span class="p">,</span>   <span class="mf">9.45</span><span class="p">,</span>   <span class="mf">9.5</span> <span class="p">,</span>   <span class="mf">9.55</span><span class="p">,</span>
         <span class="mf">9.6</span> <span class="p">,</span>   <span class="mf">9.65</span><span class="p">,</span>   <span class="mf">9.7</span> <span class="p">,</span>   <span class="mf">9.75</span><span class="p">,</span>   <span class="mf">9.8</span> <span class="p">,</span>   <span class="mf">9.85</span><span class="p">,</span>   <span class="mf">9.9</span> <span class="p">,</span>   <span class="mf">9.95</span><span class="p">,</span>
        <span class="mf">10.</span>  <span class="p">,</span>  <span class="mf">10.05</span><span class="p">,</span>  <span class="mf">10.1</span> <span class="p">,</span>  <span class="mf">10.15</span><span class="p">,</span>  <span class="mf">10.2</span> <span class="p">,</span>  <span class="mf">10.25</span><span class="p">,</span>  <span class="mf">10.3</span> <span class="p">,</span>  <span class="mf">10.35</span><span class="p">,</span>
        <span class="mf">10.4</span> <span class="p">,</span>  <span class="mf">10.45</span><span class="p">,</span>  <span class="mf">10.5</span> <span class="p">,</span>  <span class="mf">10.55</span><span class="p">,</span>  <span class="mf">10.6</span> <span class="p">,</span>  <span class="mf">10.65</span><span class="p">,</span>  <span class="mf">10.7</span> <span class="p">,</span>  <span class="mf">10.75</span><span class="p">,</span>
        <span class="mf">10.8</span> <span class="p">,</span>  <span class="mf">10.85</span><span class="p">,</span>  <span class="mf">10.9</span> <span class="p">,</span>  <span class="mf">10.95</span><span class="p">,</span>  <span class="mf">11.</span>  <span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span> <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;fmin : &quot;</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;fmax : &quot;</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="k">print</span> <span class="s">&quot;Nf : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>fmin :  2.0
fmax :  11.0
Nf :  181
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Rays3D
----------
1 / 1 : [0]
2 / 5 : [1 2 3 4 5]
3 / 16 : [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
4 / 30 : [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46
 47 48 49 50 51]
5 / 50 : [ 52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69
  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87
  88  89  90  91  92  93  94  95  96  97  98  99 100 101]
6 / 54 : [102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119
 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137
 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155]
7 / 42 : [156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191
 192 193 194 195 196 197]
8 / 8 : [198 199 200 201 202 203 204 205]
9 / 4 : [206 207 208 209]
-----
ni : 1147
nl : 2504
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ectt</span><span class="p">,</span><span class="n">Ecpp</span><span class="p">,</span><span class="n">Ectp</span><span class="p">,</span><span class="n">Ecpt</span> <span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Eco</span> <span class="o">=</span> <span class="n">Ectt</span><span class="o">+</span><span class="n">Ecpp</span>
<span class="n">Ecross</span> <span class="o">=</span> <span class="n">Ectp</span><span class="o">+</span><span class="n">Ecpt</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ct</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Eco</span><span class="p">),</span><span class="s">&#39;ob&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Ct</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ecross</span><span class="p">),</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;delay(ns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;path energy (dB)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Co-pol&#39;</span><span class="p">,</span><span class="s">&#39;X-pol&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_54_1.png" src="./SIM-raytracing_files/SIM-raytracing_54_1.png" />
<p>The multipath doa/dod diagram can be obtained via the method <tt class="docutils literal"><span class="pre">doadod</span></tt>.
The colorbar corresponds to the total energy of the path.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">doadod</span><span class="p">(</span><span class="n">phi</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_56_0.png" src="./SIM-raytracing_files/SIM-raytracing_56_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Nfreq  : 181
Nray : 210
shape Ctt : (210, 181)
shape Ctp : (210, 181)
shape Cpt : (210, 181)
shape Cpp : (210, 181)
</pre></div>
</div>
</div>
<div class="section" id="apply-waveform">
<h2>8.4. Apply waveform<a class="headerlink" href="#apply-waveform" title="Permalink to this headline">¶</a></h2>
<p>Once the propagation channel is obtained the transmission channel is
calculated with the method <tt class="docutils literal"><span class="pre">prop2tran</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">fGHz</span>
<span class="n">sco</span> <span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<p>The applied waveform which is here loaded from a measurement file, and
compensated for a small time shift. It is important for the latter
treatment for the applied waveform to be centered on the middle of the
array as it is illustrated below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">mesdir</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/home/uguen/data/WHERE1/measures
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;generic&#39;</span><span class="p">,</span><span class="n">fcGHz</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">bandGHz</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_63_0.png" src="./SIM-raytracing_files/SIM-raytracing_63_0.png" />
<p>Finally, the received UWB waveform can be synthesize in applyng the
waveform to the transmission channel.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ro</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
<span class="n">ra</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;delay(ns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;without antenna&#39;</span><span class="p">)</span>
<span class="c">#plt.axis((0,180,-0.006,0.006))</span>

<span class="n">ra</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;delay(ns)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;voltage (V)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;with antenna&#39;</span><span class="p">)</span>
<span class="c">#plt.axis((0,180,-0.1,0.1))</span>
</pre></div>
</div>
<img alt="./SIM-raytracing_files/SIM-raytracing_66_2.png" src="./SIM-raytracing_files/SIM-raytracing_66_2.png" />
<img alt="./SIM-raytracing_files/SIM-raytracing_66_3.png" src="./SIM-raytracing_files/SIM-raytracing_66_3.png" />
</div>
</div>
<div class="section" id="simulation-creation">
<h1>9. Simulation Creation<a class="headerlink" href="#simulation-creation" title="Permalink to this headline">¶</a></h1>
<p>A ray-tracing simulation is controlled via a configuration file which is
stored in the <em>ini</em> directory of the project directory. By default,
there is a default configuration file named <strong>default.ini</strong>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.measures.mesuwb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
</pre></div>
</div>
<p>A first step consists in loading a layout associated with the
simulation. Here the <tt class="docutils literal"><span class="pre">WHERE1.ini</span></tt> layout is chosen along with the
corresponding slabs and materials.</p>
<p>This layout corresponds to the office building where the first WHERE1
UWB measurement campaign has been conducted.</p>
<p>The layout method loads those in a member layout object <strong>L</strong> of the
simulation object <strong>S</strong>.</p>
<p>If not already available, the layout associated graphs are built.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="c"># loading a layout</span>
<span class="n">filestr</span> <span class="o">=</span> <span class="s">&#39;WHERE1&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">filestr</span><span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">,</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_5_1.png" src="./SIM-where1_files/SIM-where1_5_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGi</span><span class="p">(</span><span class="n">en</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>int0 :  (309, 15, 46)
int1 :  (202, 46, 59)
 output  {&#39;(137, 59, 58)&#39;: 0.64242282168494413, &#39;(230, 59, 67)&#39;: 0.35757717831506564, &#39;(230, 59)&#39;: 0.35757717831506564}
 Sum pR :  0.357577178315
 Sum pT :  0.642422821685
lseg [137 230]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">31.123950000000001</span><span class="p">,</span> <span class="mf">34.74295</span><span class="p">,</span> <span class="mf">3.6289500000000001</span><span class="p">,</span> <span class="mf">17.468049999999998</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_6_2.png" src="./SIM-where1_files/SIM-where1_6_2.png" />
<p>The layout display is fully parameterized via the embedded <strong>display</strong>
dictionnary member of the Layout object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;WHERE1 Project Office Measurement Site&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_8_0.png" src="./SIM-where1_files/SIM-where1_8_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edges</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="s">&#39;(309, 15, 46)&#39;</span><span class="p">,</span> <span class="s">&#39;(148, 46, 44)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id3">
<h2>9.1. Adding coordinates of transmiting and receiving points<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Coordinates of transmitters and receivers for the simulation to be
perform are stotred in <strong>.ini</strong> files. Transmitter and Receiver are
instances of the class <tt class="docutils literal"><span class="pre">RadioNode</span></tt> which offers different methods for
specifying nodes positions. The stucture of this <strong>.ini</strong> file presented
below. The node Id is associated with the 3 coordinates <img src="../_images/mathmpl/math-aaef4cabe9.png" style="position: relative; bottom: -7px"/>
separated by white spaces.</p>
<div class="highlight-python"><div class="highlight"><pre>[coordinates]
1 = -12.2724 7.76319999993 1.2
2 = -18.7747 15.1779999998 1.2
3 = -4.14179999998 8.86029999983 1.2
4 = -9.09139999998 15.1899000001 1.2
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">_fileini</span><span class="o">=</span><span class="s">&#39;w2m1rx.ini&#39;</span><span class="p">,</span><span class="n">_fileant</span><span class="o">=</span><span class="s">&#39;defant.vsh3&#39;</span><span class="p">)</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">_fileini</span><span class="o">=</span><span class="s">&#39;w2m1tx.ini&#39;</span><span class="p">,</span><span class="n">_fileant</span><span class="o">=</span><span class="s">&#39;defant.vsh3&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The whole simulation setup can then be displayed using the <strong>show</strong>
method of the Simulation object</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_15_1.png" src="./SIM-where1_files/SIM-where1_15_1.png" />
<p>Select Tx and Rx positions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">map</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="mi">10</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<span class="mi">20</span><span class="p">:</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">:</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">26</span><span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
<span class="mi">27</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">31</span><span class="p">:</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">33</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">34</span><span class="p">:</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">35</span><span class="p">:</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="mi">38</span><span class="p">,</span>
      <span class="mi">37</span><span class="p">:</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">38</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">39</span><span class="p">:</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">41</span><span class="p">:</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">42</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">43</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">44</span><span class="p">:</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">45</span><span class="p">:</span> <span class="mi">47</span><span class="p">,</span>
      <span class="mi">46</span><span class="p">:</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">47</span><span class="p">:</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">49</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">50</span><span class="p">:</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">51</span><span class="p">:</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">52</span><span class="p">:</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">53</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">54</span><span class="p">:</span> <span class="mi">56</span><span class="p">,</span>
      <span class="mi">55</span><span class="p">:</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">56</span><span class="p">:</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">57</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">58</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">59</span><span class="p">:</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">60</span><span class="p">:</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">61</span><span class="p">:</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">62</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">63</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
      <span class="mi">64</span><span class="p">:</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">65</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">66</span><span class="p">:</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">67</span><span class="p">:</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">68</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">69</span><span class="p">:</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">70</span><span class="p">:</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">71</span><span class="p">:</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">72</span><span class="p">:</span> <span class="mi">74</span><span class="p">,</span>
      <span class="mi">73</span><span class="p">:</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">74</span><span class="p">:</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">75</span><span class="p">:</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">76</span><span class="p">:</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">77</span><span class="p">:</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">78</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">79</span><span class="p">:</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">80</span><span class="p">:</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">81</span><span class="p">:</span> <span class="mi">83</span><span class="p">,</span>
      <span class="mi">82</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">83</span><span class="p">:</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">84</span><span class="p">:</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">85</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">86</span><span class="p">:</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">87</span><span class="p">:</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">88</span><span class="p">:</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">89</span><span class="p">:</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">90</span><span class="p">:</span> <span class="mi">95</span><span class="p">,</span>
      <span class="mi">91</span><span class="p">:</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">92</span><span class="p">:</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">93</span><span class="p">:</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">94</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">95</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">96</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">97</span><span class="p">:</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">98</span><span class="p">:</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">99</span><span class="p">:</span>
      <span class="mi">105</span><span class="p">,</span> <span class="mi">100</span><span class="p">:</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">101</span><span class="p">:</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">102</span><span class="p">:</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">103</span><span class="p">:</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">104</span><span class="p">:</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">105</span><span class="p">:</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">106</span><span class="p">:</span>
      <span class="mi">113</span><span class="p">,</span> <span class="mi">107</span><span class="p">:</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">108</span><span class="p">:</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">109</span><span class="p">:</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">110</span><span class="p">:</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">111</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">112</span><span class="p">:</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">113</span><span class="p">:</span>
      <span class="mi">123</span><span class="p">,</span> <span class="mi">114</span><span class="p">:</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">115</span><span class="p">:</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">116</span><span class="p">:</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">117</span><span class="p">:</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">118</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">119</span><span class="p">:</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">120</span><span class="p">:</span>
      <span class="mi">133</span><span class="p">,</span> <span class="mi">121</span><span class="p">:</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">122</span><span class="p">:</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">123</span><span class="p">:</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">124</span><span class="p">:</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">125</span><span class="p">:</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">126</span><span class="p">:</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">127</span><span class="p">:</span>
      <span class="mi">141</span><span class="p">,</span> <span class="mi">128</span><span class="p">:</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">129</span><span class="p">:</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">130</span><span class="p">:</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">131</span><span class="p">:</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">132</span><span class="p">:</span> <span class="mi">146</span><span class="p">,</span> <span class="mi">133</span><span class="p">:</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">134</span><span class="p">:</span>
      <span class="mi">162</span><span class="p">,</span> <span class="mi">135</span><span class="p">:</span> <span class="mi">163</span><span class="p">,</span> <span class="mi">136</span><span class="p">:</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">137</span><span class="p">:</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">138</span><span class="p">:</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">139</span><span class="p">:</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">140</span><span class="p">:</span> <span class="mi">168</span><span class="p">,</span> <span class="mi">141</span><span class="p">:</span>
      <span class="mi">169</span><span class="p">,</span> <span class="mi">142</span><span class="p">:</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">143</span><span class="p">:</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">144</span><span class="p">:</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">145</span><span class="p">:</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">146</span><span class="p">:</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">147</span><span class="p">:</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">148</span><span class="p">:</span>
      <span class="mi">176</span><span class="p">,</span> <span class="mi">149</span><span class="p">:</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">150</span><span class="p">:</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">151</span><span class="p">:</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">152</span><span class="p">:</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">153</span><span class="p">:</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">154</span><span class="p">:</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">155</span><span class="p">:</span>
      <span class="mi">184</span><span class="p">,</span> <span class="mi">156</span><span class="p">:</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">157</span><span class="p">:</span> <span class="mi">186</span><span class="p">,</span> <span class="mi">158</span><span class="p">:</span> <span class="mi">188</span><span class="p">,</span> <span class="mi">159</span><span class="p">:</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">160</span><span class="p">:</span> <span class="mi">199</span><span class="p">,</span> <span class="mi">161</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">162</span><span class="p">:</span>
      <span class="mi">201</span><span class="p">,</span> <span class="mi">163</span><span class="p">:</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">164</span><span class="p">:</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">165</span><span class="p">:</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">166</span><span class="p">:</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">167</span><span class="p">:</span> <span class="mi">206</span><span class="p">,</span> <span class="mi">168</span><span class="p">:</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">169</span><span class="p">:</span>
      <span class="mi">208</span><span class="p">,</span> <span class="mi">170</span><span class="p">:</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">171</span><span class="p">:</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">172</span><span class="p">:</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">173</span><span class="p">:</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">174</span><span class="p">:</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">175</span><span class="p">:</span> <span class="mi">214</span><span class="p">,</span> <span class="mi">176</span><span class="p">:</span>
      <span class="mi">215</span><span class="p">,</span> <span class="mi">177</span><span class="p">:</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">178</span><span class="p">:</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">179</span><span class="p">:</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">180</span><span class="p">:</span> <span class="mi">219</span><span class="p">,</span> <span class="mi">181</span><span class="p">:</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">182</span><span class="p">:</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">183</span><span class="p">:</span>
      <span class="mi">222</span><span class="p">,</span> <span class="mi">184</span><span class="p">:</span> <span class="mi">223</span><span class="p">,</span> <span class="mi">185</span><span class="p">:</span> <span class="mi">227</span><span class="p">,</span> <span class="mi">186</span><span class="p">:</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">187</span><span class="p">:</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">188</span><span class="p">:</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">189</span><span class="p">:</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">190</span><span class="p">:</span>
      <span class="mi">232</span><span class="p">,</span> <span class="mi">191</span><span class="p">:</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">192</span><span class="p">:</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">193</span><span class="p">:</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">194</span><span class="p">:</span> <span class="mi">236</span><span class="p">,</span> <span class="mi">195</span><span class="p">:</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">196</span><span class="p">:</span> <span class="mi">238</span><span class="p">,</span> <span class="mi">197</span><span class="p">:</span>
      <span class="mi">239</span><span class="p">,</span> <span class="mi">198</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">199</span><span class="p">:</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">200</span><span class="p">:</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">201</span><span class="p">:</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">202</span><span class="p">:</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">203</span><span class="p">:</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">204</span><span class="p">:</span>
      <span class="mi">246</span><span class="p">,</span> <span class="mi">205</span><span class="p">:</span> <span class="mi">247</span><span class="p">,</span> <span class="mi">206</span><span class="p">:</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">207</span><span class="p">:</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">208</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">209</span><span class="p">:</span> <span class="mi">251</span><span class="p">,</span> <span class="mi">210</span><span class="p">:</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">211</span><span class="p">:</span>
      <span class="mi">253</span><span class="p">,</span> <span class="mi">212</span><span class="p">:</span> <span class="mi">258</span><span class="p">,</span> <span class="mi">213</span><span class="p">:</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">214</span><span class="p">:</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">215</span><span class="p">:</span> <span class="mi">267</span><span class="p">,</span> <span class="mi">216</span><span class="p">:</span> <span class="mi">268</span><span class="p">,</span> <span class="mi">217</span><span class="p">:</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">218</span><span class="p">:</span>
      <span class="mi">270</span><span class="p">,</span> <span class="mi">219</span><span class="p">:</span> <span class="mi">271</span><span class="p">,</span> <span class="mi">220</span><span class="p">:</span> <span class="mi">272</span><span class="p">,</span> <span class="mi">221</span><span class="p">:</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">222</span><span class="p">:</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">223</span><span class="p">:</span> <span class="mi">275</span><span class="p">,</span> <span class="mi">224</span><span class="p">:</span> <span class="mi">276</span><span class="p">,</span> <span class="mi">225</span><span class="p">:</span>
      <span class="mi">277</span><span class="p">,</span> <span class="mi">226</span><span class="p">:</span> <span class="mi">278</span><span class="p">,</span> <span class="mi">227</span><span class="p">:</span> <span class="mi">279</span><span class="p">,</span> <span class="mi">228</span><span class="p">:</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">229</span><span class="p">:</span> <span class="mi">298</span><span class="p">,</span> <span class="mi">230</span><span class="p">:</span> <span class="mi">299</span><span class="p">,</span> <span class="mi">231</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">232</span><span class="p">:</span>
      <span class="mi">301</span><span class="p">,</span> <span class="mi">233</span><span class="p">:</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">234</span><span class="p">:</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">235</span><span class="p">:</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">236</span><span class="p">:</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">237</span><span class="p">:</span> <span class="mi">306</span><span class="p">,</span> <span class="mi">238</span><span class="p">:</span> <span class="mi">307</span><span class="p">,</span> <span class="mi">239</span><span class="p">:</span>
      <span class="mi">308</span><span class="p">,</span> <span class="mi">240</span><span class="p">:</span> <span class="mi">309</span><span class="p">,</span> <span class="mi">241</span><span class="p">:</span> <span class="mi">310</span><span class="p">,</span> <span class="mi">242</span><span class="p">:</span> <span class="mi">311</span><span class="p">,</span> <span class="mi">243</span><span class="p">:</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">244</span><span class="p">:</span> <span class="mi">313</span><span class="p">,</span> <span class="mi">245</span><span class="p">:</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">246</span><span class="p">:</span>
      <span class="mi">315</span><span class="p">,</span> <span class="mi">247</span><span class="p">:</span> <span class="mi">316</span><span class="p">,</span> <span class="mi">248</span><span class="p">:</span> <span class="mi">317</span><span class="p">,</span> <span class="mi">249</span><span class="p">:</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">250</span><span class="p">:</span> <span class="mi">319</span><span class="p">,</span> <span class="mi">251</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">252</span><span class="p">:</span> <span class="mi">321</span><span class="p">,</span> <span class="mi">253</span><span class="p">:</span>
      <span class="mi">322</span><span class="p">,</span> <span class="mi">254</span><span class="p">:</span> <span class="mi">323</span><span class="p">,</span> <span class="mi">255</span><span class="p">:</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">256</span><span class="p">:</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">257</span><span class="p">:</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">258</span><span class="p">:</span> <span class="mi">327</span><span class="p">,</span> <span class="mi">259</span><span class="p">:</span> <span class="mi">328</span><span class="p">,</span> <span class="mi">260</span><span class="p">:</span>
      <span class="mi">329</span><span class="p">,</span> <span class="mi">261</span><span class="p">:</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">262</span><span class="p">:</span> <span class="mi">332</span><span class="p">,</span> <span class="mi">263</span><span class="p">:</span> <span class="mi">333</span><span class="p">,</span> <span class="mi">264</span><span class="p">:</span> <span class="mi">334</span><span class="p">,</span> <span class="mi">265</span><span class="p">:</span> <span class="mi">335</span><span class="p">,</span> <span class="mi">266</span><span class="p">:</span> <span class="mi">336</span><span class="p">,</span> <span class="mi">267</span><span class="p">:</span>
      <span class="mi">337</span><span class="p">,</span> <span class="mi">268</span><span class="p">:</span> <span class="mi">338</span><span class="p">,</span> <span class="mi">269</span><span class="p">:</span> <span class="mi">339</span><span class="p">,</span> <span class="mi">270</span><span class="p">:</span> <span class="mi">340</span><span class="p">,</span> <span class="mi">271</span><span class="p">:</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">272</span><span class="p">:</span> <span class="mi">342</span><span class="p">,</span> <span class="mi">273</span><span class="p">:</span> <span class="mi">343</span><span class="p">,</span> <span class="mi">274</span><span class="p">:</span>
      <span class="mi">344</span><span class="p">,</span> <span class="mi">275</span><span class="p">:</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">276</span><span class="p">:</span> <span class="mi">346</span><span class="p">,</span> <span class="mi">277</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">278</span><span class="p">:</span> <span class="mi">348</span><span class="p">,</span> <span class="mi">279</span><span class="p">:</span> <span class="mi">349</span><span class="p">,</span> <span class="mi">280</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">281</span><span class="p">:</span>
      <span class="mi">351</span><span class="p">,</span> <span class="mi">282</span><span class="p">:</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">283</span><span class="p">:</span> <span class="mi">353</span><span class="p">,</span> <span class="mi">284</span><span class="p">:</span> <span class="mi">354</span><span class="p">,</span> <span class="mi">285</span><span class="p">:</span> <span class="mi">355</span><span class="p">,</span> <span class="mi">286</span><span class="p">:</span> <span class="mi">356</span><span class="p">,</span> <span class="mi">287</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">288</span><span class="p">:</span>
      <span class="mi">361</span><span class="p">,</span> <span class="mi">289</span><span class="p">:</span> <span class="mi">362</span><span class="p">,</span> <span class="mi">290</span><span class="p">:</span> <span class="mi">363</span><span class="p">,</span> <span class="mi">291</span><span class="p">:</span> <span class="mi">364</span><span class="p">,</span> <span class="mi">292</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">293</span><span class="p">:</span> <span class="mi">366</span><span class="p">,</span> <span class="mi">294</span><span class="p">:</span> <span class="mi">367</span><span class="p">,</span> <span class="mi">295</span><span class="p">:</span>
      <span class="mi">368</span><span class="p">,</span> <span class="mi">296</span><span class="p">:</span> <span class="mi">369</span><span class="p">,</span> <span class="mi">297</span><span class="p">:</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">298</span><span class="p">:</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">299</span><span class="p">:</span> <span class="mi">372</span><span class="p">,</span> <span class="mi">300</span><span class="p">:</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">301</span><span class="p">:</span> <span class="mi">374</span><span class="p">,</span> <span class="mi">302</span><span class="p">:</span>
      <span class="mi">375</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&#39;number of Tx :&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">print</span> <span class="s">&#39;number of rx :&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>number of Tx : 302
number of rx : 4
</pre></div>
</div>
<p>Choose measurement points</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Chose used points here</span>

<span class="n">itx</span><span class="o">=</span><span class="mi">10</span>
<span class="n">irx</span><span class="o">=</span><span class="mi">2</span>


<span class="c"># check points</span>
<span class="n">tx</span><span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span>
<span class="n">rx</span><span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">irx</span><span class="p">]</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">UWBMesure</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="n">itx</span><span class="p">])</span>
<span class="n">txm</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">tx</span>
<span class="n">rxm</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="n">irx</span><span class="p">]</span>
<span class="k">print</span> <span class="n">tx</span><span class="p">,</span><span class="n">txm</span>
<span class="k">print</span> <span class="n">rx</span><span class="p">,</span><span class="n">rxm</span>

<span class="k">if</span> <span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">txm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">txm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Tx and Txm Are not the same !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&#39;</span>
<span class="k">else</span> <span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Txs OK&#39;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">rxm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rxm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Rx and Rxm Are not the same !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&#39;</span>
<span class="k">else</span> <span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Rxs OK&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[-24.867   12.3097   1.2   ] [-24.867   12.3097   1.2   ]
[-18.7747  15.178    1.2   ] [-18.7747  15.178    1.2   ]
Txs OK
Rxs OK
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_21_0.png" src="./SIM-where1_files/SIM-where1_21_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">M</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;tx&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="n">irx</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">M</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="n">irx</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;ob&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;rx&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x7fd83411d910&gt;
</pre></div>
</div>
</div>
<div class="section" id="signatures-rays-and-channel">
<h2>9.2. Signatures, Rays and channel<a class="headerlink" href="#signatures-rays-and-channel" title="Permalink to this headline">¶</a></h2>
<p>A signature is a sequence of layout objects (points and segments) which
are involved in a given optical ray joinint the transmiter and the
receiver. The signatutre is calculated from a layout cycle to an other
layout cycle. This means that is is required first to retrieve the cycle
number from point coordinates. This is done thanks to the <strong>pt2cy</strong>,
point to cycle function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ctx</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="n">crx</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&#39;tx point belongs to cycle &#39;</span><span class="p">,</span><span class="n">ctx</span>
<span class="k">print</span> <span class="s">&#39;rx point belongs to cycle &#39;</span><span class="p">,</span><span class="n">crx</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>tx point belongs to cycle  5
rx point belongs to cycle  4
</pre></div>
</div>
<p>Then the signature between cycle 5 and cycle 4 can be calculated. This
is done by instantiating a Signature object with a given layout and the
2 cycle number.</p>
<p>The representaion of a signature obje</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
<span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="mf">1.5</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">=</span><span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2d</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_30_1.png" src="./SIM-where1_files/SIM-where1_30_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">r2d</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_31_1.png" src="./SIM-where1_files/SIM-where1_31_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="n">r3d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Rays3D
----------
1 / 1 : [0]
2 / 5 : [1 2 3 4 5]
3 / 16 : [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
4 / 31 : [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46
 47 48 49 50 51 52]
5 / 34 : [53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77
 78 79 80 81 82 83 84 85 86]
6 / 18 : [ 87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104]
-----
ni : 461
nl : 1027
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Rays3D
----------
1 / 1 : [0]
2 / 5 : [1 2 3 4 5]
3 / 16 : [ 6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21]
4 / 31 : [22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46
 47 48 49 50 51 52]
5 / 34 : [53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77
 78 79 80 81 82 83 84 85 86]
6 / 18 : [ 87  88  89  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104]
-----
ni : 461
nl : 1027
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">freq</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span>  <span class="mf">2.</span>  <span class="p">,</span>   <span class="mf">2.05</span><span class="p">,</span>   <span class="mf">2.1</span> <span class="p">,</span>   <span class="mf">2.15</span><span class="p">,</span>   <span class="mf">2.2</span> <span class="p">,</span>   <span class="mf">2.25</span><span class="p">,</span>   <span class="mf">2.3</span> <span class="p">,</span>   <span class="mf">2.35</span><span class="p">,</span>
         <span class="mf">2.4</span> <span class="p">,</span>   <span class="mf">2.45</span><span class="p">,</span>   <span class="mf">2.5</span> <span class="p">,</span>   <span class="mf">2.55</span><span class="p">,</span>   <span class="mf">2.6</span> <span class="p">,</span>   <span class="mf">2.65</span><span class="p">,</span>   <span class="mf">2.7</span> <span class="p">,</span>   <span class="mf">2.75</span><span class="p">,</span>
         <span class="mf">2.8</span> <span class="p">,</span>   <span class="mf">2.85</span><span class="p">,</span>   <span class="mf">2.9</span> <span class="p">,</span>   <span class="mf">2.95</span><span class="p">,</span>   <span class="mf">3.</span>  <span class="p">,</span>   <span class="mf">3.05</span><span class="p">,</span>   <span class="mf">3.1</span> <span class="p">,</span>   <span class="mf">3.15</span><span class="p">,</span>
         <span class="mf">3.2</span> <span class="p">,</span>   <span class="mf">3.25</span><span class="p">,</span>   <span class="mf">3.3</span> <span class="p">,</span>   <span class="mf">3.35</span><span class="p">,</span>   <span class="mf">3.4</span> <span class="p">,</span>   <span class="mf">3.45</span><span class="p">,</span>   <span class="mf">3.5</span> <span class="p">,</span>   <span class="mf">3.55</span><span class="p">,</span>
         <span class="mf">3.6</span> <span class="p">,</span>   <span class="mf">3.65</span><span class="p">,</span>   <span class="mf">3.7</span> <span class="p">,</span>   <span class="mf">3.75</span><span class="p">,</span>   <span class="mf">3.8</span> <span class="p">,</span>   <span class="mf">3.85</span><span class="p">,</span>   <span class="mf">3.9</span> <span class="p">,</span>   <span class="mf">3.95</span><span class="p">,</span>
         <span class="mf">4.</span>  <span class="p">,</span>   <span class="mf">4.05</span><span class="p">,</span>   <span class="mf">4.1</span> <span class="p">,</span>   <span class="mf">4.15</span><span class="p">,</span>   <span class="mf">4.2</span> <span class="p">,</span>   <span class="mf">4.25</span><span class="p">,</span>   <span class="mf">4.3</span> <span class="p">,</span>   <span class="mf">4.35</span><span class="p">,</span>
         <span class="mf">4.4</span> <span class="p">,</span>   <span class="mf">4.45</span><span class="p">,</span>   <span class="mf">4.5</span> <span class="p">,</span>   <span class="mf">4.55</span><span class="p">,</span>   <span class="mf">4.6</span> <span class="p">,</span>   <span class="mf">4.65</span><span class="p">,</span>   <span class="mf">4.7</span> <span class="p">,</span>   <span class="mf">4.75</span><span class="p">,</span>
         <span class="mf">4.8</span> <span class="p">,</span>   <span class="mf">4.85</span><span class="p">,</span>   <span class="mf">4.9</span> <span class="p">,</span>   <span class="mf">4.95</span><span class="p">,</span>   <span class="mf">5.</span>  <span class="p">,</span>   <span class="mf">5.05</span><span class="p">,</span>   <span class="mf">5.1</span> <span class="p">,</span>   <span class="mf">5.15</span><span class="p">,</span>
         <span class="mf">5.2</span> <span class="p">,</span>   <span class="mf">5.25</span><span class="p">,</span>   <span class="mf">5.3</span> <span class="p">,</span>   <span class="mf">5.35</span><span class="p">,</span>   <span class="mf">5.4</span> <span class="p">,</span>   <span class="mf">5.45</span><span class="p">,</span>   <span class="mf">5.5</span> <span class="p">,</span>   <span class="mf">5.55</span><span class="p">,</span>
         <span class="mf">5.6</span> <span class="p">,</span>   <span class="mf">5.65</span><span class="p">,</span>   <span class="mf">5.7</span> <span class="p">,</span>   <span class="mf">5.75</span><span class="p">,</span>   <span class="mf">5.8</span> <span class="p">,</span>   <span class="mf">5.85</span><span class="p">,</span>   <span class="mf">5.9</span> <span class="p">,</span>   <span class="mf">5.95</span><span class="p">,</span>
         <span class="mf">6.</span>  <span class="p">,</span>   <span class="mf">6.05</span><span class="p">,</span>   <span class="mf">6.1</span> <span class="p">,</span>   <span class="mf">6.15</span><span class="p">,</span>   <span class="mf">6.2</span> <span class="p">,</span>   <span class="mf">6.25</span><span class="p">,</span>   <span class="mf">6.3</span> <span class="p">,</span>   <span class="mf">6.35</span><span class="p">,</span>
         <span class="mf">6.4</span> <span class="p">,</span>   <span class="mf">6.45</span><span class="p">,</span>   <span class="mf">6.5</span> <span class="p">,</span>   <span class="mf">6.55</span><span class="p">,</span>   <span class="mf">6.6</span> <span class="p">,</span>   <span class="mf">6.65</span><span class="p">,</span>   <span class="mf">6.7</span> <span class="p">,</span>   <span class="mf">6.75</span><span class="p">,</span>
         <span class="mf">6.8</span> <span class="p">,</span>   <span class="mf">6.85</span><span class="p">,</span>   <span class="mf">6.9</span> <span class="p">,</span>   <span class="mf">6.95</span><span class="p">,</span>   <span class="mf">7.</span>  <span class="p">,</span>   <span class="mf">7.05</span><span class="p">,</span>   <span class="mf">7.1</span> <span class="p">,</span>   <span class="mf">7.15</span><span class="p">,</span>
         <span class="mf">7.2</span> <span class="p">,</span>   <span class="mf">7.25</span><span class="p">,</span>   <span class="mf">7.3</span> <span class="p">,</span>   <span class="mf">7.35</span><span class="p">,</span>   <span class="mf">7.4</span> <span class="p">,</span>   <span class="mf">7.45</span><span class="p">,</span>   <span class="mf">7.5</span> <span class="p">,</span>   <span class="mf">7.55</span><span class="p">,</span>
         <span class="mf">7.6</span> <span class="p">,</span>   <span class="mf">7.65</span><span class="p">,</span>   <span class="mf">7.7</span> <span class="p">,</span>   <span class="mf">7.75</span><span class="p">,</span>   <span class="mf">7.8</span> <span class="p">,</span>   <span class="mf">7.85</span><span class="p">,</span>   <span class="mf">7.9</span> <span class="p">,</span>   <span class="mf">7.95</span><span class="p">,</span>
         <span class="mf">8.</span>  <span class="p">,</span>   <span class="mf">8.05</span><span class="p">,</span>   <span class="mf">8.1</span> <span class="p">,</span>   <span class="mf">8.15</span><span class="p">,</span>   <span class="mf">8.2</span> <span class="p">,</span>   <span class="mf">8.25</span><span class="p">,</span>   <span class="mf">8.3</span> <span class="p">,</span>   <span class="mf">8.35</span><span class="p">,</span>
         <span class="mf">8.4</span> <span class="p">,</span>   <span class="mf">8.45</span><span class="p">,</span>   <span class="mf">8.5</span> <span class="p">,</span>   <span class="mf">8.55</span><span class="p">,</span>   <span class="mf">8.6</span> <span class="p">,</span>   <span class="mf">8.65</span><span class="p">,</span>   <span class="mf">8.7</span> <span class="p">,</span>   <span class="mf">8.75</span><span class="p">,</span>
         <span class="mf">8.8</span> <span class="p">,</span>   <span class="mf">8.85</span><span class="p">,</span>   <span class="mf">8.9</span> <span class="p">,</span>   <span class="mf">8.95</span><span class="p">,</span>   <span class="mf">9.</span>  <span class="p">,</span>   <span class="mf">9.05</span><span class="p">,</span>   <span class="mf">9.1</span> <span class="p">,</span>   <span class="mf">9.15</span><span class="p">,</span>
         <span class="mf">9.2</span> <span class="p">,</span>   <span class="mf">9.25</span><span class="p">,</span>   <span class="mf">9.3</span> <span class="p">,</span>   <span class="mf">9.35</span><span class="p">,</span>   <span class="mf">9.4</span> <span class="p">,</span>   <span class="mf">9.45</span><span class="p">,</span>   <span class="mf">9.5</span> <span class="p">,</span>   <span class="mf">9.55</span><span class="p">,</span>
         <span class="mf">9.6</span> <span class="p">,</span>   <span class="mf">9.65</span><span class="p">,</span>   <span class="mf">9.7</span> <span class="p">,</span>   <span class="mf">9.75</span><span class="p">,</span>   <span class="mf">9.8</span> <span class="p">,</span>   <span class="mf">9.85</span><span class="p">,</span>   <span class="mf">9.9</span> <span class="p">,</span>   <span class="mf">9.95</span><span class="p">,</span>
        <span class="mf">10.</span>  <span class="p">,</span>  <span class="mf">10.05</span><span class="p">,</span>  <span class="mf">10.1</span> <span class="p">,</span>  <span class="mf">10.15</span><span class="p">,</span>  <span class="mf">10.2</span> <span class="p">,</span>  <span class="mf">10.25</span><span class="p">,</span>  <span class="mf">10.3</span> <span class="p">,</span>  <span class="mf">10.35</span><span class="p">,</span>
        <span class="mf">10.4</span> <span class="p">,</span>  <span class="mf">10.45</span><span class="p">,</span>  <span class="mf">10.5</span> <span class="p">,</span>  <span class="mf">10.55</span><span class="p">,</span>  <span class="mf">10.6</span> <span class="p">,</span>  <span class="mf">10.65</span><span class="p">,</span>  <span class="mf">10.7</span> <span class="p">,</span>  <span class="mf">10.75</span><span class="p">,</span>
        <span class="mf">10.8</span> <span class="p">,</span>  <span class="mf">10.85</span><span class="p">,</span>  <span class="mf">10.9</span> <span class="p">,</span>  <span class="mf">10.95</span><span class="p">,</span>  <span class="mf">11.</span>  <span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span> <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">freq</span><span class="p">())</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">energy</span></tt> method calculates the energy hoeld by each ray</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="n">array</span><span class="p">([</span>  <span class="mf">1.50717866e+00</span><span class="p">,</span>   <span class="mf">8.72383299e-01</span><span class="p">,</span>   <span class="mf">7.43948129e-01</span><span class="p">,</span>
          <span class="mf">5.88602827e-02</span><span class="p">,</span>   <span class="mf">6.49517588e-02</span><span class="p">,</span>   <span class="mf">6.82830760e-02</span><span class="p">,</span>
          <span class="mf">3.54534653e-02</span><span class="p">,</span>   <span class="mf">3.03303816e-02</span><span class="p">,</span>   <span class="mf">8.53310210e-03</span><span class="p">,</span>
          <span class="mf">9.71372168e-03</span><span class="p">,</span>   <span class="mf">1.34329862e-02</span><span class="p">,</span>   <span class="mf">5.11977619e-02</span><span class="p">,</span>
          <span class="mf">1.04359516e-01</span><span class="p">,</span>   <span class="mf">1.37194630e-04</span><span class="p">,</span>   <span class="mf">2.24881173e-04</span><span class="p">,</span>
          <span class="mf">5.56901244e-02</span><span class="p">,</span>   <span class="mf">1.07063235e-03</span><span class="p">,</span>   <span class="mf">5.29425486e-02</span><span class="p">,</span>
          <span class="mf">1.13768704e-03</span><span class="p">,</span>   <span class="mf">8.71270328e-03</span><span class="p">,</span>   <span class="mf">5.41494202e-03</span><span class="p">,</span>
          <span class="mf">9.58557439e-03</span><span class="p">,</span>   <span class="mf">2.79649101e-04</span><span class="p">,</span>   <span class="mf">6.10714650e-04</span><span class="p">,</span>
          <span class="mf">1.10020382e-02</span><span class="p">,</span>   <span class="mf">1.05690665e-02</span><span class="p">,</span>   <span class="mf">1.04372661e-05</span><span class="p">,</span>
          <span class="mf">1.25286783e-04</span><span class="p">,</span>   <span class="mf">6.33948908e-05</span><span class="p">,</span>   <span class="mf">5.87987972e-03</span><span class="p">,</span>
          <span class="mf">1.79390141e-04</span><span class="p">,</span>   <span class="mf">2.29893535e-02</span><span class="p">,</span>   <span class="mf">4.29389287e-05</span><span class="p">,</span>
          <span class="mf">1.00415449e-03</span><span class="p">,</span>   <span class="mf">1.02078797e-03</span><span class="p">,</span>   <span class="mf">6.65003548e-05</span><span class="p">,</span>
          <span class="mf">1.75349689e-06</span><span class="p">,</span>   <span class="mf">1.06828491e-02</span><span class="p">,</span>   <span class="mf">1.18747946e-02</span><span class="p">,</span>
          <span class="mf">1.51969989e-04</span><span class="p">,</span>   <span class="mf">7.50277086e-06</span><span class="p">,</span>   <span class="mf">2.22448129e-04</span><span class="p">,</span>
          <span class="mf">1.01132975e-05</span><span class="p">,</span>   <span class="mf">2.45454222e-04</span><span class="p">,</span>   <span class="mf">1.58291561e-04</span><span class="p">,</span>
          <span class="mf">3.33823329e-04</span><span class="p">,</span>   <span class="mf">2.11439212e-05</span><span class="p">,</span>   <span class="mf">1.09192028e-03</span><span class="p">,</span>
          <span class="mf">2.22112301e-04</span><span class="p">,</span>   <span class="mf">8.56044825e-04</span><span class="p">,</span>   <span class="mf">1.31056176e-03</span><span class="p">,</span>
          <span class="mf">1.02549588e-03</span><span class="p">,</span>   <span class="mf">2.00009116e-03</span><span class="p">,</span>   <span class="mf">1.72815139e-03</span><span class="p">,</span>
          <span class="mf">1.23562630e-03</span><span class="p">,</span>   <span class="mf">5.02095787e-05</span><span class="p">,</span>   <span class="mf">1.14052380e-04</span><span class="p">,</span>
          <span class="mf">8.05219626e-05</span><span class="p">,</span>   <span class="mf">3.28328138e-05</span><span class="p">,</span>   <span class="mf">6.44649760e-05</span><span class="p">,</span>
          <span class="mf">2.29734777e-04</span><span class="p">,</span>   <span class="mf">1.15802974e-04</span><span class="p">,</span>   <span class="mf">1.54155145e-05</span><span class="p">,</span>
          <span class="mf">1.97470536e-04</span><span class="p">,</span>   <span class="mf">1.19146330e-04</span><span class="p">,</span>   <span class="mf">2.16602036e-05</span><span class="p">,</span>
          <span class="mf">1.11553925e-04</span><span class="p">,</span>   <span class="mf">9.69270565e-03</span><span class="p">,</span>   <span class="mf">1.93607601e-03</span><span class="p">,</span>
          <span class="mf">5.93875349e-05</span><span class="p">,</span>   <span class="mf">7.12439444e-03</span><span class="p">,</span>   <span class="mf">9.68028356e-05</span><span class="p">,</span>
          <span class="mf">8.54211894e-05</span><span class="p">,</span>   <span class="mf">3.55405355e-05</span><span class="p">,</span>   <span class="mf">1.24790236e-03</span><span class="p">,</span>
          <span class="mf">2.21022661e-04</span><span class="p">,</span>   <span class="mf">1.75148699e-04</span><span class="p">,</span>   <span class="mf">6.50288223e-05</span><span class="p">,</span>
          <span class="mf">2.91193002e-04</span><span class="p">,</span>   <span class="mf">2.16224248e-03</span><span class="p">,</span>   <span class="mf">2.47123465e-03</span><span class="p">,</span>
          <span class="mf">1.18362263e-03</span><span class="p">,</span>   <span class="mf">5.75388808e-04</span><span class="p">,</span>   <span class="mf">2.91758477e-04</span><span class="p">,</span>
          <span class="mf">5.51046523e-04</span><span class="p">,</span>   <span class="mf">5.98355765e-04</span><span class="p">,</span>   <span class="mf">4.69812489e-04</span><span class="p">,</span>
          <span class="mf">1.51177319e-06</span><span class="p">,</span>   <span class="mf">1.39066087e-05</span><span class="p">,</span>   <span class="mf">2.77314071e-05</span><span class="p">,</span>
          <span class="mf">1.83960091e-04</span><span class="p">,</span>   <span class="mf">2.56338584e-04</span><span class="p">,</span>   <span class="mf">5.32258431e-06</span><span class="p">,</span>
          <span class="mf">5.95554013e-06</span><span class="p">,</span>   <span class="mf">1.32305177e-05</span><span class="p">,</span>   <span class="mf">5.32176083e-05</span><span class="p">,</span>
          <span class="mf">1.11130239e-03</span><span class="p">,</span>   <span class="mf">9.15109095e-05</span><span class="p">,</span>   <span class="mf">1.05832357e-03</span><span class="p">,</span>
          <span class="mf">8.60677065e-04</span><span class="p">,</span>   <span class="mf">8.27197200e-04</span><span class="p">,</span>   <span class="mf">1.54930324e-03</span><span class="p">,</span>
          <span class="mf">6.79953409e-04</span><span class="p">,</span>   <span class="mf">1.30889427e-03</span><span class="p">,</span>   <span class="mf">1.24607050e-03</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">1.29040779e+00</span><span class="p">,</span>   <span class="mf">8.48255132e-02</span><span class="p">,</span>   <span class="mf">1.17476989e-01</span><span class="p">,</span>
          <span class="mf">2.88212748e-01</span><span class="p">,</span>   <span class="mf">6.78736126e-02</span><span class="p">,</span>   <span class="mf">6.91178518e-02</span><span class="p">,</span>
          <span class="mf">1.30831387e-02</span><span class="p">,</span>   <span class="mf">1.71412387e-02</span><span class="p">,</span>   <span class="mf">9.18240805e-03</span><span class="p">,</span>
          <span class="mf">1.26936235e-02</span><span class="p">,</span>   <span class="mf">1.11250612e-02</span><span class="p">,</span>   <span class="mf">3.86908768e-03</span><span class="p">,</span>
          <span class="mf">4.72544843e-03</span><span class="p">,</span>   <span class="mf">3.28379115e-02</span><span class="p">,</span>   <span class="mf">2.59571206e-02</span><span class="p">,</span>
          <span class="mf">6.02854066e-03</span><span class="p">,</span>   <span class="mf">4.65726984e-02</span><span class="p">,</span>   <span class="mf">3.84255807e-03</span><span class="p">,</span>
          <span class="mf">3.70510573e-02</span><span class="p">,</span>   <span class="mf">9.23267268e-03</span><span class="p">,</span>   <span class="mf">5.60971604e-03</span><span class="p">,</span>
          <span class="mf">9.79610884e-03</span><span class="p">,</span>   <span class="mf">3.38476331e-03</span><span class="p">,</span>   <span class="mf">3.30074709e-03</span><span class="p">,</span>
          <span class="mf">4.37291852e-04</span><span class="p">,</span>   <span class="mf">3.28904147e-04</span><span class="p">,</span>   <span class="mf">7.73214589e-04</span><span class="p">,</span>
          <span class="mf">5.37997318e-04</span><span class="p">,</span>   <span class="mf">6.60788727e-04</span><span class="p">,</span>   <span class="mf">2.59344403e-04</span><span class="p">,</span>
          <span class="mf">4.77613852e-04</span><span class="p">,</span>   <span class="mf">6.52446705e-04</span><span class="p">,</span>   <span class="mf">1.19686862e-02</span><span class="p">,</span>
          <span class="mf">4.23869732e-03</span><span class="p">,</span>   <span class="mf">2.67919046e-03</span><span class="p">,</span>   <span class="mf">8.53586068e-04</span><span class="p">,</span>
          <span class="mf">2.59480959e-04</span><span class="p">,</span>   <span class="mf">6.82970439e-05</span><span class="p">,</span>   <span class="mf">1.11026500e-04</span><span class="p">,</span>
          <span class="mf">3.63094187e-03</span><span class="p">,</span>   <span class="mf">7.02005464e-06</span><span class="p">,</span>   <span class="mf">9.49443735e-06</span><span class="p">,</span>
          <span class="mf">6.91037039e-06</span><span class="p">,</span>   <span class="mf">1.98917235e-05</span><span class="p">,</span>   <span class="mf">4.15443320e-03</span><span class="p">,</span>
          <span class="mf">2.83134828e-03</span><span class="p">,</span>   <span class="mf">1.04707561e-05</span><span class="p">,</span>   <span class="mf">7.79799266e-03</span><span class="p">,</span>
          <span class="mf">2.74116760e-05</span><span class="p">,</span>   <span class="mf">9.02423326e-04</span><span class="p">,</span>   <span class="mf">1.35817604e-03</span><span class="p">,</span>
          <span class="mf">1.05432999e-03</span><span class="p">,</span>   <span class="mf">1.98147495e-03</span><span class="p">,</span>   <span class="mf">2.25382366e-04</span><span class="p">,</span>
          <span class="mf">3.13550015e-04</span><span class="p">,</span>   <span class="mf">1.16041899e-06</span><span class="p">,</span>   <span class="mf">3.01617274e-04</span><span class="p">,</span>
          <span class="mf">1.07050148e-03</span><span class="p">,</span>   <span class="mf">2.50402676e-03</span><span class="p">,</span>   <span class="mf">5.86416144e-03</span><span class="p">,</span>
          <span class="mf">2.21046915e-04</span><span class="p">,</span>   <span class="mf">6.98223402e-06</span><span class="p">,</span>   <span class="mf">4.34058789e-05</span><span class="p">,</span>
          <span class="mf">7.46483719e-06</span><span class="p">,</span>   <span class="mf">1.55312397e-04</span><span class="p">,</span>   <span class="mf">4.89785548e-05</span><span class="p">,</span>
          <span class="mf">1.05834613e-04</span><span class="p">,</span>   <span class="mf">3.18005296e-05</span><span class="p">,</span>   <span class="mf">1.39731044e-05</span><span class="p">,</span>
          <span class="mf">3.13832066e-04</span><span class="p">,</span>   <span class="mf">1.65210326e-05</span><span class="p">,</span>   <span class="mf">3.25523335e-04</span><span class="p">,</span>
          <span class="mf">1.47167228e-04</span><span class="p">,</span>   <span class="mf">4.79520767e-05</span><span class="p">,</span>   <span class="mf">7.06827360e-06</span><span class="p">,</span>
          <span class="mf">3.25336068e-04</span><span class="p">,</span>   <span class="mf">7.68029101e-04</span><span class="p">,</span>   <span class="mf">6.99467316e-05</span><span class="p">,</span>
          <span class="mf">1.54317487e-03</span><span class="p">,</span>   <span class="mf">7.57409296e-06</span><span class="p">,</span>   <span class="mf">8.83989381e-06</span><span class="p">,</span>
          <span class="mf">3.15505498e-04</span><span class="p">,</span>   <span class="mf">2.55271187e-03</span><span class="p">,</span>   <span class="mf">9.36639388e-04</span><span class="p">,</span>
          <span class="mf">2.03632807e-03</span><span class="p">,</span>   <span class="mf">1.80256361e-03</span><span class="p">,</span>   <span class="mf">1.72411395e-03</span><span class="p">,</span>
          <span class="mf">1.14694826e-04</span><span class="p">,</span>   <span class="mf">1.07381489e-04</span><span class="p">,</span>   <span class="mf">1.21995072e-06</span><span class="p">,</span>
          <span class="mf">5.13847570e-06</span><span class="p">,</span>   <span class="mf">1.24833836e-05</span><span class="p">,</span>   <span class="mf">1.84052608e-07</span><span class="p">,</span>
          <span class="mf">8.04727851e-07</span><span class="p">,</span>   <span class="mf">2.43500618e-07</span><span class="p">,</span>   <span class="mf">9.40367287e-07</span><span class="p">,</span>
          <span class="mf">2.80292080e-06</span><span class="p">,</span>   <span class="mf">1.50728522e-06</span><span class="p">,</span>   <span class="mf">2.21253510e-06</span><span class="p">,</span>
          <span class="mf">3.99573156e-06</span><span class="p">,</span>   <span class="mf">3.05226608e-06</span><span class="p">,</span>   <span class="mf">1.09471995e-05</span><span class="p">,</span>
          <span class="mf">3.38765449e-06</span><span class="p">,</span>   <span class="mf">1.32603318e-05</span><span class="p">,</span>   <span class="mf">8.71220302e-06</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">5.34880264e-02</span><span class="p">,</span>   <span class="mf">4.60803734e-03</span><span class="p">,</span>   <span class="mf">5.98041544e-03</span><span class="p">,</span>
          <span class="mf">1.48683145e-04</span><span class="p">,</span>   <span class="mf">4.28468974e-07</span><span class="p">,</span>   <span class="mf">1.39167132e-07</span><span class="p">,</span>
          <span class="mf">3.44648117e-04</span><span class="p">,</span>   <span class="mf">4.32988222e-04</span><span class="p">,</span>   <span class="mf">8.24459987e-02</span><span class="p">,</span>
          <span class="mf">7.54576478e-02</span><span class="p">,</span>   <span class="mf">1.63685453e-05</span><span class="p">,</span>   <span class="mf">6.92871619e-05</span><span class="p">,</span>
          <span class="mf">2.63244563e-04</span><span class="p">,</span>   <span class="mf">9.49397775e-06</span><span class="p">,</span>   <span class="mf">2.89314257e-04</span><span class="p">,</span>
          <span class="mf">9.73902592e-06</span><span class="p">,</span>   <span class="mf">1.38493859e-07</span><span class="p">,</span>   <span class="mf">1.72308550e-05</span><span class="p">,</span>
          <span class="mf">2.96402702e-05</span><span class="p">,</span>   <span class="mf">4.06921123e-04</span><span class="p">,</span>   <span class="mf">2.53204898e-04</span><span class="p">,</span>
          <span class="mf">4.45457011e-04</span><span class="p">,</span>   <span class="mf">3.00919230e-03</span><span class="p">,</span>   <span class="mf">2.74214745e-03</span><span class="p">,</span>
          <span class="mf">1.27043571e-03</span><span class="p">,</span>   <span class="mf">1.77472645e-03</span><span class="p">,</span>   <span class="mf">2.52976615e-05</span><span class="p">,</span>
          <span class="mf">3.19583383e-05</span><span class="p">,</span>   <span class="mf">1.26081852e-02</span><span class="p">,</span>   <span class="mf">1.66933899e-03</span><span class="p">,</span>
          <span class="mf">3.01657589e-02</span><span class="p">,</span>   <span class="mf">1.10767500e-05</span><span class="p">,</span>   <span class="mf">1.24368554e-06</span><span class="p">,</span>
          <span class="mf">4.61618831e-05</span><span class="p">,</span>   <span class="mf">7.68465623e-05</span><span class="p">,</span>   <span class="mf">1.24749021e-04</span><span class="p">,</span>
          <span class="mf">9.08952232e-05</span><span class="p">,</span>   <span class="mf">2.04096397e-03</span><span class="p">,</span>   <span class="mf">2.18918090e-03</span><span class="p">,</span>
          <span class="mf">7.27851376e-06</span><span class="p">,</span>   <span class="mf">7.75188889e-03</span><span class="p">,</span>   <span class="mf">7.27374331e-03</span><span class="p">,</span>
          <span class="mf">4.97618361e-03</span><span class="p">,</span>   <span class="mf">1.06649843e-02</span><span class="p">,</span>   <span class="mf">4.76817452e-05</span><span class="p">,</span>
          <span class="mf">5.32268958e-06</span><span class="p">,</span>   <span class="mf">8.83456410e-03</span><span class="p">,</span>   <span class="mf">1.52744749e-04</span><span class="p">,</span>
          <span class="mf">1.34937336e-03</span><span class="p">,</span>   <span class="mf">9.42567084e-09</span><span class="p">,</span>   <span class="mf">7.88070925e-09</span><span class="p">,</span>
          <span class="mf">2.19793421e-09</span><span class="p">,</span>   <span class="mf">1.33811600e-09</span><span class="p">,</span>   <span class="mf">7.65163723e-06</span><span class="p">,</span>
          <span class="mf">1.67915149e-05</span><span class="p">,</span>   <span class="mf">2.31902822e-05</span><span class="p">,</span>   <span class="mf">8.08145175e-06</span><span class="p">,</span>
          <span class="mf">4.54018611e-04</span><span class="p">,</span>   <span class="mf">1.42571737e-04</span><span class="p">,</span>   <span class="mf">4.03665450e-04</span><span class="p">,</span>
          <span class="mf">9.09425612e-06</span><span class="p">,</span>   <span class="mf">1.78502197e-03</span><span class="p">,</span>   <span class="mf">5.39685583e-05</span><span class="p">,</span>
          <span class="mf">2.08133755e-03</span><span class="p">,</span>   <span class="mf">2.09301490e-04</span><span class="p">,</span>   <span class="mf">6.67154780e-05</span><span class="p">,</span>
          <span class="mf">2.47958981e-04</span><span class="p">,</span>   <span class="mf">1.38657691e-05</span><span class="p">,</span>   <span class="mf">1.64801603e-04</span><span class="p">,</span>
          <span class="mf">2.14662346e-03</span><span class="p">,</span>   <span class="mf">6.08350344e-06</span><span class="p">,</span>   <span class="mf">5.80254804e-03</span><span class="p">,</span>
          <span class="mf">2.21523284e-04</span><span class="p">,</span>   <span class="mf">4.03132781e-05</span><span class="p">,</span>   <span class="mf">1.02701914e-04</span><span class="p">,</span>
          <span class="mf">5.50400930e-03</span><span class="p">,</span>   <span class="mf">3.64017129e-07</span><span class="p">,</span>   <span class="mf">1.02301766e-03</span><span class="p">,</span>
          <span class="mf">1.83143792e-05</span><span class="p">,</span>   <span class="mf">2.37637808e-04</span><span class="p">,</span>   <span class="mf">1.98007641e-04</span><span class="p">,</span>
          <span class="mf">3.21570896e-07</span><span class="p">,</span>   <span class="mf">2.47035172e-05</span><span class="p">,</span>   <span class="mf">1.97385201e-07</span><span class="p">,</span>
          <span class="mf">1.87117892e-05</span><span class="p">,</span>   <span class="mf">1.08760771e-06</span><span class="p">,</span>   <span class="mf">1.22245058e-05</span><span class="p">,</span>
          <span class="mf">2.88923701e-05</span><span class="p">,</span>   <span class="mf">1.22816094e-05</span><span class="p">,</span>   <span class="mf">6.13166338e-05</span><span class="p">,</span>
          <span class="mf">2.26194468e-05</span><span class="p">,</span>   <span class="mf">7.90626055e-06</span><span class="p">,</span>   <span class="mf">1.37317342e-05</span><span class="p">,</span>
          <span class="mf">1.22449783e-04</span><span class="p">,</span>   <span class="mf">1.31706875e-05</span><span class="p">,</span>   <span class="mf">2.52453549e-04</span><span class="p">,</span>
          <span class="mf">8.59336275e-07</span><span class="p">,</span>   <span class="mf">2.19348695e-04</span><span class="p">,</span>   <span class="mf">1.04655208e-06</span><span class="p">,</span>
          <span class="mf">2.10670000e-07</span><span class="p">,</span>   <span class="mf">2.22683794e-07</span><span class="p">,</span>   <span class="mf">3.94088500e-07</span><span class="p">,</span>
          <span class="mf">1.90411407e-07</span><span class="p">,</span>   <span class="mf">8.05127406e-08</span><span class="p">,</span>   <span class="mf">9.03272187e-08</span><span class="p">]),</span>
 <span class="n">array</span><span class="p">([</span>  <span class="mf">5.34880264e-02</span><span class="p">,</span>   <span class="mf">4.70253324e-04</span><span class="p">,</span>   <span class="mf">9.53453096e-04</span><span class="p">,</span>
          <span class="mf">3.25606682e-04</span><span class="p">,</span>   <span class="mf">4.28490165e-07</span><span class="p">,</span>   <span class="mf">1.39166488e-07</span><span class="p">,</span>
          <span class="mf">6.58052608e-03</span><span class="p">,</span>   <span class="mf">7.65589396e-03</span><span class="p">,</span>   <span class="mf">8.24459987e-02</span><span class="p">,</span>
          <span class="mf">7.54576478e-02</span><span class="p">,</span>   <span class="mf">8.15320469e-06</span><span class="p">,</span>   <span class="mf">1.70511440e-05</span><span class="p">,</span>
          <span class="mf">5.41592552e-05</span><span class="p">,</span>   <span class="mf">4.98194314e-04</span><span class="p">,</span>   <span class="mf">8.32929767e-06</span><span class="p">,</span>
          <span class="mf">1.97219406e-05</span><span class="p">,</span>   <span class="mf">2.06240611e-06</span><span class="p">,</span>   <span class="mf">3.16796161e-05</span><span class="p">,</span>
          <span class="mf">5.92109220e-04</span><span class="p">,</span>   <span class="mf">4.06915344e-04</span><span class="p">,</span>   <span class="mf">2.53194360e-04</span><span class="p">,</span>
          <span class="mf">4.45457563e-04</span><span class="p">,</span>   <span class="mf">1.01712501e-02</span><span class="p">,</span>   <span class="mf">1.06245290e-02</span><span class="p">,</span>
          <span class="mf">1.12214708e-04</span><span class="p">,</span>   <span class="mf">1.19484728e-04</span><span class="p">,</span>   <span class="mf">1.72028890e-02</span><span class="p">,</span>
          <span class="mf">4.14885260e-02</span><span class="p">,</span>   <span class="mf">2.95876839e-05</span><span class="p">,</span>   <span class="mf">2.65130124e-03</span><span class="p">,</span>
          <span class="mf">4.03814948e-05</span><span class="p">,</span>   <span class="mf">1.04625183e-05</span><span class="p">,</span>   <span class="mf">1.07969229e-06</span><span class="p">,</span>
          <span class="mf">1.20402997e-05</span><span class="p">,</span>   <span class="mf">1.19188861e-05</span><span class="p">,</span>   <span class="mf">2.30644740e-02</span><span class="p">,</span>
          <span class="mf">2.59905782e-02</span><span class="p">,</span>   <span class="mf">1.69084386e-03</span><span class="p">,</span>   <span class="mf">1.70711486e-03</span><span class="p">,</span>
          <span class="mf">1.03146050e-06</span><span class="p">,</span>   <span class="mf">1.02227094e-03</span><span class="p">,</span>   <span class="mf">6.39981720e-04</span><span class="p">,</span>
          <span class="mf">1.01244884e-03</span><span class="p">,</span>   <span class="mf">1.59704915e-03</span><span class="p">,</span>   <span class="mf">1.82803331e-06</span><span class="p">,</span>
          <span class="mf">4.31836935e-05</span><span class="p">,</span>   <span class="mf">1.98386471e-03</span><span class="p">,</span>   <span class="mf">2.05740738e-05</span><span class="p">,</span>
          <span class="mf">8.38930939e-03</span><span class="p">,</span>   <span class="mf">5.47689702e-09</span><span class="p">,</span>   <span class="mf">3.34939470e-09</span><span class="p">,</span>
          <span class="mf">2.87072999e-09</span><span class="p">,</span>   <span class="mf">1.43614814e-09</span><span class="p">,</span>   <span class="mf">7.67176734e-06</span><span class="p">,</span>
          <span class="mf">6.33927227e-05</span><span class="p">,</span>   <span class="mf">1.36598438e-03</span><span class="p">,</span>   <span class="mf">4.69152228e-04</span><span class="p">,</span>
          <span class="mf">3.65816261e-05</span><span class="p">,</span>   <span class="mf">1.96997168e-04</span><span class="p">,</span>   <span class="mf">5.35532355e-04</span><span class="p">,</span>
          <span class="mf">2.97339170e-05</span><span class="p">,</span>   <span class="mf">6.06628498e-05</span><span class="p">,</span>   <span class="mf">1.44729065e-03</span><span class="p">,</span>
          <span class="mf">6.98300846e-05</span><span class="p">,</span>   <span class="mf">4.57851393e-05</span><span class="p">,</span>   <span class="mf">1.71312609e-03</span><span class="p">,</span>
          <span class="mf">5.91728217e-05</span><span class="p">,</span>   <span class="mf">4.27614714e-07</span><span class="p">,</span>   <span class="mf">2.67767172e-04</span><span class="p">,</span>
          <span class="mf">1.85128730e-05</span><span class="p">,</span>   <span class="mf">8.93871167e-08</span><span class="p">,</span>   <span class="mf">3.84234643e-05</span><span class="p">,</span>
          <span class="mf">3.75284889e-04</span><span class="p">,</span>   <span class="mf">2.04557194e-03</span><span class="p">,</span>   <span class="mf">1.05410482e-04</span><span class="p">,</span>
          <span class="mf">1.79143739e-04</span><span class="p">,</span>   <span class="mf">1.80964837e-07</span><span class="p">,</span>   <span class="mf">9.14758218e-04</span><span class="p">,</span>
          <span class="mf">2.13176317e-05</span><span class="p">,</span>   <span class="mf">2.26183135e-04</span><span class="p">,</span>   <span class="mf">1.74356891e-04</span><span class="p">,</span>
          <span class="mf">1.54182553e-07</span><span class="p">,</span>   <span class="mf">2.84784687e-05</span><span class="p">,</span>   <span class="mf">2.85562209e-07</span><span class="p">,</span>
          <span class="mf">1.67352836e-05</span><span class="p">,</span>   <span class="mf">1.50085136e-06</span><span class="p">,</span>   <span class="mf">1.04969768e-05</span><span class="p">,</span>
          <span class="mf">1.76917818e-05</span><span class="p">,</span>   <span class="mf">2.62365597e-05</span><span class="p">,</span>   <span class="mf">8.81455569e-06</span><span class="p">,</span>
          <span class="mf">8.02351625e-07</span><span class="p">,</span>   <span class="mf">2.43210557e-08</span><span class="p">,</span>   <span class="mf">9.31884630e-05</span><span class="p">,</span>
          <span class="mf">7.37771985e-06</span><span class="p">,</span>   <span class="mf">8.43374338e-05</span><span class="p">,</span>   <span class="mf">3.79100648e-05</span><span class="p">,</span>
          <span class="mf">2.51109657e-07</span><span class="p">,</span>   <span class="mf">3.08731683e-05</span><span class="p">,</span>   <span class="mf">3.16445653e-07</span><span class="p">,</span>
          <span class="mf">1.95783318e-07</span><span class="p">,</span>   <span class="mf">2.12930276e-07</span><span class="p">,</span>   <span class="mf">2.53116911e-07</span><span class="p">,</span>
          <span class="mf">1.11909010e-07</span><span class="p">,</span>   <span class="mf">8.11390058e-08</span><span class="p">,</span>   <span class="mf">9.07842766e-08</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>9.3. Apply waveform<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">freq</span>
<span class="n">sco</span><span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">)</span>
<span class="n">sca</span><span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;W1offset&#39;</span><span class="p">)</span>
<span class="c">#wav = wvf.Waveform({&#39;type&#39; : &#39;generic&#39;,&#39;band&#39;: 0.499,&#39;fc&#39;: 4.493, &#39;fe&#39;: 100, &#39;thresh&#39;: 3, &#39;tw&#39;: 30})</span>
<span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_40_0.png" src="./SIM-where1_files/SIM-where1_40_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">ciro</span> <span class="o">=</span> <span class="n">sco</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
<span class="n">cira</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ciro</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">u&#39;received waveform without antenna $</span><span class="se">\\</span><span class="s">theta</span><span class="se">\\</span><span class="s">theta$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_42_2.png" src="./SIM-where1_files/SIM-where1_42_2.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">cira</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;received waveform with antenna&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0xfe125d0&gt;
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_43_1.png" src="./SIM-where1_files/SIM-where1_43_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="c">#dchan={i:&#39;ch&#39;+str(i) for i in range(1,5)}</span>
<span class="n">dchan</span><span class="o">=</span><span class="p">{}</span>
<span class="n">dchan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;ch3&#39;</span>
<span class="n">dchan</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;ch4&#39;</span>
<span class="n">dchan</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;ch1&#39;</span>
<span class="n">dchan</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;ch2&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Measurements&quot;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">=</span><span class="s">&#39;M.tdd.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dchan</span><span class="p">[</span><span class="n">irx</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;.plot(ax=ax1)&#39;</span>
<span class="nb">eval</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;WHERE1 measurement&#39;</span><span class="p">)</span>
<span class="c">#M.tdd.ch2.plot()</span>
<span class="c"># align for plotting</span>
<span class="c">#ciro.x=ciro.x-ciro.x[0]</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&quot;Simulation-with antenna&quot;</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">cira</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Simulation-with antenna - without noise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c">#ax3 = fig.add_subplot(313,title=&quot;Simulation-without antenna&quot;,sharex=ax1, sharey=ax1)</span>
<span class="c">#ciro.plot()</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_45_0.png" src="./SIM-where1_files/SIM-where1_45_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="n">tx</span><span class="o">-</span><span class="n">rx</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>

<span class="k">print</span> <span class="s">&#39;real delay between tx and rx&#39;</span><span class="p">,</span><span class="n">d</span><span class="o">/</span><span class="mf">0.3</span>
<span class="k">print</span> <span class="s">&#39;simulated first path delay&#39;</span><span class="p">,</span><span class="n">r3d</span><span class="o">.</span><span class="n">delays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>real delay between tx and rx 22.4680672606
simulated first path delay 22.4680672606
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">.</span><span class="n">delays</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span>  <span class="mf">22.46806726</span><span class="p">,</span>   <span class="mf">24.18292882</span><span class="p">,</span>   <span class="mf">24.99628065</span><span class="p">,</span>   <span class="mf">25.87437157</span><span class="p">,</span>
         <span class="mf">42.95559158</span><span class="p">,</span>   <span class="mf">51.79056452</span><span class="p">,</span>   <span class="mf">27.37668906</span><span class="p">,</span>   <span class="mf">28.09774198</span><span class="p">,</span>
         <span class="mf">29.40772086</span><span class="p">,</span>   <span class="mf">30.73782761</span><span class="p">,</span>   <span class="mf">41.71071752</span><span class="p">,</span>   <span class="mf">43.87690563</span><span class="p">,</span>
         <span class="mf">44.3303829</span> <span class="p">,</span>   <span class="mf">44.83132695</span><span class="p">,</span>   <span class="mf">45.78534275</span><span class="p">,</span>   <span class="mf">52.55723141</span><span class="p">,</span>
         <span class="mf">52.83546805</span><span class="p">,</span>   <span class="mf">52.93640121</span><span class="p">,</span>   <span class="mf">53.35513533</span><span class="p">,</span>   <span class="mf">57.24533827</span><span class="p">,</span>
         <span class="mf">73.04881379</span><span class="p">,</span>   <span class="mf">77.74128409</span><span class="p">,</span>   <span class="mf">32.08555912</span><span class="p">,</span>   <span class="mf">33.30890428</span><span class="p">,</span>
         <span class="mf">42.65892586</span><span class="p">,</span>   <span class="mf">43.12521253</span><span class="p">,</span>   <span class="mf">45.714854</span>  <span class="p">,</span>   <span class="mf">46.15027493</span><span class="p">,</span>
         <span class="mf">46.65080504</span><span class="p">,</span>   <span class="mf">46.95937444</span><span class="p">,</span>   <span class="mf">47.07757014</span><span class="p">,</span>   <span class="mf">47.80358614</span><span class="p">,</span>
         <span class="mf">48.77327119</span><span class="p">,</span>   <span class="mf">53.58718769</span><span class="p">,</span>   <span class="mf">53.95912049</span><span class="p">,</span>   <span class="mf">54.09963462</span><span class="p">,</span>
         <span class="mf">54.46806832</span><span class="p">,</span>   <span class="mf">55.15670923</span><span class="p">,</span>   <span class="mf">55.87720978</span><span class="p">,</span>   <span class="mf">56.27546336</span><span class="p">,</span>
         <span class="mf">57.93987188</span><span class="p">,</span>   <span class="mf">58.28403515</span><span class="p">,</span>   <span class="mf">73.59435574</span><span class="p">,</span>   <span class="mf">73.8656158</span> <span class="p">,</span>
         <span class="mf">74.74796992</span><span class="p">,</span>   <span class="mf">75.18892262</span><span class="p">,</span>   <span class="mf">78.25411972</span><span class="p">,</span>   <span class="mf">78.44138572</span><span class="p">,</span>
         <span class="mf">78.50928131</span><span class="p">,</span>   <span class="mf">78.54342153</span><span class="p">,</span>   <span class="mf">87.50257849</span><span class="p">,</span>   <span class="mf">99.12940895</span><span class="p">,</span>
        <span class="mf">104.69401317</span><span class="p">,</span>   <span class="mf">45.82339965</span><span class="p">,</span>   <span class="mf">46.68815648</span><span class="p">,</span>   <span class="mf">48.68108335</span><span class="p">,</span>
         <span class="mf">49.49593798</span><span class="p">,</span>   <span class="mf">49.56104933</span><span class="p">,</span>   <span class="mf">49.58661092</span><span class="p">,</span>   <span class="mf">49.98831846</span><span class="p">,</span>
         <span class="mf">50.36166807</span><span class="p">,</span>   <span class="mf">56.13899433</span><span class="p">,</span>   <span class="mf">56.62835391</span><span class="p">,</span>   <span class="mf">56.8470464</span> <span class="p">,</span>
         <span class="mf">56.9818197</span> <span class="p">,</span>   <span class="mf">57.33036252</span><span class="p">,</span>   <span class="mf">57.33173446</span><span class="p">,</span>   <span class="mf">60.30778352</span><span class="p">,</span>
         <span class="mf">60.96744011</span><span class="p">,</span>   <span class="mf">75.28119956</span><span class="p">,</span>   <span class="mf">75.47270498</span><span class="p">,</span>   <span class="mf">75.54640301</span><span class="p">,</span>
         <span class="mf">75.71904704</span><span class="p">,</span>   <span class="mf">75.98272228</span><span class="p">,</span>   <span class="mf">76.00084997</span><span class="p">,</span>   <span class="mf">78.9496738</span> <span class="p">,</span>
         <span class="mf">79.05105354</span><span class="p">,</span>   <span class="mf">79.20259461</span><span class="p">,</span>   <span class="mf">79.30365102</span><span class="p">,</span>   <span class="mf">80.02316697</span><span class="p">,</span>
         <span class="mf">80.52147075</span><span class="p">,</span>   <span class="mf">87.95852001</span><span class="p">,</span>   <span class="mf">88.18560678</span><span class="p">,</span>   <span class="mf">99.53210396</span><span class="p">,</span>
         <span class="mf">99.73284172</span><span class="p">,</span>  <span class="mf">105.07538433</span><span class="p">,</span>  <span class="mf">105.26555179</span><span class="p">,</span>   <span class="mf">52.33385121</span><span class="p">,</span>
         <span class="mf">53.09267353</span><span class="p">,</span>   <span class="mf">59.38794302</span><span class="p">,</span>   <span class="mf">60.05770372</span><span class="p">,</span>   <span class="mf">77.11847384</span><span class="p">,</span>
         <span class="mf">77.54594822</span><span class="p">,</span>   <span class="mf">77.63542367</span><span class="p">,</span>   <span class="mf">78.06006716</span><span class="p">,</span>   <span class="mf">80.70347572</span><span class="p">,</span>
         <span class="mf">80.80265506</span><span class="p">,</span>   <span class="mf">81.19760461</span><span class="p">,</span>   <span class="mf">81.29618112</span><span class="p">,</span>   <span class="mf">89.53603321</span><span class="p">,</span>
         <span class="mf">89.98167171</span><span class="p">,</span>  <span class="mf">100.92888446</span><span class="p">,</span>  <span class="mf">101.32442804</span><span class="p">,</span>  <span class="mf">106.39941914</span><span class="p">,</span>
        <span class="mf">106.77469922</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r3d</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>-------------------------
Informations of ray # 0
-------------------------

Index , type, slab      , th(rad), alpha     , gamma2
    0 , B0  , -         , -      , -         , -
    0 , T   , PARTITION ,    0.43,  (0.35+0j),  (0.88+0j)
    0 , B   , -         , -      , -         , -

----------------------------------------
 Matrix of ray # 0 at f= 2.0
----------------------------------------
rotation matrix# type: B0
[[-0.99533359 -0.09649373]
 [ 0.09649373 -0.99533359]]
interaction # 0 type: T
[[ 0.29697185+0.47269683j  0.00000000+0.j        ]
 [ 0.00000000+0.j          0.34443500+0.50490218j]]
rotation matrix# [0] type: B
[[ 0.99533359  0.09649373]
 [-0.09649373  0.99533359]]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Ct</span><span class="o">.</span><span class="n">doadod</span><span class="p">(</span><span class="n">phi</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
</pre></div>
</div>
<img alt="./SIM-where1_files/SIM-where1_49_0.png" src="./SIM-where1_files/SIM-where1_49_0.png" />
</div>
<div class="section" id="example-of-a-trajectory-synthesis-in-dlr-where2-environment">
<h2>9.4. Example of a trajectory synthesis in DLR WHERE2 environment<a class="headerlink" href="#example-of-a-trajectory-synthesis-in-dlr-where2-environment" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>This function has to be moved in simulem module. It is a temporary
implementation. Signatures can be handled much more efficiently here. It
run a full simulation and returns a list of channel impulse response.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">evalcir</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    S</span>
<span class="sd">    tx</span>
<span class="sd">    rx</span>
<span class="sd">    wav</span>
<span class="sd">    cutoff</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">crxp</span> <span class="o">=-</span><span class="mi">1</span>
    <span class="n">ctxp</span> <span class="o">=-</span><span class="mi">1</span>
    <span class="n">tcir</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span>
    <span class="n">Ntx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">rx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span>
    <span class="n">Nrx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c">#for kt in range(1,Ntx-1):</span>
    <span class="c">#print kt+1</span>
    <span class="n">kt</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">tcir</span><span class="p">[</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">kr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nrx</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">mod</span><span class="p">(</span><span class="n">kr</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">kr</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">kr</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">kr</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">kr</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">crx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ctx</span><span class="o">&lt;&gt;</span><span class="n">ctxp</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">crx</span><span class="o">&lt;&gt;</span><span class="n">crxp</span><span class="p">):</span>
            <span class="n">Si</span>  <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
            <span class="n">ctxp</span> <span class="o">=</span> <span class="n">ctx</span>
            <span class="n">crxp</span> <span class="o">=</span> <span class="n">crx</span>
            <span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span><span class="n">algo</span><span class="o">=</span><span class="s">&#39;old&#39;</span><span class="p">)</span>
        <span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
        <span class="c">#r2d.show(S.L)</span>

        <span class="n">r3d</span> <span class="o">=</span> <span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="n">Ct</span>  <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="n">sca</span> <span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="n">cir</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
        <span class="n">tcir</span><span class="p">[</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">kr</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">cir</span>
    <span class="k">return</span><span class="p">(</span><span class="n">tcir</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="n">filestr</span> <span class="o">=</span> <span class="s">&#39;DLR2&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">layout</span><span class="p">(</span><span class="n">filestr</span><span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">,</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;DLR WP4 WHERE2 measurement site&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_6_0.png" src="./SIM-trajectory_files/SIM-trajectory_6_0.png" />
<p>We have a list of static Anchor Nodes. Those values correspond to the
actual anchor nodes coordinates of the WHERE2 project DLR measurement
campaign.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AnchorNodes</span> <span class="o">=</span> <span class="p">{</span><span class="mi">390</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_ACO_05&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mi">6</span><span class="p">,</span><span class="mf">0.81</span><span class="p">,</span><span class="mf">1.64</span><span class="p">]},</span>
               <span class="mi">386</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_ACO_08&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">30.574</span><span class="p">,</span><span class="mf">2.8</span><span class="p">,</span><span class="mf">1.291</span><span class="p">]},</span>
               <span class="mi">391</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_ACO_07&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">11.78</span><span class="p">,</span><span class="o">-</span><span class="mf">5.553</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]},</span>
               <span class="mi">385</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;MT_ACO_01&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">19.52</span><span class="p">,</span><span class="o">-</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">1.446</span><span class="p">]},</span>
               <span class="mi">387</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_ACO_03&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">28.606</span><span class="p">,</span><span class="o">-</span><span class="mf">0.74</span><span class="p">,</span><span class="mf">1.467</span><span class="p">]},</span>
               <span class="mi">400</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_ACO_02&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">30.574</span><span class="p">,</span><span class="mf">2.8</span><span class="p">,</span><span class="mf">1.291</span><span class="p">]},</span>
               <span class="mi">1</span><span class="p">:{</span><span class="s">&#39;name&#39;</span><span class="p">:</span><span class="s">&#39;MT_DLR_RTDSlave&#39;</span><span class="p">,</span><span class="s">&#39;coord&#39;</span><span class="p">:[</span><span class="mf">0.85</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.18</span><span class="p">]}</span>
              <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">filant</span><span class="o">=</span><span class="s">&#39;def.vsh3&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">filant</span><span class="o">=</span><span class="s">&#39;def.vsh3&#39;</span>
<span class="n">da</span> <span class="o">=</span><span class="p">{}</span>
<span class="n">dm</span> <span class="o">=</span><span class="p">{}</span>
</pre></div>
</div>
<p>Vizualization of the simulated scenario</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="c">#</span>
<span class="c"># add new points in tx and rx</span>
<span class="c">#</span>
<span class="c">#for c,k in enumerate(AnchorNodes):</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># first anchor nodes</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">AnchorNodes</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">c</span><span class="p">]</span>
<span class="n">pta</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">AnchorNodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;coord&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">AnchorNodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;coord&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">AnchorNodes</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;coord&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#</span>
<span class="c"># To add a point</span>
<span class="c">#</span>
<span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;add&quot;</span><span class="p">)</span>
<span class="n">da</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">=</span><span class="n">k</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[&lt;matplotlib.lines.Line2D at 0x7fa00e25bcd0&gt;]
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_11_1.png" src="./SIM-trajectory_files/SIM-trajectory_11_1.png" />
<p>In the following a trajectory for the receiver is defined.</p>
<p><tt class="docutils literal"><span class="pre">linevect</span></tt> function allows to define a linear trajectory from <tt class="docutils literal"><span class="pre">ptt</span></tt>
along direction <tt class="docutils literal"><span class="pre">vec</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">linevect</span><span class="p">(</span><span class="n">npt</span><span class="o">=</span><span class="mi">290</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ptt</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.275</span><span class="p">],</span> <span class="n">vec</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;subst&#39;</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">linevect</span><span class="p">(</span><span class="n">npt</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">ptt</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span><span class="n">vec</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;append&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Looking what is does</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
<span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;Trajectory to be simulated&#39;</span>
<span class="n">S</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_15_2.png" src="./SIM-trajectory_files/SIM-trajectory_15_2.png" />
<p>Choosing a UWB waveform for the simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;W1compensate&#39;</span><span class="p">)</span>
<span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_17_0.png" src="./SIM-trajectory_files/SIM-trajectory_17_0.png" />
<p>running the simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#tcir = evalcir(S,wav,cutoff=4)</span>
</pre></div>
</div>
<p>Saving the data in pickle format</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#file = open(&quot;tcir5.pickle&quot;,&quot;w&quot;)</span>
<span class="c">#pickle.dump(tcir,file)</span>
<span class="c">#file.close()</span>
</pre></div>
</div>
<p>Reading the data from the above file</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#del tcir</span>
<span class="nb">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;tcir5.pickle&quot;</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">)</span>
<span class="n">tcir</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
<span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tcir</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">cir</span> <span class="o">=</span> <span class="n">tcir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">cir</span><span class="o">.</span><span class="n">zlr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ttcir</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ttcir</span><span class="p">,</span><span class="n">cir</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">ttcir</span><span class="o">=</span><span class="n">cir</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">dmax</span><span class="o">=</span><span class="mi">150</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ttcir</span><span class="o">+</span><span class="mf">1e-20</span><span class="p">),</span><span class="n">vmax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">120</span><span class="p">,</span><span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">dmax</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">69</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;delay $\times$ c (meters)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="c">#plt.ylabel(r&#39;distance along trajectory (meters)&#39;,fontsize=20)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;trajectory index number&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">clb</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;level (dB)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">69.0</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_25_1.png" src="./SIM-trajectory_files/SIM-trajectory_25_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">tcir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_26_2.png" src="./SIM-trajectory_files/SIM-trajectory_26_2.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">tcir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Delay (ns)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Level (V)&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Received Waveform&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_27_2.png" src="./SIM-trajectory_files/SIM-trajectory_27_2.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">tcir</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Delay (ns)&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Level (V)&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Received Waveform&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x553bd50&gt;
</pre></div>
</div>
<img alt="./SIM-trajectory_files/SIM-trajectory_28_1.png" src="./SIM-trajectory_files/SIM-trajectory_28_1.png" />
</div>
</div>
<div class="section" id="handling-human-mobility">
<h1>10. Handling Human mobility<a class="headerlink" href="#handling-human-mobility" title="Permalink to this headline">¶</a></h1>
<p>The body mobility is described at two different level, the body level (small
scale) and the trajectory level (large scale)</p>
<div class="section" id="body-mobility">
<h2>10.1. Body Mobility<a class="headerlink" href="#body-mobility" title="Permalink to this headline">¶</a></h2>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.mobility.body.body</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.mobility.trajectory</span> <span class="kn">import</span> <span class="n">Trajectory</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.figure.Figure at 0x894a310&gt;
</pre></div>
</div>
<p>The body mobility is imported from motion capture files. This is the
chosen manner to achieve a high degree of realism for the modeling of
the human motion. Two kind of files exist :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">c3d</span></tt> files are a set of point which are evolving in time</li>
<li><tt class="docutils literal"><span class="pre">bvh</span></tt> files are a stuctured version of the motion capture.</li>
</ul>
<p>Both type of file will be exploited in the following.</p>
<div class="section" id="bodycylinder-data-structure">
<h3>10.1.1. <tt class="docutils literal"><span class="pre">BodyCylinder</span></tt> data structure<a class="headerlink" href="#bodycylinder-data-structure" title="Permalink to this headline">¶</a></h3>
<p>To ease electromagnetic simulation a simplification of the motion
capture data structure is necessary. Generally there is a large number
of captured points, not all of them being useful for the modeling.</p>
<p>The body model is a restriction of key body segments which are
transformed into <img src="../_images/mathmpl/math-b43c97c188.png" style="position: relative; bottom: -3px"/> cylinders of radius <img src="../_images/mathmpl/math-32ed7041d6.png" style="position: relative; bottom: -7px"/>.</p>
<p>The chosen body model is made of 11 cylinders. 4 cylinders decribing the
two arms, 4 cylinders decribing the two legs, 2 cylinders describing the
trunk and 1 cylinder for the head.</p>
<p>The body cylinder model is handle by a dedicated Python class call
<tt class="docutils literal"><span class="pre">Body</span></tt></p>
<p>To create a void body, simply instantiate a Body object from the class</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span> <span class="o">=</span> <span class="n">Body</span><span class="p">()</span>
</pre></div>
</div>
<p>which is equivalent to :</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(</span><span class="n">_filebody</span><span class="o">=</span><span class="s">&#39;John.ini&#39;</span><span class="p">,</span><span class="n">_filemocap</span><span class="o">=</span><span class="s">&#39;07_01.c3d&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The default body filename is John.ini and the default motion capture
filename is &#8216;07_01.c3d&#8217;. The creation of a Body consists in reading a
<tt class="docutils literal"><span class="pre">_filebody</span></tt> and a <tt class="docutils literal"><span class="pre">_filemocap</span></tt></p>
</div>
<div class="section" id="description-of-a-body-file">
<h3>10.1.2. Description of a body file<a class="headerlink" href="#description-of-a-body-file" title="Permalink to this headline">¶</a></h3>
<p>An example of a body file is given below. It is a file in <tt class="docutils literal"><span class="pre">ini</span></tt> format
with 4 sections.</p>
<ul class="simple">
<li>[nodes]</li>
</ul>
<p>This section associates a node number to a c3d fils conventional node
number</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">NodeId</span> <span class="o">=</span> <span class="n">C3DNODE</span>
</pre></div>
</div>
<ul class="simple">
<li>[cylinder]</li>
</ul>
<p>This section associates a cylinder Id to a dictionnary wich contains
cylinder tail head and radius information</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CylId</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="n">NodeId1</span><span class="p">,</span><span class="s">&#39;h&#39;</span><span class="p">,</span><span class="n">NodeId2</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="nb">float</span> <span class="p">(</span><span class="n">m</span><span class="p">),</span><span class="s">&#39;name&#39;</span><span class="p">,}</span>
</pre></div>
</div>
<ul class="simple">
<li>[device]</li>
</ul>
<p>This section associates a device name to a dictionnary wich contains
cylinder device related information</p>
<div class="highlight-python"><div class="highlight"><pre>DevId = {&#39;typ&#39; : {static|mobile}
          &#39;cyl&#39;: CylId
          &#39;l&#39;  : length coordinate in ccs,
          &#39;h&#39;  : height coordinate in ccs,
          &#39;a&#39;  : angle coordinate in ccs,
          &#39;file&#39; : antenna file ,
          &#39;T&#39; : Rotation matrix }
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre>#%load /home/uguen/Bureau/P1/ini/Francois.ini
            [nodes]
0 = STRN
1 = CLAV
2 = RFHD
3 =RSHO
4 =LSHO
5 =RELB
6 =LELB
7 =RWRB
8 =LWRB
9 =RFWT
10 =LFWT
11 =RKNE
12 =LKNE
13 =RANK
14 =LANK
15 =BOTT
[cylinder]
; sternum (STRN) - clavicule (CLAV)
trunku = {&#39;t&#39;:0,&#39;h&#39;:1,&#39;r&#39;:0.18,&#39;i&#39;:0}
; bottom  (BOTT) sternum (STRN)
trunkb = {&#39;t&#39;:15,&#39;h&#39;:0,&#39;r&#39;:0.17,&#39;i&#39;:10}
; clavicule (CLAV)  - tete (RFHD)
headu = {&#39;t&#39;:1,&#39;h&#39;:2,&#39;r&#39;:0.12,&#39;i&#39;:1}
; coude droit (RELB)  epaule droite (RSHO)
armr = {&#39;t&#39;:5,&#39;h&#39;:3,&#39;r&#39;:0.05,&#39;i&#39;:2}
; coude gauche (LELB)  epaule gauche (LSHO)
arml  = {&#39;t&#39;:6,&#39;h&#39;:4,&#39;r&#39;:0.05,&#39;i&#39;:3}
; poignet droit (RWRB) coude droit (RELB)
forearmr = {&#39;t&#39;:7,&#39;h&#39;:5,&#39;r&#39;:0.05,&#39;i&#39;:4}
; left wrist (LWRB)  left elbow (LELB)
forearml = {&#39;t&#39;:8,&#39;h&#39;:6,&#39;r&#39;:0.05,&#39;i&#39;:5}
; knee droit (RKNE) hanche droit (RFWT)
thighr = {&#39;t&#39;:11,&#39;h&#39;:9,&#39;r&#39;:0.05,&#39;i&#39;:6}
; knee left (LKNE)  hanche left (LFWT)
thighl = {&#39;t&#39;:12,&#39;h&#39;:10,&#39;r&#39;:0.05,&#39;i&#39;:7}
; cheville droit (RANK) genou  droit (RKNE)
calfr = {&#39;t&#39;:13,&#39;h&#39;:11,&#39;r&#39;:0.05,&#39;i&#39;:8}
; cheville droit (LANK) genou  droit (LKNE)
calfl = {&#39;t&#39;:14,&#39;h&#39;:12,&#39;r&#39;:0.05,&#39;i&#39;:9}
[device]
0 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;BeSpoon Phone&#39;,&#39;cyl&#39;:&#39;trunku&#39;,&#39;l&#39;:0.1,&#39;h&#39;:0.01,&#39;a&#39;:0,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
1 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;Movea Accel&#39;,&#39;cyl&#39;:&#39;trunku&#39;,&#39;l&#39;:0.1,&#39;h&#39;:0.01,&#39;a&#39;:180,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
2 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;Optivent Glass&#39;,&#39;cyl&#39;:&#39;head&#39;,&#39;l&#39;:0.7,&#39;h&#39;:0.01,&#39;a&#39;:0,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
3 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;Geonaute Podo&#39;,&#39;cyl&#39;:&#39;trunkb&#39;,&#39;l&#39;:0.1,&#39;h&#39;:0.01,&#39;a&#39;:45,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
4 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;Breizh Watch&#39;,&#39;cyl&#39;:&#39;forearmr&#39;,&#39;l&#39;:0.2,&#39;h&#39;:0.01,&#39;a&#39;:0,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
5 = {&#39;typ&#39;:&#39;static&#39;,&#39;name&#39;:&#39;Breizh Watch&#39;,&#39;cyl&#39;:&#39;forearml&#39;,&#39;l&#39;:0.2,&#39;h&#39;:0.01,&#39;a&#39;:0,&#39;file&#39;:&#39;S2R2.sh3&#39;,&#39;T&#39;:np.array([[1,0,0],[0,1,0],[0,0,1]])}
[mocap]

walk = &#39;07_01_c3d&#39;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>My name is : John

I have a Galaxy Gear device on the left forearm
I have a cardio device on the upper part of trunk
I am nowhere yet

filename : 07_01.c3d
nframes : 300
Centered : True
Mocap Speed : 1.36558346484
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Francois</span> <span class="o">=</span> <span class="n">Body</span><span class="p">(</span><span class="n">_filebody</span><span class="o">=</span><span class="s">&#39;Francois.ini&#39;</span><span class="p">,</span><span class="n">_filemocap</span><span class="o">=</span><span class="s">&#39;07_01.c3d&#39;</span><span class="p">)</span>
<span class="n">Francois</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>My name is : Francois

I have a Movea Accel device on the upper part of trunk
I have a BeSpoon Phone device on the upper part of trunk
I have a Geonaute Podo device on the lower part of trunk
I have a Optivent Glass device hea
I have a Breizh Watch device on the left forearm
I have a Breizh Watch device on the right forearm
I am nowhere yet

filename : 07_01.c3d
nframes : 300
Centered : True
Mocap Speed : 1.36558346484
</pre></div>
</div>
</div>
<div class="section" id="loading-a-motion-capture-file">
<h3>10.1.3. Loading a Motion Capture File<a class="headerlink" href="#loading-a-motion-capture-file" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">.c3d</span></tt> motion capture file is loaded with the method <tt class="docutils literal"><span class="pre">loadC3D</span></tt>
with as arguments the motion capture file and the number of frames to
load.</p>
<p>The motion is represented as a sequence of framef stored in the <tt class="docutils literal"><span class="pre">d</span></tt>
variable member.</p>
<p>It is possible to get the information from the C3D header by using the
verbose option of the <tt class="docutils literal"><span class="pre">read_c3d</span></tt> function</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Video Frame Rate</span>
<span class="n">Vrate</span> <span class="o">=</span> <span class="mi">120</span>
<span class="c"># Inter Frame</span>
<span class="n">Tframe</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">120</span>
<span class="c"># select a number of frame</span>
<span class="n">nframes</span> <span class="o">=</span> <span class="mi">300</span>
<span class="c"># Time duration of the whole selected frame sequence</span>
<span class="n">Tfseq</span> <span class="o">=</span> <span class="n">Tframe</span><span class="o">*</span><span class="n">nframes</span>
<span class="c">#</span>
<span class="c"># load a .c3dmotion capture file</span>
<span class="c"># this update the g.pos</span>
<span class="c">#</span>
<span class="c">#bc.loadC3D(filename=&#39;07_01.c3d&#39;,nframes=nframes,centered=True)</span>
</pre></div>
</div>
<p>The duration of the capture is</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="s">&quot;Duration of the motion capture sequence&quot;</span><span class="p">,</span> <span class="n">Tfseq</span><span class="p">,</span><span class="s">&quot; seconds&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Duration of the motion capture sequence 2.5  seconds
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">d</span></tt> is a MDA of shape <tt class="docutils literal"><span class="pre">(3,npoint,nframe)</span></tt>. It contains all the
possible configurations of the body. In general it is supposed to be a
cyclic motion as an integer number of walking steps. This allows to
instantiate the body configuration anywhere else in space in a given
trajectory.</p>
<p>A specific space-time configuration of the body is called a
<strong>``topos``</strong>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-trajectory">
<h3>10.1.4. Defining a trajectory<a class="headerlink" href="#defining-a-trajectory" title="Permalink to this headline">¶</a></h3>
<p>A Trajectory is a class which :</p>
<ul class="simple">
<li>derives from a pandas <tt class="docutils literal"><span class="pre">DataFrame</span></tt></li>
<li>is container for time,position,velocity and acceleration.</li>
</ul>
<p>To define a default trajectory :</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">()</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">traj</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>vx</th>
      <th>vy</th>
      <th>vz</th>
      <th>ax</th>
      <th>ay</th>
      <th>az</th>
      <th>s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1970-01-01 00:00:00</th>
      <td> 0.000000</td>
      <td> 0.000000</td>
      <td>-0.675722</td>
      <td> 0.061186</td>
      <td> 0.204082</td>
      <td> 0.539726</td>
      <td>-0.000229</td>
      <td> 0</td>
      <td> 0.401367</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.204082</th>
      <td> 0.061186</td>
      <td> 0.204082</td>
      <td>-0.135996</td>
      <td> 0.060957</td>
      <td> 0.204082</td>
      <td> 0.941093</td>
      <td>-0.000458</td>
      <td> 0</td>
      <td>-0.976458</td>
      <td> 0.580256</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.408163</th>
      <td> 0.122143</td>
      <td> 0.408163</td>
      <td> 0.805096</td>
      <td> 0.060499</td>
      <td> 0.204082</td>
      <td>-0.035365</td>
      <td>-0.000684</td>
      <td> 0</td>
      <td> 0.439891</td>
      <td> 1.545150</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.612245</th>
      <td> 0.182642</td>
      <td> 0.612245</td>
      <td> 0.769731</td>
      <td> 0.059815</td>
      <td> 0.204082</td>
      <td> 0.404526</td>
      <td>-0.000909</td>
      <td> 0</td>
      <td>-2.415204</td>
      <td> 1.760928</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.816327</th>
      <td> 0.242457</td>
      <td> 0.816327</td>
      <td> 1.174257</td>
      <td> 0.058906</td>
      <td> 0.204082</td>
      <td>-2.010679</td>
      <td>-0.001129</td>
      <td> 0</td>
      <td> 2.788602</td>
      <td> 2.217949</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 10 columns</p>
</div><div class="code python highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_26_0.png" src="./MOB-body_files/MOB-body_26_0.png" />
</div>
<div class="section" id="settopos-method">
<h3>10.1.5. settopos () method<a class="headerlink" href="#settopos-method" title="Permalink to this headline">¶</a></h3>
<p>Once the trajectory has been defined it is possible to send the body at
the position corresponding to any time of the trajectory with the
<tt class="docutils literal"><span class="pre">settopos</span></tt> method.</p>
<p>settopos takes as argument</p>
<ul class="simple">
<li>A trajectory</li>
<li>A time index</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">traj</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>
</pre></div>
</div>
<pre class="literal-block">
't (s) : 0.0:9.591837nd (m) : 59.4653280432nVmoy (m/s) : 6.19957658196n'
</pre>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">arange</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">tmin</span><span class="o">+</span><span class="mf">0.4</span><span class="p">,</span><span class="n">traj</span><span class="o">.</span><span class="n">tmax</span><span class="p">,</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">John</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">plane</span><span class="o">=</span><span class="s">&#39;yz&#39;</span><span class="p">,</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_30_0.png" src="./MOB-body_files/MOB-body_30_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>My centroid position is
[ 0.31956097  9.3877551 ]
filename : 07_01.c3d
nframes : 300
Centered : True
Mocap Speed : 1.36558346484
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Francois</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">Francois</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>My centroid position is
[ 0.97911919  5.91836735]
filename : 07_01.c3d
nframes : 300
Centered : True
Mocap Speed : 1.36558346484
</pre></div>
</div>
<ul class="simple">
<li>3 : dimension of space</li>
<li>16 : number of nodes</li>
<li>300 : number of frames</li>
</ul>
<p>The figure below shows the projection in a vertival plane of the body
nodes.</p>
<p>In order to translate the motion in any point in space-time, a
distinction is made between the real motion or topos and the centered
motion capture which acts as a virtual motion.</p>
<p>Let <img src="../_images/mathmpl/math-a17f99bd79.png" style="position: relative; bottom: -7px"/> denotes the center of gravity of the body in
the (O,x,y) plane</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">John</span><span class="o">.</span><span class="n">vg</span><span class="p">,</span><span class="n">John</span><span class="o">.</span><span class="n">vg</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span><span class="n">newaxis</span><span class="p">]))</span>
</pre></div>
</div>
<p><img src="../_images/mathmpl/math-d9d9cee03b.png" style="position: relative; bottom: -10px"/> is the velocity vector of the gravity center of the
body.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">vg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">John</span><span class="o">.</span><span class="n">vg</span><span class="p">[:,</span><span class="mi">145</span><span class="p">]</span>
<span class="k">print</span> <span class="n">John</span><span class="o">.</span><span class="n">vg</span><span class="p">[:,</span><span class="mi">298</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 0.0114987  -0.00026335  0.        ]
[  1.08123514e-02   7.24411022e-05   0.00000000e+00]
</pre></div>
</div>
<p>At that point the body structure is centered.</p>
<p>The frame is centered in the xy plane by substracting from the
configuration of points the projection of the body in the xy plane.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">npoints</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">16</span>
</pre></div>
</div>
<p>Each frame is centered above the origin. For example for a walk motion
the effect of the centering is just like if the body was still walking
but not moving forward exactly in the same manner as a walk on a
conveyor belt.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">pgc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">d</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span>
<span class="n">pg0</span> <span class="o">=</span> <span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;True center of gravity&quot;</span><span class="p">,</span> <span class="n">pg0</span>
<span class="k">print</span> <span class="s">&quot;Center of gravity of the centered frame&quot;</span><span class="p">,</span><span class="n">pgc</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>True center of gravity [-1.74251571  0.49373077  0.        ]
Center of gravity of the centered frame [  3.74700271e-16   1.38777878e-17   8.94887363e-01]
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>The current file contains 300 frames</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">tframe</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">nframes</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">xg</span> <span class="o">=</span> <span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
<span class="n">yg</span> <span class="o">=</span> <span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
<span class="n">zg</span> <span class="o">=</span> <span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">311</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tframe</span><span class="p">,</span><span class="n">xg</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;x component&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">312</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;frame index&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;y component&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">tframe</span><span class="p">,</span><span class="n">yg</span><span class="p">)</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">313</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;frame index&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Motion capture centroid trajectory&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span><span class="n">yg</span><span class="p">,</span><span class="s">&#39;.b&#39;</span><span class="p">)</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">John</span><span class="o">.</span><span class="n">pg</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">smocap</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>

<span class="n">Vmocap</span> <span class="o">=</span> <span class="n">smocap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">Tfseq</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Length = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">smocap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; V = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Vmocap</span><span class="o">*</span><span class="mf">3.6</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; km/h&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_52_0.png" src="./MOB-body_files/MOB-body_52_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">smocap</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;evolution of curvilinear abscisse from motion capture centroid trajectory&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;frame index&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;distance (meters)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.text.Text at 0x7fdd45827110&gt;
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_53_1.png" src="./MOB-body_files/MOB-body_53_1.png" />
</div>
<div class="section" id="defining-a-large-scale-trajectory">
<h3>10.1.6. Defining a large scale trajectory<a class="headerlink" href="#defining-a-large-scale-trajectory" title="Permalink to this headline">¶</a></h3>
<p>A large scale trajectory is defined in the <img src="../_images/mathmpl/math-7578f948ac.png" style="position: relative; bottom: -8px"/> plane.</p>
<p><tt class="docutils literal"><span class="pre">traj</span></tt> is a data structure (Npt,2)</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">v</span> <span class="o">=</span> <span class="n">Vmocap</span>
<span class="k">print</span> <span class="n">v</span><span class="o">*</span><span class="mf">3.6</span><span class="p">,</span><span class="s">&quot;Kmph&quot;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>4.91610047343 Kmph
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># time in seconds</span>
<span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">v</span><span class="o">*</span><span class="n">time</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
<span class="n">traj</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">()</span>
<span class="n">traj</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">traj</span><span class="o">.</span><span class="n">tmax</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">9.97</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">traj</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>vx</th>
      <th>vy</th>
      <th>vz</th>
      <th>ax</th>
      <th>ay</th>
      <th>az</th>
      <th>s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1970-01-01 00:00:00</th>
      <td> 0.000000</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.000000e+00</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.000000</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.010000</th>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.000000e+00</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.020000</th>
      <td> 0.027312</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.000000e+00</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.027312</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.030000</th>
      <td> 0.040968</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td> 6.938894e-18</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.040968</td>
    </tr>
    <tr>
      <th>1970-01-01 00:00:00.040000</th>
      <td> 0.054623</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.013656</td>
      <td> 0</td>
      <td> 0</td>
      <td>-1.387779e-17</td>
      <td> 0</td>
      <td> 0</td>
      <td> 0.054623</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 10 columns</p>
</div><img alt="./MOB-body_files/MOB-body_58_1.png" src="./MOB-body_files/MOB-body_58_1.png" />
</div>
<div class="section" id="trajectory">
<h3>10.1.7. Trajectory<a class="headerlink" href="#trajectory" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="posvel">
<h2>10.2. <tt class="docutils literal"><span class="pre">posvel()</span></tt><a class="headerlink" href="#posvel" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">posvel()</span></tt> function (position and velocity) takes as arguments the
following parameters</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">traj</span></tt> a plane trajectory object.</li>
<li><img src="../_images/mathmpl/math-2970bf83e5.png" style="position: relative; bottom: -7px"/> time for evaluation of topos</li>
<li><img src="../_images/mathmpl/math-69fdbd409a.png" style="position: relative; bottom: -10px"/> duration of the periodic motion frame sequence</li>
</ul>
<p>and returns</p>
<ul class="simple">
<li>the frame index
<img src="../_images/mathmpl/math-fa8df6427f.png" /></li>
<li>the trajectory index <img src="../_images/mathmpl/math-bd16204c95.png" style="position: relative; bottom: -7px"/></li>
<li>velocity unitary vector along motion capture frame
<img src="../_images/mathmpl/math-3925c359b0.png" style="position: relative; bottom: -17px"/></li>
<li>:math:<a href="#id5"><span class="problematic" id="id6">`</span></a>hat{mathbf{w}}_s = mathbf{hat{z}} times  hat{mathbf{v}}_s `</li>
<li>velocity unitary vector along trajectory
<img src="../_images/mathmpl/math-bbc160cffd.png" style="position: relative; bottom: -17px"/></li>
<li>:math:<a href="#id7"><span class="problematic" id="id8">`</span></a>hat{mathbf{w}}_t = mathbf{hat{z}} times  hat{mathbf{v}}_t `</li>
</ul>
<p><img src="../_images/mathmpl/math-c68c18ac15.png" style="position: relative; bottom: -13px"/> is the interframe time or frame sampling
period, it is equal to the whole duration of the motion sequence
<img src="../_images/mathmpl/math-69fdbd409a.png" style="position: relative; bottom: -10px"/> divided by the number of frames</p>
<p><tt class="docutils literal"><span class="pre">settopos</span></tt> is a method which takes as argument :</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">traj</span></tt> a plane trajectory (Npt,2)</li>
<li><img src="../_images/mathmpl/math-2970bf83e5.png" style="position: relative; bottom: -7px"/> time for evaluation of topos</li>
</ul>
<p>In futher version of the project, this function will be modified to be
able to avoid passing the whole trajectory.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>There is now a new data structure in the Body objet. This data structure
is called a <tt class="docutils literal"><span class="pre">topos</span></tt>.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">topos</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">topos</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">4.19599817</span><span class="p">,</span>  <span class="mf">4.15046572</span><span class="p">,</span>  <span class="mf">4.13081653</span><span class="p">,</span>  <span class="mf">4.07294142</span><span class="p">,</span>  <span class="mf">4.08289287</span><span class="p">,</span>
         <span class="mf">4.11542251</span><span class="p">,</span>  <span class="mf">3.94530449</span><span class="p">,</span>  <span class="mf">4.26514518</span><span class="p">,</span>  <span class="mf">3.82039411</span><span class="p">,</span>  <span class="mf">4.12746908</span><span class="p">,</span>
         <span class="mf">4.18189918</span><span class="p">,</span>  <span class="mf">3.89824308</span><span class="p">,</span>  <span class="mf">4.28535797</span><span class="p">,</span>  <span class="mf">3.70884964</span><span class="p">,</span>  <span class="mf">4.41212222</span><span class="p">,</span>
         <span class="mf">4.15468413</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.00978643</span><span class="p">,</span>  <span class="mf">0.01039192</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08586912</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.15014439</span><span class="p">,</span>  <span class="mf">0.17454155</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">0.29891008</span><span class="p">,</span>  <span class="mf">0.28336831</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.31726715</span><span class="p">,</span>  <span class="mf">0.37578539</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.14822518</span><span class="p">,</span>
         <span class="mf">0.12069953</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11848735</span><span class="p">,</span>  <span class="mf">0.13268648</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04485156</span><span class="p">,</span>  <span class="mf">0.07025805</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">0.01376282</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.18925612</span><span class="p">,</span>  <span class="mf">1.35442836</span><span class="p">,</span>  <span class="mf">1.57836099</span><span class="p">,</span>  <span class="mf">1.39037819</span><span class="p">,</span>  <span class="mf">1.40039528</span><span class="p">,</span>
         <span class="mf">1.07349379</span><span class="p">,</span>  <span class="mf">1.11418117</span><span class="p">,</span>  <span class="mf">0.83620759</span><span class="p">,</span>  <span class="mf">0.89701301</span><span class="p">,</span>  <span class="mf">0.89713179</span><span class="p">,</span>
         <span class="mf">0.89777028</span><span class="p">,</span>  <span class="mf">0.44315412</span><span class="p">,</span>  <span class="mf">0.43969984</span><span class="p">,</span>  <span class="mf">0.09704225</span><span class="p">,</span>  <span class="mf">0.05562085</span><span class="p">,</span>
         <span class="mf">0.89745103</span><span class="p">]])</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">show3</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">John</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">John</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">John</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>(&lt;matplotlib.figure.Figure at 0x7fdd458256d0&gt;,
 &lt;matplotlib.axes.Axes3DSubplot at 0x7fdd4582d2d0&gt;)
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_69_1.png" src="./MOB-body_files/MOB-body_69_1.png" />
<div class="section" id="definition-of-several-coordinates-systems">
<h3>10.2.1. Definition of Several Coordinates systems<a class="headerlink" href="#definition-of-several-coordinates-systems" title="Permalink to this headline">¶</a></h3>
<p>Each cylinder of the <tt class="docutils literal"><span class="pre">Body</span></tt> model bears one specific coordinate
system.</p>
<p>One or several cylinder coordinate systems can be chosen to define the
Body Local Coordinates System (BLCS) which is required for motion
capture (BLCS) applications.</p>
<p>In general, the origin will be chosen on a position which is the most
time invariant as on the chest or the back.</p>
<p>Those frames of references are all defined in the Global Coordinate
System (GCS) of the scene.</p>
</div>
<div class="section" id="construction-of-the-cylinder-coordinate-system-ccs">
<h3>10.2.2. Construction of the Cylinder Coordinate System (CCS)<a class="headerlink" href="#construction-of-the-cylinder-coordinate-system-ccs" title="Permalink to this headline">¶</a></h3>
<p>The method <tt class="docutils literal"><span class="pre">setccs()</span></tt> is used to associate a Cylinder Coordinate
System (CCS) to each cylinder of the bodyCylinder model. Notice that
those cylinders coordinates systems are not known by the localization
application. The localization application will define the BLCS from the
position of radiating devices placed on the body surface.</p>
<p>Each basis is constructed with the function from
<tt class="docutils literal"><span class="pre">geomutil.onbfromaxe()</span></tt> : orthonormal bases from axes. This function
takes 2 sets of <img src="../_images/mathmpl/math-e7b31363a1.png" style="position: relative; bottom: -3px"/> points <img src="../_images/mathmpl/math-2014ddb223.png" style="position: relative; bottom: -10px"/> and
<img src="../_images/mathmpl/math-04e6380741.png" style="position: relative; bottom: -10px"/> as input and provides an orthonormal basis as
output.</p>
<p>3 unitary vectors are constructed :</p>
<img src="../_images/mathmpl/math-0cf2836a48.png" class="center" /><img src="../_images/mathmpl/math-2d89adcbdc.png" class="center" /><img src="../_images/mathmpl/math-a83fa5bdd7.png" class="center" /><p>Where <img src="../_images/mathmpl/math-9ebaf25e76.png" style="position: relative; bottom: -10px"/> is the unit velocity vector along
actual trajectory.</p>
<p>The outpout of <tt class="docutils literal"><span class="pre">geomutil.onbframe</span></tt> is an MDA
<img src="../_images/mathmpl/math-6d67c54727.png" style="position: relative; bottom: -8px"/> of <img src="../_images/mathmpl/math-e7b31363a1.png" style="position: relative; bottom: -3px"/> unitary matrices aggregated
along axis 1</p>
<img src="../_images/mathmpl/math-7a3bcb860d.png" class="center" /><p>To create the CCS :</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">setccs</span><span class="p">()</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="k">print</span> <span class="s">&quot;ccs dimensions : &quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">ccs</span><span class="p">)</span>
<span class="k">print</span> <span class="n">John</span><span class="o">.</span><span class="n">ccs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="k">print</span> <span class="s">&quot;Check determinant : &quot;</span><span class="p">,</span> <span class="n">la</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">John</span><span class="o">.</span><span class="n">ccs</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>ccs dimensions :  (11, 3, 3)
[[ 0.94678656  0.05306765 -0.31745715]
 [-0.06834689  0.99696857 -0.03718026]
 [ 0.31452173  0.05689898  0.94754345]]
Check determinant :  1.0
</pre></div>
</div>
<p>Create a Wireframe body representation from the body graph model</p>
<p>Representation of frames associated with the cylinder</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">show3</span><span class="p">()</span>
</pre></div>
</div>
<p>On the figure below the wireframe model is shown associated with the 11
CCS (Cylinder coordinates systems)</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Image</span><span class="p">(</span><span class="s">&#39;CCS.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_82_0.png" src="./MOB-body_files/MOB-body_82_0.png" />
</div>
<div class="section" id="placing-a-dcs-device-coordinate-system-on-the-cylinder">
<h3>10.2.3. Placing a dcs (Device Coordinate System ) on the cylinder<a class="headerlink" href="#placing-a-dcs-device-coordinate-system-on-the-cylinder" title="Permalink to this headline">¶</a></h3>
<p>A DCS is refered by 4 numbers <img src="../_images/mathmpl/math-d859882232.png" style="position: relative; bottom: -8px"/></p>
<ul class="simple">
<li>Id : Cylinder Id</li>
<li>l : length along cylinder</li>
<li>h : height above cylinder generatrix</li>
<li>alpha : angle from front direction (degrees)</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">Id</span> <span class="o">=</span> <span class="mi">4</span> <span class="c"># 4 Left Arm</span>
<span class="n">l</span>  <span class="o">=</span> <span class="mf">0.1</span> <span class="c"># Longitudinal coordinates</span>
<span class="n">h</span>  <span class="o">=</span> <span class="mf">0.03</span> <span class="c"># height</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">45</span> <span class="c"># angle degrees</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">dcyl</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;arml&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s">&#39;armr&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s">&#39;calfl&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
 <span class="s">&#39;calfr&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
 <span class="s">&#39;forearml&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s">&#39;forearmr&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s">&#39;head&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s">&#39;thighl&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
 <span class="s">&#39;thighr&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
 <span class="s">&#39;trunkb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s">&#39;trunku&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
<p>Rotate Matrix around z</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">cs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">dcyl</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;arml&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s">&#39;armr&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
 <span class="s">&#39;calfl&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
 <span class="s">&#39;calfr&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
 <span class="s">&#39;forearml&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
 <span class="s">&#39;forearmr&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
 <span class="s">&#39;head&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
 <span class="s">&#39;thighl&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
 <span class="s">&#39;thighr&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
 <span class="s">&#39;trunkb&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
 <span class="s">&#39;trunku&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">show3</span><span class="p">(</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">dcs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">John</span><span class="o">.</span><span class="n">show3</span><span class="p">(</span><span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MOB-body_files/MOB-body_93_0.png" src="./MOB-body_files/MOB-body_93_0.png" />
</div>
</div>
<div class="section" id="large-scale-mobility">
<h2>10.3. Large Scale Mobility<a class="headerlink" href="#large-scale-mobility" title="Permalink to this headline">¶</a></h2>
</div>
</div>
<div class="section" id="algebraic-localization-class">
<h1>11. Algebraic Localization Class<a class="headerlink" href="#algebraic-localization-class" title="Permalink to this headline">¶</a></h1>
<p>For localization in the plane it is important not to provide the z
coordinates. Otherwise a singularity problem arises.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pylayers.location.algebraic.algebraic</span>  <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span> <span class="o">=</span> <span class="mf">0.2997924583</span>
<span class="n">nodes</span><span class="o">=</span><span class="p">{}</span>
<span class="n">ldp</span><span class="o">=</span><span class="p">{}</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">&#39;BN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">&#39;RN_TOA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">ldp</span><span class="p">[</span><span class="s">&#39;TOA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ldp</span><span class="p">[</span><span class="s">&#39;TOA_std&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Alg</span> <span class="o">=</span> <span class="n">algloc</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">ldp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">ldp</span>
<span class="n">Alg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;TOA_std&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="s">&#39;TOA&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">([</span> <span class="mf">1.41421356</span><span class="p">,</span>  <span class="mf">1.41421356</span><span class="p">,</span>  <span class="mf">1.</span>        <span class="p">])}</span>
</pre></div>
</div>
<img alt="./LOC-algebraic_files/LOC-algebraic_4_2.png" src="./LOC-algebraic_files/LOC-algebraic_4_2.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">pest</span> <span class="o">=</span> <span class="n">Alg</span><span class="o">.</span><span class="n">ls_locate</span><span class="p">(</span><span class="n">toa</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">tdoa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">rss</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Alg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./LOC-algebraic_files/LOC-algebraic_6_1.png" src="./LOC-algebraic_files/LOC-algebraic_6_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">pest</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.22753112</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Alg</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Nodes : {&#39;BN&#39;: array([[0],
       [0]]), &#39;RN_TOA&#39;: array([[-1,  1,  0],
       [-1, -1,  1]])}
LDPs :{&#39;TOA_std&#39;: array([1, 1, 1]), &#39;TOA&#39;: array([ 1.41421356,  1.41421356,  1.        ])}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.location.algebraic.algebraic</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">import</span> <span class="n">dist</span>
</pre></div>
</div>
<div class="section" id="example-of-tdoa">
<h2>11.1. Example of TDOA<a class="headerlink" href="#example-of-tdoa" title="Permalink to this headline">¶</a></h2>
<p>First, it is necesary to define Anchor nodes and associated Reference
Anchor Nodes. This is important to be very specific about what exactly
the TDOA is. In the example the Blin node is draw randomly as well as
anchor nodes.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nodes</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">AN_TDOA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="c">#AN_TDOA1=np.array([[0, 0, 1, 1],[0,1,1,0]])</span>
<span class="c">#AN_TDOAr1 = np.roll(AN_TDOA,1,axis=1)</span>
<span class="n">AN_TDOAr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">AN_TDOAr2</span> <span class="o">=</span> <span class="n">AN_TDOA</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">][:,</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">BN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.2</span><span class="p">],[</span><span class="mf">0.3</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AN_TDOA</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.4184779</span> <span class="p">,</span>  <span class="mf">0.46323775</span><span class="p">,</span>  <span class="mf">0.76936267</span><span class="p">,</span>  <span class="mf">0.03841692</span><span class="p">,</span>  <span class="mf">0.20877339</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.86098336</span><span class="p">,</span>  <span class="mf">0.99099928</span><span class="p">,</span>  <span class="mf">0.10115537</span><span class="p">,</span>  <span class="mf">0.30007228</span><span class="p">,</span>  <span class="mf">0.9133354</span> <span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AN_TDOAr1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AN_TDOAr2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.20877339</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.9133354</span> <span class="p">]])</span>
</pre></div>
</div>
<p>The figure below illustrates the situation, in red the anchor nodes, the
blue star is the blind node.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">AN_TDOA</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">AN_TDOA</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">AN_TDOAr2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">AN_TDOAr2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s">&#39;ok&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">BN</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="n">BN</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="s">&#39;*b&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<img alt="./LOC-localization_files/LOC-localization_8_1.png" src="./LOC-localization_files/LOC-localization_8_1.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">AN_TDOA</span><span class="p">,</span><span class="n">BN</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dr1</span><span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">AN_TDOAr1</span><span class="p">,</span><span class="n">BN</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dr2</span><span class="o">=</span> <span class="n">dist</span><span class="p">(</span><span class="n">AN_TDOAr2</span><span class="p">,</span><span class="n">BN</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tdoa1</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">dr1</span><span class="p">)</span><span class="o">/</span><span class="mf">0.3</span>
<span class="n">tdoa2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">dr2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.3</span>
<span class="n">tdoa0</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">roll</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">0.3</span>

<span class="k">print</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">tdoa0</span><span class="p">)</span>
<span class="k">print</span> <span class="n">tdoa1</span>
<span class="k">print</span> <span class="n">tdoa2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[-0.03790822  0.42014538 -0.03437296 -1.50605018  0.        ]
[ 0.80490184  1.26295544  0.8084371  -0.66324012  0.84281006]
[-0.03790822  0.42014538 -0.03437296 -1.50605018  0.        ]
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node</span><span class="o">=</span><span class="p">{}</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">&#39;BN&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">BN</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">&#39;RN_TDOA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">AN_TDOA</span>
<span class="n">nodes</span><span class="p">[</span><span class="s">&#39;RNr_TDOA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">AN_TDOAr2</span>
<span class="n">ldp</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ldp</span><span class="p">[</span><span class="s">&#39;TDOA&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cumsum</span><span class="p">(</span><span class="n">tdoa0</span><span class="p">)</span>
<span class="n">ldp</span><span class="p">[</span><span class="s">&#39;TDOA_std&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">=</span><span class="n">algloc</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">ldp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Nodes :  {&#39;RN_TDOA&#39;: array([[ 0.4184779 ,  0.46323775,  0.76936267,  0.03841692,  0.20877339],
       [ 0.86098336,  0.99099928,  0.10115537,  0.30007228,  0.9133354 ]]), &#39;BN&#39;: array([[ 0.2],
       [ 0.3]]), &#39;RNr_TDOA&#39;: array([[ 0.20877339],
       [ 0.9133354 ]])}
Location dependent parameters :  {&#39;TDOA&#39;: array([-0.03790822,  0.42014538, -0.03437296, -1.50605018,  0.        ]), &#39;TDOA_std&#39;: array([ 1.,  1.,  1.,  1.,  1.])}
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span> <span class="o">=</span> <span class="n">algloc</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">ldp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">S</span><span class="o">.</span><span class="n">ls_locate</span><span class="p">(</span><span class="n">tdoa</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">toa</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">rss</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.20011097</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.30007884</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nodes</span><span class="p">[</span><span class="s">&#39;BN&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.2</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.3</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>
</pre></div>
</div>
<p>Robust Geometric Positioning Algorithm</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.location.geometric.constraints.cla</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.location.geometric.constraints.toa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.location.geometric.constraints.tdoa</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.location.geometric.constraints.rss</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.network.model</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<p>Let&#8217;s define 4 anchors in the plane.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pt1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">pt2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]))</span>
<span class="n">pt3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">5</span><span class="p">,</span><span class="mi">28</span><span class="p">]))</span>
<span class="n">pt4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">]))</span>
<span class="c"># the unknown point is p</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
<p>Then displaying the scene with ancho nodes (in red) and blind nodes in
blue</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;anchor 1&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;anchor 2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;anchor 3&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;anchor 4&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;xb&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;p&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x48dab50&gt;
</pre></div>
</div>
<img alt="./LOC-rgpa_files/LOC-rgpa_5_1.png" src="./LOC-rgpa_files/LOC-rgpa_5_1.png" />
<p>The euclidian distance betwenn blind node <img src="../_images/mathmpl/math-fb97a8c47a.png" style="position: relative; bottom: -7px"/> and anchors ans the
corresponding Time of flight are evaluated.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">d1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pt1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">d2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pt2</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">d3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pt3</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">d4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pt4</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="n">toa1</span><span class="o">=</span><span class="n">d1</span><span class="o">/</span><span class="mf">0.3</span>
<span class="n">toa2</span><span class="o">=</span><span class="n">d2</span><span class="o">/</span><span class="mf">0.3</span>
<span class="n">toa3</span><span class="o">=</span><span class="n">d3</span><span class="o">/</span><span class="mf">0.3</span>
<span class="n">toa4</span><span class="o">=</span><span class="n">d4</span><span class="o">/</span><span class="mf">0.3</span>

<span class="k">print</span> <span class="s">&#39;distance p-1=&#39;</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span> <span class="s">&#39;/ toa1=&#39;</span><span class="p">,</span><span class="n">toa1</span>
<span class="k">print</span> <span class="s">&#39;distance p-2=&#39;</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span> <span class="s">&#39;/ toa2=&#39;</span><span class="p">,</span><span class="n">toa2</span>
<span class="k">print</span> <span class="s">&#39;distance p-3=&#39;</span><span class="p">,</span><span class="n">d3</span><span class="p">,</span> <span class="s">&#39;/ toa3=&#39;</span><span class="p">,</span><span class="n">toa3</span>
<span class="k">print</span> <span class="s">&#39;distance p-4=&#39;</span><span class="p">,</span><span class="n">d4</span><span class="p">,</span> <span class="s">&#39;/ toa3=&#39;</span><span class="p">,</span><span class="n">toa4</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>distance p-1= 5.0 / toa1= 16.6666666667
distance p-2= 14.1421356237 / toa2= 47.1404520791
distance p-3= 23.5372045919 / toa3= 78.4573486396
distance p-4= 18.0277563773 / toa3= 60.0925212577
</pre></div>
</div>
</div>
</div>
<div class="section" id="rgpa-robust-geometric-positioning-algorithm">
<h1>12. RGPA (Robust Geometric Positioning Algorithm)<a class="headerlink" href="#rgpa-robust-geometric-positioning-algorithm" title="Permalink to this headline">¶</a></h1>
<div class="section" id="exploiting-time-of-arrival-toa-only">
<h2>12.1. Exploiting Time of Arrival (ToA) only<a class="headerlink" href="#exploiting-time-of-arrival-toa-only" title="Permalink to this headline">¶</a></h2>
<p>We call <tt class="docutils literal"><span class="pre">Constraint</span> <span class="pre">Layer</span> <span class="pre">Array</span></tt> (CLA) the object which gathers all
the geometric constraints of a considered scenario.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">=</span><span class="n">CLA</span><span class="p">()</span>
</pre></div>
</div>
<p>Instanciate TOA constraints, notice that their id are differents</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">T1</span><span class="o">=</span><span class="n">TOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa1</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pt1</span><span class="p">)</span>
<span class="n">T2</span><span class="o">=</span><span class="n">TOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa2</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pt2</span><span class="p">)</span>
<span class="n">T3</span><span class="o">=</span><span class="n">TOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa3</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pt3</span><span class="p">)</span>
<span class="n">T4</span><span class="o">=</span><span class="n">TOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa4</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pt4</span><span class="p">)</span>
</pre></div>
</div>
<p>Add TOA contraints to the CLA</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T1</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T2</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T3</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T4</span><span class="p">)</span>
</pre></div>
</div>
<p>All the constraints of the CLA can be listed as follows</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[node | peer   |type | rat  | p              | value    | std  | runable| usable|
    0 |        |TOA  |      | [0 0]          | [ 16.667]| [ 1.]|       1|      1|,
 node | peer   |type | rat  | p              | value    | std  | runable| usable|
    1 |        |TOA  |      | [10 15]        | [ 47.14] | [ 1.]|       1|      1|,
 node | peer   |type | rat  | p              | value    | std  | runable| usable|
    2 |        |TOA  |      | [ 5 28]        | [ 78.457]| [ 1.]|       1|      1|,
 node | peer   |type | rat  | p              | value    | std  | runable| usable|
    3 |        |TOA  |      | [-10 -10]      | [ 60.093]| [ 1.]|       1|      1|]
</pre></div>
</div>
<p>Get information on the cla :</p>
<ul class="simple">
<li>type : TOA / RSS</li>
<li>p : Position of the origin of the constraint</li>
<li>value : power ( RSS ) / time in ns ( TOA)</li>
<li>std : standard deviation <img src="../_images/mathmpl/math-54bf156f7e.png" style="position: relative; bottom: -3px"/> of value</li>
<li>runable : does the constraint has a position p ?</li>
<li>obsolete : does the value has been obtained recently ?</li>
<li>usuable : runbale AND NOT obsolete</li>
<li>evlauated : obsolete</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>type , p              , value, std  , runable, usable, obsolete, evaluated
TOA  , [0 0]          , [ 16.667], [ 1.],       1,      1,        0,         0
type , p              , value, std  , runable, usable, obsolete, evaluated
TOA  , [10 15]        , [ 47.14], [ 1.],       1,      1,        0,         0
type , p              , value, std  , runable, usable, obsolete, evaluated
TOA  , [ 5 28]        , [ 78.457], [ 1.],       1,      1,        0,         0
type , p              , value, std  , runable, usable, obsolete, evaluated
TOA  , [-10 -10]      , [ 60.093], [ 1.],       1,      1,        0,         0
</pre></div>
</div>
<p>Update the CLA</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</pre></div>
</div>
<p>Compute the cla</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<p>show the estimated position</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">pe</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="o">-</span><span class="mf">4.735e-03</span><span class="p">,</span>   <span class="mf">4.992e+00</span><span class="p">])</span>
</pre></div>
</div>
<p>to be compare with the actual position value</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="rss">
<h2>12.2. RSS<a class="headerlink" href="#rss" title="Permalink to this headline">¶</a></h2>
<p>The RSS is a quantity which is weakly related to distance via a
parametric model. The bettet the model, better would be tthe inference
ab out tthe associated distance. t To model the Path Loss shadowing
model is widely used.</p>
<p>To define the classical path loss shadowing model widely used in this
context the <tt class="docutils literal"><span class="pre">PLSmodel</span></tt> class has been defined.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">M</span> <span class="o">=</span> <span class="n">PLSmodel</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span><span class="n">rssnp</span><span class="o">=</span><span class="mf">2.64</span><span class="p">,</span><span class="n">d0</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">sigrss</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s">&#39;mode&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For simulation purpose : get RSS from distances (or associated delay)
with the above model</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">toa1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">16.666666666666668</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">M</span><span class="o">.</span><span class="n">getPL</span><span class="p">(</span><span class="n">toa1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mf">11.262571050852122</span>
</pre></div>
</div>
</div>
<div class="section" id="tdoa">
<h2>12.3. TDOA<a class="headerlink" href="#tdoa" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Td1</span><span class="o">=</span><span class="n">TDOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa1</span><span class="o">-</span><span class="n">toa2</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt2</span><span class="p">]))</span>
<span class="n">Td2</span><span class="o">=</span><span class="n">TDOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa1</span><span class="o">-</span><span class="n">toa3</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt3</span><span class="p">]))</span>
<span class="n">Td3</span><span class="o">=</span><span class="n">TDOA</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">toa1</span><span class="o">-</span><span class="n">toa4</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span> <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pt1</span><span class="p">,</span><span class="n">pt4</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">=</span><span class="n">CLA</span><span class="p">()</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Td1</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Td2</span><span class="p">)</span>
<span class="n">C</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Td3</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>TDOA 2.0
TDOA 2.0
TDOA 2.0
TDOA 1.5
TDOA 1.5
TDOA 1.5
TDOA 1.375
TDOA 1.375
TDOA 1.375
TDOA 1.375
TDOA 1.375
TDOA 1.375
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">C</span><span class="o">.</span><span class="n">pe</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="mf">0.021</span><span class="p">,</span>  <span class="mf">4.987</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="network-simulation-configuration">
<h1>13. Network Simulation Configuration<a class="headerlink" href="#network-simulation-configuration" title="Permalink to this headline">¶</a></h1>
<p>PyLayers is designed to provide indoor radio channel simulation for
mobile agents.</p>
<p>The goal is to adress mobility in indoor environement heterogeneous
network, with human being carriers of a mobile User Equipement (UE)
which possibly embeds several Radio Acess Technology (RAT).</p>
<p>Several human can be created and their motion in the environement should
be as realistic as possible, because for many applications it turns out
that many parameter of interest are stongly dependent of the dynamic
topology of the mobile network.</p>
<p>In the following the configuration files for proceeding with those high
level <tt class="docutils literal"><span class="pre">PyLayers</span></tt> simulation are described.</p>
<p>The configuration file is <tt class="docutils literal"><span class="pre">simulnet.ini</span></tt></p>
<p>This file is located in <tt class="docutils literal"><span class="pre">$BASENAME/ini</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>!cat $BASENAME/ini/simulnet.ini
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[Mysql]
host = localhost
user = root
passwd = sqlsql
dbname = test
dumpdb =True

[Save]
save=[]
;save=[&#39;csv&#39;,&#39;mysql&#39;,&#39;matlab&#39;,&#39;pyray&#39;,&#39;txt&#39;,&#39;ini&#39;]
savep=True

[Layout]
filename = TA-Office.ini

x_offset  = 30
y_offset = 2

the_world_width      = 65
the_world_height = 20
the_world_scale      = 20

[Mechanics]
; update time for agent movement
mecanic_update_time = 0.1
; select how agnt choose destiantion
;&#39;random&#39; ; file
choose_destination = &#39;random&#39;


[Network]
; refresh TOA regulary &#39;synchro &#39;or with distance &#39;autionomous&#39;
Communication_mode=&#39;autonomous&#39;
; update time for refreshing network
network_update_time = 0.1
; show nodes moving &amp; radio link
show = False
; show in ipython .
ipython_nb_show = False
; show signature ( not fully functionnal)
show_sg = False
; show 2 tables : mecanic &amp; network
show_table = False
; show the same information but in terminal
dispinfo = False

[Localization]
; perform localization
localization = True
; time to refresh localization
localization_update_time = 1.0
; list of used methods method = [&#39;alg&#39;,&#39;geo&#39;]
method = [&#39;alg&#39;]



[Simulation]
; Simulation duration
duration = 10.0
; speed ratio
speedratio = 1.
; time for refreshing tk plot ( obsolete)
show_interval = 0.5
; show scene using tk renderer ( obsolete)
showtk   = False
; choose seed for random mobiliity
seed = 1
; verbose output
verbose = True
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Cp</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">Cp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&#39;simulnet.ini&#39;</span><span class="p">,</span><span class="s">&#39;ini&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;/home/uguen/Bureau/P1/ini/simulnet.ini&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Simulnet.ini contains the following sections</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Cp</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;Mysql&#39;</span><span class="p">,</span>
 <span class="s">&#39;Save&#39;</span><span class="p">,</span>
 <span class="s">&#39;Layout&#39;</span><span class="p">,</span>
 <span class="s">&#39;Mechanics&#39;</span><span class="p">,</span>
 <span class="s">&#39;Network&#39;</span><span class="p">,</span>
 <span class="s">&#39;Localization&#39;</span><span class="p">,</span>
 <span class="s">&#39;Simulation&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This section define the save options.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Save&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;save&#39;</span><span class="p">:</span> <span class="s">&#39;[]&#39;</span><span class="p">,</span> <span class="s">&#39;savep&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">savep</span></tt> boolean enable/disable saving of the simulation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Save&#39;</span><span class="p">))[</span><span class="s">&#39;savep&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;True&#39;</span>
</pre></div>
</div>
<p>The log file which contains all traces from the dynamic are in
<tt class="docutils literal"><span class="pre">$BASENAME/netsave</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ls</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">Bureau</span><span class="o">/</span><span class="n">P1</span><span class="o">/</span><span class="n">netsave</span><span class="o">/</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>ls: impossible d&#39;accéder à /home/Bureau/P1/netsave/: Aucun fichier ou dossier de ce type
</pre></div>
</div>
<div class="section" id="layout">
<h2>13.1. Layout<a class="headerlink" href="#layout" title="Permalink to this headline">¶</a></h2>
<p>This section allow setup the layout for the simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Layout&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;filename&#39;</span><span class="p">:</span> <span class="s">&#39;TA-Office.ini&#39;</span><span class="p">,</span>
 <span class="s">&#39;the_world_height&#39;</span><span class="p">:</span> <span class="s">&#39;20&#39;</span><span class="p">,</span>
 <span class="s">&#39;the_world_scale&#39;</span><span class="p">:</span> <span class="s">&#39;20&#39;</span><span class="p">,</span>
 <span class="s">&#39;the_world_width&#39;</span><span class="p">:</span> <span class="s">&#39;65&#39;</span><span class="p">,</span>
 <span class="s">&#39;x_offset&#39;</span><span class="p">:</span> <span class="s">&#39;30&#39;</span><span class="p">,</span>
 <span class="s">&#39;y_offset&#39;</span><span class="p">:</span> <span class="s">&#39;2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Choose the used Layout for simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Layout&#39;</span><span class="p">))[</span><span class="s">&#39;filename&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;TA-Office.ini&#39;</span>
</pre></div>
</div>
<p>Setup an offset on the origin of axis</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Layout&#39;</span><span class="p">))[</span><span class="s">&#39;x_offset&#39;</span><span class="p">]</span>
<span class="k">print</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Layout&#39;</span><span class="p">))[</span><span class="s">&#39;y_offset&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">30</span>
<span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="section" id="network">
<h2>13.2. Network<a class="headerlink" href="#network" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;communication_mode&#39;</span><span class="p">:</span> <span class="s">&quot;&#39;autonomous&#39;&quot;</span><span class="p">,</span>
 <span class="s">&#39;dispinfo&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
 <span class="s">&#39;ipython_nb_show&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
 <span class="s">&#39;network_update_time&#39;</span><span class="p">:</span> <span class="s">&#39;0.1&#39;</span><span class="p">,</span>
 <span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
 <span class="s">&#39;show_sg&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
 <span class="s">&#39;show_table&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Setup communication mode between node:</p>
<ul class="simple">
<li>autonomous : the data exchange between nodes is driven by the
localization layer. If more information is required to estimate the
position a communication request is send to the communication stae</li>
<li>synchro : the data exchange between nodes is periodic. LDPs are
periodically refreshed at the network_update_time</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))[</span><span class="s">&#39;communication_mode&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;&#39;autonomous&#39;&quot;</span>
</pre></div>
</div>
<p>Time step for the refresh network information</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))[</span><span class="s">&#39;network_update_time&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;0.1&#39;</span>
</pre></div>
</div>
<p>Vizualization of the simulation using matplotlib</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))[</span><span class="s">&#39;show&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;False&#39;</span>
</pre></div>
</div>
<p>Vizualization of a table summing up the data exchange of the nodes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))[</span><span class="s">&#39;show_table&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;False&#39;</span>
</pre></div>
</div>
<p>Vizualization of the simulation inside ipython .</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Network&#39;</span><span class="p">))[</span><span class="s">&#39;ipython_nb_show&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;False&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="mechanics">
<h2>13.3. Mechanics<a class="headerlink" href="#mechanics" title="Permalink to this headline">¶</a></h2>
<p>This section allow to setup the agent movement during simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Mechanics&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;choose_destination&#39;</span><span class="p">:</span> <span class="s">&quot;&#39;random&#39;&quot;</span><span class="p">,</span> <span class="s">&#39;mecanic_update_time&#39;</span><span class="p">:</span> <span class="s">&#39;0.1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Setup how agent choose their target:</p>
<ul class="simple">
<li>random : the agnet move into the layout randomly</li>
<li>file : the agent follow the sequence specified in
/nodes_destination.ini</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Mechanics&#39;</span><span class="p">))[</span><span class="s">&#39;choose_destination&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;&#39;random&#39;&quot;</span>
</pre></div>
</div>
<p>Time step for refreshing the mechanical layer (ground truth position)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Mechanics&#39;</span><span class="p">))[</span><span class="s">&#39;mecanic_update_time&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;0.1&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="localization">
<h2>13.4. Localization<a class="headerlink" href="#localization" title="Permalink to this headline">¶</a></h2>
<p>Setup Localization algorithms</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Localization&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;localization&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">,</span>
 <span class="s">&#39;localization_update_time&#39;</span><span class="p">:</span> <span class="s">&#39;1.0&#39;</span><span class="p">,</span>
 <span class="s">&#39;method&#39;</span><span class="p">:</span> <span class="s">&quot;[&#39;alg&#39;]&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>enable/disable localizaiton of the agents</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Localization&#39;</span><span class="p">))[</span><span class="s">&#39;localization&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;True&#39;</span>
</pre></div>
</div>
<p>Select localization methods :</p>
<ul class="simple">
<li>Algebraic : hétérogeneous localization algorithm</li>
<li>Geometric : RGPA</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Localization&#39;</span><span class="p">))[</span><span class="s">&#39;method&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;[&#39;alg&#39;]&quot;</span>
</pre></div>
</div>
<p>Time step for localization update</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Localization&#39;</span><span class="p">))[</span><span class="s">&#39;localization_update_time&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;1.0&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="simulation">
<h2>13.5. Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Simulation&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;duration&#39;</span><span class="p">:</span> <span class="s">&#39;10.0&#39;</span><span class="p">,</span>
 <span class="s">&#39;seed&#39;</span><span class="p">:</span> <span class="s">&#39;1&#39;</span><span class="p">,</span>
 <span class="s">&#39;show_interval&#39;</span><span class="p">:</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span>
 <span class="s">&#39;showtk&#39;</span><span class="p">:</span> <span class="s">&#39;False&#39;</span><span class="p">,</span>
 <span class="s">&#39;speedratio&#39;</span><span class="p">:</span> <span class="s">&#39;1.&#39;</span><span class="p">,</span>
 <span class="s">&#39;verbose&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Setup simulation duration in second</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Simulation&#39;</span><span class="p">))[</span><span class="s">&#39;duration&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;10.0&#39;</span>
</pre></div>
</div>
<p>Setup random seed for simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Simulation&#39;</span><span class="p">))[</span><span class="s">&#39;seed&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;1&#39;</span>
</pre></div>
</div>
<p>Display messages during simulation</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">dict</span><span class="p">(</span><span class="n">Cp</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="s">&#39;Simulation&#39;</span><span class="p">))[</span><span class="s">&#39;verbose&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;True&#39;</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pylayers.mobility.trajectory</span> <span class="kn">as</span> <span class="nn">traj</span>
<span class="kn">from</span> <span class="nn">pylayers.mobility.body.body</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>trajectories can be imported from a simulnet simulation with the <tt class="docutils literal"><span class="pre">importsn</span></tt> method</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span><span class="o">=</span><span class="n">Layout</span><span class="p">(</span><span class="s">&#39;TA-Office.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span><span class="o">=</span><span class="n">traj</span><span class="o">.</span><span class="n">importsn</span><span class="p">()</span>
</pre></div>
</div>
<p>The 2 following trajectories have been calculated with
<tt class="docutils literal"><span class="pre">pylayers.simul.simulnet</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./MOB-mobility_files/MOB-mobility_7_0.png" src="./MOB-mobility_files/MOB-mobility_7_0.png" />
<img alt="./SIM-workflow_files/SIM-workflow_4_0.png" src="./SIM-workflow_files/SIM-workflow_4_0.png" />
</div>
</div>
<div class="section" id="geomutil-class">
<h1>14. Geomutil Class<a class="headerlink" href="#geomutil-class" title="Permalink to this headline">¶</a></h1>
<p><strong>Geomutil</strong> is a module which gathers different geometrical functions
used in other modeule of pylayers.</p>
<p>The importation is done as below. The geoutil alias is <em>geu</em></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.plotutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">shg</span>
</pre></div>
</div>
</div>
<div class="section" id="class-polygon">
<h1>15. Class Polygon<a class="headerlink" href="#class-polygon" title="Permalink to this headline">¶</a></h1>
<p>This class is important because it implements the visibility graph, of a
Polygon.</p>
<p>The Polygon class is a subclass of the shapely polygon class. It allows
to initialize a Polygon with different object
(list,np.array,sh.MultiPoint)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">points</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">)])</span>
<span class="n">poly1</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">poly2</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span>
<span class="n">nppoints</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
<span class="n">poly3</span>  <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">nppoints</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="ploting-polygons">
<h2>15.1. ploting polygons<a class="headerlink" href="#ploting-polygons" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">poly1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">poly2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">poly3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_8_0.png" src="./MISC-geomutil_files/MISC-geomutil_8_0.png" />
</div>
<div class="section" id="buildgv">
<h2>15.2. <tt class="docutils literal"><span class="pre">buildGv()</span></tt><a class="headerlink" href="#buildgv" title="Permalink to this headline">¶</a></h2>
<p>Dertermine visibility relationships in a Polygon. Returns a graph</p>
<p>This function is used for determining visibility relationships in indoor
environement.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">figsize</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">points</span>  <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> \
                                          <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> \
                                          <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
<span class="n">polyg</span>   <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">Gv</span>      <span class="o">=</span> <span class="n">polyg</span><span class="o">.</span><span class="n">buildGv</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_11_1.png" src="./MISC-geomutil_files/MISC-geomutil_11_1.png" />
</div>
</div>
<div class="section" id="geomview-classes">
<h1>16. Geomview classes<a class="headerlink" href="#geomview-classes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="geomvect-class">
<h2>16.1. GeomVect class<a class="headerlink" href="#geomvect-class" title="Permalink to this headline">¶</a></h2>
<p>This class is used to interact with geomview 3D viewer.</p>
<div class="section" id="geombase">
<h3>16.1.1. geomBase<a class="headerlink" href="#geombase" title="Permalink to this headline">¶</a></h3>
<p>Display a base</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">M</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">))</span>
<span class="n">gv</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
<span class="n">gv</span><span class="o">.</span><span class="n">geomBase</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="c">#gv.show3()</span>
</pre></div>
</div>
</div>
<div class="section" id="points">
<h3>16.1.2. points<a class="headerlink" href="#points" title="Permalink to this headline">¶</a></h3>
<p>display a set of points</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">gv1</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="s">&#39;test1&#39;</span><span class="p">)</span>
<span class="n">gv1</span><span class="o">.</span><span class="n">points</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="c">#gv1.show3()</span>
</pre></div>
</div>
<p>ndarray method converts a Polygon object to an ndarray</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">geo</span> <span class="o">=</span> <span class="n">Geomoff</span><span class="p">(</span><span class="s">&#39;test2&#39;</span><span class="p">)</span>
<span class="n">pt</span>  <span class="o">=</span> <span class="n">poly3</span><span class="o">.</span><span class="n">ndarray</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="n">pt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">))))</span>
</pre></div>
</div>
<p>This class is used in module vrml2geom</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">polys</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]]</span>
<span class="n">geo</span><span class="o">.</span><span class="n">polygons</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">polys</span><span class="p">)</span>
<span class="c">#geo.show3()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">poly</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">geo</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">poly</span><span class="p">)</span>
<span class="c">#geo.show3()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.</span><span class="p">]])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">extrem</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-a-box">
<h3>16.1.3. plotting a box<a class="headerlink" href="#plotting-a-box" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">geo</span><span class="o">=</span><span class="n">Geomoff</span><span class="p">(</span><span class="s">&#39;test3&#39;</span><span class="p">)</span>
<span class="n">geo</span><span class="o">.</span><span class="n">box</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#geo.show3()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="utility-functions">
<h2>16.2. Utility functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="angledir">
<h3>16.2.1. angledir<a class="headerlink" href="#angledir" title="Permalink to this headline">¶</a></h3>
<p>angledir converts a 3D vector into the 2 spherical angle <img src="../_images/mathmpl/math-5dc8912759.png" style="position: relative; bottom: -3px"/>,
<img src="../_images/mathmpl/math-e22cc525ec.png" style="position: relative; bottom: -7px"/> expressed in radians</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">angledir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">pi</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([[</span> <span class="mf">90.</span>        <span class="p">,</span>   <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span> <span class="mf">90.</span>        <span class="p">,</span>  <span class="mf">90.</span>        <span class="p">],</span>
       <span class="p">[</span>  <span class="mf">0.</span>        <span class="p">,</span>   <span class="mf">0.</span>        <span class="p">],</span>
       <span class="p">[</span> <span class="mf">54.73561032</span><span class="p">,</span>  <span class="mf">45.</span>        <span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="section" id="linet">
<h3>16.2.2. linet<a class="headerlink" href="#linet" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">()</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">linet</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">al</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">linet</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">al</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">linet</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">al</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">linet</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">p4</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">al</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;cyan&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_36_0.png" src="./MISC-geomutil_files/MISC-geomutil_36_0.png" />
</div>
<div class="section" id="dptseg-p-pt-ph">
<h3>16.2.3. dptseg(p,pt,ph)<a class="headerlink" href="#dptseg-p-pt-ph" title="Permalink to this headline">¶</a></h3>
<p>this function calculates distances between a set of points and a segment</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span> <span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">11</span><span class="p">],[</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>
<span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">dptseg</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">ph</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">print</span> <span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">h</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[[ -1.   1.   3.   4.  11.]] [[ 11.   9.   7.   6.  -1.]] [ 8.  1.  2.  3.  3.]
</pre></div>
</div>
</div>
<div class="section" id="displot">
<h3>16.2.4. displot<a class="headerlink" href="#displot" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">N</span>   <span class="o">=</span> <span class="mi">50</span>
<span class="n">pt</span>  <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">ph</span>  <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span> <span class="o">=</span> <span class="n">displot</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="n">ph</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_42_0.png" src="./MISC-geomutil_files/MISC-geomutil_42_0.png" />
</div>
<div class="section" id="ptonseg-pta-phe-pt">
<h3>16.2.5. ptonseg(pta,phe,pt)<a class="headerlink" href="#ptonseg-pta-phe-pt" title="Permalink to this headline">¶</a></h3>
<p>used in select.py</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">phe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">ptonseg</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">phe</span><span class="p">,</span><span class="n">pt</span><span class="p">)</span>
<span class="k">print</span> <span class="n">p</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[ 9.  0.]
</pre></div>
</div>
</div>
<div class="section" id="ptconvex">
<h3>16.2.6. ptconvex<a class="headerlink" href="#ptconvex" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="n">points</span>  <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">polyg</span>   <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">tcc</span><span class="p">,</span><span class="n">n</span>   <span class="o">=</span> <span class="n">polyg</span><span class="o">.</span><span class="n">ptconvex</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">polyg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">tcc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_48_0.png" src="./MISC-geomutil_files/MISC-geomutil_48_0.png" />
<img alt="./MISC-geomutil_files/MISC-geomutil_48_1.png" src="./MISC-geomutil_files/MISC-geomutil_48_1.png" />
</div>
<div class="section" id="intersect">
<h3>16.2.7. intersect<a class="headerlink" href="#intersect" title="Permalink to this headline">¶</a></h3>
<p>intersect(A,B,C,D) wether or not the N segments (AB) intersects N
segments (CD). The intersection is tested only for the segment of same
index in the ndarray.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.plotutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="n">N1</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">N2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
<span class="n">D</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">intersect</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pt1</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span><span class="n">b1</span><span class="p">]</span>
<span class="n">ph1</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,</span><span class="n">b1</span><span class="p">]</span>
<span class="n">pt2</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span><span class="n">b1</span><span class="p">]</span>
<span class="n">ph2</span> <span class="o">=</span> <span class="n">D</span><span class="p">[:,</span><span class="n">b1</span><span class="p">]</span>
<span class="n">pt3</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,(</span><span class="mi">1</span><span class="o">-</span><span class="n">b1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
<span class="n">ph3</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,(</span><span class="mi">1</span><span class="o">-</span><span class="n">b1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
<span class="n">pt4</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,(</span><span class="mi">1</span><span class="o">-</span><span class="n">b1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
<span class="n">ph4</span> <span class="o">=</span> <span class="n">D</span><span class="p">[:,(</span><span class="mi">1</span><span class="o">-</span><span class="n">b1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
<span class="n">f1</span><span class="p">,</span><span class="n">a1</span> <span class="o">=</span> <span class="n">displot</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="n">ph1</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
<span class="n">f2</span><span class="p">,</span><span class="n">a2</span> <span class="o">=</span> <span class="n">displot</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span><span class="n">ph2</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
<span class="n">f3</span><span class="p">,</span><span class="n">a3</span> <span class="o">=</span> <span class="n">displot</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span><span class="n">ph3</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="n">f4</span><span class="p">,</span><span class="n">a4</span> <span class="o">=</span> <span class="n">displot</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span><span class="n">ph4</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ti</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;test intersect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_53_0.png" src="./MISC-geomutil_files/MISC-geomutil_53_0.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">b1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">b1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;bool&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">array</span><span class="p">([</span><span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span>  <span class="bp">True</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b1</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">False</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b1</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<p>One want to evaluate all the intersection of a set of segments of</p>
</div>
</div>
<div class="section" id="useful-functions">
<h2>16.3. Useful functions<a class="headerlink" href="#useful-functions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>isaligned?
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">27.835</span><span class="p">,</span>  <span class="mf">10.891</span><span class="p">])</span>
<span class="n">phs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">27.836</span><span class="p">,</span>  <span class="mf">10.926</span><span class="p">])</span>

<span class="n">ptk</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">27.833</span><span class="p">,</span>  <span class="mf">10.686</span><span class="p">])</span>
<span class="n">phk</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">27.835</span><span class="p">,</span>  <span class="mf">10.891</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">isaligned</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">phs</span><span class="p">,</span><span class="n">ptk</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">isaligned</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">phs</span><span class="p">,</span><span class="n">phk</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">phs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">phs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;or&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">ptk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ptk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;ob&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">phk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">phk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;ob&#39;</span><span class="p">)</span>
<span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">(</span><span class="o">-</span><span class="mf">27.836000000000002</span><span class="p">,</span> <span class="o">-</span><span class="mf">27.832500000000003</span><span class="p">,</span> <span class="mf">10.65</span><span class="p">,</span> <span class="mf">10.950000000000001</span><span class="p">)</span>
</pre></div>
</div>
<img alt="./MISC-geomutil_files/MISC-geomutil_64_1.png" src="./MISC-geomutil_files/MISC-geomutil_64_1.png" />
<div class="highlight-python"><div class="highlight"><pre>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2015, PyLayers developer team.
      Last updated on avril 20, 2015.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3. Design by <a href="http://desgrana.es">Desgrana</a>.
    <span style="padding-left: 5ex;">
    <a href="../_sources/./UserManual.txt"
	    rel="nofollow">Show this page source</a>
    </span>
    </div>
     <div class="rel rellarge">
    
    <div class="buttonPrevious">
      <a href="../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>