
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Synthesis of Ultra Wide Band Waveforms &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../index.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body>

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../index.html">
            <img src="../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../download.html">Download</a></li>
            <li><a href="../TOC.html">User Guide</a></li>
            <li><a href="../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	   <div class="rel rellarge">
	     
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<!-- Ad a link to the 'up' page -->
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	<ul>
<li><a class="reference internal" href="#">Synthesis of Ultra Wide Band Waveforms</a><ul>
<li><a class="reference internal" href="#generation-of-an-impulse-of-normalized-energy">Generation of an Impulse of normalized energy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#verification-of-energy-normalization-in-both-domains">Verification of energy normalization in both domains</a></li>
<li><a class="reference internal" href="#calculation-of-uwb-channel-impulse-response">Calculation of UWB channel impulse response</a></li>
<li><a class="reference internal" href="#construction-of-the-propagation-channel">Construction of the propagation channel</a></li>
<li><a class="reference internal" href="#construction-of-the-transmission-channel">Construction of the transmission channel</a></li>
<li><a class="reference internal" href="#calculate-uwb-channel-impulse-response">Calculate UWB Channel Impulse Response</a></li>
<li><a class="reference internal" href="#hermitian-symetry-enforcment">Hermitian symetry enforcment</a></li>
</ul>

    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">pylab</span> <span class="n">inline</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Populating the interactive namespace from numpy and matplotlib
</pre></div>
</div>
<div class="section" id="synthesis-of-ultra-wide-band-waveforms">
<h1>Synthesis of Ultra Wide Band Waveforms<a class="headerlink" href="#synthesis-of-ultra-wide-band-waveforms" title="Permalink to this headline">¶</a></h1>
<p>Once the propagation channel has been evaluated. This is done in the
<tt class="docutils literal"><span class="pre">pylayers.antprop.channel</span></tt> module. The received signal is evaluated in
applying a convolution product of each ray tranfer function with a
specific IR-UWB waveform. The necessary modules are</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pylayers.signal.bsignal</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">pylayers.signal.waveform</span></tt></li>
<li><tt class="docutils literal"><span class="pre">pylayers.signal.channel</span></tt></li>
</ul>
<p>The module <tt class="docutils literal"><span class="pre">pylayers.simul.simulem</span></tt> is for definition of
electromagnetic simulation.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.signal.waveform</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.simul.simulem</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="section" id="generation-of-an-impulse-of-normalized-energy">
<h2>Generation of an Impulse of normalized energy<a class="headerlink" href="#generation-of-an-impulse-of-normalized-energy" title="Permalink to this headline">¶</a></h2>
<p>One possible manner to define an energy normalized short UWB impulse is
as follows using <tt class="docutils literal"><span class="pre">bsignal.EnImpulse</span></tt> function.</p>
<p>The default waveform is a gaussian windowing of a sine wave of frequency
<img src="../../_images/mathmpl/math-e5c4897d65.png" style="position: relative; bottom: -7px"/>. The normalization term depends on the exponential scaling
factor <img src="../../_images/mathmpl/math-f970af607c.png" style="position: relative; bottom: -3px"/>.</p>
<p><img src="../../_images/mathmpl/math-2c117aeff6.png" style="position: relative; bottom: -12px"/></p>
<p><img src="../../_images/mathmpl/math-a1202c7aca.png" style="position: relative; bottom: -11px"/></p>
<p>where <img src="../../_images/mathmpl/math-957afab571.png" style="position: relative; bottom: -3px"/> is the desired bandwidth defined at <img src="../../_images/mathmpl/math-7b431e1910.png" style="position: relative; bottom: -7px"/>
below the spectrum maximum and <img src="../../_images/mathmpl/math-e5c4897d65.png" style="position: relative; bottom: -7px"/> is the central frequency of
the pulse.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fc</span>     <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">band</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thresh</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fe</span>     <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ip</span>     <span class="o">=</span> <span class="n">EnImpulse</span><span class="p">([],</span><span class="n">fc</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">thresh</span><span class="p">,</span><span class="n">fe</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-3-eb9e61732349&gt; in &lt;module&gt;()
      3 thresh = 10
      4 fe     = 100
----&gt; 5 ip     = EnImpulse([],fc,band,thresh,fe)


NameError: name &#39;EnImpulse&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ip</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-4-f2dd061e0735&gt; in &lt;module&gt;()
----&gt; 1 ip.info()


NameError: name &#39;ip&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="section" id="verification-of-energy-normalization-in-both-domains">
<h1>Verification of energy normalization in both domains<a class="headerlink" href="#verification-of-energy-normalization-in-both-domains" title="Permalink to this headline">¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">E1</span><span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">ip</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">ip</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;Integration in time&quot;</span><span class="p">,</span><span class="n">E1</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-5-2ff960551bb1&gt; in &lt;module&gt;()
----&gt; 1 E1= sum(ip.y*ip.y)*ip.dx()
      2 print &quot;Integration in time&quot;,E1


NameError: name &#39;ip&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">P</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">esd</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">E2</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="n">P</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;Integration in frequency domain &quot;</span><span class="p">,</span><span class="n">E2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-6-f88fbaeebaf0&gt; in &lt;module&gt;()
----&gt; 1 P = ip.esd()
      2 E2 = sum(P.y)*P.dx()
      3 print &quot;Integration in frequency domain &quot;,E2


NameError: name &#39;ip&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="calculation-of-uwb-channel-impulse-response">
<h1>Calculation of UWB channel impulse response<a class="headerlink" href="#calculation-of-uwb-channel-impulse-response" title="Permalink to this headline">¶</a></h1>
<p>We choose to load a simple floor plan.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span> <span class="o">=</span> <span class="n">Simul</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="s">&#39;defstr3.ini&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>new file defstr3.ini
</pre></div>
</div>
<p>A simulation object has an <tt class="docutils literal"><span class="pre">info</span></tt> method providing a summary of
simulation informations.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">st</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sf</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>fcGHz  :  4.493
typ  :  generic
feGHz  :  100
Np  :  3000
twns  :  30
te  :  0.01
threshdB  :  3
bandGHz  :  0.499
</pre></div>
</div>
<p>The waveform associated with the simulation object is</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">wav</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;Np&#39;</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>
 <span class="s">&#39;bandGHz&#39;</span><span class="p">:</span> <span class="mf">0.499</span><span class="p">,</span>
 <span class="s">&#39;fcGHz&#39;</span><span class="p">:</span> <span class="mf">4.493</span><span class="p">,</span>
 <span class="s">&#39;feGHz&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
 <span class="s">&#39;te&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
 <span class="s">&#39;threshdB&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
 <span class="s">&#39;twns&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
 <span class="s">&#39;typ&#39;</span><span class="p">:</span> <span class="s">&#39;generic&#39;</span><span class="p">}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/Signal_15_0.png" src="../../_images/Signal_15_0.png" />
<p>Above the waveform is a generic UWB waveform. The interested user can
add easyly any other mathematical expression of UWB waveform for
investigation on pulse waveform modulation for example. The waveform can
also comes from measurement. For now there are two version of this
waveform which has been used during the M1 measurement campaign. One is
not compensated <tt class="docutils literal"><span class="pre">W1compensate</span></tt> for an extra short delay which can
introduse a bias when interpretating the observed delay in terms of
distance. The non compensated version is <tt class="docutils literal"><span class="pre">W1offset</span></tt> from the time
origin about 0.7 ns.</p>
<p>The waveform class should grow for incorporating more waveforms,
especially waveforms compliants with the current IEEE 802.15.4a and IEEE
802.15.6 standards.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wavmeasured</span> <span class="o">=</span> <span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;W1compensate&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wavmeasured</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>IndexErrorTraceback (most recent call last)

&lt;ipython-input-11-22a822769751&gt; in &lt;module&gt;()
      1 wavmeasured = Waveform(typ=&#39;W1compensate&#39;)
----&gt; 2 wavmeasured.show()


/home/uguen/Documents/rch/devel/pylayers/pylayers/signal/waveform.pyc in show(self, fig)
    382         #plt.title(title)
    383         ax1 = fig.add_subplot(2,1,1)
--&gt; 384         ax1.plot(self.st.x,self.st.y[0,:])
    385         plt.xlabel(&#39;time (ns)&#39;)
    386         plt.ylabel(&#39;level in linear scale&#39;)


IndexError: too many indices for array
</pre></div>
</div>
<img alt="../../_images/Signal_17_1.png" src="../../_images/Signal_17_1.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wavmeasured</span> <span class="o">=</span> <span class="n">Waveform</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;W1offset&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wavmeasured</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/Signal_18_0.png" src="../../_images/Signal_18_0.png" />
<p>Here the time domain waveform is measured and the anticausal part of the
signal is artificially set to 0.</p>
<p>To handle properly the time domain wavefom in PyLayers, it is required
to center the signal in the middle of the array. The waveform has
embedded in the object its frequency domain and time domain
representation.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">st</span></tt> member stands for signal in time domain</li>
<li><tt class="docutils literal"><span class="pre">sf</span></tt> member stands for signal in frequency domain</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;class &#39;pylayers.signal.bsignal.FUsignal&#39;&gt;
&lt;class &#39;pylayers.signal.bsignal.TUsignal&#39;&gt;
</pre></div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">FUsignal</span></tt> Frequency domain uniformly sampled base signal</li>
<li><tt class="docutils literal"><span class="pre">TUsignal</span></tt> Time domain uniformly sampled base signal</li>
</ul>
</div>
<div class="section" id="construction-of-the-propagation-channel">
<h1>Construction of the propagation channel<a class="headerlink" href="#construction-of-the-propagation-channel" title="Permalink to this headline">¶</a></h1>
<p>The following representation shows the spatial spreading of the
propagation channel. On the left are scattered the intensity of rays wrt
to angles of departure (in azimut and elevation). On the right is the
intensity of rays wrt to angles of arrival. It misses the application
between the 2 planes as well as the delay dimension of the propagation
channel.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>building Layout ...
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>KeyErrorTraceback (most recent call last)

&lt;ipython-input-15-775c93de59f6&gt; in &lt;module&gt;()
----&gt; 1 S.L.build()


/home/uguen/Documents/rch/devel/pylayers/pylayers/gis/layout.pyc in build(self, graph, verbose)
   4778             if verbose:
   4779                 print &quot;Gt&quot;
-&gt; 4780             self.buildGt()
   4781             self.lbltg.extend(&#39;t&#39;)
   4782


/home/uguen/Documents/rch/devel/pylayers/pylayers/gis/layout.pyc in buildGt(self, check)
   5451
   5452             seg = p.vnodes[p.vnodes&gt;0]
-&gt; 5453             lair = [x in (self.name[&#39;AIR&#39;]+self.name[&#39;_AIR&#39;]) for x in seg]
   5454
   5455             if sum(lair)&gt;0:


KeyError: &#39;AIR&#39;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">L</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>----------------
defstr3.ini
----------------

Number of points  : 4
Number of segments  : 4
Number of sub segments  : 0
Number of cycles  : 0
Number of rooms  : 0

xrange :(-30.0, 30.0)
yrange :(-20.0, 20.0)

Useful dictionnaries
----------------
name :  {slab :seglist}

Useful arrays
----------------

Useful tip
----------------
Point p in Gs =&gt; p_coord:
p -&gt; u = self.iupnt[-p] -&gt; p_coord = self.pt[:,u]

Segment s in Gs =&gt; s_ab coordinates
s -&gt; u = self.tgs[s] -&gt; v = self.tahe[:,u] -&gt; s_ab = self.pt[:,v]
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{}</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">tx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">759</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">767</span><span class="p">,</span><span class="mi">1114</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ctx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crx</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-18-14f0bff94dac&gt; in &lt;module&gt;()
      1 tx=np.array([759,1114,1.0])
      2 rx=np.array([767,1114,1.5])
----&gt; 3 ctx = S.L.pt2cy(tx)
      4 crx = S.L.pt2cy(rx)


/home/uguen/Documents/rch/devel/pylayers/pylayers/gis/layout.pyc in pt2cy(self, pt)
   8381                     return(ncy)
   8382         if not cycle_exists:
-&gt; 8383             raise NameError(str(pt)+&quot; is not in any cycle&quot;)
   8384
   8385     def cy2pt(self, cy=0, h=1.2):


NameError: [  7.59000000e+02   1.11400000e+03   1.00000000e+00] is not in any cycle
</pre></div>
</div>
<p>The sequence of command below :</p>
<ul class="simple">
<li>initialize a signature between cycle ctx and cycle crx</li>
<li>evaluates the signature with a given cutoff value</li>
<li>calculates a set of 2D rays from signature and tx/rx coordinates</li>
<li>calculates a set of 3D ray from 2D rays and layout and ceil height
(default H=3m)</li>
<li>calculates local basis and various geometric information out of the
3D ray and Layout</li>
<li>fill and reorganize the interactions object with proper material
chararcteristics</li>
</ul>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Si</span><span class="o">.</span><span class="n">run5</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r3d</span> <span class="o">=</span> <span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-19-2b87940b94c6&gt; in &lt;module&gt;()
----&gt; 1 Si = Signatures(S.L,ctx,crx)
      2 Si.run5(cutoff=5)
      3 r2d = Si.rays(tx,rx)
      4 r3d = r2d.to3D(S.L)
      5 r3d.locbas(S.L)


NameError: name &#39;ctx&#39; is not defined
</pre></div>
</div>
<p>Define a frequency base in GHz.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
<p>Evaluate the propagation channel <img src="../../_images/mathmpl/math-c2b5c6f441.png" style="position: relative; bottom: -3px"/>. Here the
meaning of tilde is that the complex value of the channel do not include
the phase term due to delay along the ray.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-21-6de7eb6ea340&gt; in &lt;module&gt;()
----&gt; 1 C = r3d.eval(fGHz)


NameError: name &#39;r3d&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="construction-of-the-transmission-channel">
<h1>Construction of the transmission channel<a class="headerlink" href="#construction-of-the-transmission-channel" title="Permalink to this headline">¶</a></h1>
<p>The transmission channel is obtained from the combination of the
propagation channel <img src="../../_images/mathmpl/math-c2b5c6f441.png" style="position: relative; bottom: -3px"/> and the vector antenna
pattern at both side of the radio link. This operation is implemented in
the <tt class="docutils literal"><span class="pre">prop2tran</span></tt> method of the <tt class="docutils literal"><span class="pre">Ctilde</span></tt> class.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-22-b1508994e444&gt; in &lt;module&gt;()
----&gt; 1 sc = C.prop2tran()


NameError: name &#39;C&#39; is not defined
</pre></div>
</div>
<p>The transmission channel is obtained by applying a vector radiation
pattern using an antenna file.</p>
<p>In the presented case, it comes from a real antenna which has been used
during the <strong>FP7 project WHERE1</strong> measurement campaign M1.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;&#39;</span>
</pre></div>
</div>
<p>The antenna radiation pattern is stored in a very compact way thanks to
Vector Spherical Harmonics decomposition. The following gives
information about the content of the antenna object.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>AttributeErrorTraceback (most recent call last)

&lt;ipython-input-24-405e831617c9&gt; in &lt;module&gt;()
----&gt; 1 S.tx.A.info()


AttributeError: &#39;RadioNode&#39; object has no attribute &#39;A&#39;
</pre></div>
</div>
<p>The figure below plot on a same graph all the tansfer function in
modulus and phase of the ray transfer function.</p>
<p>If a realistic antenna is applied it gives</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sca</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-25-a14d4505d552&gt; in &lt;module&gt;()
----&gt; 1 sca = C.prop2tran(S.tx.A,S.rx.A)


NameError: name &#39;C&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="calculate-uwb-channel-impulse-response">
<h1>Calculate UWB Channel Impulse Response<a class="headerlink" href="#calculate-uwb-channel-impulse-response" title="Permalink to this headline">¶</a></h1>
<p>Once the transmission channel has been evaluated on can convolved the
waveform with the channel impulse response to get the received waveform.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>AttributeErrorTraceback (most recent call last)

&lt;ipython-input-26-d44add68b43a&gt; in &lt;module&gt;()
----&gt; 1 r = sca.applywavB(S.wav.sfg)


AttributeError: &#39;function&#39; object has no attribute &#39;applywavB&#39;
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-27-4953123faa92&gt; in &lt;module&gt;()
----&gt; 1 r.y


NameError: name &#39;r&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">u&#39;Received Waveform $r(t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-28-59cb5c50134a&gt; in &lt;module&gt;()
----&gt; 1 fig,ax = r.plot(typ=[&#39;l20&#39;])
      2 plt.axis([15,90,-120,-60])
      3 plt.title(u&#39;Received Waveform $r(t)$&#39;)


NameError: name &#39;r&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c">#plt.axis([15,60,-0.3,0.3])</span>
<span class="gp">... </span><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">u&#39;Received Waveform $r(t)$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-29-dec00a202aac&gt; in &lt;module&gt;()
----&gt; 1 r.plot(typ=[&#39;v&#39;])
      2 #plt.axis([15,60,-0.3,0.3])
      3 plt.title(u&#39;Received Waveform $r(t)$&#39;)


NameError: name &#39;r&#39; is not defined
</pre></div>
</div>
</div>
<div class="section" id="hermitian-symetry-enforcment">
<h1>Hermitian symetry enforcment<a class="headerlink" href="#hermitian-symetry-enforcment" title="Permalink to this headline">¶</a></h1>
<p>If the number of point for the transmission channel and the waveform
were the same the mathematical operation is an Hadamrd-Shur product
between <img src="../../_images/mathmpl/math-c7217de4b7.png" style="position: relative; bottom: -3px"/> and <img src="../../_images/mathmpl/math-9b5e528324.png" style="position: relative; bottom: -3px"/>.</p>
<p><img src="../../_images/mathmpl/math-50aab38b79.png" style="position: relative; bottom: -4px"/></p>
<p>In practice this is what is done after a resampling of the time base
with a reinterpolated time step.</p>
<p>The process which consists in going from time domain to frequency domain
is delegated to a specialized class <tt class="docutils literal"><span class="pre">pylayers.signal.bsignal.Bsignal</span></tt>
which maintains the proper binding between signal samples and their
indexation either in time or in frequency domain.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">wgam</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Y</span>    <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">wgam</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tau</span>  <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">taud</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dod</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">dod</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doa</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">doa</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-30-3c9fdd777ddd&gt; in &lt;module&gt;()
      1 wgam = S.wav.sfg
----&gt; 2 Y    = sc.apply(wgam)
      3 tau  = Y.taud
      4 dod = Y.dod
      5 doa = Y.doa


NameError: name &#39;sc&#39; is not defined
</pre></div>
</div>
<p>The transmission channel has a member data which is the time delay of
each path in nano seconds. Notice that by default those delay are not
sorted.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;tau =&#39;</span><span class="p">,</span> <span class="n">tau</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>tau =
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-31-b39f17c8cbc1&gt; in &lt;module&gt;()
----&gt; 1 print &#39;tau =&#39;, tau[0:20]


NameError: name &#39;tau&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-32-daaa7a3adee0&gt; in &lt;module&gt;()
----&gt; 1 h = plt.hist(tau,20)


NameError: name &#39;tau&#39; is not defined
</pre></div>
</div>
<p>Direction of arrival <img src="../../_images/mathmpl/math-69ee887da1.png" style="position: relative; bottom: -8px"/> in radians</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;doa = &quot;</span><span class="p">,</span> <span class="n">doa</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">,:]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>doa =
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-33-70fae1c8afa3&gt; in &lt;module&gt;()
----&gt; 1 print &quot;doa = &quot;, doa[1:10,:]


NameError: name &#39;doa&#39; is not defined
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ht</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$</span><span class="se">\\</span><span class="s">theta_r$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$\phi_r$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ht</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$</span><span class="se">\\</span><span class="s">theta_t$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">u&#39;$\phi_t$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>NameErrorTraceback (most recent call last)

&lt;ipython-input-34-cfe931a2177d&gt; in &lt;module&gt;()
      1 plt.subplot(221)
----&gt; 2 ht = plt.hist(doa[:,0],20)
      3 plt.xlabel(u&#39;$\\theta_r$&#39;)
      4 plt.ylabel(&#39;#&#39;)
      5 plt.subplot(222)


NameError: name &#39;doa&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/Signal_53_1.png" src="../../_images/Signal_53_1.png" />
</div>


          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2016, PyLayers developer team.
      Last updated on Jun 25, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3. Design by <a href="http://desgrana.es">Desgrana</a>.
    <span style="padding-left: 5ex;">
    <a href="../../_sources/notebook/3-PHY/Signal.txt"
	    rel="nofollow">Show this page source</a>
    </span>
    </div>
     <div class="rel rellarge">
    
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>