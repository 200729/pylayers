

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.antenna &mdash; PyLayers v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="pylayers.antprop" href="../antprop.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../antprop.html" accesskey="U">pylayers.antprop</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.antprop.antenna</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="kn">as</span> <span class="nn">special</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="c">#from spharm import Spharmt,getspecindx</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sphere</span> <span class="kn">import</span> <span class="n">spherepack</span><span class="p">,</span> <span class="n">Wrapec</span><span class="p">,</span> <span class="n">mathtogeo</span>

<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>


<span class="k">def</span> <span class="nf">indexvsh</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; indexvsh(N)</span>

<span class="sd">    Prameters</span>
<span class="sd">    ---------</span>
<span class="sd">         N : degree max</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Kmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Kmax</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c">#u = vstack((k,n,m)).T</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int</span>
<span class="sd">        degree max   sum(0..N)   N+1 points</span>
<span class="sd">    M : int</span>
<span class="sd">        order max    sum(0..M)   M+1 points</span>

<span class="sd">    M &lt;=N</span>

<span class="sd">    ind[0] = n</span>
<span class="sd">    ind[1] = m</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;indexvsh error M&gt;N&quot;</span>

    <span class="n">Kmax1</span> <span class="o">=</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Kmax1</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">M</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">):</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">M</span><span class="p">)</span> <span class="o">+</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">M</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n1</span><span class="p">))</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">m1</span><span class="p">))</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">geom_pattern</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">minr</span><span class="p">,</span> <span class="n">maxr</span><span class="p">,</span> <span class="n">racine</span><span class="p">,</span> <span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; export antenna pattern in geomview format</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    theta : np.array (1 x Ntheta)</span>
<span class="sd">    phi   : np.array (1 x Nphi)</span>
<span class="sd">    E     : np.array complex  (Ntheta,Nphi)</span>
<span class="sd">    f     : frequency</span>
<span class="sd">    po    : origin (1x3)</span>
<span class="sd">    minr  : radius of minimum</span>
<span class="sd">    maxr  : radius of maximum</span>
<span class="sd">    ilog  : True (log) False (linear)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ilog</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
    <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span> <span class="n">phi</span><span class="p">)</span>

    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">-</span> <span class="n">minr</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxr</span> <span class="o">-</span> <span class="n">minr</span><span class="p">)</span>
    <span class="n">Ry</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">T</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Ry</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">Ry</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">Ry</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">Npoints</span> <span class="o">=</span> <span class="n">Nt</span> <span class="o">*</span> <span class="n">Np</span>
    <span class="n">Nfaces</span> <span class="o">=</span> <span class="p">(</span><span class="n">Nt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Np</span>
    <span class="n">Nedge</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c">#</span>
    <span class="c"># Colormap</span>
    <span class="c">#</span>
    <span class="n">colmap</span> <span class="o">=</span> <span class="n">get_cmap</span><span class="p">()</span>
    <span class="n">Ncol</span> <span class="o">=</span> <span class="n">colmap</span><span class="o">.</span><span class="n">N</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">colmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ncol</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">R</span> <span class="o">-</span> <span class="n">minr</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ncol</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">maxr</span> <span class="o">-</span> <span class="n">minr</span><span class="p">))</span>

    <span class="n">_filename</span> <span class="o">=</span> <span class="n">racine</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1000</span> <span class="o">+</span> <span class="n">f</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s">&#39;.off&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;COFF</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">chaine</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Npoints</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Nfaces</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Nedge</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">cpos</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">])</span>
            <span class="n">cpos</span> <span class="o">=</span> <span class="n">cpos</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">ik</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span>
            <span class="n">ccol</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> \
                <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cmap</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
            <span class="n">ccol</span> <span class="o">=</span> <span class="n">ccol</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cpos</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">ccol</span> <span class="o">+</span> <span class="s">&#39; 0.8</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">*</span> <span class="n">Np</span> <span class="o">+</span> <span class="n">jj</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">*</span> <span class="n">Np</span> <span class="o">+</span> <span class="n">mod</span><span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Np</span> <span class="o">+</span> <span class="n">jj</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Np</span> <span class="o">+</span> <span class="n">mod</span><span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&#39;4 &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">p4</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; 0.5</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

    <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">SHCoeff</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Spherical Harmonics Coefficient</span>

<span class="sd">    d = np.array [Nf,N+1,M+1]</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    s1  shape 1   np.array [ Nf x (N+1) x (M+1) ]</span>
<span class="sd">    s2  shape 2   np.array [ Nf x (N+1)*(M+1)   ]</span>
<span class="sd">    s3  shape 3   np.array [ Nf x K     ]</span>
<span class="sd">    ind [ K x 2]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                 <span class="n">ind</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">k</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         typ : string</span>
<span class="sd">            &#39;s1&#39; | &#39;s2&#39; | &#39;s3&#39;</span>
<span class="sd">         fmin</span>
<span class="sd">         fmax</span>
<span class="sd">         data</span>
<span class="sd">         ind</span>
<span class="sd">         k</span>

<span class="sd">         s1, s2 , s3 containers are created</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inits1</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inits2</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s3&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inits3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

<div class="viewcode-block" id="SHCoeff.inits1"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.inits1.html#pylayers.antprop.antenna.SHCoeff.inits1">[docs]</a>    <span class="k">def</span> <span class="nf">inits1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize shape 1 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data  : shape 1 data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;SHCoeff : M&gt;N &#39;</span><span class="p">)</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N1</span> <span class="o">=</span> <span class="n">N</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M1</span> <span class="o">=</span> <span class="n">M</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="SHCoeff.inits2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.inits2.html#pylayers.antprop.antenna.SHCoeff.inits2">[docs]</a>    <span class="k">def</span> <span class="nf">inits2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize shape 2 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">         data : shape 2 data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kmax</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">kmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">indexvsh</span><span class="p">(</span><span class="n">nmax</span><span class="p">)</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="n">t</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="n">N2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M2</span> <span class="o">=</span> <span class="n">M2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">M2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SHCoeff.inits3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.inits3.html#pylayers.antprop.antenna.SHCoeff.inits3">[docs]</a>    <span class="k">def</span> <span class="nf">inits3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize shape 3 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">         data  : shape 3 data</span>
<span class="sd">         ind   : ishape 3 indexing</span>
<span class="sd">         k     : k</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="n">ind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">k</span>
</div>
<div class="viewcode-block" id="SHCoeff.s1tos2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.s1tos2.html#pylayers.antprop.antenna.SHCoeff.s1tos2">[docs]</a>    <span class="k">def</span> <span class="nf">s1tos2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N2</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert shape 1 --&gt; shape 2</span>

<span class="sd">        shape 1   array [ Nf x (N+1) x (M+1) ]</span>
<span class="sd">        shape 2   array [ Nf x (N+1)*(M+1)   ]</span>
<span class="sd">        n = 0...N2</span>
<span class="sd">        m = 0...N2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N2 : int &lt;= N1</span>
<span class="sd">            shape 1 has 3 axis - shape 2 has 2 axis</span>
<span class="sd">            by default all s1 coefficients are kept N2=-1 means N2=min(N1,M1) because M2 must be equal to N2</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        index_vsh</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">N2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M1</span><span class="p">)</span>
        <span class="n">M2</span> <span class="o">=</span> <span class="n">N2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">N2</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="n">N2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">M2</span> <span class="o">=</span> <span class="n">M2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N2</span><span class="p">,</span> <span class="n">M2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;error SHCoeff s1tos2: N2&gt;N1&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SHCoeff.delete"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.delete.html#pylayers.antprop.antenna.SHCoeff.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ind   : int</span>
<span class="sd">        typ   : int</span>
<span class="sd">                2  shape 2  (Nf , N*M   )</span>
<span class="sd">                3  shape 3  (Nf , K )  T ( K x 2 )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">b</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">c</span>
</div>
    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; recover last deleted coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ : int</span>
<span class="sd">                2 : shape 2  (Nf , N*M   )</span>
<span class="sd">                3 : shape 3  (Nf , K )  T ( K x 2 )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

            <span class="n">file_ind</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;outfile_i2.txt&quot;</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">file_ind</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="n">file_s2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;outfile_s2.txt&quot;</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">file_s2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">s2p</span> <span class="o">=</span> <span class="n">s2</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s2</span> <span class="o">=</span> <span class="n">b</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

            <span class="n">file_ind</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;outfile_i3.txt&quot;</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">file_ind</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ind3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">aux</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

            <span class="n">file_s3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;outfile_s3.txt&quot;</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="n">file_s3</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">s3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">c</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_ind</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_s3</span><span class="p">)</span>

<div class="viewcode-block" id="SHCoeff.delete3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.delete3.html#pylayers.antprop.antenna.SHCoeff.delete3">[docs]</a>    <span class="k">def</span> <span class="nf">delete3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete3(self,ind): delete coeff.s3</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ind :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="SHCoeff.put3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.put3.html#pylayers.antprop.antenna.SHCoeff.put3">[docs]</a>    <span class="k">def</span> <span class="nf">put3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; put3</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        i  :</span>
<span class="sd">        i3 :</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">k2</span> <span class="o">=</span> <span class="n">i3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">i3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">k2</span><span class="p">]</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ind3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k2</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">k2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="n">c</span>
</div>
<div class="viewcode-block" id="SHCoeff.s3tos2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.s3tos2.html#pylayers.antprop.antenna.SHCoeff.s3tos2">[docs]</a>    <span class="k">def</span> <span class="nf">s3tos2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; transform shape3 to shape 2</span>

<span class="sd">        s2  shape 2   array [ Nf x (N+1)*(M+1)   ]</span>
<span class="sd">        s3  shape 3   array [ Nf x K     ] ind [ K x 2]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s3</span>
</div>
<div class="viewcode-block" id="SHCoeff.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.info.html#pylayers.antprop.antenna.SHCoeff.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; info about SHCoeff</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot;Nf   : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span>
        <span class="k">print</span> <span class="s">&quot;fmin (GHz) : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmin</span>
        <span class="k">print</span> <span class="s">&quot;fmax (GHz) : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmax</span>

        <span class="n">sh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">sh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">sh3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sh1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;N1  : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span>
            <span class="k">print</span> <span class="s">&quot;M1  : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M1</span>
            <span class="k">print</span> <span class="s">&quot;Ncoeff s1 &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span>

        <span class="k">if</span> <span class="n">sh2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;NCoeff s2  : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sh3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Ncoeff s3 : &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SHCoeff.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.SHCoeff.show.html#pylayers.antprop.antenna.SHCoeff.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span>
             <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">N</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">M</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">seuildb</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
             <span class="n">titre</span><span class="o">=</span><span class="s">&#39;SHC&#39;</span><span class="p">,</span>
             <span class="n">xl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">yl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
             <span class="n">anim</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ =  &#39;s1&#39; : shape 1  (Nf , N , M )</span>
<span class="sd">               &#39;s2&#39; : shape 2  (Nf , N*M   )</span>
<span class="sd">               &#39;s3&#39; : shape 3  (Nf , K )  T ( K x 2 )</span>

<span class="sd">        if typ = &#39;s1&#39; : k = frequency index</span>

<span class="sd">        N, M = maximal value for degree, mode respectively</span>
<span class="sd">        (not to be defined if &#39;s2&#39; or &#39;s3&#39;)</span>

<span class="sd">        if typ = &#39;s2&#39; or &#39;s3&#39; : k = maximal value for k index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">M1</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s1&#39;</span><span class="p">:</span>
            <span class="n">Mg</span><span class="p">,</span> <span class="n">Ng</span> <span class="o">=</span> <span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">anim</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">gcf</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">M</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">scatter</span><span class="p">(</span><span class="n">Mg</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="n">seuildb</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">M</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
                    <span class="n">vdB</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Mg</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">vdB</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">vmin</span><span class="o">=-</span><span class="n">seuildb</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">title</span><span class="p">(</span><span class="n">titre</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Mg</span><span class="p">,</span> <span class="n">Ng</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">title</span><span class="p">(</span><span class="n">titre</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">xl</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">yl</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s2&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">K</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">kmax</span> <span class="o">=</span> <span class="n">k</span>

            <span class="n">db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmax</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">))</span>
            <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">db</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">seuildb</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">db</span> <span class="o">+</span> <span class="n">seuildb</span><span class="p">)</span> <span class="o">/</span> <span class="n">seuildb</span>
            <span class="c">#</span>
            <span class="c">#gray</span>
            <span class="c">#</span>
            <span class="c">#pcolor(np.arange(K+1)[0:kmax],self.fa,col,cmap=cm.gray_r,vmin=0.0,vmax=1.0)</span>
            <span class="c">#</span>
            <span class="c">#color</span>
            <span class="c">#</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">kmax</span><span class="p">],</span> <span class="n">fa</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xl</span><span class="p">:</span>
                <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yl</span><span class="p">:</span>
                <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;s3&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fa</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">K</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">kmax</span> <span class="o">=</span> <span class="n">k</span>

            <span class="n">db</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">kmax</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-15</span><span class="p">))</span>
            <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">db</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">seuildb</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">db</span> <span class="o">+</span> <span class="n">seuildb</span><span class="p">)</span> <span class="o">/</span> <span class="n">seuildb</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">kmax</span><span class="p">],</span> <span class="n">fa</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xl</span><span class="p">:</span>
                <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yl</span><span class="p">:</span>
                <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

                <span class="c">#echelle=[str(0), str(-10), str(-20), str(-30), str(-40), str(-50)]</span>
            <span class="n">echelle</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">seuildb</span> <span class="o">+</span> <span class="mi">40</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">seuildb</span> <span class="o">+</span> <span class="mi">30</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span>
                <span class="o">-</span><span class="n">seuildb</span> <span class="o">+</span> <span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">seuildb</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">seuildb</span><span class="p">)]</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">echelle</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="n">titre</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">VSHCoeff</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Vector Spherical Harmonics Coefficients class</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    Bi</span>
<span class="sd">    Br</span>
<span class="sd">    Ci</span>
<span class="sd">    Cr</span>


<span class="sd">    Notes</span>
<span class="sd">    ------</span>

<span class="sd">    Br = SHCoeff(br)</span>
<span class="sd">    Bi = SHCoeff(bi)</span>
<span class="sd">    Cr = SHCoeff(cr)</span>
<span class="sd">    Ci = SHCoeff(ci)</span>
<span class="sd">    C  = VSHCoeff(Br,Bi,Cr,Ci)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            Br</span>
<span class="sd">            Bi</span>
<span class="sd">            Cr</span>
<span class="sd">            Ci</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span> <span class="o">=</span> <span class="n">Br</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span> <span class="o">=</span> <span class="n">Bi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span> <span class="o">=</span> <span class="n">Cr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span> <span class="o">=</span> <span class="n">Ci</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; VSH information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Br&quot;</span>
        <span class="k">print</span> <span class="s">&quot;-------------&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Bi&quot;</span>
        <span class="k">print</span> <span class="s">&quot;-------------&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Cr&quot;</span>
        <span class="k">print</span> <span class="s">&quot;-------------&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;Ci&quot;</span>
        <span class="k">print</span> <span class="s">&quot;-------------&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<div class="viewcode-block" id="VSHCoeff.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.show.html#pylayers.antprop.antenna.VSHCoeff.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">seuildb</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">animate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show VSH coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ : str</span>
<span class="sd">            {&#39;s1&#39;,&#39;s2&#39;,&#39;s3&#39;}</span>
<span class="sd">        k  : int</span>
<span class="sd">            frequency index</span>
<span class="sd">        N  : int</span>
<span class="sd">        M  : int</span>
<span class="sd">        seuildB  : float</span>
<span class="sd">        animate : boolean</span>
<span class="sd">                default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">animate</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
            <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Br_{n}^{(m)}|$&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
            <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Bi_{n}^{(m)}|$&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
            <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Cr_{n}^{(m)}|$&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
            <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Ci_{n}^{(m)}|$&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">Nf</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
                <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Br_{n}^{(m)}|$&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
                <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Bi_{n}^{(m)}|$&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
                <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Cr_{n}^{(m)}|$&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
                <span class="n">titre</span> <span class="o">=</span> <span class="s">&#39;$|Ci_{n}^{(m)}|$&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">seuildb</span><span class="p">,</span> <span class="n">titre</span><span class="p">,</span> <span class="n">xl</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">yl</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="c">#    show()</span>
</div>
<div class="viewcode-block" id="VSHCoeff.s1tos2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.s1tos2.html#pylayers.antprop.antenna.VSHCoeff.s1tos2">[docs]</a>    <span class="k">def</span> <span class="nf">s1tos2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N2</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert shape 1 to shape 2 </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N2 : max level</span>
<span class="sd">            default (-1 means all values)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">(</span><span class="n">N2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VSHCoeff.s2tos3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.s2tos3.html#pylayers.antprop.antenna.VSHCoeff.s2tos3">[docs]</a>    <span class="k">def</span> <span class="nf">s2tos3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert shape 2 to shape 3</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        threshold : float </span>


<span class="sd">           Energy thresholded coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">EBr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">EBi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">EBr</span> <span class="o">+</span> <span class="n">EBi</span> <span class="o">+</span> <span class="n">ECr</span> <span class="o">+</span> <span class="n">ECi</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">E</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">ind</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">ind</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">ind</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind2</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span><span class="p">[:,</span> <span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">k2</span> <span class="o">=</span> <span class="n">ind</span>
</div>
    <span class="k">def</span> <span class="nf">s3tos2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        s3tos2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3tos2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3tos2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3tos2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3tos2</span><span class="p">()</span>

<div class="viewcode-block" id="VSHCoeff.strip3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.strip3.html#pylayers.antprop.antenna.VSHCoeff.strip3">[docs]</a>    <span class="k">def</span> <span class="nf">strip3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Thresholded coefficient conversion</span>

<span class="sd">        The s3 minimmum energy coefficient is deleted</span>
<span class="sd">           return ind,ind3</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">EBr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">EBi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">EBr</span> <span class="o">+</span> <span class="n">EBi</span> <span class="o">+</span> <span class="n">ECr</span> <span class="o">+</span> <span class="n">ECi</span>

        <span class="n">Emin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">E</span> <span class="o">==</span> <span class="n">Emin</span><span class="p">)</span>
        <span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind3</span>
</div>
<div class="viewcode-block" id="VSHCoeff.ens3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.ens3.html#pylayers.antprop.antenna.VSHCoeff.ens3">[docs]</a>    <span class="k">def</span> <span class="nf">ens3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the sorted energies from minimal to maximal value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">EBr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">EBi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">EBr</span> <span class="o">+</span> <span class="n">EBi</span> <span class="o">+</span> <span class="n">ECr</span> <span class="o">+</span> <span class="n">ECi</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">argsort</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="n">Es</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Es</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="VSHCoeff.drag3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.drag3.html#pylayers.antprop.antenna.VSHCoeff.drag3">[docs]</a>    <span class="k">def</span> <span class="nf">drag3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Emin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Thresholded coefficient conversion</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Emin : Minimum energy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">EBr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">EBi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECr</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ECi</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">EBr</span> <span class="o">+</span> <span class="n">EBi</span> <span class="o">+</span> <span class="n">ECr</span> <span class="o">+</span> <span class="n">ECi</span>

        <span class="n">ind</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">E</span> <span class="o">==</span> <span class="n">Emin</span><span class="p">)</span>

        <span class="n">ind3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">delete3</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ind</span><span class="p">,</span> <span class="n">ind3</span>
</div>
<div class="viewcode-block" id="VSHCoeff.put3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.VSHCoeff.put3.html#pylayers.antprop.antenna.VSHCoeff.put3">[docs]</a>    <span class="k">def</span> <span class="nf">put3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">Antenna</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class Antenna</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    name   : Antenna name</span>

<span class="sd">    Nf     : number of frequency</span>
<span class="sd">    Nt     : number of theta</span>
<span class="sd">    Np     : number of phi</span>

<span class="sd">    Ftheta : Normalized Ftheta    (nf,ntheta,nphi)</span>
<span class="sd">    Fphi   : Normalized Fphi      (nf,ntheta,nphi)</span>
<span class="sd">    SqG    : Square root of gain  (nf,ntheta,nphi)</span>

<span class="sd">    Ttheta : theta                (nf,ntheta,nphi)</span>
<span class="sd">    Tphi   : phi                  (nf,ntheta,nphi)</span>

<span class="sd">    theta  : theta base            1 x ntheta</span>
<span class="sd">    phi    : phi base              1 x phi</span>

<span class="sd">    C      : VSH Coefficients</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    info()          : Display information about antenna</span>
<span class="sd">    vsh()           : calculates Vector Spherical Harmonics</span>
<span class="sd">    show3_geom()    : Geomview diagram</span>
<span class="sd">    show3()         : 3D diagram plotting using matplotlib toolkit</span>
<span class="sd">    Fsynth2         : Antenna F synthesis from coeff in s2</span>

<span class="sd">    Antenna trx file can be stored in various order</span>
<span class="sd">        natural : HFSS</span>
<span class="sd">        bcp     : near filed chamber</span>
<span class="sd">    It is important when initializing an antenna object to be aware of the typ of trx file</span>


<span class="sd">    .trx (ASCII Vectorial antenna Pattern)</span>

<span class="sd">    F   Phi   Theta  Fphi  Ftheta</span>
<span class="sd">    -----------------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">_filename</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;ant&quot;</span><span class="p">,</span> <span class="n">nf</span><span class="o">=</span><span class="mi">104</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">181</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ  : str</span>
<span class="sd">            type of file to read antenna {&#39;mat&#39;,&#39;vsh2&#39;,&#39;vsh3&#39;,&#39;trx&#39;,&#39;trx1&#39;}</span>
<span class="sd">        _filename : str</span>
<span class="sd">            antenna file name</span>
<span class="sd">        directory : str</span>
<span class="sd">            subdirectory of the current project where to find the antenna file</span>
<span class="sd">            the file is seek in the $PyProject/ant directory</span>
<span class="sd">        nf    :  int</span>
<span class="sd">            number of frequency (default 104)</span>
<span class="sd">        ntheta:   int</span>
<span class="sd">            number of theta (default 181)</span>
<span class="sd">        nph : int</span>
<span class="sd">            number of phi (default 90)</span>

<span class="sd">        Ant = Antenna(typ,_filename)</span>

<span class="sd">        if typ==&#39;vsh3&#39;:</span>
<span class="sd">            Ant.loadvsh3()</span>
<span class="sd">        if typ==&#39;vsh2&#39;:</span>
<span class="sd">            Ant.loadvsh2()</span>
<span class="sd">        if typ==&#39;trx&#39;:</span>
<span class="sd">            Ant.loadtrx()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;vsh3&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh3</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;vsh2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh2</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;trx&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_trx</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;trx1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadtrx</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;mat&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

<div class="viewcode-block" id="Antenna.loadmat"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadmat.html#pylayers.antprop.antenna.Antenna.loadmat">[docs]</a>    <span class="k">def</span> <span class="nf">loadmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;ant&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load an antenna stored in a mat file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str , optional</span>
<span class="sd">            default &#39;ant&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            Read an Antenna file in UWBAN directory and plot a polar plot</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>


<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;mat&#39;,&#39;S1R1.mat&#39;,&#39;ant/UWBAN/Matfile&#39;)</span>
<span class="sd">            &gt;&gt;&gt; pol = plt.polar(A.phi,abs(A.Ftheta[10,45,:]))</span>
<span class="sd">            &gt;&gt;&gt; txt = plt.title(&#39;test loadmat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filemat</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filemat</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filemat</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">struct_as_record</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">_filemat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.mat&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;mat&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Notes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PhotoFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">PhotoFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Serie</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Serie</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Run</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">DataFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">StartTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">AntennaName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">freq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">theta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">phi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Ftheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Fphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.load_trx"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.load_trx.html#pylayers.antprop.antenna.Antenna.load_trx">[docs]</a>    <span class="k">def</span> <span class="nf">load_trx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;ant&quot;</span><span class="p">,</span> <span class="n">nf</span><span class="o">=</span><span class="mi">104</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">181</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a trx file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str</span>
<span class="sd">            directory where to find the file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncol</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*$&quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*$&quot;&quot;&quot;</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#while ((re.search(pattern1,d[k]) is None ) &amp; (re.search(pattern2,d[k]) is None )):</span>
        <span class="k">while</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># TODO Parsing the header</span>
        <span class="c">#</span>
        <span class="c">#nf     = 104</span>
        <span class="c">#nphi   = 90</span>
        <span class="c">#ntheta = 181</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">nf</span> <span class="o">*</span> <span class="n">nphi</span> <span class="o">*</span> <span class="n">ntheta</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">PHI</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">THETA</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">THETA</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">PHI</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c">#self.phi     = Tphi[0,0,:]</span>

        <span class="c">#</span>
        <span class="c"># Temporaire</span>
        <span class="c">#</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="mi">104</span>
</div>
<div class="viewcode-block" id="Antenna.loadtrx"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadtrx.html#pylayers.antprop.antenna.Antenna.loadtrx">[docs]</a>    <span class="k">def</span> <span class="nf">loadtrx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        load trx file</span>

<span class="sd">        self._filename: short name of the antenna file</span>

<span class="sd">        the file is seek in the $PyProject/ant directory</span>

<span class="sd">        header format</span>
<span class="sd">        -------------</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="s">&#39;header_&#39;</span> <span class="o">+</span> <span class="n">_filetrx</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="n">_headtrx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;trx&#39;</span><span class="p">,</span> <span class="s">&#39;txt&#39;</span><span class="p">)</span>
        <span class="n">headtrx</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_headtrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Header</span>
        <span class="c">#</span>
        <span class="n">foh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">headtrx</span><span class="p">)</span>
        <span class="n">ligh</span> <span class="o">=</span> <span class="n">foh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">foh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">ntheta</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span>  <span class="c"># tau : delay (ns)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c">#</span>
        <span class="c"># Data</span>
        <span class="c">#</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fi</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">7</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;error : frequency cannot be zero&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mf">1.0e9</span>

        <span class="n">phi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># type : refers to the way the angular values are stored in the file</span>
        <span class="c"># Detection of file type</span>
        <span class="c">#</span>
        <span class="c"># Bcp</span>
        <span class="c">#    f  phi theta</span>
        <span class="c">#    2    1    0</span>
        <span class="c"># Natural</span>
        <span class="c">#    f  phi theta</span>
        <span class="c">#    2    0    1</span>

        <span class="n">dphi</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;bcp&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;natural&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
        <span class="c">#</span>
        <span class="c"># Normalization</span>
        <span class="c">#</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ftheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">))</span>
        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="c">#Fphi    = Fphi/SqG</span>
        <span class="c">#Ftheta  = Ftheta/SqG</span>
        <span class="c">#Fphi    = Fphi</span>
        <span class="c">#Ftheta  = Ftheta</span>
        <span class="c">#</span>
        <span class="c"># Reshaping</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;natural&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;bcp&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Force natural order (f,theta,phi)</span>
        <span class="c"># This is not the order of the satimo nfc which is  (f,phi,theta)</span>
        <span class="c">#</span>
        <span class="c">#  .. todo::  May be it is not necessary to load Ttheta and Tphi</span>
        <span class="c">#</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ttheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">nf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="n">ntheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">nphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="Antenna.checkpole"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.checkpole.html#pylayers.antprop.antenna.Antenna.checkpole">[docs]</a>    <span class="k">def</span> <span class="nf">checkpole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kf</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display the reconstructed field on pole for integrity verification</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kf : int</span>
<span class="sd">            frequency index default 0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ft0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Ex0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Ey0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Exp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Eyp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Antenna.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.info.html#pylayers.antprop.antenna.Antenna.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives info about antenna object</span>

<span class="sd">           &gt;&gt;&gt; A1 = Antenna(&#39;trx1&#39;,&#39;defant.trx&#39;)</span>
<span class="sd">           &gt;&gt;&gt; A2 = Antenna(&#39;vsh3&#39;,&#39;defant.vsh3&#39;)</span>
<span class="sd">           &gt;&gt;&gt; A3 = Antenna(&#39;mat&#39;,&#39;S1R1.mat&#39;,&#39;ant/UWBAN/Matfile&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="k">print</span> <span class="s">&quot;type : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;mat&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Date</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Serie</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Run</span>
            <span class="k">print</span> <span class="s">&quot;Nb theta (lat) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
            <span class="k">print</span> <span class="s">&quot;Nb phi (lon) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="k">print</span> <span class="s">&quot;--------------------------&quot;</span>
        <span class="k">print</span> <span class="s">&quot;fmin (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;fmax (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;Nf   :&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;No vsh coefficient calculated yet&quot;</span>
</div>
<div class="viewcode-block" id="Antenna.help"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.help.html#pylayers.antprop.antenna.Antenna.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        help on available functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Antenna Class : List of available function&quot;</span>
        <span class="k">print</span> <span class="s">&quot;------------------------------------------&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.init(filename)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.info()&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.demo()&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.help()&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.show3_geom(k=0,typ=&#39;Gain&#39;|&#39;Ftheta&#39;|Fphi&#39;,mode=&#39;linear&#39;|&#39;not implemented&#39;,silent=(True)|False)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.pol3d(k=0,R=1,St=1(Downsampling along theta),Sp=1(idem),silent=(False)[True)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.mse(Fth,Fph,N=0) &quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.elec_delay()&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.vsh() : Vector spherical harmonics transform&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.Fsynth2(theta,phi) : Calulate diagram from shape 2 coeff&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.Fsynth3(theta,phi) : Calulate diagram from shape 3 coeff&quot;</span>
        <span class="k">print</span> <span class="s">&quot;movie_vsh(mode=&#39;linear&#39;)&quot;</span>
</div>
<div class="viewcode-block" id="Antenna.polar"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.polar.html#pylayers.antprop.antenna.Antenna.polar">[docs]</a>    <span class="k">def</span> <span class="nf">polar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ip</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dyn</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">GmaxdB</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; polar plot</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            k : list of int</span>
<span class="sd">                frequency index  (default 0)</span>
<span class="sd">            it  : int</span>
<span class="sd">                theta index      (default 0)</span>
<span class="sd">            ip  : int</span>
<span class="sd">                phi index        (default -1)</span>
<span class="sd">            GmaxdB :</span>
<span class="sd">                Max Gain (dB)</span>
<span class="sd">            dyn    :</span>
<span class="sd">                dynamic number of 5dB step</span>
<span class="sd">            alpha  : float</span>
<span class="sd">                default 0.1</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            .. plot::</span>
<span class="sd">                :include-source:</span>

<span class="sd">                &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">                &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">                &gt;&gt;&gt; A = Antenna(&#39;trx1&#39;,&#39;defant.trx&#39;)</span>
<span class="sd">                &gt;&gt;&gt; A.polar(k=[0,10,50])</span>
<span class="sd">                &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#316931&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">DyndB</span> <span class="o">=</span> <span class="n">dyn</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="n">GmindB</span> <span class="o">=</span> <span class="n">GmaxdB</span> <span class="o">-</span> <span class="n">DyndB</span>
        <span class="c"># force square figure and square axes looks better for polar, IMO</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">polar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">axisbg</span><span class="o">=</span><span class="s">&#39;#d5de9c&#39;</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">DyndB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">GmaxdB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">rline1</span><span class="p">,</span> <span class="n">rtext1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rgrids</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
        <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
        <span class="n">rline2</span><span class="p">,</span> <span class="n">rtext2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">thetagrids</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>

        <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="n">k</span><span class="p">:</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&#39;f = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">ik</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; GHz&#39;</span>
            <span class="k">if</span> <span class="n">it</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
                <span class="n">iphi1</span> <span class="o">=</span> <span class="n">ip</span>
                <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
                <span class="k">if</span> <span class="n">mod</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">mod</span><span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="p">(</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

                <span class="n">u1</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                    <span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iphi1</span><span class="p">])</span>
                <span class="c">#r1  = self.SqG[k,u1[0],iphi1]</span>
                <span class="n">negr1</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="n">r1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r1</span><span class="p">[</span><span class="n">negr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">iphi2</span><span class="p">])</span>
                <span class="c">#r2  = self.SqG[k,u2,iphi2]</span>
                <span class="n">negr2</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="n">r2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">[</span><span class="n">negr2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">r3</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                    <span class="n">alpha</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iphi1</span><span class="p">])</span>
                <span class="c">#r3  = self.SqG[k,u3[0],iphi1]</span>
                <span class="n">negr3</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">(</span><span class="n">r3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r3</span><span class="p">[</span><span class="n">negr3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">r1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">it</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">iphi</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">itheta</span><span class="p">,</span> <span class="n">iphi</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">cpt</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">chaine</span><span class="p">)</span>
            <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Antenna.show3_geom"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.show3_geom.html#pylayers.antprop.antenna.Antenna.show3_geom">[docs]</a>    <span class="k">def</span> <span class="nf">show3_geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;Gain&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 geomview </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : frequency index</span>
<span class="sd">        typ   = &#39;Gain&#39; | &#39;Ftheta&#39; | &#39;Fphi&#39;</span>
<span class="sd">        mode   = &#39;linear&#39;| &#39;not implemented&#39;</span>
<span class="sd">        silent = True    | False</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
        <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gain&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Ftheta&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Fphi&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">minr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">po</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">geom_pattern</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">po</span><span class="p">,</span> <span class="n">minr</span><span class="p">,</span> <span class="n">maxr</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>

        <span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.off&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview -nopanel -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> \
                <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.show3.html#pylayers.antprop.antenna.Antenna.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;Gain&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show3(self,k=0,typ=&#39;Gain&#39;,col=True)</span>

<span class="sd">        k : frequency index</span>

<span class="sd">        typ = &#39;Gain&#39;</span>
<span class="sd">             = &#39;Ftheta&#39;</span>
<span class="sd">             = &#39;Fphi&#39;</span>

<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        else    -&gt; simple plot3D</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
        <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gain&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Ftheta&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Fphi&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>
        <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
        <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Antenna.pol3d"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.pol3d.html#pylayers.antprop.antenna.Antenna.pol3d">[docs]</a>    <span class="k">def</span> <span class="nf">pol3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">St</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Sp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Display polarisation diagram  in 3D</span>

<span class="sd">           pol3d(k=0,R=1,St=1,Sp=1,silent=False):</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           k  : int</span>
<span class="sd">               frequency index</span>
<span class="sd">           R  : float</span>
<span class="sd">                Radius of the sphere</span>
<span class="sd">           St : int</span>
<span class="sd">               Downsampling factor along theta</span>
<span class="sd">           Sp : int</span>
<span class="sd">               Downsampling factor along phi</span>
<span class="sd">           silent : Boolean</span>
<span class="sd">                (If True the file is created and not displayed&#39;)</span>

<span class="sd">           The file created is named : Polar{ifreq}.list</span>
<span class="sd">           it is placed in the /geom directory of the project</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="s">&#39;Polar&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10000</span> <span class="o">+</span> <span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">plth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">St</span><span class="p">)</span>
        <span class="n">plph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">Sp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">plph</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">plth</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c">#print &quot;m,theta= :&quot;,m,theta*180/np.pi</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                <span class="c">#print &quot;n,phi=:&quot;,n,phi*180/np.pi</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">vec_sph</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                    <span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">ellipse</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span>
                    <span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.mse"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.mse.html#pylayers.antprop.antenna.Antenna.mse">[docs]</a>    <span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mean square error</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Fth  : np.array</span>
<span class="sd">        Fph  : np.array</span>
<span class="sd">        N    : int</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate the relative mean square error between original pattern A.Ftheta , A.Fphi and the</span>
<span class="sd">        pattern given as argument of the function  Fth , Fph</span>

<span class="sd">        The mse is evaluated on both polarization and normalized over the energy of each</span>
<span class="sd">        original pattern.</span>
<span class="sd">        The function return the maximum between those two errors</span>

<span class="sd">        N is a parameter which allows to suppress value at the pole for the calculation of the error</span>
<span class="sd">        if N=0 all values are kept else   N &lt; n &lt; Nt - N</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">)</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c"># plage de theta (exclusion du pole)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Nt</span> <span class="o">-</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

        <span class="n">Gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphr</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fthr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fthr</span><span class="p">))</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fthr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fphr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">SqGr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Ftho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fpho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Etho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">))</span>
        <span class="n">Epho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>
        <span class="n">Eo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>

        <span class="n">errth</span> <span class="o">=</span> <span class="n">Ftho</span> <span class="o">-</span> <span class="n">Fthr</span>
        <span class="n">errph</span> <span class="o">=</span> <span class="n">Fpho</span> <span class="o">-</span> <span class="n">Fphr</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="n">Errth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)))</span>
        <span class="n">Errph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="c">#Errth_rel = Errth/Etho</span>
        <span class="c">#Errph_rel = Errph/Epho</span>
        <span class="n">Errth_rel</span> <span class="o">=</span> <span class="n">Errth</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Errph_rel</span> <span class="o">=</span> <span class="n">Errph</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Err_rel</span> <span class="o">=</span> <span class="n">Err</span> <span class="o">/</span> <span class="n">Eo</span>

        <span class="k">return</span> <span class="n">Err_rel</span><span class="p">,</span> <span class="n">Errth_rel</span><span class="p">,</span> <span class="n">Errph_rel</span>
</div>
<div class="viewcode-block" id="Antenna.elec_delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.elec_delay.html#pylayers.antprop.antenna.Antenna.elec_delay">[docs]</a>    <span class="k">def</span> <span class="nf">elec_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply an electrical delay</span>

<span class="sd">         Notes</span>
<span class="sd">         -----</span>
<span class="sd">         This function apply an electrical delay math::`\\exp{2 j \\pi f \\tau)`</span>
<span class="sd">         on the phase of diagram math::``F_{\\theta}`` and math::`F_{\\phi}`</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">*</span> <span class="n">tau</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ones</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">EFth</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">EFth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">EFph</span> <span class="o">=</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">EFph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Antenna.vshd"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.vshd.html#pylayers.antprop.antenna.Antenna.vshd">[docs]</a>    <span class="k">def</span> <span class="nf">vshd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dsf :  int</span>
<span class="sd">            down sampling factor  &#39;default 1&#39;</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        This function calculates the Vector Spherical Harmonics coefficients</span>
<span class="sd">        It makes use of the spherepack function vha</span>

<span class="sd">            m : phi    longitude</span>
<span class="sd">            n : theta  latitude</span>

<span class="sd">        Antenna pattern are stored       (f theta phi)</span>
<span class="sd">        Coeff are stored with this order (f , n , m )</span>

<span class="sd">        The vsh coefficient are organized differently</span>
<span class="sd">        should be better for compression along frequency axis</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="n">np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span>

        <span class="k">if</span> <span class="n">np</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mdab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mdab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">ndab</span> <span class="o">=</span> <span class="n">nt</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>

        <span class="n">gridComp</span> <span class="o">=</span> <span class="n">Wrapec</span><span class="p">()</span>
        <span class="n">wvha</span><span class="p">,</span> <span class="n">lvha</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vhai</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="c">#</span>
            <span class="c"># Real part</span>
            <span class="c">#</span>
            <span class="n">Fpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">][::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">Ftr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">][::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="c">#</span>
            <span class="c"># Fpr     Ntheta,Nphi</span>
            <span class="c">#</span>
            <span class="n">brr</span><span class="p">,</span> <span class="n">bir</span><span class="p">,</span> <span class="n">crr</span><span class="p">,</span> <span class="n">cir</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vha</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvha</span><span class="p">,</span>
                                              <span class="n">wvha</span><span class="p">,</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fpr</span><span class="p">),</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Ftr</span><span class="p">))</span>
            <span class="c">#</span>
            <span class="c"># Imaginary part</span>
            <span class="c">#</span>
            <span class="n">Fpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">][::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
            <span class="n">Fti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">][::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
            <span class="n">bri</span><span class="p">,</span> <span class="n">bii</span><span class="p">,</span> <span class="n">cri</span><span class="p">,</span> <span class="n">cii</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vha</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvha</span><span class="p">,</span>
                                              <span class="n">wvha</span><span class="p">,</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fpi</span><span class="p">),</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fti</span><span class="p">))</span>

            <span class="n">Br</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">brr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">bri</span>
            <span class="n">Bi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">bir</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">bii</span>
            <span class="n">Cr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">crr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">cri</span>
            <span class="n">Ci</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cir</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">cii</span>

        <span class="c">#</span>
        <span class="c"># m=0 row is multiplied by 0.5</span>
        <span class="c">#</span>

        <span class="n">Br</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Br</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Bi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Bi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Cr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Cr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Ci</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ci</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c">#print &quot;self.fa[0] = &quot;,self.fa[0]</span>
        <span class="c">#print &quot;self.fa[-1] = &quot;,self.fa[-1]</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Br</span><span class="p">)</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Bi</span><span class="p">)</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Cr</span><span class="p">)</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Ci</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.vsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.vsh.html#pylayers.antprop.antenna.Antenna.vsh">[docs]</a>    <span class="k">def</span> <span class="nf">vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates the Vector Spherical Harmonics coefficients</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        It makes use of the spherepack function vha</span>

<span class="sd">            m : phi    longitude</span>
<span class="sd">            n : theta  latitude</span>

<span class="sd">        Antenna pattern are stored       (f theta phi)</span>
<span class="sd">        Coeff are stored with this order (f , n , m )</span>

<span class="sd">        The vsh coefficient are organized differently</span>
<span class="sd">        should be better for compression along frequency axis</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
        <span class="n">np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span>

        <span class="k">if</span> <span class="n">np</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">mdab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mdab</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">ndab</span> <span class="o">=</span> <span class="n">nt</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ndab</span><span class="p">,</span> <span class="n">mdab</span><span class="p">))</span>

        <span class="n">gridComp</span> <span class="o">=</span> <span class="n">Wrapec</span><span class="p">()</span>
        <span class="n">wvha</span><span class="p">,</span> <span class="n">lvha</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vhai</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nf</span><span class="p">):</span>
            <span class="c">#</span>
            <span class="c"># Real part</span>
            <span class="c">#</span>
            <span class="n">Fpr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="n">Ftr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span>
            <span class="c">#</span>
            <span class="c"># Fpr     Ntheta,Nphi</span>
            <span class="c">#</span>
            <span class="n">brr</span><span class="p">,</span> <span class="n">bir</span><span class="p">,</span> <span class="n">crr</span><span class="p">,</span> <span class="n">cir</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vha</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvha</span><span class="p">,</span>
                                              <span class="n">wvha</span><span class="p">,</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fpr</span><span class="p">),</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Ftr</span><span class="p">))</span>
            <span class="c">#</span>
            <span class="c"># Imaginary part</span>
            <span class="c">#</span>
            <span class="n">Fpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
            <span class="n">Fti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span>
            <span class="n">bri</span><span class="p">,</span> <span class="n">bii</span><span class="p">,</span> <span class="n">cri</span><span class="p">,</span> <span class="n">cii</span> <span class="o">=</span> <span class="n">gridComp</span><span class="o">.</span><span class="n">vha</span><span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lvha</span><span class="p">,</span>
                                              <span class="n">wvha</span><span class="p">,</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fpi</span><span class="p">),</span> <span class="n">transpose</span><span class="p">(</span><span class="n">Fti</span><span class="p">))</span>

            <span class="n">Br</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">brr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">bri</span>
            <span class="n">Bi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">bir</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">bii</span>
            <span class="n">Cr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">crr</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">cri</span>
            <span class="n">Ci</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cir</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">cii</span>

        <span class="c">#</span>
        <span class="c"># m=0 row is multiplied by 0.5</span>
        <span class="c">#</span>

        <span class="n">Br</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Br</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Bi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Bi</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Cr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Cr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">Ci</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ci</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c">#print &quot;self.fa[0] = &quot;,self.fa[0]</span>
        <span class="c">#print &quot;self.fa[-1] = &quot;,self.fa[-1]</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Br</span><span class="p">)</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Bi</span><span class="p">)</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Cr</span><span class="p">)</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Ci</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.demo"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.demo.html#pylayers.antprop.antenna.Antenna.demo">[docs]</a>    <span class="k">def</span> <span class="nf">demo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display few commands for executing little demo</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;A.C.s1tos2(30)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Fth , Fph = A.Fsynth2(th,ph)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;FTh = Fth.reshape(A.Nf,A.Nt,A.Np)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;FPh = Fph.reshape(A.Nf,A.Nt,A.Np)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;compdiag(20,A,A.theta,A.phi,FTh,FPh) &quot;</span>
</div>
<div class="viewcode-block" id="Antenna.Fsynth"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth.html#pylayers.antprop.antenna.Antenna.Fsynth">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate complex antenna pattern  from VSH Coefficients (shape 2)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        theta  : ndarray (1xNdir)</span>
<span class="sd">        phi    : ndarray (1xNdir)</span>
<span class="sd">        k      : int</span>
<span class="sd">            frequency index</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N1</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M1</span>
        <span class="c">#print &quot;N,M&quot;,N,M</span>
        <span class="c">#</span>
        <span class="c"># The - sign is necessary to get the good reconstruction</span>
        <span class="c">#     deduced from observation</span>
        <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>
</div>
<div class="viewcode-block" id="Antenna.Fsynth2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth2.html#pylayers.antprop.antenna.Antenna.Fsynth2">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            theta</span>
<span class="sd">            phi</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        Calculate complex antenna pattern  from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified direction theta,phi</span>
<span class="sd">        theta and phi need to be same size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span>
        <span class="c">#print &quot;N,M&quot;,N,M</span>
        <span class="c">#</span>
        <span class="c"># The - sign is necessary to get the good reconstruction</span>
        <span class="c">#     deduced from observation</span>
        <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>
</div>
<div class="viewcode-block" id="Antenna.Fsynth3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth3.html#pylayers.antprop.antenna.Antenna.Fsynth3">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; synthesis of a complex antenna pattern from VSH Coefficients (shape 3)</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : ndarray (1xNdir)</span>
<span class="sd">        phi   : ndarray (1xNdir)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Fth   : ndarray (1xNdir)</span>
<span class="sd">        Fph   : ndarray (1xNdir)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;vsh3&#39;,&#39;defant.vsh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; theta   = np.linspace(0,np.pi,70)</span>
<span class="sd">            &gt;&gt;&gt; phi     = np.linspace(0,2*np.pi,180)</span>
<span class="sd">            &gt;&gt;&gt; th      = np.kron(theta,np.ones(len(phi)))</span>
<span class="sd">            &gt;&gt;&gt; ph      = np.kron(np.ones(len(theta)),phi)</span>
<span class="sd">            &gt;&gt;&gt; Fth,Fph = A.Fsynth3(th,ph)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">nBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">mBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">mBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">nBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">nBr</span><span class="p">,</span> <span class="n">mBr</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>
</div>
<div class="viewcode-block" id="Antenna.movie_vsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.movie_vsh.html#pylayers.antprop.antenna.Antenna.movie_vsh">[docs]</a>    <span class="k">def</span> <span class="nf">movie_vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            movie_vsh</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Brmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Brmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Bimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Bimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">Crmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Crmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Cimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Cimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">print</span> <span class="n">Brmin</span><span class="p">,</span> <span class="n">Brmax</span><span class="p">,</span> <span class="n">Bimin</span><span class="p">,</span> <span class="n">Bimax</span><span class="p">,</span> <span class="n">Crmin</span><span class="p">,</span> <span class="n">Crmax</span><span class="p">,</span> <span class="n">Cimin</span><span class="p">,</span> <span class="n">Cimax</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">stf</span> <span class="o">=</span> <span class="s">&#39; f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; GHz&#39;</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Brmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Brmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="c">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Br_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Bimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Bimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="c">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Bi_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Crmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Crmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Cr_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Cimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Cimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Ci_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%03d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span>
            <span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">clf</span><span class="p">()</span>

        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;mencoder&#39;</span><span class="p">,</span>
                   <span class="s">&#39;mf://*.png&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-mf&#39;</span><span class="p">,</span>
                   <span class="s">&#39;type=png:w=800:h=600:fps=1&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-ovc&#39;</span><span class="p">,</span>
                   <span class="s">&#39;lavc&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-lavcopts&#39;</span><span class="p">,</span>
                   <span class="s">&#39;vcodec=mpeg4&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-oac&#39;</span><span class="p">,</span>
                   <span class="s">&#39;copy&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-o&#39;</span><span class="p">,</span>
                   <span class="s">&#39;vshcoeff.avi&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.minsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.minsh3.html#pylayers.antprop.antenna.Antenna.minsh3">[docs]</a>    <span class="k">def</span> <span class="nf">minsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates vsh3 with significant coeff until given relative reconstruction error</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        emax : float</span>
<span class="sd">            error default 0.05</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        Create antenna&#39;s vsh3 file which only contains</span>
<span class="sd">        the significant vsh coefficients in shape 3,</span>
<span class="sd">        in order to obtain a reconstruction maximal error =  emax</span>

<span class="sd">        This function requires a trx file reading before being executed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">Enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">ens3</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Enc</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">emax</span><span class="p">):</span>

            <span class="n">Emin</span> <span class="o">=</span> <span class="n">Enc</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">drag3</span><span class="p">(</span><span class="n">Emin</span><span class="p">)</span>
            <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
            <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">emax</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">i3</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
                <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">)</span>
                <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Antenna.savevsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savevsh3.html#pylayers.antprop.antenna.Antenna.savevsh3">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A.savevsh3()</span>

<span class="sd">        Create a .vsh3 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># create vsh3 file</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.trx&#39;</span><span class="p">,</span> <span class="s">&#39;.vsh3&#39;</span><span class="p">)</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="c">#filevsh3 = pyu.getlong(self._filename,&#39;ant&#39;)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.loadvsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadvsh3.html#pylayers.antprop.antenna.Antenna.loadvsh3">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna&#39;s vsh3 file </span>
<span class="sd">        </span>
<span class="sd">            it contains a thesholded version of vsh coefficients in shape 3</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">filevsh3</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh3</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
<div class="viewcode-block" id="Antenna.savevsh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savevsh2.html#pylayers.antprop.antenna.Antenna.savevsh2">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Create a .vsh2 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># create vsh2 file</span>

        <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.trx&#39;</span><span class="p">,</span> <span class="s">&#39;.vsh2&#39;</span><span class="p">)</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filevsh2</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh2</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.loadvsh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadvsh2.html#pylayers.antprop.antenna.Antenna.loadvsh2">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            A.loadvsh2()</span>

<span class="sd">        Load antenna&#39;s vsh2 file which only contains</span>
<span class="sd">        the vsh coefficients in shape 2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh2</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
<div class="viewcode-block" id="Antenna.loadvsh3_old"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadvsh3_old.html#pylayers.antprop.antenna.Antenna.loadvsh3_old">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh3_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            A.loadvsh3()</span>

<span class="sd">        Load antenna&#39;s vsh3 file which only contains</span>
<span class="sd">        the significant vsh coefficients in shape 3</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="mf">8.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">SHCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh3</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
<div class="viewcode-block" id="Antenna.pol2cart"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.pol2cart.html#pylayers.antprop.antenna.Antenna.pol2cart">[docs]</a>    <span class="k">def</span> <span class="nf">pol2cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conversion FTheta, FPhi to Fx,Fy,Fz for theta=ith</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ith : theta index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fx</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fy</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.cart2pol"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.cart2pol.html#pylayers.antprop.antenna.Antenna.cart2pol">[docs]</a>    <span class="k">def</span> <span class="nf">cart2pol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Conversion Fx,Fy,Fz vers Ftheta, Fphi for theta=ith</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Fx</span>
<span class="sd">        Fy</span>
<span class="sd">        Fz</span>
<span class="sd">        ith : theta index</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
            <span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">Fx</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fth</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">SqG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fph</span>

</div>
<span class="k">def</span> <span class="nf">forcesympol</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculate A.Ftheta and A.Fphi in order to obtain A.SqG continuous at poles</span>
<span class="sd">        (theta=0,pi) for each frequency values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        A : Antenna object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">Fx0</span><span class="p">,</span> <span class="n">Fy0</span><span class="p">,</span> <span class="n">Fz0</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">pol2cart</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">(</span><span class="n">Fxp</span><span class="p">,</span> <span class="n">Fyp</span><span class="p">,</span> <span class="n">Fzp</span><span class="p">)</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">pol2cart</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">Nf</span><span class="p">):</span>
        <span class="n">aux0</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fx0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">auxp</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fxp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">Fx0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">aux0</span>
        <span class="n">Fxp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">auxp</span>

        <span class="n">aux0</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fy0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">auxp</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fyp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">Fy0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">aux0</span>
        <span class="n">Fyp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">auxp</span>

        <span class="n">aux0</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fz0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">auxp</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Fzp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">Fz0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">aux0</span>
        <span class="n">Fzp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">auxp</span>

    <span class="n">A</span><span class="o">.</span><span class="n">cart2pol</span><span class="p">(</span><span class="n">Fx0</span><span class="p">,</span> <span class="n">Fy0</span><span class="p">,</span> <span class="n">Fz0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">A</span><span class="o">.</span><span class="n">cart2pol</span><span class="p">(</span><span class="n">Fxp</span><span class="p">,</span> <span class="n">Fyp</span><span class="p">,</span> <span class="n">Fzp</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">AFLegendre</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate Pmm1n and Pmp1n</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        N : int</span>
<span class="sd">            max order  (theta)   (also called l or level )</span>
<span class="sd">        M : int</span>
<span class="sd">            max degree (phi)</span>
<span class="sd">        x : np.array</span>
<span class="sd">            function argument</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pmm1n :  :math:`\\bar{P}_{n}^{(m-1)}(x)`</span>
<span class="sd">    Pmp1n :  :math:`\\bar{P}_{n}^{(m+1)}(x)`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This function returns :</span>
<span class="sd">        .. math::</span>

<span class="sd">            \\bar{P}_{n}^{(m-1)}(x)</span>

<span class="sd">            \\bar{P}_{n}^{(m+1)}(x)</span>

<span class="sd">     Where</span>

<span class="sd">        .. math::</span>

<span class="sd">            P_n^{(m)}(x)= \\sqrt{ \\frac{2}{2 n+1} \\frac{(n+m)!}{(n-m)!} } \\bar{P}_{n}^{(m)}(x)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>


<span class="sd">    &gt;&gt;&gt; Pmm1n,Pmp1n = AFLegendre(5,5,np.array([0,1]))</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    VW</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PMN</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">MM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">MM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">NN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c">#</span>
    <span class="c"># Warning : this is a dangerous factorial ratio</span>
    <span class="c"># surprinsingly it works well</span>
    <span class="c">#</span>
    <span class="n">C1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">NN</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">NN</span> <span class="o">-</span> <span class="n">MM</span><span class="p">)</span> <span class="o">/</span> <span class="n">factorial</span><span class="p">(</span><span class="n">NN</span> <span class="o">+</span> <span class="n">MM</span><span class="p">))</span>
    <span class="k">del</span> <span class="n">MM</span>
    <span class="k">del</span> <span class="n">NN</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">pmn</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">lpmn</span><span class="p">(</span><span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pmn</span> <span class="o">=</span> <span class="n">special</span><span class="o">.</span><span class="n">lpmn</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pmn</span> <span class="o">=</span> <span class="n">pmn</span> <span class="o">*</span> <span class="n">C1</span>
        <span class="n">PMN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pmn</span><span class="p">)</span>

    <span class="n">Pmn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PMN</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">Pmn</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Pmn</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">Pmm1n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">M</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Pmn</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Pmn</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Pmn</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span>


<span class="k">def</span> <span class="nf">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate vector Spherical Harmonics basis functions</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n    : int</span>
<span class="sd">        level</span>
<span class="sd">    m    : int</span>
<span class="sd">        mode</span>
<span class="sd">    x    :  np.array</span>
<span class="sd">        function argument</span>
<span class="sd">    phi   : np.array</span>
<span class="sd">    Pmm1n : Legendre Polynomial</span>
<span class="sd">    Pmp1n : Legendre Polynomial</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    AFLegendre</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">Y1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">Y2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

    <span class="n">Mphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">Ephi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">Mphi</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">Mphi</span>
    <span class="n">Y1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
    <span class="n">Y2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">del</span> <span class="n">t1</span>
    <span class="k">del</span> <span class="n">t2</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">Y1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span> <span class="o">*</span> <span class="n">Ephi</span>
    <span class="n">W</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">W</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">del</span> <span class="n">Y1</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Y2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span> <span class="o">*</span> <span class="n">Ephi</span>
    <span class="n">V</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">V</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">del</span> <span class="n">Y2</span>
    <span class="k">return</span> <span class="n">V</span><span class="p">,</span> <span class="n">W</span>


<span class="k">def</span> <span class="nf">plotVW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">sf</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot VSH transform basis in 3D</span>
<span class="sd">        (V in fig1 and W in fig2)</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n,m   : integer values (m&lt;=n)</span>
<span class="sd">    theta : ndarray</span>
<span class="sd">    phi   : ndarray</span>
<span class="sd">    sf    : boolean</span>
<span class="sd">        if sf : plotted figures are saved in a *.png file</span>
<span class="sd">        else  : plotted figures aren&#39;t saved</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; import  matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; n=5</span>
<span class="sd">        &gt;&gt;&gt; m=3</span>
<span class="sd">        &gt;&gt;&gt; theta = np.linspace(0,np.pi,30)</span>
<span class="sd">        &gt;&gt;&gt; phi   = np.linspace(0,2*np.pi,60)</span>
<span class="sd">        &gt;&gt;&gt; plotVW(n,m,theta,phi)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># calculate v and w</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">theta</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> \
            <span class="mf">1e-10</span>  <span class="c"># .. todo :: not clean</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

        <span class="n">Ephi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">cphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>

        <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ephi</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">ve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span>
        <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">EPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">Ephi</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">Y1</span> <span class="o">*</span> <span class="n">EPh</span>
        <span class="c">#V[np.isinf(V)|isnan(V)]=0</span>
        <span class="n">Vcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">V</span>
        <span class="n">Vsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">V</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">#W=np.zeros((len(theta),len(phi)))</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Waux</span> <span class="o">=</span> <span class="n">Y2</span> <span class="o">*</span> <span class="n">EPh</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span> <span class="o">*</span> <span class="n">Waux</span>
        <span class="n">Wcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">W</span>
        <span class="n">Wsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">W</span>

        <span class="c"># plot V and W</span>
        <span class="n">Ntheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntheta</span><span class="p">)</span>
        <span class="n">Nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nphi</span><span class="p">)</span>
        <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

        <span class="c">#figdirV=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_V_Vsin_Vcos/&#39;</span>
        <span class="n">figdirV</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span>
        <span class="n">ext1</span> <span class="o">=</span> <span class="s">&#39;.pdf&#39;</span>
        <span class="n">ext2</span> <span class="o">=</span> <span class="s">&#39;.eps&#39;</span>
        <span class="n">ext3</span> <span class="o">=</span> <span class="s">&#39;.png&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;V&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;Vcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;Vsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="c">#figdirW=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_W_Wsin_Wcos/&#39;</span>
        <span class="n">figdirW</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;W&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;Wcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;Wsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Error: m&gt;n!!!&quot;</span>


<span class="k">def</span> <span class="nf">compdiag</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">Fthr</span><span class="p">,</span> <span class="n">Fphr</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;modulus&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">&#39;english&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Comparison between Antenna diagram and reconstructed diagram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : frequency index</span>
<span class="sd">    A : Antenna</span>

<span class="sd">    ph : phi base      (1 x Np)</span>
<span class="sd">    th : theta base    (1 x Nt)</span>

<span class="sd">    Fthr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>
<span class="sd">    Fphr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>

<span class="sd">    lang = &#39;french&#39;</span>
<span class="sd">         = &#39;english&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Nf</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">Fthr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c">#Fthr = Fthr.reshape(Nf,len(th),len(ph))</span>
    <span class="c">#Fphr = Fphr.reshape(Nf,len(th),len(ph))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">Ftho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Ftheta</span>
    <span class="n">Fpho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Fphi</span>

    <span class="c"># limites module Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTr</span><span class="p">,</span> <span class="n">maxTo</span><span class="p">)</span>

    <span class="n">minTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTr</span><span class="p">,</span> <span class="n">minTo</span><span class="p">)</span>

    <span class="n">maxPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPr</span><span class="p">,</span> <span class="n">maxPo</span><span class="p">)</span>

    <span class="n">minPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPr</span><span class="p">,</span> <span class="n">minPo</span><span class="p">)</span>

    <span class="c"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTrr</span><span class="p">,</span> <span class="n">maxTor</span><span class="p">)</span>

    <span class="n">minTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTrr</span><span class="p">,</span> <span class="n">minTor</span><span class="p">)</span>

    <span class="n">maxPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPrr</span><span class="p">,</span> <span class="n">maxPor</span><span class="p">)</span>

    <span class="n">minPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPrr</span><span class="p">,</span> <span class="n">minPor</span><span class="p">)</span>

    <span class="c"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTri</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxToi</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTri</span><span class="p">,</span> <span class="n">maxToi</span><span class="p">)</span>

    <span class="n">minTri</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minToi</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTri</span><span class="p">,</span> <span class="n">minToi</span><span class="p">)</span>

    <span class="n">maxPri</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPoi</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPri</span><span class="p">,</span> <span class="n">maxPoi</span><span class="p">)</span>

    <span class="n">minPri</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPoi</span> <span class="o">=</span> <span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPri</span><span class="p">,</span> <span class="n">minPoi</span><span class="p">)</span>

    <span class="c"># limithes arg Fth,Fph</span>
    <span class="n">maxATr</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxATo</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxATr</span><span class="p">,</span> <span class="n">maxATo</span><span class="p">)</span>
    <span class="n">minATr</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minATo</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maT0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minATr</span><span class="p">,</span> <span class="n">minATo</span><span class="p">)</span>

    <span class="n">maxAPr</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxAPo</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxAPr</span><span class="p">,</span> <span class="n">maxAPo</span><span class="p">)</span>
    <span class="n">minAPr</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minAPo</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maP0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minAPr</span><span class="p">,</span> <span class="n">minAPo</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">rtd</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
    <span class="c">#</span>
    <span class="c">#cmap=cm.jet</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),vmin=0,vmax=mmT)</span>
            <span class="c">#</span>
    <span class="c">#cmap= gray</span>
    <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
            <span class="c">#</span>
    <span class="c">#cmap=cm.hot</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,real(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,imag(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,angle(Ftho[k,:,:]),cmap=cm.gray_r,vmin=maT0,vmax=maT)</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Arg ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Ang ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Arg ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Ang ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Arg ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Ang ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Arg ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;Ang ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">show3D</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; show 3D matplotlib diagram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    F      : ndarray (Nf,Nt,Np)</span>
<span class="sd">    theta  : ndarray (1xNt)</span>
<span class="sd">        angle</span>
<span class="sd">    phi    : ndarray (1xNp)</span>
<span class="sd">        angle</span>
<span class="sd">    theta  : ndarray (Nt)</span>
<span class="sd">    k      : int</span>
<span class="sd">        frequency index</span>
<span class="sd">    col    : boolean</span>
<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        if col == False -&gt; simple plot3D</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; ifreq = 0</span>
<span class="sd">        &gt;&gt;&gt; A     = Antenna(&#39;vsh3&#39;,&#39;defant.vsh3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A.Nt  = 30</span>
<span class="sd">        &gt;&gt;&gt; A.Np  = 60</span>
<span class="sd">        &gt;&gt;&gt; A.Nf  = len(A.fa)</span>
<span class="sd">        &gt;&gt;&gt; theta = np.linspace(0,np.pi,A.Nt)</span>
<span class="sd">        &gt;&gt;&gt; phi   = np.linspace(0,2*np.pi,A.Np)</span>
<span class="sd">        &gt;&gt;&gt; th    = np.kron(theta,np.ones(A.Np))</span>
<span class="sd">        &gt;&gt;&gt; ph    = np.kron(np.ones(A.Nt),phi)</span>
<span class="sd">        &gt;&gt;&gt; Fth3,Fph3 = A.Fsynth3(th,ph)</span>
<span class="sd">        &gt;&gt;&gt; FTh3 = Fth3.reshape(A.Nf,A.Nt,A.Np)</span>
<span class="sd">        &gt;&gt;&gt; FPh3 = Fph3.reshape(A.Nf,A.Nt,A.Np)</span>
<span class="sd">        &gt;&gt;&gt; show3D(FTh3,theta,phi,ifreq)</span>
<span class="sd">        &gt;&gt;&gt; txt = plt(&#39;show3D example&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>


<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">            len(theta) must be equal with shape(F)[1]</span>
<span class="sd">            len(phi) must be equal with shape(F)[2]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: frequency index k not in F defined interval&#39;</span>
    <span class="k">if</span> <span class="n">nth</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: shape mistmatch between theta and F&#39;</span>

    <span class="k">if</span> <span class="n">nph</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: shape mistmatch between phi and F&#39;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nth</span><span class="p">)</span>
    <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nph</span><span class="p">)</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
    <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>


<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../antprop.html" >pylayers.antprop</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Bernard Uguen,Mohamedh Laaraiedh,Nicolas Amiot.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>