

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.gis.layout &mdash; PyLayers v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="pylayers.gis" href="../gis.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" border="0" alt="py4sci"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../gis.html" accesskey="U">pylayers.gis</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.gis.layout</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Class Layout</span>
<span class="c"># Class SelectL</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="kn">as</span> <span class="nn">rd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">from</span>   <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">clr</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">sh</span>
<span class="kn">from</span>   <span class="nn">shapely.ops</span> <span class="kn">import</span> <span class="n">cascaded_union</span>
<span class="kn">from</span>   <span class="nn">descartes.patch</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>
<span class="kn">import</span> <span class="nn">Image</span>

<span class="kn">from</span> <span class="nn">pylayers.antprop</span> <span class="kn">import</span> <span class="n">slab</span> <span class="k">as</span> <span class="n">sb</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">geomutil</span> <span class="k">as</span> <span class="n">geu</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">pyutil</span> <span class="k">as</span> <span class="n">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">graphutil</span> <span class="k">as</span> <span class="n">gru</span>
<span class="c"># Handle furnitures</span>
<span class="kn">import</span> <span class="nn">pylayers.gis.furniture</span> <span class="kn">as</span> <span class="nn">fur</span>
<span class="kn">from</span> <span class="nn">pylayers.gis</span> <span class="kn">import</span> <span class="n">cycles</span> <span class="k">as</span> <span class="n">Cycls</span>
<span class="kn">import</span> <span class="nn">pylayers.gis.selectl</span>
<span class="kn">from</span> <span class="nn">pylayers.util.easygui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c">#from   PyUtil  import *</span>
<span class="c">#from   interval import interval</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="c">#</span>
<span class="c">#</span>


<div class="viewcode-block" id="Layout"><a class="viewcode-back" href="../../../modules/gis.html#pylayers.gis.layout.Layout">[docs]</a><span class="k">class</span> <span class="nc">Layout</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handling of Layout</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    Gs     : Structure graph</span>
<span class="sd">    Gt     : Topological graph  (indicates topological relationships between rooms)</span>
<span class="sd">    Gr     : Graph of room</span>
<span class="sd">    Gv     : Graph of visibility</span>
<span class="sd">    Gc     : Connection graph (indicates visbility relationships)</span>
<span class="sd">    Nnode  : Number of nodes of Gs</span>
<span class="sd">    Nedge  : Number of edges of Gs</span>
<span class="sd">    pt     : points sequence</span>
<span class="sd">    tahe   : tail head</span>

<span class="sd">    Notes</span>
<span class="sd">    ------</span>
<span class="sd">     This class exploits `networkx` to store Layout information</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">        dir_ray_sign(self,Tx_x,Tx_y,Rx_x,Rx_y)</span>
<span class="sd">            to be explained</span>
<span class="sd">        v_color(self,ob)</span>
<span class="sd">            to be explained</span>
<span class="sd">        help(self)</span>
<span class="sd">            give information about the Layout</span>
<span class="sd">        ss-dico = L.subseg(self)</span>
<span class="sd">            extract the dictionnary of subseg</span>
<span class="sd">            interact(self)  : edit the layout interctively</span>
<span class="sd">        add_pnod(self,p,e1,e2)</span>
<span class="sd">            tbd</span>
<span class="sd">        add_fnod(self,p=(0.0,0.0))</span>
<span class="sd">            add free node p</span>
<span class="sd">        add_nfpe(self,np0,e1,e2)</span>
<span class="sd">            tbd</span>
<span class="sd">        add_none(self,ns,alpha=0.5)</span>
<span class="sd">           add node on edge</span>
<span class="sd">        add_edge(self,n1,n2,name=&#39;PARTITION&#39;,zmin=0,zmax=3.0)</span>
<span class="sd">            add edge between n1 and n2</span>
<span class="sd">        del_node(self,n1)</span>
<span class="sd">            delete node n1</span>
<span class="sd">        del_edge(self,e1)</span>
<span class="sd">            add edge between n1 and n2</span>
<span class="sd">        displaygui(self)</span>
<span class="sd">        info_edge(self,e1)</span>
<span class="sd">        edit_edge(self,e1)</span>
<span class="sd">        have_subseg(self,e1)</span>
<span class="sd">        del_subseg(self,e1)</span>
<span class="sd">        add_subseg(self,e1)</span>
<span class="sd">        add_window(self,e1)</span>
<span class="sd">        add_door(self,e1)</span>
<span class="sd">        check(self)</span>
<span class="sd">        ispoint(self,pt,tol=0.45)</span>
<span class="sd">        onseg(self,pt,tol=0.01)</span>
<span class="sd">        checkvis(self,p,edgelist,nodelist)</span>
<span class="sd">        visilist(self,p)</span>
<span class="sd">        visi_papb(self,pa,pb,edgelist=np.array([]))</span>
<span class="sd">        boundary(self)</span>

<span class="sd">        clip(self,xmin,xmax,ymin,ymax)</span>
<span class="sd">        find_edgelist(self,edgelist,nodelist)</span>
<span class="sd">        diag(self,p1,p2,l,al1,al2,quadsel=0)</span>
<span class="sd">        nd2ed(self,ndlist)</span>
<span class="sd">        ed2nd(self,edlist)</span>
<span class="sd">        nl,el = L.zone(self,xmin=0,xmax=10,ymin=0,ymax=10)</span>
<span class="sd">        closest_edge(self,p,AAS)</span>
<span class="sd">        walls = L.thwall(self,offx,offy)</span>
<span class="sd">            extract walls as polygon --&gt; Simpy World</span>
<span class="sd">        save(self,filename)</span>
<span class="sd">        load(self,filename)</span>
<span class="sd">        geomfile(self,filename=&#39;Lstruc.off&#39;)</span>
<span class="sd">        savestr2(self)</span>
<span class="sd">            export Layout as an  .str2 file</span>

<span class="sd">        show_nodes(self,ndlist=[1e8],size=10,color=&#39;b&#39;,</span>
<span class="sd">            dlabels=False,font_size=15,alpha=1)</span>
<span class="sd">        show_edge(self,edlist=[],alpha=1,width=1,size=2,</span>
<span class="sd">            color=&#39;black&#39;,font_size=15,dlabels=False)</span>
<span class="sd">        show_edges(self,edlist=[],alpha=1,width=1,color=&#39;black&#39;,</span>
<span class="sd">            dnodes=False,dlabels=False,font_size=15)</span>
<span class="sd">        show_layer(self,name,edlist=[],alpha=1,width=1,color=&#39;black&#39;,</span>
<span class="sd">            dnodes=False,dthin=False,dlabels=False,font_size=15)</span>
<span class="sd">        showGs(self,ndlist=[],edlist=[])</span>
<span class="sd">        show3(self,bdis=True)</span>
<span class="sd">        buildGc(self)</span>
<span class="sd">        buildGt(self)</span>
<span class="sd">        buildGr(self)</span>
<span class="sd">        buildGi(self)</span>
<span class="sd">        waypoint(self,nroom1,nroom2)</span>
<span class="sd">        info(self)</span>
<span class="sd">        facets3D(self,edlist,name=&#39;Layer&#39;,subseg=False)</span>
<span class="sd">        facet3D(self,e,subseg=False)</span>
<span class="sd">        signature(self,pTx,pRx,NroomTx,NroomRx)</span>
<span class="sd">        distwall(self,p,nroom)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_filemat</span><span class="o">=</span><span class="s">&#39;def.mat&#39;</span><span class="p">,</span><span class="n">_fileslab</span><span class="o">=</span><span class="s">&#39;def.slab&#39;</span><span class="p">):</span>

        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="c">#self.Gt=nx.Graph()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;Lstruc.str2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileslab</span> <span class="o">=</span> <span class="n">_fileslab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filemat</span> <span class="o">=</span> <span class="n">_filemat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ticksoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlblsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlblsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;clear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c">#self.display[&#39;fileoverlay&#39;]=&quot;/home/buguen/Pyproject/data/image/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;TA-Office.png&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;box&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">11.4</span><span class="p">,</span> <span class="mf">19.525</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.58</span><span class="p">,</span> <span class="mf">23.41</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subLayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;str&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in dirstruc</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        typ : string optional</span>
<span class="sd">            {&#39;str&#39;|}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of strdir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        strdir is defined in the Project module</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Display all available structures</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; for _filename in L.dir():</span>
<span class="sd">            &gt;&gt;&gt;    L.load(_filename)</span>
<span class="sd">            &gt;&gt;&gt;    L.showGs()</span>
<span class="sd">            &gt;&gt;&gt;    plt.title(_filename)</span>
<span class="sd">            &gt;&gt;&gt;    plt.figure()</span>
<span class="sd">            &gt;&gt;&gt;    plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">strdir</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lfile_s</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete Layout graphs</span>

<span class="sd">        release  Gs,Gc,Gm</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Layout consistency</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        GeomUtil.isBetween</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For all edges</span>
<span class="sd">            get the 2 vertices</span>
<span class="sd">                for all the other vertices</span>
<span class="sd">                    check if it belongs to segment</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">consistent</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n1</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n2</span> <span class="o">!=</span> <span class="n">n</span><span class="p">):</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">geu</span><span class="o">.</span><span class="n">isBetween</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
                            <span class="k">print</span> <span class="s">&quot;Warning segment &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="s">&quot;contains point &quot;</span><span class="p">,</span> <span class="n">n</span>
                            <span class="k">return</span><span class="p">(</span><span class="n">consistent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the list of edges which cross or belong to the clipping zone</span>

<span class="sd">         .. todo this is wrong</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">            xmin</span>
<span class="sd">            xmax</span>
<span class="sd">            ymin</span>
<span class="sd">            ymax</span>

<span class="sd">         Algorithm :</span>
<span class="sd">              1) Determine all segments outside the clipping zone for condition to test</span>
<span class="sd">              2) Union of the 4 conditions</span>
<span class="sd">              3) setdiff1d between the whole array of segments and the segments outside</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]]</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">nxp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">maxx</span> <span class="o">&lt;</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nxm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">minx</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nyp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">maxy</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">miny</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">nxp</span><span class="p">,</span> <span class="n">nxm</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">nyp</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">nym</span><span class="p">)</span>

        <span class="n">iseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ne</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">iseg</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>

<span class="c">#    def dir_ray_sign(self,Tx_x,Tx_y,Rx_x,Rx_y):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#            L.dir_ray_sign(Tx_x,Tx_y,Rx_x,Rx_y): takes transmitter and receiver coordinates</span>
<span class="c">#            and returns the shortest ray and his signature</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        xmin=min(Tx_x,Rx_x)</span>
<span class="c">#        xmax=max(Tx_x,Rx_x)</span>
<span class="c">#        ymin=min(Tx_y,Rx_y)</span>
<span class="c">#        ymax=max(Tx_y,Rx_y)</span>
<span class="c">#</span>
<span class="c">#        seg=self.clip(xmin,xmax,ymin,ymax)</span>
<span class="c">#</span>
<span class="c">#        # creation of direct signature and ray</span>
<span class="c">#        sign=[]</span>
<span class="c">#        sign_Tx_Rx=[]</span>
<span class="c">#        line = sh.LineString([(Tx_x, Tx_y), (Rx_x, Rx_y)])</span>
<span class="c">#        for i in range(len(seg)):</span>
<span class="c">#            n1,n2=self.Gs.neighbors(seg[i]+1)</span>
<span class="c">#            line_i = sh.LineString([(self.Gs.pos[n1][0], self.Gs.pos[n1][1]), (self.Gs.pos[n2][0], self.Gs.pos[n2][1])])</span>
<span class="c">#            if line.crosses(line_i)==True:</span>
<span class="c">#                sign.append(seg[i]+1)</span>
<span class="c">#        fig = plt.figure(1, dpi=90)</span>
<span class="c">#        ax = fig.add_subplot(1,1,1)</span>
<span class="c">#</span>
<span class="c">#        geu.plot_coords2(ax, line)</span>
<span class="c">#        geu.plot_bounds2(ax, line)</span>
<span class="c">#        geu.plot_line2(ax, line)</span>
<span class="c">#        sign_Tx_Rx.append(&#39;Tx&#39;)</span>
<span class="c">#</span>
<span class="c">#        for i in range(len(sign)):</span>
<span class="c">#                 sign_Tx_Rx.append(sign[i])</span>
<span class="c">#</span>
<span class="c">#        sign_Tx_Rx.append(&#39;Rx&#39;)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#        self.showGs()</span>
<span class="c">#        plt.draw()</span>
<span class="c">#        plt.show()</span>
<span class="c">#        return(sign_Tx_Rx)</span>

    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; help </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;L.showGs(clear=True)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;L.showGs(edlist=L.subseg()[&#39;WOOD&#39;],dthin=False,dlabels=True)&quot;</span>

<div class="viewcode-block" id="Layout.loadfur"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadfur.html#pylayers.gis.layout.Layout.loadfur">[docs]</a>    <span class="k">def</span> <span class="nf">loadfur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filefur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loadfur load a furniture file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filefur  : string</span>
<span class="sd">            short name of the furniture ini file</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            Furniture objects are stored in self.lfur list</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Load a Layout file and an associated furniture ini file</span>



<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.load(&#39;sircut.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.loadfur(&#39;Furw1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filefur</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filefur</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filefur</span><span class="p">)</span>
        <span class="n">furname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">furname</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">fur</span><span class="o">.</span><span class="n">Furniture</span><span class="p">()</span>
            <span class="n">F</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filefur</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Layout in different formats</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="o">=</span><span class="n">_filename</span>
        <span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.str&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadstr</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filemat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslab</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.str2&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadstr2</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filemat</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslab</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomfile</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;layout filename extension not recognized&#39;</span><span class="p">)</span>

        <span class="c">#  construct geomfile (.off) for vizalisation with geomview</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">geomfile</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;problem to construct geomfile&quot;</span>

<div class="viewcode-block" id="Layout.loadstr"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadstr.html#pylayers.gis.layout.Layout.loadstr">[docs]</a>    <span class="k">def</span> <span class="nf">loadstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">_filemat</span><span class="o">=</span><span class="s">&#39;def.mat&#39;</span><span class="p">,</span> <span class="n">_fileslab</span><span class="o">=</span><span class="s">&#39;def.slab&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loadstr load a .str de PulsRay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : string</span>
<span class="sd">        _filemat  : string</span>
<span class="sd">        _fileslab : string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L=Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">lname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Read : Nn Ns Nss</span>
        <span class="c">#        Number of Nodes           nn</span>
        <span class="c">#        Number of Edges           en</span>
        <span class="c">#        Number of Sub Segments    cen</span>
        <span class="c">#</span>
        <span class="n">data_nn</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Nn</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_nn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_en</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">Ne</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_en</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_cen</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">Nss</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_cen</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="n">Nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">=</span> <span class="n">Ne</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span>

        <span class="n">codesl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c"># tahe : tableau des noeuds initiaux et finaux des sgements</span>
        <span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c">#self.tahe[0,i]= stru.unpack(&#39;i&#39;,dt)[0]-1</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c">#self.tahe[1,i]= stru.unpack(&#39;i&#39;,dt)[0] -1</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c"># x : tableau des coordonnees x des noeuds</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># y : tableau des coordinates y des noeuds</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#--------------------------------------------</span>
        <span class="c"># Node labelling (structure nodes)</span>
        <span class="c">#--------------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># y : type de noeud</span>
        <span class="c">#</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">codep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># agi : tableau des angles initiaux des noeuds de type 2</span>
        <span class="c">#</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># agf : tableau des angles finaux des noeuds de type 2</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># nN : tableau des parametres d&#39;ouverture de diedre des noeuds de type 2</span>
        <span class="n">nN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nn</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#eml  =</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Ne</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#emr  =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#emc  =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">lname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c">#thickness =</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#ehmin =</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#ehmax =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
            <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice node-node</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">nd_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Nn</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Nn</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">nd_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice node-edge</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">nd_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Ne</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Nn</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">nd_ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read mat_i</span>
        <span class="c">#</span>
        <span class="n">mat_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">mat_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read mat_d</span>
        <span class="c">#</span>
        <span class="n">mat_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">mat_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice ed-ed</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">ed_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Ne</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Ne</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">ed_ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># Sous segments</span>
        <span class="c">#</span>
        <span class="c"># read ce_core  (A COMPLETER)</span>
        <span class="c">#</span>
        <span class="n">ce_core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_thick</span>
        <span class="c">#</span>
        <span class="n">ce_thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_thick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_prop_i</span>
        <span class="c">#</span>
        <span class="n">ce_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nss</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_wall_floor_ceil</span>
        <span class="c">#</span>
        <span class="n">ce_wall_floor_ceil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ed</span>
        <span class="c">#</span>
        <span class="n">ce_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_prop_d</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#   self.ce_prop[i]= stru.unpack(&#39;d&#39;,dt)[0]</span>
        <span class="c">#</span>
        <span class="c"># read ce_xmin</span>
        <span class="c">#</span>
        <span class="n">ce_xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_xmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_xmax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_xmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ymin</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ymin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ymax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ymax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_zmin</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_zmax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ce</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">ce</span><span class="p">[</span><span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_xmin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_xmax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_ymin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_ymax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c">#self.udbox()</span>
        <span class="c">#self.laylist()</span>
        <span class="c">#for i in self.layl:</span>
        <span class="c">#    self.display[&#39;Layer&#39;].append(i)</span>
        <span class="c">#    self.display[&#39;ActiveLayer&#39;].append(i)</span>

        <span class="c">#----------------------------------------</span>
        <span class="c"># Node labelling (structure edges)</span>
        <span class="c">#----------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                                                   <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]))</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span>
                                  <span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">nta</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">nhe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Update sub-segment</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ce</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce1</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce2</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_zmin</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_zmax</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ndnd</span> <span class="o">=</span> <span class="n">nd_nd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eded</span> <span class="o">=</span> <span class="n">ed_ed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nded</span> <span class="o">=</span> <span class="n">nd_ed</span>
        <span class="c">#</span>
        <span class="c"># Create connectivity graph Gc</span>
        <span class="c">#   update Gc with nd_nd ed_ed</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span>
        <span class="c">#</span>
        <span class="c"># !! Incomplet  (To Do nd_ed)</span>
        <span class="c">#</span>
        <span class="n">Nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nd_nd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">nnp</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kvu</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nd_nd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="o">-</span><span class="n">kvu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nnp</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

        <span class="n">Ne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed_ed</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">ne</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">kvu</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ed_ed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">kvu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="c">#</span>
        <span class="c"># The numpy format is conserved for acceleration</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">tahe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># update boundary</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.loadstr2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadstr2.html#pylayers.gis.layout.Layout.loadstr2">[docs]</a>    <span class="k">def</span> <span class="nf">loadstr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">_filemat</span><span class="o">=</span><span class="s">&#39;def.mat&#39;</span><span class="p">,</span> <span class="n">_fileslab</span><span class="o">=</span><span class="s">&#39;def.slab&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Graph from a str2 file</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            _filename : string</span>
<span class="sd">                str2 filename</span>
<span class="sd">            _filemat</span>
<span class="sd">                mat filename</span>
<span class="sd">            _fileslab</span>
<span class="sd">                slab filename</span>

<span class="sd">            Notes</span>
<span class="sd">            -----</span>
<span class="sd">            .. sourcecode::</span>

<span class="sd">                str2 format is as follow</span>

<span class="sd">                Np Ns Nss</span>
<span class="sd">                xp_1 yp_1 codep_1</span>
<span class="sd">                ...</span>
<span class="sd">                xp_Np yp_Np codep_Np</span>
<span class="sd">                tail_1 head_1 left_1 core_1 right_1 zmin_1 zmax_1</span>
<span class="sd">                ...</span>
<span class="sd">                tail_Ns head_Ns left_Ns core_Ns right_Ns zmin_Ns zmax_Ns</span>
<span class="sd">                segId_1 SlabCode_1 wall_floor_ceil_1 prop_d_1 zmin_1 zmax_1</span>
<span class="sd">                ...</span>
<span class="sd">                segId_Nss SlabCode_Nss wall_floor_ceil_Nss prop_d_Nss zmin_Nss zmax_Nss</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr2(&#39;Lstruc.str2&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># Parse the .str2 header NP NSEG NCOSEG</span>
        <span class="c">#</span>
        <span class="n">Nn</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ne</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Nss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="n">Nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">=</span> <span class="n">Ne</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span>

        <span class="n">lname</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">codep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nn</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Nn</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">codesl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Ne</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">))</span>

        <span class="n">ed_mat_prop_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ne</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ne</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

        <span class="n">ce_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ce_core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ce_wall_floor_ceil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_prop_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ce_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ce_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Read points</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">codep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c">#ag[0:i]=float(dt[3])</span>
            <span class="c">#ag[1:i]=float(dt[4])</span>
            <span class="c">#ag[2:i]=float(dt[5])</span>

        <span class="n">ind1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="c">#--------------------------------------------</span>
        <span class="c"># Node labelling (structure nodes)</span>
        <span class="c">#--------------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nn</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Read segments</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ind1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c"># em : [ left right core ]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">lname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]])</span>
            <span class="n">ed_mat_prop_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

        <span class="n">ind2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">ind1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c">#</span>
        <span class="c"># Read co-segments   ( Transposer dans loadstr)</span>
        <span class="c">#</span>
        <span class="n">ce</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ind2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ce_prop_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">ce</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                  <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

        <span class="c">#----------------------------------------</span>
        <span class="c"># Node labelling (structure edges)</span>
        <span class="c">#----------------------------------------</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="c">#print k, lname[k]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="c">#self.Gs.add_node(k+1,norm=np.array([norm[0,k],norm[1,k],0.]))</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span>
                                  <span class="mf">2.</span><span class="p">,</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">nta</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">nhe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Update sub-segment</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ce</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce1</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce2</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_zmin</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_zmax</span><span class="o">=</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>

        <span class="c">#</span>
        <span class="c"># Nodes are numbered from 1 in .str2</span>
        <span class="c"># Nodes are numbered from 0 in Graph</span>
        <span class="c">#</span>
        <span class="c">#self.udbox()</span>
        <span class="c">#self.boundary()</span>
        <span class="c">#self.laylist()</span>
        <span class="c">#for i in self.layl:</span>
        <span class="c">#    self.display[&#39;Layer&#39;].append(i)</span>
        <span class="c">#    self.display[&#39;ActiveLayer&#39;].append(i)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">tahe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c">#self.boundary(1,1)</span>
</div>
    <span class="k">def</span> <span class="nf">subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; establish the association : name &lt;-&gt;  edgelist</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A dictionnary with sub seg name as key  and edge number as value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dico</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dico</span><span class="p">:</span>
                    <span class="n">dico</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dico</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dsseg</span> <span class="o">=</span> <span class="n">dico</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>

<div class="viewcode-block" id="Layout.add_pnod"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_pnod.html#pylayers.gis.layout.Layout.add_pnod">[docs]</a>    <span class="k">def</span> <span class="nf">add_pnod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Project point p on segment e1 along segment e2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">            p  : ndarray</span>
<span class="sd">                point</span>
<span class="sd">            e1 : int</span>
<span class="sd">                edge number 1</span>
<span class="sd">            e2 : int</span>
<span class="sd">                edge number 2</span>

<span class="sd">        ..todo</span>
<span class="sd">            This function is void</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#p1 = p + alpha*ve2</span>
        <span class="c">#p1 = pa + beta * (pb-pa)</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Layout.add_fnod"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_fnod.html#pylayers.gis.layout.Layout.add_fnod">[docs]</a>    <span class="k">def</span> <span class="nf">add_fnod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; add free node  p</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p is a tuple</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.add_fnod((10.0,10.0))</span>
<span class="sd">        -9</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c"># update labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_nfpe"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_nfpe.html#pylayers.gis.layout.Layout.add_nfpe">[docs]</a>    <span class="k">def</span> <span class="nf">add_nfpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">np0</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add node on e1 from projection of np0 along e2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            np0  : point number</span>
<span class="sd">            e1   : edge number 1</span>
<span class="sd">            e2   : edge number 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">np2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
        <span class="n">xA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#print xA,yA</span>
        <span class="c">#print xB,yB</span>
        <span class="c">#print xC,yC</span>
        <span class="c">#print xD,yD</span>
        <span class="c">#print xP,yP</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">xB</span> <span class="o">-</span> <span class="n">xA</span><span class="p">,</span> <span class="n">xD</span> <span class="o">-</span> <span class="n">xC</span><span class="p">],</span> <span class="p">[</span><span class="n">yB</span> <span class="o">-</span> <span class="n">yA</span><span class="p">,</span> <span class="n">yD</span> <span class="o">-</span> <span class="n">yC</span><span class="p">]])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xP</span> <span class="o">-</span> <span class="n">xA</span><span class="p">,</span> <span class="n">yP</span> <span class="o">-</span> <span class="n">yA</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_none</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#print x</span>
</div>
<div class="viewcode-block" id="Layout.add_none"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_none.html#pylayers.gis.layout.Layout.add_none">[docs]</a>    <span class="k">def</span> <span class="nf">add_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        L.add_none(ns,alpha=0.5) : add node on edge ns</span>
<span class="sd">        alpha is a parameterisation on the  edge</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="n">namens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">zminns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>
        <span class="n">zmaxns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="c"># delete old edge ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_edge</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="c"># add new edge np[0] num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">namens</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">zminns</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">zmaxns</span><span class="p">)</span>
        <span class="c"># add new edge num np[1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">namens</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">zminns</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">zmaxns</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_edge"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_edge.html#pylayers.gis.layout.Layout.add_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;PARTITION&#39;</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="mf">3.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        L.add_edge(n1,n2,name=&#39;PARTITION&#39;,zmin=0,zmax=3.0)     : add edge between n1 and n2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">n1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">[</span><span class="n">up</span><span class="p">]</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">e1</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="c">#print tn</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;add_edge : error not a node&quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
            <span class="k">return</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">p2mp1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">p2mp1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2mp1</span><span class="p">,</span> <span class="n">p2mp1</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># n = t x z</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">zmin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">zmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c"># update slab name &lt;-&gt; edge number dictionnary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">]</span>
        <span class="c"># update label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.del_node"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_node.html#pylayers.gis.layout.Layout.del_node">[docs]</a>    <span class="k">def</span> <span class="nf">del_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ln</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete node in list ln</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="n">ln</span><span class="p">:</span>
            <span class="n">nbrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="n">nbrc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nbrs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">del_edge</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># .. todo :: del_node Layout.py :  Attention Graph Gc non mis a jour</span>
            <span class="c">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">-</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Layout.del_edge"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_edge.html#pylayers.gis.layout.Layout.del_edge">[docs]</a>    <span class="k">def</span> <span class="nf">del_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">le</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete edge e</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        le : list of segment number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">le</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">le</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">le</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">le</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">le</span> <span class="o">=</span> <span class="p">[</span><span class="n">le</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">le</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c"># update slab name &lt;-&gt; edge number dictionnary</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="c"># delete subseg if required</span>
</div>
<div class="viewcode-block" id="Layout.del_cycle"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_cycle.html#pylayers.gis.layout.Layout.del_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">del_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lnc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete a cycle</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        nc :  cycle number</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">lnc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lnc</span> <span class="o">=</span> <span class="p">[</span><span class="n">lnc</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">lnc</span><span class="p">:</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])</span>
            <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="n">tvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

            <span class="k">for</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">tvn</span><span class="p">,</span> <span class="n">vn</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tvn</span> <span class="o">=</span> <span class="n">vn</span>

            <span class="n">utvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tvn</span><span class="p">)</span>
            <span class="n">udel</span> <span class="o">=</span> <span class="n">vnodes</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">vnodes</span><span class="p">,</span> <span class="n">utvn</span><span class="p">)]</span>

            <span class="c"># delete cycle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="c"># delete nodes in udel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">del_edge</span><span class="p">(</span><span class="n">udel</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">check2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Layout checking</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tseg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lnp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">lnp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">lnp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">tseg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])]))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="mi">19</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="mi">54</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="mi">79</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="mi">254</span><span class="p">):</span>
                    <span class="k">print</span> <span class="n">k</span>
                    <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                    <span class="k">print</span> <span class="n">cy</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;more than 2 cycles in segment &quot;</span><span class="p">,</span> <span class="n">k</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tseg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">seg1</span> <span class="o">=</span> <span class="n">tseg</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">seg2</span> <span class="o">=</span> <span class="n">tseg</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;crosses :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;contains :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">seg1</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;contains :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;overlaps :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg2</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">seg1</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;overlaps :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">tseg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cleanup the Layout</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. Remove nodes which are not connected</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">displaygui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        displaygui() : open a GUI for display configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">displaygui</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Display Parameters&#39;</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;nodes&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ednodes&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ndlabel&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;edlabel&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;edges&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;subseg&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;visu&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;thin&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;scaled&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;overlay&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;fileoverlay&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;box&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;alpha&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">],</span>
                                   <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;box&#39;</span><span class="p">]),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">displaygui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">displaygui</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">displaygui</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;box&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">13</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">info_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        info_edge(e1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nebd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nns1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
        <span class="n">nns2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">de1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
        <span class="k">print</span> <span class="n">n1</span><span class="p">,</span> <span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="n">nns1</span>
        <span class="k">print</span> <span class="n">n2</span><span class="p">,</span> <span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="n">nns2</span>
        <span class="k">print</span> <span class="s">&#39;------------&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Slab     : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;zmin (m) : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;zmax (m) : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;------------&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;subseg Slab     : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;subseg zmin (m) : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;subseg zmax (m) : &#39;</span><span class="p">,</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">edit_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        L.edit_edge(e1)       : edit edge e1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nebd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">de1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Segment (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">de1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">de1k</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;zmin&#39;</span><span class="p">,</span> <span class="s">&#39;zmax&#39;</span><span class="p">]</span>
            <span class="n">de1v</span> <span class="o">=</span> <span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">de1k</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;zmin&#39;</span><span class="p">,</span> <span class="s">&#39;zmax&#39;</span><span class="p">,</span> <span class="s">&#39;ss_name&#39;</span><span class="p">,</span> <span class="s">&#39;ss_zmin&#39;</span><span class="p">,</span> <span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
            <span class="n">de1v</span> <span class="o">=</span> <span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span>
                <span class="s">&#39;ss_name&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]]</span>
        <span class="c">#de1v    = de1.values()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">de1k</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">de1v</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">de1k</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;name&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c">#</span>
        <span class="c"># Update L.name</span>
        <span class="c">#</span>

    <span class="k">def</span> <span class="nf">have_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        have_subseg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">del_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        del_subseg(e1)</span>

<span class="sd">        del subseg information on e1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_subseg</span><span class="p">(</span><span class="n">e1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no subseg to delete&quot;</span>

<div class="viewcode-block" id="Layout.add_subseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_subseg.html#pylayers.gis.layout.Layout.add_subseg">[docs]</a>    <span class="k">def</span> <span class="nf">add_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        add_subseg(e1)</span>

<span class="sd">        add a sub segment on segment e1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_subseg</span><span class="p">(</span><span class="n">e1</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;a subseg already exists&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_edge</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
                                                 <span class="s">&#39;zmin&#39;</span><span class="p">,</span> <span class="s">&#39;zmax&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;DOOR&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">2.24</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Layout.add_window"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_window.html#pylayers.gis.layout.Layout.add_window">[docs]</a>    <span class="k">def</span> <span class="nf">add_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a window on segment </span>

<span class="sd">        Parameters </span>
<span class="sd">        ----------</span>
<span class="sd">        e1 : integer </span>
<span class="sd">            segment number </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Layout.add_door"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_door.html#pylayers.gis.layout.Layout.add_door">[docs]</a>    <span class="k">def</span> <span class="nf">add_door</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a door on segment </span>

<span class="sd">        Parameters </span>
<span class="sd">        ----------</span>
<span class="sd">        e1 : integer </span>
<span class="sd">            segment number </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
    <span class="k">def</span> <span class="nf">find_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        edgelist = find_edgelist(edgelist,nodelist)</span>

<span class="sd">        edgelist : input edgelist</span>
<span class="sd">        nodelist : input nodelist</span>

<span class="sd">        return the subset of edgelist</span>

<span class="sd">        Not Finished :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># TODO : eviter utilisation de self.tahe</span>
        <span class="c">#</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">]</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">]</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d_nu</span><span class="p">[</span><span class="n">tail</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">]</span>
        <span class="n">nh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d_nu</span><span class="p">[</span><span class="n">head</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">]</span>

        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">edgelist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ed_t</span><span class="p">,</span> <span class="n">ed_h</span><span class="p">)]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">al1</span><span class="p">,</span> <span class="n">al2</span><span class="p">,</span> <span class="n">quadsel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        diag (p1,p2,l,al1,al2,quadsel)</span>

<span class="sd">        p1  :</span>
<span class="sd">        p2  :</span>
<span class="sd">        al1</span>
<span class="sd">        al2</span>

<span class="sd">        quadsel : 0   all quadrant</span>
<span class="sd">              2 1</span>
<span class="sd">              3 4</span>

<span class="sd">        WARNING : Not Tested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c">#</span>
        <span class="c"># selection du quadran</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nn</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">x_u0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u0</span><span class="p">]</span>
        <span class="n">y_u0</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Permutation points</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="c">#</span>
        <span class="c"># Box length</span>
        <span class="c">#</span>

        <span class="n">Dx</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Dx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Dy</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Parametre de la droite p1 p2 (cas general)</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Dy</span> <span class="o">/</span> <span class="n">Dx</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span>
            <span class="n">b2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span>

            <span class="n">delta_b</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span>
            <span class="n">delta_b1</span> <span class="o">=</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span>
            <span class="n">delta_b2</span> <span class="o">=</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span>

            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u0</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x_u0</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">delta_b</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u1</span> <span class="o">=</span> <span class="n">x_u0</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y_u0</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u1</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x_u1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="n">delta_b</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u2</span> <span class="o">=</span> <span class="n">x_u1</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="n">y_u2</span> <span class="o">=</span> <span class="n">y_u1</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">x_u2</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">delta_b1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">x_u3</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">+</span> <span class="n">delta_b2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">x_u2</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">delta_b1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">x_u3</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">delta_b2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u4</span> <span class="o">=</span> <span class="n">x_u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]</span>
                <span class="n">y_u4</span> <span class="o">=</span> <span class="n">y_u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]</span>
<span class="c">#</span>
<span class="c"># p1 p2 vertical</span>
<span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u1</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_u2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#</span>
<span class="c"># p1 p2 horizontal</span>
<span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u1</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u2</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u3</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u2</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nodelist</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="n">u1</span><span class="p">[</span><span class="n">u2</span><span class="p">[</span><span class="n">u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]]]]</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ne</span><span class="p">)</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_edge_list</span><span class="p">(</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">nd2ed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert nodelist to edgelist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndarray</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c">#mecanisme puissant de concatenation de listes</span>
        <span class="n">edlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ndlist</span><span class="p">:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="n">edlist</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">edlist</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">ed2nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert edgelist to nodelist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndarray</span><span class="p">:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="n">edlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c"># mecanisme de concatenation de listes</span>
        <span class="n">ndlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edlist</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">ndlist</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        nl,el = zone(xmin=0,xmax=10,ymin=0,,ymax=10):</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ndlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">)):</span>
                    <span class="n">ndlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">edlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd2ed</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ndlist</span><span class="p">,</span> <span class="n">edlist</span>

<div class="viewcode-block" id="Layout.savestr2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.savestr2.html#pylayers.gis.layout.Layout.savestr2">[docs]</a>    <span class="k">def</span> <span class="nf">savestr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">furniture</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Layout in .str2 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : string</span>
<span class="sd">            file is  written in the struc directory of the current Project</span>
<span class="sd">            directory which is defined through the environment variable $BASENAME</span>
<span class="sd">            extension .str2 is added to short name filename</span>
<span class="sd">            furniture :  boolean</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        To produce the .str file</span>

<span class="sd">                &gt; newstruc -str2 file.str2 -conf ../project.conf</span>

<span class="sd">        .. todo:: Create a savestr from the Layout Class require Gv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">furniture</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># Create node list</span>
            <span class="c">#</span>

            <span class="c">#</span>
            <span class="c"># Create edge list</span>
            <span class="c">#</span>

            <span class="c">#</span>
            <span class="c"># Create subseg</span>
            <span class="c">#</span>
            <span class="k">pass</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span>
        <span class="n">nss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span>

        <span class="n">cnn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">cne</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span>
        <span class="n">cnss</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nss</span><span class="p">)</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;.str2&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">chaine</span> <span class="o">=</span> <span class="n">cnn</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">cne</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">cnss</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">dnode</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c">#</span>
        <span class="c"># Reorder segments and points</span>
        <span class="c">#</span>
        <span class="c"># ..todo:: do a spatial reordering</span>
        <span class="c">#</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">useg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">upoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">npoint</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">upoint</span><span class="p">]</span>
        <span class="n">nseg</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">useg</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">npoint</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># points</span>
            <span class="c">#</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">deg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">codep</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">codep</span> <span class="o">+</span> <span class="s">&quot; 0.0 0.0 0.0</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">dnode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">ni</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nseg</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># segments</span>
            <span class="c">#</span>
            <span class="n">ta</span> <span class="o">=</span> <span class="n">dnode</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">he</span> <span class="o">=</span> <span class="n">dnode</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">cta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>
            <span class="n">che</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">he</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">core</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">])</span>
            <span class="n">zmax</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="n">cta</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">che</span> <span class="o">+</span> <span class="s">&quot; 1 &quot;</span> <span class="o">+</span> <span class="n">core</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="s">&quot; 1 &quot;</span> <span class="o">+</span> \
                <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="s">&quot; 0 &quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmin</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmax</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nseg</span><span class="p">):</span>
            <span class="c">#</span>
            <span class="c"># sub-segment</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>
                <span class="n">core</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
                <span class="n">ce1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">])</span>
                <span class="n">ce2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">])</span>
                <span class="n">zmin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">])</span>
                <span class="n">zmax</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">])</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">core</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ce1</span> <span class="o">+</span> \
                    <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ce2</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmin</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmax</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">angleonlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">p2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            angleonlink(self,p1,p2) return seglist between p1 and p2</span>
<span class="sd">            p1 : (1 x 2 )</span>
<span class="sd">            p2 : (1 x 2 )</span>
<span class="sd">            return (seglist , theta)</span>

<span class="sd">            &gt;&gt;&gt; L=Layout(&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr(&#39;sircut.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">            &gt;&gt;&gt; p2 = np.array([10,3])</span>
<span class="sd">            &gt;&gt;&gt; seglist,theta = L.angleonlink(p1,p2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">nu</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">npta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">nphe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>

        <span class="n">Pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">npta</span><span class="p">]</span>
        <span class="n">Phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">nphe</span><span class="p">]</span>

        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>

        <span class="n">bo</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Pta</span><span class="p">,</span> <span class="n">Phe</span><span class="p">)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="n">seglist</span><span class="p">[</span><span class="n">bo</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Calculate normal angle angle of incidence</span>
        <span class="c">#</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">head</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">tail</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">head</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">tail</span><span class="p">]))</span>
        <span class="n">mvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vn</span> <span class="o">*</span> <span class="n">vn</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">vn</span> <span class="o">/</span> <span class="n">mvn</span>
        <span class="n">uu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">unn</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">uu</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">unn</span><span class="p">)</span>
        <span class="c">#print vn</span>
        <span class="c">#print mvn</span>
        <span class="c">#print &#39;n :&#39;,n</span>
        <span class="c">#print &#39;un : &#39;,unn</span>
        <span class="c">#print &#39;theta (deg)&#39;,the*180./pi</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">layeronlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        layeronlink(self,p1,p2) return seglist between p1 and p2</span>

<span class="sd">        p1 : (1 x 2 )</span>
<span class="sd">        p2 : (1 x 2 )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">npta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">nphe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>

        <span class="n">Pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">npta</span><span class="p">]</span>
        <span class="n">Phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">nphe</span><span class="p">]</span>

        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>

        <span class="nb">bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Pta</span><span class="p">,</span> <span class="n">Phe</span><span class="p">)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="n">seglist</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">seglist</span>

    <span class="k">def</span> <span class="nf">segpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptlist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a sequence of point number</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ptlist</span>
<span class="sd">            array(1xNp) Point number array</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        seglist</span>
<span class="sd">            array seglist associated with ptlist</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ptlist  = np.array([0,1])</span>
<span class="sd">        &gt;&gt;&gt; seglist = L.segpt(ptlist)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ptlist</span><span class="p">:</span>
            <span class="n">ut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">seglist</span><span class="p">,</span> <span class="n">ut</span><span class="p">,</span> <span class="n">uv</span><span class="p">))</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">seginframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a given zone defined by two points</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            p1</span>
<span class="sd">                array (1 x 2)</span>
<span class="sd">            p2</span>
<span class="sd">                array (1 x 2)</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            seglist</span>
<span class="sd">                list of segment number inside a planar region defined by p1 an p2</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr(&#39;sircut.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">            &gt;&gt;&gt; p2 = np.array([10,10])</span>
<span class="sd">            &gt;&gt;&gt; seglist = L.seginframe(p1,p2)</span>
<span class="sd">            &gt;&gt;&gt; assert len(seglist)==97,&quot;something has changed in sircut.str&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">Dx</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Dy</span> <span class="o">&lt;</span> <span class="n">Dx</span><span class="p">):</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">max_x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span>
                <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">min_x</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">max_y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span>
                <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">min_y</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segpt</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">layerongrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">Tx</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; grid Nx,Ny,2</span>
<span class="sd">            Tx   1x2</span>
<span class="sd">            .. todo:: layeron grid Not finished</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">Nx</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Ny</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">seglist</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layeronlink</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Tx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">checkvis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">visilist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the list of nodes from Gc which are visible from point p</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p</span>
<span class="sd">            np.array point</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        AAS = [0:2pi]</span>
<span class="sd">        While (AAS != void set)</span>
<span class="sd">             1) Find segment ns either</span>
<span class="sd">                i)  the closest segment from p in AAS</span>
<span class="sd">                ii) neighbor of prec(ns)</span>
<span class="sd">             2) Find the edgelist visible from ns</span>
<span class="sd">            edgelist = vedgelist(ns)</span>
<span class="sd">             3) Check_occultation(p,ns,edgelist)</span>
<span class="sd">                Occultation 8  situations</span>
<span class="sd">                [p1,pM,p2] = [T,T,T]  : fully occulted</span>
<span class="sd">                         [     ]    partially visible</span>
<span class="sd">                         [F,F,F]  : fully visible</span>
<span class="sd">             4) Update Allowed Angular Sector  (AAS)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AAS</span> <span class="o">=</span> <span class="n">Intvl</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">])</span>
        <span class="n">nsprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">while</span> <span class="n">AAS</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nsprev</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">AAS</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nsprev</span><span class="p">)</span>
            <span class="n">edgelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vedgelist</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">bM</span><span class="p">,</span> <span class="n">b2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">-</span> <span class="n">occultation</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">)</span>
            <span class="n">AAS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AAS</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">closest_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">AAS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        This function return the closest segment from p which belong to</span>
<span class="sd">        the AAS (Allowed Angular Sector)</span>

<span class="sd">        [ns] = closest_edge(self,p,AAS)</span>

<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">visi_papb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        visi_papb : determine if pa and pb are in visibility for the structure graph</span>

<span class="sd">        visi_papb(pa,pb,edgelist)</span>

<span class="sd">        pa       : 1x2</span>
<span class="sd">        pb       : 1x2</span>
<span class="sd">        edgelist : exclusion edge list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># .. todo: avoid utilisation tahe</span>
        <span class="c">#</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ta</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ta</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">he</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">he</span><span class="p">]</span>

        <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">den</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">den</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">numa</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">numb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">ua</span> <span class="o">=</span> <span class="n">numa</span> <span class="o">/</span> <span class="n">den</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">numb</span> <span class="o">/</span> <span class="n">den</span>

        <span class="c">#ua[edgelist] = 1000</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">ua</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ua</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Si le segment de droite pa-pb intercepte des paroies de la structure</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">!=</span> <span class="p">[]):</span>
            <span class="n">visi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visi</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span><span class="p">(</span><span class="n">visi</span><span class="p">)</span>

<div class="viewcode-block" id="Layout.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.save.html#pylayers.gis.layout.Layout.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            File extension is .gml</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileGs</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gs&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_gml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">fileGs</span><span class="p">)</span>
        <span class="n">fileGc</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gc&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_gml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="p">,</span> <span class="n">fileGc</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">loadG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            File extension is .gml</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileGs</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gs&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="n">fileGs</span><span class="p">)</span>
        <span class="n">fileGc</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gc&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="n">fileGc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndlist</span><span class="o">=</span><span class="p">[</span><span class="mf">1e8</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show nodes</span>

<span class="sd">        show_nodes(self,ndlist=[],size=10,color=&#39;b&#39;):</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ndlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e8</span><span class="p">)</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">ndlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1e8</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c">#elif ndlist[0]==1e8:</span>
        <span class="c">#    ndlist  = self.Gs.node.keys()</span>

        <span class="c">#print ndlist</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">ndlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlabels</span><span class="p">:</span>
            <span class="n">dicopos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dicolab</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ndlist</span><span class="p">:</span>
                <span class="n">dicopos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="n">dicolab</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">dicopos</span><span class="p">,</span> <span class="n">dicolab</span><span class="p">,</span>
                                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show_edges</span>

<span class="sd">        show_edges(self,edlist=[],alpha=1,width=1,color=&#39;black&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">ndarray</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c">#print ndlist</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">ndlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlabels</span><span class="p">:</span>
            <span class="n">dicopos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dicolab</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ndlist</span><span class="p">:</span>
                <span class="c">#dicopos[n]=tuple(np.array(self.Gs.pos[n])+np.array((0.8,0.2)))</span>
                <span class="n">dicopos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="n">dicolab</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">dicopos</span><span class="p">,</span> <span class="n">dicolab</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        show_edges</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            edlist</span>
<span class="sd">            alpha</span>
<span class="sd">            width</span>
<span class="sd">            color</span>
<span class="sd">            dnodes</span>
<span class="sd">            dlabels</span>
<span class="sd">            font_size</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clrlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="n">clrlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cold</span><span class="p">[</span><span class="n">color</span><span class="p">])</span>
        <span class="n">ecmap</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">clrlist</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span>
        <span class="n">ue</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">edlist</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">U</span><span class="p">,</span>
                               <span class="n">edge_color</span><span class="o">=</span><span class="n">ue</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">ecmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlabels</span><span class="p">:</span>
               <span class="c"># print edlist</span>
               <span class="c"># nodelist = self.ed2nd(edlist)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dnodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dthin</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                   <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show_layer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : </span>
<span class="sd">        edlist :</span>
<span class="sd">        alpha : float </span>
<span class="sd">            transparency </span>
<span class="sd">        width : int</span>
<span class="sd">        color : string</span>
<span class="sd">            default black&#39;</span>
<span class="sd">        dnodes</span>
<span class="sd">        dthin</span>
<span class="sd">        dlabels</span>
<span class="sd">        font_size</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">edlist</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># intersect layer edge list with local zone edge list (in function argument)</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_edges</span><span class="p">(</span><span class="n">edlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">linewidth</span> <span class="o">=</span> <span class="n">slab</span><span class="p">[</span><span class="s">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">slab</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_edges</span><span class="p">(</span><span class="n">edlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="n">dnodes</span><span class="p">,</span>
                            <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showGt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">roomlist</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; show topological graph Gt </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ax : matlplotlib axes</span>
<span class="sd">        roomlist : list </span>
<span class="sd">            list of room numbers</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">signedarea</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showGs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">ndlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">furniture</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">roomlist</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; show structure graph Gs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ndlist  : np.array</span>
<span class="sd">            set of nodes to be displayed</span>
<span class="sd">        edlist  : np.array</span>
<span class="sd">            set of edges to be displayed</span>
<span class="sd">        show    : boolean</span>
<span class="sd">            default True</span>
<span class="sd">        furniture : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        display parameters are defined in  L.display dictionnary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig,ax </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">furniture</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;lfur&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fur1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fur1</span><span class="o">.</span><span class="n">Matname</span> <span class="o">==</span> <span class="s">&#39;METAL&#39;</span><span class="p">:</span>
                        <span class="n">fur1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Warning : no furniture file loaded&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;clear&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">strdir</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ndlist</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">edlist</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">)</span>
        <span class="n">slablist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]:</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span>
            <span class="n">font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fontsize&#39;</span><span class="p">]</span>
            <span class="n">dnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span>
            <span class="n">dthin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">nameslab</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]:</span>
                <span class="c">#print len(edlist)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_layer</span><span class="p">(</span><span class="n">nameslab</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">dthin</span><span class="o">=</span><span class="n">dthin</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="n">dnodes</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]:</span>
            <span class="n">dico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dico</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">edlist</span> <span class="o">=</span> <span class="n">dico</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_edges</span><span class="p">(</span><span class="n">edlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
        <span class="c">#fig = plt.gcf()</span>
        <span class="c">#ax  = fig.axes[0]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ticksoff&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="n">roomlist</span><span class="p">:</span>
            <span class="n">ncy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">buildGc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build the connectivity graph</span>

<span class="sd">        nd_nd  : node to node only convex to convex visibility is taken into account</span>
<span class="sd">        nd_ed  : node to edge</span>
<span class="sd">        ed_ed  : edge to edge</span>

<span class="sd">        .. todo: To be Continued</span>
<span class="sd">        Faire ce travail piece par piece</span>
<span class="sd">        Ce code implemnte une condition necessaire mais non suffisante</span>

<span class="sd">        Il existe des points de degre &lt;=2 qui ne sont pas diffractant</span>
<span class="sd">        si en zone concave</span>

<span class="sd">                __________</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        ncoin , ndiff</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># First step</span>
        <span class="c">#</span>
        <span class="c">#for nr in self.Gr.node()</span>
        <span class="n">ncoin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># first step</span>
        <span class="c"># find all node (&lt;0) with  degree &lt; 3</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ncoin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ncoin</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ndiff</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ncoin</span><span class="p">,</span> <span class="n">ndiff</span>

    <span class="k">def</span> <span class="nf">buildGt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Built topological graph Gt</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        1. Exploit `cycle_basis` function of NetworkX</span>
<span class="sd">        2. Each discovered cycle in the graph Gs is transform in a Cycles.Cycles object</span>
<span class="sd">        3. LC (List of Cycles) contains the list of all these Cycle object</span>
<span class="sd">        4. Create graph G_t each cycle of Gs is a node of Gt</span>
<span class="sd">        5. Seek for Cycle inter connectivity</span>
<span class="sd">                Algorithm :</span>
<span class="sd">                    For k in cycles :</span>
<span class="sd">                        vnodesk = get vnodes(k)</span>
<span class="sd">                            For l in cycles &gt; k</span>
<span class="sd">                                vnodesl = get vnodes(l)</span>
<span class="sd">                                    nkinnl = vnodesk :math:\cap vnodesl</span>



<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">            nx.algorithms.cycles.cycle_basis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">cycle_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span>
        <span class="n">LC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>
            <span class="n">Cy</span> <span class="o">=</span> <span class="n">Cycls</span><span class="o">.</span><span class="n">Cycle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">LC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Cy</span><span class="p">)</span>

        <span class="n">Cys</span> <span class="o">=</span> <span class="n">Cycls</span><span class="o">.</span><span class="n">Cycles</span><span class="p">(</span><span class="n">LC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span> <span class="o">=</span> <span class="n">Cys</span><span class="o">.</span><span class="n">Gt</span>

        <span class="c">#N = len(self.Gt.nodes())</span>
        <span class="c">#for k in self.Gt.nodes():</span>
        <span class="c">#    nk = np.array(self.Gt.node[k][&#39;vnodes&#39;])</span>
        <span class="c">#    for l in np.arange(k+1,N):</span>
        <span class="c">#        nl = np.array(self.Gt.node[l][&#39;vnodes&#39;])</span>
        <span class="c">#        nkinl = np.intersect1d(nk,nl)</span>
        <span class="c">#        if len(nkinl!=0):</span>
        <span class="c">#            self.Gt.add_edge(k,l)</span>
        <span class="n">Ncycles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

        <span class="c">#</span>
        <span class="c">#  Update graph Gs with cycle number information</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ncycles</span><span class="p">):</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c">#  Seek for Cycle inter connectivity</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Ncycles</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">vnodes0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])</span>
            <span class="n">vnodes1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])</span>
            <span class="c">#</span>
            <span class="c"># Connect Cycles if they share nodes</span>
            <span class="c">#</span>
            <span class="n">intersection_vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">vnodes0</span><span class="p">,</span> <span class="n">vnodes1</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersection_vnodes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c">#</span>
        <span class="c"># Construct the polygon associated to each cycle</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
            <span class="n">u_neg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">vnodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="n">vnodes</span><span class="p">[</span><span class="n">u_neg</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c">#</span>
            <span class="c"># Loop over points</span>
            <span class="c">#</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">npoints</span><span class="p">:</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">polk</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">)),</span> <span class="n">vnodes</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">polyg</span><span class="o">=</span><span class="n">polk</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Construct the list of interactions associated to each cycle</span>
        <span class="c">#</span>
        <span class="c"># Interaction labeling convention</span>
        <span class="c">#</span>
        <span class="c">#   negative integer : Diffraction on point |ni|</span>
        <span class="c">#   positive integer : Transmission through segment ni</span>
        <span class="c">#   tuple (nseg,ncycle) : Reflection on nseg toward cycle ncycle</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#    At that stage the diffraction point are not included</span>
        <span class="c">#    not enough information available</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
            <span class="n">ListInteractions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inode</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ListInteractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">inode</span><span class="p">))</span>
                    <span class="n">ListInteractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">inode</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="n">ListInteractions</span><span class="p">)</span>

<div class="viewcode-block" id="Layout.buildGw"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGw.html#pylayers.gis.layout.Layout.buildGw">[docs]</a>    <span class="k">def</span> <span class="nf">buildGw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build Graph of waypaths</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        buildGr</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">edges_iter</span><span class="p">():</span>
            <span class="n">doors1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
            <span class="n">doors2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
<span class="c">#            if len(doors1) &gt; 1:</span>
<span class="c">#                pdb.set_trace()</span>
            <span class="n">doorId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">doors1</span><span class="p">,</span> <span class="n">doors2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">unode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">doorId</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">pdoor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">doorId</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">doorId</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdoor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">doorId</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">),</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">doorId</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes_iter</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.buildGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGv.html#pylayers.gis.layout.Layout.buildGv">[docs]</a>    <span class="k">def</span> <span class="nf">buildGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build global visibility graph</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGv()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># loop over rooms</span>
        <span class="c">#</span>

        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">udeg2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">udeg1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">icycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>  <span class="c"># id of cycle</span>
            <span class="n">room</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">icycle</span><span class="p">]</span>      <span class="c"># cycle of the room</span>
            <span class="n">polyg</span> <span class="o">=</span> <span class="n">room</span><span class="p">[</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>             <span class="c"># pol</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">room</span><span class="p">[</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
            <span class="c">#</span>
            <span class="c"># seek node of degree 2</span>
            <span class="c">#</span>
            <span class="c"># udeg2 is the index of the deg 2 point in the sequence of points</span>
            <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">inode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vnodes</span><span class="p">):</span>
                <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">ik</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">inode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">deg</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">udeg2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">deg</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">udeg1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>    <span class="c"># warning not used</span>
            <span class="n">Gv</span> <span class="o">=</span> <span class="n">polyg</span><span class="o">.</span><span class="n">buildGv</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="n">udeg2</span><span class="o">=</span><span class="n">udeg2</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># Graph Gv aggregation</span>
            <span class="c">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.buildGi"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGi.html#pylayers.gis.layout.Layout.buildGi">[docs]</a>    <span class="k">def</span> <span class="nf">buildGi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Build graph of interaction</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        For each node &gt; of graph Gs creates</span>
<span class="sd">            3 different nodes associated to the same segment</span>
<span class="sd">            R+ T R-</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">129</span><span class="p">:</span>
                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">cy0</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cy1</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">)))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                    <span class="n">nei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                    <span class="n">np1</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">np2</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">])</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">])</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
                    <span class="n">nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                    <span class="n">ln</span> <span class="o">=</span> <span class="n">l</span> <span class="o">/</span> <span class="n">nl</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">nl</span> <span class="o">/</span> <span class="mi">10</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c"># Loop over interactions</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">n</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="p">(</span><span class="mi">161</span><span class="p">,</span> <span class="mi">53</span><span class="p">):</span>
                <span class="k">pass</span>
                <span class="c">#pdb.set_trace()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c"># reflection</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
                <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>           <span class="c"># Si Voisin dans cycle reflexion</span>
                        <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                            <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">nc</span><span class="p">))</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="c"># R-R</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c"># R-T</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                    <span class="n">pdb_set_trace</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>                                    <span class="c"># R-D</span>
                            <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                            <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                <span class="n">pdb_set_trace</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># transmission or diffraction</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># transmission</span>
                    <span class="n">ns</span> <span class="o">=</span> <span class="n">n</span>
                    <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                    <span class="n">cy0</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cy1</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">vnodes0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy0</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
                    <span class="n">vnodes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy1</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
                    <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                    <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes0</span><span class="p">:</span>    <span class="c"># Si Voisin dans cycle reflexion 0</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">cy0</span><span class="p">))</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c"># R-T</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes1</span><span class="p">:</span>    <span class="c"># Si Voisin dans cycle reflexion 1</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c"># R-T</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">print</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span>
                                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>

<span class="c">#    def showGraph(self,**kwargs):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        print n,nb</span>
<span class="c">#        show : boolean</span>
<span class="c">#        fig</span>
<span class="c">#        nodes</span>
<span class="c">#        eded</span>
<span class="c">#        ndnd</span>
<span class="c">#        nded</span>
<span class="c">#        linewidth</span>
<span class="c">#        roomlis</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        defaults={&#39;show&#39;:False,</span>
<span class="c">#                  &#39;fig&#39;:[],</span>
<span class="c">#                  &#39;ax&#39;:[],</span>
<span class="c">#                  &#39;nodes&#39;:False,</span>
<span class="c">#                  &#39;eded&#39;:True,</span>
<span class="c">#                  &#39;ndnd&#39;:True,</span>
<span class="c">#                  &#39;nded&#39;:True,</span>
<span class="c">#                  &#39;linewidth&#39;:2,</span>
<span class="c">#                  &#39;nodelist&#39;:[]</span>
<span class="c">#                  }</span>
<span class="c">#        for key, value in defaults.items():</span>
<span class="c">#            if kwargs.has_key(key):</span>
<span class="c">#                setattr(self, key, kwargs[key])</span>
<span class="c">#            else:</span>
<span class="c">#                setattr(self, key, value)</span>
<span class="c">#                kwargs[key]=value</span>
<span class="c">#        if kwargs[&#39;fig&#39;]==[]:</span>
<span class="c">#            fig = plt.figure()</span>
<span class="c">#            fig.set_frameon(True)</span>
<span class="c">#        else:</span>
<span class="c">#            fig = kwargs[&#39;fig&#39;]</span>
<span class="c">#        if kwargs[&#39;ax&#39;]==[]:</span>
<span class="c">#            ax = fig.gca()</span>
<span class="c">#        else:</span>
<span class="c">#            ax = kwargs[&#39;ax&#39;]</span>
<span class="c">#</span>
<span class="c">#        if graph==&#39;t&#39;:</span>
<span class="c">#            G = self.Gt</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;r&#39;:</span>
<span class="c">#            G = self.Gr</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;s&#39;:</span>
<span class="c">#            G = self.Gs</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;v&#39;:</span>
<span class="c">#            G = self.Gv</span>
<span class="c">#            nx.draw(G,self.Gs.pos)</span>
<span class="c">#</span>
<span class="c">#        for k,ncy in enumerate(self.Gt.node.keys()):</span>
<span class="c">#            self.Gt.node[ncy][&#39;polyg&#39;].plot()</span>
<span class="c">#        ax.axis(&#39;scaled&#39;)</span>
<span class="c">#        # Display doors and windows</span>
<span class="c">#        d = self.subseg()</span>
<span class="c">#        for ss in d.keys():</span>
<span class="c">#            if ss==&#39;DOOR&#39;:</span>
<span class="c">#                color=&#39;red&#39;</span>
<span class="c">#            if ss==&#39;3D_WINDOW_GLASS&#39;:</span>
<span class="c">#                color=&#39;blue&#39;</span>
<span class="c">#            if ss==&#39;WINDOW_GLASS&#39;:</span>
<span class="c">#                color=&#39;cyan&#39;</span>
<span class="c">#            for ns in d[ss]:</span>
<span class="c">#                np1,np2 = self.Gs.neighbors(ns)</span>
<span class="c">#                x  = [self.Gs.pos[np1][0],self.Gs.pos[np2][0]]</span>
<span class="c">#                y  = [self.Gs.pos[np1][1],self.Gs.pos[np2][1]]</span>
<span class="c">#                ax.plot(x,y,linewidth=2,color=color)</span>
<span class="c">#        if kwargs[&#39;show&#39;]:</span>
<span class="c">#            plt.show()</span></div>
<div class="viewcode-block" id="Layout.showG"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showG.html#pylayers.gis.layout.Layout.showG">[docs]</a>    <span class="k">def</span> <span class="nf">showG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show graphs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        graph : char </span>
<span class="sd">            &#39;t&#39; : Gt</span>
<span class="sd">            &#39;r&#39; : Gr</span>
<span class="sd">            &#39;s&#39; : Gs</span>
<span class="sd">            &#39;v&#39; : Gv </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;eded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;ndnd&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;nded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;nodelist&#39;</span><span class="p">:</span> <span class="p">[]</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="c"># Display doors and windows</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="s">&#39;DOOR&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="s">&#39;3D_WINDOW_GLASS&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;blue&#39;</span>
            <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="s">&#39;WINDOW_GLASS&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;cyan&#39;</span>
            <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
                <span class="n">np1</span><span class="p">,</span> <span class="n">np2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.showGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showGv.html#pylayers.gis.layout.Layout.showGv">[docs]</a>    <span class="k">def</span> <span class="nf">showGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show graph Gv (visibility)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display</span>
<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        nodes    : boolean</span>
<span class="sd">            display nodes</span>
<span class="sd">        edges    : boolean</span>
<span class="sd">            display edges</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : figure instance</span>
<span class="sd">        ax  : axes instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">           :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.Layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">            &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">            &gt;&gt;&gt; L.buildGv()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax=L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; L.showGv(fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; plt.axis(&#39;off&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;eded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;ndnd&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;nded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">uneg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">upos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">upos</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">uneg</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">ndnd</span><span class="p">,</span> <span class="n">nded</span><span class="p">,</span> <span class="n">eded</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">edgetype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;eded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">eded</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ndnd&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">ndnd</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">nded</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.waypointGw"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.waypointGw.html#pylayers.gis.layout.Layout.waypointGw">[docs]</a>    <span class="k">def</span> <span class="nf">waypointGw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the waypoint between room1 and room2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            nroom1</span>
<span class="sd">            nroom2</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr(&#39;Lstruc.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">            &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">            &gt;&gt;&gt; L.buildGw()</span>
<span class="sd">            &gt;&gt;&gt; nroom1 = 1</span>
<span class="sd">            &gt;&gt;&gt; nroom2 = 6</span>
<span class="sd">            &gt;&gt;&gt; waypoint = L.waypointGw(nroom1,nroom2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rooms</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">)</span>
        <span class="k">return</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rooms</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.thwall"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.thwall.html#pylayers.gis.layout.Layout.thwall">[docs]</a>    <span class="k">def</span> <span class="nf">thwall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a list of wall tuples (Transit.world format )</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        offx</span>
<span class="sd">        offy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        walls : list of wall tuples  (Transit format)</span>
<span class="sd">        </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;sircut.str2&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.thwall(0,0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keyn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">walls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">keyn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span>
                <span class="n">pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nb</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;norm&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ss_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ss_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">thick</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s">&#39;lthick&#39;</span><span class="p">])</span>

                <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span> <span class="o">-</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span> <span class="o">-</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">wall</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p4</span><span class="p">))</span>
                <span class="c">#if ss_name!=&quot;WOOD&quot;:</span>
                <span class="k">if</span> <span class="n">ss_name</span> <span class="o">!=</span> <span class="s">&quot;DOOR&quot;</span><span class="p">:</span>
                    <span class="n">walls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wall</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">walls</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.pt2ro"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.pt2ro.html#pylayers.gis.layout.Layout.pt2ro">[docs]</a>    <span class="k">def</span> <span class="nf">pt2ro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
        <span class="sd">&quot;&quot;&quot; point to room</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pt : point (ndarray)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nr : Room number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            If a room contains point pt this function returns the room number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ptsh</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">ptsh</span><span class="p">):</span>
                <span class="k">return</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.buildGr"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGr.html#pylayers.gis.layout.Layout.buildGr">[docs]</a>    <span class="k">def</span> <span class="nf">buildGr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build Graph of room</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>
<span class="sd">            A room is a cycle with at least one door.</span>
<span class="sd">            This function requires graph Gt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Door</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="c">#ldoorseg    = np.array(d[&#39;WOOD&#39;])</span>
        <span class="n">ldoorseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;DOOR&#39;</span><span class="p">])</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#</span>
        <span class="c"># Pour tous les cycles</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">lseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">lseg</span><span class="p">,</span> <span class="n">ldoorseg</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># Si le cycle contient une porte, c&#39;est une piece</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">doors</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ku</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Door</span><span class="p">[</span><span class="n">ku</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Door</span><span class="p">[</span><span class="n">ku</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Door</span><span class="p">:</span>
            <span class="n">room1room2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Door</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="c">#print room1room2</span>
            <span class="c"># Une porte d&#39;entree separe une piece de l&#39;exterieur du</span>
            <span class="c"># batiment</span>
            <span class="c"># On pourra ulterieurement creer un noeud exterieur pour</span>
            <span class="c"># l&#39;inter indoor</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">room1room2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">room1room2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">room1room2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.waypoint"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.waypoint.html#pylayers.gis.layout.Layout.waypoint">[docs]</a>    <span class="k">def</span> <span class="nf">waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the waypoint between room1 and room2</span>
<span class="sd">        waypoint = L.waypoint(nroom1,nroom2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rooms</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">)</span>
        <span class="n">nroom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span>
        <span class="n">waypoint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nroom</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">room1</span> <span class="o">=</span> <span class="n">rooms</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">proom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">room1</span><span class="p">]</span>
            <span class="n">room2</span> <span class="o">=</span> <span class="n">rooms</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">doors1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room1</span><span class="p">][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
            <span class="n">doors2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room2</span><span class="p">][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
            <span class="n">doorId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">doors1</span><span class="p">,</span> <span class="n">doors2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#</span>
            <span class="c"># coord door</span>
            <span class="c">#</span>
            <span class="n">unode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">doorId</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">pdoor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">proom1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proom1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pdoor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdoor</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">proom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nroom2</span><span class="p">]</span>
        <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">proom2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proom2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">waypoint</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.interact"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.interact.html#pylayers.gis.layout.Layout.interact">[docs]</a>    <span class="k">def</span> <span class="nf">interact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; interact</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        point edition</span>

<span class="sd">            p create point</span>

<span class="sd">                lclic same x</span>
<span class="sd">                rclic same y</span>
<span class="sd">                cclic free point</span>

<span class="sd">        segment edition</span>

<span class="sd">            [0-f] - display one of the 16 first layers</span>
<span class="sd">            x : save structure</span>
<span class="sd">            o : toggle overlay</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">af</span> <span class="o">=</span> <span class="n">SelectL</span><span class="o">.</span><span class="n">SelectL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">OnClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">OnPress</span><span class="p">)</span>
        <span class="c">#fig.canvas.mpl_connect(&#39;button_press_event&#39;,af.OnClick)</span>
        <span class="c">#fig.canvas.mpl_connect(&#39;key_press_event&#39;,af.OnPress)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.info.html#pylayers.gis.layout.Layout.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives information about the Layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;filestr : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">print</span> <span class="s">&quot;filemat : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filemat</span>
        <span class="k">print</span> <span class="s">&quot;fileslab : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileslab</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;filegeom : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;geomfile (.off) has no been generated&quot;</span>

        <span class="k">print</span> <span class="s">&quot;number of Nodes :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nn</span>
        <span class="k">print</span> <span class="s">&quot;number of Segments :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span>
        <span class="k">print</span> <span class="s">&quot;number of Sub-Segments :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gs Nodes : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gs Edges : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gs graph&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gc Nodes : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gc Edges : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gc graph&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gt Nodes : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gt Edges : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;vnodes = L.Gt.node[Nc][&#39;vnodes&#39;] &quot;</span>
            <span class="k">print</span> <span class="s">&quot;poly = L.Gt.node[Nc][&#39;polyg&#39;] &quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gt graph&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gr Nodes    :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gr Edges    :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Nc  = L.Gr.node[nroom][&#39;cycles&#39;]  &quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gr graph&quot;</span>
</div>
<div class="viewcode-block" id="Layout.facets3D"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.facets3D.html#pylayers.gis.layout.Layout.facets3D">[docs]</a>    <span class="k">def</span> <span class="nf">facets3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Layer&#39;</span><span class="p">,</span> <span class="n">subseg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        facets3d(edlist,name)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">filestruc</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filestruc</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST{</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edlist</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet3D</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">subseg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;void&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="s">&#39;{&lt;&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.ispoint"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.ispoint.html#pylayers.gis.layout.Layout.ispoint">[docs]</a>    <span class="k">def</span> <span class="nf">ispoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.45</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ispoint(pt,tol) : verify if pt is a point of Layout</span>

<span class="sd">        if True the point number (numbered from 1) is return</span>
<span class="sd">        else -1 is return</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;ispoint : pt &quot;</span><span class="p">,</span> <span class="n">pt</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ke</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">nz</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nz</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">ke</span><span class="p">[</span><span class="n">nup</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.onseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.onseg.html#pylayers.gis.layout.Layout.onseg">[docs]</a>    <span class="k">def</span> <span class="nf">onseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        onseg(pt,tol)</span>

<span class="sd">        return the segment number which contains point pt</span>

<span class="sd">        pt  np.array(1x2)  it is a 2D point</span>
<span class="sd">        tol = 0.01      tolerance</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ke</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nbu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inbox</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

            <span class="n">ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

            <span class="n">nb</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

            <span class="c">#print ta</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[:,</span> <span class="n">ta</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="n">he</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span>

            <span class="n">nv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">nv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

            <span class="n">v1n</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">nv1</span>
            <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">nv2</span>

            <span class="n">ps</span> <span class="o">=</span> <span class="n">v1n</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v1n</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">ps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
            <span class="n">nbu</span> <span class="o">=</span> <span class="n">nb</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">nbu</span>
</div>
<div class="viewcode-block" id="Layout.facet3D"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.facet3D.html#pylayers.gis.layout.Layout.facet3D">[docs]</a>    <span class="k">def</span> <span class="nf">facet3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">subseg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; facet3D</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e</span>
<span class="sd">        subseg : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>

        <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>

        <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>

        <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">subseg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span>
                <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span>
                <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
                <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;no subsegment on &#39;</span><span class="p">,</span> <span class="n">e</span>
                <span class="k">return</span><span class="p">(</span><span class="s">&#39;void&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;fa&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.off&#39;</span>
        <span class="n">filestruc</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filestruc</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 0.4</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.geomfile"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.geomfile.html#pylayers.gis.layout.Layout.geomfile">[docs]</a>    <span class="k">def</span> <span class="nf">geomfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create a geomview file of the layout</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.geomfile()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ne</span>
        <span class="n">cen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span>

        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
<span class="c">#</span>
<span class="c">#        Creation d&#39;un plan pour chaque segment et chaque sous-segment</span>
<span class="c">#</span>
        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

        <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>

                <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
                <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmin&#39;</span><span class="p">]</span>

                <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
                <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>

                <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
                <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;zmax&#39;</span><span class="p">]</span>
                <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">subseg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">subseg</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print ik,n1,n2</span>

                <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span>
                <span class="c">#print P1[:,ik]</span>

                <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
                <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span>
                <span class="c">#print P2[:,ik]</span>

                <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
                <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
                <span class="c">#print P3[:,ik]</span>

                <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
                <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">]</span>
                <span class="c">#print P4[:,ik]</span>

                <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c">#        subseg = self.ce.keys()</span>
<span class="c">#        for j in range(cen):</span>
<span class="c">#            ie = subseg[j]</span>
<span class="c">#            t  = self.tahe[0,ie]</span>
<span class="c">#            h  = self.tahe[1,ie]</span>
<span class="c">#            k  = ii+j</span>
<span class="c">#</span>
<span class="c">#            P1[0:2,k]=self.Gs.pos[t]</span>
<span class="c">#            P1[2,k]=self.Gs.node[ie][&#39;zmin&#39;]</span>
<span class="c">#</span>
<span class="c">#            P2[0:2,k]=self.Gs.pos[h]</span>
<span class="c">#            P2[2,k]=self.Gs.node[ie][&#39;zmin&#39;]</span>
<span class="c">#</span>
<span class="c">#            P3[0:2,k]=self.Gs.pos[h]</span>
<span class="c">#            P3[2,k]=self.Gs.node[ie][&#39;zmax&#39;]</span>
<span class="c">#</span>
<span class="c">#            P4[0:2,k]=self.Gs.pos[t]</span>
<span class="c">#            P4[2,k]=self.Gs.node[ie][&#39;zmax&#39;]</span>
<span class="c">#</span>
        <span class="n">npt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">)</span>
        <span class="n">_filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">_filegeom</span> <span class="o">=</span> <span class="n">_filename</span><span class="o">+</span><span class="s">&#39;.off&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span><span class="o">=</span><span class="n">_filegeom</span>
        <span class="n">filegeom</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filegeom</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filegeom</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">):</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
<span class="c">#        ke   = cold.keys()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">en</span><span class="p">:</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nss</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">en</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">subseg</span><span class="p">[</span><span class="n">nss</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>

<span class="c">#            if (i&lt;en):</span>
<span class="c">#                name = self.name[i]</span>
<span class="c">#            else:</span>
<span class="c">#                core = self.ce[subseg[i-en]][0]</span>
<span class="c">#                name = sl.di[core]</span>
            <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 0.4</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show3.html#pylayers.gis.layout.Layout.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; geomview display of the indoor structure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            bdis</span>
<span class="sd">                boolean (default True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geomfile</span><span class="p">()</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
            <span class="c">#chaine = &quot;geomview -nopanel -b 1 1 1 &quot; + filename + &quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview  -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.signature"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.signature.html#pylayers.gis.layout.Layout.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iTx</span><span class="p">,</span> <span class="n">iRx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine signature between node iTx and node iRx</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pTx  : np.array (2, 1)</span>
<span class="sd">                ransmitter coordinates</span>
<span class="sd">        pRx  : np.array (2, 1)</span>
<span class="sd">                Receiver coordinates</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        sigarr    :</span>
<span class="sd">        signature :</span>


<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        This a temporary function</span>
<span class="sd">            There is some algorithmic work to find the best way to determine signature</span>
<span class="sd">            T4 : limit the ndt to only edges and nodes in visibility from Tx</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Here we take all the vnodes &gt;0  from the room</span>
        <span class="c">#</span>
        <span class="c"># Practically those list of nodes should depend on pTx , pRx</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iTx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">NroomTx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt2ro</span><span class="p">(</span><span class="n">iTx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iTx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">NroomTx</span> <span class="o">=</span> <span class="n">iTx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;iTx must be an array or a room number&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iRx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">NroomRx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt2ro</span><span class="p">(</span><span class="n">iRx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iRx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">NroomRx</span> <span class="o">=</span> <span class="n">iRx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;iRx must be an array or a room number&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">NroomTx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">NroomRx</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Tx or Rx is not in Gr&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># .. todo:: modifier inter afin de ne pas retenir les points non diffractants</span>
        <span class="c">#</span>
        <span class="n">ndt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NroomTx</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]][</span><span class="s">&#39;inter&#39;</span><span class="p">]</span>
        <span class="n">ndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NroomRx</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]][</span><span class="s">&#39;inter&#39;</span><span class="p">]</span>

        <span class="n">signature</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="n">ndt</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="n">ndr</span><span class="p">:</span>
                <span class="n">addpath</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">nr</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span>
                        <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                        <span class="c">#print &#39;no path between &#39;,nt,nr</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nt</span> <span class="o">!=</span> <span class="n">nr</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span>
                        <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                        <span class="c">#print &#39;no path between &#39;,nt,nr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">nt</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">addpath</span><span class="p">:</span>
                    <span class="n">signature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])))</span>
                    <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                        <span class="n">it</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])))</span>
                        <span class="k">elif</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">]])))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">sigarr</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.get_Sg_pos"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.get_Sg_pos.html#pylayers.gis.layout.Layout.get_Sg_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_Sg_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return position of the signatures</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">signature</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sposfull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">signature</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">spos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">signature</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">sposfull</span><span class="p">[</span><span class="n">iz</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">spos</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sposfull</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.showSig"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showSig.html#pylayers.gis.layout.Layout.showSig">[docs]</a>    <span class="k">def</span> <span class="nf">showSig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">Tx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Rx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Show signature</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Tx  : np.array (2,1)</span>
<span class="sd">                Transmitter coordinates</span>
<span class="sd">        Rx  : np.array (2,1)</span>
<span class="sd">                Receipter coordinates</span>
<span class="sd">        sr  : boolean</span>
<span class="sd">                show room signature</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig   : figure instance</span>
<span class="sd">        ax    : axes instance</span>
<span class="sd">        lines : lines instance</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Sg_pos</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sr</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)))</span>
            <span class="n">mask</span><span class="p">[:,</span> <span class="n">nz</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">))</span>
        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Tx</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">itx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">itx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="n">itx2</span><span class="p">]</span>
            <span class="n">tx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Tx</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Rx</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">irx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">irx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">irx</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="n">irx2</span><span class="p">]</span>
            <span class="n">rx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Rx</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
<span class="c">#        lines=[]</span>
<span class="c">#        for s in sig:</span>
<span class="c">#            l=[self.Gs.pos[s[ii]] for ii in xrange(len(s))]</span>
<span class="c">#            if Tx!=None and Rx!=None:</span>
<span class="c">#                l.insert(0,Tx)</span>
<span class="c">#                l.insert(-1,Rx)</span>
<span class="c">#            ls=sh.LineString(l)</span>
<span class="c">#            x,y=ls.xy</span>
<span class="c">#            lines.extend(ax.plot(x,y,&#39;k&#39;,lw=0.1,alpha=0.2))</span>
<span class="c">#        return (fig,ax,lines)</span>
</div>
<div class="viewcode-block" id="Layout.distwall"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.distwall.html#pylayers.gis.layout.Layout.distwall">[docs]</a>    <span class="k">def</span> <span class="nf">distwall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">nroom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate distance to wall</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            p</span>
<span class="sd">                point</span>
<span class="sd">            nroom</span>
<span class="sd">                room number of p</span>
<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">            dist</span>
<span class="sd">                list of distances to walls of room nroom</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">            Return  dist list which is a list of all the distances to the walls of the room</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">dist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p0_xy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p1_xy</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">Nc</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
        <span class="n">vnode</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">Nc</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">Gr</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])):</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">b_Gr</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">G1</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">G1</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">],</span> <span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]])</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">],</span> <span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">]])</span>
            <span class="n">p0_xy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
            <span class="n">p1_xy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

        <span class="n">pstartwll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0_xy</span><span class="p">)</span>
        <span class="n">pfinwll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1_xy</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">b_Gr</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])):</span>
            <span class="n">line_wall</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="n">pstartwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">pstartwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">pfinwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pfinwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])])</span>
            <span class="n">dist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line_wall</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">pp</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.randTxRx"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.randTxRx.html#pylayers.gis.layout.Layout.randTxRx">[docs]</a>    <span class="k">def</span> <span class="nf">randTxRx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns random coordinates for Tx and Rx.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        p_Tx : numpy.ndarray</span>
<span class="sd">             A point of the placement of the Tx</span>
<span class="sd">        p_Rx : numpy.ndarray</span>
<span class="sd">             A point of the placement of the Rx</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; p_Tx,p_Rx = L.randTxRx()</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            ex fn Tx_Rx_pos</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">()</span>

        <span class="n">Tx_x</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Tx_y</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">Rx_x</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Rx_y</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">p_Tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">])</span>
        <span class="n">p_Rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">p_Tx</span><span class="p">,</span> <span class="n">p_Rx</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.boundary"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.boundary.html#pylayers.gis.layout.Layout.boundary">[docs]</a>    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set a boundary around layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dx : float</span>
<span class="sd">            x offset (default 0)</span>
<span class="sd">        dy : float</span>
<span class="sd">            y offset (default 0 )</span>

<span class="sd">        self.ax is updated</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.boundary()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">-</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.loadGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadGv.html#pylayers.gis.layout.Layout.loadGv">[docs]</a>    <span class="k">def</span> <span class="nf">loadGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileGv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load Layout Gv file which contains Gv graph Values and reconstruct Gv graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _fileGv : str</span>
<span class="sd">        _fileGv is an *.Gv file, which contains all information about graph of visibility (Gv)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Gv_re : networkx.classes.graph.Graph</span>
<span class="sd">            The graph of visibility reconstructed</span>
<span class="sd">        pos : dict</span>
<span class="sd">            Explicitly set positions of the nodes</span>
<span class="sd">        labels : dict</span>
<span class="sd">            Node labels in a dictionary keyed by edge two-tuple of text labels</span>
<span class="sd">        (default=None), Only labels for the keys in the dictionary are drawn.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">         Extension of Gv file is lo (to be changed)</span>
<span class="sd">         Those file are placed in the layout directory</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; _fileGv = &#39;exemple.lo&#39;</span>
<span class="sd">        &gt;&gt;&gt; Gv_re,pos,labels=L.loadGv( _fileGv)</span>
<span class="sd">        &gt;&gt;&gt; assert Gv_re.nodes()[5]== 6,&#39;Mistake&#39;</span>
<span class="sd">        &gt;&gt;&gt; a=plt.title(&#39;Test Gv loadGv&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fig,ax = L.showGs()</span>
<span class="sd">        &gt;&gt;&gt; nx.draw(Gv_re,pos,node_color=&#39;r&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &gt;&gt;&gt; plt.clf()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gv_re</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">fileGv</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileGv</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fileGv</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">fileGv</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c"># reconstruct Gv from data</span>
            <span class="n">Gv_lab</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;lab&#39;</span><span class="p">]</span>
            <span class="n">pos_val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;p_val&#39;</span><span class="p">]</span>
            <span class="n">pos_keys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;p_keys&#39;</span><span class="p">]</span>
            <span class="n">Gv_edges</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span>
            <span class="n">Gv_nodes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;node&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos_keys</span><span class="p">)):</span>
                <span class="n">Gv_re</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Gv_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">pos</span><span class="p">[</span><span class="n">pos_keys</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pos_val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos_val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">labels</span><span class="p">[</span><span class="n">Gv_lab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Gv_lab</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Gv_edges</span><span class="p">)):</span>
                <span class="n">Gv_re</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">Gv_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Gv_edges</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Gv_re</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<span class="c">#    def GvF(self, _fileGv):</span>
<span class="c">#        &quot;&quot;&quot;build GvF graph</span>
<span class="c">#        </span>
<span class="c">#        GvF Graph of visibility between the walls and</span>
<span class="c">#        the furnitures of indoor environment.</span>
<span class="c">#</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        _fileGv : .lo file which contains graph of visibility (Gv).</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        GvF : networkx.classes.graph.Graph</span>
<span class="c">#            The graph of visibility between the walls and the furnitures(GvF).</span>
<span class="c">#        posF : dict</span>
<span class="c">#            Explicitly set positions of the nodes</span>
<span class="c">#        labelsF : dict</span>
<span class="c">#            Node labels in a dictionary keyed by edge two-tuple of text labels</span>
<span class="c">#            (default=None), Only labels for the keys in the dictionary are drawn.</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;tag.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; GvF,posF,labelsF=L.GvF(&#39;tag.lo&#39;)</span>
<span class="c">#        &gt;&gt;&gt; assert posF[-14][0]==8.5,&#39;Mistake&#39;</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        visik1, visik2 = self.visi_list_F()</span>
<span class="c">#        posF = {}</span>
<span class="c">#        labelsF = {}</span>
<span class="c">#        GF = nx.Graph()</span>
<span class="c">#        Gv_re, pos_re, labels_re = self.loadGv(_fileGv)</span>
<span class="c">#</span>
<span class="c">#        for i in range(len(visik1)):</span>
<span class="c">#            GF.add_node(visik1[i])</span>
<span class="c">#            posF[visik1[i]] = (self.Gs.pos[visik1[i]][0],</span>
<span class="c">#                self.Gs.pos[visik1[i]][1])</span>
<span class="c">#            labelsF[visik1[i]] = str(visik1[i])</span>
<span class="c">#            GF.add_node(visik2[i])</span>
<span class="c">#            posF[visik2[i]] = (self.Gs.pos[visik2[i]][0],</span>
<span class="c">#                self.Gs.pos[visik2[i]][1])</span>
<span class="c">#            labelsF[visik2[i]] = str(visik2[i])</span>
<span class="c">#            GF.add_edge(visik1[i], visik2[i])</span>
<span class="c">#</span>
<span class="c">#        posF.update(pos_re, **posF)</span>
<span class="c">#        labelsF.update(labels_re, **labelsF)</span>
<span class="c">#        GvF = nx.compose(Gv_re, GF)</span>
<span class="c">#nx.draw(GvF,posF)</span>
<span class="c">#L.showGs()</span>
<span class="c">#show()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">GvF</span><span class="p">,</span> <span class="n">posF</span><span class="p">,</span> <span class="n">labelsF</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.saveGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.saveGv.html#pylayers.gis.layout.Layout.saveGv">[docs]</a>    <span class="k">def</span> <span class="nf">saveGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileGv</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates Layout&#39;s Gv file which contains Gv graph values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _fileGv : str</span>
<span class="sd">        _fileGv is an *.lo file, in which saves all information about graph of</span>
<span class="sd">        visibility (Gv).</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># create lo file</span>
        <span class="n">fileGv</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileGv</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>

        <span class="c"># writing into lo file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fileGv</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">fileGv</span><span class="p">,</span> <span class="s">&#39;Warning fileGv already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">fileGv</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>
            <span class="n">data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lab</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_new</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                      <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv_new</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span>
                      <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv_new</span><span class="o">.</span><span class="n">edges</span><span class="p">(),</span>
                      <span class="n">p_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_new</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                      <span class="n">p_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pos_new</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">fileGv</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.savelay"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.savelay.html#pylayers.gis.layout.Layout.savelay">[docs]</a>    <span class="k">def</span> <span class="nf">savelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileGv</span><span class="p">,</span> <span class="n">_filelay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates Layout&#39;s lay file which contains graphs values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _fileGv : str</span>
<span class="sd">            _fileGv is an *.lo file, in which saves all information about graph of</span>
<span class="sd">        visibility (Gv).</span>
<span class="sd">        _filelay : str</span>
<span class="sd">            _fileGv is an *.lay file, in which all information about graphs of</span>
<span class="sd">        structure (Gs), topological (Gt), rooms (Gr) and visibility (Gv) saves.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.project import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; _fileGv  = &#39;exemple.lo&#39;</span>
<span class="sd">        &gt;&gt;&gt; _filelay = &#39;example.lay&#39;</span>
<span class="sd">        &gt;&gt;&gt; filelay= pyu.getlong(_filelay,pstruc[&#39;DIRSTRUC&#39;])</span>
<span class="sd">        &gt;&gt;&gt; assert os.path.isfile(filelay)==True,&#39;already exist&#39;</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Gv</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadGv</span><span class="p">(</span><span class="n">_fileGv</span><span class="p">)</span>

        <span class="n">filelay</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filelay</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filelay</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filelay</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filelay</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>
            <span class="n">data_Gs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">edges</span><span class="p">(),</span> <span class="n">p_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">p_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data_Gt</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">edges</span><span class="p">(),</span> <span class="n">p_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">p_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data_Gr</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">edges</span><span class="p">(),</span> <span class="n">p_val</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">p_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data_Gv</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">Gv</span><span class="o">.</span><span class="n">nodes</span><span class="p">(),</span> <span class="n">edges</span><span class="o">=</span><span class="n">Gv</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span>
                <span class="p">),</span> <span class="n">p_val</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">p_keys</span><span class="o">=</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data_graph</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Gs</span><span class="o">=</span><span class="n">data_Gs</span><span class="p">,</span> <span class="n">Gt</span><span class="o">=</span><span class="n">data_Gt</span><span class="p">,</span> <span class="n">Gr</span><span class="o">=</span><span class="n">data_Gr</span><span class="p">,</span> <span class="n">Gv</span><span class="o">=</span><span class="n">data_Gv</span><span class="p">)</span>
            <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_graph</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">filelay</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.loadlay"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadlay.html#pylayers.gis.layout.Layout.loadlay">[docs]</a>    <span class="k">def</span> <span class="nf">loadlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filelay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads Layout&#39;s lay file which contains graphs values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filelay : str</span>
<span class="sd">            _fileGv is an *.lay file, in which contains all information about graphs of</span>
<span class="sd">        structure (Gs), topological (Gt), rooms (Gr) and visibility (Gv).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_graph : dict</span>
<span class="sd">            A dictionary which contains all information about graphs Gs, Gt, Gr, Gv.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; _filelay = &#39;exemple.lay&#39;</span>
<span class="sd">        &gt;&gt;&gt; data_graph=L.loadlay(_filelay)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filelay</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filelay</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">data_graph</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filelay</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">data_graph</span><span class="p">)</span>

<span class="c">#    def poly_door(self, nnode):</span>
<span class="c">#        &quot;&quot;&quot;Creates a polygon with the space between a door.</span>
<span class="c">#</span>
<span class="c">#        Decides the position of the doors in indoor environment, than moves the</span>
<span class="c">#        door extremities points from the extremities d = 5cm and builds a polygon.</span>
<span class="c">#        The polygon includes the length of the doors thus a part of not allowed</span>
<span class="c">#        zone of rooms is also included in required part of the Allowed Zone.</span>
<span class="c">#</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        nnode : int</span>
<span class="c">#            The nnode number of a node of Gt graph.</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        describe : shapely.geometry.polygon.Polygon</span>
<span class="c">#            A polygon between a door.</span>
<span class="c">#</span>
<span class="c">#        References</span>
<span class="c">#        ----------</span>
<span class="c">#        http://gispython.org/shapely/docs/1.2/manual.html#object.buffer</span>
<span class="c">#</span>
<span class="c">#        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="c">#        dynamic wideband channel&quot; - Localization application, p 31, 2011.</span>
<span class="c">#</span>
<span class="c">#        .. image:: _static/AZ_2.png</span>
<span class="c">#            :width: 200</span>
<span class="c">#            :height: 200</span>
<span class="c">#            :scale: 60 %</span>
<span class="c">#            :alt: alternate text</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="c">#        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; nnode=0</span>
<span class="c">#        &gt;&gt;&gt; dilated=L.poly_door(nnode)</span>
<span class="c">#        &gt;&gt;&gt; assert dilated.area==0.78413712263648416,&#39;Mistake&#39;</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        nd = self.Gr.node[nnode][&#39;doors&#39;][0]</span>
<span class="c">#        n1, n2 = self.Gs.neighbors(nd)</span>
<span class="c">#        x1, y1 = self.Gs.pos[n1]</span>
<span class="c">#        x2, y2 = self.Gs.pos[n2]</span>
<span class="c">#        deltx = self.delta(x1, x2)</span>
<span class="c">#        delty = self.delta(y1, y2)</span>
<span class="c">#</span>
<span class="c">#        if deltx &gt; delty:</span>
<span class="c">#            x1, x2 = self.new_coor_d(x1, x2)</span>
<span class="c">#            y1 = y1</span>
<span class="c">#            y2 = y2</span>
<span class="c">#        if deltx &lt; delty:</span>
<span class="c">#            y1, y2 = self.new_coor_d(y1, y2)</span>
<span class="c">#            x1 = x1</span>
<span class="c">#            x2 = x2</span>
<span class="c">#</span>
<span class="c">#        line = sh.LineString([(x1, y1), (x2, y2)])</span>
<span class="c">#        dilated = line.buffer(0.5)</span>
<span class="c">#        return(dilated)</span>

<span class="c">#    def moby_allowed_zone(self):</span>
<span class="c">#        &quot;&quot;&quot;Defineds Allowed Mobility Zones for an entire indoor environment.</span>
<span class="c">#</span>
<span class="c">#        By adding the Allowed Mobility Zones in the rooms to the Allowed</span>
<span class="c">#        Mobility Zones within the doors, there is the complete required Allowed</span>
<span class="c">#        Mobility Zones within entire indoor environment.</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        describe : shapely.geometry.multipolygon.MultiPolygon</span>
<span class="c">#            Allowed Mobility Zones for an entire indoor environment</span>
<span class="c">#</span>
<span class="c">#        References</span>
<span class="c">#        ----------</span>
<span class="c">#        http://gispython.org/shapely/docs/1.2/manual.html#object.union</span>
<span class="c">#</span>
<span class="c">#        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="c">#        dynamic wideband channel&quot; - Localization application, p 31, 2011.</span>
<span class="c">#</span>
<span class="c">#        .. image:: _static/AZ_3.png</span>
<span class="c">#            :width: 200</span>
<span class="c">#            :height: 200</span>
<span class="c">#            :scale: 60 %</span>
<span class="c">#            :alt: alternate text</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="c">#        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; u=L.moby_allowed_zone()</span>
<span class="c">#        &gt;&gt;&gt; assert u.area== 39.799999999999997,&#39;Mistake&#39;</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        polygon1 = []</span>
<span class="c">#        dilated = []</span>
<span class="c">#        for i in range(len(self.Gt.node)):</span>
<span class="c">#            polygon1.append(self.polygon_delta(i))</span>
<span class="c">#</span>
<span class="c">#        for j in range(len(self.Gr.node)):</span>
<span class="c">#            dilated.append(self.poly_door(j))</span>
<span class="c">#</span>
<span class="c">#        polygons = polygon1 + dilated</span>
<span class="c">#        u = cascaded_union(polygons)</span>
<span class="c">#        return(u)</span>
</div>
<div class="viewcode-block" id="Layout.segs_cross"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.segs_cross.html#pylayers.gis.layout.Layout.segs_cross">[docs]</a>    <span class="k">def</span> <span class="nf">segs_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gives segment/subsegment numbers crossed by a line.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : shapely.geometry.linestring.LineString</span>
<span class="sd">            The line formed by the Tx and Rx coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        segs_cross : list</span>
<span class="sd">        Segment/subsegment numbers crossed by a line.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="sd">        dynamic wideband channel&quot; - Localization application, pp 44 - 45, 2011.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; _fileGv=&#39;exemple.lo&#39;</span>
<span class="sd">        &gt;&gt;&gt; p_Tx=np.array([2,0])</span>
<span class="sd">        &gt;&gt;&gt; p_Rx=np.array([7.5,0])</span>
<span class="sd">        &gt;&gt;&gt; Nc=10</span>
<span class="sd">        &gt;&gt;&gt; color_all=pyu.randcol(Nc)</span>
<span class="sd">        &gt;&gt;&gt; color=color_all[0]</span>
<span class="sd">        &gt;&gt;&gt; signature,num_seg_val=L.filtre_sign(p_Tx,p_Rx,_fileGv,color)</span>
<span class="sd">        &gt;&gt;&gt; kuku=num_seg_val[0]</span>
<span class="sd">        &gt;&gt;&gt; Tx_x,Tx_y = p_Tx</span>
<span class="sd">        &gt;&gt;&gt; Rx_x,Rx_y = p_Rx</span>
<span class="sd">        &gt;&gt;&gt; ptx=sh.Point(Tx_x, Tx_y)</span>
<span class="sd">        &gt;&gt;&gt; prx=sh.Point(Rx_x, Rx_y)</span>
<span class="sd">        &gt;&gt;&gt; Tx_im_x, Tx_im_y=L.image_M_Tx(p_Tx,kuku)</span>
<span class="sd">        &gt;&gt;&gt; line=sh.LineString([(Tx_im_x, Tx_im_y),(Rx_x, Rx_y)])</span>
<span class="sd">        &gt;&gt;&gt; p_int=L.cross_shortest(line)</span>
<span class="sd">        &gt;&gt;&gt; line1=sh.LineString([(Tx_x, Tx_y),(p_int[0].x,p_int[0].y),(Rx_x, Rx_y)])</span>
<span class="sd">        &gt;&gt;&gt; sign=L.segs_cross(line1)</span>
<span class="sd">        &gt;&gt;&gt; segs_cross=L.segs_cross(line)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">segs_cross</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="c">#+1 for coherancy with PyRay result</span>
                <span class="n">line_i</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">line_i</span><span class="p">):</span>
                    <span class="n">segs_cross</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">segs_cross</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.sign_cross"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.sign_cross.html#pylayers.gis.layout.Layout.sign_cross">[docs]</a>    <span class="k">def</span> <span class="nf">sign_cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pTx</span><span class="p">,</span> <span class="n">pRx</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">seg_num</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns some possible signatures which have at last one reflexion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pTx : numpy.ndarray</span>
<span class="sd">            The point of the placement of the Tx</span>
<span class="sd">        pRx : numpy.ndarray</span>
<span class="sd">            The point of the placement of the Rx</span>
<span class="sd">        pt : numpy.ndarray</span>
<span class="sd">            The point of the placement of a Reflection</span>
<span class="sd">        seg_num : list</span>
<span class="sd">            Segment/subsegment numbers crossed by a line formed by Tx and Rx coordinates.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sign : list</span>
<span class="sd">            Some possible signature at last with one reflexion.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Need to be developed more.</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="sd">                dynamic wideband channel&quot; - Localization application, p 45, 2011.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; _fileGv=&#39;exemple.lo&#39;</span>
<span class="sd">        &gt;&gt;&gt; pTx=np.array([2,0])</span>
<span class="sd">        &gt;&gt;&gt; pRx=np.array([7.5,0])</span>
<span class="sd">        &gt;&gt;&gt; p_Tx=pTx</span>
<span class="sd">        &gt;&gt;&gt; p_Rx=pRx</span>
<span class="sd">        &gt;&gt;&gt; Nc=10</span>
<span class="sd">        &gt;&gt;&gt; color_all=pyu.randcol(Nc)</span>
<span class="sd">        &gt;&gt;&gt; color=color_all[0]</span>
<span class="sd">        &gt;&gt;&gt; signature,num_seg_val=L.filtre_sign(p_Tx,p_Rx,_fileGv,color)</span>
<span class="sd">        &gt;&gt;&gt; kuku=num_seg_val[0]</span>
<span class="sd">        &gt;&gt;&gt; Tx_x,Tx_y = p_Tx</span>
<span class="sd">        &gt;&gt;&gt; Rx_x,Rx_y = p_Rx</span>
<span class="sd">        &gt;&gt;&gt; ptx=sh.Point(Tx_x, Tx_y)</span>
<span class="sd">        &gt;&gt;&gt; prx=sh.Point(Rx_x, Rx_y)</span>
<span class="sd">        &gt;&gt;&gt; Tx_im_x, Tx_im_y=L.image_M_Tx(p_Tx,kuku)</span>
<span class="sd">        &gt;&gt;&gt; line=sh.LineString([(Tx_im_x, Tx_im_y),(Rx_x, Rx_y)])</span>
<span class="sd">        &gt;&gt;&gt; p_int=L.cross_shortest(line)</span>
<span class="sd">        &gt;&gt;&gt; pt=p_int[0]</span>
<span class="sd">        &gt;&gt;&gt; line1=sh.LineString([(Tx_x, Tx_y),(pt.x,pt.y),(Rx_x, Rx_y)])</span>
<span class="sd">        &gt;&gt;&gt; sign=L.segs_cross(line1)</span>
<span class="sd">        &gt;&gt;&gt; segs_cross=L.segs_cross(line)</span>
<span class="sd">        &gt;&gt;&gt; seg_num=segs_cross[0]</span>
<span class="sd">        &gt;&gt;&gt; sign=L.sign_cross(pTx,pRx, pt,seg_num)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span> <span class="o">=</span> <span class="n">pTx</span>
        <span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span> <span class="o">=</span> <span class="n">pRx</span>

        <span class="n">px</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">x</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span>

        <span class="n">line_Tx_p</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">),</span> <span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">)])</span>
        <span class="n">line_Rx_p</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">),</span> <span class="p">(</span><span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">)])</span>
        <span class="n">segs_Tx_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segs_cross</span><span class="p">(</span><span class="n">line_Tx_p</span><span class="p">)</span>
        <span class="n">segs_Rx_p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segs_cross</span><span class="p">(</span><span class="n">line_Rx_p</span><span class="p">)</span>
        <span class="n">dist_Tx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dist_Rx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segs_Tx_p</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span>
                <span class="n">segs_Tx_p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">segs_Tx_p</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">dist_Tx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">distTx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist_Tx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segs_Rx_p</span><span class="p">)):</span>
            <span class="n">la</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">segs_Rx_p</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span>
                <span class="n">segs_Rx_p</span><span class="p">[</span><span class="n">j</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">))</span>
            <span class="n">dist_Rx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">la</span><span class="p">)</span>
        <span class="n">distRx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dist_Rx</span><span class="p">)</span>
        <span class="c">#sign.append(0) # Modif 28/10/11</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segs_Tx_p</span><span class="p">)):</span>
            <span class="n">sign</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segs_Tx_p</span><span class="p">[</span><span class="n">distTx</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span>
        <span class="c">#sign.append(segs_cross[0]) # Modif 28/10/11</span>
        <span class="n">sign</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg_num</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segs_Rx_p</span><span class="p">)):</span>
            <span class="n">sign</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segs_Rx_p</span><span class="p">[</span><span class="n">distRx</span><span class="p">[</span><span class="n">h</span><span class="p">]])</span>
        <span class="c">#sign.append(0)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sign</span><span class="p">)</span>

<span class="c">#    def cross_shortest(self, line):</span>
<span class="c">#        &quot;&quot;&quot;Returns all points crossed by the line.</span>
<span class="c">#</span>
<span class="c">#        Returns all points crossed by the line which cross the shortest ray</span>
<span class="c">#        in the middle of the shortest ray and they form an angle of 90 degree.</span>
<span class="c">#</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        line : shapely.geometry.linestring.LineString</span>
<span class="c">#            A line which forms an angle of 90 degree with the line formed by</span>
<span class="c">#        the Tx and Rx coordinates.</span>
<span class="c">#</span>
<span class="c">#        Raises</span>
<span class="c">#        ------</span>
<span class="c">#        Need to be developed more.</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        p_int : type</span>
<span class="c">#            Points crossed by the line</span>
<span class="c">#</span>
<span class="c">#        References</span>
<span class="c">#        ----------</span>
<span class="c">#        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="c">#        dynamic wideband channel&quot; - Localization application, p 45, 2011.</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="c">#        &gt;&gt;&gt; ncoin,ndiff = L.buildGc()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; _fileGv=&#39;exemple.lo&#39;</span>
<span class="c">#        &gt;&gt;&gt; p_Tx=np.array([2,0])</span>
<span class="c">#        &gt;&gt;&gt; p_Rx=np.array([7.5,0])</span>
<span class="c">#        &gt;&gt;&gt; Nc=10</span>
<span class="c">#        &gt;&gt;&gt; color_all=pyu.randcol(Nc)</span>
<span class="c">#        &gt;&gt;&gt; color=color_all[0]</span>
<span class="c">#        &gt;&gt;&gt; signature,num_seg_val=L.filtre_sign(p_Tx,p_Rx,_fileGv,color)</span>
<span class="c">#        &gt;&gt;&gt; kuku = num_seg_val[0]</span>
<span class="c">#        &gt;&gt;&gt; Tx_x,Tx_y = p_Tx</span>
<span class="c">#        &gt;&gt;&gt; Rx_x,Rx_y = p_Rx</span>
<span class="c">#        &gt;&gt;&gt; ptx=sh.Point(Tx_x, Tx_y)</span>
<span class="c">#        &gt;&gt;&gt; prx=sh.Point(Rx_x, Rx_y)</span>
<span class="c">#        &gt;&gt;&gt; Tx_im_x, Tx_im_y=L.image_M_Tx(p_Tx,kuku)</span>
<span class="c">#        &gt;&gt;&gt; line=sh.LineString([(Tx_im_x, Tx_im_y),(Rx_x, Rx_y)])</span>
<span class="c">#        &gt;&gt;&gt; p_int=L.cross_shortest(line)</span>
<span class="c">#        &gt;&gt;&gt; line1=sh.LineString([(Tx_x, Tx_y),(p_int[0].x,p_int[0].y),(Rx_x, Rx_y)])</span>
<span class="c">#        &gt;&gt;&gt; sign=L.segs_cross(line1)</span>
<span class="c">#        &gt;&gt;&gt; p_int=L.cross_shortest(line1)</span>
<span class="c">#        &gt;&gt;&gt; assert p_int[0].x== 4.75,&#39;Mistake&#39;</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        segs_cross = self.segs_cross(line)</span>
<span class="c">#</span>
<span class="c">#        p_int = []</span>
<span class="c">#        for k in range(len(segs_cross)):</span>
<span class="c">#            n1, n2 = self.Gs.neighbors(segs_cross[k])</span>
<span class="c">#            line_k = sh.LineString([(self.Gs.pos[n1][0], self.Gs.pos[n1]</span>
<span class="c">#                [1]), (self.Gs.pos[n2][0], self.Gs.pos[n2][1])])</span>
<span class="c">#            p_int.append(line.intersection(line_k))</span>
<span class="c">#</span>
<span class="c">#        return(p_int)</span>
</div>
<div class="viewcode-block" id="Layout.plot_sign2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.plot_sign2.html#pylayers.gis.layout.Layout.plot_sign2">[docs]</a>    <span class="k">def</span> <span class="nf">plot_sign2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_Tx</span><span class="p">,</span> <span class="n">p_Rx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Displays a lot of possible signatures.</span>

<span class="sd">        Displays a lot of possible signatures but not all.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p_Tx : numpy.ndarray</span>
<span class="sd">            The point of the placement of the Tx</span>
<span class="sd">        p_Rx : numpy.ndarray</span>
<span class="sd">            The point of the placement of the Rx</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        ..  [1] Report &quot;Simulation based on ray tracing for the modeling of</span>
<span class="sd">        dynamic wideband channel&quot; - Localization application, pp 44 - 45, 2011.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; p_Tx=np.array([2,0])</span>
<span class="sd">        &gt;&gt;&gt; p_Rx=np.array([7.5,0])</span>
<span class="sd">        &gt;&gt;&gt; Nc=10</span>
<span class="sd">        &gt;&gt;&gt; color_all=pyu.randcol(Nc)</span>
<span class="sd">        &gt;&gt;&gt; color=color_all[0]</span>
<span class="sd">        &gt;&gt;&gt; L.plot_sign2(p_Tx,p_Rx)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Nc</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">color_all</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">randcol</span><span class="p">(</span><span class="n">Nc</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color_all</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span> <span class="o">=</span> <span class="n">p_Tx</span>
        <span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span> <span class="o">=</span> <span class="n">p_Rx</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Rx_x</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Rx_x</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Tx_y</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Tx_y</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">)</span>
        <span class="n">seg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">line_sh</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">),</span> <span class="p">(</span><span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seg</span><span class="p">)):</span>
            <span class="n">p0_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">seg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">),</span> <span class="p">(</span><span class="n">p0_i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p0_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">)])</span>
            <span class="n">geu</span><span class="o">.</span><span class="n">plot_coords3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">geu</span><span class="o">.</span><span class="n">plot_bounds3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">geu</span><span class="o">.</span><span class="n">plot_line3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.points_image"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.points_image.html#pylayers.gis.layout.Layout.points_image">[docs]</a>    <span class="k">def</span> <span class="nf">points_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p_Tx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns all image points of the bases</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         p_Tx : numpy.ndarray</span>
<span class="sd">             A point of the placement of the Tx</span>

<span class="sd">         Returns</span>
<span class="sd">         -------</span>
<span class="sd">         Tx_im : list</span>
<span class="sd">              A list of tuples: containing the coordinates of image points.</span>
<span class="sd">         nodes_posi : list</span>
<span class="sd">              A list of positive numbers of the graph structure.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; p_Tx=np.array([2,0])</span>
<span class="sd">        &gt;&gt;&gt; Tx_im,nodes_posi=L.points_image(p_Tx)</span>
<span class="sd">        &gt;&gt;&gt; assert Tx_im[0][0]==2,&#39;Mistake&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nodes_posi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes_posi</span><span class="p">()</span>
        <span class="n">Tx_im</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes_posi</span><span class="p">)):</span>
            <span class="n">num_seg</span> <span class="o">=</span> <span class="n">nodes_posi</span><span class="p">[</span><span class="n">mk</span><span class="p">]</span>
            <span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span> <span class="o">=</span> <span class="n">p_Tx</span>
            <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">num_seg</span><span class="p">)</span>
            <span class="n">pa_x</span><span class="p">,</span> <span class="n">pa_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
            <span class="n">pb_x</span><span class="p">,</span> <span class="n">pb_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span>
            <span class="n">delx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pa_x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pb_x</span><span class="p">))</span>
            <span class="n">dely</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">pa_y</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pb_y</span><span class="p">))</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">)</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">pa_x</span><span class="p">,</span> <span class="n">pa_y</span><span class="p">),</span> <span class="p">(</span><span class="n">pb_x</span><span class="p">,</span> <span class="n">pb_y</span><span class="p">)]))</span>
            <span class="k">if</span> <span class="n">delx</span> <span class="o">&lt;=</span> <span class="n">dely</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">pa_x</span><span class="p">,</span> <span class="n">pb_x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Tx_x</span><span class="p">:</span>
                    <span class="n">Tx_x_im</span> <span class="o">=</span> <span class="n">Tx_x</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Tx_x_im</span> <span class="o">=</span> <span class="n">Tx_x</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span>
                <span class="n">Tx_y_im</span> <span class="o">=</span> <span class="n">Tx_y</span>
                <span class="n">Tx_im</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Tx_x_im</span><span class="p">,</span> <span class="n">Tx_y_im</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">delx</span> <span class="o">&gt;</span> <span class="n">dely</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">pa_y</span><span class="p">,</span> <span class="n">pb_y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Tx_y</span><span class="p">:</span>
                    <span class="n">Tx_y_im</span> <span class="o">=</span> <span class="n">Tx_y</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Tx_y_im</span> <span class="o">=</span> <span class="n">Tx_y</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">dist</span>
                <span class="n">Tx_x_im</span> <span class="o">=</span> <span class="n">Tx_x</span>
                <span class="n">Tx_im</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Tx_x_im</span><span class="p">,</span> <span class="n">Tx_y_im</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Tx_im</span><span class="p">,</span> <span class="n">nodes_posi</span><span class="p">)</span>

<span class="c">#    def filtre_sign(self, p_Tx, p_Rx, _filelo, color):</span>
<span class="c">#        &quot;&quot;&quot;Filtering and validating of signatures.</span>
<span class="c">#</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        p_Tx : numpy.ndarray</span>
<span class="c">#            Tx coordinates</span>
<span class="c">#        p_Rx : numpy.ndarray</span>
<span class="c">#            Rx coordinates</span>
<span class="c">#        _filelo : str</span>
<span class="c">#            The str file, which contains the graph of visibility.</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        signature : list</span>
<span class="c">#                A list which contains found signatures</span>
<span class="c">#        num_seg_val : list</span>
<span class="c">#                The wall numbers the ray has the first interaction with</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L=Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;,&#39;def.mat&#39;,&#39;def.slab&#39;)</span>
<span class="c">#        &gt;&gt;&gt; ncoin,ndiff=L.buildGc()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; Nc=10</span>
<span class="c">#        &gt;&gt;&gt; color_all = pyu.randcol(Nc)</span>
<span class="c">#        &gt;&gt;&gt; color = color_all[0]</span>
<span class="c">#        &gt;&gt;&gt; p_Tx  = np.array([2,0])</span>
<span class="c">#        &gt;&gt;&gt; p_Rx  = np.array([7.5,0])</span>
<span class="c">#        &gt;&gt;&gt; _filelo = &#39;exemple.lo&#39;</span>
<span class="c">#        &gt;&gt;&gt; signature,num_seg_val=L.filtre_sign(p_Tx,p_Rx,_filelo,color)</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        Nc = 10</span>
<span class="c">#        color_all = pyu.randcol(Nc)</span>
<span class="c">#        color = color_all[0]</span>
<span class="c">#</span>
<span class="c">#        Gsnodes = self.Gs.nodes()</span>
<span class="c">#        nodes_posi = []</span>
<span class="c">#        for i in range(len(Gsnodes)):</span>
<span class="c">#            if Gsnodes[i] &gt;= 0:</span>
<span class="c">#                nodes_posi.append(Gsnodes[i])</span>
<span class="c">#            else:</span>
<span class="c">#                pass</span>
<span class="c">#        all_sign = []  # validation of signachure</span>
<span class="c">#        signature = []  # correct siractures</span>
<span class="c">#        num_seg_val = []  # validated first interaction</span>
<span class="c">#        for i in range(len(nodes_posi)):</span>
<span class="c">#            num_seg = nodes_posi[i]</span>
<span class="c">#            sign = self.find_more_sign(p_Tx, p_Rx, num_seg, color)</span>
<span class="c">#            all_sign.append(sign)</span>
<span class="c">#        for i in range(len(all_sign)):</span>
<span class="c">#            if all_sign[i] != 0:</span>
<span class="c">#                signature.append(all_sign[i])</span>
<span class="c">#                num_seg_val.append(nodes_posi[i])</span>
<span class="c">#            else:</span>
<span class="c">#                pass</span>
<span class="c">#</span>
<span class="c">#        return(signature, num_seg_val)</span>

<span class="c">#    def image_M_Tx(self, p_Tx, num_seg):</span>
<span class="c">#        &quot;&quot;&quot;Calculation of point image.</span>
<span class="c">#</span>
<span class="c">#        Calculates point image for a segment situated between a transmitter and a receiver.</span>
<span class="c">#</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        p_Tx : numpy.ndarray</span>
<span class="c">#            The point of the placement of the Tx.</span>
<span class="c">#        num_seg : int</span>
<span class="c">#            The the segment number by which relationship the image point is built.</span>
<span class="c">#</span>
<span class="c">#        Returns</span>
<span class="c">#        -------</span>
<span class="c">#        Tx_im : tuples</span>
<span class="c">#            The coordinates of images point of the Tx calculated for a segment.</span>
<span class="c">#</span>
<span class="c">#        Examples</span>
<span class="c">#        --------</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="c">#        &gt;&gt;&gt; ndiff,ncoin = L.buildGc()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGt()</span>
<span class="c">#        &gt;&gt;&gt; L.buildGr()</span>
<span class="c">#        &gt;&gt;&gt; _filelo=&#39;exemple.lo&#39;</span>
<span class="c">#        &gt;&gt;&gt; p_Tx=np.array([2,0])</span>
<span class="c">#        &gt;&gt;&gt; p_Rx=np.array([7.5,0])</span>
<span class="c">#        &gt;&gt;&gt; Nc=10</span>
<span class="c">#        &gt;&gt;&gt; color_all=pyu.randcol(Nc)</span>
<span class="c">#        &gt;&gt;&gt; color=color_all[0]</span>
<span class="c">#        &gt;&gt;&gt; signature,num_seg_val=L.filtre_sign(p_Tx,p_Rx,_filelo,color)</span>
<span class="c">#        &gt;&gt;&gt; Tx_im=L.image_M_Tx( p_Tx,num_seg_val[0])</span>
<span class="c">#</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#        Tx_im = []</span>
<span class="c">#        Tx_x, Tx_y = p_Tx</span>
<span class="c">#        n1, n2 = self.Gs.neighbors(num_seg)</span>
<span class="c">#        pa_x, pa_y = self.Gs.pos[n1]</span>
<span class="c">#        pb_x, pb_y = self.Gs.pos[n2]</span>
<span class="c">#        a1 = np.sqrt((Tx_x - pa_x) ** 2 + (Tx_y - pa_y) ** 2)</span>
<span class="c">#        a2 = np.sqrt((pb_x - Tx_x) ** 2 + (pb_y - Tx_y) ** 2)</span>
<span class="c">#        seg_line = sh.LineString([(pa_x, pa_y), (pb_x, pb_y)])</span>
<span class="c">#        m1 = 2 * (pa_x - pb_x)</span>
<span class="c">#        m2 = a2 ** 2 - a1 ** 2 + pa_x ** 2 - pb_x ** 2 + pa_y ** 2 - pb_y ** 2</span>
<span class="c">#        m3 = 2 * (pb_y - pa_y)</span>
<span class="c">#        #x=(m2/m1+m3*y/m1)</span>
<span class="c">#        k1 = m2 / (1. * m1)</span>
<span class="c">#        k2 = m3 / (1. * m1)</span>
<span class="c">#        #x=k1+k2*y</span>
<span class="c">#        f1 = 1 + k2 ** 2</span>
<span class="c">#        f2 = 2 * (k1 * k2 - k2 * pb_x - pb_y)</span>
<span class="c">#        f3 = k1 ** 2 - a2 ** 2 - 2 * k1 * pb_x + pb_x ** 2 + pb_y ** 2</span>
<span class="c">#        #f1*y**2+f2*y+f3=0</span>
<span class="c">#        b = f2 / (1. * f1)</span>
<span class="c">#        ck = f3 / (1. * f1)</span>
<span class="c">#        #y**2+b*y+c=0</span>
<span class="c">#        di = b ** 2 - 4 * ck</span>
<span class="c">#        delx = pb_x - pa_x</span>
<span class="c">#        dely = pb_y - pa_y</span>
<span class="c">#        if delx &gt; dely:</span>
<span class="c">#            y = (-b + np.sqrt(di)) / 2</span>
<span class="c">#            x = k1 + k2 * y</span>
<span class="c">#        else:</span>
<span class="c">#            y = (-b - np.sqrt(di)) / 2</span>
<span class="c">#            x = k1 + k2 * y</span>
<span class="c">#        Tx_im.append((x, y))</span>
<span class="c">#</span>
<span class="c">#        return(Tx_im[0])</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../gis.html" >pylayers.gis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Bernard Uguen,Mohamedh Laaraiedh,Nicolas Amiot.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>