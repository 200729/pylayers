<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.signal.bsignal &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.signal.bsignal</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c">#-*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. currentmodule:: pylayers.signal.bsignal</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated</span>

<span class="sd">Bsignal Class</span>
<span class="sd">=============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Bsignal.__init__</span>
<span class="sd">    Bsignal.__repr__</span>
<span class="sd">    Bsignal.extract</span>
<span class="sd">    Bsignal.save</span>
<span class="sd">    Bsignal.load</span>
<span class="sd">    Bsignal.setx</span>
<span class="sd">    Bsignal.sety</span>
<span class="sd">    Bsignal.stem</span>
<span class="sd">    Bsignal.step</span>
<span class="sd">    Bsignal.cformat</span>
<span class="sd">    Bsignal.imshow</span>
<span class="sd">    Bsignal.plot</span>
<span class="sd">    Bsignal.flatteny</span>
<span class="sd">    Bsignal.gating</span>
<span class="sd">    Bsignal.len</span>

<span class="sd">Usignal Class</span>
<span class="sd">=============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Usignal.__init__</span>
<span class="sd">    Usignal.__repr__</span>
<span class="sd">    Usignal.__add__</span>
<span class="sd">    Usignal.__sub__</span>
<span class="sd">    Usignal.__mul__</span>
<span class="sd">    Usignal.setx</span>
<span class="sd">    Usignal.dx</span>
<span class="sd">    Usignal.width</span>
<span class="sd">    Usignal.expand</span>
<span class="sd">    Usignal.max</span>
<span class="sd">    Usignal.min</span>
<span class="sd">    Usignal.truncate</span>
<span class="sd">    Usignal.align</span>
<span class="sd">    Usignal.abs</span>
<span class="sd">    Usignal.eprfl</span>
<span class="sd">    Usignal.energy</span>
<span class="sd">    Usignal.fftshift</span>
<span class="sd">    Usignal.zright</span>
<span class="sd">    Usignal.zleft</span>
<span class="sd">    Usignal.zlr</span>

<span class="sd">TBsignal Class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TBsignal.__init__</span>
<span class="sd">    TBsignal.__repr__</span>
<span class="sd">    TBsignal.plot</span>
<span class="sd">    TBsignal.translate</span>
<span class="sd">    TBsignal.b2u</span>

<span class="sd">TUsignal Class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.__init__</span>
<span class="sd">    TUsignal.__repr__</span>
<span class="sd">    TUsignal.diff</span>
<span class="sd">    TUsignal.info</span>

<span class="sd">Fourier Functions</span>
<span class="sd">-----------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.ft</span>
<span class="sd">    TUsignal.fft</span>
<span class="sd">    TUsignal.fftsh</span>
<span class="sd">    TUsignal.ftshift</span>
<span class="sd">    TUsignal.psd</span>
<span class="sd">    TUsignal.Yadd_zeros2l</span>
<span class="sd">    TUsignal.Yadd_zeros2r</span>
<span class="sd">    TUsignal.esd</span>

<span class="sd">CIR Functions</span>
<span class="sd">-------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.aggcir</span>
<span class="sd">    TUsignal.ecdf</span>
<span class="sd">    TUsignal.taumax</span>
<span class="sd">    TUsignal.tau_moy</span>
<span class="sd">    TUsignal.delays</span>
<span class="sd">    TUsignal.tau_rms</span>

<span class="sd">Visualization Functions</span>
<span class="sd">-----------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.show</span>
<span class="sd">    TUsignal.shift</span>
<span class="sd">    TUsignal.filter</span>
<span class="sd">    TUsignal.correlate</span>
<span class="sd">    TUsignal.corrgauss</span>
<span class="sd">    TUsignal.resample</span>
<span class="sd">    TUsignal.convolve</span>

<span class="sd">Energy Functions</span>
<span class="sd">----------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.Epercent</span>
<span class="sd">    TUsignal.Etau0</span>
<span class="sd">    TUsignal.Ewin</span>
<span class="sd">    TUsignal.Etot</span>
<span class="sd">    TUsignal.Efirst</span>
<span class="sd">    TUsignal.Efirst_loc</span>
<span class="sd">    TUsignal.Efirst_corr</span>
<span class="sd">    TUsignal.Efirst_toath</span>
<span class="sd">    TUsignal.Emax</span>

<span class="sd">TOA Estimation Functions</span>
<span class="sd">------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.tau_Emax</span>
<span class="sd">    TUsignal.toa_max2</span>
<span class="sd">    TUsignal.toa_new</span>
<span class="sd">    TUsignal.toa_win</span>
<span class="sd">    TUsignal.toa_max</span>
<span class="sd">    TUsignal.toa_th</span>
<span class="sd">    TUsignal.toa_cum</span>
<span class="sd">    TUsignal.toa_th_tmtm</span>
<span class="sd">    TUsignal.toa_th_tm</span>
<span class="sd">    TUsignal.toa_th_tmt</span>
<span class="sd">    TUsignal.toa_cum_tm</span>
<span class="sd">    TUsignal.toa_cum_tmtm</span>
<span class="sd">    TUsignal.toa_cum_tmt</span>

<span class="sd">Input Output Functions</span>
<span class="sd">-----------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUsignal.readcir</span>
<span class="sd">    TUsignal.readuwb</span>

<span class="sd">TUDsignal Class</span>
<span class="sd">===============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    TUDsignal.__init__</span>
<span class="sd">    TUDsignal.__repr__</span>
<span class="sd">    TUDsignal.fig</span>

<span class="sd">FBsignal Class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    FBsignal.__init__</span>
<span class="sd">    FBsignal.__repr__</span>
<span class="sd">    FBsignal.plotri</span>
<span class="sd">    FBsignal.plot</span>
<span class="sd">    FBsignal.plotdB</span>
<span class="sd">    FBsignal.stem</span>

<span class="sd">FUsignal Class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    FUsignal.__init__</span>
<span class="sd">    FUsignal.__repr__</span>
<span class="sd">    FUsignal.__add__</span>
<span class="sd">    FUsignal.__sub__</span>
<span class="sd">    FUsignal.__mul__</span>
<span class="sd">    FUsignal.__div__</span>
<span class="sd">    FUsignal.window</span>
<span class="sd">    FUsignal.get</span>
<span class="sd">    FUsignal.info</span>
<span class="sd">    FUsignal.energy</span>
<span class="sd">    FUsignal.applyFriis</span>
<span class="sd">    FUsignal.enthrsh</span>
<span class="sd">    FUsignal.dBthrsh</span>
<span class="sd">    FUsignal.zp</span>
<span class="sd">    FUsignal.newdf</span>
<span class="sd">    FUsignal.dftresamp</span>
<span class="sd">    FUsignal.resample</span>
<span class="sd">    FUsignal.symH</span>
<span class="sd">    FUsignal.symHz</span>
<span class="sd">    FUsignal.align</span>
<span class="sd">    FUsignal.ifft</span>
<span class="sd">    FUsignal.ift</span>
<span class="sd">    FUsignal.iftshift</span>
<span class="sd">    FUsignal.show</span>
<span class="sd">    FUsignal.decimate</span>
<span class="sd">    FUsignal.tap</span>

<span class="sd">FUDsignal Class</span>
<span class="sd">===============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    FUDsignal.__init__</span>
<span class="sd">    FUDsignal.__repr__</span>
<span class="sd">    FUDsignal.minphas</span>
<span class="sd">    FUDsignal.totud</span>
<span class="sd">    FUDsignal.iftd</span>
<span class="sd">    FUDsignal.ft1</span>
<span class="sd">    FUDsignal.ftau</span>
<span class="sd">    FUDsignal.cir</span>
<span class="sd">    FUDsignal.plot3d</span>
<span class="sd">    FUDsignal.ft2</span>


<span class="sd">FUDAsignal Class</span>
<span class="sd">===============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    FUDAsignal.__init__</span>
<span class="sd">    FUDAsignal.__repr__</span>
<span class="sd">    FUDAsignal.cut</span>
<span class="sd">    FUDAsignal.sort</span>
<span class="sd">    FUDAsignal.showtap</span>
<span class="sd">    FUDAsignal.tap</span>

<span class="sd">FHsignal Class</span>
<span class="sd">================</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    FHsignal.__init__</span>
<span class="sd">    FHsignal.__repr__</span>
<span class="sd">    FHsignal.__mul__</span>
<span class="sd">    FHsignal.ifft</span>
<span class="sd">    FHsignal.unrex</span>

<span class="sd">Noise Class</span>
<span class="sd">===========</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Noise.__init__</span>
<span class="sd">    Noise.amplify</span>
<span class="sd">    Noise.gating</span>

<span class="sd">EnImpulse Class</span>
<span class="sd">===============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    EnImpulse.__init__</span>
<span class="sd">    EnImpulse.demo</span>

<span class="sd">MaskImpulse Class</span>
<span class="sd">=================</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    MaskImpulse.__init__</span>
<span class="sd">    MaskImpulse.show</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="kn">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">numpy.fft</span> <span class="kn">as</span> <span class="nn">fft</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.plotutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="kn">as</span> <span class="nn">ios</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">cspline1d</span><span class="p">,</span> <span class="n">cspline1d_eval</span><span class="p">,</span> <span class="n">iirfilter</span><span class="p">,</span> <span class="n">iirdesign</span><span class="p">,</span> <span class="n">lfilter</span><span class="p">,</span> <span class="n">firwin</span> <span class="p">,</span> <span class="n">correlate</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">mixture</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">st</span>


<span class="k">class</span> <span class="nc">Bsignal</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Signal with an embedded time base</span>

<span class="sd">    This class gathers a 1D signal and its axis indexation.</span>

<span class="sd">    This class offers a transparent back and forth mechanism between time and frequency domain.</span>

<span class="sd">    The x base is not necessarily uniform</span>

<span class="sd">    x can have 1 or two axis</span>

<span class="sd">    The first axis of x and y have the same length</span>

<span class="sd">    By construction len(y):=len(x), len(x) takes priority in case of observed conflict</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Bsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.__init__.html#pylayers.signal.bsignal.Bsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x : ndarray (,Nx)</span>
<span class="sd">            time or frequency axis</span>

<span class="sd">        x : ndarray</span>
<span class="sd">        y : ndarray</span>
<span class="sd">            values  (Nx,Ny)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">shy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">shx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">lx</span>  <span class="o">=</span> <span class="n">shx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ly</span>  <span class="o">=</span> <span class="n">shy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c"># last dimension of y should be equal to dimension of x</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ly</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ly</span> <span class="o">!=</span> <span class="n">lx</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;Error in Bsignal : Dimension incompatibility &quot;</span>
                    <span class="k">print</span> <span class="s">&quot;x : &quot;</span><span class="p">,</span> <span class="n">lx</span>
                    <span class="k">print</span> <span class="s">&quot;y : &quot;</span><span class="p">,</span> <span class="n">ly</span>


</div>
<div class="viewcode-block" id="Bsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.__repr__.html#pylayers.signal.bsignal.Bsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> :  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>


</div>
<div class="viewcode-block" id="Bsignal.extract"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.extract.html#pylayers.signal.bsignal.Bsignal.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; extract y[u,:]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        O : Usignal</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; x = np.arange(0,1,0.01)</span>
<span class="sd">        &gt;&gt;&gt; y = np.sin(2*np.pi*x)</span>
<span class="sd">        &gt;&gt;&gt; s =Bsignal(x,y)</span>
<span class="sd">        &gt;&gt;&gt; su = s.extact(np.arange(4,20))</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">O</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.save.html#pylayers.signal.bsignal.Bsignal.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save Bsignal in Matlab File Format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename : string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; e = EnImpulse()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = e.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; e.save(&#39;impulse.mat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; del e</span>
<span class="sd">            &gt;&gt;&gt; h = TUsignal()</span>
<span class="sd">            &gt;&gt;&gt; h.load(&#39;impulse.mat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = h.plot(typ=[&#39;v&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">d</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">ios</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.load.html#pylayers.signal.bsignal.Bsignal.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Bsignal saved in a Matlab File</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename : string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">ios</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;y&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Bsignal.setx"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.setx.html#pylayers.signal.bsignal.Bsignal.setx">[docs]</a>    <span class="k">def</span> <span class="nf">setx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; setx : set x vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x : np.array</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        y is set to a zero vector</span>

<span class="sd">        Use __set__ instead</span>

<span class="sd">        .. todo:: check coherence of support internally</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.sety"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.sety.html#pylayers.signal.bsignal.Bsignal.sety">[docs]</a>    <span class="k">def</span> <span class="nf">sety</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sety : set y vector</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fun : function </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.stem"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.stem.html#pylayers.signal.bsignal.Bsignal.stem">[docs]</a>    <span class="k">def</span> <span class="nf">stem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stem display</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        color : string</span>
<span class="sd">            default &#39;b-&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; si = Bsignal()</span>
<span class="sd">            &gt;&gt;&gt; si.x= np.arange(100)</span>
<span class="sd">            &gt;&gt;&gt; si.y= np.arange(100)</span>
<span class="sd">            &gt;&gt;&gt; f,a = si.stem()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

        <span class="k">if</span> <span class="s">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;ax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.step"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.step.html#pylayers.signal.bsignal.Bsignal.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot steps display</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        color : string</span>
<span class="sd">            default &#39;b-&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.cformat"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.cformat.html#pylayers.signal.bsignal.Bsignal.cformat">[docs]</a>    <span class="k">def</span> <span class="nf">cformat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; complex format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        uy : ndarray()</span>
<span class="sd">            select rows of y</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        xn</span>
<span class="sd">        yn</span>
<span class="sd">        ylabels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;typ&#39;</span><span class="p">:</span><span class="s">&#39;l20&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s">&#39;uy&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;uy&#39;</span><span class="p">]</span>

        <span class="c"># radians to degree coefficient  </span>
        <span class="n">rtd</span> <span class="o">=</span> <span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;typ&#39;</span><span class="p">]</span>

        <span class="n">xn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Magnitude&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;v&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Amplitude&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;l10&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Magnitude (dB)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;l20&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Magnitude (dB)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;d&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Phase (deg)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span><span class="o">*</span><span class="n">rtd</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;r&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Phase (rad)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;du&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Unwrapped Phase (deg)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">*</span><span class="n">rtd</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;ru&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Unwrapped Phase (rad)&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;re&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Real part&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;im&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Imaginary part&#39;</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:])</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;gdn&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Group delay (ns)&#39;</span>
            <span class="n">df</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xn</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">yn</span>  <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">c</span><span class="p">,:])))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s">&#39;gdm&#39;</span><span class="p">:</span>
            <span class="n">ylabels</span><span class="o">=</span><span class="s">&#39;Group distance (m)&#39;</span>
            <span class="n">df</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xn</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">c</span><span class="p">,:])))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;ylabels&#39;</span>  <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ylabels</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ylabels&#39;</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="n">yn</span><span class="p">,</span><span class="n">ylabels</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.imshow"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.imshow.html#pylayers.signal.bsignal.Bsignal.imshow">[docs]</a>    <span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; imshow of y matrix</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        interpolation : string</span>
<span class="sd">            &#39;none&#39;|&#39;nearest&#39;|&#39;bilinear&#39;</span>
<span class="sd">        cmap : colormap</span>
<span class="sd">            plt.cm.BrBG</span>
<span class="sd">        aspect : string</span>
<span class="sd">            &#39;auto&#39; (default) ,&#39;equal&#39;,&#39;scalar&#39;</span>
<span class="sd">        dB : boolean</span>
<span class="sd">            False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">        &gt;&gt;&gt; f = np.arange(100)</span>
<span class="sd">        &gt;&gt;&gt; y = np.random.randn(50,100)+1j*np.random.randn(50,100)</span>
<span class="sd">        &gt;&gt;&gt; F = FUsignal(f,y)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;interpolation&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BrBG</span><span class="p">,</span>
                    <span class="s">&#39;aspect&#39;</span><span class="p">:</span><span class="s">&#39;auto&#39;</span><span class="p">,</span>
                    <span class="s">&#39;typ&#39;</span><span class="p">:</span><span class="s">&#39;l20&#39;</span><span class="p">,</span>
                    <span class="s">&#39;function&#39;</span><span class="p">:</span><span class="s">&#39;imshow&#39;</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">xn</span><span class="p">,</span><span class="n">yn</span><span class="p">,</span><span class="n">ylabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cformat</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="s">&#39;vmin&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">yn</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vmin&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s">&#39;vmax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">yn</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vmax&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;imshow&#39;</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">yn</span><span class="p">,</span>
                           <span class="n">origin</span> <span class="o">=</span> <span class="s">&#39;lower&#39;</span><span class="p">,</span>
                           <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span>
                           <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
                           <span class="n">aspect</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;aspect&#39;</span><span class="p">],</span>
                           <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">xn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">yn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="n">interpolation</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;interpolation&#39;</span><span class="p">],</span>
                           <span class="n">cmap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;function&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s">&#39;pcolormesh&#39;</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">yn</span><span class="p">)</span>

            <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">ylabels</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Bsignal.plot"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.plot.html#pylayers.signal.bsignal.Bsignal.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        iy    : index of the waveform to plot (-1 = all)</span>
<span class="sd">        col   : string</span>
<span class="sd">            default  &#39;black&#39;</span>
<span class="sd">        vline : ndarray</span>
<span class="sd">        hline : ndarray</span>
<span class="sd">        unit1 : string</span>
<span class="sd">            default &#39;V&#39;</span>
<span class="sd">        unit2 : string</span>
<span class="sd">            default &#39;V&#39;</span>
<span class="sd">        xmin  : float</span>
<span class="sd">        xmax  : float</span>
<span class="sd">        ax    : axes instance or []</span>
<span class="sd">        dB    : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        dist  : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        display : boolean</span>
<span class="sd">            default True</span>
<span class="sd">        logx  : boolean</span>
<span class="sd">            defaut False</span>
<span class="sd">        logy  : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;iy&#39;</span>  <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="s">&#39;vline&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                  <span class="s">&#39;hline&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                  <span class="s">&#39;unit1&#39;</span> <span class="p">:</span> <span class="s">&#39;V&#39;</span><span class="p">,</span>
                  <span class="s">&#39;unit2&#39;</span> <span class="p">:</span> <span class="s">&#39;V&#39;</span><span class="p">,</span>
                  <span class="s">&#39;separated&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                  <span class="s">&#39;dist&#39;</span>  <span class="p">:</span> <span class="bp">False</span> <span class="p">,</span>
                  <span class="s">&#39;xmin&#39;</span>  <span class="p">:</span><span class="o">-</span><span class="mf">1e15</span><span class="p">,</span>
                  <span class="s">&#39;xmax&#39;</span>  <span class="p">:</span> <span class="mf">1e15</span><span class="p">,</span>
                  <span class="s">&#39;logx&#39;</span>  <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                  <span class="s">&#39;logy&#39;</span>  <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                 <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                 <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="n">vline</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;vline&#39;</span><span class="p">]</span>
        <span class="n">hline</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;hline&#39;</span><span class="p">]</span>

        <span class="c"># filtering kwargs argument for plot function</span>
        <span class="n">args</span> <span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">conversion</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;unit1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;V&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;unit2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;mV&#39;</span><span class="p">)):</span>
            <span class="n">conversion</span> <span class="o">=</span> <span class="mi">1000</span>

        <span class="c"># restriction of x support</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c"># conver ns in meter if dist=True</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">]:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

        <span class="c">#</span>
        <span class="c"># if ndim(y) &gt; 1</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">yx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">u</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">mulcplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">yx</span><span class="o">*</span><span class="n">conversion</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">mulcplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">*</span><span class="n">conversion</span><span class="p">,</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Draw vertical and horizontal lines</span>
        <span class="c">#</span>
        <span class="c"># To be added in mulcplot</span>
        <span class="c">#</span>

        <span class="n">tcolor</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="s">&#39;black&#39;</span><span class="p">]</span>
        <span class="n">nl</span><span class="p">,</span><span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nc</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vline</span><span class="p">)):</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">l</span><span class="p">,</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">vline</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">tcolor</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hline</span><span class="p">)):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">hline</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">conversion</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        
        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.flatteny"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.flatteny.html#pylayers.signal.bsignal.Bsignal.flatteny">[docs]</a>    <span class="k">def</span> <span class="nf">flatteny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">yrange</span><span class="o">=</span><span class="p">[],</span><span class="n">reversible</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; flatten y array</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        yrange : array of y index values to be flattenned</span>
<span class="sd">        reversible : boolean</span>
<span class="sd">            if True the sum is place in object member yf</span>
<span class="sd">            else y is smashed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yrange</span><span class="o">==</span><span class="p">[]:</span>
                <span class="n">yrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">reversible</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">yrange</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">yrange</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Bsignal.gating"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.gating.html#pylayers.signal.bsignal.Bsignal.gating">[docs]</a>    <span class="k">def</span> <span class="nf">gating</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gating between xmin and xmax</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        xmin : float</span>
<span class="sd">        xmax : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            nothing self is modified</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; x = np.linspace(-10,10,100)</span>
<span class="sd">            &gt;&gt;&gt; y = np.sin(2*np.pi*12*x)+np.random.normal(0,0.1,len(x))</span>
<span class="sd">            &gt;&gt;&gt; s = TUsignal(x,y)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = s.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; txt1 = plt.title(&#39;before gating&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt; s.gating(-3,4)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax=s.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; txt2 = plt.title(&#39;after gating&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>

<span class="sd">            When a gating is applied the removed information is lost</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">:</span>
                <span class="n">Ny</span> <span class="o">=</span> <span class="n">shy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Ny</span> <span class="o">=</span> <span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">w</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ny</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ny</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">w</span>
</div>
<div class="viewcode-block" id="Bsignal.len"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Bsignal.len.html#pylayers.signal.bsignal.Bsignal.len">[docs]</a>    <span class="k">def</span> <span class="nf">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returm length of x axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

</div>
<span class="k">class</span> <span class="nc">Usignal</span><span class="p">(</span><span class="n">Bsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Signal with an embedded uniform Base</span>

<span class="sd">        This class inheritate from Bsignal. The only difference</span>
<span class="sd">        is that the x base is supposed to be uniform</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Usignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.__init__.html#pylayers.signal.bsignal.Usignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Usignal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#Bsignal.__init__(self, x, y)</span>
</div>
<div class="viewcode-block" id="Usignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.__repr__.html#pylayers.signal.bsignal.Usignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Bsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.__add__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.__add__.html#pylayers.signal.bsignal.Usignal.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;float&#39;</span><span class="p">)):</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="c">#u1 = L[0]</span>
            <span class="c">#u2 = L[1]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="c"># handle one dimensional array</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">val</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.__sub__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.__sub__.html#pylayers.signal.bsignal.Usignal.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;float&#39;</span><span class="p">)):</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span>  <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="c">#u1 = L[0]</span>
            <span class="c">#u2 = L[1]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">val</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
            <span class="c">#U = Usignal(u1.x, u1.y - u2.y)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.__mul__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.__mul__.html#pylayers.signal.bsignal.Usignal.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;int&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&#39;float&#39;</span><span class="p">)):</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span>  <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="c">#u1 = L[0]</span>
            <span class="c">#u2 = L[1]</span>
            <span class="c">#U = Usignal(u1.x, u1.y * u2.y)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">L</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">val</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.setx"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.setx.html#pylayers.signal.bsignal.Usignal.setx">[docs]</a>    <span class="k">def</span> <span class="nf">setx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">dx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; set the x array of the Usignal (y=0)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start  : float</span>
<span class="sd">        stop   : float</span>
<span class="sd">        dx     : float</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">       </span>
<span class="sd">        &gt;&gt;&gt; u = Usignal()</span>
<span class="sd">        &gt;&gt;&gt; u.setx(0,10,0.1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.dx"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.dx.html#pylayers.signal.bsignal.Usignal.dx">[docs]</a>    <span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  get the time step of Usignal.x</span>

<span class="sd">        Examples</span>
<span class="sd">        ---------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; u = Usignal()</span>
<span class="sd">        &gt;&gt;&gt; u.setx(0,10,0.1)</span>
<span class="sd">        &gt;&gt;&gt; assert(u.dx()==0.1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Usignal.width"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.width.html#pylayers.signal.bsignal.Usignal.width">[docs]</a>    <span class="k">def</span> <span class="nf">width</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the extension support of the Usignal</span>

<span class="sd">        width is conventionnaly equal to the difference between extremities + dx</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        w : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.expand"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.expand.html#pylayers.signal.bsignal.Usignal.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; expand the time support by a scale factor a</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a  : float</span>
<span class="sd">            expansion factor</span>

<span class="sd">        Returns</span>
<span class="sd">        ------</span>
<span class="sd">        Usignal  : support extended signal</span>

<span class="sd">        return a new Usignal with expanded factor a</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">T1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
        <span class="n">T2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">T1</span>
        <span class="n">N3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">T2</span> <span class="o">-</span> <span class="n">T1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dx</span><span class="p">))</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">xstart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">N3</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">xstop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">N3</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">()</span>
        <span class="n">sr</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">setx</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">sr</span><span class="o">.</span><span class="n">setx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">xstop</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">som</span> <span class="o">=</span> <span class="n">sl</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="n">sr</span>
        <span class="k">return</span><span class="p">(</span><span class="n">som</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.max"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.max.html#pylayers.signal.bsignal.Usignal.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  maximum of Usignal</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        m : maximum value of self.y</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.min"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.min.html#pylayers.signal.bsignal.Usignal.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  minimum of Usignal</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        m : maximum value of self.y</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nd</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.truncate"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.truncate.html#pylayers.signal.bsignal.Usignal.truncate">[docs]</a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posmin</span><span class="p">,</span> <span class="n">posmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; truncate USignal in range [posmin, posmax]</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        posmin  : float</span>
<span class="sd">        posmax  : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Usignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>

        <span class="n">x_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">posmin</span><span class="p">:</span><span class="n">posmax</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="n">posmin</span><span class="p">:</span><span class="n">posmax</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">posmin</span><span class="p">:</span><span class="n">posmax</span><span class="p">]</span>
       
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;Usignal&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;Tchannel&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;TUsignal&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;FUsignal&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s">&#39;FUDsignal&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">FUDsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">)</span>

        <span class="c">#if &#39;U&#39; not in locals():</span>
            <span class="c">#pdb.set_trace()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.align"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.align.html#pylayers.signal.bsignal.Usignal.align">[docs]</a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; align two Usignal on a same base</span>

<span class="sd">        returns a list which contains the two aligned signals</span>

<span class="sd">        It is assume that both signal u1 and u2 share the same dx</span>
<span class="sd">        This function can be improved regarding time granularity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        u2 : TUsignal</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TUsignal y extended TU signal, x bases are adjusted</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; i1 = EnImpulse()</span>
<span class="sd">            &gt;&gt;&gt; i2 = EnImpulse()</span>
<span class="sd">            &gt;&gt;&gt; i2.translate(-10)</span>
<span class="sd">            &gt;&gt;&gt; i3 = i1.align(i2)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax=i3.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># copy object</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">u1_start</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u1_stop</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">u2_start</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2_stop</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># get dimensions</span>
        <span class="k">if</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">M1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">M1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">u1</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">M2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">M2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">u2</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">M2</span><span class="p">)</span>

        <span class="n">bool1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u1_start</span> <span class="o">-</span> <span class="n">u2_start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>
        <span class="n">bool2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u1_stop</span> <span class="o">-</span> <span class="n">u2_stop</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>

        <span class="nb">bool</span> <span class="o">=</span> <span class="n">bool1</span> <span class="o">&amp;</span> <span class="n">bool2</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">bool</span><span class="p">):</span>
        <span class="c"># same x support</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
        <span class="c"># different x support</span>
            <span class="n">xstart</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">u1_start</span><span class="p">,</span> <span class="n">u2_start</span><span class="p">)</span>
            <span class="n">xstop</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">u1_stop</span><span class="p">,</span> <span class="n">u2_stop</span><span class="p">)</span>

            <span class="n">b1i</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xstart</span> <span class="o">-</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-15</span>
            <span class="n">b2i</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xstart</span> <span class="o">-</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-15</span>
            <span class="n">b1f</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xstop</span> <span class="o">-</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-15</span>
            <span class="n">b2f</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">xstop</span> <span class="o">-</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-15</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">b1i</span> <span class="o">&amp;</span> <span class="n">b2f</span><span class="p">):</span>
            <span class="c"># u1 is left u2 is right</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">xstop</span> <span class="o">-</span> <span class="n">xstart</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">dx</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xstart</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N2</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">yleft</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span>
                <span class="n">yright</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span>
                <span class="n">Nleft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M1</span><span class="p">)</span>
                <span class="n">Nright</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M2</span><span class="p">)</span>
                <span class="n">Y1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nleft</span><span class="p">]</span> <span class="o">=</span> <span class="n">yleft</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nleft</span><span class="p">]</span>
                <span class="n">Y2</span><span class="p">[:,</span><span class="o">-</span><span class="n">Nright</span><span class="p">:]</span> <span class="o">=</span> <span class="n">yright</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nright</span><span class="p">]</span>
                <span class="n">U1</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">b2i</span> <span class="o">&amp;</span> <span class="n">b1f</span><span class="p">):</span>
            <span class="c"># u2 is left u1 is right</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
                <span class="n">T</span> <span class="o">=</span> <span class="n">xstop</span> <span class="o">-</span> <span class="n">xstart</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">dx</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xstart</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
                <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N1</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N2</span><span class="p">,</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">yleft</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span>
                <span class="n">yright</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span>
                <span class="n">Nleft</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M2</span><span class="p">)</span>
                <span class="n">Nright</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M1</span><span class="p">)</span>
                <span class="n">Y2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nleft</span><span class="p">]</span> <span class="o">=</span> <span class="n">yleft</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nleft</span><span class="p">]</span>
                <span class="n">Y1</span><span class="p">[:,</span><span class="o">-</span><span class="n">Nright</span><span class="p">:]</span> <span class="o">=</span> <span class="n">yright</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">Nright</span><span class="p">]</span>
                <span class="n">U1</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Y2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">b1i</span> <span class="o">&amp;</span> <span class="n">b1f</span><span class="p">):</span>
            <span class="c"># u2 is included in u1</span>
                <span class="n">U1</span> <span class="o">=</span> <span class="n">u1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">u2_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">u2_stop</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
                <span class="c">#pdb.set_trace()</span>
                <span class="n">U2</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">indx</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">b2i</span> <span class="o">&amp;</span> <span class="n">b2f</span><span class="p">):</span>
            <span class="c"># u1 is included in u2</span>
                <span class="n">U2</span> <span class="o">=</span> <span class="n">u2</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">u1_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">u1_stop</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">U1</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>
                <span class="n">U1</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span>

            <span class="c">#L = [U1, U2]</span>
            <span class="n">L</span>   <span class="o">=</span> <span class="n">Usignal</span><span class="p">()</span>
            <span class="n">L</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">U1</span><span class="o">.</span><span class="n">x</span>
            <span class="n">L</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">U1</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">U2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">L</span>
</div>
<div class="viewcode-block" id="Usignal.abs"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.abs.html#pylayers.signal.bsignal.Usignal.abs">[docs]</a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the absolute value of an Usignal</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Usignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Usignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.eprfl"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.eprfl.html#pylayers.signal.bsignal.Usignal.eprfl">[docs]</a>    <span class="k">def</span> <span class="nf">eprfl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Energy profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eprfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">eprfl</span>
</div>
<div class="viewcode-block" id="Usignal.energy"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.energy.html#pylayers.signal.bsignal.Usignal.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the energy of an Usignal</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        energy : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.fftshift"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.fftshift.html#pylayers.signal.bsignal.Usignal.fftshift">[docs]</a>    <span class="k">def</span> <span class="nf">fftshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Usignal.zright"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.zright.html#pylayers.signal.bsignal.Usignal.zright">[docs]</a>    <span class="k">def</span> <span class="nf">zright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add zeros on the right until xmax</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xmax : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">cmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="n">cmax</span><span class="p">,</span> <span class="s">&#39;Warning xmax &lt;= cmax&#39;</span>
        <span class="n">xadd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cmax</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">yadd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xadd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xadd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">yadd</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Usignal.zleft"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.zleft.html#pylayers.signal.bsignal.Usignal.zleft">[docs]</a>    <span class="k">def</span> <span class="nf">zleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add zeros on the left  until xmin</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xmin : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span>
        <span class="n">cmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="n">cmin</span><span class="p">,</span> <span class="s">&#39;Warning xmin &gt;= cmin&#39;</span>
        <span class="n">xadd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">cmin</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">yadd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xadd</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xadd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">yadd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Usignal.zlr"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Usignal.zlr.html#pylayers.signal.bsignal.Usignal.zlr">[docs]</a>    <span class="k">def</span> <span class="nf">zlr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  add zeros to the left and to the right</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xmin : float</span>
<span class="sd">        xmax : float</span>

<span class="sd">        Summary</span>
<span class="sd">        --------</span>
<span class="sd">        This is a gating between xmin and xmax</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal import *</span>
<span class="sd">            &gt;&gt;&gt; from matplotlib.pylab import *</span>
<span class="sd">            &gt;&gt;&gt; ip = EnImpulse()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = ip.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; ip.zlr(-10,10)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = ip.plot(typ=[&#39;v&#39;],fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">cmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">cmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmin</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">:</span>
            <span class="n">xaddl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">cmin</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
            <span class="n">yaddl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaddl</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xaddl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">yaddl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xmin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">cmax</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">:</span>
            <span class="n">xaddr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cmax</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
            <span class="n">yaddr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xaddr</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xaddr</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">yaddr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

</div>
<span class="k">class</span> <span class="nc">TBsignal</span><span class="p">(</span><span class="n">Bsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Based signal in Time domain</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TBsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TBsignal.__init__.html#pylayers.signal.bsignal.TBsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TBsignal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#Bsignal.__init__(self, x, y)</span>
</div>
<div class="viewcode-block" id="TBsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TBsignal.__repr__.html#pylayers.signal.bsignal.TBsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Bsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TBsignal.plot"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TBsignal.plot.html#pylayers.signal.bsignal.TBsignal.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot TBsignal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        unit1 : actual unit of data</span>
<span class="sd">        unit2 : unit for display</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; from matplotlib.pylab import *</span>
<span class="sd">        &gt;&gt;&gt; x = np.array( [ 1, 3 , 6 , 11 , 18])</span>
<span class="sd">        &gt;&gt;&gt; y = np.array( [ 0,1 ,-5, 8 , 10])</span>
<span class="sd">        &gt;&gt;&gt; s = Bsignal(x,y)</span>
<span class="sd">        &gt;&gt;&gt; fi = figure()</span>
<span class="sd">        &gt;&gt;&gt; fig,ax=s.plot(typ=[&#39;v&#39;])</span>
<span class="sd">        &gt;&gt;&gt; ti = title(&#39;TBsignal : plot&#39;)</span>
<span class="sd">        &gt;&gt;&gt; show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;iy&#39;</span>  <span class="p">:</span>  <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                  <span class="s">&#39;vline&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                  <span class="s">&#39;hline&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                  <span class="s">&#39;unit1&#39;</span> <span class="p">:</span> <span class="s">&#39;V&#39;</span><span class="p">,</span>
                  <span class="s">&#39;unit2&#39;</span> <span class="p">:</span> <span class="s">&#39;V&#39;</span><span class="p">,</span>
                  <span class="s">&#39;dist&#39;</span>  <span class="p">:</span> <span class="bp">False</span> <span class="p">,</span>
                  <span class="s">&#39;xmin&#39;</span>  <span class="p">:</span><span class="o">-</span><span class="mf">1e15</span><span class="p">,</span>
                  <span class="s">&#39;xmax&#39;</span>  <span class="p">:</span> <span class="mf">1e15</span><span class="p">,</span>
                  <span class="s">&#39;logx&#39;</span>  <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                  <span class="s">&#39;logy&#39;</span>  <span class="p">:</span> <span class="bp">False</span>
                 <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<span class="c">#        if tmin != -1e5:</span>
<span class="c">#            xmin = tmin</span>
<span class="c">#        else:</span>
<span class="c">#            xmin = -1e5</span>
<span class="c">#</span>
<span class="c">#        if tmax != 1e5:</span>
<span class="c">#            xmax = tmax</span>
<span class="c">#        else:</span>
<span class="c">#            xmax = tmax</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dist&#39;</span><span class="p">]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;xlabels&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;distance (m)&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;xlabels&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Time (ns)&#39;</span><span class="p">]</span>


<span class="c">#        if kwargs[&#39;unit2&#39;] == &#39;mV&#39;:</span>
<span class="c">#            if kwargs[&#39;type&#39;]==&#39;l20&#39;:</span>
<span class="c">#                kwargs[&#39;ylabel&#39;]=[&#39;Voltage (dBmV)&#39;]</span>
<span class="c">#            if kwargs[&#39;type&#39;]==&#39;v&#39;:</span>
<span class="c">#                kwargs[&#39;ylabel&#39;]=[&#39;Voltage (mV)&#39;]</span>
<span class="c">#</span>
<span class="c">#        if kwargs[&#39;unit2&#39;] == &#39;V&#39;:</span>
<span class="c">#            if kwargs[&#39;type&#39;]==&#39;l20&#39;:</span>
<span class="c">#                kwargs[&#39;ylabel&#39;]=[&#39;Voltage (dBmV)&#39;]</span>
<span class="c">#            if kwargs[&#39;type&#39;]==&#39;v&#39;:</span>
<span class="c">#                plt.ylabel(&#39;Voltage (mV)&#39;)</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Bsignal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c">#fig,ax = self.plot(**kwargs)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TBsignal.translate"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TBsignal.translate.html#pylayers.signal.bsignal.TBsignal.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  translate signal by tau</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau : float</span>
<span class="sd">            delay for translation</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>

<span class="sd">        Once translated original signal and translated signal might not be on the same grid</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; from matplotlib.pylab import *</span>
<span class="sd">            &gt;&gt;&gt; ip = EnImpulse()</span>
<span class="sd">            &gt;&gt;&gt; ip.translate(-10)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax=ip.plot(typ=[&#39;v&#39;])</span>
<span class="sd">            &gt;&gt;&gt; show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="TBsignal.b2u"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TBsignal.b2u.html#pylayers.signal.bsignal.TBsignal.b2u">[docs]</a>    <span class="k">def</span> <span class="nf">b2u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; conversion into an uniform signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : integer</span>
<span class="sd">            Number of points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        U : TUsignal</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function exploits linear interp1d</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            #&gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            #&gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            #&gt;&gt;&gt; x = np.array( [ 1, 3 , 6 , 11 , 18])</span>
<span class="sd">            #&gt;&gt;&gt; y = np.array( [ 0,1 ,-5, 8 , 10])</span>
<span class="sd">            #&gt;&gt;&gt; sb = TBsignal(x,y)</span>
<span class="sd">            #&gt;&gt;&gt; su20 = sb.b2u(20)</span>
<span class="sd">            #&gt;&gt;&gt; su100 = sb.b2u(100)</span>
<span class="sd">            #&gt;&gt;&gt; fi = plt.figure()</span>
<span class="sd">            #&gt;&gt;&gt; sb.stem()</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax = su20.plot(color=&#39;k&#39;)</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax = su100.plot(color=&#39;r&#39;,fig=fig,ax=ax)</span>
<span class="sd">            #&gt;&gt;&gt; ti = plt.title(&#39;b2u : sb(blue) su20(black) su200(red)&#39;)</span>
<span class="sd">            #&gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fi</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">xn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">yn</span> <span class="o">=</span> <span class="n">fi</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">U</span>

</div>
<span class="k">class</span> <span class="nc">TUsignal</span><span class="p">(</span><span class="n">TBsignal</span><span class="p">,</span> <span class="n">Usignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uniform signal in Time domain</span>

<span class="sd">    This class inheritates from TBsignal and Usignal</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TUsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.__init__.html#pylayers.signal.bsignal.TUsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TUsignal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#Usignal.__init__(self, x, y)</span>
</div>
<div class="viewcode-block" id="TUsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.__repr__.html#pylayers.signal.bsignal.TUsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Usignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.diff"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.diff.html#pylayers.signal.bsignal.TUsignal.diff">[docs]</a>    <span class="k">def</span> <span class="nf">diff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; numerical differentiation</span>

<span class="sd">        Warnings</span>
<span class="sd">        ---------</span>
<span class="sd">            the number of points is reduced by one</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :source-include:</span>

<span class="sd">            #&gt;&gt;&gt; import numpy as np</span>
<span class="sd">            #&gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            #&gt;&gt;&gt; from matplotlib.pyplot import *</span>
<span class="sd">            #&gt;&gt;&gt; x  = np.arange(0,1.0,0.1)</span>
<span class="sd">            #&gt;&gt;&gt; y  = x**3</span>
<span class="sd">            #&gt;&gt;&gt; su = TUsignal(x,y)</span>
<span class="sd">            #&gt;&gt;&gt; dsu   = su.diff()</span>
<span class="sd">            #&gt;&gt;&gt; ddsu  = dsu.diff()</span>
<span class="sd">            #&gt;&gt;&gt; dddsu = ddsu.diff()</span>
<span class="sd">            #&gt;&gt;&gt; fi = plt.figure()</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax=su.plot(typ=[&#39;v&#39;] ,color=&#39;k&#39;)</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax=dsu.plot(typ=[&#39;v&#39;],color=&#39;g&#39;,fig=fig,ax=ax)</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax=ddsu.plot(typ=[&#39;v&#39;],color=&#39;r&#39;,fig=fig,ax=ax)</span>
<span class="sd">            #&gt;&gt;&gt; fig,ax=dddsu.plot(typ=[&#39;v&#39;],color=&#39;b&#39;,fig=fig,ax=ax)</span>
<span class="sd">            #&gt;&gt;&gt; ti = plt.title(&#39;TUsignal : diff&#39;)</span>
<span class="sd">            #&gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">()</span>
        <span class="n">V</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">V</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.info.html#pylayers.signal.bsignal.TUsignal.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&#39;TUsignal&#39;</span>
        <span class="k">print</span> <span class="s">&#39;--------&#39;</span>
        <span class="k">print</span> <span class="s">&#39;shx : &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;shy : &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;dx :  &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;xmin :&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;xmax :&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;ymin :&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;ymax :&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TUsignal.fft"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.fft.html#pylayers.signal.bsignal.TUsignal.fft">[docs]</a>    <span class="k">def</span> <span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  forward fast Fourier transform</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        shift : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>

<span class="sd">        This fft is a scaled fft and takes into account the value of the sampling period.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        FHsignal</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; e = EnImpulse()</span>
<span class="sd">        &gt;&gt;&gt; E = e.fft()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fe</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">te</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">()</span>
        <span class="n">S</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">te</span>
        <span class="c"># compensation du retard 11.12.2009</span>
        <span class="c">#S.y=S.y*exp(-1j*2*np.pi*f*self.x[0])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.fftsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.fftsh.html#pylayers.signal.bsignal.TUsignal.fftsh">[docs]</a>    <span class="k">def</span> <span class="nf">fftsh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return an FHsignal</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>

<span class="sd">        This fft is a scaled fft and takes into account the value of the</span>
<span class="sd">        sampling period.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        FHsignal : Frequency signal with hermitian symmetry</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fe</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">te</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fe</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#y = fft(self.y)</span>
        <span class="c">#y = fftshift(y)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">()</span>
        <span class="n">S</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span>
        <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">te</span>
        <span class="k">return</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.filter"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.filter.html#pylayers.signal.bsignal.TUsignal.filter">[docs]</a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">wp</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s">&#39;butter&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; signal filtering</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order : int</span>
<span class="sd">        wp    : float</span>
<span class="sd">        ws    : float</span>
<span class="sd">        ftype : string</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        O : Output filetered TUsignal</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">()</span>
        <span class="c">#ba  = iirfilter(order,[wp,ws],ftype=ftype)</span>
        <span class="k">print</span> <span class="s">&quot;wp = &quot;</span><span class="p">,</span> <span class="n">wp</span>
        <span class="k">print</span> <span class="s">&quot;ws = &quot;</span><span class="p">,</span> <span class="n">ws</span>
        <span class="c">#ba  = iirdesign(wp,ws,1,40,ftype=ftype)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">firwin</span><span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="p">[</span><span class="n">wp</span><span class="p">,</span> <span class="n">ws</span><span class="p">])</span>
        <span class="n">O</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">lfilter</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">O</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="k">return</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.ftshift"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.ftshift.html#pylayers.signal.bsignal.TUsignal.ftshift">[docs]</a>    <span class="k">def</span> <span class="nf">ftshift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the associated FUsignal</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fftsh</span><span class="p">()</span>
        <span class="n">AU</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">AU</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.psd"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.psd.html#pylayers.signal.bsignal.TUsignal.psd">[docs]</a>    <span class="k">def</span> <span class="nf">psd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tpns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate power spectral density</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        R    : Resistance (default 50 Ohms)</span>
<span class="sd">        Tpns : real</span>
<span class="sd">            PRP (default 100 ns)</span>

<span class="sd">        .. note::</span>

<span class="sd">            If time is in ns the resulting PSD is expressed in dBm/MHz (~10-9)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">esd</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;unilateral&#39;</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">Tpns</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.show.html#pylayers.signal.bsignal.TUsignal.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[],</span><span class="n">display</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">PRPns</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  show psd</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        display</span>

<span class="sd">        See Also</span>
<span class="sd">        ---------</span>

<span class="sd">        pylayers.signal.bsignal.TUsignal.psd</span>
<span class="sd">        pylayers.signal.bsignal.Usignal.zlr</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span><span class="n">PRPns</span><span class="p">)</span>
        <span class="n">kboltzmann</span> <span class="o">=</span> <span class="mf">1.3806503e-23</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="c"># +30 dBW/Hz -&gt; dBm/MHz</span>
        <span class="n">N0dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kboltzmann</span><span class="o">*</span><span class="n">T</span><span class="p">)</span><span class="o">+</span><span class="mi">30</span>

        <span class="n">u</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">y</span><span class="o">&gt;</span><span class="n">N0dB</span><span class="p">)</span>
        <span class="n">Pnoise</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])</span><span class="o">*</span><span class="n">Y</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pnoise</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Pnoise</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
        <span class="c">#self.zlr(0,150)</span>
        <span class="c"># unilateral</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="s">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">N0dB</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;PSD (dBm/MHz) assuming PRP=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">PRPns</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; ns&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TUsignal.esd"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.esd.html#pylayers.signal.bsignal.TUsignal.esd">[docs]</a>    <span class="k">def</span> <span class="nf">esd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;bilateral&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Calculate the energy spectral density of the U signal</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;unilateral&#39; | &#39;bilateral&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        FHsignal : if mode == &#39;bilateral&#39;</span>
<span class="sd">        FUsignal : if mode == &#39;unilateral&#39;</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        FHsignal.unrex</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>
        <span class="c">#YY  = (te*te)*abs(Y.y)**2</span>
        <span class="n">YY</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">YY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;unilateral&#39;</span><span class="p">:</span>
            <span class="n">Ou</span> <span class="o">=</span> <span class="n">O</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>
            <span class="n">Ou</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ou</span><span class="o">.</span><span class="n">y</span>
            <span class="k">return</span><span class="p">(</span><span class="n">Ou</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>




</div>
<div class="viewcode-block" id="TUsignal.shift"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.shift.html#pylayers.signal.bsignal.TUsignal.shift">[docs]</a>    <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; shift the Usignal by tau (expressed in the same unit as Bsignal.x)</span>

<span class="sd">        This method uses fft and ifft to produce a shift which is not necessarily a</span>
<span class="sd">        multiple of the time step dx.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">y</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="n">tau</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">arg</span><span class="p">)</span>
        <span class="n">SD</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">E</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">SD</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">ze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">SD</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cc</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">SD</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">cc</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">U</span><span class="p">))),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ifft</span><span class="p">(</span><span class="n">V</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.correlate"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.correlate.html#pylayers.signal.bsignal.TUsignal.correlate">[docs]</a>    <span class="k">def</span> <span class="nf">correlate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">normalized</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; correlates with an other signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s : TUsignal</span>
<span class="sd">        normalized : boolean</span>
<span class="sd">            default True</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>
<span class="sd">            The time step dx should be the same</span>

<span class="sd">            The chosen time reference is the one of the self signal</span>
<span class="sd">            This means that this function can be used to detect events appearing</span>
<span class="sd">            in the self signal by correlating with signal ..math:`s`, maximum of</span>
<span class="sd">            the correlation function appears in the proper time of the self signal</span>
<span class="sd">            history.</span>

<span class="sd">            **Interpretation of the correlation levels**</span>

<span class="sd">            We assume that s1 is the self signal and s2 is the correlating signal</span>

<span class="sd">            s1 = a1 * sn(t-tau)   where sn is normalized in energy</span>
<span class="sd">            s2 = a2 * sn(t)             &quot;   &quot;   &quot;   &quot;  &quot;</span>

<span class="sd">            the maximum of correlation appears at time tau and its value is</span>

<span class="sd">                    max (s1.correlate(s2,True)) = a1*a2</span>

<span class="sd">            In the case of the propagation simulation we have</span>
<span class="sd">                    s1 : the time domain UWB received waveform</span>
<span class="sd">                    s2 : the corresponding emitted waveform s2,</span>

<span class="sd">            To determine the ratio a1/a2 or a2/a1 in order to evaluate the propagation Loss L = 20 log10(a2/a1)</span>

<span class="sd">            This calculus assumes implicitely that the shape of the transmitted signal</span>
<span class="sd">            has not been modified during the propagation, which is a strong hypothesis.</span>
<span class="sd">            This calculus is then a minorant of the received energy.</span>

<span class="sd">            L = max(s1.correlate(s2,True)/s1.Energy)   with a1**2 = sum(s1**s1)*dx</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">xcorr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Nxc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xcorr</span><span class="p">)</span>
        <span class="n">t_left</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ns</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">t_left</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">Nright</span> <span class="o">=</span> <span class="n">Nxc</span> <span class="o">-</span> <span class="n">Nt</span>
        <span class="n">t_right</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nright</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">t_right</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">()</span>
        <span class="n">phi</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="n">normalized</span><span class="p">:</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xcorr</span> <span class="o">*</span> <span class="n">dx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phi</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xcorr</span>
        <span class="k">return</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.corrgauss"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.corrgauss.html#pylayers.signal.bsignal.TUsignal.corrgauss">[docs]</a>    <span class="k">def</span> <span class="nf">corrgauss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Correlate TUsignal with a normalized gaussian of standard deviation sigma</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sigma : float</span>
<span class="sd">            standard deviation of Gaussian</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">gn</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="n">pcorr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">gn</span><span class="p">)</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.15</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">pcorr</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pcorr</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">fac</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="TUsignal.Efirst_loc"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Efirst_loc.html#pylayers.signal.bsignal.TUsignal.Efirst_loc">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nint</span><span class="p">,</span> <span class="n">E0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; find the Efirst using the mean like toa_max</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nint</span>
<span class="sd">        E0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">M</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nint</span><span class="p">:</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">w0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">vv</span><span class="p">])</span>
        <span class="n">Efirst</span> <span class="o">=</span> <span class="n">ff</span> <span class="o">/</span> <span class="n">E0</span>
        <span class="n">Efirst</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Efirst</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Efirst</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.resample"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.resample.html#pylayers.signal.bsignal.TUsignal.resample">[docs]</a>    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resample the TUsignal with a new x base</span>

<span class="sd">        x_new needs to be strictly included in the original x base of the Usignal.</span>
<span class="sd">        x is a 1D array</span>
<span class="sd">        y is a 2D array</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_new : ndarray</span>
<span class="sd">        kind  : string</span>
<span class="sd">            &#39;linear&#39; |&#39;spline&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;spline&#39;</span><span class="p">:</span>
            <span class="n">coef</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">coef</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.ft"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.ft.html#pylayers.signal.bsignal.TUsignal.ft">[docs]</a>    <span class="k">def</span> <span class="nf">ft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the associated FUsignal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>
        <span class="n">AU</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">AU</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.convolve"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.convolve.html#pylayers.signal.bsignal.TUsignal.convolve">[docs]</a>    <span class="k">def</span> <span class="nf">convolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time domain convolution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">i0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">u</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">dx</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">dx</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ind0</span> <span class="o">=</span> <span class="n">i0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t0</span> <span class="o">-</span> <span class="n">ind0</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">N1</span> <span class="o">+</span> <span class="n">N2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ind0</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span> <span class="n">convolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Yadd_zeros2l"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Yadd_zeros2l.html#pylayers.signal.bsignal.TUsignal.Yadd_zeros2l">[docs]</a>    <span class="k">def</span> <span class="nf">Yadd_zeros2l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time domain extension on the left with N zeros</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : integer</span>
<span class="sd">            number of additinal zero values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        Yadd_zeros2r</span>


<span class="sd">        Work only for single y</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">aux</span> <span class="o">-</span> <span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">te</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TUsignal.Yadd_zeros2r"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Yadd_zeros2r.html#pylayers.signal.bsignal.TUsignal.Yadd_zeros2r">[docs]</a>    <span class="k">def</span> <span class="nf">Yadd_zeros2r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time domain extension on right with N zeros</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : integer</span>
<span class="sd">            number of additinal zero values</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        Yadd_zeros2l</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span>
        <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">aux</span> <span class="o">-</span> <span class="p">(</span><span class="n">aux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">te</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="TUsignal.Epercent"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Epercent.html#pylayers.signal.bsignal.TUsignal.Epercent">[docs]</a>    <span class="k">def</span> <span class="nf">Epercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return N percentile delay of a cdf</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : 10</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Cdf</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pc</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Etau0"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Etau0.html#pylayers.signal.bsignal.TUsignal.Etau0">[docs]</a>    <span class="k">def</span> <span class="nf">Etau0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate energy around delay tau0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau0  : (ns)            (0)</span>
<span class="sd">        Tint  : Integration time (ns)   (1) include the system error</span>
<span class="sd">        sym   : symetrie factor 0.5 = symetric (0.25)</span>
<span class="sd">        dB    : logscale indicator (True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#u  = nonzero((tau0 + Tint*(1-sym) &gt; self.x) &amp; (self.x &gt; tau0 - Tint*sym))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">((</span><span class="n">tau0</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tau0</span><span class="p">))</span>
        <span class="n">etau0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">etau0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">etau0</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">etau0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Ewin"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Ewin.html#pylayers.signal.bsignal.TUsignal.Ewin">[docs]</a>    <span class="k">def</span> <span class="nf">Ewin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  integrate energy around delay tau</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau   : (ns)            (0)</span>
<span class="sd">        Tint  : Integration time (ns)   (1) include the system error</span>
<span class="sd">        sym   : symetrie factor 0.5 = symetric (0.25)</span>
<span class="sd">        dB    : logscale indicator (True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">-</span> <span class="n">Tint</span> <span class="o">*</span> <span class="n">sym</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tstart</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">tstop</span><span class="p">))</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Etot"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Etot.html#pylayers.signal.bsignal.TUsignal.Etot">[docs]</a>    <span class="k">def</span> <span class="nf">Etot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">taumax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Etot  calculate the energy of the signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau0 : start value for integration</span>
<span class="sd">        dB   : (False default) if True value in dB</span>

<span class="sd">        usage  :</span>

<span class="sd">            s.Etot(tau0=10,dB=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tau0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">taumax</span><span class="p">)</span>
        <span class="n">etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">etot</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">etot</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">etot</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Efirst"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Efirst.html#pylayers.signal.bsignal.TUsignal.Efirst">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toa</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the energy of the first path</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        toa  : float</span>
<span class="sd">            delay value</span>
<span class="sd">        Tint : float</span>
<span class="sd">            duration value (1)</span>
<span class="sd">        sym : float</span>
<span class="sd">            symmetry around delay value ( 0.25)</span>
<span class="sd">        dB : Boolean</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Efirst : Energy amount in the window (in dB if dB)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">toa</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">toa</span><span class="p">))</span>
        <span class="n">efirst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">efirst</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Efirst_corr"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Efirst_corr.html#pylayers.signal.bsignal.TUsignal.Efirst_corr">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">Sx</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate Efirst utilizing the correlation of signal emission et reponse impulsionnelle</span>

<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       tau0</span>
<span class="sd">       Sx</span>
<span class="sd">       Sy</span>
<span class="sd">       dB</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Sy</span> <span class="o">*</span> <span class="n">Sy</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">Correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">seuil</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">seuil</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">seuil</span> <span class="o">/</span> <span class="n">E0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:][</span><span class="n">v</span><span class="p">])</span> <span class="o">/</span> <span class="n">E0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">w0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:][</span><span class="n">vv</span><span class="p">])</span> <span class="o">/</span> <span class="n">E0</span>

        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">Ef</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Ef</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Efirst_toath"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Efirst_toath.html#pylayers.signal.bsignal.TUsignal.Efirst_toath">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst_toath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate Efirst</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau0   : Time of flight</span>
<span class="sd">        Tint</span>
<span class="sd">        sym</span>
<span class="sd">        dB   : if True return value in dBnJ</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">seuil</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">seuil</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toa</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">te</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:][</span><span class="n">v</span><span class="p">])</span>
                <span class="n">toa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">te</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">w0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:][</span><span class="n">vv</span><span class="p">])</span>
                <span class="n">toa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">te</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">toa</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">toa</span> <span class="o">-</span> <span class="n">Tint</span> <span class="o">*</span> <span class="n">sym</span><span class="p">))</span>
        <span class="n">efirst</span> <span class="o">=</span> <span class="n">te</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">efirst</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.taumax"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.taumax.html#pylayers.signal.bsignal.TUsignal.taumax">[docs]</a>    <span class="k">def</span> <span class="nf">taumax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate taumax</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c">#</span>
        <span class="c"># determine time of maximum value of ()^2</span>
        <span class="c">#</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.Emax"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.Emax.html#pylayers.signal.bsignal.TUsignal.Emax">[docs]</a>    <span class="k">def</span> <span class="nf">Emax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the maximum of Energy integrated over a duration Tint</span>

<span class="sd">        A symetry of sym around the max value of the squared signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tint: float</span>
<span class="sd">            Integration time (ns) default 1</span>
<span class="sd">        sym : float</span>
<span class="sd">            Symmetry factor (default 0.5)</span>
<span class="sd">        dB  : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        W1-M1</span>
<span class="sd">        te     = 0.005 ns</span>
<span class="sd">        left  = 12</span>
<span class="sd">        Nright = 33</span>
<span class="sd">        Tint   = 45*te = 0.225 ns</span>
<span class="sd">        sym    = 0.25</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c">#  ( ) ^2</span>
        <span class="c">#</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c">#</span>
        <span class="c"># determine time of maximum value of ()^2</span>
        <span class="c">#</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>

        <span class="n">Npt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Tint</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">Nleft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">sym</span> <span class="o">*</span> <span class="n">Npt</span><span class="p">))</span>
        <span class="n">Nright</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span> <span class="o">*</span> <span class="n">Npt</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c">#  Integration around the maximum value of E^2</span>
        <span class="c">#  In the W1_M1 measurement</span>
        <span class="c">#  te     = 0.005 ns</span>
        <span class="c">#  Nleft  = 12</span>
        <span class="c">#  Nright = 33</span>
        <span class="c">#  Tint   = 45*te = 0.225 ns</span>
        <span class="c">#  sym    = 0.25</span>
        <span class="c">#</span>

        <span class="n">Y</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="n">Nleft</span><span class="p">:</span><span class="n">u</span> <span class="o">+</span> <span class="n">Nright</span><span class="p">]</span>
        <span class="n">cumY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="n">cumY</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Emax</span> <span class="o">=</span> <span class="n">maxY</span> <span class="o">*</span> <span class="n">te</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Emax</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Emax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.tau_Emax"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.tau_Emax.html#pylayers.signal.bsignal.TUsignal.tau_Emax">[docs]</a>    <span class="k">def</span> <span class="nf">tau_Emax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the delay of max energy peak</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau_Emax</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tau_Emax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_max2"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_max2.html#pylayers.signal.bsignal.TUsignal.toa_max2">[docs]</a>    <span class="k">def</span> <span class="nf">toa_max2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival max2 method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">THRE</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="n">VL</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">M</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">THRE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">THRE</span><span class="p">,</span> <span class="n">thre</span><span class="p">))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">VL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span> <span class="n">vl</span><span class="p">))</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">step</span>

    <span class="c">#       while thre &gt; M/1e2:</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
    <span class="c">#       while v &lt; 50:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">vl</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">THRE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">THRE</span><span class="p">,</span> <span class="n">thre</span><span class="p">))</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">VL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span> <span class="n">vl</span><span class="p">))</span>

            <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">THRE</span> <span class="o">/</span> <span class="n">M</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s">&#39;interval number&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">THRE</span> <span class="o">/</span> <span class="n">M</span><span class="p">,</span> <span class="n">VL</span><span class="p">,</span> <span class="s">&#39;-r&#39;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s">&#39;steps&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s">&#39;interval(Left) number&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Gamma/Vmax&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c">#       ylabel(&#39;Interval Number&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_new"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_new.html#pylayers.signal.bsignal.TUsignal.toa_new">[docs]</a>    <span class="k">def</span> <span class="nf">toa_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival (new method) </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">Max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nmax</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nmax</span> <span class="o">&gt;=</span> <span class="mi">6000</span><span class="p">:</span>
            <span class="c">#set the fenetre=6000*0.005=30ns</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">nmax</span> <span class="o">-</span> <span class="mi">6000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">hl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">g</span>

            <span class="n">n_int</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">n_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
                <span class="k">print</span> <span class="n">N</span>

            <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
            <span class="k">if</span> <span class="n">thre</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_win"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_win.html#pylayers.signal.bsignal.TUsignal.toa_win">[docs]</a>    <span class="k">def</span> <span class="nf">toa_win</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calulate time of arrival (window method)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w : parameter between 0 and 100</span>
<span class="sd">        Lei takes w = 9</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxbruit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">])</span>
        <span class="n">Max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">Max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nmax</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="c"># tant delta est plus grande que w% du Max</span>
        <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">w</span> <span class="o">*</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nmax</span> <span class="o">&gt;=</span> <span class="mi">6000</span><span class="p">:</span>
            <span class="c">#set the fenetre=6000*0.005=30ns</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">nmax</span> <span class="o">-</span> <span class="mi">6000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">hl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">g</span>

            <span class="n">n_int</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">n_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">maxbruit</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>

            <span class="k">if</span> <span class="n">thre</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_max"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_max.html#pylayers.signal.bsignal.TUsignal.toa_max">[docs]</a>    <span class="k">def</span> <span class="nf">toa_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        descendant threshold based toa estimation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nint : integer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># seek fot the maximum value of the signal</span>
        <span class="c">#</span>
        <span class="n">M</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e2</span>
    <span class="c">#       plot(self.x,self.y)</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">:</span>
    <span class="c">#          axhline(y=thre,color=&#39;green&#39;)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nint</span><span class="p">:</span>
            <span class="c"># down</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
            <span class="c"># up + step reduction</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c">#       plt.show()</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_th"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_th.html#pylayers.signal.bsignal.TUsignal.toa_th">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thlos</span><span class="p">,</span> <span class="n">thnlos</span><span class="p">,</span> <span class="n">visibility</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        threshold based toa estimation using energy peak</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c">#  ( ) ^2</span>
        <span class="c">#</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="k">if</span> <span class="n">visibility</span> <span class="o">==</span> <span class="s">&#39;LOS&#39;</span><span class="p">:</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">thlos</span> <span class="o">*</span> <span class="n">maxy2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">thnlos</span> <span class="o">*</span> <span class="n">maxy2</span>
        <span class="c">#</span>
        <span class="c">#In the W1-M1 measurement</span>
        <span class="c">#thlos=0.05   thnlos=0.15</span>
        <span class="c">#</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_cum"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_cum.html#pylayers.signal.bsignal.TUsignal.toa_cum">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">th</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        threshold based toa estimation using cumulative energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c">#In the W1-M1 measurement th=0.15</span>
        <span class="c">#</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_th_tmtm"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_th_tmtm.html#pylayers.signal.bsignal.TUsignal.toa_th_tmtm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tmtm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span> <span class="o">/</span>  \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_th_tm"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_th_tm.html#pylayers.signal.bsignal.TUsignal.toa_th_tm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span>
        <span class="k">print</span> <span class="n">alpha</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_th_tmt"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_th_tmt.html#pylayers.signal.bsignal.TUsignal.toa_th_tmt">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">(</span>
        <span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span>
        <span class="k">print</span> <span class="n">alpha</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_cum_tm"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_cum_tm.html#pylayers.signal.bsignal.TUsignal.toa_cum_tm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_cum_tmtm"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_cum_tmtm.html#pylayers.signal.bsignal.TUsignal.toa_cum_tmtm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tmtm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>
</div>
<div class="viewcode-block" id="TUsignal.toa_cum_tmt"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.toa_cum_tmt.html#pylayers.signal.bsignal.TUsignal.toa_cum_tmt">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span>


</div>
<div class="viewcode-block" id="TUsignal.aggcir"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.aggcir.html#pylayers.signal.bsignal.TUsignal.aggcir">[docs]</a>    <span class="k">def</span> <span class="nf">aggcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alphak</span><span class="p">,</span><span class="n">tauk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; aggregation of CIR from (alphak,tauk)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        alphak : float</span>
<span class="sd">            CIR path amplitude</span>
<span class="sd">        tauk : float</span>
<span class="sd">            CIR delay values</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; alphak = 10*np.random.rand(7)</span>
<span class="sd">            &gt;&gt;&gt; tauk = 100*np.random.rand(7)</span>
<span class="sd">            &gt;&gt;&gt; tau = np.arange(0,150,0.1)</span>
<span class="sd">            &gt;&gt;&gt; y = np.zeros(len(tau))</span>
<span class="sd">            &gt;&gt;&gt; CIR = TUsignal(tau,y)</span>
<span class="sd">            &gt;&gt;&gt; CIR.aggcir(alphak,tauk)</span>
<span class="sd">            &gt;&gt;&gt; CIR.plot(typ=&#39;v&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">t</span><span class="o">-</span><span class="n">eps</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">t</span><span class="o">+</span><span class="n">eps</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tauk</span><span class="p">)</span>
        <span class="n">ynew</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">ynew</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphak</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ynew</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

</div>
<div class="viewcode-block" id="TUsignal.readcir"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.readcir.html#pylayers.signal.bsignal.TUsignal.readcir">[docs]</a>    <span class="k">def</span> <span class="nf">readcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; read channel impulse response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            long file name if outdir is []</span>
<span class="sd">            short file name is outdir is &lt;&gt; []</span>
<span class="sd">        outdir : string</span>
<span class="sd">            output directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outdir</span> <span class="o">&lt;&gt;</span> <span class="p">[]:</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="s">&#39;output/&#39;</span><span class="o">+</span><span class="n">outdir</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>

        <span class="n">cir</span> <span class="o">=</span> <span class="n">ios</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cir</span><span class="p">[</span><span class="s">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">cir</span><span class="p">[</span><span class="s">&#39;cir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="TUsignal.readuwb"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.readuwb.html#pylayers.signal.bsignal.TUsignal.readuwb">[docs]</a>    <span class="k">def</span> <span class="nf">readuwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read  Waveform from Matlab file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="s">&#39;output/&#39;</span><span class="o">+</span><span class="n">outdir</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
        <span class="n">wfm</span> <span class="o">=</span> <span class="n">ios</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">wfm</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">T0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e-9</span>
        <span class="n">Tres</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Tres</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e-9</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">WformOut1</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Tres</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TUsignal.ecdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.ecdf.html#pylayers.signal.bsignal.TUsignal.ecdf">[docs]</a>    <span class="k">def</span> <span class="nf">ecdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tnoise</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rem_noise</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">in_positivity</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate energy cumulative density function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tnoise     :</span>
<span class="sd">            Time duration of noise only portion (default=5ns)</span>
<span class="sd">        rem_noise  :</span>
<span class="sd">            remove noise if True</span>
<span class="sd">        in_positivity :</span>
<span class="sd">            inforce positivity if True</span>
<span class="sd">        normalize  :</span>
<span class="sd">            normalize if True (Not implemented)</span>
<span class="sd">        display    :</span>
<span class="sd">            display ecdf if True</span>
<span class="sd">        delay      :</span>
<span class="sd">            give a delay for vizualization</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ecdf , vary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c">#  ( ) ^2</span>
        <span class="c">#</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c">#</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="c"># retrieve the noise only portion at the beginning of TUsignal</span>
        <span class="c">#</span>
        <span class="n">Nnoise</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Tnoise</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">f1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">]</span>
        <span class="n">stdy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">])</span>
        <span class="n">vary</span> <span class="o">=</span> <span class="n">stdy</span> <span class="o">*</span> <span class="n">stdy</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">vary</span>
        <span class="c">#</span>
        <span class="c"># y : linear interpolation of noise ecdf  (over whole time base)</span>
        <span class="c">#</span>
        <span class="c">#(ar,br)= polyfit(tn,fn,1)</span>
        <span class="c">#print ar</span>
        <span class="c">#y  = polyval([ar,br],t)</span>
        <span class="k">if</span> <span class="n">rem_noise</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">-</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f1</span>

        <span class="c">#</span>
        <span class="c"># inforce positivity</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">in_positivity</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pdf</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pdf</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">f</span>
        <span class="c">#</span>
        <span class="c"># Normalization step</span>
        <span class="c">#</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">ecdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#print E</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">ecdf</span> <span class="o">/</span> <span class="n">E</span>
        <span class="c">#</span>
        <span class="c"># Resizing</span>
        <span class="c">#</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">Necdf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecdf</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="n">Necdf</span><span class="p">)</span>
        <span class="n">ecdf</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">],</span> <span class="n">ecdf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
        <span class="c">#</span>
        <span class="c"># Display</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">ecdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ecdf</span><span class="p">,</span> <span class="n">vary</span>
</div>
<div class="viewcode-block" id="TUsignal.tau_moy"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.tau_moy.html#pylayers.signal.bsignal.TUsignal.tau_moy">[docs]</a>    <span class="k">def</span> <span class="nf">tau_moy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate mean excess delay starting from delay tau_0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        alpha : float</span>
<span class="sd">        tau0 : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">pdf</span> <span class="o">=</span> <span class="n">pdf</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">pdf</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
        <span class="n">taum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

        <span class="k">return</span><span class="p">(</span><span class="n">taum</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUsignal.delays"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.delays.html#pylayers.signal.bsignal.TUsignal.delays">[docs]</a>    <span class="k">def</span> <span class="nf">delays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate delay parameters and othogonality factor from cir</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        taum :</span>
<span class="sd">            mean excess delay</span>
<span class="sd">        delayspread</span>
<span class="sd">            rms delay spread</span>
<span class="sd">        of  :</span>
<span class="sd">            orthogonality factor</span>

<span class="sd">        Orthogonality Factor in WCDMA Donlinks in Urban Macrocellular</span>
<span class="sd">        environments : Neelesh Metha, Andreas Molish, Lary Greenstein</span>

<span class="sd">        .. :math:</span>

<span class="sd">            \beta0 = 1 \frac{\sum_i=1^L}|\alpha_i|^4}{\left(\sum_i=1^L|\alpha_i|^2)^2}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flatteny</span><span class="p">(</span><span class="n">reversible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yf</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">yf</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">y2</span><span class="o">*</span><span class="n">y2</span>
        <span class="n">taum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">delayspread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">taum</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">taum</span><span class="p">)</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">of</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">y4</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">taum</span><span class="p">,</span><span class="n">delayspread</span><span class="p">,</span><span class="n">of</span>


</div>
<div class="viewcode-block" id="TUsignal.tau_rms"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUsignal.tau_rms.html#pylayers.signal.bsignal.TUsignal.tau_rms">[docs]</a>    <span class="k">def</span> <span class="nf">tau_rms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; calculate root mean square delay spread starting from delay tau_0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        alpha : float</span>
<span class="sd">        threshold : float</span>
<span class="sd">            ( delay interval is defined between :math:`\tau(\alpha)` and :math:`\tau(1 -\alpha)` )</span>
<span class="sd">        tau0 : float</span>
<span class="sd">            argument for specifying the delay start</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. math::</span>

<span class="sd">            \sqrt{\frac{\int_{\tau(\alpha)}^{\tau(1-\alpha)} (\tau-\tau_m)^{2} PDP(\tau) d\tau} {\int_{\tau(\alpha)}^{\tau(1-\alpha)} PDP(\tau) d\tau}}</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.measures.mesuwb import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; M = UWBMeasure(1)</span>
<span class="sd">            &gt;&gt;&gt; ch4 = M.tdd.ch4</span>
<span class="sd">            &gt;&gt;&gt; f1,a1=ch4.plot(color=&#39;k&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.title(&quot;WHERE1 M1 UWB Channel impulse response&quot;)</span>
<span class="sd">            &gt;&gt;&gt; f2,a2=ch4.plot(color=&#39;k&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.title(&quot;WHERE1 M1 UWB Channel impulse response (Zoom 1)&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ax1=plt.axis([10,160,-90,-50])</span>
<span class="sd">            &gt;&gt;&gt; f3,a3=ch4.plot(color=&#39;k&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.title(&quot;WHERE1 M1 UWB Channel impulse response (Zoom 2)&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ax2=plt.axis([20,120,-80,-50])</span>
<span class="sd">            &gt;&gt;&gt; tau_moy = ch4.tau_moy()</span>
<span class="sd">            &gt;&gt;&gt; print &quot;tau_moy: %2.2f ns&quot; % tau_moy</span>
<span class="sd">            tau_moy: 38.09 ns</span>
<span class="sd">            &gt;&gt;&gt; tau_rms = ch4.tau_rms()</span>
<span class="sd">            &gt;&gt;&gt; print &quot;tau_rms: %2.2f&quot; % tau_rms</span>
<span class="sd">            tau_rms: 13.79 ns</span>



<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        TUsignal.ecdf</span>
<span class="sd">        TUsignal.tau_moy</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="n">pdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">taum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_moy</span><span class="p">(</span><span class="n">tau0</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">pdp</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">pdp</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">taum</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">taum</span><span class="p">))</span>
        <span class="n">taurms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">taurms</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">TUDsignal</span><span class="p">(</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uniform signal in Time domain with delay</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    x   : ndarray</span>
<span class="sd">    y   : ndarray</span>
<span class="sd">    tau : float or ndarray</span>


<span class="sd">    .. todo::</span>
<span class="sd">        build a tunfold time restitution of delays </span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TUDsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUDsignal.__init__.html#pylayers.signal.bsignal.TUDsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">tau</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TUDsigal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#TUsignal.__init__(self, x, y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
</div>
<div class="viewcode-block" id="TUDsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUDsignal.__repr__.html#pylayers.signal.bsignal.TUDsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TUDsignal.fig"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.TUDsignal.fig.html#pylayers.signal.bsignal.TUDsignal.fig">[docs]</a>    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot a figure of the N first signals</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N : int</span>
<span class="sd">            number of y signal to plot</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span>
        <span class="n">ecmax</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Nmax</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Nmax</span><span class="p">))</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">N1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ecmax</span>
        <span class="n">yN1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">N1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">gk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gk</span><span class="p">)</span>
            <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yN1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:])</span>

           <span class="c">#r.plot(x, yN1, main=&#39;Ray response&#39;, xlab=&#39;Time (ns)&#39;, ylab=&#39;y&#39;, type=&#39;l&#39;, col=&#39;black&#39; ,frame=&#39;False&#39;,  ylim=r.range(y1,yN1) )</span>
           <span class="c">#for i in range(N1-1):</span>
           <span class="c">#    yi = self.y[i+1,:] + (N1-i)*ecmax</span>
           <span class="c">#    r.lines(x,yi,col=&#39;black&#39;)</span>

</div>
<span class="k">class</span> <span class="nc">FBsignal</span><span class="p">(</span><span class="n">Bsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FBsignal : Base signal in Frequency domain</span>

<span class="sd">    plot     : plot modulus and phase</span>
<span class="sd">    plotri   : plot real part and imaginary part</span>
<span class="sd">    plotdB   : plot modulus in dB</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FBsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.__init__.html#pylayers.signal.bsignal.FBsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FBsignal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#Bsignal.__init__(self, x, y)</span>
</div>
<div class="viewcode-block" id="FBsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.__repr__.html#pylayers.signal.bsignal.FBsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Bsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FBsignal.plotri"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.plotri.html#pylayers.signal.bsignal.FBsignal.plotri">[docs]</a>    <span class="k">def</span> <span class="nf">plotri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nb</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot real and imaginary part</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nb : int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># plot all</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nb</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Real part&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Imaginary part&#39;</span><span class="p">)</span>
            <span class="c"># plot nb only</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">nb</span><span class="p">]))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Real part&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">nb</span><span class="p">]))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Imaginary part&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Real part&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="c">#plot(self.x,np.unwrap(np.angle(self.y)))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Imaginary part&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FBsignal.plot"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.plot.html#pylayers.signal.bsignal.FBsignal.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot FBsignal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phase : boolean</span>
<span class="sd">            default True</span>
<span class="sd">        dB : boolean</span>
<span class="sd">            default True</span>
<span class="sd">        iy : index of y value to be displayed</span>
<span class="sd">            default [0]  only first the line is displayed</span>

<span class="sd">        Examples </span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; from numpy import *</span>
<span class="sd">        &gt;&gt;&gt; from scipy import *</span>
<span class="sd">        &gt;&gt;&gt; S = FBsignal()</span>
<span class="sd">        &gt;&gt;&gt; S.x = arange(100)</span>
<span class="sd">        &gt;&gt;&gt; S.y = cos(2*pi*S.x)+1j*sin(3*pi*S.x+pi/3)</span>
<span class="sd">        &gt;&gt;&gt; fig,ax = S.plot()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">   </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        Bsignal.plot</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s">&#39;typ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;typ&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;l20&#39;</span><span class="p">]</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Bsignal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="FBsignal.plotdB"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.plotdB.html#pylayers.signal.bsignal.FBsignal.plotdB">[docs]</a>    <span class="k">def</span> <span class="nf">plotdB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; usage : plotdB()</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mask :</span>
<span class="sd">        n :</span>
<span class="sd">        phase :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0e-15</span><span class="p">))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Modulus (dB)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Phase&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0e-15</span><span class="p">))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Modulus (dB)&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">xfcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">0.96</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span>
                                 <span class="mf">1.99</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">,</span> <span class="mf">1.99</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
                <span class="n">xcept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">1.61</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">,</span> <span class="mf">6.</span><span class="p">,</span>
                                  <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mf">10.6</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
                <span class="n">ycept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
                                  <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="o">-</span><span class="mi">65</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">85</span><span class="p">])</span>
                <span class="n">yfcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">53.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">53.3</span><span class="p">,</span>
                                 <span class="o">-</span><span class="mf">53.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">53.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">51.3</span><span class="p">])</span>
                <span class="n">xnoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">15</span><span class="p">])</span>
                <span class="n">ynoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">114.</span><span class="p">,</span> <span class="o">-</span><span class="mi">114</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">xfcc</span><span class="p">,</span> <span class="n">yfcc</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">xcept</span><span class="p">,</span> <span class="n">ycept</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">xnoise</span><span class="p">,</span> <span class="n">ynoise</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;PSD (dBm/MHz)&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0e-15</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Phase&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FBsignal.stem"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FBsignal.stem.html#pylayers.signal.bsignal.FBsignal.stem">[docs]</a>    <span class="k">def</span> <span class="nf">stem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b-&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stem(self,color=&#39;b- &#39;)</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color : string</span>
<span class="sd">           </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ndim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nl</span><span class="p">):</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">color</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;real part)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">color</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;imaginary part)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;real part)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Frequency (GHz)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;imaginary part)&#39;</span><span class="p">)</span>

</div>
<span class="k">class</span> <span class="nc">FUsignal</span><span class="p">(</span><span class="n">FBsignal</span><span class="p">,</span> <span class="n">Usignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FUsignal : Uniform signal in Frequency domain</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    x  : nd.array((1xN))</span>
<span class="sd">    y  : Complex nd.array((M x N )</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    symH     : force Hermitian symetry --&gt; FHsignal</span>
<span class="sd">    symHz    : force Hermitian symetry with zero padding --&gt; FHsignal</span>
<span class="sd">    align    : align two FUsignal on a same frequency base</span>
<span class="sd">    enthrsh  : Energy thresholding thresh = 99.99 %</span>
<span class="sd">    dBthrsh  : dB thresholding thresh  = 40dB</span>
<span class="sd">    ift      : Inverse Fourier transform</span>
<span class="sd">    resample : resampling with a new base</span>
<span class="sd">    newdf    : resampling with a new df</span>
<span class="sd">    zp       : zero padding until len(x) = N</span>
<span class="sd">    plot     : plot modulus and phase</span>
<span class="sd">    plotri   : plot real part and imaginary part</span>
<span class="sd">    plotdB   : plot modulus in dB</span>
<span class="sd">    get      : get k th ray</span>
<span class="sd">    tap      : calculates channel taps</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FUsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__init__.html#pylayers.signal.bsignal.FUsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FUsignal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#FBsignal.__init__(self, x, y)</span>
</div>
<div class="viewcode-block" id="FUsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__repr__.html#pylayers.signal.bsignal.FUsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">FBsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.__add__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__add__.html#pylayers.signal.bsignal.FUsignal.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#U =FUsignal(self.x,self.y+u.y)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.__sub__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__sub__.html#pylayers.signal.bsignal.FUsignal.__sub__">[docs]</a>    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#U =FUsignal(self.x,self.y-u.y)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.__mul__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__mul__.html#pylayers.signal.bsignal.FUsignal.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Normalisation 19/05/2009</span>
        <span class="n">Df</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="c">#rint shape(self.x)</span>
        <span class="c">#rint shape(self.y)</span>
        <span class="c">#rint shape(u.y)</span>
        <span class="c"># =FUsignal(self.x,self.y*u.y)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.__div__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.__div__.html#pylayers.signal.bsignal.FUsignal.__div__">[docs]</a>    <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u1</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="n">u2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="FUsignal.window"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.window.html#pylayers.signal.bsignal.FUsignal.window">[docs]</a>    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">win</span><span class="o">=</span><span class="s">&#39;hamming&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; windowing of FU signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        win : string</span>
<span class="sd">            window type (&#39;hamming&#39;,&#39;blackman&#39;,&#39;hanning&#39;)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; x = np.arange(2,8,0.1)</span>
<span class="sd">            &gt;&gt;&gt; y = np.ones(len(x))</span>
<span class="sd">            &gt;&gt;&gt; U = FUsignal(x,y)</span>
<span class="sd">            &gt;&gt;&gt; fi = plt.figure()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = U.plot()</span>
<span class="sd">            &gt;&gt;&gt; U.window(&#39;hamming&#39;)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = U.plot()</span>




<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Nx</span><span class="p">:</span>
                <span class="n">Ny</span> <span class="o">=</span> <span class="n">shy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Ny</span> <span class="o">=</span> <span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="s">&#39;hamming&#39;</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">win</span> <span class="o">==</span> <span class="s">&#39;blackman&#39;</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="n">Nx</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ind</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ny</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ny</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">w</span>
</div>
<div class="viewcode-block" id="FUsignal.get"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.get.html#pylayers.signal.bsignal.FUsignal.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            get the kh signal</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            k : indes to get</span>

<span class="sd">            Return</span>
<span class="sd">            ------</span>
<span class="sd">            G : FUsignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">()</span>
        <span class="n">G</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">G</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.info.html#pylayers.signal.bsignal.FUsignal.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display Information on the FUsignal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">df</span>
        <span class="k">print</span> <span class="s">&#39;FUsignal&#39;</span>
        <span class="k">print</span> <span class="s">&#39;--------&#39;</span>
        <span class="k">print</span> <span class="s">&#39;N Freq    &#39;</span><span class="p">,</span> <span class="n">N</span>
        <span class="k">print</span> <span class="s">&#39;shape(y)  &#39;</span><span class="p">,</span> <span class="n">sh</span>
        <span class="k">print</span> <span class="s">&#39;Fmin (GHz) : &#39;</span><span class="p">,</span> <span class="n">fmin</span>
        <span class="k">print</span> <span class="s">&#39;Fmax (GHz) : &#39;</span><span class="p">,</span> <span class="n">fmax</span>
        <span class="k">print</span> <span class="s">&#39;Duration (ns) :&#39;</span><span class="p">,</span> <span class="n">T</span>
        <span class="k">print</span> <span class="s">&#39;Frequency sampling step : &#39;</span><span class="p">,</span> <span class="n">df</span>
</div>
<div class="viewcode-block" id="FUsignal.energy"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.energy.html#pylayers.signal.bsignal.FUsignal.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate energy along given axis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        axis : (default 0)</span>
<span class="sd">        Friis :  c/(4 pi fGHz)</span>
<span class="sd">        mode : string</span>
<span class="sd">            mean | center | integ</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; e   = EnImpulse()</span>
<span class="sd">        &gt;&gt;&gt; En1 = e.energy()</span>
<span class="sd">        &gt;&gt;&gt; assert((En1&gt;0.99) &amp; (En1&lt;1.01))</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

        <span class="k">if</span> <span class="n">Friis</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">H</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

        <span class="n">MH2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">EMH2</span>  <span class="o">=</span> <span class="n">MH2</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s">&#39;integ&#39;</span><span class="p">:</span>
            <span class="n">EMH2</span>  <span class="o">=</span> <span class="n">MH2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s">&#39;center&#39;</span><span class="p">:</span>
            <span class="n">EMH2</span>  <span class="o">=</span> <span class="n">MH2</span><span class="p">[:,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">EMH2</span><span class="p">)</span>
     </div>
<div class="viewcode-block" id="FUsignal.applyFriis"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.applyFriis.html#pylayers.signal.bsignal.FUsignal.applyFriis">[docs]</a>    <span class="k">def</span> <span class="nf">applyFriis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">factor</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
         
		 
		 
		 
		 
		 
		 
		 
		 
</div>
<div class="viewcode-block" id="FUsignal.enthrsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.enthrsh.html#pylayers.signal.bsignal.FUsignal.enthrsh">[docs]</a>    <span class="k">def</span> <span class="nf">enthrsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mf">99.99</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Energy thresholding of an FUsignal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        thresh : float</span>
<span class="sd">            threshold in percentage (default 99.99)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        EMH2 : cumul energie H</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">MH2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
        <span class="n">EMH2</span> <span class="o">=</span> <span class="n">MH2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">EMH2max</span> <span class="o">=</span> <span class="n">EMH2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">ind1</span> <span class="o">=</span> <span class="n">EMH2</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="n">ind1rev</span> <span class="o">=</span> <span class="n">ind1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">]</span>
        <span class="n">EMH2sorted</span> <span class="o">=</span> <span class="n">EMH2</span><span class="p">[</span><span class="n">ind1rev</span><span class="p">]</span>

        <span class="n">EMH2cum</span> <span class="o">=</span> <span class="n">EMH2sorted</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
        <span class="n">EMH2cumnor</span> <span class="o">=</span> <span class="n">EMH2cum</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">EMH2cum</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">EMH2cumnor</span> <span class="o">&lt;</span> <span class="n">thresh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">ind1rev</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">indices</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">indices</span>
</div>
<div class="viewcode-block" id="FUsignal.dBthrsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.dBthrsh.html#pylayers.signal.bsignal.FUsignal.dBthrsh">[docs]</a>    <span class="k">def</span> <span class="nf">dBthrsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshdB</span><span class="o">=</span><span class="mi">40</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        dBthrsh : dB thresholding of an FUsignal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">MH2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">H</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">H</span><span class="p">))</span>
        <span class="n">EMH2</span> <span class="o">=</span> <span class="n">MH2</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">EMH2dB</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">EMH2</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">EMH2dB</span>
        <span class="n">EMH2dBmax</span> <span class="o">=</span> <span class="n">EMH2dB</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">ind1</span> <span class="o">=</span> <span class="n">EMH2</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">ind1</span>

        <span class="n">EMH2dBsorted</span> <span class="o">=</span> <span class="n">EMH2dB</span><span class="p">[</span><span class="n">ind1</span><span class="p">]</span>
        <span class="n">ind2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">EMH2dBsorted</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">EMH2dBmax</span> <span class="o">-</span> <span class="n">threshdB</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">ind1</span><span class="p">[</span><span class="n">ind2</span><span class="p">]</span>
        <span class="k">print</span> <span class="n">indices</span>
        <span class="k">return</span> <span class="n">indices</span>
</div>
<div class="viewcode-block" id="FUsignal.zp"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.zp.html#pylayers.signal.bsignal.FUsignal.zp">[docs]</a>    <span class="k">def</span> <span class="nf">zp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; zero padding until length N</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FUsignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sh</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">N2</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">N0</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">N0</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N1</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">ex</span><span class="p">))</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">ey</span><span class="p">))</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.newdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.newdf.html#pylayers.signal.bsignal.FUsignal.newdf">[docs]</a>    <span class="k">def</span> <span class="nf">newdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; resample the FUsignal using phase and module interpolation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            df</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            U : FUsignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">module</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">df0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">argu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>
        <span class="n">fm</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
        <span class="n">fa</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">argu</span><span class="p">)</span>
        <span class="n">f_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">df</span><span class="p">)</span>
        <span class="n">mod_new</span> <span class="o">=</span> <span class="n">fm</span><span class="p">(</span><span class="n">f_new</span><span class="p">)</span>
        <span class="n">arg_new</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">f_new</span><span class="p">)</span>
        <span class="n">y_new</span> <span class="o">=</span> <span class="n">mod_new</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg_new</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg_new</span><span class="p">)</span>
                           <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">f_new</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">f_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.dftresamp"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.dftresamp.html#pylayers.signal.bsignal.FUsignal.dftresamp">[docs]</a>    <span class="k">def</span> <span class="nf">dftresamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_new</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">FH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symH</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">FH</span><span class="o">.</span><span class="n">ifft</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="FUsignal.resample"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.resample.html#pylayers.signal.bsignal.FUsignal.resample">[docs]</a>    <span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        resample(self,x_new,kind=&#39;linear&#39;):</span>

<span class="sd">        This function resample the Usignal with a new x base</span>
<span class="sd">        which needs to be strictly included in the original x</span>
<span class="sd">        base of the Usignal.</span>
<span class="sd">        x is a 1D array</span>
<span class="sd">        y is a 2D array</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;linear&#39;</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">argu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>
            <span class="n">fm</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">module</span><span class="p">)</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">argu</span><span class="p">)</span>

            <span class="n">mod_new</span> <span class="o">=</span> <span class="n">fm</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
            <span class="n">arg_new</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="n">mod_new</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg_new</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg_new</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;spline&#39;</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">argu</span> <span class="o">=</span> <span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
            <span class="n">coefm</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">coefa</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">argu</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">mod_new</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">coefm</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">arg_new</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">coefa</span><span class="p">,</span> <span class="n">der</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">y_new</span> <span class="o">=</span> <span class="n">mod_new</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arg_new</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arg_new</span><span class="p">))</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.symH"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.symH.html#pylayers.signal.bsignal.FUsignal.symH">[docs]</a>    <span class="k">def</span> <span class="nf">symH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; enforce Hermitian symetry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        parity : integer</span>
<span class="sd">            0 even 1 odd</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        FHsignal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">ndim</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">ze_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ndim</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ze_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">parity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ze_y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ze_y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ze_x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ze_y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">U</span><span class="p">))),</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ze_x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">f</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">Up</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">V</span>
</div>
<div class="viewcode-block" id="FUsignal.symHz"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.symHz.html#pylayers.signal.bsignal.FUsignal.symHz">[docs]</a>    <span class="k">def</span> <span class="nf">symHz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Force Hermitian symmetry with zero padding</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz :  int</span>
<span class="sd">            Number of zero above f[-1]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SH : FHsignal</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>

<span class="sd">        The signal is rescaled in order to conserve energy</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        FHSignal</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; N     = 11</span>
<span class="sd">        &gt;&gt;&gt; x     = np.linspace(2,11,N)</span>
<span class="sd">        &gt;&gt;&gt; y1    = sp.randn(N)+1j*sp.rand(N)</span>
<span class="sd">        &gt;&gt;&gt; y2    = sp.randn(N)+1j*sp.rand(N)</span>
<span class="sd">        &gt;&gt;&gt; y1[0] = 0</span>
<span class="sd">        &gt;&gt;&gt; y2[0] = 0</span>
<span class="sd">        &gt;&gt;&gt; y     = np.vstack((y1,y2))</span>
<span class="sd">        &gt;&gt;&gt; S     = FUsignal(x,y)</span>
<span class="sd">        &gt;&gt;&gt; S.symHz(10)</span>
<span class="sd">        FHsignal :  (48,)  (2, 48)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">Nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">df</span><span class="p">))</span>

        <span class="n">ndim</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">ndim</span>
        <span class="c">#</span>
        <span class="c"># nline first dimension of self.y</span>
        <span class="c">#</span>
        <span class="n">nline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">U</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">zl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nline</span><span class="p">,</span> <span class="n">Nl</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nl</span><span class="p">)</span>

        <span class="k">if</span>  <span class="n">Nz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">zh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nline</span><span class="p">,</span> <span class="n">Nz</span><span class="p">])</span>
                <span class="n">UZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">U</span><span class="p">,</span> <span class="n">zh</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">UZF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">UZ</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">zh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span>
                <span class="n">UZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">U</span><span class="p">,</span> <span class="n">zh</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">UZF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">UZ</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># frequency base is divided into two parts</span>
        <span class="c">#</span>
        <span class="c"># fl [ 0 , (Nl-1) *df ]</span>
        <span class="c"># fh [ f[-1]+df , f[-1] + Nz *df ]</span>
        <span class="c">#</span>
        <span class="n">fl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">Nl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="n">Nl</span><span class="p">)</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Nz</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="n">Nz</span><span class="p">)</span>
        <span class="n">fz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">fh</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">zl</span><span class="p">,</span> <span class="n">UZ</span><span class="p">,</span> <span class="n">UZF</span><span class="p">,</span> <span class="n">zl</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fl</span><span class="p">,</span> <span class="n">fz</span><span class="p">,</span> <span class="n">fz</span> <span class="o">+</span> <span class="n">fz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">fl</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">Nfp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="p">((</span><span class="n">Nfp</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">V</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">Up</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">V</span>
</div>
<div class="viewcode-block" id="FUsignal.align"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.align.html#pylayers.signal.bsignal.FUsignal.align">[docs]</a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; align 2 FUsignal</span>

<span class="sd">        align &lt;=&gt; intersection</span>
<span class="sd">        align : align two FUsignal on a same base</span>
<span class="sd">            return a list which contains the two aligned signals</span>

<span class="sd">        &gt;&gt;&gt; i1 = EnImpulse()</span>
<span class="sd">        &gt;&gt;&gt; i2 = EnImpulse()</span>
<span class="sd">        &gt;&gt;&gt; i2.translate(-10)</span>
<span class="sd">        &gt;&gt;&gt; L  = i1.align(i2)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">u1</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">dx1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">dx2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">u1_start</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u2_start</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u1_stop</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">u2_stop</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># it starts at the maximum of both signal</span>
        <span class="c">#    stops  at the minimum of both signal</span>
        <span class="n">xstart</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">u1_start</span><span class="p">,</span> <span class="n">u2_start</span><span class="p">)</span>
        <span class="n">xstop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">u1_stop</span><span class="p">,</span> <span class="n">u2_stop</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dx1</span><span class="p">,</span> <span class="n">dx2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tstincl</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Warning: Impossible to align the 2 signals&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dx1</span> <span class="o">&lt;=</span> <span class="n">dx2</span><span class="p">):</span>

            <span class="n">xnew</span> <span class="o">=</span> <span class="n">ininter</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">)</span>

            <span class="n">dim1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
            <span class="n">pstart1</span> <span class="o">=</span> <span class="n">findpos</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xnew</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pstop1</span> <span class="o">=</span> <span class="n">pstart1</span> <span class="o">+</span> <span class="n">findpos</span><span class="p">(</span><span class="n">u1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">pstart1</span><span class="p">:</span><span class="n">dim1</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">pstart1</span><span class="p">,</span> <span class="n">pstop1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">u2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dx2</span> <span class="o">&lt;</span> <span class="n">dx1</span><span class="p">):</span>

            <span class="n">xnew</span> <span class="o">=</span> <span class="n">ininter</span><span class="p">(</span><span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">xstop</span><span class="p">)</span>

            <span class="n">dim2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">len</span><span class="p">()</span>
            <span class="n">pstart2</span> <span class="o">=</span> <span class="n">findpos</span><span class="p">(</span><span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xnew</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pstop2</span> <span class="o">=</span> <span class="n">pstart2</span> <span class="o">+</span> <span class="n">findpos</span><span class="p">(</span><span class="n">u2</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">pstart2</span><span class="p">:</span><span class="n">dim2</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">u2</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">pstart2</span><span class="p">,</span> <span class="n">pstop2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">u1</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.ifft"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.ifft.html#pylayers.signal.bsignal.FUsignal.ifft">[docs]</a>    <span class="k">def</span> <span class="nf">ifft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npt</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Npt : int</span>
<span class="sd">            default -1 (same number as x) </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Npt</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">Npt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">ifft</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Npt</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df</span><span class="p">,</span> <span class="n">Npt</span><span class="p">)</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tc</span>
</div>
<div class="viewcode-block" id="FUsignal.ift"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.ift.html#pylayers.signal.bsignal.FUsignal.ift">[docs]</a>    <span class="k">def</span> <span class="nf">ift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; inverse Fourier transform returns the associated TUsignal</span>

<span class="sd">        Algorithm</span>
<span class="sd">        ---------</span>
<span class="sd">            1) Force Hermitian symmetry --&gt; FHsignal</span>
<span class="sd">                with or without zero padding</span>
<span class="sd">            2) Inverse Fourier transform</span>
<span class="sd">                with or without fftshift</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz   : Number of zeros (-1) No forcing</span>
<span class="sd">        ffts : 0 (no fftshift 1:fftshift)</span>

<span class="sd">        &gt;&gt;&gt; e  = EnImpulse()</span>
<span class="sd">        &gt;&gt;&gt; E  = e.fft()</span>
<span class="sd">        &gt;&gt;&gt; EU = E.unrex()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># forcage de symetrie Hermitienne</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Nz</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">UH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symH</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">UH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symHz</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span>
        <span class="c"># retour en temps</span>
        <span class="n">uh</span> <span class="o">=</span> <span class="n">UH</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">ffts</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">uh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.iftshift"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.iftshift.html#pylayers.signal.bsignal.FUsignal.iftshift">[docs]</a>    <span class="k">def</span> <span class="nf">iftshift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the associated TUsignal</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        apply the inverse fftshift operator to come back in time</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Nz</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">UH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symH</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">UH</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symHz</span><span class="p">(</span><span class="n">Nz</span><span class="p">)</span>

        <span class="n">uh</span> <span class="o">=</span> <span class="n">UH</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#uh.y=fliplr(fftshift(fliplr(uh.y)))</span>
        <span class="n">uh</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">flipud</span><span class="p">(</span><span class="n">fftshift</span><span class="p">(</span><span class="n">flipud</span><span class="p">(</span><span class="n">uh</span><span class="o">.</span><span class="n">y</span><span class="p">)))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">uh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUsignal.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.show.html#pylayers.signal.bsignal.FUsignal.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; pcolor visualization of Modulus and Phase</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;l20&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax2</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;d&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]</span>
<span class="c">#       def fig(self,N):</span>
<span class="c">#          &quot;&quot;&quot;</span>
<span class="c">#          &quot;&quot;&quot;</span>
<span class="c">#          x = self.x</span>
<span class="c">#          min   = abs(self.y).min()</span>
<span class="c">#          max   = abs(self.y).max()</span>
<span class="c">#          ec    = max-min</span>
<span class="c">#          ecmax = ec.max()</span>
<span class="c">#          sh = shape(self.y)</span>
<span class="c">#          Nmax    = sh[0]</span>
<span class="c">#          N1    = int(minimum(N,Nmax))</span>
<span class="c">#          y1    = abs(self.y)[0,:] + (N1-1)*ecmax</span>
<span class="c">#          yN1   = abs(self.y)[N1-1,:]</span>
<span class="c">#          r.par(yaxt=&quot;n&quot;)</span>
<span class="c">#          r.plot(x, yN1, main=&#39;Ray Transfer function&#39;, xlab=&#39;Freq (GHz)&#39;, ylab=&#39;&#39;, type=&#39;l&#39;, col=&#39;black&#39; ,frame=&#39;False&#39;,  ylim=r.range(y1,yN1) )</span>
<span class="c">#          for i in range(N1-1):</span>
<span class="c">#              yi = abs(self.y)[i+1,:] + (N1-(i+1))*ecmax</span>
<span class="c">#              r.lines(x,yi,col=&#39;black&#39;)</span>
</div>
<div class="viewcode-block" id="FUsignal.decimate"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.decimate.html#pylayers.signal.bsignal.FUsignal.decimate">[docs]</a>    <span class="k">def</span> <span class="nf">decimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; decimate FUsignal by N</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N : int</span>
<span class="sd">            decimation factor (default 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">xn</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">u</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yn</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="n">V</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FUsignal.tap"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUsignal.tap.html#pylayers.signal.bsignal.FUsignal.tap">[docs]</a>    <span class="k">def</span> <span class="nf">tap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate channel tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>
<span class="sd">            center frequency GHz</span>
<span class="sd">        WGHz :  float</span>
<span class="sd">            bandwidth GHz</span>
<span class="sd">        Ntap :  number of taps</span>
<span class="sd">        baseband : boolean</span>
<span class="sd">            default : True</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        see [Tse] http://www.eecs.berkeley.edu/~dtse/Chapters_PDF/Fundamentals_Wireless_Communication_chapter2.pdf</span>
<span class="sd">        page 26</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s">&#39;WMHz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;Ntap&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
                    <span class="s">&#39;baseband&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fcGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">WGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;WMHz&#39;</span><span class="p">]</span>
        <span class="n">Ntap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Ntap&#39;</span><span class="p">]</span>
        <span class="c"># yb : tau x f x 1</span>
        <span class="k">if</span> <span class="n">baseband</span><span class="p">:</span>
            <span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">*</span> <span class="n">fcGHz</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c"># l : 1 x 1 x tap</span>
        <span class="n">l</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntap</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="c"># l : tau x 1 x 1</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c"># S : tau x f x tap (form 2.34 [Tse])</span>
        <span class="n">S</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">tau</span><span class="o">*</span><span class="n">WMHz</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="c"># sum over tau : htap : f x tap</span>
        <span class="n">htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yb</span><span class="o">*</span><span class="n">S</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># sum over frequency axis : htapi : tap</span>
        <span class="c"># to be considered !! what about the frequency step</span>
        <span class="n">htapi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">htapi</span>


</div>
<span class="k">class</span> <span class="nc">FUDsignal</span><span class="p">(</span><span class="n">FUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FUDsignal : Uniform signal in Frequency domain with delays</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    x    : ndarray 1xN</span>
<span class="sd">    y    : ndarray MxN</span>
<span class="sd">    tau0 : delay</span>
<span class="sd">    tau1 : additional delay</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    minphas : force minimal phase    (Not tested)</span>
<span class="sd">    totud   : transform to a TUD signal</span>
<span class="sd">    iftd    : inverse Fourier transform</span>
<span class="sd">    ft1     : construct CIR from ifft(RTF)</span>
<span class="sd">    ft2     :</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FUDsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.__init__.html#pylayers.signal.bsignal.FUDsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">tau0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="n">FUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span> <span class="o">=</span> <span class="n">tau0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau1</span> <span class="o">=</span> <span class="mf">0.0</span>
</div>
<div class="viewcode-block" id="FUDsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.__repr__.html#pylayers.signal.bsignal.FUDsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUDsignal.minphas"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.minphas.html#pylayers.signal.bsignal.FUDsignal.minphas">[docs]</a>    <span class="k">def</span> <span class="nf">minphas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; construct a minimal phase FUsignal</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        - Evaluate slope of the phase</span>
<span class="sd">        - deduce delay</span>
<span class="sd">        - update delay of FUDSignal</span>
<span class="sd">        - Compensation of phase slope to obtain minimal phase</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="n">phase</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phase</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">slope</span> <span class="o">=</span> <span class="n">dphi</span> <span class="o">/</span> <span class="n">df</span>
        <span class="c">#if slope &gt;0:</span>
        <span class="c">#   print &#39;minphas Warning : non causal FUSignal&#39;</span>
        <span class="c">#phi0      = +1j*slope*(f[-1]+f[0]/2)</span>
        <span class="n">F</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>
        <span class="c">#E   = exp(-1j*slope*f+phi0)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">F</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau1</span> <span class="o">=</span> <span class="o">-</span><span class="n">slope</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUDsignal.totud"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.totud.html#pylayers.signal.bsignal.FUDsignal.totud">[docs]</a>    <span class="k">def</span> <span class="nf">totud</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; transform to TUDsignal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz     : int</span>
<span class="sd">            Number of zeros for zero padding</span>
<span class="sd">        ffts   : nt</span>
<span class="sd">            fftshift indicator (default 0 )</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau1</span>
        <span class="n">Nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">tud</span> <span class="o">=</span> <span class="n">TUDsignal</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tud</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUDsignal.iftd"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.iftd.html#pylayers.signal.bsignal.FUDsignal.iftd">[docs]</a>    <span class="k">def</span> <span class="nf">iftd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tstart</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">tstop</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time pasting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz : int</span>
<span class="sd">        tstart : float</span>
<span class="sd">        tstop  : float</span>
<span class="sd">        ffts   : int</span>
<span class="sd">            fftshift indicator</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span>
        <span class="n">Nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">yini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nray</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)))</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">yini</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># initializes a void signal</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nray</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)))</span>
            <span class="n">si</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
            <span class="n">rf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">y</span>
        <span class="k">return</span> <span class="n">rf</span>
</div>
<div class="viewcode-block" id="FUDsignal.ft1"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.ft1.html#pylayers.signal.bsignal.FUDsignal.ft1">[docs]</a>    <span class="k">def</span> <span class="nf">ft1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  construct CIR from ifft(RTF)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz   : number of zeros for zero padding</span>
<span class="sd">        ffts : fftshift indicator</span>
<span class="sd">            0  no fftshift</span>
<span class="sd">            1  apply fftshift</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        r : TUsignal</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)):</span>
                <span class="n">si</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
            <span class="k">return</span> <span class="n">r</span>
</div>
<div class="viewcode-block" id="FUDsignal.ftau"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.ftau.html#pylayers.signal.bsignal.FUDsignal.ftau">[docs]</a>    <span class="k">def</span> <span class="nf">ftau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time superposition</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Nz  : number of zeros for zero padding</span>
<span class="sd">        k   : starting index</span>
<span class="sd">        ffts = 0  no fftshift</span>
<span class="sd">        ffts = 1  apply fftshift</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        r : TUsignal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
        <span class="k">return</span> <span class="n">r</span>
</div>
<div class="viewcode-block" id="FUDsignal.cir"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.cir.html#pylayers.signal.bsignal.FUDsignal.cir">[docs]</a>    <span class="k">def</span> <span class="nf">cir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fGHzmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fGHzmax</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">fGHzmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">&lt;</span><span class="n">fGHzmax</span><span class="p">)</span>
        <span class="n">cir</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FUDsignal.plot3d"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.plot3d.html#pylayers.signal.bsignal.FUDsignal.plot3d">[docs]</a>    <span class="k">def</span> <span class="nf">plot3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; N = 2</span>
<span class="sd">        &gt;&gt;&gt; fGHz = np.arange(1,3,1)</span>
<span class="sd">        &gt;&gt;&gt; tau0 = np.sort(np.random.rand(N))</span>
<span class="sd">        &gt;&gt;&gt; alpha = np.random.rand(N,len(fGHz))</span>
<span class="sd">        &gt;&gt;&gt; s = FUDsignal(x=fGHz,y=alpha,tau0=tau0)</span>
<span class="sd">        &gt;&gt;&gt; s.plot3d()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ntau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nf</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fig</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="n">k</span><span class="p">])):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],[</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">color</span><span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Delay (ns)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Frequency (fGHz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">powermin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">powermax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Power (linear)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">powermin</span><span class="p">,</span><span class="n">powermax</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="FUDsignal.ft2"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDsignal.ft2.html#pylayers.signal.bsignal.FUDsignal.ft2">[docs]</a>    <span class="k">def</span> <span class="nf">ft2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build channel transfer function (frequency domain)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        df : float</span>
<span class="sd">            frequency step (default 0.01)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. get  fmin and fmax</span>
<span class="sd">        2. build a new base with frequency step df</span>
<span class="sd">        3. Initialize a FUsignal with the new frequency base</span>
<span class="sd">        4. build  matrix tau * f  (Nray x Nf)</span>
<span class="sd">        5. buildl matrix E= exp(-2 j pi f tau)</span>
<span class="sd">        6. resampling of FUDsignal according to f --&gt; S</span>
<span class="sd">        7. apply the element wise product E .* S</span>
<span class="sd">        8. add all rays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>

        <span class="n">TAUF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">TAUF</span><span class="p">)</span>

        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">ES</span> <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">y</span>
        <span class="n">V</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ES</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">U</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">V</span>

        <span class="k">return</span> <span class="n">U</span>


</div>
<span class="k">class</span> <span class="nc">FUDAsignal</span><span class="p">(</span><span class="n">FUDsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; FUDAsignal : Frequency domain Uniform signal with Delays and Angles</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    x    : ndarray 1xN</span>
<span class="sd">    y    : ndarray MxN</span>
<span class="sd">    tau0 : delay</span>
<span class="sd">    tau1 : additional delay</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    minphas : force minimal phase    (Not tested)</span>
<span class="sd">    totud   : transform to a TUD signal</span>
<span class="sd">    iftd    : inverse Fourier transform</span>
<span class="sd">    ft1     : construct CIR from ifft(RTF)</span>
<span class="sd">    ft2     :</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FUDAsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.__init__.html#pylayers.signal.bsignal.FUDAsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                 <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                 <span class="n">tau0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                 <span class="n">dod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                 <span class="n">doa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>

        <span class="n">FUDsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">tau0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span>  <span class="o">=</span> <span class="n">dod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span>  <span class="o">=</span> <span class="n">doa</span>
</div>
<div class="viewcode-block" id="FUDAsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.__repr__.html#pylayers.signal.bsignal.FUDAsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">FUDsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FUDAsignal.cut"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.cut.html#pylayers.signal.bsignal.FUDAsignal.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.99</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cut the signal at an Energy threshold level</span>

<span class="sd">        threshold : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;energy&#39;</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eprfl</span><span class="p">()</span>
        <span class="n">cumE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumE</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">v</span><span class="p">,:]</span>
</div>
<div class="viewcode-block" id="FUDAsignal.sort"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.sort.html#pylayers.signal.bsignal.FUDAsignal.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;tau&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sort FUD signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ  : string</span>
<span class="sd">            which parameter to sort &#39;</span>
<span class="sd">                tau : (default)</span>
<span class="sd">                energy</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;tau&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;energy&#39;</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eprfl</span><span class="p">()</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">E</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
</div>
<div class="viewcode-block" id="FUDAsignal.showtap"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.showtap.html#pylayers.signal.bsignal.FUDAsignal.showtap">[docs]</a>    <span class="k">def</span> <span class="nf">showtap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; showtap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># f x s  x m x tap</span>

        <span class="n">htap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c"># sum over time m</span>
        <span class="n">Et_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">htap</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">Nm</span>
        <span class="c"># sum over s</span>
        <span class="n">Er_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ns</span>
        <span class="n">corrtap</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="FUDAsignal.tap"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FUDAsignal.tap.html#pylayers.signal.bsignal.FUDAsignal.tap">[docs]</a>    <span class="k">def</span> <span class="nf">tap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate channel tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>
<span class="sd">            center frequency</span>
<span class="sd">        WMHz : floar</span>
<span class="sd">            bandwidth</span>
<span class="sd">        Ntap : int</span>
<span class="sd">            number of taps (related to bandwith)</span>
<span class="sd">            as the bandwith increases the potential number of taps increases</span>
<span class="sd">        Ns : int</span>
<span class="sd">            number of spatial realizations</span>
<span class="sd">        Nm : int</span>
<span class="sd">            number of time samples</span>
<span class="sd">            the channel is sample along a distance of half a wavelength</span>
<span class="sd">        Va : velocity of link termination a</span>
<span class="sd">        Vb : velocity of link termination b</span>
<span class="sd">        theta_va : float</span>
<span class="sd">            theta velocity termination a (in radians)</span>
<span class="sd">        phi_va  :</span>
<span class="sd">            phi  velocity termination a (in radians)</span>
<span class="sd">        theta_vb:</span>
<span class="sd">            theta velocity termination b (in radians)</span>
<span class="sd">        phi_vb  :</span>
<span class="sd">            phi velocity termination b (in radians)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s">&#39;WMHz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;Ntap&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                    <span class="s">&#39;Ns&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                    <span class="s">&#39;Nm&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                    <span class="s">&#39;Va&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="c">#meter/s</span>
                    <span class="s">&#39;Vb&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="c">#meter/s</span>
                    <span class="s">&#39;theta_va&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s">&#39;phi_va&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s">&#39;theta_vb&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s">&#39;phi_vb&#39;</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fcGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">WMHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;WMHz&#39;</span><span class="p">]</span>
        <span class="n">Ntap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Ntap&#39;</span><span class="p">]</span>
        <span class="n">Ns</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="n">Nm</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Nm&#39;</span><span class="p">]</span>
        <span class="n">Va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Va&#39;</span><span class="p">]</span>
        <span class="n">Vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;Vb&#39;</span><span class="p">]</span>
        <span class="c"># direction of link termination velocity vectors</span>
        <span class="n">theta_va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;theta_va&#39;</span><span class="p">]</span>
        <span class="n">theta_vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;theta_vb&#39;</span><span class="p">]</span>
        <span class="n">phi_va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;phi_va&#39;</span><span class="p">]</span>
        <span class="n">phi_vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;phi_vb&#39;</span><span class="p">]</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="n">mmax</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">fcGHz</span><span class="o">*</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="n">Vb</span><span class="p">))</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fcGHz</span>
        <span class="n">lamo2</span> <span class="o">=</span> <span class="n">lam</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">fmaHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Va</span><span class="o">/</span><span class="mf">0.3</span><span class="p">)</span><span class="o">*</span><span class="n">fcGHz</span>
        <span class="n">fmbHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vb</span><span class="o">/</span><span class="mf">0.3</span><span class="p">)</span><span class="o">*</span><span class="n">fcGHz</span>
        <span class="c"># Coherence Time</span>
        <span class="n">Tca</span> <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fmaHz</span><span class="p">)</span>
        <span class="n">Tcb</span> <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fmbHz</span><span class="p">)</span>
        <span class="n">Tc</span>  <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">fmaHz</span><span class="o">+</span><span class="n">fmbHz</span><span class="p">))</span>

        <span class="c"># DoD DoA</span>

        <span class="n">theta_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phi_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">theta_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phi_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># 3 x r</span>
        <span class="n">ska</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_a</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_a</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)])</span>
        <span class="n">skb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_b</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_b</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)])</span>

        <span class="c"># Monte Carlo for spatial realization</span>
        <span class="c"># s x m x tap</span>
        <span class="n">ua0</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_va</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">va0</span> <span class="o">=</span>  <span class="n">phi_va</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ub0</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_vb</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">vb0</span> <span class="o">=</span>  <span class="n">phi_vb</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="c"># standard deviation of  velocity vector orientation is inversely</span>
        <span class="c"># proportional to velocity magnitude</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">ua0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">va</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">va0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Vb</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">ub0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Vb</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">vb0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="c"># uniform sampling over the sphere</span>
        <span class="n">tha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">va</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pha</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ua</span>
        <span class="n">thb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">vb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">phb</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ub</span>

        <span class="n">vax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>
        <span class="n">vay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>
        <span class="n">vaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pha</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vaxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vax</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">vay</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>
        <span class="n">va</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vaxy</span><span class="p">,</span><span class="n">vaz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="n">vbx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phb</span><span class="p">)</span>
        <span class="n">vby</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phb</span><span class="p">)</span>
        <span class="n">vbz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phb</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vbxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vbx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">vby</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="c"># 3 x r x f x s x m x tap</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vbxy</span><span class="p">,</span><span class="n">vbz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="c"># beta : r x f x s x m x tap</span>
        <span class="n">betaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ska</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">va</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">betab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">skb</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">vb</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


        <span class="c"># m discrete time axis</span>
        <span class="c"># r x f x s x m x tap</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mmax</span><span class="p">,</span><span class="n">Nm</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c"># r x f x s x m x tap</span>
        <span class="n">l</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntap</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="c"># l : r x f x s x m x tap</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">ba</span>  <span class="o">=</span> <span class="n">betaa</span><span class="o">*</span><span class="n">Va</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="n">bb</span>  <span class="o">=</span> <span class="n">betab</span><span class="o">*</span><span class="n">Vb</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="n">tau2</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">+</span> <span class="n">ba</span> <span class="o">+</span> <span class="n">bb</span>
        <span class="c"># S : r x f x s x m x tap (form 2.34 [D. Tse])</span>
        <span class="n">S</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">tau2</span><span class="o">*</span><span class="n">WMHz</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="c"># sum over r :  f x s  x m x tap</span>
        <span class="n">htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fcGHz</span><span class="o">*</span><span class="n">tau2</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># f x s  x m x tap</span>
        <span class="n">htap</span>  <span class="o">=</span> <span class="n">htap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Ns</span><span class="p">,</span><span class="n">Nm</span><span class="p">,</span><span class="n">Ntap</span><span class="p">)</span>
        <span class="n">Et_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">htap</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">Nm</span>
        <span class="n">Er_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ns</span>
        <span class="n">corrtap</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">Et_htap</span><span class="p">,</span><span class="n">Er_htap</span><span class="p">,</span><span class="n">corrtap</span><span class="p">)</span>
</div>
<span class="k">class</span> <span class="nc">FHsignal</span><span class="p">(</span><span class="n">FUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FHsignal : Hermitian uniform signal in Frequency domain</span>

<span class="sd">    ifft  : inverse Fourier transform --&gt; TUsignal</span>
<span class="sd">    unrex : unredundant extraction    --&gt; FUsignal</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FHsignal.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FHsignal.__init__.html#pylayers.signal.bsignal.FHsignal.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="n">FUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FHsignal.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FHsignal.__repr__.html#pylayers.signal.bsignal.FHsignal.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FHsignal.__mul__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FHsignal.__mul__.html#pylayers.signal.bsignal.FHsignal.__mul__">[docs]</a>    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="c"># rescaling 19/05/2009</span>
        <span class="c">#Df= x[1]-x[0]</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">FHsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FHsignal.ifft"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FHsignal.ifft.html#pylayers.signal.bsignal.FHsignal.ifft">[docs]</a>    <span class="k">def</span> <span class="nf">ifft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tt</span><span class="o">=</span><span class="s">&#39;centered&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inverse Fourier Transform</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            ffts = 0 : no fftshift (default)</span>
<span class="sd">            ffts = 1 : apply fftshift</span>
<span class="sd">            tt = &#39;centered&#39;  default</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">            return a real TUsignal</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; e  = EnImpulse(fe=200)</span>
<span class="sd">        &gt;&gt;&gt; E  = e.fft()</span>
<span class="sd">        &gt;&gt;&gt; ee = E.ifft()</span>
<span class="sd">        &gt;&gt;&gt; assert(abs(sum(e.y-ee.y))&lt;1e-13)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Df</span> <span class="o">=</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">df</span>
        <span class="n">te</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">Df</span>
        <span class="n">Tww</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">df</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tt</span> <span class="o">==</span> <span class="s">&#39;centered&#39;</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Tww</span> <span class="o">+</span> <span class="n">te</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span>
                            <span class="n">Tww</span> <span class="o">+</span> <span class="n">te</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Tww</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ffts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="c">#print &quot;Nombre de dimensions : &quot;,nd</span>
            <span class="c">#print &quot;shape (y)  : &quot;,shape(y)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nd</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">Df</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="FHsignal.unrex"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.FHsignal.unrex.html#pylayers.signal.bsignal.FHsignal.unrex">[docs]</a>    <span class="k">def</span> <span class="nf">unrex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        extraction of the non redundant part of a real signal</span>
<span class="sd">        expressed in the frequency domain</span>

<span class="sd">        &gt;&gt;&gt; x = np.arange(0,6,1)</span>
<span class="sd">        &gt;&gt;&gt; y = np.arange(0,6,1)</span>
<span class="sd">        &gt;&gt;&gt; s = TUsignal(x,y)</span>
<span class="sd">        &gt;&gt;&gt; S = s.fft()</span>
<span class="sd">        &gt;&gt;&gt; U = S.unrex()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">yu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">yu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">O</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">xu</span><span class="p">,</span> <span class="n">yu</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">O</span><span class="p">)</span>

<span class="c">#class RefPulse154(TUsignal):</span>
<span class="c">#       &quot;&quot;&quot;</span>
<span class="c">#       Reference pulse of the IEEE 802.15.4a standard</span>
<span class="c">#       &quot;&quot;&quot;</span>
<span class="c">#   def __init__(self,x=np.array([]),numchanxxfc=4,band=3,thresh=10,fe=20):</span>

</div>
<span class="k">class</span> <span class="nc">Noise</span><span class="p">(</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create noise</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Noise.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Noise.__init__.html#pylayers.signal.bsignal.Noise.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tobs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fe</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">DSPdBmpHz</span><span class="o">=-</span><span class="mi">174</span><span class="p">,</span> <span class="n">NF</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Tobs      : Time duration</span>
<span class="sd">        fe        : sampling frequency</span>
<span class="sd">        DSPdBmpHz : Power Spectral Density Noise (dBm/Hz)</span>
<span class="sd">        R         : 50 Ohms</span>
<span class="sd">        NF        : 0</span>
<span class="sd">        R         : 50</span>
<span class="sd">        seed      : []</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">TUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">DSPdBmpHz</span> <span class="o">+</span> <span class="n">NF</span>
        <span class="n">pmW</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">)</span>  <span class="c"># mW/Hz</span>
        <span class="n">pW</span> <span class="o">=</span> <span class="n">pmW</span> <span class="o">/</span> <span class="mf">1e3</span>  <span class="c"># W/Hz</span>
        <span class="c">#PW    = pW*2*(fe*1e9)        #   W</span>
        <span class="n">PW</span> <span class="o">=</span> <span class="n">pW</span> <span class="o">*</span> <span class="p">(</span><span class="n">fe</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">)</span>  <span class="c"># W</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">PW</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Tobs</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">fe</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">std</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">n</span>
</div>
<div class="viewcode-block" id="Noise.amplify"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Noise.amplify.html#pylayers.signal.bsignal.Noise.amplify">[docs]</a>    <span class="k">def</span> <span class="nf">amplify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GdB</span><span class="p">,</span> <span class="n">NF</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Noise.gating"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.Noise.gating.html#pylayers.signal.bsignal.Noise.gating">[docs]</a>    <span class="k">def</span> <span class="nf">gating</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fcGHz</span><span class="p">,</span> <span class="n">BGHz</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="s">&#39;rect&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parity</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">x</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">fcGHz</span> <span class="o">-</span> <span class="n">BGHz</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">fcGHz</span> <span class="o">+</span> <span class="n">BGHz</span> <span class="o">/</span> <span class="mf">2.</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">f</span> <span class="o">&gt;</span> <span class="n">f1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">f</span> <span class="o">&lt;</span> <span class="n">f2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">gate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="n">gate</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">FUsignal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">gate</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">G</span> <span class="o">*</span> <span class="n">U</span>
        <span class="n">NF</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">symH</span><span class="p">(</span><span class="n">parity</span><span class="p">)</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="n">NF</span><span class="o">.</span><span class="n">ifft</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>
        <span class="c">#fe = 1./(self.x[1]-self.x[0])</span>
        <span class="c">#fN = fe/2</span>
        <span class="c">#print &quot;fN : &quot;,fN</span>
        <span class="c">#wp = (fcGHz-BGHz/2.)/fN</span>
        <span class="c">#ws = (fcGHz+BGHz/2.)/fN</span>
        <span class="c">#print &quot;fN : &quot;,wp</span>
        <span class="c">#print &quot;fN : &quot;,ws</span>
        <span class="c">#o  = self.iirfilter(order=4,wp=wp,ws=ws)</span>
    <span class="c">#    self.x = o.x</span>
    <span class="c">#    self.y = o.y</span>

</div>
<span class="k">class</span> <span class="nc">EnImpulse</span><span class="p">(</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an Energy normalized Gaussian impulse (Usignal)</span>

<span class="sd">    EnImpulse(x,fc,band,thresh,fe)</span>

<span class="sd">          fc     (GHz)   (def = 4GHz)</span>
<span class="sd">          band   (GHz)   (def = 3GHz)</span>
<span class="sd">          thresh (dB)    (def = 10dB)</span>
<span class="sd">          fe     (GHz)   (def = 100GHz)</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="EnImpulse.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.EnImpulse.__init__.html#pylayers.signal.bsignal.EnImpulse.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">fc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fe</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="n">TUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Tp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">band</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">/</span><span class="mf">20.</span><span class="p">)</span>
        <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span> <span class="p">(</span><span class="n">Tp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">te</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">fe</span>
            <span class="n">Tww</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">Tp</span>
            <span class="n">Ni</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Tww</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">te</span><span class="p">))</span>
            <span class="c"># Tww/2 multiple de te</span>
            <span class="n">Tww</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">te</span> <span class="o">*</span> <span class="n">Ni</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Tww</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Tww</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ni</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Tp</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fc</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tp</span> <span class="o">=</span> <span class="n">Tp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">fc</span>
</div>
<div class="viewcode-block" id="EnImpulse.demo"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.EnImpulse.demo.html#pylayers.signal.bsignal.EnImpulse.demo">[docs]</a>    <span class="k">def</span> <span class="nf">demo</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">        &gt;&gt;&gt; ip    = EnImpulse(fc=4,band=3,thresh=10,fe=100)</span>
<span class="sd">        &gt;&gt;&gt; Eip1  = ip.energy()</span>
<span class="sd">        &gt;&gt;&gt; ESDu  = ip.esd(mode=&#39;unilateral&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ESDb  = ip.esd(mode=&#39;bilateral&#39;)</span>
<span class="sd">        &gt;&gt;&gt; df    = ESDu.dx()</span>
<span class="sd">        &gt;&gt;&gt; Eipu  = sum(ESDu.y)*df</span>
<span class="sd">        &gt;&gt;&gt; Eipb  = sum(ESDb.y)*df</span>
<span class="sd">        &gt;&gt;&gt; erru  = Eip1-Eipu</span>
<span class="sd">        &gt;&gt;&gt; errb  = Eip1-Eipb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<span class="k">class</span> <span class="nc">MaskImpulse</span><span class="p">(</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MaskImpulse : Create an Energy normalized Gaussian impulse (Usignal)</span>

<span class="sd">          fc     (GHz)   (def = 4GHz)</span>
<span class="sd">          band   (GHz)   (def = 3GHz)</span>
<span class="sd">          thresh (dB)    (def = 10dB)</span>
<span class="sd">          fe     (GHz)   (def = 100GHz)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">        &gt;&gt;&gt; ip    = EnImpulse(fc=4,band=3,thresh=10,fe=20)</span>
<span class="sd">        &gt;&gt;&gt; Eip1  = ip.energy()</span>
<span class="sd">        &gt;&gt;&gt; ESDip = ip.esd()</span>
<span class="sd">        &gt;&gt;&gt; df    = ESDip.dx()</span>
<span class="sd">        &gt;&gt;&gt; Eip2  = sum(ESDip.y)*df</span>
<span class="sd">        &gt;&gt;&gt; err   = Eip1-Eip2</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MaskImpulse.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.MaskImpulse.__init__.html#pylayers.signal.bsignal.MaskImpulse.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">fc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">Tp</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Pm</span><span class="o">=-</span><span class="mf">41.3</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">fe</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fc     : center frequency (GHz)</span>
<span class="sd">        band   : bandwidth (GHz)</span>
<span class="sd">        Tp     : Pulse repetion rate</span>
<span class="sd">        R      : Resistance</span>
<span class="sd">        Pm     : PSD max</span>
<span class="sd">        fe     : sampling freqeuncy</span>
<span class="sd">        thresh : definition of band at Pm - thresh (dB)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">fc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">band</span> <span class="o">=</span> <span class="n">band</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thresh</span> <span class="o">=</span> <span class="n">thresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tp</span> <span class="o">=</span> <span class="n">Tp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pm</span> <span class="o">=</span> <span class="n">Pm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fe</span> <span class="o">=</span> <span class="n">fe</span>

        <span class="n">Usignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c">#alpha  = 1./(2*np.sqrt(abs(thresh)*np.log(10)/20))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">thresh</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">band</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">Tp</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">Pm</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">te</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">fe</span>
            <span class="n">Tw</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">/</span> <span class="n">band</span>
            <span class="n">Ni</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">Tw</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">te</span><span class="p">))</span>
            <span class="c"># Tww/2 multiple de te</span>
            <span class="n">Tww</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">te</span> <span class="o">*</span> <span class="n">Ni</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Tww</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Tww</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ni</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">tau</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fc</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</div>
<div class="viewcode-block" id="MaskImpulse.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.signal.bsignal.MaskImpulse.show.html#pylayers.signal.bsignal.MaskImpulse.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">plotdB</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="n">dx1</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dx1</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">EnImpulse</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="n">S1</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>

    <span class="n">is1</span> <span class="o">=</span> <span class="n">S1</span><span class="o">.</span><span class="n">ifft</span><span class="p">()</span>

    <span class="n">S12</span> <span class="o">=</span> <span class="n">S1</span> <span class="o">*</span> <span class="n">S1</span>
    <span class="n">s12</span> <span class="o">=</span> <span class="n">S12</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c"># Nouveau signal moins echantillonne</span>

    <span class="n">dx2</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dx2</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">EnImpulse</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">S2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="n">fft</span><span class="p">()</span>

    <span class="n">U1</span> <span class="o">=</span> <span class="n">S1</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="n">S2</span><span class="o">.</span><span class="n">unrex</span><span class="p">()</span>

    <span class="n">U3</span> <span class="o">=</span> <span class="n">U1</span> <span class="o">*</span> <span class="n">U2</span>

    <span class="n">H3</span> <span class="o">=</span> <span class="n">U3</span><span class="o">.</span><span class="n">symH</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># Comparer H3 et S12</span>

    <span class="n">s3</span> <span class="o">=</span> <span class="n">H3</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;s1&#39;</span><span class="p">)</span>
    <span class="n">s1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="n">s12</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;s12 = s1*s1&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="n">s2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;s2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="n">s3</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;s3= s1*s2&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">S1</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;S1&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">S12</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;S12 = S1*S1&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">S2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;S2&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">H3</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;H3 &#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="c">##</span>
<span class="c">#</span>
<span class="c">#</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c">#plt.ion()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
    <span class="c">#ip1 = EnImpulse(fc=4.493,band=0.499,thresh=3,fe=40)</span>
    <span class="c">#ip2 = EnImpulse(fc=4.493,band=0.499,thresh=3,fe=40)</span>
    <span class="c">#ip2.translate(1.123)</span>
    <span class="c">#ip3 = EnImpulse(fc=4.493,band=0.499,thresh=3,fe=40)</span>
    <span class="c">#ip3.translate(2.067)</span>
    <span class="c">#ip4 = EnImpulse(fc=4.493,band=0.499,thresh=3,fe=40)</span>
    <span class="c">#ip4.translate(3.45677)</span>
    <span class="c">#p = ip1+ip2+ip3+ip4</span>
<span class="c">#       ip.zlr(-10,10)</span>
<span class="c">#    s=TUsignal()</span>
<span class="c">#    s.load(&#39;fitest.mat&#39;)</span>
     <span class="c">#tau=s.toa()</span>
     <span class="c">#print tau</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   print &quot;&gt; generate a normalized energy impulse&quot;</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   print &quot;i1=EnImpulse()&quot;</span>
<span class="c">#   i1=EnImpulse()</span>
<span class="c">#   print &quot;i1.plot()&quot;</span>
<span class="c">#   i1.plot()</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   print &quot;&gt; translation of the signal acts only on x base &quot;</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   figure()</span>
<span class="c">#   i1.translate(3)</span>
<span class="c">#   print&quot;i1.translate(3)&quot;</span>
<span class="c">#   i1.plot()</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   print &quot;&gt; I1 is the fft of i1 &quot;</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   I1=i1.fft()</span>
<span class="c">#   print &quot;I1=i1.fft()&quot;</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   print &quot;&gt; Then we extract the unredundant part of I1 &quot;</span>
<span class="c">#   print &quot;&gt; &quot;</span>
<span class="c">#   U =I1.unrex()</span>
<span class="c">#   print &quot;U =I1.unrex()&quot;</span>
<span class="c">#   V =U.symH(1)</span>
<span class="c">#       show()</span>

<span class="c">#   W =U.symHz(4)</span>

<span class="c">#       x = np.arange(-5,5,0.01)</span>
<span class="c">#       s1 = EnImpulse(x,4,2,10)</span>
<span class="c">#       s1.plot()</span>
<span class="c">#       s2 = EnImpulse(x,5,3,10)</span>
<span class="c">#       s2.translate(5)</span>
<span class="c">#</span>
<span class="c">#       u  = s1.convolve(s2)</span>
<span class="c">#</span>
<span class="c">#       S1 = s1.ft()</span>
<span class="c">#       S2 = s2.ft()</span>
<span class="c">#</span>
<span class="c">#       S1S2  = S1*S2</span>
<span class="c">#       S1S2H = S1S2.symHz(100)</span>
<span class="c">#       s1s2h = S1S2H.ifft(1)</span>
<span class="c">#       v = s1s2h</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, PyLayers developer team.
      Last updated on mars 16, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_setDomainName', 'pylayers.github.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })(); 
</script> 
 
  </body>
</html>