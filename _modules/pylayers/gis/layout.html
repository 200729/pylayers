<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.gis.layout &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.gis.layout</h1><div class="highlight"><pre>
<span class="c">#-*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. currentmodule:: pylayers.gis.layout</span>

<span class="sd">This class handle the description of an Indoor layout</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated</span>

<span class="sd">Class Layout</span>
<span class="sd">============</span>

<span class="sd">Utility functions</span>
<span class="sd">-----------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.__init__</span>
<span class="sd">    Layout.__repr__</span>
<span class="sd">    Layout.info</span>
<span class="sd">    Layout.ls</span>
<span class="sd">    Layout.delete</span>
<span class="sd">    Layout.check</span>
<span class="sd">    Layout.clip</span>
<span class="sd">    Layout.help</span>
<span class="sd">    Layout.g2npy</span>
<span class="sd">    Layout.check2</span>
<span class="sd">    Layout.cleanup</span>
<span class="sd">    Layout.boundary</span>
<span class="sd">    Layout.distwall</span>
<span class="sd">    Layout.randTxRx</span>
<span class="sd">    Layout.get_paths</span>
<span class="sd">    Layout.get_zone</span>
<span class="sd">    Layout.info_segment</span>
<span class="sd">    Layout.find_edgelist</span>

<span class="sd">Loading and Saving</span>
<span class="sd">------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.dumpw</span>
<span class="sd">    Layout.dumpr</span>
<span class="sd">    Layout.loadosm</span>
<span class="sd">    Layout.saveosm</span>
<span class="sd">    Layout.saveini</span>
<span class="sd">    Layout.loadini</span>
<span class="sd">    Layout.loadfur</span>
<span class="sd">    Layout.load</span>
<span class="sd">    Layout.loadstr</span>
<span class="sd">    Layout.loadstr2</span>
<span class="sd">    Layout.savestr2</span>
<span class="sd">    Layout.save</span>
<span class="sd">    Layout.saveold</span>

<span class="sd">Layout editing</span>
<span class="sd">--------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.editor</span>
<span class="sd">    Layout.editorGtk</span>
<span class="sd">    Layout.editorTk</span>
<span class="sd">    Layout.add_pnod</span>
<span class="sd">    Layout.add_fnod</span>
<span class="sd">    Layout.add_nfpe</span>
<span class="sd">    Layout.add_pons</span>
<span class="sd">    Layout.add_segment</span>
<span class="sd">    Layout.add_furniture</span>
<span class="sd">    Layout.add_furniture_file</span>
<span class="sd">    Layout.del_points</span>
<span class="sd">    Layout.del_segment</span>
<span class="sd">    Layout.thwall</span>
<span class="sd">    Layout.edit_point</span>
<span class="sd">    Layout.edit_segment</span>
<span class="sd">    Layout.add_window</span>
<span class="sd">    Layout.add_door</span>

<span class="sd">Layout transformation </span>
<span class="sd">---------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.translate</span>
<span class="sd">    Layout.rotate</span>
<span class="sd">    Layout.del_cycle</span>
<span class="sd">    Layout.chgmss</span>
<span class="sd">    Layout.diag</span>
<span class="sd">    Layout.nd2seg</span>
<span class="sd">    Layout.ed2nd</span>
<span class="sd">    Layout.seguv</span>
<span class="sd">    Layout.segpt2</span>
<span class="sd">    Layout.seg2pts</span>
<span class="sd">    Layout.segpt</span>
<span class="sd">    Layout.extrseg</span>
<span class="sd">    Layout.seginframe2</span>
<span class="sd">    Layout.seginframe</span>
<span class="sd">    Layout.layerongrid</span>
<span class="sd">    Layout.cycleinline</span>
<span class="sd">    Layout.seginline</span>

<span class="sd">Layout visibility  </span>
<span class="sd">------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.checkvis</span>
<span class="sd">    Layout.visilist</span>
<span class="sd">    Layout.closest_edge</span>
<span class="sd">    Layout.visi_papb</span>
<span class="sd">    Layout.angleonlink</span>
<span class="sd">    Layout.angleonlinkold</span>
<span class="sd">    Layout.layeronlink</span>

<span class="sd">SubSegment Functions</span>
<span class="sd">--------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.subseg</span>
<span class="sd">    Layout.have_subseg</span>
<span class="sd">    Layout.del_subseg</span>
<span class="sd">    Layout.add_subseg</span>

<span class="sd">Vizualisation</span>
<span class="sd">--------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.displaygui</span>
<span class="sd">    Layout.show_nodes</span>
<span class="sd">    Layout.show_seg1</span>
<span class="sd">    Layout.plot_segments</span>
<span class="sd">    Layout.show_segment</span>
<span class="sd">    Layout.show_layer</span>
<span class="sd">    Layout.facet3D</span>
<span class="sd">    Layout.facets3D</span>
<span class="sd">    Layout.geomfile</span>
<span class="sd">    Layout._show3</span>
<span class="sd">    Layout.show3</span>

<span class="sd">Showing Graphs </span>
<span class="sd">---------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.showGi</span>
<span class="sd">    Layout.showGt</span>
<span class="sd">    Layout.showGs</span>
<span class="sd">    Layout.show</span>
<span class="sd">    Layout.showG</span>
<span class="sd">    Layout.showGv</span>

<span class="sd">Building Graphs </span>
<span class="sd">----------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.build</span>
<span class="sd">    Layout.buildGc</span>
<span class="sd">    Layout.buildGt</span>
<span class="sd">    Layout.buildGw</span>
<span class="sd">    Layout.buildGv</span>
<span class="sd">    Layout.buildGi2</span>
<span class="sd">    Layout.buildGi</span>
<span class="sd">    Layout.outputGi</span>
<span class="sd">    Layout.waypointGw</span>
<span class="sd">    Layout.builGr2</span>
<span class="sd">    Layout.buildGr</span>
<span class="sd">    Layout.buildGr3</span>

<span class="sd">Loading Graphs</span>
<span class="sd">--------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.loadG</span>

<span class="sd">Cycles and Rooms  Related Functions</span>
<span class="sd">-----------------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.pt2cy</span>
<span class="sd">    Layout.cy2pt</span>
<span class="sd">    Layout.pt2ro</span>
<span class="sd">    Layout.seg2ro</span>

<span class="sd">    Layout.room2segments</span>
<span class="sd">    Layout.room2nodes</span>

<span class="sd">    Layout.waypoint</span>

<span class="sd">Testing Functions</span>
<span class="sd">------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.isseg</span>
<span class="sd">    Layout.ispoint</span>
<span class="sd">    Layout.onseg</span>


<span class="sd">Signatures</span>
<span class="sd">----------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Layout.signature</span>
<span class="sd">    Layout.showSig</span>
<span class="sd">    Layout.get_Sg_pos</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c">#</span>
<span class="c">#</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="kn">as</span> <span class="nn">rd</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">from</span>   <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">clr</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">networkx.readwrite</span> <span class="kn">import</span> <span class="n">write_gpickle</span><span class="p">,</span><span class="n">read_gpickle</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">sh</span>
<span class="kn">from</span> <span class="nn">shapely.ops</span> <span class="kn">import</span> <span class="n">cascaded_union</span>
<span class="kn">from</span> <span class="nn">descartes.patch</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">import</span> <span class="nn">Image</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">urllib2</span> <span class="kn">as</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">cStringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">pylayers.antprop</span> <span class="kn">import</span> <span class="n">slab</span> <span class="k">as</span> <span class="n">sb</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">geomutil</span> <span class="k">as</span> <span class="n">geu</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">plotutil</span> <span class="k">as</span> <span class="n">plu</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">pyutil</span> <span class="k">as</span> <span class="n">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">graphutil</span> <span class="k">as</span> <span class="n">gru</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">cone</span>

<span class="c"># Handle furnitures</span>
<span class="kn">import</span> <span class="nn">pylayers.gis.furniture</span> <span class="kn">as</span> <span class="nn">fur</span>
<span class="kn">import</span> <span class="nn">pylayers.gis.osmparser</span> <span class="kn">as</span> <span class="nn">osm</span>
<span class="c">#from pylayers.gis import cycles as Cycls</span>
<span class="kn">from</span> <span class="nn">pylayers.gis</span> <span class="kn">import</span> <span class="n">cycles</span> <span class="k">as</span> <span class="n">cycl</span> <span class="c"># new version of cycles</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.selectl</span> <span class="kn">import</span> <span class="n">SelectL</span>
<span class="kn">from</span> <span class="nn">pylayers.util.easygui</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c">#from   PyUtil  import *</span>
<span class="c">#from   interval import interval</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">pylayers.util.graphutil</span> <span class="kn">as</span> <span class="nn">gph</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
    <span class="kn">from</span> <span class="nn">mayavi.sources.vtk_data_source</span> <span class="kn">import</span> <span class="n">VTKDataSource</span>
    <span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Layout:Mayavi is not installed&#39;</span>

<span class="c">#</span>
<span class="c">#</span>


<div class="viewcode-block" id="Layout"><a class="viewcode-back" href="../../../modules/pylayers.gis.layout.Layout.html#pylayers.gis.layout.Layout">[docs]</a><span class="k">class</span> <span class="nc">Layout</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handling Layout</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    Gs     : Structure graph</span>
<span class="sd">    Gt     : Topological graph  (indicates topological relationships between rooms)</span>
<span class="sd">    Gr     : Graph of room</span>
<span class="sd">    Gv     : Graph of visibility</span>
<span class="sd">    Gc     : Connection graph (indicates visbility relationships)</span>
<span class="sd">    Nnode  : Number of nodes of Gs</span>
<span class="sd">    Nedge  : Number of edges of Gs</span>
<span class="sd">    pt     : points sequence</span>
<span class="sd">    tahe   : tail head</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    add_door</span>
<span class="sd">    add_fnod</span>
<span class="sd">    add_furniture</span>
<span class="sd">    add_furniture_file</span>
<span class="sd">    add_nfpe</span>
<span class="sd">    add_pnod</span>
<span class="sd">    add_pons</span>
<span class="sd">    add_segment</span>
<span class="sd">    add_subseg</span>
<span class="sd">    add_window</span>
<span class="sd">    angleonlink</span>
<span class="sd">    boundary</span>
<span class="sd">    build</span>
<span class="sd">    buildGc</span>
<span class="sd">    buildGi</span>
<span class="sd">    buildGi2</span>
<span class="sd">    buildGr</span>
<span class="sd">    buildGr3</span>
<span class="sd">    buildGt</span>
<span class="sd">    buildGv</span>
<span class="sd">    buildGw</span>
<span class="sd">    builGr2</span>
<span class="sd">    check</span>
<span class="sd">    check2</span>
<span class="sd">    checkvis</span>
<span class="sd">    cleanup</span>
<span class="sd">    clip</span>
<span class="sd">    closest_edge</span>
<span class="sd">    cycleinline</span>
<span class="sd">    del_cycle</span>
<span class="sd">    delete</span>
<span class="sd">    del_points</span>
<span class="sd">    del_segment</span>
<span class="sd">    del_subseg</span>
<span class="sd">    diag</span>
<span class="sd">    displaygui</span>
<span class="sd">    distwall</span>
<span class="sd">    dumpr</span>
<span class="sd">    dumpw</span>
<span class="sd">    ed2nd</span>
<span class="sd">    editor</span>
<span class="sd">    edit_point</span>
<span class="sd">    edit_segment</span>
<span class="sd">    facet3D</span>
<span class="sd">    facets3D</span>
<span class="sd">    find_edgelist</span>
<span class="sd">    g2npy</span>
<span class="sd">    geomfile</span>
<span class="sd">    get_paths</span>
<span class="sd">    get_Sg_pos</span>
<span class="sd">    get_zone</span>
<span class="sd">    have_subseg</span>
<span class="sd">    help</span>
<span class="sd">    info</span>
<span class="sd">    info_edge</span>
<span class="sd">    ispoint</span>
<span class="sd">    layerongrid</span>
<span class="sd">    layeronlink</span>
<span class="sd">    load</span>
<span class="sd">    loadfur</span>
<span class="sd">    loadG</span>
<span class="sd">    loadini</span>
<span class="sd">    loadstr</span>
<span class="sd">    loadstr2</span>
<span class="sd">    ls</span>
<span class="sd">    nd2seg</span>
<span class="sd">    onseg</span>
<span class="sd">    plot_segments</span>
<span class="sd">    pt2cy</span>
<span class="sd">    pt2ro</span>
<span class="sd">    randTxRx</span>
<span class="sd">    room2nodes</span>
<span class="sd">    room2segments</span>
<span class="sd">    save</span>
<span class="sd">    saveini</span>
<span class="sd">    savestr2</span>
<span class="sd">    seg2ro</span>
<span class="sd">    seginframe</span>
<span class="sd">    seginline</span>
<span class="sd">    segpt</span>
<span class="sd">    seguv</span>
<span class="sd">    show3</span>
<span class="sd">    showG</span>
<span class="sd">    showGs</span>
<span class="sd">    showGt</span>
<span class="sd">    showGv</span>
<span class="sd">    show_layer</span>
<span class="sd">    show_nodes</span>
<span class="sd">    show_seg1</span>
<span class="sd">    show_segment</span>
<span class="sd">    showSig</span>
<span class="sd">    signature</span>
<span class="sd">    subseg</span>
<span class="sd">    thwall</span>
<span class="sd">    visilist</span>
<span class="sd">    visi_papb</span>
<span class="sd">    waypoint</span>
<span class="sd">    waypointGw</span>

<span class="sd">    Notes</span>
<span class="sd">    ------</span>

<span class="sd">    This class exploits `networkx` to store Layout information</span>

<span class="sd">    .. autosummary::</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Layout.__init__"><a class="viewcode-back" href="../../../modules/pylayers.gis.layout.Layout.html#pylayers.gis.layout.Layout.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_filename</span><span class="o">=</span><span class="s">&#39;defstr.ini&#39;</span><span class="p">,</span><span class="n">_filematini</span><span class="o">=</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span><span class="n">_fileslabini</span><span class="o">=</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">,</span><span class="n">_filefur</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : string</span>
<span class="sd">            layout file name</span>
<span class="sd">        _filematini :</span>
<span class="sd">            material dB file name</span>
<span class="sd">        _fileslabini :</span>
<span class="sd">            slab dB file name</span>
<span class="sd">        _filefur :</span>
<span class="sd">            furniture file name</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filematini</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslabini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#</span>
        <span class="c"># Initializing graphs</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">=</span><span class="p">[]</span>

        <span class="c">#</span>
        <span class="c"># related file names</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span> <span class="o">=</span> <span class="n">_fileslabini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filematini</span> <span class="o">=</span> <span class="n">_filematini</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filefur</span> <span class="o">=</span> <span class="n">_filefur</span>
        <span class="c">#</span>
        <span class="c"># setting display option</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ticksoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlblsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlblsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;clear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;inverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c">#self.display[&#39;fileoverlay&#39;]=&quot;/home/buguen/Pyproject/data/image/&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;TA-Office.png&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layerset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.__repr__.html#pylayers.gis.layout.Layout.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;----------------</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">],</span><span class="s">&#39;struc/images&#39;</span><span class="p">)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Image(&#39;&quot;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s">&quot;&#39;)</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;----------------</span><span class="se">\n\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Number of points  : &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Number of segments  : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Number of sub segments  : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nss</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Number of cycles  : &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Number of rooms  : &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">:</span>
                <span class="k">if</span>  <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;degree &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;degree &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;xrange :&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;yrange :&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Useful dictionnaries&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">----------------</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;di&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;di {interaction : [nstr,typi]}&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;sl&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;sl {slab name : slab dictionary}&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;name&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;name :  {slab :seglist} &quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Useful arrays&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">----------------</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;tsg&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;tsg : get segment index in Gs from tahe&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;isss&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;isss :  sub-segment index above Nsmax&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;tgs&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;tgs : get segment index in tahe from Gs&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;lsss&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;lsss : list of segments with sub-segment&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;sridess&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;stridess : stride to calculate the index of a subsegment&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;sla&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;sla : list of all slab names (Nsmax+Nss+1)&quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;degree&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;degree : degree of nodes &quot;</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>


        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span></div>
<div class="viewcode-block" id="Layout.ls"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.ls.html#pylayers.gis.layout.Layout.ls">[docs]</a>    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;ini&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in dirstruc</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ : string optional</span>
<span class="sd">            {&#39;str&#39;|&#39;ini&#39;|&#39;osm&#39;|&#39;str2&#39;|&#39;wrl&#39;}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of strdir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        strdir is defined in the Project module</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Display all available structures</span>


<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; fillist = L.ls()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;str&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;str2&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;ini&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRINI&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;osm&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIROSM&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;wrl&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRWRL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>

        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">lfile_s</span>

</div>
<div class="viewcode-block" id="Layout.delete"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.delete.html#pylayers.gis.layout.Layout.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete Layout graphs</span>

<span class="sd">        delete  Gs,Gc,Gm</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gm</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.check"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.check.html#pylayers.gis.layout.Layout.check">[docs]</a>    <span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Check Layout consistency</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">            consistent : Boolean</span>
<span class="sd">                        True if consistent</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        GeomUtil.isBetween</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For all segments</span>
<span class="sd">            get the 2 vertices</span>
<span class="sd">                for all the other vertices</span>
<span class="sd">                    check if it belongs to segment</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">consistent</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
        <span class="n">useg</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">upnt</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">degseg</span>  <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">useg</span><span class="p">)</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">degseg</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span> <span class="c"># all segments have degree 2</span>

        <span class="c"># should be done else-where</span>
        <span class="n">degpnt</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">upnt</span><span class="p">)</span>  <span class="c"># points absolute degrees</span>
        <span class="n">degmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">degpnt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">degpnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">==</span><span class="n">deg</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degpnt</span><span class="p">)))</span> <span class="c"># position of degree 1 point</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">upnt</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">num</span><span class="p">)</span>  <span class="c"># number of degree 1 points</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">[</span><span class="n">deg</span><span class="p">]</span> <span class="o">=</span> <span class="n">npt</span>
       


        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">useg</span><span class="p">:</span>
            <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>  <span class="c"># node s neighbors   </span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>           <span class="c"># p1 --- p2</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>           <span class="c">#     s</span>
            <span class="c">#</span>
            <span class="c"># check if there is no points between segments</span>
            <span class="c"># non superposition rule</span>
            <span class="c">#</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">upnt</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n1</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n2</span> <span class="o">!=</span> <span class="n">n</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">geu</span><span class="o">.</span><span class="n">isBetween</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
                        <span class="k">print</span> <span class="n">p1</span>
                        <span class="k">print</span> <span class="n">p</span>
                        <span class="k">print</span> <span class="n">p2</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;segment </span><span class="si">%d</span><span class="s"> contains point </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">consistent</span> <span class="o">=</span><span class="bp">False</span>
            <span class="k">if</span> <span class="n">level</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;segment </span><span class="si">%d</span><span class="s"> has no cycle&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;segment </span><span class="si">%d</span><span class="s"> has cycle </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">cycle</span><span class="p">))</span>
                      
        <span class="k">return</span><span class="p">(</span><span class="n">consistent</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.clip"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.clip.html#pylayers.gis.layout.Layout.clip">[docs]</a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the list of edges which cross or belong to the clipping zone</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">            xmin</span>
<span class="sd">            xmax</span>
<span class="sd">            ymin</span>
<span class="sd">            ymax</span>

<span class="sd">         Notes</span>
<span class="sd">         -----</span>

<span class="sd">              1) Determine all segments outside the clipping zone</span>
<span class="sd">              2) Union of the 4 conditions</span>
<span class="sd">              3) setdiff1d between the whole array of segments and the segments outside</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]]</span>

        <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

        <span class="n">nxp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">maxx</span> <span class="o">&lt;</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nxm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">minx</span> <span class="o">&gt;</span> <span class="n">xmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nyp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">maxy</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nym</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">miny</span> <span class="o">&gt;</span> <span class="n">ymax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">nxp</span><span class="p">,</span> <span class="n">nxm</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">nyp</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">union1d</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">nym</span><span class="p">)</span>

        <span class="n">iseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">iseg</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.help"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.help.html#pylayers.gis.layout.Layout.help">[docs]</a>    <span class="k">def</span> <span class="nf">help</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; help</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;L=Layout(&#39;DLR.ini&#39;)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;showGs(clear=True)&quot;</span>
        <span class="k">print</span> <span class="s">&quot;showGs(edlist=L.subseg()[&#39;WOOD&#39;],dthin=False,dlabels=True)&quot;</span>

</div>
<div class="viewcode-block" id="Layout.g2npy"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.g2npy.html#pylayers.gis.layout.Layout.g2npy">[docs]</a>    <span class="k">def</span> <span class="nf">g2npy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; from graphs to numpy arrays conversion</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function updates from Gs:</span>

<span class="sd">        self.pt (2xNp)</span>
<span class="sd">        self.tahe (2xNs)</span>
<span class="sd">        self.tgs</span>
<span class="sd">        self.dca</span>
<span class="sd">        self.lsss : list of subsegments</span>

<span class="sd">        assert self.pt[self.iupnt[-1]] == self.pt[:,self.iupnt[-1]]</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

        <span class="c"># nodes include points and segments</span>

        <span class="n">useg</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>
        <span class="n">upnt</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">upnt</span><span class="p">))</span>
        <span class="n">utmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">upnt</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">upnt</span><span class="p">))))</span>
        <span class="n">mutmp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">utmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iupnt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">mutmp</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iupnt</span><span class="p">[</span><span class="n">utmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">utmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>


        <span class="c"># degree of segment nodes</span>
        <span class="n">degseg</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">useg</span><span class="p">)</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">degseg</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span> <span class="c"># all segments must have degree 2</span>

        <span class="c">#</span>
        <span class="c"># self.degree : dictionnary (point degree : list of point index)</span>
        <span class="c">#</span>

        <span class="n">degpnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">upnt</span><span class="p">))</span>  <span class="c"># points absolute degrees</span>

        <span class="c"># lairwall : list of air wall segments</span>

        <span class="n">lairwall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="s">&#39;AIR&#39;</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c"># function to count airwall connected to a point  </span>
        <span class="c">#  probably this is not the faster solution</span>
        <span class="c">#</span>

        <span class="k">def</span> <span class="nf">nairwall</span><span class="p">(</span><span class="n">nupt</span><span class="p">):</span>
            <span class="n">lseg</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">nupt</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">lseg</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">lairwall</span><span class="p">:</span>
                    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">return</span> <span class="n">n</span>

        <span class="n">nairwall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">nairwall</span><span class="p">,</span><span class="n">upnt</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># if a node is connected to N air wall ==&gt; deg = deg - N</span>
        <span class="c">#</span>

        <span class="n">degpnt</span> <span class="o">=</span> <span class="n">degpnt</span> <span class="o">-</span> <span class="n">nairwall</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">degmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">degpnt</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">degmax</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">deg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">degmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">degpnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">==</span><span class="n">deg</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degpnt</span><span class="p">)))</span> <span class="c"># position of degree 1 point</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">upnt</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">num</span><span class="p">))</span>  <span class="c"># number of degree 1 points</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="n">deg</span><span class="p">]</span> <span class="o">=</span> <span class="n">npt</span>

        <span class="c">#</span>
        <span class="c"># convert geometric information in numpy array</span>
        <span class="c">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">upnt</span><span class="p">)]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">useg</span><span class="p">)]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">upnt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">useg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">upnt</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">upnt</span><span class="p">])</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pg</span><span class="p">,</span><span class="mf">0.</span><span class="p">))</span>

        <span class="n">ntail</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">useg</span><span class="p">)</span>
        <span class="n">nhead</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span><span class="n">useg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upnt</span><span class="p">)</span><span class="o">==</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">ntail</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upnt</span><span class="p">)</span><span class="o">==</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">nhead</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># transcoding array between graph numbering (discontinuous) and numpy numbering (continuous)</span>
        <span class="c">#</span>
        <span class="n">Nsmax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tsg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">useg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Nsmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;No segments in Layout yet&quot;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># handling of segment related arrays</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">Nsmax</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nsmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">rag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">useg</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">]</span> <span class="o">=</span> <span class="n">rag</span>

            <span class="c">#</span>
            <span class="c"># calculate normal to segment ta-he</span>
            <span class="c">#</span>
            <span class="c"># This could becomes obsolete once the normal will be calculated at</span>
            <span class="c"># creation of the segment</span>
            <span class="c">#</span>

            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]],</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]]))</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]],</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]]))</span>

            <span class="n">normx</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">-</span><span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="n">normy</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>

            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normx</span><span class="o">*</span><span class="n">normx</span><span class="o">+</span><span class="n">normy</span><span class="o">*</span><span class="n">normy</span><span class="p">)</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">normx</span><span class="p">,</span><span class="n">normy</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scale</span><span class="p">))))</span><span class="o">/</span><span class="n">scale</span>

            <span class="c">#for ks in ds:</span>
            <span class="c">#</span>
            <span class="c"># lsss : list of subsegment</span>
            <span class="c">#</span>
            <span class="n">nsmax</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="c"># nsmax can be different from the total number of segments</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isss</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stridess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nsmax</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sla</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nsmax</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;S20&#39;</span><span class="p">)</span>

            <span class="c"># Storing segment normals</span>
            <span class="c"># Handling of subsegments</span>
            <span class="c">#</span>
            <span class="c"># index is for indexing subsegment after the nsmax value</span>
            <span class="c">#</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">nsmax</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">ks</span> <span class="ow">in</span> <span class="n">useg</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgs</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span>                        <span class="c"># index numpy</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ks</span><span class="p">][</span><span class="s">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span>  <span class="c"># update normal</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sla</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ks</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>   <span class="c"># update sla array</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stridess</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>                     <span class="c"># initialize stridess[ks]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">):</span> <span class="c"># if segment has sub segment</span>
                    <span class="n">nss</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ks</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>  <span class="c"># retrieve number of sseg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stridess</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span><span class="o">=</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span>           <span class="c"># update stridess[ks] dict</span>
                    <span class="k">for</span> <span class="n">slabname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ks</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">sla</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">slabname</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">isss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
            <span class="c"># calculate extremum of segments           </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extrseg</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.loadosm"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadosm.html#pylayers.gis.layout.Layout.loadosm">[docs]</a>    <span class="k">def</span> <span class="nf">loadosm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileosm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load layout from an osm file format</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _fileosm : string</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        In JOSM nodes are numbered with negative indexes. It is not valid to</span>
<span class="sd">        have a positive node number. To stay compliant with the PyLayers</span>
<span class="sd">        convention which tells that &lt;0 node are points and &gt;0 are segments,  </span>
<span class="sd">        in the osm format, segments are numbered negatively with a known offset</span>
<span class="sd">        of 1e7=10000000. The convention is set back when loading the osm file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_fileosm</span>
        <span class="n">fileosm</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileosm</span><span class="p">,</span><span class="s">&#39;struc/osm&#39;</span><span class="p">)</span>
        <span class="n">coords</span><span class="p">,</span><span class="n">nodes</span><span class="p">,</span><span class="n">ways</span><span class="p">,</span><span class="n">relations</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">osm</span><span class="o">.</span><span class="n">osmparse</span><span class="p">(</span><span class="n">fileosm</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;floorplan&#39;</span><span class="p">)</span>
        <span class="n">_np</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># _ to avoid name conflict with numpy alias</span>
        <span class="n">_ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ns</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nss</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">npt</span> <span class="ow">in</span> <span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">npt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="n">npt</span><span class="p">])</span>
            <span class="n">_np</span><span class="o">+=</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">nseg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ways</span><span class="o">.</span><span class="n">way</span><span class="p">):</span>
            <span class="n">tahe</span> <span class="o">=</span> <span class="n">ways</span><span class="o">.</span><span class="n">way</span><span class="p">[</span><span class="n">nseg</span><span class="p">]</span><span class="o">.</span><span class="n">refs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tahe</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">nta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">nhe</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span>  <span class="o">=</span> <span class="n">ways</span><span class="o">.</span><span class="n">way</span><span class="p">[</span><span class="n">nseg</span><span class="p">]</span><span class="o">.</span><span class="n">tags</span>
               
                <span class="c"># old format conversion</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;zmin&#39;</span><span class="p">):</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">):</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">])]</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]]</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">])</span>
                <span class="c">#/old format conversion                 </span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="c"># avoid  0 value (not a segment number)</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>
                <span class="c"># transcode segment index</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;AIR&#39;</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;AIR&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nta</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">ns</span><span class="p">,</span><span class="n">nhe</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nta</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nhe</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">):</span>
                    <span class="n">nss</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ns</span><span class="p">]</span>
                   
                <span class="n">_ns</span><span class="o">+=</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">_np</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">_ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">nss</span>
        <span class="c">#del coords</span>
        <span class="c">#del nodes</span>
        <span class="c">#del ways</span>
        <span class="c">#del relations</span>
        <span class="c"># convert graph Gs to numpy arrays for speed up post processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.saveosm"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.saveosm.html#pylayers.gis.layout.Layout.saveosm">[docs]</a>    <span class="k">def</span> <span class="nf">saveosm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileosm</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  save layout in osm file format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _fileosm : string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileosm</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileosm</span><span class="p">,</span><span class="s">&#39;struc&#39;</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># </span>
        <span class="c">#</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="mi">47</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">48</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="mf">47.5</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">lonmin</span><span class="p">,</span><span class="n">llcrnrlat</span><span class="o">=</span><span class="n">latmin</span><span class="p">,</span><span class="n">urcrnrlon</span><span class="o">=</span><span class="n">lonmax</span><span class="p">,</span><span class="n">urcrnrlat</span><span class="o">=</span><span class="n">latmax</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;cass&#39;</span><span class="p">,</span><span class="n">lon_0</span><span class="o">=</span><span class="n">lon_0</span><span class="p">,</span><span class="n">lat_0</span><span class="o">=</span><span class="n">lat_0</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileosm</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;osm version=&#39;0.6&#39; upload=&#39;false&#39; generator=&#39;PyLayers&#39;&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="n">lon</span><span class="p">,</span><span class="n">lat</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;node id=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;&#39; action=&#39;modify&#39; visible=&#39;true&#39; lat=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;&#39; lon=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;&#39; /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">neigh</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="n">noden</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000000</span><span class="o">-</span><span class="n">n</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;way id=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">noden</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;&#39; action=&#39;modify&#39; visible=&#39;true&#39;&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;nd ref=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">neigh</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39; /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;nd ref=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">neigh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39; /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;tag k=&#39;name&#39; v=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39; /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;tag k=&#39;z&#39; v=</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;tag k=&#39;transition&#39; v=&#39;&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;&#39; /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">):</span>
                    <span class="n">ch</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>   
                    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;tag k=&#39;ss_name&#39; v=</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="n">ch</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;tag k=&#39;ss_z&#39; v=</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_z&#39;</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s"> /&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/way&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>


        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;&lt;/osm&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.saveini"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.saveini.html#pylayers.gis.layout.Layout.saveini">[docs]</a>    <span class="k">def</span> <span class="nf">saveini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileini</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save structure in an ini file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _fileini : string</span>
<span class="sd">                   short filemame with extension</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s">&quot;points&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s">&quot;segments&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s">&quot;display&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&#39;Npoints&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&#39;Nsegments&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;info&quot;</span><span class="p">,</span><span class="s">&#39;Nsubsegments&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nss</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;display&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;points&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c"># old format conversion</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">):</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;zmin&#39;</span><span class="p">):</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmin&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;zmax&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">):</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">])]</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]]</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">])</span>
                    <span class="k">del</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_zmax&#39;</span><span class="p">])</span>
   
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;connect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]:</span>
                        <span class="k">pass</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s">&#39;DOOR&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]:</span>
                            <span class="n">d</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;segments&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">d</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span><span class="s">&#39;materials&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span><span class="s">&#39;slab&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span><span class="s">&#39;furniture&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filefur</span><span class="p">)</span>
        <span class="n">fileini</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileini</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRINI&#39;</span><span class="p">])</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileini</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># convert graph Gs to numpy arrays for speed up post processing</span>
        <span class="c"># ideally an edited Layout should be locked while not saved.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Layout.loadini"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadini.html#pylayers.gis.layout.Layout.loadini">[docs]</a>    <span class="k">def</span> <span class="nf">loadini</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fileini</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a structure file from an .ini format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _fileini : string</span>
<span class="sd">            file name extension .ini</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="n">_fileini</span>
        <span class="n">di</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">fileini</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_fileini</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRINI&#39;</span><span class="p">])</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fileini</span><span class="p">)</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">section</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="n">di</span><span class="p">[</span><span class="n">section</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">section</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">di</span><span class="p">[</span><span class="n">section</span><span class="p">][</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="p">,</span><span class="n">option</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">section</span><span class="p">,</span> <span class="n">option</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;segments&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c">#</span>
        <span class="c"># update display section</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">di</span><span class="p">[</span><span class="s">&#39;display&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;display&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;display&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>


        <span class="c"># update points section</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">di</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">]:</span>
            <span class="n">nodeindex</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span>       <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;points&#39;</span><span class="p">][</span><span class="n">nn</span><span class="p">])</span>
            <span class="c">#</span>
            <span class="c"># limitation of point precision is important for avoiding</span>
            <span class="c"># topological problems in shapely.</span>
            <span class="c"># Layout precision is hard limited to millimeter precision.</span>
            <span class="c">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">nodeindex</span><span class="p">)</span>  <span class="c"># add point node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nodeindex</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span><span class="p">,</span><span class="nb">round</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">nodeindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span>

        <span class="c"># update segments section</span>
        <span class="n">Nss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">di</span><span class="p">[</span><span class="s">&#39;segments&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span> <span class="c"># add segment node</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;segments&#39;</span><span class="p">][</span><span class="n">ns</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">):</span>
                <span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">)]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;connect&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;connect&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">)]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nta</span><span class="p">])</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nhe</span><span class="p">]))</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nta</span><span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">),</span><span class="n">nhe</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ns</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">ns</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span>
        <span class="c"># compliant with config file without  material/slab information</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="s">&#39;files&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;files&#39;</span><span class="p">,</span><span class="s">&#39;materials&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;files&#39;</span><span class="p">,</span><span class="s">&#39;slab&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filefur</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;files&#39;</span><span class="p">,</span><span class="s">&#39;furniture&#39;</span><span class="p">)</span>


        <span class="c"># convert graph Gs to numpy arrays for speed up post processing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Layout.loadfur"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadfur.html#pylayers.gis.layout.Layout.loadfur">[docs]</a>    <span class="k">def</span> <span class="nf">loadfur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filefur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loadfur load a furniture file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filefur  : string</span>
<span class="sd">            short name of the furniture ini file</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">            Furniture objects are stored in self.lfur list</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Load a Layout file and an associated furniture ini file</span>



<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;WHERE1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.loadfur(&#39;Furw1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.gca()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showGs(fig=fig,ax=ax,furniture=True)</span>
<span class="sd">            &gt;&gt;&gt; ti = plt.title(&#39;loadfur&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filefur</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filefur</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRFUR&#39;</span><span class="p">])</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filefur</span><span class="p">)</span>
        <span class="n">furname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">furname</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">fur</span><span class="o">.</span><span class="n">Furniture</span><span class="p">()</span>
            <span class="n">F</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filefur</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filefur</span><span class="o">=</span><span class="n">_filefur</span>
</div>
<div class="viewcode-block" id="Layout.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.load.html#pylayers.gis.layout.Layout.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Layout in different formats</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filename : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Available format are :</span>

<span class="sd">            .ini   : ini file format (natural one) DIRINI</span>
<span class="sd">            .str2  : native Pyray (C implementation) DIRSTRUC</span>
<span class="sd">            .str   : binary file with visibility DIRSTRUC</span>
<span class="sd">            .osm   : opens street map format  DIROSM</span>

<span class="sd">   </span>
<span class="sd">        layout files are stored in the directory pstruc[&#39;DIRxxx&#39;]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.osm&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIROSM&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadosm</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.str&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadstr</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.str2&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadstr2</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span><span class="o">==</span><span class="s">&#39;.ini&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRINI&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadini</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;layout filename extension not recognized&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">]</span>
        <span class="c">#  construct geomfile (.off) for vizualisation with geomview</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">geomfile</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;problem to construct geomfile&quot;</span>
</div>
<div class="viewcode-block" id="Layout.loadstr"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadstr.html#pylayers.gis.layout.Layout.loadstr">[docs]</a>    <span class="k">def</span> <span class="nf">loadstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">_filematini</span><span class="o">=</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span> <span class="n">_fileslabini</span><span class="o">=</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; loadstr load a .str de PulsRay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : string</span>
<span class="sd">        _filematini  : string</span>
<span class="sd">            default &#39;matDB.ini&#39;</span>
<span class="sd">        _fileslabini : string</span>
<span class="sd">            default &#39;slabDB.ini&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout()</span>
<span class="sd">        &gt;&gt;&gt; L.loadstr(&#39;example.str&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filematini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslabini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lname</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Read : Np Ns Nss</span>
        <span class="c">#        Number of Nodes           nn</span>
        <span class="c">#        Number of Edges           en</span>
        <span class="c">#        Number of Sub Segments    cen</span>
        <span class="c">#</span>
        <span class="n">data_nn</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_nn</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_en</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_en</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_cen</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
        <span class="n">Nss</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">data_cen</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">Np</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span>

        <span class="n">codesl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="c"># tahe : segment tail and head point index</span>
        <span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c">#self.tahe[0,i]= stru.unpack(&#39;i&#39;,dt)[0]-1</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c">#self.tahe[1,i]= stru.unpack(&#39;i&#39;,dt)[0] -1</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="c"># x : tableau des coordonnees x des noeuds</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># y : tableau des coordinates y des noeuds</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#--------------------------------------------</span>
        <span class="c"># Node labelling (structure nodes)</span>
        <span class="c">#--------------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># y : type de noeud</span>
        <span class="c">#</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">codep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># agi : tableau des angles initiaux des noeuds de type 2</span>
        <span class="c">#</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># agf : tableau des angles finaux des noeuds de type 2</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># nN : tableau des parametres d&#39;ouverture de diedre des noeuds de type 2</span>
        <span class="n">nN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ag</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#eml  =</span>
        <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Ns</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#emr  =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#emc  =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">lname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="c">#thickness =</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">thick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#ehmin =</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#ehmax =</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span>
            <span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice node-node</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">nd_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Np</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">nd_nd</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice node-edge</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">nd_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">nd_ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read mat_i</span>
        <span class="c">#</span>
        <span class="n">mat_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">mat_i</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read mat_d</span>
        <span class="c">#</span>
        <span class="n">mat_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">mat_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read matrice ed-ed</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">ed_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">Ns</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">k</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">ed_ed</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># Sous segments</span>
        <span class="c">#</span>
        <span class="c"># read ce_core  (A COMPLETER)</span>
        <span class="c">#</span>
        <span class="n">ce_core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_thick</span>
        <span class="c">#</span>
        <span class="n">ce_thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_thick</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_prop_i</span>
        <span class="c">#</span>
        <span class="n">ce_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nss</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_wall_floor_ceil</span>
        <span class="c">#</span>
        <span class="n">ce_wall_floor_ceil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ed</span>
        <span class="c">#</span>
        <span class="n">ce_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_prop_d</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#   self.ce_prop[i]= stru.unpack(&#39;d&#39;,dt)[0]</span>
        <span class="c">#</span>
        <span class="c"># read ce_xmin</span>
        <span class="c">#</span>
        <span class="n">ce_xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_xmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_xmax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_xmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ymin</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ymin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_ymax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_ymax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_zmin</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># read ce_zmax</span>
        <span class="c">#</span>
        <span class="n">ini</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">i</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ce</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">ce</span><span class="p">[</span><span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_xmin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_xmax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_ymin</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                <span class="n">ce_ymax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c">#self.udbox()</span>
        <span class="c">#self.laylist()</span>
        <span class="c">#for i in self.layl:</span>
        <span class="c">#    self.display[&#39;Layer&#39;].append(i)</span>
        <span class="c">#    self.display[&#39;ActiveLayer&#39;].append(i)</span>

        <span class="c">#----------------------------------------</span>
        <span class="c"># Node labelling (structure edges)</span>
        <span class="c">#----------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                                                   <span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]))</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                  <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">nta</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">nhe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Update sub-segment</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ce</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_name</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce</span><span class="o">=</span><span class="p">[(</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_z</span><span class="o">=</span><span class="p">[(</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">])])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ndnd</span> <span class="o">=</span> <span class="n">nd_nd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eded</span> <span class="o">=</span> <span class="n">ed_ed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nded</span> <span class="o">=</span> <span class="n">nd_ed</span>
        <span class="c">#</span>
        <span class="c"># Create connectivity graph Gc</span>
        <span class="c">#   update Gc with nd_nd ed_ed</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span>
        <span class="c">#</span>
        <span class="c"># !! Incomplet  (To Do nd_ed)</span>
        <span class="c">#</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nd_nd</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">nnp</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">kvu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nd_nd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="o">-</span><span class="n">kvu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nnp</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

        <span class="n">Ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">ed_ed</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">ne</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">kvu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ed_ed</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">kvu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">ne</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>
        <span class="c">#</span>
        <span class="c"># The numpy format is conserved for acceleration</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">tahe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># update boundary</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.loadstr2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadstr2.html#pylayers.gis.layout.Layout.loadstr2">[docs]</a>    <span class="k">def</span> <span class="nf">loadstr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">_filematini</span><span class="o">=</span><span class="s">&#39;matDB.ini&#39;</span><span class="p">,</span> <span class="n">_fileslabini</span><span class="o">=</span><span class="s">&#39;slabDB.ini&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Graph from a str2 file</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            _filename : string</span>
<span class="sd">                str2 filename</span>
<span class="sd">            _filematini</span>
<span class="sd">                mat filename</span>
<span class="sd">            _fileslabini</span>
<span class="sd">                slab filename</span>

<span class="sd">            Notes</span>
<span class="sd">            -----</span>

<span class="sd">                str2 format is as follow</span>

<span class="sd">                Np Ns Nss</span>
<span class="sd">                xp_1 yp_1 zp_1 codep_1</span>
<span class="sd">                ...</span>
<span class="sd">                xp_Np yp_Np zp_Np codep_Np</span>
<span class="sd">                tail_1 head_1 left_1 core_1 right_1 zmin_1 zmax_1</span>
<span class="sd">                ...</span>
<span class="sd">                tail_Ns head_Ns left_Ns core_Ns right_Ns zmin_Ns zmax_Ns</span>
<span class="sd">                segId_1 SlabCode_1 wall_floor_ceil_1 prop_d_1 zmin_1 zmax_1</span>
<span class="sd">                ...</span>
<span class="sd">                segId_Nss SlabCode_Nss wall_floor_ceil_Nss prop_d_Nss zmin_Nss zmax_Nss</span>

<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.loadstr2(&#39;Lstruc.str2&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filematini</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslabini</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no file named &quot;</span><span class="p">,</span><span class="n">filename</span>
            <span class="k">return</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Parse the .str2 header NP NSEG NCOSEG</span>
        <span class="c">#</span>

        <span class="n">Np</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Nss</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">Np</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">=</span> <span class="n">Nss</span>

        <span class="n">lname</span> <span class="o">=</span> <span class="p">[]</span>


        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">codep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Np</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">tahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">codesl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">em</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">Ns</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>

        <span class="n">ed_mat_prop_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ns</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))</span>

        <span class="n">ce_ed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ce_core</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">ce_wall_floor_ceil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">))</span>
        <span class="n">ce_prop_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ce_zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">ce_zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Read points</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">codep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c">#ag[0:i]=float(dt[3])</span>
            <span class="c">#ag[1:i]=float(dt[4])</span>
            <span class="c">#ag[2:i]=float(dt[5])</span>
        <span class="n">ind1</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="c">#--------------------------------------------</span>
        <span class="c"># Node labelling (structure nodes)</span>
        <span class="c">#--------------------------------------------</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Read segments</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ind1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c"># em : [ left right core ]</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">em</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">codes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
            <span class="n">codesl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">lname</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">em</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]])</span>
            <span class="n">ed_mat_prop_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

        <span class="n">ind2</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">ind1</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c">#</span>
        <span class="c"># Read co-segments   ( Transposer dans loadstr)</span>
        <span class="c">#</span>
        <span class="n">ce</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nss</span><span class="p">):</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">ind2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">ce_ed</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ce_core</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ce_wall_floor_ceil</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ce_prop_d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">ce_zmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">ce_zmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">ce</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                  <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                                  <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>

        <span class="c">#----------------------------------------</span>
        <span class="c"># Node labelling (structure edges)</span>
        <span class="c">#----------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="c">#print k, lname[k]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]))</span>
            <span class="c">#self.Gs.add_node(k+1,norm=np.array([norm[0,k],norm[1,k],0.]))</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                  <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]</span> <span class="o">+</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">nta</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">nhe</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c"># update list of layers</span>
            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">lname</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Update sub-segment</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ce</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_name</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_ce</span><span class="o">=</span> <span class="p">[(</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">2</span><span class="p">])])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ss_z</span> <span class="o">=</span> <span class="p">[(</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span><span class="n">ce</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">4</span><span class="p">])])</span>

        <span class="c">#</span>
        <span class="c"># Nodes are numbered from 1 in .str2</span>
        <span class="c"># Nodes are numbered from 0 in Graph</span>
        <span class="c">#</span>
        <span class="c">#self.udbox()</span>
        <span class="c">#self.boundary()</span>
        <span class="c">#self.laylist()</span>
        <span class="c">#for i in self.layl:</span>
        <span class="c">#    self.display[&#39;Layer&#39;].append(i)</span>
        <span class="c">#    self.display[&#39;ActiveLayer&#39;].append(i)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span> <span class="o">=</span> <span class="n">tahe</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;activelayer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#self.boundary(1,1)</span>
</div>
<div class="viewcode-block" id="Layout.subseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.subseg.html#pylayers.gis.layout.Layout.subseg">[docs]</a>    <span class="k">def</span> <span class="nf">subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; establishes the association : name &lt;-&gt;  edgelist</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        dico : dict</span>
<span class="sd">               sub segment name as key and segment number as value</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dico</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">listtransition</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;transition&#39;</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                <span class="n">transition</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">transition</span><span class="p">:</span>
                    <span class="n">listtransition</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                <span class="n">lname</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lname</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dico</span><span class="p">:</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dico</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span>
          
        <span class="bp">self</span><span class="o">.</span><span class="n">dsseg</span> <span class="o">=</span> <span class="n">dico</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listtransition</span> <span class="o">=</span> <span class="n">listtransition</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dico</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_pnod"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_pnod.html#pylayers.gis.layout.Layout.add_pnod">[docs]</a>    <span class="k">def</span> <span class="nf">add_pnod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Project point p on segment e1 along segment e2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">            p  : ndarray</span>
<span class="sd">                point</span>
<span class="sd">            e1 : int</span>
<span class="sd">                edge number 1</span>
<span class="sd">            e2 : int</span>
<span class="sd">                edge number 2</span>

<span class="sd">        ..todo</span>
<span class="sd">            This function is void</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#p1 = p + alpha*ve2</span>
        <span class="c">#p1 = pa + beta * (pb-pa)</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Layout.add_fnod"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_fnod.html#pylayers.gis.layout.Layout.add_fnod">[docs]</a>    <span class="k">def</span> <span class="nf">add_fnod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; add free node  p</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p :  (1x2) tuple</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;defstr.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.add_fnod((10.0,10.0))</span>
<span class="sd">            -9</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c"># update labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_nfpe"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_nfpe.html#pylayers.gis.layout.Layout.add_nfpe">[docs]</a>    <span class="k">def</span> <span class="nf">add_nfpe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">np0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add node on s1 from projection of np0 along s2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        np0  : point number</span>
<span class="sd">        s1   : edge number 1</span>
<span class="sd">        s2   : edge number 2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">np1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">np2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">xA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">xP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="c">#print xA,yA</span>
        <span class="c">#print xB,yB</span>
        <span class="c">#print xC,yC</span>
        <span class="c">#print xD,yD</span>
        <span class="c">#print xP,yP</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">xB</span> <span class="o">-</span> <span class="n">xA</span><span class="p">,</span> <span class="n">xD</span> <span class="o">-</span> <span class="n">xC</span><span class="p">],</span> <span class="p">[</span><span class="n">yB</span> <span class="o">-</span> <span class="n">yA</span><span class="p">,</span> <span class="n">yD</span> <span class="o">-</span> <span class="n">yC</span><span class="p">]])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xP</span> <span class="o">-</span> <span class="n">xA</span><span class="p">,</span> <span class="n">yP</span> <span class="o">-</span> <span class="n">yA</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_pons</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c">#print x</span>
</div>
<div class="viewcode-block" id="Layout.add_pons"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_pons.html#pylayers.gis.layout.Layout.add_pons">[docs]</a>    <span class="k">def</span> <span class="nf">add_pons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add point on segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ns  : int</span>
<span class="sd">            segment number</span>
<span class="sd">        alpha : parameterization of the point</span>
<span class="sd">            alpha = 0 (tail) alpha = 1 (head)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        delete segment ns</span>
<span class="sd">        create 2 segments with same properties</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="n">namens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">zminns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zmaxns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="c"># delete old edge ns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">del_segment</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
        <span class="c"># add new edge np[0] num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">nop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">namens</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">zminns</span><span class="p">,</span><span class="n">zmaxns</span><span class="p">))</span>
        <span class="c"># add new edge num np[1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">nop</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">namens</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">zminns</span><span class="p">,</span><span class="n">zmaxns</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.add_segment"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_segment.html#pylayers.gis.layout.Layout.add_segment">[docs]</a>    <span class="k">def</span> <span class="nf">add_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;PARTITION&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;  add edge between node n1 and node n2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        n1  : integer &lt; 0</span>
<span class="sd">        n2  : integer &lt; 0</span>
<span class="sd">        name : string</span>
<span class="sd">            layer name &#39;PARTITION&#39;</span>
<span class="sd">        z : tuple of float</span>
<span class="sd">            default = (0,3.0)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        num : segment number (&gt;0)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        A segment dictionnary has the following mandatory attributes</span>

<span class="sd">        name : slab name associated with segment</span>
<span class="sd">        zmin : float  (meters)</span>
<span class="sd">        zmax : float  (meters)</span>
<span class="sd">        norm : array  (1x3)  segment normal</span>
<span class="sd">        transition : boolean</span>
<span class="sd">        ncycles : list of involved cycles</span>
<span class="sd">        connect : list of point number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># if 2 points are selected</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">n1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n1</span> <span class="o">!=</span> <span class="n">n2</span><span class="p">)):</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c">## nn : node list array     (can be empty)</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>          <span class="c">## up : segment index (&gt;O)  (can be empty)</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>                        <span class="c">## lp : number of segments  (can be zero)</span>
            <span class="k">if</span> <span class="n">lp</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>          <span class="c">## e1 : ordered list of segment number</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">[</span><span class="n">up</span><span class="p">]</span>                         <span class="c">## e2 : current list of segment number</span>
            <span class="n">c</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>                <span class="c">## c  : e1 not in e2 (free segment number)</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">e1</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>                          <span class="c">## tn[c] free segment number</span>
            <span class="c">#print tn</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">num</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;add_segment : error not a node&quot;</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span>
            <span class="k">return</span>

        <span class="n">transition</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;AIR&#39;</span><span class="p">:</span>
            <span class="n">transition</span><span class="o">=</span><span class="bp">True</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">p2mp1</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">p2mp1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2mp1</span><span class="p">,</span> <span class="n">p2mp1</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># n = t x z</span>
        <span class="c">#</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">transition</span><span class="o">=</span><span class="n">transition</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="c"># update slab name &lt;-&gt; edge number dictionnary</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">]</span>
        <span class="c"># update label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">num</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_furniture"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_furniture.html#pylayers.gis.layout.Layout.add_furniture">[docs]</a>    <span class="k">def</span> <span class="nf">add_furniture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;R1_C&#39;</span><span class="p">,</span> <span class="n">matname</span><span class="o">=</span><span class="s">&#39;PARTITION&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),</span>
                      <span class="n">zmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  add piece of furniture</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        name : string</span>
<span class="sd">            default = &#39;R1_C&#39;</span>
<span class="sd">        matname : string</span>
<span class="sd">            default = &#39;PARTITION&#39;</span>
<span class="sd">        origin : tuple of floats</span>
<span class="sd">        height : float</span>
<span class="sd">            default = 0</span>
<span class="sd">        width : float</span>
<span class="sd">            default = 0</span>
<span class="sd">        length : float</span>
<span class="sd">            default = 0</span>
<span class="sd">        angle : float</span>
<span class="sd">            default = 0</span>

<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="c"># compute the four points</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)])</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">+</span> <span class="n">u</span> <span class="o">*</span> <span class="n">length</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">width</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">u</span> <span class="o">*</span> <span class="n">length</span>
        <span class="c"># adding free nodes</span>
        <span class="n">n0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">n3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_fnod</span><span class="p">(</span><span class="n">p3</span><span class="p">)</span>
        <span class="c"># adding segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">n0</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmin</span><span class="o">+</span><span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmin</span><span class="o">+</span><span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmin</span><span class="o">+</span><span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_segment</span><span class="p">(</span><span class="n">n3</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmin</span><span class="o">+</span><span class="n">height</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.add_furniture_file"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_furniture_file.html#pylayers.gis.layout.Layout.add_furniture_file">[docs]</a>    <span class="k">def</span> <span class="nf">add_furniture_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filefur</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  add pieces of furniture from .ini files</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filefur : string</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filefur</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filefur</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRFUR&#39;</span><span class="p">])</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filefur</span><span class="p">)</span>
        <span class="n">furname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fur</span> <span class="ow">in</span> <span class="n">furname</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">matname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;matname&quot;</span><span class="p">)</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;origin&quot;</span><span class="p">)))</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;height&quot;</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;width&quot;</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;length&quot;</span><span class="p">)</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;angle&quot;</span><span class="p">)</span>
            <span class="n">thickness</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="n">fur</span><span class="p">,</span> <span class="s">&quot;thickness&quot;</span><span class="p">)</span>
            <span class="c">#~ if matname==&#39;WOOD&#39;:</span>
                <span class="c">#~ zmin = height</span>
                <span class="c">#~ height=thickness</span>
            <span class="c">#~ else:</span>
                <span class="c">#~ zmin=0.0</span>
            <span class="c"># .. todo: be more generic relate to floor level</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_furniture</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_furniture</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">matname</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;No such furniture type - &#39;</span><span class="o">+</span><span class="n">typ</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.del_points"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_points.html#pylayers.gis.layout.Layout.del_points">[docs]</a>    <span class="k">def</span> <span class="nf">del_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete points in list lp</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        lp : list</span>
<span class="sd">            node list</span>

<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="c"># test if array</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span>

        <span class="c"># test if list</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">lp</span> <span class="o">=</span> <span class="p">[</span><span class="n">lp</span><span class="p">]</span>
       
        <span class="k">print</span> <span class="s">&quot;lp : &quot;</span><span class="p">,</span><span class="n">lp</span>
        <span class="c"># get segments involved in points list</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd2seg</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>
         
        <span class="k">print</span> <span class="s">&quot;ls : &quot;</span><span class="p">,</span><span class="n">ls</span>
        <span class="c"># 1) delete involved segments</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">del_segment</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="c"># 2) delete involved points</span>
        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="n">lp</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">n1</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">nbrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="c">#nbrc = self.Gc.neighbors(n1)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c"># 3) updating structures    </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
           </div>
<div class="viewcode-block" id="Layout.del_segment"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_segment.html#pylayers.gis.layout.Layout.del_segment">[docs]</a>    <span class="k">def</span> <span class="nf">del_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">le</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete segment e</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        le : list of segment number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">le</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">le</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">le</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">le</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">le</span> <span class="o">=</span> <span class="p">[</span><span class="n">le</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">le</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">e</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">del_subseg</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="c"># delete edge position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c"># update slab name &lt;-&gt; edge number dictionnary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="c"># delete subseg if required</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Layout.translate"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.translate.html#pylayers.gis.layout.Layout.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; translate layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        vec :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="n">pt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.rotate"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.rotate.html#pylayers.gis.layout.Layout.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">angle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; rotate layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        angle (deg)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">angle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="n">pt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)],[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)]]),</span><span class="n">array</span><span class="p">(</span><span class="n">pt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.del_cycle"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_cycle.html#pylayers.gis.layout.Layout.del_cycle">[docs]</a>    <span class="k">def</span> <span class="nf">del_cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lnc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete a cycle</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        lnc :  list of cycle number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">lnc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lnc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">lnc</span> <span class="o">=</span> <span class="p">[</span><span class="n">lnc</span><span class="p">]</span>

        <span class="c"># for all cycles</span>
        <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">lnc</span><span class="p">:</span>
            <span class="c"># get nodes of the cycles</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="c"># get neighbors cycles</span>
            <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="c"># array of nodes of neighbors</span>
            <span class="n">tvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="c"># for all neihbor cycles</span>
            <span class="k">for</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                <span class="c">#vn = np.array(self.Gt.node[ncy][&#39;vnodes&#39;])</span>
                <span class="c"># get nodes of neighbor cycle</span>
                <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
                <span class="c"># append nodes in tvn</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">tvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">tvn</span><span class="p">,</span> <span class="n">vn</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">tvn</span> <span class="o">=</span> <span class="n">vn</span>
            <span class="c"># remove multiple values       </span>
            <span class="n">utvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tvn</span><span class="p">)</span>
            <span class="c"># destroy nodes which are not involved with neighbors</span>
            <span class="n">udel</span> <span class="o">=</span> <span class="n">vnodes</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">vnodes</span><span class="p">,</span> <span class="n">utvn</span><span class="p">)]</span>

            <span class="c"># delete cycle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
            <span class="c"># delete nodes in udel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">del_segment</span><span class="p">(</span><span class="n">udel</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.check2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.check2.html#pylayers.gis.layout.Layout.check2">[docs]</a>    <span class="k">def</span> <span class="nf">check2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Layout checking</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tseg</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lnp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">lnp</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">lnp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">tseg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">([(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])]))</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tseg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">seg1</span> <span class="o">=</span> <span class="n">tseg</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">seg2</span> <span class="o">=</span> <span class="n">tseg</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">crosses</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;crosses :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;contains :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg2</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">seg1</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;contains :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg1</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">seg2</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;overlaps :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg2</span><span class="o">.</span><span class="n">overlaps</span><span class="p">(</span><span class="n">seg1</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&quot;overlaps :&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span><span class="p">(</span><span class="n">tseg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.cleanup"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.cleanup.html#pylayers.gis.layout.Layout.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cleanup the Layout</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. Remove nodes which are not connected</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.displaygui"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.displaygui.html#pylayers.gis.layout.Layout.displaygui">[docs]</a>    <span class="k">def</span> <span class="nf">displaygui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        displaygui() : open a GUI for display configuration</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">displaygui</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Display Parameters&#39;</span><span class="p">,</span>
                                  <span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;nodes&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ednodes&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ndlabel&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;edlabel&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;edges&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;subseg&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;visu&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;thin&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;scaled&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;overlay&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;fileoverlay&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;inverse&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;alpha&#39;</span><span class="p">),</span>
                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]),</span>
                                   <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">],</span>
                                   <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;inverse&#39;</span><span class="p">]),</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">displaygui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">displaygui</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;visu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">9</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">10</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">displaygui</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;inverse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">12</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">displaygui</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.info_segment"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.info_segment.html#pylayers.gis.layout.Layout.info_segment">[docs]</a>    <span class="k">def</span> <span class="nf">info_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; information about segment</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s1 : segment number</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nebd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nns1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span>
        <span class="n">nns2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span>
        <span class="n">ds1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">]</span>
        <span class="k">print</span> <span class="n">n1</span><span class="p">,</span> <span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="n">nns1</span>
        <span class="k">print</span> <span class="n">n2</span><span class="p">,</span> <span class="s">&#39; : &#39;</span><span class="p">,</span> <span class="n">nns2</span>
        <span class="k">print</span> <span class="s">&#39;------------&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Slab     : &#39;</span><span class="p">,</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;zmin (m) : &#39;</span><span class="p">,</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;zmax (m) : &#39;</span><span class="p">,</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;------------&#39;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;subseg Slabs  : &#39;</span><span class="p">,</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;subseg (zmin,zmax) (m) : &#39;</span><span class="p">,</span> <span class="n">ds1</span><span class="p">[</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Layout.edit_point"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.edit_point.html#pylayers.gis.layout.Layout.edit_point">[docs]</a>    <span class="k">def</span> <span class="nf">edit_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">np</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; edit point</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        np : integer</span>
<span class="sd">            point number</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Point (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="p">)</span>  <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;Enter coordinates &quot;</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="p">((</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">)),</span>
                            <span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

</div>
<div class="viewcode-block" id="Layout.chgmss"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.chgmss.html#pylayers.gis.layout.Layout.chgmss">[docs]</a>    <span class="k">def</span> <span class="nf">chgmss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ns</span><span class="p">,</span><span class="n">ss_name</span><span class="o">=</span><span class="p">[],</span><span class="n">ss_z</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; change a specific multi subseggments properties</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ns : int</span>
<span class="sd">            segment number</span>

<span class="sd">        ss_name : list of Nss  string    </span>
<span class="sd">            name of the different constitutive SLAB of the multi-segments</span>
<span class="sd">      </span>
<span class="sd">        ss_z : list of Nss tuple (zmin,zmax)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.gis.layout.g2npy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ns</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ss_name</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ss_name</span>
                <span class="k">if</span> <span class="n">ss_z</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ss_z</span>

                <span class="c"># update Layout information   </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">g2npy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.edit_segment"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.edit_segment.html#pylayers.gis.layout.Layout.edit_segment">[docs]</a>    <span class="k">def</span> <span class="nf">edit_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span> <span class="p">,</span> <span class="n">gui</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; edit segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        e1 : integer</span>
<span class="sd">            edge number</span>
<span class="sd">        gui : boolean    </span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        A segment has the following properties :</span>
<span class="sd">            + name  : string</span>
<span class="sd">            + z  :  tuple</span>
<span class="sd">            + transition : boolean (default FALSE)</span>

<span class="sd">        If a segment has subsegments attached the following properties are</span>
<span class="sd">        added :</span>
<span class="sd">            + ss_name : string</span>
<span class="sd">            + ss_z : subsegment [(min height (meters),max height (meters))]</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nebd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebd</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">de1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Segment (&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">de1</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">de1k</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>
            <span class="n">de1v</span> <span class="o">=</span> <span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">de1k</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="s">&#39;ss_name&#39;</span><span class="p">,</span> <span class="s">&#39;ss_z&#39;</span><span class="p">,</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>
            <span class="n">de1v</span> <span class="o">=</span> <span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_name&#39;</span><span class="p">],</span> <span class="n">de1</span><span class="p">[</span><span class="s">&#39;ss_z&#39;</span><span class="p">],</span>
                    <span class="n">de1</span><span class="p">[</span><span class="s">&#39;transition&#39;</span><span class="p">]]</span>
        <span class="c">#de1v    = de1.values()</span>
        <span class="k">if</span> <span class="n">gui</span><span class="p">:</span>
            <span class="n">data0</span> <span class="o">=</span> <span class="n">choicebox</span><span class="p">(</span><span class="s">&#39;chose slab&#39;</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">data1</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="s">&#39;attribute for &#39;</span> <span class="o">+</span> <span class="n">data0</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">de1k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">de1v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data0</span><span class="p">]</span><span class="o">+</span><span class="n">data1</span>
            <span class="c">#data = multenterbox(message, title, tuple(de1k), tuple(de1v))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">de1</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">de1k</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s">&#39;name&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">e1</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;1&#39;</span>
            <span class="k">while</span><span class="p">(</span><span class="n">val</span><span class="o">&lt;&gt;</span><span class="s">&#39;0&#39;</span><span class="p">):</span>
                <span class="n">clear</span>
                <span class="k">print</span> <span class="s">&#39;0 : exit&#39;</span>
                <span class="k">for</span> <span class="n">e</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">de1k</span><span class="p">,</span><span class="n">de1v</span><span class="p">)):</span>
                    <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s">&#39;: &#39;</span><span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">&#39;Your choice :&#39;</span><span class="p">)</span>   
                <span class="k">if</span> <span class="n">val</span><span class="o">&lt;&gt;</span><span class="s">&#39;0&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>


       </div>
<div class="viewcode-block" id="Layout.have_subseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.have_subseg.html#pylayers.gis.layout.Layout.have_subseg">[docs]</a>    <span class="k">def</span> <span class="nf">have_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        have_subseg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Layout.del_subseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.del_subseg.html#pylayers.gis.layout.Layout.del_subseg">[docs]</a>    <span class="k">def</span> <span class="nf">del_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delete sub subsegent</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e1 : integer</span>
<span class="sd">             segment number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">e1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_subseg</span><span class="p">(</span><span class="n">e1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_name&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_z&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ss_ce&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;transition&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no subseg to delete&quot;</span>
</div>
<div class="viewcode-block" id="Layout.add_subseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_subseg.html#pylayers.gis.layout.Layout.add_subseg">[docs]</a>    <span class="k">def</span> <span class="nf">add_subseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;DOOR&#39;</span><span class="p">,</span><span class="n">zmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">zmax</span><span class="o">=</span><span class="mf">2.24</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a subsegment on a segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s1 : integer</span>
<span class="sd">            edge number &gt; 0</span>
<span class="sd">        name : string</span>
<span class="sd">            slab name</span>
<span class="sd">        zmin : float</span>
<span class="sd">            default 0</span>
<span class="sd">        zmax : float</span>
<span class="sd">            default 2.24 m</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info_segment</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Add a subsegment&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;zmin&#39;</span><span class="p">,</span> <span class="s">&#39;zmax&#39;</span><span class="p">),</span>
                                            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_ce&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Layout.add_window"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_window.html#pylayers.gis.layout.Layout.add_window">[docs]</a>    <span class="k">def</span> <span class="nf">add_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a window on segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s1 : integer</span>
<span class="sd">            segment number</span>
<span class="sd">        z : tuple of float</span>
<span class="sd">            (zmin,zmax)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">zmin</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">zmax</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e1</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_edge</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;WINDOW&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_ce&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;windows range is wrong&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.add_door"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.add_door.html#pylayers.gis.layout.Layout.add_door">[docs]</a>    <span class="k">def</span> <span class="nf">add_door</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a door on segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s1 : integer</span>
<span class="sd">            segment number</span>
<span class="sd">        zmin : float</span>
<span class="sd">        zmax : float</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">zmin</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">&amp;</span><span class="p">(</span><span class="n">zmax</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info_segment</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;DOOR&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_zmin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">zmin</span><span class="p">,</span><span class="n">zmax</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;ss_ce&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s1</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Layout.find_edgelist"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.find_edgelist.html#pylayers.gis.layout.Layout.find_edgelist">[docs]</a>    <span class="k">def</span> <span class="nf">find_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        edgelist = find_edgelist(edgelist,nodelist)</span>

<span class="sd">        edgelist : input edgelist</span>
<span class="sd">        nodelist : input nodelist</span>

<span class="sd">        return the subset of edgelist</span>

<span class="sd">        Not Finished :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">]</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">]</span>

        <span class="n">nt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d_nu</span><span class="p">[</span><span class="n">tail</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">]</span>
        <span class="n">nh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d_nu</span><span class="p">[</span><span class="n">head</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">]</span>

        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">edgelist</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ed_t</span><span class="p">,</span> <span class="n">ed_h</span><span class="p">)]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.diag"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.diag.html#pylayers.gis.layout.Layout.diag">[docs]</a>    <span class="k">def</span> <span class="nf">diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">al1</span><span class="p">,</span> <span class="n">al2</span><span class="p">,</span> <span class="n">quadsel</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        diag (p1,p2,l,al1,al2,quadsel)</span>

<span class="sd">        p1  :</span>
<span class="sd">        p2  :</span>
<span class="sd">        al1</span>
<span class="sd">        al2</span>

<span class="sd">        quadsel : 0   all quadrant</span>
<span class="sd">              2 1</span>
<span class="sd">              3 4</span>

<span class="sd">        WARNING : Not Tested</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c">#</span>
        <span class="c"># selection du quadran</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quadsel</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">u0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">x_u0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u0</span><span class="p">]</span>
        <span class="n">y_u0</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># Permutation points</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="c">#</span>
        <span class="c"># Box length</span>
        <span class="c">#</span>

        <span class="n">Dx</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Dx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">Dy</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Parametre de la droite p1 p2 (cas general)</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">)):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Dy</span> <span class="o">/</span> <span class="n">Dx</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span>
            <span class="n">b2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">a</span>

            <span class="n">delta_b</span> <span class="o">=</span> <span class="n">l</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span>
            <span class="n">delta_b1</span> <span class="o">=</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span>
            <span class="n">delta_b2</span> <span class="o">=</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span>

            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u0</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x_u0</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">delta_b</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u1</span> <span class="o">=</span> <span class="n">x_u0</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y_u0</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u1</span> <span class="o">&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x_u1</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="n">delta_b</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u2</span> <span class="o">=</span> <span class="n">x_u1</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="n">y_u2</span> <span class="o">=</span> <span class="n">y_u1</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">x_u2</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">delta_b1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">x_u3</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">+</span> <span class="n">delta_b2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">x_u2</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">delta_b1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y_u2</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">x_u3</span> <span class="o">/</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">delta_b2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u4</span> <span class="o">=</span> <span class="n">x_u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]</span>
                <span class="n">y_u4</span> <span class="o">=</span> <span class="n">y_u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]</span>
<span class="c">#</span>
<span class="c"># p1 p2 vertical</span>
<span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u1</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_u2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u2</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y_u3</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u3</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#</span>
<span class="c"># p1 p2 horizontal</span>
<span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Dy</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y_u1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_u1</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">l</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">x_u2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u2</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u3</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x_u2</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">al2</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">x_u3</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">u3</span><span class="p">]</span>
                <span class="n">u4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">al1</span> <span class="o">*</span> <span class="n">L</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nodelist</span> <span class="o">=</span> <span class="n">u0</span><span class="p">[</span><span class="n">u1</span><span class="p">[</span><span class="n">u2</span><span class="p">[</span><span class="n">u3</span><span class="p">[</span><span class="n">u4</span><span class="p">]]]]</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_edge_list</span><span class="p">(</span><span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.nd2seg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.nd2seg.html#pylayers.gis.layout.Layout.nd2seg">[docs]</a>    <span class="k">def</span> <span class="nf">nd2seg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert node list to edge list</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ndlist : list or ndarray</span>
<span class="sd">            node list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        seglist : ndarray</span>
<span class="sd">            edge list</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        previously nd2ed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ndlist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#for n in ndlist:</span>
        <span class="c">#    seglist = seglist + self.Gs.adj[n].keys()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">ndlist</span><span class="p">)</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seglist</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.ed2nd"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.ed2nd.html#pylayers.gis.layout.Layout.ed2nd">[docs]</a>    <span class="k">def</span> <span class="nf">ed2nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert edgelist to nodelist</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        edlist : list or ndarray</span>
<span class="sd">            edge list</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndlist : ndarray</span>
<span class="sd">            node list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edlist</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="n">edlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c"># mecanisme de concatenation de listes</span>
        <span class="n">ndlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edlist</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">ndlist</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">adj</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ndlist</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.get_zone"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.get_zone.html#pylayers.gis.layout.Layout.get_zone">[docs]</a>    <span class="k">def</span> <span class="nf">get_zone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get point list and segment list in a rectangular zone</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ax  : list ot tuple</span>
<span class="sd">            [xmin,xmax,ymin,ymax]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ptlist,seglist</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xmin</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">ptlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">)):</span>
                    <span class="n">ptlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nd2seg</span><span class="p">(</span><span class="n">ptlist</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ptlist</span><span class="p">,</span> <span class="n">seglist</span>
</div>
<div class="viewcode-block" id="Layout.savestr2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.savestr2.html#pylayers.gis.layout.Layout.savestr2">[docs]</a>    <span class="k">def</span> <span class="nf">savestr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="o">=</span><span class="s">&#39;default.str2&#39;</span><span class="p">,</span> <span class="n">furniture</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Layout in .str2 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filename : string</span>
<span class="sd">            file is  written in the struc directory of the current Project</span>
<span class="sd">            directory which is defined through the environment variable $BASENAME</span>
<span class="sd">            furniture :  boolean</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        To produce the .str file</span>

<span class="sd">                &gt; newstruc -str2 file.str2 -conf ../project.conf</span>

<span class="sd">        .. todo:: Create a savestr from the Layout Class requires Gv</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">furniture</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># Create node list</span>
            <span class="c">#</span>

            <span class="c">#</span>
            <span class="c"># Create edge list</span>
            <span class="c">#</span>

            <span class="c">#</span>
            <span class="c"># Create subseg</span>
            <span class="c">#</span>
            <span class="k">pass</span>

        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRSTRUC&#39;</span><span class="p">])</span>

        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
        <span class="n">nss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span>

        <span class="n">cnn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">cne</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span>
        <span class="n">cnss</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nss</span><span class="p">)</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Write in .str2 file</span>
        <span class="c">#</span>
        <span class="n">chaine</span> <span class="o">=</span> <span class="n">cnn</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">cne</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">cnss</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">dnode</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c">#</span>
        <span class="c"># Reorder segments and points</span>
        <span class="c">#</span>
        <span class="c"># ..todo:: do a spatial reordering</span>
        <span class="c">#</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">useg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">upoint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">npoint</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">upoint</span><span class="p">]</span>
        <span class="n">nseg</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">useg</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">npoint</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># points</span>
            <span class="c">#</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">deg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">codep</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">deg</span><span class="p">)</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">codep</span> <span class="o">+</span> <span class="s">&quot; 0.0 0.0 0.0</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">dnode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">ni</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nseg</span><span class="p">:</span>
            <span class="c">#</span>
            <span class="c"># segments</span>
            <span class="c">#</span>
            <span class="n">ta</span> <span class="o">=</span> <span class="n">dnode</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">he</span> <span class="o">=</span> <span class="n">dnode</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">cta</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>
            <span class="n">che</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">he</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">core</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
            <span class="n">zmin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">zmax</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="n">cta</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">che</span> <span class="o">+</span> <span class="s">&quot; 1 &quot;</span> <span class="o">+</span> <span class="n">core</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="s">&quot; 1 &quot;</span> <span class="o">+</span> \
                <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="s">&quot; 0 &quot;</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmin</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">zmax</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nseg</span><span class="p">):</span>
            <span class="c">#</span>
            <span class="c"># sub-segment</span>
            <span class="c">#</span>

            <span class="k">if</span> <span class="s">&#39;ss_name&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>

                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">core</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">core</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;index&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">):</span>
                    <span class="n">ce1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_ce1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ce1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">):</span>
                    <span class="n">ce2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_ce2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ce2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">ss_zmin</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ss_zmax</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">core</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ce1</span> <span class="o">+</span> \
                    <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ce2</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ss_zmin</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">ss_zmax</span> <span class="o">+</span>  <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.angleonlink"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.angleonlink.html#pylayers.gis.layout.Layout.angleonlink">[docs]</a>    <span class="k">def</span> <span class="nf">angleonlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">p2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; angleonlink(self,p1,p2) return (seglist,angle) between p1 and p2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p1 : np.array (2 x Np) or (2,)</span>
<span class="sd">        p2 : np.array (2 x Np) or (2,)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        seglist : list</span>
<span class="sd">                  list of segment number on the link</span>
<span class="sd">        angle   : angle (in radians) between segment and LOS axis</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;DLR.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">        &gt;&gt;&gt; p2 = np.array([10,3])</span>
<span class="sd">        &gt;&gt;&gt; alpha = L.angleonlink(p1,p2)</span>

<span class="sd">        #array([(0, 141, 1.2793395519256592), (0, 62, 0.29145678877830505),</span>
<span class="sd">               (0, 65, 0.29145678877830505)],</span>
<span class="sd">              dtype=[(&#39;i&#39;, &#39;&lt;i8&#39;), (&#39;s&#39;, &#39;&lt;i8&#39;), (&#39;a&#39;, &#39;&lt;f4&#39;)])</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">sh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">sh1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span>
        <span class="k">assert</span> <span class="n">sh2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>   
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>   
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
       
        <span class="c"># 2 x N</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="c"># 1 x N</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c"># 2 x N </span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">nu</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>

        <span class="n">upos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">seglist</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uneg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">seglist</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">nNLOS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uneg</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="c"># retrieve the number of segments per link</span>
        <span class="k">if</span> <span class="n">nNLOS</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">llink</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">uneg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">uneg</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)])))</span><span class="o">-</span><span class="n">uneg</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">llink</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)])</span>
        <span class="c"># [(link id,number of seg),...]</span>
        <span class="c">#nl = zip(np.arange(nlink),llink)</span>

        <span class="n">npta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">[</span><span class="n">upos</span><span class="p">]]</span>
        <span class="n">nphe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">[</span><span class="n">upos</span><span class="p">]]</span>

        <span class="n">Pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">npta</span><span class="p">]</span>
        <span class="n">Phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">nphe</span><span class="p">]</span>
       
        <span class="c">#</span>
        <span class="c"># This part should possibly be improved</span>
        <span class="c">#</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">nl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">llink</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">P1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">))))</span>
                <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">P2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">))))</span>
                <span class="n">ilink</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ilink</span><span class="p">,</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">))</span>
                <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">))</span>
                <span class="n">ilink</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nl</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>

        <span class="n">bo</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Pta</span><span class="p">,</span> <span class="n">Phe</span><span class="p">)</span>

        <span class="n">upos_intersect</span> <span class="o">=</span> <span class="n">upos</span><span class="p">[</span><span class="n">bo</span><span class="p">]</span>

        <span class="n">seglist2</span> <span class="o">=</span> <span class="n">seglist</span><span class="p">[</span><span class="n">upos_intersect</span><span class="p">]</span>
        <span class="n">idxlnk</span> <span class="o">=</span> <span class="n">ilink</span><span class="p">[</span><span class="n">upos_intersect</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c"># Calculate angle of incidence refered from segment normal</span>
        <span class="c">#</span>

        <span class="n">norm</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="n">seglist2</span><span class="p">]</span>
        <span class="c"># vector along the link</span>
        <span class="n">uu</span> <span class="o">=</span> <span class="n">un</span><span class="p">[:,</span><span class="n">idxlnk</span><span class="p">]</span>
        <span class="n">unn</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">uu</span> <span class="o">*</span> <span class="n">norm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">unn</span><span class="p">)</span>

        <span class="c"># seglist = seglist+1</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">seglist2</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;i8&#39;</span><span class="p">),(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="s">&#39;i8&#39;</span><span class="p">),(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)])</span>

        <span class="c">#</span>
        <span class="c"># update subsegment in seglist</span>
        <span class="c">#</span>
        <span class="c"># self.sla</span>
        <span class="c"># self.lsss</span>
        <span class="c"># self.stridess</span>
        <span class="c">#</span>
        <span class="n">sseglist</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stridess</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span> <span class="k">else</span> <span class="n">x</span><span class="p">,</span><span class="n">seglist</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idxlnk</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sseglist</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.angleonlinkold"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.angleonlinkold.html#pylayers.gis.layout.Layout.angleonlinkold">[docs]</a>    <span class="k">def</span> <span class="nf">angleonlinkold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">p2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; angleonlink(self,p1,p2) returns seglist between p1 and p2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p1 : (1 x 2 )</span>
<span class="sd">            [0,0]</span>
<span class="sd">        p2 : (1 x 2 )</span>
<span class="sd">            [10,3]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        seglist : list</span>
<span class="sd">                  list of segment number on the link</span>
<span class="sd">        theta</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        #&gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        #&gt;&gt;&gt; L = Layout(&#39;DLR.ini&#39;,&#39;matDB.ini&#39;,&#39;slabDB.ini&#39;)</span>
<span class="sd">        #&gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">        #&gt;&gt;&gt; p2 = np.array([10,3])</span>
<span class="sd">        #&gt;&gt;&gt; L.angleonlinkold(p1,p2)</span>
<span class="sd">        #(array([59, 62, 65]), array([ 1.27933953,  0.29145679,  0.29145679]))</span>
<span class="sd">       </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;This function is deprecated use&#39;</span><span class="p">)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">nu</span>

       
        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="c"># new implementation of seginframe is faster</span>
        <span class="c">#</span>
        <span class="c">#seglist = self.seginframe2(p1, p2)</span>

        <span class="n">npta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">nphe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>

        <span class="n">Pta</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">npta</span><span class="p">]</span>
        <span class="n">Phe</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">nphe</span><span class="p">]</span>

        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>

        <span class="n">bo</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Pta</span><span class="p">,</span> <span class="n">Phe</span><span class="p">)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="n">seglist</span><span class="p">[</span><span class="n">bo</span><span class="p">]</span>

        <span class="c">#</span>
        <span class="c"># Calculate normal angle angle of incidence</span>
        <span class="c">#</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">head</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>

        <span class="n">vn</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">head</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">tail</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">head</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">tail</span><span class="p">]))</span>
        <span class="n">mvn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vn</span> <span class="o">*</span> <span class="n">vn</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">vn</span> <span class="o">/</span> <span class="n">mvn</span>
        <span class="n">uu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">unn</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">uu</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">unn</span><span class="p">)</span>

        <span class="c">#print vn</span>
        <span class="c">#print mvn</span>
        <span class="c">#print &#39;n :&#39;,n</span>
        <span class="c">#print &#39;un : &#39;,unn</span>
        <span class="c">#print &#39;theta (deg)&#39;,the*180./pi</span>

        <span class="c"># seglist = seglist+1</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">seglist</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.layeronlink"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.layeronlink.html#pylayers.gis.layout.Layout.layeronlink">[docs]</a>    <span class="k">def</span> <span class="nf">layeronlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        layeronlink(self,p1,p2) return seglist between p1 and p2</span>

<span class="sd">        p1 : (1 x 2 )</span>
<span class="sd">        p2 : (1 x 2 )</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
        <span class="n">npta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>
        <span class="n">nphe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">seglist</span><span class="p">]</span>

        <span class="n">Pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">npta</span><span class="p">]</span>
        <span class="n">Phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="n">nphe</span><span class="p">]</span>

        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seglist</span><span class="p">)))</span>

        <span class="nb">bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">P2</span><span class="p">,</span> <span class="n">Pta</span><span class="p">,</span> <span class="n">Phe</span><span class="p">)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="n">seglist</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">seglist</span>
</div>
<div class="viewcode-block" id="Layout.seguv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seguv.html#pylayers.gis.layout.Layout.seguv">[docs]</a>    <span class="k">def</span> <span class="nf">seguv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iseg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns unitary vector along segments</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        iseg : np.array</span>
<span class="sd">                index of segments</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;DLR.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; idx = np.array([1,2,3,17])</span>
<span class="sd">        &gt;&gt;&gt; L.seguv(idx)</span>
<span class="sd">        array([[-1.,  0.,  1., -1.],</span>
<span class="sd">               [ 0., -1.,  0.,  0.]])</span>
<span class="sd">        &gt;&gt;&gt; idx = np.array([1])</span>
<span class="sd">        &gt;&gt;&gt; L.seguv(idx)</span>
<span class="sd">        array([-1.,  0.])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># idx : npt</span>
        <span class="n">idx</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgs</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>
        <span class="c"># tahe : 2 x npt</span>
        <span class="n">tahe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">if</span>  <span class="nb">len</span><span class="p">(</span><span class="n">iseg</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ta</span>   <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">he</span>   <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ta</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">he</span> <span class="o">=</span> <span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">pta</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span><span class="n">ta</span><span class="p">]</span>
        <span class="n">phe</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span><span class="n">he</span><span class="p">]</span>
        <span class="c"># v  : 2 x npt</span>
        <span class="n">v</span>    <span class="o">=</span> <span class="n">pta</span><span class="o">-</span><span class="n">phe</span>
        <span class="c"># mv : npt</span>
        <span class="n">mv</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c"># vn : 2 x npt</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">vn</span>  <span class="o">=</span> <span class="n">v</span><span class="o">/</span><span class="n">mv</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vn</span>  <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="n">mv</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Layout.segpt2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.segpt2.html#pylayers.gis.layout.Layout.segpt2">[docs]</a>    <span class="k">def</span> <span class="nf">segpt2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptlist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a sequence of point number</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ptlist</span>

<span class="sd">            array(1xNp) Point number array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        seglist</span>
<span class="sd">            array seglist associated with ptlist</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;example.str&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ptlist  = np.array([0,1])</span>
<span class="sd">        &gt;&gt;&gt; L.segpt(ptlist)</span>
<span class="sd">        array([0, 1, 5, 7])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#seglist = np.array([], dtype=int)</span>
        <span class="n">ut</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">==</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">==</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">])),</span> <span class="n">ptlist</span><span class="p">)</span>
        <span class="n">utstack</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)),</span><span class="n">ut</span><span class="p">)</span>
        <span class="c">#uvstack = reduce(lambda x,y : np.hstack((x,y)),uv)</span>
        <span class="c">#for i in ptlist:</span>
        <span class="c">#    ut = np.nonzero(self.tahe[0, :] == i)[0]</span>
        <span class="c">#    uv = np.nonzero(self.tahe[1, :] == i)[0]</span>
        <span class="c">#    seglist = np.hstack((seglist, ut, uv))</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">utstack</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.seg2pts"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seg2pts.html#pylayers.gis.layout.Layout.seg2pts">[docs]</a>    <span class="k">def</span> <span class="nf">seg2pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">aseg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert segments array to coresponding termination points array</span>
<span class="sd">       </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">       </span>
<span class="sd">        aseg : np.array (,Ns) or int for single value:w</span>
<span class="sd">            array of segment number (&gt;0)</span>
<span class="sd">       </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">       </span>
<span class="sd">        pth : np.array (4 x Ns)</span>
<span class="sd">            pth is a vstacking of tail point (2,Ns) and head point (2,Ns)</span>
<span class="sd">           </span>
<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">       </span>
<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;defstr.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; aseg = np.array([1,3,6])</span>
<span class="sd">        &gt;&gt;&gt; L.seg2pts(aseg)</span>
<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aseg</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">aseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">aseg</span><span class="p">])</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">aseg</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">utahe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tgs</span><span class="p">[</span><span class="n">aseg</span><span class="p">]</span>
        <span class="n">tahe</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[:,</span><span class="n">utahe</span><span class="p">]</span>
        <span class="n">ptail</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]]</span>
        <span class="n">phead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]]</span>
        <span class="n">pth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">ptail</span><span class="p">,</span><span class="n">phead</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pth</span>
</div>
<div class="viewcode-block" id="Layout.segpt"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.segpt.html#pylayers.gis.layout.Layout.segpt">[docs]</a>    <span class="k">def</span> <span class="nf">segpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptlist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a sequence of point number</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ptlist array(1xNp)</span>
<span class="sd">            point number array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        seglist</span>
<span class="sd">            array seglist associated with ptlist</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;example.str&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ptlist  = np.array([0,1])</span>
<span class="sd">        &gt;&gt;&gt; L.segpt(ptlist)</span>
<span class="sd">        array([0, 1, 5, 7])</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        segpt is faster than segpt2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ptlist</span><span class="p">:</span>
            <span class="n">ut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">seglist</span><span class="p">,</span> <span class="n">ut</span><span class="p">,</span> <span class="n">uv</span><span class="p">))</span>
        <span class="n">seglist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Layout.extrseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.extrseg.html#pylayers.gis.layout.Layout.extrseg">[docs]</a>    <span class="k">def</span> <span class="nf">extrseg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate extremum of segments</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Used in seginframe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># 2 x Np</span>
        <span class="n">pt</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span>
        <span class="c"># tahe 2 x Nseg</span>
        <span class="n">th</span>  <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">th</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">th</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">th</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">th</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Layout.seginframe2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seginframe2.html#pylayers.gis.layout.Layout.seginframe2">[docs]</a>    <span class="k">def</span> <span class="nf">seginframe2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a given zone defined by two points</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            p1</span>
<span class="sd">                array (2 x N)</span>
<span class="sd">            p2</span>
<span class="sd">                array (2 x N)</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            seglist</span>
<span class="sd">                list of segment number inside a planar region defined by p1 an p2</span>


<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;TA-Office.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = np.array([[0,0,0],[0,0,0]])</span>
<span class="sd">            &gt;&gt;&gt; p2 = np.array([[10,10,10],[10,10,10]])</span>
<span class="sd">            &gt;&gt;&gt; seglist = L.seginframe2(p1,p2)</span>
<span class="sd">            &gt;&gt;&gt; edlist  = map(lambda x: L.tsg[x],seglist)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showGs(edlist=edlist)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="n">sh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">sh1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span>
        <span class="k">assert</span> <span class="n">sh2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>   
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>   
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

        <span class="c"># clipping conditions to keep segment</span>
        <span class="c">#</span>
        <span class="c"># max_sx &gt; min_x</span>
        <span class="c"># min_sx &lt; max_x</span>
        <span class="c"># max_sy &gt; min_y</span>
        <span class="c"># min_sy &lt; max_y</span>


            <span class="c"># N x 1</span>

        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]))</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]))</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]))</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]))</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_sx</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_sx</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span>
                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_sy</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span> 
                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_sy</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">min_x</span><span class="p">,</span><span class="n">max_x</span><span class="p">,</span><span class="n">min_y</span><span class="p">,</span><span class="n">max_y</span><span class="p">))</span>
        <span class="c"># np.array stacking</span>
        <span class="c"># -1 acts as a deliminiter (not a segment number)</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">y</span><span class="p">)),</span><span class="n">seglist</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.seginframe"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seginframe.html#pylayers.gis.layout.Layout.seginframe">[docs]</a>    <span class="k">def</span> <span class="nf">seginframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the seg list of a given zone defined by two points</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            p1</span>
<span class="sd">                array (1 x 2)</span>
<span class="sd">            p2</span>
<span class="sd">                array (1 x 2)</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            seglist</span>
<span class="sd">                list of segment number inside a planar region defined by p1 an p2</span>


<span class="sd">            Examples</span>
<span class="sd">            --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;office.str&#39;)</span>
<span class="sd">            &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">            &gt;&gt;&gt; p2 = np.array([10,10])</span>
<span class="sd">            &gt;&gt;&gt; L.seginframe(p1,p2)</span>
<span class="sd">            array([ 13,  16,  17,  18,  24,  25,  26,  27,  30,  31,  32,  35,  36,</span>
<span class="sd">                    37,  38,  39,  41,  42,  47,  48,  49,  50,  54,  58,  59,  60,</span>
<span class="sd">                    61,  62,  63,  68,  69,  72,  73,  74,  75,  76,  77,  83,  97,</span>
<span class="sd">                    98,  99, 109, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121,</span>
<span class="sd">                   122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 141,</span>
<span class="sd">                   144, 145, 148, 151, 160, 161, 162, 163, 164, 166, 167, 168, 169,</span>
<span class="sd">                   170, 171, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188,</span>
<span class="sd">                   191, 192, 193, 194, 195, 217])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">Dx</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span>
       
        <span class="k">if</span> <span class="n">Dx</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">max_x</span><span class="o">=</span><span class="n">max_x</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="n">min_x</span><span class="o">=</span><span class="n">min_x</span><span class="o">-</span><span class="mf">0.5</span>

        <span class="k">if</span> <span class="n">Dy</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">max_y</span><span class="o">=</span><span class="n">max_y</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="n">min_y</span><span class="o">=</span><span class="n">min_y</span><span class="o">-</span><span class="mf">0.5</span>



        <span class="k">if</span> <span class="p">(</span><span class="n">Dy</span> <span class="o">&lt;</span> <span class="n">Dx</span><span class="p">):</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">max_x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">min_x</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="n">max_y</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="n">min_y</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">seglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segpt</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.layerongrid"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.layerongrid.html#pylayers.gis.layout.Layout.layerongrid">[docs]</a>    <span class="k">def</span> <span class="nf">layerongrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">Tx</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; grid Nx,Ny,2</span>
<span class="sd">            Tx   1x2</span>
<span class="sd">            .. todo:: layeron grid Not finished</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">Nx</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Ny</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span> <span class="n">iy</span><span class="p">,</span> <span class="p">:]</span>
                    <span class="n">seglist</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layeronlink</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Tx</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Layout.cycleinline"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.cycleinline.html#pylayers.gis.layout.Layout.cycleinline">[docs]</a>    <span class="k">def</span> <span class="nf">cycleinline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the intersection between a given line and all segments</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            p1 : numpy.ndarray</span>
<span class="sd">            p2 : numpy.ndarray</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            I : numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">poly1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">c1</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>
        <span class="n">p1t</span> <span class="o">=</span> <span class="n">poly1</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">xy</span>

        <span class="n">poly2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">c2</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>
        <span class="n">p2t</span> <span class="o">=</span> <span class="n">poly2</span><span class="o">.</span><span class="n">centroid</span><span class="o">.</span><span class="n">xy</span>
       
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p1t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">p1t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p2t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">p2t</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span>

       
        <span class="c"># els = self.seginframe(p1,p2)</span>
        <span class="c"># new implementation of seginframe is faster</span>
        <span class="n">els</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seginframe2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
        <span class="n">elg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">[</span><span class="n">els</span><span class="p">]</span>

        <span class="n">lc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ls</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
       
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">elg</span><span class="p">:</span>
            <span class="n">ta</span><span class="p">,</span> <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
            <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ta</span><span class="p">])</span>
            <span class="n">pb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">he</span><span class="p">])</span>

            <span class="n">segline</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">pa</span><span class="p">,</span><span class="n">pb</span><span class="p">))</span>


            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">segline</span><span class="p">):</span>
                <span class="n">lc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">seg</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
            <span class="c">#print seg,self.Gs.node[seg][&#39;ncycles&#39;]</span>
                <span class="n">ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
                <span class="n">psh</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">segline</span><span class="p">)</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">I</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">psh</span><span class="o">.</span><span class="n">x</span><span class="p">],[</span><span class="n">psh</span><span class="o">.</span><span class="n">y</span><span class="p">]])))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">p1</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dv</span><span class="p">)</span>
        <span class="n">lss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ls</span><span class="p">)[</span><span class="n">u</span><span class="p">]</span>

        <span class="n">lc</span><span class="o">=</span><span class="p">[</span><span class="n">c1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">lss</span><span class="p">:</span>
            <span class="n">cy1</span><span class="p">,</span><span class="n">cy2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cy1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lc</span> <span class="p">:</span>
                <span class="n">lc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cy2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lc</span> <span class="p">:</span>
                <span class="n">lc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy2</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">assert</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Bad transisiton in Layout.cycleinline&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lc</span>
               


</div>
<div class="viewcode-block" id="Layout.seginline"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seginline.html#pylayers.gis.layout.Layout.seginline">[docs]</a>    <span class="k">def</span> <span class="nf">seginline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the intersection between a given line and all segments</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            p1 : numpy.ndarray</span>
<span class="sd">            p2 : numpy.ndarray</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            I : numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">seg</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">ta</span><span class="p">,</span> <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
                <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ta</span><span class="p">])</span>
                <span class="n">pb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">he</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">seg</span><span class="p">])</span>
                <span class="n">pb</span> <span class="o">=</span> <span class="n">pa</span>

            <span class="n">segline</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">pa</span><span class="p">,</span><span class="n">pb</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">segline</span><span class="p">):</span>
                <span class="n">psh</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">segline</span><span class="p">)</span>
                <span class="n">liseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">psh</span><span class="o">.</span><span class="n">x</span><span class="p">],[</span><span class="n">psh</span><span class="o">.</span><span class="n">y</span><span class="p">]])</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">I</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(([[</span><span class="n">seg</span><span class="p">]],</span><span class="n">liseg</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">I</span>
               
       
</div>
<div class="viewcode-block" id="Layout.checkvis"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.checkvis.html#pylayers.gis.layout.Layout.checkvis">[docs]</a>    <span class="k">def</span> <span class="nf">checkvis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">,</span> <span class="n">nodelist</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Layout.visilist"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.visilist.html#pylayers.gis.layout.Layout.visilist">[docs]</a>    <span class="k">def</span> <span class="nf">visilist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the list of nodes from Gc which are visible from point p</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p</span>
<span class="sd">            np.array point</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        AAS = [0:2pi]</span>
<span class="sd">        While (AAS != void set)</span>
<span class="sd">             1) Find segment ns either</span>
<span class="sd">                i)  the closest segment from p in AAS</span>
<span class="sd">                ii) neighbor of prec(ns)</span>
<span class="sd">             2) Find the edgelist visible from ns</span>
<span class="sd">            edgelist = vedgelist(ns)</span>
<span class="sd">             3) Check_occultation(p,ns,edgelist)</span>
<span class="sd">                Occultation 8  situations</span>
<span class="sd">                [p1,pM,p2] = [T,T,T]  : fully occulted</span>
<span class="sd">                         [     ]    partially visible</span>
<span class="sd">                         [F,F,F]  : fully visible</span>
<span class="sd">             4) Update Allowed Angular Sector  (AAS)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">AAS</span> <span class="o">=</span> <span class="n">Intvl</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">])</span>
        <span class="n">nsprev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">edgelist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

        <span class="k">while</span> <span class="n">AAS</span><span class="o">.</span><span class="n">measure</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nsprev</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">closest</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">AAS</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nsprev</span><span class="p">)</span>
            <span class="n">edgelist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vedgelist</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
            <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">bM</span><span class="p">,</span> <span class="n">b2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">-</span> <span class="n">occultation</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">)</span>
            <span class="n">AAS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">AAS</span><span class="p">,)</span>
</div>
<div class="viewcode-block" id="Layout.closest_edge"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.closest_edge.html#pylayers.gis.layout.Layout.closest_edge">[docs]</a>    <span class="k">def</span> <span class="nf">closest_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">AAS</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        This function return the closest segment from p which belong to</span>
<span class="sd">        the AAS (Allowed Angular Sector)</span>

<span class="sd">        [ns] = closest_edge(self,p,AAS)</span>

<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="Layout.visi_papb"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.visi_papb.html#pylayers.gis.layout.Layout.visi_papb">[docs]</a>    <span class="k">def</span> <span class="nf">visi_papb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pa</span><span class="p">,</span> <span class="n">pb</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        visi_papb : determine if pa and pb are in visibility for the structure graph</span>

<span class="sd">        visi_papb(pa,pb,edgelist)</span>

<span class="sd">        pa       : 1x2</span>
<span class="sd">        pb       : 1x2</span>
<span class="sd">        edgelist : exclusion edge list</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># .. todo: avoid utilisation tahe</span>
        <span class="c">#</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ta</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ta</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">he</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">he</span><span class="p">]</span>

        <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">den</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">den</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-12</span>
        <span class="n">numa</span> <span class="o">=</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">numb</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">ua</span> <span class="o">=</span> <span class="n">numa</span> <span class="o">/</span> <span class="n">den</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">numb</span> <span class="o">/</span> <span class="n">den</span>

        <span class="c">#ua[edgelist] = 1000</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">ua</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ua</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ub</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Si le segment de droite pa-pb intercepte des paroies de la structure</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">!=</span> <span class="p">[]):</span>
            <span class="n">visi</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">visi</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span><span class="p">(</span><span class="n">visi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.save.html#pylayers.gis.layout.Layout.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; save layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">racine</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">racine</span> <span class="o">+</span> <span class="s">&#39;.str2&#39;</span>
            <span class="n">fileini</span> <span class="o">=</span> <span class="n">racine</span> <span class="o">+</span> <span class="s">&#39;.ini&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">savestr2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveini</span><span class="p">(</span><span class="n">fileini</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;structure saved in &quot;</span><span class="p">,</span> <span class="n">filename</span>
            <span class="k">print</span> <span class="s">&quot;structure saved in &quot;</span><span class="p">,</span> <span class="n">fileini</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="n">racine</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.str2&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savestr2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;structure saved in &quot;</span><span class="p">,</span> <span class="n">filename</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.ini&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">savestr2</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;structure saved in &quot;</span><span class="p">,</span> <span class="n">fileini</span>
</div>
<div class="viewcode-block" id="Layout.saveold"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.saveold.html#pylayers.gis.layout.Layout.saveold">[docs]</a>    <span class="k">def</span> <span class="nf">saveold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Layout (deprecated)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            File extension is .gml</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileGs</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gs&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_gml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">fileGs</span><span class="p">)</span>
        <span class="n">fileGc</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gc&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">write_gml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gc</span><span class="p">,</span> <span class="n">fileGc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.loadG"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.loadG.html#pylayers.gis.layout.Layout.loadG">[docs]</a>    <span class="k">def</span> <span class="nf">loadG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            File extension is .gml</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fileGs</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gs&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="n">fileGs</span><span class="p">)</span>
        <span class="n">fileGc</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&#39;Gc&#39;</span> <span class="o">+</span> <span class="s">&#39;.gml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">read_gml</span><span class="p">(</span><span class="n">fileGc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.show_nodes"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show_nodes.html#pylayers.gis.layout.Layout.show_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">show_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndlist</span><span class="o">=</span><span class="p">[</span><span class="mf">1e8</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show nodes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ndlist</span>
<span class="sd">        size   : int</span>
<span class="sd">            default 10</span>
<span class="sd">        color :  &#39;b&#39;</span>
<span class="sd">        dlabels : Boolean</span>
<span class="sd">            False</span>
<span class="sd">        font_size : int</span>
<span class="sd">            15</span>
<span class="sd">        alpha : float</span>
<span class="sd">            transparancy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ndlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ndlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1e8</span><span class="p">)</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">ndlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1e8</span><span class="p">:</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="c">#elif ndlist[0]==1e8:</span>
        <span class="c">#    ndlist  = self.Gs.node.keys()</span>

        <span class="c">#print ndlist</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">ndlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlabels</span><span class="p">:</span>
            <span class="n">dicopos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dicolab</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ndlist</span><span class="p">:</span>
                <span class="n">dicopos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="n">dicolab</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">dicopos</span><span class="p">,</span> <span class="n">dicolab</span><span class="p">,</span>
                                    <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.show_seg1"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show_seg1.html#pylayers.gis.layout.Layout.show_seg1">[docs]</a>    <span class="k">def</span> <span class="nf">show_seg1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        edlist</span>
<span class="sd">        alpha</span>
<span class="sd">        width</span>
<span class="sd">        size</span>
<span class="sd">        color</span>
<span class="sd">        font_size</span>
<span class="sd">        dlabels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;ndarray&#39;</span><span class="p">:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="n">edlist</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">edlist</span><span class="p">]</span>

        <span class="c">#print ndlist</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">edlist</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlabels</span><span class="p">:</span>
            <span class="n">dicopos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dicolab</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ndlist</span><span class="p">:</span>
                <span class="c">#dicopos[n]=tuple(np.array(self.Gs.pos[n])+np.array((0.8,0.2)))</span>
                <span class="n">dicopos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="n">dicolab</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">dicopos</span><span class="p">,</span> <span class="n">dicolab</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.show_segment"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show_segment.html#pylayers.gis.layout.Layout.show_segment">[docs]</a>    <span class="k">def</span> <span class="nf">show_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        edlist : list</span>
<span class="sd">            segment list</span>
<span class="sd">        alpha : float</span>
<span class="sd">            transparency 0&lt; alpha &lt; 1</span>
<span class="sd">        width : float</span>
<span class="sd">            line width (default 1)</span>
<span class="sd">        color : string</span>
<span class="sd">            default &#39;black&#39;</span>
<span class="sd">        dnodes : boolean</span>
<span class="sd">            display nodes ( Default False)</span>
<span class="sd">        dlabels : boolean</span>
<span class="sd">            display labels ( Default False)</span>
<span class="sd">        font_size : int</span>
<span class="sd">            Default 15</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;edlist&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;width&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;black&#39;</span><span class="p">,</span>
                    <span class="s">&#39;dnodes&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;dlabels&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;font_size&#39;</span><span class="p">:</span><span class="mi">15</span>
                   <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">clrlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>

        <span class="c"># html color or string</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;#&#39;</span><span class="p">:</span>
            <span class="n">clrlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cold</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="s">&#39;#FFFFF0&#39;</span><span class="p">:</span>
                <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#00000F&#39;</span>
            <span class="n">clrlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="n">ecmap</span> <span class="o">=</span> <span class="n">clr</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">clrlist</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edlist&#39;</span><span class="p">])</span>
        <span class="n">ue</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edlist&#39;</span><span class="p">])))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">U</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">U</span><span class="p">,</span>
                               <span class="n">edge_color</span><span class="o">=</span><span class="n">ue</span><span class="p">,</span> <span class="n">edge_cmap</span><span class="o">=</span><span class="n">ecmap</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dlabels&#39;</span><span class="p">]:</span>
               <span class="c"># print edlist</span>
               <span class="c"># nodelist = self.ed2nd(edlist)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edlist&#39;</span><span class="p">],</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dlabels&#39;</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;font_size&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dnodes&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edlist&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.show_layer"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show_layer.html#pylayers.gis.layout.Layout.show_layer">[docs]</a>    <span class="k">def</span> <span class="nf">show_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="p">[],</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">dthin</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                   <span class="n">dlabels</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; show layer</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name :</span>
<span class="sd">        edlist : []</span>
<span class="sd">        alpha : float</span>
<span class="sd">            transparency</span>
<span class="sd">        width : int</span>
<span class="sd">            if width = 0 linewidth depends on slab property</span>
<span class="sd">        color : string</span>
<span class="sd">            default black&#39;</span>
<span class="sd">        dnodes :</span>
<span class="sd">            display nodes (False )</span>
<span class="sd">        dthin :</span>
<span class="sd">            display thin ( False )</span>
<span class="sd">        dlabels :</span>
<span class="sd">            display labels ( False )</span>
<span class="sd">        font_size</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">edlist</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># intersect layer edge list with local zone edge list (in function argument)</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edlist</span><span class="p">)</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_segment</span><span class="p">(</span><span class="n">edlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span>
                              <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                              <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span>
                              <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">width</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">slab</span><span class="p">[</span><span class="s">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">width</span>
            <span class="k">if</span> <span class="n">fGHz</span><span class="o">==</span><span class="p">[]:</span>   
                <span class="n">color</span> <span class="o">=</span> <span class="n">slab</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;METAL&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;METALIC&#39;</span><span class="p">):</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">slab</span><span class="o">.</span><span class="n">tocolor</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_segment</span><span class="p">(</span><span class="n">edlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="n">dnodes</span><span class="p">,</span>
                            <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.showGi"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showGi.html#pylayers.gis.layout.Layout.showGi">[docs]</a>    <span class="k">def</span> <span class="nf">showGi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  show graph of interactions Gi</span>

<span class="sd">        en  : int</span>
<span class="sd">            edge number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># interactions corresponding to edge en</span>
        <span class="n">int0</span><span class="p">,</span><span class="n">int1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edges</span><span class="p">()[</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;en&#39;</span><span class="p">]]</span>

        <span class="k">print</span> <span class="s">&quot;int0 : &quot;</span><span class="p">,</span><span class="n">int0</span>
        <span class="k">print</span> <span class="s">&quot;int1 : &quot;</span><span class="p">,</span><span class="n">int1</span>
       
        <span class="c"># if interaction is tuple (R or T)</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">type</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">int0</span><span class="p">))</span><span class="o">==</span><span class="nb">tuple</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">int1</span><span class="p">))</span><span class="o">==</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="c"># segment number associated to interaction</span>
            <span class="n">nstr0</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">int0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nstr1</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">int1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">int0</span><span class="p">][</span><span class="n">int1</span><span class="p">][</span><span class="s">&#39;output&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot; output &quot;</span><span class="p">,</span> <span class="n">output</span>
            <span class="n">ltup</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="nb">tuple</span><span class="p">,</span><span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">lref</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span><span class="n">ltup</span><span class="p">)</span>
            <span class="n">ltran</span> <span class="o">=</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="mi">3</span><span class="p">,</span><span class="n">ltup</span><span class="p">)</span>
            <span class="n">lseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
            <span class="n">probR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">output</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">lref</span><span class="p">))</span>
            <span class="n">segR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">lref</span><span class="p">))</span>
            <span class="n">probT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">output</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">ltran</span><span class="p">))</span>
            <span class="n">segT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">lref</span><span class="p">))</span>
            <span class="n">dprobR</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">segR</span><span class="p">,</span><span class="n">probR</span><span class="p">))</span>
            <span class="n">dprobT</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">segT</span><span class="p">,</span><span class="n">probT</span><span class="p">))</span>
            <span class="k">print</span> <span class="s">&quot; Sum pR : &quot;</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="n">dprobR</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">print</span> <span class="s">&quot; Sum pT : &quot;</span><span class="p">,</span><span class="nb">sum</span><span class="p">(</span><span class="n">dprobT</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="k">print</span> <span class="s">&quot;lseg&quot;</span><span class="p">,</span> <span class="n">lseg</span>
            <span class="c"># termination points from seg0 and seg1</span>
            <span class="n">pseg0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg2pts</span><span class="p">(</span><span class="n">nstr0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">pseg1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg2pts</span><span class="p">(</span><span class="n">nstr1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="c">#</span>
            <span class="c"># create the cone seg0 seg1</span>
            <span class="c">#</span>
            <span class="n">cn</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">Cone</span><span class="p">()</span>
            <span class="n">cn</span><span class="o">.</span><span class="n">from2segs</span><span class="p">(</span><span class="n">pseg0</span><span class="p">,</span><span class="n">pseg1</span><span class="p">)</span>
            <span class="c"># show cone</span>
            <span class="c"># show Gt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">nse</span> <span class="ow">in</span> <span class="n">lseg</span><span class="p">:</span>
                <span class="n">ta</span><span class="p">,</span> <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nse</span><span class="p">)</span>
                <span class="n">pta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ta</span><span class="p">])</span>
                <span class="n">phe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">he</span><span class="p">])</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pR</span><span class="o">=</span> <span class="n">dprobR</span><span class="p">[</span><span class="n">nse</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">pR</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pT</span> <span class="o">=</span> <span class="n">dprobT</span><span class="p">[</span><span class="n">nse</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">pT</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">pR</span><span class="o">+</span><span class="n">pT</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">phe</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                  <span class="p">[</span><span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">phe</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                   <span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.showGt"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showGt.html#pylayers.gis.layout.Layout.showGt">[docs]</a>    <span class="k">def</span> <span class="nf">showGt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">roomlist</span><span class="o">=</span><span class="p">[],</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;area&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show topological graph Gt</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        ax : matlplotlib axes</span>
<span class="sd">        roomlist : list</span>
<span class="sd">            list of room numbers</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">nc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">poly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">signedarea</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;area&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;start&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">poly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Layout.showGs"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showGs.html#pylayers.gis.layout.Layout.showGs">[docs]</a>    <span class="k">def</span> <span class="nf">showGs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show structure graph Gs</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ndlist  : np.array</span>
<span class="sd">            set of nodes to be displayed</span>
<span class="sd">        edlist  : np.array</span>
<span class="sd">            set of edges to be displayed</span>
<span class="sd">        roomlist : list</span>
<span class="sd">            default : []</span>
<span class="sd">        axis :</span>
<span class="sd">        width : int</span>
<span class="sd">            2</span>
<span class="sd">        fGHz : float</span>
<span class="sd">        show    : boolean</span>
<span class="sd">            default True</span>
<span class="sd">        furniture : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        display parameters are defined in  display dictionnary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ax</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.gis.layout.showG</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;ndlist&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;edlist&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;roomlist&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;axis&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;width&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;fGHz&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;furniture&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
           <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;ax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;clear&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>

        <span class="c"># display overlay image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;overlay&#39;</span><span class="p">]:</span>
            <span class="n">imok</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;http:&#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">img_file</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">])</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">img_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
                <span class="n">imok</span> <span class="o">=</span><span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRIMAGE&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fileoverlay&#39;</span><span class="p">])</span>
                    <span class="n">imok</span> <span class="o">=</span><span class="bp">True</span>
            <span class="k">if</span> <span class="n">imok</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;inverse&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span><span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ndlist&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tn</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ndlist</span> <span class="o">=</span> <span class="n">tn</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edlist&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">tn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="c">#u  = np.nonzero(tn &gt; 0)[0]</span>
            <span class="c">#edlist = tn[u]</span>
            <span class="n">edlist</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">,</span><span class="n">tn</span><span class="p">)</span>
            <span class="c">#&amp; (not self.Gs.node[x].has_key(&#39;ss_name&#39;)),tn)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ndlabel&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_nodes</span><span class="p">(</span><span class="n">ndlist</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">)</span>

        <span class="n">slablist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edges&#39;</span><span class="p">]:</span>
            <span class="n">dlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;edlabel&#39;</span><span class="p">]</span>
            <span class="n">font_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;fontsize&#39;</span><span class="p">]</span>
            <span class="n">dnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span>
            <span class="n">dthin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;thin&#39;</span><span class="p">]</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">nameslab</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;layers&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_layer</span><span class="p">(</span><span class="n">nameslab</span><span class="p">,</span> <span class="n">edlist</span><span class="o">=</span><span class="n">edlist</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                <span class="n">dthin</span><span class="o">=</span><span class="n">dthin</span><span class="p">,</span> <span class="n">dnodes</span><span class="o">=</span><span class="n">dnodes</span><span class="p">,</span> <span class="n">dlabels</span><span class="o">=</span><span class="n">dlabels</span><span class="p">,</span>
                                <span class="n">font_size</span><span class="o">=</span><span class="n">font_size</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">],</span><span class="n">fGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;subseg&#39;</span><span class="p">]:</span>
            <span class="n">dico</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dico</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&lt;&gt;</span><span class="s">&#39;METAL&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">k</span><span class="o">&lt;&gt;</span><span class="s">&#39;METALIC&#39;</span><span class="p">):</span>
                        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">tocolor</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
                        <span class="c">#color = &#39;red&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">color</span><span class="o">=</span><span class="s">&#39;black&#39;</span>
                        <span class="c">#print k,color</span>
                <span class="n">edlist2</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">dico</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">edlist2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="c">#edlist2.append(ts)</span>
                <span class="n">edlist3</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edlist2</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">edlist</span><span class="p">)))</span>
                <span class="c">#print k , color , edlist</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_segment</span><span class="p">(</span><span class="n">edlist</span><span class="o">=</span><span class="n">edlist3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;scaled&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
        <span class="c">#fig = plt.gcf()</span>
        <span class="c">#ax  = fig.axes[0]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ticksoff&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;furniture&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s">&#39;lfur&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fur1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lfur</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fur1</span><span class="o">.</span><span class="n">Matname</span> <span class="o">==</span> <span class="s">&#39;METAL&#39;</span><span class="p">:</span>
                        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">fur1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Warning : no furniture file loaded&quot;</span>


        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;roomlist&#39;</span><span class="p">]:</span>
            <span class="n">ncy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axis&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axis&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Layout.build"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.build.html#pylayers.gis.layout.Layout.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s">&#39;trwcvi&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build graphs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        graph : string composed of</span>
<span class="sd">            &#39;t&#39; : Gt</span>
<span class="sd">            &#39;r&#39; : Gr</span>
<span class="sd">            &#39;w&quot; : Gw</span>
<span class="sd">            &#39;s&#39; : Gs</span>
<span class="sd">            &#39;v&#39; : Gv</span>
<span class="sd">            &#39;i&#39; : Gi</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># list of built graphs</span>
       

        <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGt</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGr</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;w&#39;</span> <span class="ow">in</span> <span class="n">graph</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="c">#if &#39;c&#39; in graph:</span>
        <span class="c">#    self.buildGc()</span>
        <span class="k">if</span> <span class="s">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGv</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;i&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGi</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputGi</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildGi2</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">)</span>

        <span class="c"># dictionnary of cycles which have an air wall</span>
        <span class="c">#self.build()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dca</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">seg</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">seg</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;AIR&#39;</span><span class="p">:</span>
                    <span class="n">cy</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dca</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dca</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dca</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dca</span><span class="p">[</span><span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">f</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span><span class="s">&#39;.ini&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveini</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveini</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;.ini&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Layout.dumpw"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.dumpw.html#pylayers.gis.layout.Layout.dumpw">[docs]</a>    <span class="k">def</span> <span class="nf">dumpw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; write a dump of given Graph</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        &#39;t&#39; : Gt</span>
<span class="sd">        &#39;r&#39; : Gr</span>
<span class="sd">        &#39;s&#39; : Gs</span>
<span class="sd">        &#39;v&#39; : Gv</span>
<span class="sd">        &#39;i&#39; : Gi</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;i&#39;</span><span class="p">]:</span>
                    <span class="n">gname1</span> <span class="o">=</span><span class="s">&#39;G&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="n">gname2</span> <span class="o">=</span><span class="s">&#39;dG&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="n">write_gpickle</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gname1</span><span class="p">),</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/G&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">)</span>
                    <span class="n">write_gpickle</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gname2</span><span class="p">),</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/dG&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gname</span><span class="o">=</span><span class="s">&#39;G&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="n">write_gpickle</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">gname</span><span class="p">),</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/G&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;G&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39; graph cannot be saved, probably because it has not been built&#39;</span><span class="p">)</span>
        <span class="c"># save dictionnary which maps string interaction to [interactionnode, interaction type]</span>
        <span class="k">if</span> <span class="s">&#39;i&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="p">:</span>
            <span class="n">write_gpickle</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;di&#39;</span><span class="p">),</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/di_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">)</span>
        <span class="n">write_gpickle</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;dca&#39;</span><span class="p">),</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/dca_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">)</span>


        <span class="n">root</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s">&#39;.ini&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveini</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.dumpr"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.dumpr.html#pylayers.gis.layout.Layout.dumpr">[docs]</a>    <span class="k">def</span> <span class="nf">dumpr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read a dump of given Graph</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        graph : string</span>
<span class="sd">            &#39;t&#39; : Gt</span>
<span class="sd">            &#39;r&#39; : Gr</span>
<span class="sd">            &#39;s&#39; : Gs</span>
<span class="sd">            &#39;v&#39; : Gv</span>
<span class="sd">            &#39;i&#39; : Gi</span>


<span class="sd">        .gpickle files are store under the struc directory of the project</span>
<span class="sd">        specified by the $BASENAME environment variable</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graphs</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="s">&#39;t&#39;</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;i&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">graphs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">,</span><span class="s">&#39;i&#39;</span><span class="p">]:</span>
                    <span class="n">gname1</span> <span class="o">=</span><span class="s">&#39;G&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="n">gname2</span> <span class="o">=</span><span class="s">&#39;dG&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gname1</span><span class="p">,</span>
                            <span class="n">read_gpickle</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/G&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">))</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gname2</span><span class="p">,</span>
                            <span class="n">read_gpickle</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/dG&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gname</span><span class="o">=</span><span class="s">&#39;G&#39;</span><span class="o">+</span><span class="n">g</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gname</span><span class="p">,</span>
                            <span class="n">read_gpickle</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/G&#39;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lbltg</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c">#print &#39;G&#39;,g,&#39; not saved&#39;</span>

        <span class="c">#</span>
        <span class="c"># fixing bug #136</span>
        <span class="c"># update ncycles attributes of Gs from information in Gt</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="k">if</span> <span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vnodes</span> <span class="o">=</span> <span class="n">vnodes</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">vnodes</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">inode</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   <span class="c"># segments</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                            <span class="k">print</span> <span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;dumpr : a segment cannot relate more than 2 cycles&#39;</span><span class="p">)</span>

        <span class="c"># load dictionnary which maps string interaction to [interactionnode, interaction type]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;di&#39;</span><span class="p">,</span> <span class="n">read_gpickle</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/di_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">))</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;dca&#39;</span><span class="p">,</span> <span class="n">read_gpickle</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/struc/gpickle/dca_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s">&#39;.gpickle&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="Layout.buildGc"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGc.html#pylayers.gis.layout.Layout.buildGc">[docs]</a>    <span class="k">def</span> <span class="nf">buildGc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build the connectivity graph</span>

<span class="sd">        nd_nd  : node to node only convex to convex visibility is taken into account</span>
<span class="sd">        nd_ed  : node to edge</span>
<span class="sd">        ed_ed  : edge to edge</span>

<span class="sd">        .. todo: To be Continued</span>
<span class="sd">        Faire ce travail piece par piece</span>
<span class="sd">        Ce code implemnte une condition necessaire mais non suffisante</span>

<span class="sd">        Il existe des points de degre &lt;=2 qui ne sont pas diffractant</span>
<span class="sd">        si en zone concave</span>

<span class="sd">                __________</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">                |</span>
<span class="sd">        Return</span>
<span class="sd">        ------</span>
<span class="sd">        ncoin , ndiff</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># First step</span>
        <span class="c">#</span>
        <span class="c">#for nr in self.Gr.node()</span>
        <span class="n">ncoin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># first step</span>
        <span class="c"># find all node (&lt;0) with  degree &lt; 3</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">deg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deg</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">ncoin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ncoin</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">ndiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ndiff</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ncoin</span><span class="p">,</span> <span class="n">ndiff</span>
</div>
<div class="viewcode-block" id="Layout.buildGt"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGt.html#pylayers.gis.layout.Layout.buildGt">[docs]</a>    <span class="k">def</span> <span class="nf">buildGt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Built topological graph Gt</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. Exploit `cycle_basis` function of NetworkX to get a cycle</span>
<span class="sd">           decomposition of the graph</span>
<span class="sd">        2. Each discovered cycle in the graph Gs is transform in a Cycles.Cycles object</span>
<span class="sd">           LC (List of Cycles) contains the list of all these Cycle objects</span>

<span class="sd">        Algorithm to create the Gt graph.</span>
<span class="sd">        Each simple cycle of Gs is a node of Gt</span>

<span class="sd">        Algorithm  : Seek for Cycle inter connectivity</span>

<span class="sd">                    For c1 in cycles :</span>
<span class="sd">                        vnodesc = get vnodes(c1)</span>
<span class="sd">                            For c2 in cycles &gt; c1</span>
<span class="sd">                                vnodesl = get vnodes(l)</span>
<span class="sd">                                    nkinnl = vnodesk :math:\cap vnodesl</span>



<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">            nx.algorithms.cycles.cycle_basis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># cycle_basis : get a cycle decomposition basis of Gs</span>
        <span class="c">#</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">cycles</span><span class="o">.</span><span class="n">cycle_basis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># append each cycle in a list of Cycle.</span>
        <span class="c">#</span>
        <span class="c">#   This is the creation of the nodes of Gt</span>
        <span class="c">#</span>
        <span class="c">#LC = []</span>
        <span class="n">Gt</span> <span class="o">=</span> <span class="n">cycl</span><span class="o">.</span><span class="n">Cycles</span><span class="p">()</span>
        <span class="n">Gt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">lnode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">subgraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">lnode</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lnode</span><span class="p">})</span>
            <span class="c">#Cy = cy.Cycle(self.Gs, c)</span>
            <span class="n">cy</span>  <span class="o">=</span> <span class="n">cycl</span><span class="o">.</span><span class="n">Cycle</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
            <span class="n">Gt</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">cycle</span><span class="o">=</span><span class="n">cy</span><span class="p">)</span>
            <span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
            <span class="c">#LC.append(cy)</span>
        <span class="n">Gt</span><span class="o">.</span><span class="n">inclusion</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#c23 = Gt.node[23][&#39;cycle&#39;]</span>
        <span class="c">#c25 = Gt.node[25][&#39;cycle&#39;]</span>
        <span class="c">#cc  = c26+c24</span>
        <span class="c">#b1 = c23.inclusion(c25)</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="c">#if b1:</span>
        <span class="c">#punctual,cysmall = c23.split(c25)</span>
        <span class="n">Gt</span> <span class="o">=</span> <span class="n">Gt</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># check algorithm output</span>
        <span class="c">#</span>
        <span class="n">Gt</span><span class="o">.</span><span class="n">inclusion</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Gt</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;first decompose run failed&quot;</span><span class="p">)</span>
            <span class="n">Gt</span> <span class="o">=</span> <span class="n">Gt</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span>
            <span class="n">Gt</span><span class="o">.</span><span class="n">inclusion</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Gt</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;second decompose run failed&quot;</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># transform DiGraph into Graph</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">Gt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
        <span class="c">#cys = cys.decompose()</span>
        <span class="c">#cys.inclusion()</span>
        <span class="c">#cys.simplify2()</span>
        <span class="c"># create the set of Cycle in Cycles</span>
        <span class="c">#Cys = cy.Cycles(LC, self.Gs)</span>
        <span class="c">#Cys = cycl.Cycles(LC)</span>
        <span class="c">#self.Gt = cys.Gt</span>
        <span class="c">#pdb.set_trace()</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="c">#nk = np.array(self.Gt.node[k][&#39;vnodes&#39;])</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
                <span class="c">#nl = np.array(self.Gt.node[l][&#39;vnodes&#39;])</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
                <span class="n">nkinl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span><span class="n">nl</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nkinl</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
        <span class="n">Ncycles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

        <span class="c">#</span>
        <span class="c">#  Update graph Gs with cycle information</span>
        <span class="c">#</span>

        <span class="c">#  initialize a void list &#39;ncycles&#39; for each segment of Gs</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ncycles</span><span class="p">):</span>
            <span class="c">#vnodes = np.array(self.Gt.node[k][&#39;vnodes&#39;])</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                            <span class="k">print</span> <span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;A segment cannot relate more than 2 cycles&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#  Seek for Cycle inter connectivity</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">Ncycles</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
            <span class="c">#vnodes0 = np.array(self.Gt.node[k[0]][&#39;vnodes&#39;])</span>
            <span class="c">#vnodes1 = np.array(self.Gt.node[k[1]][&#39;vnodes&#39;])</span>
            <span class="n">vnodes0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="n">vnodes1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># Connect Cycles if they share nodes (segment ? )</span>
            <span class="c">#</span>
            <span class="n">intersection_vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">vnodes0</span><span class="p">,</span> <span class="n">vnodes1</span><span class="p">)</span>

            <span class="c">#if len(intersection_vnodes) != 0:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersection_vnodes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c">#print intersection_vnodes,len(intersection_vnodes)</span>
                <span class="c">#print k[0],k[1]</span>
                <span class="n">segment</span> <span class="o">=</span> <span class="n">intersection_vnodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">intersection_vnodes</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">segment</span><span class="o">=</span> <span class="n">segment</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># Construct the polygon associated to each cycle</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="c">#vnodes = self.Gt.node[k][&#39;vnodes&#39;]</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="n">u_neg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">vnodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">npoints</span> <span class="o">=</span> <span class="n">vnodes</span><span class="p">[</span><span class="n">u_neg</span><span class="p">]</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c">#</span>
            <span class="c"># Loop over points</span>
            <span class="c">#</span>
            <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">npoints</span><span class="p">:</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
            <span class="n">polk</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coords</span><span class="p">)),</span> <span class="n">vnodes</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">polyg</span><span class="o">=</span><span class="n">polk</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Construct the list of interactions associated to each cycle</span>
        <span class="c">#</span>
        <span class="c"># Interaction labeling convention</span>
        <span class="c">#</span>
        <span class="c">#   negative integer : Diffraction on point |ni|</span>
        <span class="c">#   positive integer : Transmission through segment ni</span>
        <span class="c">#   tuple (nseg,ncycle) : Reflection on nseg toward cycle ncycle</span>
        <span class="c">#         (nseg,cy0,cy1) : Transmission from cy0 to cy1 through nseg</span>
        <span class="c">#</span>
        <span class="c">#   At that stage the diffraction points are not included</span>
        <span class="c">#   not enough information available</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="c">#vnodes = self.Gt.node[k][&#39;vnodes&#39;]</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="n">ListInteractions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">inode</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>   <span class="c"># segments</span>
                    <span class="n">cy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">inode</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>  <span class="c"># segment name</span>
                    <span class="c">#</span>
                    <span class="c"># Reflexion occurs on segment different</span>
                    <span class="c"># from AIR and ABSORBENT  (segment number, cycle)</span>
                    <span class="c">#</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">):</span>
                        <span class="n">ListInteractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">inode</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
                    <span class="c">#</span>
                    <span class="c"># Transmission needs 2 cycles</span>
                    <span class="c"># segemnt different from METAL and ABSORBENT</span>
                    <span class="c">#</span>
                    <span class="c"># (segment number, cycle in , cycle out )</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;METAL&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">):</span>
                            <span class="n">ncy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">k</span><span class="p">}))[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">ListInteractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">inode</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">ncy</span><span class="p">)))</span>
                            <span class="n">ListInteractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">inode</span><span class="p">,</span> <span class="n">ncy</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">inter</span><span class="o">=</span><span class="n">ListInteractions</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.buildGw"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGw.html#pylayers.gis.layout.Layout.buildGw">[docs]</a>    <span class="k">def</span> <span class="nf">buildGw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build Graph of waypaths</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        buildGr</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        for all edges of Gr (adjascent room)</span>
<span class="sd">            if room1 and room2 have a common transition</span>
<span class="sd">           </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">d_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span> <span class="c"># for numerotation of Gw nodes</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">edges_iter</span><span class="p">():</span> <span class="c"># iterator on Gr edges</span>
            <span class="n">trans1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>  <span class="c"># transitions of room e[0]</span>
            <span class="n">trans2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>  <span class="c"># transitions of room e[1]</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">trans1</span><span class="p">,</span><span class="n">trans2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># list of common doors</span>

            <span class="n">unode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span> <span class="c"># get edge number of common doors</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">pdoor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c"># middle of the common door</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">Id</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">)</span>     <span class="c"># new node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">Id</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">pdoor</span>  <span class="c"># in the middle of the door|airwall</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">([(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Id</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">),</span>
                                    <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Id</span> <span class="o">+</span> <span class="n">d_id</span><span class="p">)])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes_iter</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>   <span class="c"># neighbors of room n in Gw</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c">#    def buildGv(self, show=False):</span>
<span class="c">#        &quot;&quot;&quot; build global visibility graph</span>

<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        display : boolean</span>
<span class="c">#            default False</span>

<span class="c">#        Examples</span>
<span class="c">#        --------</span>

<span class="c">#        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="c">#        &gt;&gt;&gt; L = Layout()</span>
<span class="c">#        &gt;&gt;&gt; load(&#39;example.str&#39;)</span>
<span class="c">#        &gt;&gt;&gt; buildGt()</span>
<span class="c">#        &gt;&gt;&gt; buildGr()</span>
<span class="c">#        &gt;&gt;&gt; buildGv()</span>

<span class="c">#        &quot;&quot;&quot;</span>

<span class="c">#        self.Gv = nx.Graph()</span>
<span class="c">#        #</span>
<span class="c">#        # loop over rooms</span>
<span class="c">#        #</span>
<span class="c">#        self.dGv = {}  # dict of Gv graph</span>
<span class="c">#        for nr in self.Gr.node:</span>
<span class="c">#            udeg2 = []</span>
<span class="c">#            udeg1 = []</span>
<span class="c">#            icycle = self.Gr.node[nr][&#39;cycle&#39;]  # id of cycle</span>
<span class="c">#            room = self.Gt.node[icycle]      # cycle of the room</span>
<span class="c">#            polyg = room[&#39;polyg&#39;]             # pol</span>
<span class="c">#            vnodes = room[&#39;vnodes&#39;]</span>
<span class="c">#            #</span>
<span class="c">#            # seek node of degree 2</span>
<span class="c">#            #</span>
<span class="c">#            # udeg2 is the index of the deg 2 point in the sequence of points</span>
<span class="c">#            for ik, inode in enumerate(vnodes):</span>
<span class="c">#                deg = self.Gs.degree(inode)</span>
<span class="c">#                if vnodes[0] &lt; 0:</span>
<span class="c">#                    index = ik / 2</span>
<span class="c">#                else:</span>
<span class="c">#                    index = (ik - 1) / 2</span>
<span class="c">#                if inode &lt; 0:</span>
<span class="c">#                    if deg == 2:</span>
<span class="c">#                        udeg2.append(index)</span>
<span class="c">#                    if deg == 1:</span>
<span class="c">#                        udeg1.append(index)    # warning not used</span>
<span class="c">#            Gv = polyg.buildGv(show=show, udeg2=udeg2)</span>
<span class="c">#            #</span>
<span class="c">#            # Graph Gv aggregation</span>
<span class="c">#            #</span>
<span class="c">#            self.Gv  = nx.compose(self.Gv, Gv)</span>
<span class="c">#            self.dGv[nr] = Gv</span>
</div>
<div class="viewcode-block" id="Layout.buildGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGv.html#pylayers.gis.layout.Layout.buildGv">[docs]</a>    <span class="k">def</span> <span class="nf">buildGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build global visibility graph</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        show : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;example.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.buildGt()</span>
<span class="sd">        &gt;&gt;&gt; Ga = L.buildGr()</span>
<span class="sd">        &gt;&gt;&gt; L.buildGv()</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># loop over cycles</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dGv</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># dict of Gv graph</span>
        <span class="k">for</span> <span class="n">icycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="c">#print icycle</span>
            <span class="n">udeg2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">udeg1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">icycle</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>  <span class="c"># a cycle  from Gt</span>
            <span class="n">polyg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">icycle</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>  <span class="c"># a shapely polygon</span>
            <span class="n">vnodes</span> <span class="o">=</span> <span class="n">cycle</span><span class="o">.</span><span class="n">cycle</span>
            <span class="c">#</span>
            <span class="c"># seek node of degree 2</span>
            <span class="c">#</span>
            <span class="c"># udeg2 is the index of the deg 2 point in the sequence of points</span>

            <span class="c"># for ik, inode in enumerate(vnodes):</span>
            <span class="c">#     deg = self.Gs.degree(inode)</span>
            <span class="c">#     if vnodes[0] &lt; 0:</span>
            <span class="c">#         index = ik / 2</span>
            <span class="c">#     else:</span>
            <span class="c">#         index = (ik - 1) / 2</span>
            <span class="c">#     if inode &lt; 0:</span>
            <span class="c">#         if deg == 2:</span>
            <span class="c">#             udeg2.append(index)</span>
            <span class="c">#         if deg == 1:</span>
            <span class="c">#             udeg1.append(index)    # warning not used</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>  <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">vnodes</span><span class="p">)</span>
            <span class="n">udeg2</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pts</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="c"># awpts = self.</span>



            <span class="c"># udeg1 = self.degree[1]</span>
            <span class="c"># udeg2 = self.degree[2]       </span>
            <span class="c">#print udeg2   </span>
            <span class="n">Gv</span> <span class="o">=</span> <span class="n">polyg</span><span class="o">.</span><span class="n">buildGv</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span><span class="n">udeg1</span><span class="o">=</span><span class="n">udeg1</span><span class="p">,</span><span class="n">udeg2</span><span class="o">=</span><span class="n">udeg2</span><span class="p">)</span>
            <span class="c">#if icycle == 78:</span>
            <span class="c">#    pdb.set_trace()</span>
            <span class="c">#</span>
            <span class="c"># Graph Gv aggregation</span>
            <span class="c">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span>  <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dGv</span><span class="p">[</span><span class="n">icycle</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gv</span>
</div>
<div class="viewcode-block" id="Layout.buildGi2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGi2.html#pylayers.gis.layout.Layout.buildGi2">[docs]</a>    <span class="k">def</span> <span class="nf">buildGi2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build dictionnary of graph of interactions</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        For each node &gt; 0 of graph Gs creates</span>
<span class="sd">            4 different nodes associated to the same segment</span>
<span class="sd">            R+  R- T+ T-</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#</span>
        <span class="c"># Create nodes</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGv</span><span class="p">:</span>              <span class="c"># for each cycle ( keys of dGv )</span>
            <span class="n">Gv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGv</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>  <span class="c"># create a Digraph dGi[k]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>        <span class="c"># and its associated node coordinates</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Gv</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>           <span class="c"># for each node of Gv (same node as Gs)</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># D</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># R | T</span>
                    <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># 2 cycles</span>

                        <span class="n">cy0</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">cy1</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="c"># get neighbors</span>
                        <span class="n">nei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                        <span class="n">np1</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">np2</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">])</span>
                        <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">])</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
                        <span class="n">nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                        <span class="n">ln</span> <span class="o">=</span> <span class="n">l</span> <span class="o">/</span> <span class="n">nl</span>
                        <span class="n">delta</span> <span class="o">=</span> <span class="n">nl</span> <span class="o">/</span> <span class="mi">10</span>

                        <span class="c"># with  AIR or ABSORBENT there is no reflection</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="p">)</span> <span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">k</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="n">cy0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="n">cy1</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>


                        <span class="c"># with METAL or ABSORBENT there is no transmission</span>
                        <span class="k">if</span> <span class="p">((</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;METAL&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy0</span><span class="p">,</span><span class="n">cy1</span><span class="p">)))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy1</span><span class="p">,</span><span class="n">cy0</span><span class="p">)))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+</span><span class="n">ln</span><span class="o">*</span><span class="n">delta</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">,</span> <span class="n">cy0</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">ln</span><span class="o">*</span><span class="n">delta</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># segment which is not a separation between rooms</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

            <span class="c">#</span>
            <span class="c"># Loop over interactions list</span>
            <span class="c">#</span>
            <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c"># reflection ou transmission</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c"># reflection tuple (,2)</span>
                        <span class="n">ns</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># segment</span>
                        <span class="n">nc</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># cycle</span>
                        <span class="c">#vnodes = self.Gt.node[nc][&#39;vnodes&#39;]</span>
                        <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                        <span class="n">neigh</span> <span class="o">=</span> <span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                        <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>           <span class="c"># Si Voisin dans cycle reflexion</span>
                                <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>             <span class="c"># segment</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">nc</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                     <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="c"># retrieve the cycles of the segment</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># R-T</span>
                                        <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                        <span class="n">nc1</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">nc</span><span class="p">}))[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span><span class="n">nc</span><span class="p">,</span><span class="n">nc1</span><span class="p">))</span>
                                        <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                          <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
        <span class="c">#                                else:</span>
        <span class="c">#                                    print node1, node2</span>
                                            <span class="c">#pdb_set_trace()</span>
                                <span class="k">else</span><span class="p">:</span>                   <span class="c"># R-D</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                     <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
        <span class="c">#                            else:</span>
        <span class="c">#                                print node1, node2</span>
                                        <span class="c">#pdb_set_trace()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="c">#transmission</span>
                        <span class="n">ns</span>  <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># segment</span>
                        <span class="n">cy0</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">cy1</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        <span class="c">#vnodes0 = self.Gt.node[cy0][&#39;vnodes&#39;]</span>
                        <span class="c">#vnodes1 = self.Gt.node[cy1][&#39;vnodes&#39;]</span>
                        <span class="n">vnodes0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy0</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                        <span class="n">vnodes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy1</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                        <span class="n">neigh</span> <span class="o">=</span> <span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                        <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes1</span><span class="p">:</span>    <span class="c"># If neighbors in cycle 1</span>
                                <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                     <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># R-T</span>
                                        <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                        <span class="n">nc1</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">cy1</span><span class="p">}))[</span><span class="mi">0</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="n">nc1</span><span class="o">&lt;&gt;</span> <span class="n">cy0</span><span class="p">:</span>
                                            <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span><span class="n">cy1</span><span class="p">,</span><span class="n">nc1</span><span class="p">))</span>
                                            <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                             <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                     <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">dGi</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span></div>
<div class="viewcode-block" id="Layout.buildGi"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGi.html#pylayers.gis.layout.Layout.buildGi">[docs]</a>    <span class="k">def</span> <span class="nf">buildGi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build graph of interactions</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        For each node &gt; of graph Gs creates</span>
<span class="sd">            4 different nodes associated to the same segment</span>
<span class="sd">            R+  R- T+ T-</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#</span>
        <span class="c"># Create nodes</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># D</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># R | T</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="c"># 2 cycles</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>

                    <span class="n">cy0</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cy1</span> <span class="o">=</span> <span class="n">cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">nei</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c"># get neigbor</span>
                    <span class="n">np1</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">np2</span> <span class="o">=</span> <span class="n">nei</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">])</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">])</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span>
                    <span class="n">nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
                    <span class="n">ln</span> <span class="o">=</span> <span class="n">l</span> <span class="o">/</span> <span class="n">nl</span>

                    <span class="n">delta</span> <span class="o">=</span> <span class="n">nl</span> <span class="o">/</span> <span class="mi">10</span>
                    <span class="c"># On AIR or ABSORBENT there is no reflection</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy0</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy1</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">ln</span> <span class="o">*</span> <span class="n">delta</span><span class="p">)</span>

                    <span class="c"># Through METAL or ABSORBENT there is no transmission</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;METAL&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy0</span><span class="p">,</span><span class="n">cy1</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">cy1</span><span class="p">,</span><span class="n">cy0</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy0</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">+</span><span class="n">ln</span><span class="o">*</span><span class="n">delta</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy1</span><span class="p">,</span> <span class="n">cy0</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">-</span><span class="n">ln</span><span class="o">*</span><span class="n">delta</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># segment which is not a separation between rooms</span>
                    <span class="c"># On AIR or ABSORBENT there is no reflection</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">name</span><span class="o">&lt;&gt;</span><span class="s">&#39;ABSORBENT&#39;</span><span class="p">)</span>  <span class="ow">or</span> <span class="p">(</span><span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lsss</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="nb">str</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">cy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

        <span class="c">#</span>
        <span class="c"># Loop over interactions list</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c"># reflection ou transmission</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c"># reflection tuple (,2)</span>
                    <span class="n">ns</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># segment</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c"># cycle</span>
                    <span class="c">#vnodes = self.Gt.node[nc][&#39;vnodes&#39;]</span>
                    <span class="n">vnodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nc</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                    <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                    <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes</span><span class="p">:</span>           <span class="c"># Si Voisin dans cycle reflexion</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>             <span class="c"># segment</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">nc</span><span class="p">))</span>
                                <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                 <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="c"># retrieve the cycles of the segment</span>
                                <span class="n">cy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># R-T</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">nc1</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">nc</span><span class="p">}))[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span><span class="n">nc</span><span class="p">,</span><span class="n">nc1</span><span class="p">))</span>
                                    <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                      <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
    <span class="c">#                                else:</span>
    <span class="c">#                                    print node1, node2</span>
                                        <span class="c">#pdb_set_trace()</span>
                            <span class="k">else</span><span class="p">:</span>                 <span class="c"># D diffraction</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c"># </span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span> <span class="c">#</span>
                                <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                 <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">node1</span><span class="p">)</span>
                                    <span class="c"># diffraction is a reciprocal interaction</span>
    <span class="c">#                            else:</span>
    <span class="c">#                                print node1, node2</span>
                                    <span class="c">#pdb_set_trace()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="c">#transmission</span>
                    <span class="n">ns</span>  <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># segment</span>
                    <span class="n">cy0</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">cy1</span> <span class="o">=</span> <span class="n">n</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="c">#vnodes0 = self.Gt.node[cy0][&#39;vnodes&#39;]</span>
                    <span class="c">#vnodes1 = self.Gt.node[cy1][&#39;vnodes&#39;]</span>
                    <span class="n">vnodes0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy0</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                    <span class="n">vnodes1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy1</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                    <span class="n">neigh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>  <span class="c"># find neighbors</span>
                    <span class="k">for</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">vnodes1</span><span class="p">:</span>    <span class="c"># If neighbors in cycle 1</span>
                            <span class="k">if</span> <span class="n">nb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span> <span class="n">cy1</span><span class="p">))</span>
                                <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                 <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                                <span class="n">cy</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nb</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c"># R-T</span>
                                    <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                    <span class="n">nc1</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cy</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="n">cy1</span><span class="p">}))[</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">nc1</span><span class="o">&lt;&gt;</span> <span class="n">cy0</span><span class="p">:</span>
                                        <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">((</span><span class="n">nb</span><span class="p">,</span><span class="n">cy1</span><span class="p">,</span><span class="n">nc1</span><span class="p">))</span>
                                        <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                         <span class="o">&amp;</span> <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">node1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                                <span class="n">node2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
                                <span class="k">if</span> <span class="p">((</span><span class="n">node1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                                 <span class="o">&amp;</span>  <span class="p">(</span><span class="n">node2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
<span class="c">#                                else:</span>
<span class="c">#                                    print node1, node2</span>
                                    <span class="c">#pdb.set_trace()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">=</span><span class="p">{}</span> <span class="c"># dictionnary which link nodes of Gi to node of Gs and interaction type</span>
                <span class="c"># string 2 list</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:[</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]})</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">((</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="nb">int</span><span class="p">)]</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:[</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">3</span><span class="p">]})</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">((</span><span class="nb">eval</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="nb">int</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="Layout.outputGi"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.outputGi.html#pylayers.gis.layout.Layout.outputGi">[docs]</a>    <span class="k">def</span> <span class="nf">outputGi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; filter authorized Gi edges output</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        L : Layout</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Let assume a sequence (nstr0,nstr1,{nstr2A,nstr2B,...}) in a signature.</span>
<span class="sd">        This function checks that this sequence is feasible</span>
<span class="sd">        , whatever the type of nstr0 and nstr1.</span>
<span class="sd">        The feasible outputs from nstr0 to nstr1 are stored in an output field of</span>
<span class="sd">        edge (nstr0,nstr1)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span><span class="p">(</span><span class="s">&#39;Gi&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
        <span class="c"># loop over all edges of Gi</span>
        <span class="n">Nedges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edges</span><span class="p">())</span>
        <span class="c">#print &quot;Gi Nedges :&quot;,Nedges</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edges</span><span class="p">()):</span>
            <span class="c">#if (k%100)==0:</span>
            <span class="c">#    print &quot;edge :  &quot;,k</span>
            <span class="c"># extract  both termination interactions nodes</span>
            <span class="n">i0</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


            <span class="k">try</span><span class="p">:</span>
                <span class="n">nstr0</span> <span class="o">=</span> <span class="n">i0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">nstr0</span> <span class="o">=</span> <span class="n">i0</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">nstr1</span> <span class="o">=</span> <span class="n">i1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c"># Transmission</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">typ</span><span class="o">=</span><span class="mi">2</span>
                <span class="c"># Reflexion   </span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">typ</span><span class="o">=</span><span class="mi">1</span>
            <span class="c"># Diffraction       </span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">nstr1</span> <span class="o">=</span> <span class="n">i1</span>
                <span class="n">typ</span> <span class="o">=</span> <span class="mi">3</span>

            <span class="c"># list of authorized outputs, initialized void</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># nstr1 : segment number of middle interaction</span>
            <span class="k">if</span> <span class="n">nstr1</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pseg1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg2pts</span><span class="p">(</span><span class="n">nstr1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="c"># create a Cone object</span>
                <span class="n">cn</span> <span class="o">=</span> <span class="n">cone</span><span class="o">.</span><span class="n">Cone</span><span class="p">()</span>
                <span class="c"># if starting from segment</span>
                <span class="k">if</span> <span class="n">nstr0</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">pseg0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg2pts</span><span class="p">(</span><span class="n">nstr0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="c"># if nstr0 and nstr1 are connected segments</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">nstr0</span><span class="p">),</span><span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">nstr1</span><span class="p">)))</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                        <span class="c"># from 2 not connected segment</span>
                        <span class="n">cn</span><span class="o">.</span><span class="n">from2segs</span><span class="p">(</span><span class="n">pseg0</span><span class="p">,</span><span class="n">pseg1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c"># from 2 connected segments</span>
                        <span class="n">cn</span><span class="o">.</span><span class="n">from2csegs</span><span class="p">(</span><span class="n">pseg0</span><span class="p">,</span><span class="n">pseg1</span><span class="p">)</span>
                <span class="c"># if starting from point </span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nstr0</span><span class="p">])</span>
                    <span class="n">cn</span><span class="o">.</span><span class="n">fromptseg</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="n">pseg1</span><span class="p">)</span>
           
                <span class="c"># list all potential successors of interaction i1</span>
                <span class="n">i2</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">i1</span><span class="p">))</span>
                <span class="n">ipoints</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">,</span><span class="n">i2</span><span class="p">)</span>
                <span class="c"># filter tuple (R | T)</span>
                <span class="n">istup</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">==</span><span class="nb">tuple</span><span class="p">,</span><span class="n">i2</span><span class="p">)</span>
                <span class="c"># map first argument segment number </span>
                <span class="n">isegments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">istup</span><span class="p">))</span>

                <span class="c">#if ((i0==(32, 75)) and (i1==(170, 75, 74))):</span>
                <span class="c">#    pdb.set_trace()</span>
                <span class="c"># there are one or more segments</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">isegments</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seg2pts</span><span class="p">(</span><span class="n">isegments</span><span class="p">)</span>
                    <span class="n">pta</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,:]</span>
                    <span class="n">phe</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">:,:]</span>
                    <span class="c">#print points</span>
                    <span class="c">#print segments</span>
                    <span class="c">#cn.show()</span>
                    <span class="c"># i1 : interaction T</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                        <span class="n">typ</span><span class="p">,</span><span class="n">prob</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">belong_seg</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">phe</span><span class="p">)</span>
                        <span class="c">#if bs.any():</span>
                        <span class="c">#    plu.displot(pta[:,bs],phe[:,bs],color=&#39;g&#39;)</span>
                        <span class="c">#if ~bs.any():</span>
                        <span class="c">#    plu.displot(pta[:,~bs],phe[:,~bs],color=&#39;k&#39;)</span>
                    <span class="c"># i1 : interaction R --&gt; mirror</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>   
                        <span class="n">Mpta</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">mirror</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">pseg1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pseg1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">Mphe</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">mirror</span><span class="p">(</span><span class="n">phe</span><span class="p">,</span><span class="n">pseg1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">pseg1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">typ</span><span class="p">,</span><span class="n">prob</span> <span class="o">=</span> <span class="n">cn</span><span class="o">.</span><span class="n">belong_seg</span><span class="p">(</span><span class="n">Mpta</span><span class="p">,</span><span class="n">Mphe</span><span class="p">)</span>
                        <span class="c">#print i0,i1</span>
                        <span class="c">#if ((i0 == (6, 0)) &amp; (i1 == (7, 0))):</span>
                        <span class="c">#    pdb.set_trace()</span>
                        <span class="c">#if bs.any():</span>
                        <span class="c">#    plu.displot(pta[:,bs],phe[:,bs],color=&#39;g&#39;)</span>
                        <span class="c">#if ~bs.any():</span>
                        <span class="c">#    plu.displot(pta[:,~bs],phe[:,~bs],color=&#39;m&#39;)</span>
                        <span class="c">#    plt.show()</span>
                        <span class="c">#    pdb.set_trace()</span>
                    <span class="n">isegkeep</span> <span class="o">=</span> <span class="n">isegments</span><span class="p">[</span><span class="n">prob</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>    
                    <span class="c"># dict num segment : proba</span>
                    <span class="n">dsegprob</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">isegkeep</span><span class="p">,</span><span class="n">prob</span><span class="p">[</span><span class="n">prob</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">])}</span>
                    <span class="n">output</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">isegkeep</span> <span class="p">,</span><span class="n">istup</span><span class="p">)</span>
                    <span class="n">probint</span>  <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">dsegprob</span><span class="p">[</span><span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]],</span><span class="n">output</span><span class="p">)</span>
                    <span class="c"># dict interaction : proba</span>
                    <span class="n">dintprob</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">probint</span><span class="p">)}</span>


                    <span class="c"># keep all segment above nstr1 and in Cone if T</span>
                    <span class="c"># keep all segment below nstr1 and in Cone if R</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i0</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">i1</span><span class="p">),</span><span class="n">output</span><span class="o">=</span><span class="n">dintprob</span><span class="p">)</span>


       

<span class="c">#    def showGraph(self,**kwargs):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>
<span class="c">#        print n,nb</span>
<span class="c">#        show : boolean</span>
<span class="c">#        fig</span>
<span class="c">#        nodes</span>
<span class="c">#        eded</span>
<span class="c">#        ndnd</span>
<span class="c">#        nded</span>
<span class="c">#        linewidth</span>
<span class="c">#        roomlis</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        defaults={&#39;show&#39;:False,</span>
<span class="c">#                  &#39;fig&#39;:[],</span>
<span class="c">#                  &#39;ax&#39;:[],</span>
<span class="c">#                  &#39;nodes&#39;:False,</span>
<span class="c">#                  &#39;eded&#39;:True,</span>
<span class="c">#                  &#39;ndnd&#39;:True,</span>
<span class="c">#                  &#39;nded&#39;:True,</span>
<span class="c">#                  &#39;linewidth&#39;:2,</span>
<span class="c">#                  &#39;nodelist&#39;:[]</span>
<span class="c">#                  }</span>
<span class="c">#        for key, value in defaults.items():</span>
<span class="c">#            if kwargs.has_key(key):</span>
<span class="c">#                setattr(self, key, kwargs[key])</span>
<span class="c">#            else:</span>
<span class="c">#                setattr(self, key, value)</span>
<span class="c">#                kwargs[key]=value</span>
<span class="c">#        if kwargs[&#39;fig&#39;]==[]:</span>
<span class="c">#            fig = plt.figure()</span>
<span class="c">#            fig.set_frameon(True)</span>
<span class="c">#        else:</span>
<span class="c">#            fig = kwargs[&#39;fig&#39;]</span>
<span class="c">#        if kwargs[&#39;ax&#39;]==[]:</span>
<span class="c">#            ax = fig.gca()</span>
<span class="c">#        else:</span>
<span class="c">#            ax = kwargs[&#39;ax&#39;]</span>
<span class="c">#</span>
<span class="c">#        if graph==&#39;t&#39;:</span>
<span class="c">#            G = self.Gt</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;r&#39;:</span>
<span class="c">#            G = self.Gr</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;s&#39;:</span>
<span class="c">#            G = self.Gs</span>
<span class="c">#            nx.draw(G,G.pos)</span>
<span class="c">#        if graph==&#39;v&#39;:</span>
<span class="c">#            G = self.Gv</span>
<span class="c">#            nx.draw(G,self.Gs.pos)</span>
<span class="c">#</span>
<span class="c">#        for k,ncy in enumerate(self.Gt.node.keys()):</span>
<span class="c">#            self.Gt.node[ncy][&#39;polyg&#39;].plot()</span>
<span class="c">#        ax.axis(&#39;scaled&#39;)</span>
<span class="c">#        # Display doors and windows</span>
<span class="c">#        d = self.subseg()</span>
<span class="c">#        for ss in d.keys():</span>
<span class="c">#            if ss==&#39;DOOR&#39;:</span>
<span class="c">#                color=&#39;red&#39;</span>
<span class="c">#            if ss==&#39;3D_WINDOW_GLASS&#39;:</span>
<span class="c">#                color=&#39;blue&#39;</span>
<span class="c">#            if ss==&#39;WINDOW_GLASS&#39;:</span>
<span class="c">#                color=&#39;cyan&#39;</span>
<span class="c">#            for ns in d[ss]:</span>
<span class="c">#                np1,np2 = self.Gs.neighbors(ns)</span>
<span class="c">#                x  = [self.Gs.pos[np1][0],self.Gs.pos[np2][0]]</span>
<span class="c">#                y  = [self.Gs.pos[np1][1],self.Gs.pos[np2][1]]</span>
<span class="c">#                ax.plot(x,y,linewidth=2,color=color)</span>
<span class="c">#        if kwargs[&#39;show&#39;]:</span>
<span class="c">#            plt.show()</span>
   </div>
<div class="viewcode-block" id="Layout.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show.html#pylayers.gis.layout.Layout.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;labels&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;alphan&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s">&#39;alphae&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;node_color&#39;</span><span class="p">:</span><span class="s">&#39;w&#39;</span><span class="p">,</span>
                    <span class="s">&#39;edge_color&#39;</span><span class="p">:</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                    <span class="s">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                    <span class="s">&#39;font_size&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;nodelist&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;cycle&#39;</span><span class="p">,</span>
                    <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">segfilt</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="s">&#39;AIR&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsg</span><span class="p">)</span> 
        <span class="c"># get the association between segment and nx edges</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
        <span class="n">Ne</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edges</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dse</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">))}</span>

        <span class="c">#pdb.set_trace()</span>

        <span class="n">edfilt</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">[</span><span class="n">dse</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dse</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span><span class="n">segfilt</span><span class="p">))))</span>   
        <span class="c"># Warning edgelist is to be understood as edge of graph and not segments of layout</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">edfilt</span><span class="p">)</span>

        <span class="n">ldeg1</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ldeg4</span>  <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">degree</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">ldeg1</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">ldeg4</span><span class="p">,</span><span class="n">edges</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nodes</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="c">#     if k==1:</span>
        <span class="c">#         fig,ax = self.showG(&#39;s&#39;,fig=fig,ax=ax,nodelist=ldeg,edges=False,nodes=True,node_size=50,node_color=&#39;c&#39;)</span>
        <span class="c">#     if k==4:</span>
        <span class="c">#         fig,ax = self.showG(&#39;s&#39;,fig=fig,ax=ax,nodelist=ldeg,nodes=False,node_size=50,node_color=&#39;b&#39;)      </span>
</div>
<div class="viewcode-block" id="Layout.showG"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showG.html#pylayers.gis.layout.Layout.showG">[docs]</a>    <span class="k">def</span> <span class="nf">showG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show graphs</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        graph : char</span>
<span class="sd">            &#39;t&#39; : Gt &#39;r&#39; : Gr &#39;s&#39; : Gs &#39;v&#39; : Gv  &#39;c&#39;: Gc &#39;i&#39; : Gi</span>
<span class="sd">        show : boolean</span>
<span class="sd">            False</span>
<span class="sd">        fig : matplotlib figure</span>
<span class="sd">            []</span>
<span class="sd">        ax : matplotlib figure</span>
<span class="sd">            []</span>
<span class="sd">        nodes : boolean</span>
<span class="sd">            False</span>
<span class="sd">        eded : boolean</span>
<span class="sd">            True</span>
<span class="sd">        ndnd : boolean</span>
<span class="sd">            True</span>
<span class="sd">        nded : boolean</span>
<span class="sd">            True</span>
<span class="sd">        linewidth : int</span>
<span class="sd">            2</span>
<span class="sd">        nodelist : list</span>
<span class="sd">            []</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import  *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;TA-Office.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.dumpr()</span>
<span class="sd">            &gt;&gt;&gt; fig = plt.figure(figsize=(10,10))</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.add_subplot(221)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showG(&#39;s&#39;,fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; tis = plt.title(&quot;Gs&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.add_subplot(222)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showG(&#39;t&#39;,fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; tit = plt.title(&quot;Gt&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.add_subplot(223)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showG(&#39;r&#39;,fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; tic = plt.title(&quot;Gr&quot;)</span>
<span class="sd">            &gt;&gt;&gt; ax = fig.add_subplot(224)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showG(&#39;v&#39;,fig=fig,ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; tiv = plt.title(&quot;Gv&quot;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;labels&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;alphan&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s">&#39;alphae&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s">&#39;node_color&#39;</span><span class="p">:</span><span class="s">&#39;w&#39;</span><span class="p">,</span>
                    <span class="s">&#39;edge_color&#39;</span><span class="p">:</span><span class="s">&#39;k&#39;</span><span class="p">,</span>
                    <span class="s">&#39;node_size&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                    <span class="s">&#39;font_size&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span>
                    <span class="s">&#39;nodelist&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;edgelist&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;cycle&#39;</span><span class="p">,</span>
                    <span class="s">&#39;alphacy&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="s">&#39;colorcy&#39;</span><span class="p">:</span><span class="s">&#39;#abcdef&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c"># overriding first argument graph        </span>
        <span class="k">if</span> <span class="s">&#39;graph&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;graph&#39;</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># t : graph of cycles</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;r&#39;</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># r : graph of rooms</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>
            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;room&#39;</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;g&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># s : structure graph</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>

            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;g&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># v : visibility graph</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>

            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gv</span>
            <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">G</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;m&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># c : connectivity graph (Friedman) deprecated</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>

            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gc</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;k&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># i :  interaction graph</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;i&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>

            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;k&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
        <span class="c">#</span>
        <span class="c"># w :  waypoint graph</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="s">&#39;w&#39;</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">:</span>

            <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gw</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edge_color&#39;</span><span class="p">]</span> <span class="o">=</span><span class="s">&#39;k&#39;</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fig&#39;</span><span class="p">:</span><span class="n">fig</span><span class="p">,</span><span class="s">&#39;ax&#39;</span><span class="p">:</span><span class="n">ax</span><span class="p">,</span><span class="s">&#39;show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edgelist&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;mode&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;cycle&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;alphacy&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colorcy&#39;</span><span class="p">],</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">args</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
                    <span class="n">args</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">nro</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nro</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
                    <span class="n">args</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
                    <span class="n">args</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ax</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># Display doors and windows subsegments with a slight offset</span>
        <span class="c">#</span>
        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">ss</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">ss</span><span class="p">]:</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;norm&#39;</span><span class="p">]</span>
                <span class="n">np1</span><span class="p">,</span> <span class="n">np2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">ns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">np2</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">xoff</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.05</span><span class="o">*</span><span class="n">norm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">yoff</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">ns</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.05</span><span class="o">*</span><span class="n">norm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">xoff</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">yoff</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

       
                 
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Layout.showGv"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showGv.html#pylayers.gis.layout.Layout.showGv">[docs]</a>    <span class="k">def</span> <span class="nf">showGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show graph Gv (visibility)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display</span>
<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        nodes    : boolean</span>
<span class="sd">            display nodes</span>
<span class="sd">        edges    : boolean</span>
<span class="sd">            display edges</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig : figure instance</span>
<span class="sd">        ax  : axes instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">           :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;example.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.build()</span>
<span class="sd">            &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L.showGs(fig=fig)</span>
<span class="sd">            &gt;&gt;&gt; ax = L.showGv(ax=ax)</span>
<span class="sd">            &gt;&gt;&gt; ti = plt.title(&#39;Show Gv&#39;)</span>
<span class="sd">            &gt;&gt;&gt; t = plt.axis(&#39;off&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;eded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;ndnd&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;nded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">uneg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">upos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">upos</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">uneg</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">ndnd</span><span class="p">,</span> <span class="n">nded</span><span class="p">,</span> <span class="n">eded</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">edgetype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;eded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">eded</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ndnd&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">ndnd</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gv</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                   <span class="n">edgelist</span><span class="o">=</span><span class="n">nded</span><span class="p">,</span> <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ax</span>
</div>
<div class="viewcode-block" id="Layout.waypointGw"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.waypointGw.html#pylayers.gis.layout.Layout.waypointGw">[docs]</a>    <span class="k">def</span> <span class="nf">waypointGw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the waypoint between room1 and room2</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">            nroom1</span>
<span class="sd">            nroom2</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout(&#39;WHERE1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; L.dumpr()</span>
<span class="sd">            &gt;&gt;&gt; nroom1 = 1</span>
<span class="sd">            &gt;&gt;&gt; nroom2 = 6</span>
<span class="sd">            &gt;&gt;&gt; l = L.waypointGw(nroom1,nroom2)</span>
<span class="sd">            &gt;&gt;&gt; len(l)</span>
<span class="sd">            4</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rooms</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">)</span>
        <span class="k">return</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gw</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rooms</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.thwall"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.thwall.html#pylayers.gis.layout.Layout.thwall">[docs]</a>    <span class="k">def</span> <span class="nf">thwall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create a list of wall tuples (Transit.world format )</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        offx</span>
<span class="sd">        offy</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        walls : list of wall tuples  (Transit format)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;DLR.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; walls = L.thwall(0,0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keyn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">walls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nd</span> <span class="ow">in</span> <span class="n">keyn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span>
                <span class="n">pta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nb</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">phe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nb</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;norm&#39;</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">transition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nd</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">thick</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="s">&#39;lthick&#39;</span><span class="p">])</span>

                <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phe</span><span class="p">)</span> <span class="o">-</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">p4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span> <span class="o">-</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">thick</span> <span class="o">/</span> <span class="mf">2.</span>  <span class="o">+</span> \
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">offx</span><span class="p">,</span> <span class="n">offy</span><span class="p">])</span>

                <span class="n">wall</span> <span class="o">=</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p3</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">p4</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">transition</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s">&#39;AIR&#39;</span><span class="p">:</span>
                    <span class="n">walls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wall</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">walls</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">ptin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if a point is in the Layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        pt : point (ndarray)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        boolean : True if inside</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pt</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">x</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[:</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">y</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>

        <span class="c"># being   in [xmin xmax]</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>  <span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># being   in [ymin ymax]</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>  <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="k">return</span> <span class="p">(</span><span class="n">c0</span> <span class="o">&amp;</span> <span class="n">c1</span><span class="p">)</span>

<div class="viewcode-block" id="Layout.pt2cy"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.pt2cy.html#pylayers.gis.layout.Layout.pt2cy">[docs]</a>    <span class="k">def</span> <span class="nf">pt2cy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
        <span class="sd">&quot;&quot;&quot; point to cycle</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pt : point (ndarray)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ncy : cycle number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            If a cycle contains point pt this function returns the cycle number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ptsh</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">cycle_exists</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">ptsh</span><span class="p">):</span>
                <span class="n">cycle_exists</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">return</span><span class="p">(</span><span class="n">ncy</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cycle_exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not in any cycle&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.cy2pt"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.cy2pt.html#pylayers.gis.layout.Layout.cy2pt">[docs]</a>    <span class="k">def</span> <span class="nf">cy2pt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1.2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a point into a given cycle</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        cy : int</span>
<span class="sd">            cycle number</span>

<span class="sd">        h : float</span>
<span class="sd">            point height</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        point  : nd.array</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">cy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">cy</span><span class="p">]))</span>
            <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pt</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
            <span class="k">return</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;cycle &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; not in self.Gt&quot;</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="Layout.pt2ro"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.pt2ro.html#pylayers.gis.layout.Layout.pt2ro">[docs]</a>    <span class="k">def</span> <span class="nf">pt2ro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))):</span>
        <span class="sd">&quot;&quot;&quot; point to room</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pt : point (ndarray)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nr : Room number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            If a room contains point pt this function returns the room number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ptsh</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ptshinroom</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">ptsh</span><span class="p">):</span>
                <span class="n">ptshinroom</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">return</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ptshinroom</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not in any room&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.seg2ro"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.seg2ro.html#pylayers.gis.layout.Layout.seg2ro">[docs]</a>    <span class="k">def</span> <span class="nf">seg2ro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; point to room</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        seg : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nr : Room number</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            If a room contains point pt this function returns the room number</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rooms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c">#if seg in self.Gt.node[self.Gr.node[nr][&#39;cycle&#39;]][&#39;vnodes&#39;]:</span>
            <span class="n">ncy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nr</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span><span class="p">:</span>
                <span class="n">rooms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rooms</span>
</div>
<div class="viewcode-block" id="Layout.room2segments"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.room2segments.html#pylayers.gis.layout.Layout.room2segments">[docs]</a>    <span class="k">def</span> <span class="nf">room2segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the segments of a room</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        room : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        seg : list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># old vnodes was there</span>
            <span class="n">ncy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="n">seg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">room</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not in not on Gr&quot;</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">seg</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">seg</span> <span class="o">=</span> <span class="n">seg</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Layout.room2nodes"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.room2nodes.html#pylayers.gis.layout.Layout.room2nodes">[docs]</a>    <span class="k">def</span> <span class="nf">room2nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the nodes of a room</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        room : int</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        nod : sorted list</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ncy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="n">nod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="c">#nod = self.Gt.node[self.Gr.node[room][&#39;cycle&#39;]][&#39;vnodes&#39;]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">room</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; is not in not on Gr&quot;</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nod</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">nod</span> <span class="o">=</span> <span class="n">nod</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">nod</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="Layout.builGr2"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.builGr2.html#pylayers.gis.layout.Layout.builGr2">[docs]</a>    <span class="k">def</span> <span class="nf">builGr2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># 1 : Cycles which are connected with an airwall are merged</span>
        <span class="c"># 2 : The remaining cycles which contains at least one common door are</span>
        <span class="c"># connected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">],</span><span class="n">v</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="n">involvedcycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="c"># list of cycles which are already involved in rooms</span>
        <span class="n">alreadythere</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cycleroom</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">involvedcycles</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.buildGr"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGr.html#pylayers.gis.layout.Layout.buildGr">[docs]</a>    <span class="k">def</span> <span class="nf">buildGr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build the graph of rooms Gr</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Ga : graph of adjascent rooms</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">       </span>
<span class="sd">        adjascent rooms are connected</span>
<span class="sd">        Gr is at first a deep copy of Gt</span>

<span class="sd">        The difficulty here is to take into account the AIR transition</span>
<span class="sd">        segments</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># Create a graph of adjascent rooms</span>
        <span class="c">#</span>
        <span class="n">Ga</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">Ga</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">edge</span><span class="p">:</span>
            <span class="n">dk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="n">dk</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">segs</span> <span class="o">=</span> <span class="n">dk</span><span class="p">[</span><span class="n">cy</span><span class="p">][</span><span class="s">&#39;segment&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">segs</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">segs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;AIR&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ga</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                            <span class="n">Ga</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="n">Ga</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">cy</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Ga</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                            <span class="n">Ga</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span>
                            <span class="n">Ga</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">cy</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">cy</span><span class="p">]</span>
                        <span class="n">Ga</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">cy</span><span class="p">)</span>
       
        <span class="c"># connected list of connected components of Gt</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">connected_components</span><span class="p">(</span><span class="n">Ga</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c">#  Connected components might not be all contiguous</span>
        <span class="c">#  this a problem because the concatenation of cycles</span>
        <span class="c">#  operation below requires cycles contiguity</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#</span>
        <span class="c"># Merge all air-connected cycles</span>
        <span class="c"># Pseudo code</span>
        <span class="c">#  for all conected components</span>
        <span class="c">#  licy = [22,78,5] 3 cycles are connected</span>
        <span class="k">for</span> <span class="n">licy</span> <span class="ow">in</span> <span class="n">connected</span><span class="p">:</span>
            <span class="n">merged</span> <span class="o">=</span> <span class="p">[]</span>        <span class="c"># merged cycle is void</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">licy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>     <span class="c"># pick the first cycle as root 22</span>
            <span class="n">tomerge</span> <span class="o">=</span> <span class="n">licy</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c"># 78,5</span>
            <span class="c">#for cy in tomerge: # 78,5</span>
            <span class="k">while</span> <span class="n">tomerge</span><span class="o">&lt;&gt;</span><span class="p">[]:</span>
                <span class="n">ncy</span> <span class="o">=</span> <span class="n">tomerge</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="c"># testing cycle contiguity before merging</span>
                <span class="n">croot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
                <span class="n">flip</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">croot</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">licy</span>
                    <span class="n">tomerge</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ncy</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>   
                    <span class="n">neigh</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="p">,</span><span class="n">ncy</span><span class="p">)</span> <span class="c"># all neighbors of 5</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span> <span class="c"># here the merging</span>
                    <span class="n">merged</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncy</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">k</span><span class="o">&lt;&gt;</span> <span class="n">root</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
            <span class="c"># remove merged cycles           </span>
            <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="n">merged</span><span class="p">:</span>           
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span>
            <span class="c"># update pos of root cycle with new center of gravity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">root</span><span class="p">]</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>


        <span class="n">ltrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">listtransition</span>
        <span class="n">ldoors</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="n">ltrans</span><span class="p">)</span>

        <span class="c"># Destroy cycles which have no doors</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">cy</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">lseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="n">hasdoor</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span> <span class="p">:</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ldoors</span><span class="p">,</span><span class="n">lseg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hasdoor</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">remove_node</span><span class="p">(</span><span class="n">cy</span><span class="p">)</span>

        <span class="c"># Destroy edges which do not share a door</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
            <span class="n">cy1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="n">cy2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
            <span class="n">f</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">cy1</span><span class="o">.</span><span class="n">intersect</span><span class="p">(</span><span class="n">cy2</span><span class="p">)</span>
            <span class="n">keep</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s">&#39;transition&#39;</span><span class="p">]:</span>
                        <span class="n">keep</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s">&#39;transition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">keep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Ga</span><span class="p">)</span>       

</div>
<div class="viewcode-block" id="Layout.buildGr3"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.buildGr3.html#pylayers.gis.layout.Layout.buildGr3">[docs]</a>    <span class="k">def</span> <span class="nf">buildGr3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build Graph of rooms</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">            A room is a set of cycles which contains at least one door</span>

<span class="sd">            This function requires Gt</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#self.doors ={}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">airwall</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="c"># rcpt : rooms counter</span>
        <span class="n">rcpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># ltrans : list of transition segment</span>
        <span class="n">ltrans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">listtransition</span><span class="p">)</span>
        <span class="c"># lairwalls : list of air walls</span>
        <span class="n">lairwalls</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="n">ltrans</span><span class="p">)</span>
        <span class="c"># ldoors : list of doors segment number</span>
        <span class="n">ldoors</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">,</span><span class="n">ltrans</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># For all cycles</span>
        <span class="c">#</span>
        <span class="c"># Rule : add a new room if :</span>
        <span class="c">#       + the cycle has a transition segment which is not an air wall</span>
        <span class="c">#       unless</span>
        <span class="c">#       + there already exists a created room which is separated from the</span>
        <span class="c">#       current cycle by an airwall</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c"># roomcycles dict room : list of cycles number involved in room</span>
        <span class="c"># cycleroom dict cycle : room number</span>
        <span class="n">roomcycles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cycleroom</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="c">#if k==5:</span>
            <span class="c">#    pdb.set_trace()</span>
            <span class="c"># list of segments from the cycle</span>
            <span class="c"># which have:</span>
            <span class="c">#  ldoors</span>
            <span class="c">#  lairwalls</span>
            <span class="c">#</span>
            <span class="n">lseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">lseg</span><span class="p">,</span> <span class="n">ldoors</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">lseg</span><span class="p">,</span> <span class="n">lairwalls</span><span class="p">)</span>
            <span class="n">alreadythere</span> <span class="o">=</span><span class="p">[]</span>
            <span class="c">#</span>
            <span class="c"># Analysis of cycles which are connected via an air-wall</span>
            <span class="c">#</span>
            <span class="c"># cyclehasdoor is True if cycle k has a door segment</span>
            <span class="c"># hasdoors is True if at least one adjascent cycle from the same</span>
            <span class="c"># room has a door</span>
            <span class="c"># doors : np array with doors associated to room k</span>
            <span class="n">cyclehasdoor</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">hasdoors</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">doors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">cyclehasdoor</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">doors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="c"># this should be a recursive function</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="c"># b : list of cycles which involve an airwall</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">],</span><span class="n">v</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">involvedcycles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="c"># list of cycles which are already involved in rooms</span>
                <span class="n">alreadythere</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cycleroom</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">involvedcycles</span><span class="p">)</span>
                <span class="n">notyet</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cycleroom</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">involvedcycles</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cy1</span> <span class="ow">in</span> <span class="n">involvedcycles</span><span class="p">:</span>
                    <span class="n">lseg1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">cy1</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>
                    <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">lseg1</span><span class="p">,</span> <span class="n">ldoors</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">hasdoors</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">doors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">doors</span><span class="p">,</span><span class="n">u1</span><span class="p">)))</span>

                <span class="k">print</span> <span class="s">&quot;cycle &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="c">#print &quot;airwall segment &quot;+str(v)</span>
                <span class="c">#print &quot;involved cycles &quot;+str(involvedcycles)</span>
                <span class="k">print</span> <span class="s">&quot;already there &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alreadythere</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&quot;not there yet &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">notyet</span><span class="p">)</span>
                <span class="c">#print &quot;cycles involved &quot;,cycleroom.keys()</span>
            <span class="c">#</span>
            <span class="c"># If cycle has a door (transition which is not an air wall)</span>
            <span class="c"># Then create a new room</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">cyclehasdoor</span><span class="o">|</span><span class="n">hasdoors</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alreadythere</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="c">#self.Gr.add_node(j, cycle=k, doors=u)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">rcpt</span><span class="p">,</span> <span class="n">cycle</span><span class="o">=</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">transitions</span><span class="o">=</span><span class="n">doors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">rcpt</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rcpt</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>
                <span class="c">#roomcycles[rcpt].append(k)</span>
                <span class="n">cycleroom</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">rcpt</span>
                <span class="c"># add transitions</span>
                <span class="k">for</span> <span class="n">ku</span> <span class="ow">in</span> <span class="n">u</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">[</span><span class="n">ku</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rcpt</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">[</span><span class="n">ku</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">rcpt</span><span class="p">]</span>

                <span class="c"># Merge cycles which are separated by an airwall</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">kv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">ncy</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">&lt;&gt;</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">kv</span><span class="p">][</span><span class="s">&#39;ncycles&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">rcpt</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncy</span><span class="p">)</span>
                <span class="c"># increment room counter</span>
                <span class="n">rcpt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alreadythere</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">ncy</span> <span class="o">=</span> <span class="n">alreadythere</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">roomn</span> <span class="o">=</span> <span class="n">cycleroom</span><span class="p">[</span><span class="n">ncy</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ncy</span> <span class="ow">in</span> <span class="n">notyet</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;merging cycle &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ncy</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;in room &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">roomn</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">roomn</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ncy</span><span class="p">][</span><span class="s">&#39;polyg&#39;</span><span class="p">]</span>


        <span class="c"># add connection between rooms</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">:</span>
            <span class="n">room1room2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">room1room2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">room1room2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">room1room2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="Layout.waypoint"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.waypoint.html#pylayers.gis.layout.Layout.waypoint">[docs]</a>    <span class="k">def</span> <span class="nf">waypoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the waypoint between room1 and room2</span>
<span class="sd">        waypoint = waypoint(nroom1,nroom2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rooms</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="p">,</span> <span class="n">nroom1</span><span class="p">,</span> <span class="n">nroom2</span><span class="p">)</span>
        <span class="n">nroom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span>
        <span class="n">waypoint</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nroom</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">room1</span> <span class="o">=</span> <span class="n">rooms</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">proom1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">room1</span><span class="p">]</span>
            <span class="n">room2</span> <span class="o">=</span> <span class="n">rooms</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">doors1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room1</span><span class="p">][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
            <span class="n">doors2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">room2</span><span class="p">][</span><span class="s">&#39;doors&#39;</span><span class="p">]</span>
            <span class="n">doorId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">doors1</span><span class="p">,</span> <span class="n">doors2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#</span>
            <span class="c"># coord door</span>
            <span class="c">#</span>
            <span class="n">unode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">doorId</span><span class="p">)</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">unode</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">pdoor</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">proom1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proom1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pdoor</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdoor</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">proom2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nroom2</span><span class="p">]</span>
        <span class="n">waypoint</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">proom2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proom2</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">waypoint</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.editor"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.editor.html#pylayers.gis.layout.Layout.editor">[docs]</a>    <span class="k">def</span> <span class="nf">editor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; invoke interactive layout graphical editor</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        point edition</span>

<span class="sd">            m  toggle point edition mode  (CP : Create Point)</span>

<span class="sd">                lclic same x</span>
<span class="sd">                rclic same y</span>
<span class="sd">                cclic free point</span>

<span class="sd">        segment edition</span>

<span class="sd">            [0-f] - display one of the 16 first layers</span>
<span class="sd">            x : save structure</span>
<span class="sd">            o : toggle overlay</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">af</span> <span class="o">=</span> <span class="n">SelectL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cid1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">OnClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">af</span><span class="o">.</span><span class="n">OnPress</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.editorGtk"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.editorGtk.html#pylayers.gis.layout.Layout.editorGtk">[docs]</a>    <span class="k">def</span> <span class="nf">editorGtk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">gtk</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_gtkagg</span> <span class="kn">import</span> <span class="n">FigureCanvasGTKAgg</span> <span class="k">as</span> <span class="n">FigureCanvas</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_gtkagg</span> <span class="kn">import</span> <span class="n">NavigationToolbar2GTKAgg</span> <span class="k">as</span> <span class="n">NavigationToolbar</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="kn">import</span> <span class="n">key_press_handler</span>

        <span class="n">win</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">()</span>
        <span class="n">win</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>


        <span class="n">win</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">Window</span><span class="p">()</span>
        <span class="n">win</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;destroy&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">gtk</span><span class="o">.</span><span class="n">main_quit</span><span class="p">())</span>
        <span class="n">win</span><span class="o">.</span><span class="n">set_default_size</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">win</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&quot;Embedding in GTK&quot;</span><span class="p">)</span>

        <span class="n">vbox</span> <span class="o">=</span> <span class="n">gtk</span><span class="o">.</span><span class="n">VBox</span><span class="p">()</span>
        <span class="n">win</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c"># a gtk.DrawingArea</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">win</span><span class="p">)</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">pack_start</span><span class="p">(</span><span class="n">toolbar</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">on_key_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;you pressed </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="n">key_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">toolbar</span><span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">on_key_event</span><span class="p">)</span>

        <span class="n">win</span><span class="o">.</span><span class="n">show_all</span><span class="p">()</span>
        <span class="n">gtk</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.editorTk"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.editorTk.html#pylayers.gis.layout.Layout.editorTk">[docs]</a>    <span class="k">def</span> <span class="nf">editorTk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; invoke interactive layout graphical editor</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        point edition</span>

<span class="sd">            m  toggle point edition mode  (CP : Create Point)</span>

<span class="sd">                lclic same x</span>
<span class="sd">                rclic same y</span>
<span class="sd">                cclic free point</span>

<span class="sd">        segment edition</span>

<span class="sd">            [0-f] - display one of the 16 first layers</span>
<span class="sd">            x : save structure</span>
<span class="sd">            o : toggle overlay</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#import matplotlib</span>
        <span class="c">#matplotlib.use(&#39;TkAgg&#39;)</span>

        <span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="kn">import</span> <span class="n">key_press_handler</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends.backend_tkagg</span> <span class="kn">import</span> <span class="n">FigureCanvasTkAgg</span><span class="p">,</span> <span class="n">NavigationToolbar2TkAgg</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="kn">import</span> <span class="nn">Tkinter</span> <span class="kn">as</span> <span class="nn">Tk</span>

        <span class="n">root</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">root</span><span class="o">.</span><span class="n">wm_title</span><span class="p">(</span><span class="s">&#39;Pylayers Layout Editor&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">()</span>
        <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="c">#ax.plot(np.arange(10))</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasTkAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">master</span><span class="o">=</span><span class="n">root</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">get_tk_widget</span><span class="p">()</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">Tk</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">Tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar2TkAgg</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span><span class="n">root</span><span class="p">)</span>
        <span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">_tkcanvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">Tk</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span><span class="n">fill</span><span class="o">=</span><span class="n">Tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">button</span> <span class="o">=</span> <span class="n">Tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Quit&#39;</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">Tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s">&#39;ednodes&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>

        <span class="n">select</span> <span class="o">=</span> <span class="n">SelectL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canvas</span><span class="p">)</span>

        <span class="c">#self.af.show(clear=True)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cid1</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">OnClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid2</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">select</span><span class="o">.</span><span class="n">OnPress</span><span class="p">)</span>
        <span class="c">#ax.axis(&#39;tight&#39;)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">Tk</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.info.html#pylayers.gis.layout.Layout.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives information about the Layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;filestr : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="k">print</span> <span class="s">&quot;filematini : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filematini</span>
        <span class="k">print</span> <span class="s">&quot;fileslabini : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;filegeom : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;geomfile (.off) has no been generated&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;boundaries &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span>
        <span class="k">print</span> <span class="s">&quot;number of Points :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="k">print</span> <span class="s">&quot;number of Segments :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span>
        <span class="k">print</span> <span class="s">&quot;number of Sub-Segments :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gs Nodes : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gs Edges : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gs graph&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gt Nodes : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gt Edges : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;vnodes = Gt.node[Nc][&#39;cycles&#39;].cycle &quot;</span>
            <span class="k">print</span> <span class="s">&quot;poly = Gt.node[Nc][&#39;cycle&#39;].polyg &quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gt graph&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Gr Nodes    :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Gr Edges    :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&quot;Nc  = Gr.node[nroom][&#39;cycles&#39;]  &quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;no Gr graph&quot;</span>
</div>
<div class="viewcode-block" id="Layout.facets3D"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.facets3D.html#pylayers.gis.layout.Layout.facets3D">[docs]</a>    <span class="k">def</span> <span class="nf">facets3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edlist</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Layer&#39;</span><span class="p">,</span> <span class="n">subseg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        facets3d(edlist,name)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">filestruc</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filestruc</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST{</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edlist</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">facet3D</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">subseg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;void&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="s">&#39;{&lt;&#39;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Layout.isseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.isseg.html#pylayers.gis.layout.Layout.isseg">[docs]</a>    <span class="k">def</span> <span class="nf">isseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ta</span><span class="p">,</span><span class="n">he</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; test if ta&lt;-&gt;he is a segment</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tahe</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># transpose point numbering</span>

        <span class="n">upnt</span>  <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upnt</span><span class="p">)</span><span class="o">==</span><span class="n">ta</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">he</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">upnt</span><span class="p">)</span><span class="o">==</span><span class="n">he</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">(((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">ta</span><span class="p">)</span> <span class="o">&amp;</span>   <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">he</span><span class="p">))</span>
                     <span class="o">|</span>           <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">he</span><span class="p">)</span> <span class="o">&amp;</span>   <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">ta</span><span class="p">)))</span>
                     <span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>


</div>
<div class="viewcode-block" id="Layout.ispoint"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.ispoint.html#pylayers.gis.layout.Layout.ispoint">[docs]</a>    <span class="k">def</span> <span class="nf">ispoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.45</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ispoint(pt,tol) : verify if pt is a point of Layout</span>

<span class="sd">        if True the point number (numbered from 1) is return</span>
<span class="sd">        else -1 is return</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print &quot;ispoint : pt &quot;, pt</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ke</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">u</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">nz</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nz</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="n">ke</span><span class="p">[</span><span class="n">nup</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Layout.onseg"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.onseg.html#pylayers.gis.layout.Layout.onseg">[docs]</a>    <span class="k">def</span> <span class="nf">onseg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; segment number from point (deprecated)</span>

<span class="sd">        return segment number which contains point pt</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        pt  np.array(1x2) </span>
<span class="sd">        tol = 0.01      tolerance</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">T</span>   <span class="c"># structure points</span>
        <span class="n">ke</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>        <span class="c"># point keys</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pts</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">nbu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                   <span class="c">#</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inbox</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

            <span class="n">ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>
            <span class="n">he</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span>

            <span class="n">nb</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

            <span class="c">#print ta</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">pts</span><span class="p">[:,</span> <span class="n">ta</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[:,</span> <span class="n">he</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span>

            <span class="n">nv1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">nv2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>

            <span class="n">v1n</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">nv1</span>
            <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">nv2</span>

            <span class="n">ps</span> <span class="o">=</span> <span class="n">v1n</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v1n</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">v2n</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">ps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
            <span class="n">nbu</span> <span class="o">=</span> <span class="n">nb</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">nbu</span>
</div>
<div class="viewcode-block" id="Layout.facet3D"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.facet3D.html#pylayers.gis.layout.Layout.facet3D">[docs]</a>    <span class="k">def</span> <span class="nf">facet3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">subseg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; facet3D</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        e</span>
<span class="sd">        subseg : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
        <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span>
        <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
       
        <span class="k">if</span> <span class="n">subseg</span><span class="p">:</span>
            <span class="n">nsseg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nsseg</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;fa&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.off&#39;</span>
        <span class="n">filestruc</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filestruc</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">nsseg</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">nsseg</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subseg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]):</span>
                    <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;no subsegment on &#39;</span><span class="p">,</span> <span class="n">e</span>
                <span class="k">return</span><span class="p">(</span><span class="s">&#39;void&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        
        <span class="k">if</span> <span class="n">subseg</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">]):</span>
                <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
                <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
                <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 0.4</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="p">,</span>
                <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 0.4</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.geomfile"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.geomfile.html#pylayers.gis.layout.Layout.geomfile">[docs]</a>    <span class="k">def</span> <span class="nf">geomfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">centered</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create a .off geomview file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        centered : Boolean</span>
<span class="sd">            if True the layout is centered around its center of gravity</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The `.off` file can be vizualized through the show3 method</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;DLR.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; pg = L.geomfile()</span>

<span class="sd">        &quot;&quot;&quot;</span>
   
        <span class="c"># calculate center of gravity</span>
        <span class="k">if</span> <span class="n">centered</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
       
        <span class="c">#en  = self.Ns # number of segments</span>
        <span class="n">en</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">en</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;wrong number of segment consistency problem in layout&quot;</span><span class="p">)</span>
        <span class="c">#cen = self.Nss</span>
        <span class="c"># d : dictionnary of layout sub segments</span>
        <span class="c">#</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="n">cen</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">lss</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">cen</span> <span class="o">=</span> <span class="n">cen</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">lss</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cen</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;wrong number of subsegment consistency problem in layout&quot;</span><span class="p">)</span>

        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
<span class="c">#</span>
<span class="c">#        Create a polygon for each segment and subsegment</span>
<span class="c">#</span>
        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

        <span class="n">ik</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dikn</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># segment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">:</span>
                    <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dikn</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
                    <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">en</span> <span class="o">=</span> <span class="n">en</span><span class="o">-</span><span class="mi">1</span>
        <span class="c"># d = self.subseg()</span>
        <span class="c"># k : ss_name v: seg number</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">subseg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">subseg</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print ik,n1,n2</span>

                <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#print P1[:,ik]</span>

                <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#print P2[:,ik]</span>

                <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print P3[:,ik]</span>

                <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print P4[:,ik]</span>

                <span class="n">dikn</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">npt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">)</span>
        <span class="n">_filename</span><span class="p">,</span><span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">_filegeom</span> <span class="o">=</span> <span class="n">_filename</span><span class="o">+</span><span class="s">&#39;.off&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span><span class="o">=</span><span class="n">_filegeom</span>
        <span class="n">filegeom</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filegeom</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fos</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filegeom</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">):</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
<span class="c">#        ke   = cold.keys()</span>
<span class="c">#</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">en</span><span class="p">:</span>
                <span class="c">#ne = i + 1</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#nss = i - en</span>
                <span class="c">##ne = subseg[nss]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">]</span>

<span class="c">#            if (i&lt;en):</span>
<span class="c">#                name = self.name[i]</span>
<span class="c">#            else:</span>
<span class="c">#                core = self.ce[subseg[i-en]][0]</span>
<span class="c">#                name = sl.di[core]</span>

            <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span> <span class="o">/</span> <span class="mf">255.</span>
            <span class="n">fos</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 0.4</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span> <span class="o">+</span>
                <span class="mi">1</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">q</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fos</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pg</span>
</div>
    <span class="nd">@mlab.show</span>
<div class="viewcode-block" id="Layout._show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout._show3.html#pylayers.gis.layout.Layout._show3">[docs]</a>    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">centered</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create a .off geomview file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        newfig : Boolean</span>
<span class="sd">            create a new mayavi Figure</span>
<span class="sd">        opacity : float ([0,1])</span>
<span class="sd">            set slab opacity</span>
<span class="sd">        centered : Boolean</span>
<span class="sd">            if True the layout is centered around its center of gravity</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The `.off` file can be vizualized through the show3 method</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L._show3()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># calculate center of gravity</span>
        <span class="k">if</span> <span class="n">centered</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

        <span class="c">#en  = self.Ns # number of segments</span>
        <span class="n">en</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">en</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;wrong number of segment consistency problem in layout&quot;</span><span class="p">)</span>
        <span class="c">#cen = self.Nss</span>
        <span class="c"># d : dictionnary of layout sub segments</span>
        <span class="c">#</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subseg</span><span class="p">()</span>
        <span class="n">cen</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">lss</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">cen</span> <span class="o">=</span> <span class="n">cen</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">lss</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cen</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nss</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;wrong number of subsegment consistency problem in layout&quot;</span><span class="p">)</span>

        <span class="n">sl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span>
<span class="c">#</span>
<span class="c">#        Create a polygon for each segment and subsegment</span>
<span class="c">#</span>
        <span class="n">P1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="n">P4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

        <span class="n">ik</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dikn</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c"># segment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">&lt;&gt;</span><span class="s">&#39;AIR&#39;</span><span class="p">:</span>
                    <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                    <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                    <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;z&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="n">dikn</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
                    <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="n">en</span> <span class="o">=</span> <span class="n">en</span><span class="o">-</span><span class="mi">1</span>


        <span class="c"># d = self.subseg()</span>
        <span class="c"># k : ss_name v: seg number</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">subseg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#pdb.set_trace()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">subseg</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">nebr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">nebr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print ik,n1,n2</span>

                <span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P1</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#print P1[:,ik]</span>

                <span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P2</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#print P2[:,ik]</span>

                <span class="n">P3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P3</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print P3[:,ik]</span>

                <span class="n">P4</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span><span class="o">-</span><span class="n">pg</span>
                <span class="n">P4</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ids</span><span class="p">][</span><span class="s">&#39;ss_z&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print P4[:,ik]</span>

                <span class="n">dikn</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">l</span>
                <span class="n">ik</span> <span class="o">=</span> <span class="n">ik</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">npt</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">)</span>
        <span class="n">npt_s</span> <span class="o">=</span> <span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">)</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">P1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">npt_s</span><span class="p">],</span><span class="n">P2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">npt_s</span><span class="p">]))</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span><span class="n">P3</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">npt_s</span><span class="p">]))</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span><span class="n">P4</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">npt_s</span><span class="p">]))</span>
        <span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">T</span>
        <span class="n">boxes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">npt</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npt</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">boxes</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">b</span>
        <span class="n">boxes</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="o">+</span><span class="n">npt_s</span>
        <span class="n">boxes</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">npt_s</span>
        <span class="n">boxes</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">b</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">npt_s</span>

        <span class="c"># manage floor</span>
        <span class="n">floorx</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">floory</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
        <span class="n">zmin</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">Pf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">floorx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">floory</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zmin</span><span class="p">])</span>
        <span class="n">Pf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Pf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">floorx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">floory</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">zmin</span><span class="p">])))</span>
        <span class="n">Pf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Pf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">floorx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">floory</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">zmin</span><span class="p">])))</span>
        <span class="n">Pf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">Pf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">floorx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">floory</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">zmin</span><span class="p">])))</span>

        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span><span class="n">Pf</span><span class="p">))</span>
        <span class="n">bf</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npt</span><span class="p">,</span><span class="n">npt</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">boxes</span><span class="p">,</span><span class="n">bf</span><span class="p">))</span>





<span class="c">#         _filename,ext = os.path.splitext(self.filename)</span>
<span class="c">#         _filegeom = _filename+&#39;.off&#39;</span>
<span class="c">#         self.filegeom=_filegeom</span>
<span class="c">#         filegeom = pyu.getlong(_filegeom, pstruc[&#39;DIRGEOM&#39;])</span>
<span class="c">#         fos = open(filegeom, &quot;w&quot;)</span>
<span class="c">#         fos.write(&quot;OFF\n&quot;)</span>
<span class="c">#         fos.write(&quot;%d %d \n\n&quot; % (npt + 1, en + cen))</span>
<span class="c">#         fos.write(&quot;0.000 0.000 0.000\n&quot;)</span>
<span class="c">#         for i in range(en + cen):</span>
<span class="c">#             fos.write(&quot;%6.3f %6.3f %6.3f \n&quot; % (P1[0, i], P1[1, i], P1[2, i]))</span>
<span class="c">#             fos.write(&quot;%6.3f %6.3f %6.3f \n&quot; % (P2[0, i], P2[1, i], P2[2, i]))</span>
<span class="c">#             fos.write(&quot;%6.3f %6.3f %6.3f \n&quot; % (P3[0, i], P3[1, i], P3[2, i]))</span>
<span class="c">#             fos.write(&quot;%6.3f %6.3f %6.3f \n&quot; % (P4[0, i], P4[1, i], P4[2, i]))</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="n">color</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">cen</span><span class="o">+</span><span class="n">en</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">en</span> <span class="o">+</span> <span class="n">cen</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">en</span><span class="p">:</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ne</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">order</span> <span class="o">=</span> <span class="n">dikn</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">ne</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">][</span><span class="n">order</span><span class="p">]</span>

            <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
            <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
            <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span>
            <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">npt_s</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span>
            <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">npt_s</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span>
            <span class="n">color</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">npt_s</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">)</span>



        <span class="n">colname</span> <span class="o">=</span> <span class="n">sl</span><span class="p">[</span><span class="s">&#39;FLOOR&#39;</span><span class="p">][</span><span class="s">&#39;color&#39;</span><span class="p">]</span>
        <span class="n">colhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">colname</span><span class="p">]</span>
        <span class="n">colf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">((</span><span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">colhex</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:],</span><span class="mi">4</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">color</span><span class="p">,</span><span class="n">colf</span><span class="p">))</span>

        <span class="c"># trick for correcting  color assignement</span>

        <span class="n">sc</span><span class="o">=</span><span class="n">tvtk</span><span class="o">.</span><span class="n">UnsignedCharArray</span><span class="p">()</span>
        <span class="n">sc</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>



        <span class="n">mesh</span> <span class="o">=</span> <span class="n">tvtk</span><span class="o">.</span><span class="n">PolyData</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">points</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="n">boxes</span><span class="p">)</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span> <span class="o">=</span> <span class="n">sc</span>
        <span class="n">mesh</span><span class="o">.</span><span class="n">point_data</span><span class="o">.</span><span class="n">scalars</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;scalars&#39;</span>


        <span class="k">if</span> <span class="n">newfig</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">background</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="n">surf</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">)</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">surface</span><span class="p">(</span><span class="n">mlab</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">extract_edges</span><span class="p">(</span><span class="n">surf</span><span class="p">),</span>
                                    <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Layout &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>

</div>
<div class="viewcode-block" id="Layout.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.show3.html#pylayers.gis.layout.Layout.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">centered</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; geomview display of the indoor structure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bdis boolean (default True)</span>
<span class="sd">            boolean display (call geowview if True)</span>
<span class="sd">        centered : boolean</span>
<span class="sd">            if True center the layout before display</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geomfile</span><span class="p">(</span><span class="n">centered</span><span class="o">=</span><span class="n">centered</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filegeom</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
            <span class="c">#chaine = &quot;geomview -nopanel -b 1 1 1 &quot; + filename + &quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview  -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.signature"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.signature.html#pylayers.gis.layout.Layout.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iTx</span><span class="p">,</span> <span class="n">iRx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine signature between node iTx and node iRx</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iTx  : Transmitter room</span>
<span class="sd">        iRx  :</span>
<span class="sd">               Transmitter room</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        sigarr    :</span>
<span class="sd">        signature :</span>


<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        This a temporary function</span>
<span class="sd">            There is some algorithmic work to find the best way to determine signature</span>
<span class="sd">            T4 : limit the ndt to only edges and nodes in visibility from Tx</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Here we take all the vnodes &gt;0  from the room</span>
        <span class="c">#</span>
        <span class="c"># Practically those list of nodes should depend on pTx , pRx</span>
        <span class="c">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gi</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Interaction graph layout.Gi must be build before signature computation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iTx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">NroomTx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt2ro</span><span class="p">(</span><span class="n">iTx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iTx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">NroomTx</span> <span class="o">=</span> <span class="n">iTx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;iTx must be an array or a room number&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iRx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">NroomRx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt2ro</span><span class="p">(</span><span class="n">iRx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iRx</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">NroomRx</span> <span class="o">=</span> <span class="n">iRx</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;iRx must be an array or a room number&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">NroomTx</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">has_node</span><span class="p">(</span><span class="n">NroomRx</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Tx or Rx is not in Gr&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># .. todo:: modifier inter afin de ne pas retenir les points non diffractants</span>
        <span class="c">#</span>
        <span class="n">ndt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NroomTx</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]][</span><span class="s">&#39;inter&#39;</span><span class="p">]</span>
        <span class="n">ndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NroomRx</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]][</span><span class="s">&#39;inter&#39;</span><span class="p">]</span>
        <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="n">ndt</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="n">ndr</span><span class="p">:</span>
                <span class="n">addpath</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nt</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">nr</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span>
                        <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                        <span class="c">#print &#39;no path between &#39;,nt,nr</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">nt</span> <span class="o">!=</span> <span class="n">nr</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">dijkstra_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gi</span><span class="p">,</span> <span class="n">nt</span><span class="p">,</span> <span class="n">nr</span><span class="p">)</span>
                        <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                        <span class="c">#print &#39;no path between &#39;,nt,nr</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">addpath</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">nt</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">addpath</span><span class="p">:</span>
                    <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])))</span>
                    <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                        <span class="n">it</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">interaction</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])))</span>
                        <span class="k">elif</span> <span class="n">it</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span>
                                                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sigarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sigarr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">it</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">]])))</span>

        <span class="k">return</span> <span class="n">sigarr</span>
</div>
<div class="viewcode-block" id="Layout.get_Sg_pos"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.get_Sg_pos.html#pylayers.gis.layout.Layout.get_Sg_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_Sg_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigarr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return position of the signatures</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        sigarr : signature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">sigarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sposfull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">),</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">signature</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">spos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">signature</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">sposfull</span><span class="p">[</span><span class="n">iz</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">spos</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sposfull</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.plot_segments"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.plot_segments.html#pylayers.gis.layout.Layout.plot_segments">[docs]</a>    <span class="k">def</span> <span class="nf">plot_segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lns</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lns</span>
<span class="sd">        *kwargs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                    <span class="s">&#39;color&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>
       
        <span class="n">nth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="n">lns</span><span class="p">))</span>
        <span class="n">nt</span> <span class="o">=</span> <span class="n">nth</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nh</span> <span class="o">=</span> <span class="n">nth</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># pt : 2 x Ns</span>
        <span class="n">pt</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span> <span class="p">:</span>
                           <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">nt</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c"># ph : 2 x Ns</span>
        <span class="n">ph</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span> <span class="p">:</span>
                           <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span><span class="n">nh</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
       
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plu</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span><span class="n">ph</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">])</span>                                

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>
<div class="viewcode-block" id="Layout.showSig"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.showSig.html#pylayers.gis.layout.Layout.showSig">[docs]</a>    <span class="k">def</span> <span class="nf">showSig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigarr</span><span class="p">,</span> <span class="n">Tx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Rx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(),</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Show signature</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Tx  : np.array (2,1)</span>
<span class="sd">                Transmitter coordinates</span>
<span class="sd">        Rx  : np.array (2,1)</span>
<span class="sd">                Receipter coordinates</span>
<span class="sd">        sr  : boolean</span>
<span class="sd">                show room signature</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fig   : figure instance</span>
<span class="sd">        ax    : axes instance</span>
<span class="sd">        lines : lines instance</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sig</span> <span class="o">=</span><span class="n">sigarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Sg_pos</span><span class="p">(</span><span class="n">sigarr</span><span class="p">)</span>
        <span class="n">nz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sig</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)))</span>
        <span class="n">mask</span><span class="p">[:,</span> <span class="n">nz</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">Tx</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">itx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">itx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="n">itx2</span><span class="p">]</span>
            <span class="n">tx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Tx</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">Rx</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">irx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">nz</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">irx2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">irx</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[</span><span class="n">irx2</span><span class="p">]</span>
            <span class="n">rx</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">),</span> <span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">Rx</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">rx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
<span class="c">#        lines=[]</span>
<span class="c">#        for s in sig:</span>
<span class="c">#            l=[self.Gs.pos[s[ii]] for ii in xrange(len(s))]</span>
<span class="c">#            if Tx!=None and Rx!=None:</span>
<span class="c">#                l.insert(0,Tx)</span>
<span class="c">#                l.insert(-1,Rx)</span>
<span class="c">#            ls=sh.LineString(l)</span>
<span class="c">#            x,y=ls.xy</span>
<span class="c">#            lines.extend(ax.plot(x,y,&#39;k&#39;,lw=0.1,alpha=0.2))</span>
<span class="c">#        return (fig,ax,lines)</span>
</div>
<div class="viewcode-block" id="Layout.distwall"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.distwall.html#pylayers.gis.layout.Layout.distwall">[docs]</a>    <span class="k">def</span> <span class="nf">distwall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">nroom</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate distance to wall</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p : ndarray</span>
<span class="sd">            point coordinate</span>

<span class="sd">        nroom : int</span>
<span class="sd">            room number of p</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        dist</span>
<span class="sd">                list of distances to walls of room nroom</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Return  dist a list of all the distances to the walls of a room</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">dist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p0_xy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p1_xy</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">Nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span>
        <span class="c">#vnode = self.Gt.node[Nc][&#39;vnodes&#39;]</span>
        <span class="n">vnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">Nc</span><span class="p">][</span><span class="s">&#39;cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cycle</span>

        <span class="c">#for j in range(len(Gr[nroom][&#39;vnodes&#39;])):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gr</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])):</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_Gr</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">nta</span> <span class="o">=</span> <span class="n">G1</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">nhe</span> <span class="o">=</span> <span class="n">G1</span><span class="o">.</span><span class="n">tahe</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nta</span><span class="p">],</span> <span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nta</span><span class="p">]])</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nhe</span><span class="p">],</span> <span class="n">G1</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nhe</span><span class="p">]])</span>
            <span class="n">p0_xy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">p0</span><span class="p">)</span>
            <span class="n">p1_xy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>

        <span class="n">pstartwll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p0_xy</span><span class="p">)</span>
        <span class="n">pfinwll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p1_xy</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_Gr</span><span class="p">[</span><span class="n">nroom</span><span class="p">][</span><span class="s">&#39;vnodes&#39;</span><span class="p">])):</span>
            <span class="n">line_wall</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">([(</span><span class="n">pstartwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">pstartwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">pfinwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pfinwll</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">])])</span>
            <span class="n">dist</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">line_wall</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">pp</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.randTxRx"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.randTxRx.html#pylayers.gis.layout.Layout.randTxRx">[docs]</a>    <span class="k">def</span> <span class="nf">randTxRx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns random coordinates for Tx and Rx.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        p_Tx : numpy.ndarray</span>
<span class="sd">             A point of the placement of the Tx</span>
<span class="sd">        p_Rx : numpy.ndarray</span>
<span class="sd">             A point of the placement of the Rx</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;example.str&#39;,&#39;matDB.ini&#39;,&#39;slabDB.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; p_Tx,p_Rx = L.randTxRx()</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            ex fn Tx_Rx_pos</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary</span><span class="p">()</span>

        <span class="n">Tx_x</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Tx_y</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">Rx_x</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">Rx_y</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="n">p_Tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Tx_x</span><span class="p">,</span> <span class="n">Tx_y</span><span class="p">])</span>
        <span class="n">p_Rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Rx_x</span><span class="p">,</span> <span class="n">Rx_y</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">p_Tx</span><span class="p">,</span> <span class="n">p_Rx</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Layout.boundary"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.boundary.html#pylayers.gis.layout.Layout.boundary">[docs]</a>    <span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a blank boundary around layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        dx : float</span>
<span class="sd">            x offset (default 0)</span>
<span class="sd">        dy : float</span>
<span class="sd">            y offset (default 0 )</span>

<span class="sd">        self.ax is updated</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">        &gt;&gt;&gt; L = Layout(&#39;example.str&#39;,&#39;matDB.ini&#39;,&#39;slabDB.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; L.boundary()</span>
<span class="sd">        &gt;&gt;&gt; L.ax</span>
<span class="sd">        (0.0, 10.0, -2.0, 2.0)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">20.</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="mf">20.</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="mf">10.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">-</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Layout.get_paths"><a class="viewcode-back" href="../../../modules/generated/pylayers.gis.layout.Layout.get_paths.html#pylayers.gis.layout.Layout.get_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nd_in</span><span class="p">,</span> <span class="n">nd_fin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the possible paths of graph Gs between two nodes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            nd_in: int</span>
<span class="sd">                initial graph node (segment or point)</span>
<span class="sd">            nd_fin: int</span>
<span class="sd">                final graph node (segment or point)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            paths : list</span>
<span class="sd">                paths between nd_in and nd_fin</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="n">gph</span><span class="o">.</span><span class="n">find_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gs</span><span class="p">,</span> <span class="n">nd_in</span><span class="p">,</span> <span class="n">nd_fin</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">paths</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c">#plt.ion()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
    <span class="c">#L = Layout(&#39;defstr3.ini&#39;)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, PyLayers developer team.
      Last updated on mars 12, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_setDomainName', 'pylayers.github.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })(); 
</script> 
 
  </body>
</html>