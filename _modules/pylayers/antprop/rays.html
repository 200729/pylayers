

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.rays &mdash; PyLayers 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0" alt="pylayers"/></a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.antprop.rays</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: latin1 -*-</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="c">#from math import *</span>
<span class="c">#from Indoor import *</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">from</span>   <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.slab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">from</span> <span class="nn">numpy.core.umath_tests</span> <span class="kn">import</span> <span class="n">matrix_multiply</span>
<span class="c">#from numba import autojit</span>
<span class="c">#</span>
<span class="c">#  This file contains</span>
<span class="c">#</span>
<span class="c">#       class Interaction</span>
<span class="c">#           info</span>
<span class="c">#           class IntB(Interaction)</span>
<span class="c">#              eval(f)</span>
<span class="c">#           class IntL(Interaction)</span>
<span class="c">#              eval(f)</span>
<span class="c">#           class IntR(Interaction)</span>
<span class="c">#              eval(f)    TBF</span>
<span class="c">#           class IntT(Interaction)</span>
<span class="c">#           class IntD(Interaction)</span>
<span class="c">#</span>
<span class="c">#       class Ray3D</span>
<span class="c">#           info()</span>
<span class="c">#           locbas(L)</span>
<span class="c">#           delay()</span>
<span class="c">#           show()</span>
<span class="c">#           show3(bdis=True,bbas=False,bstruc=True,col=np.array([1,0,1]),id=0)</span>
<span class="c">#</span>
<span class="c">#       class RayTud</span>
<span class="c">#           info()</span>
<span class="c">#           delay()  compliquÃ© !!</span>
<span class="c">#           eval(f)</span>
<span class="c">#</span>
<span class="c">#       class GrRayTud</span>
<span class="c">#           delay()</span>
<span class="c">#           choose()</span>
<span class="c">#           load(_filename,sl)</span>
<span class="c">#           info(n=-1)</span>
<span class="c">#</span>
<span class="c">#       class GrRay3D</span>
<span class="c">#           info(level=0)</span>
<span class="c">#           choose()</span>
<span class="c">#           load(_filename,struc)</span>
<span class="c">#           delay()</span>
<span class="c">#           save(_filename)</span>
<span class="c">#           reverse(struc)</span>
<span class="c">#           show()</span>
<span class="c">#           show3()</span>
<span class="c">#</span>
<span class="c"># A Faire :</span>
<span class="c">#</span>
<span class="c">#    Finir de coder les Ã©valuations d&#39;interaction</span>
<span class="c">#    Construire le pont entre Ray3D et RayTud  ( Validation )</span>
<span class="c">#        equivalent de tra2tud</span>
<span class="c">#               CreateRays_TudFile2 dans Tud/Tud_rayon.c</span>
<span class="c">#               GetRayonsParam()</span>
<span class="c">#</span>
<span class="c">#    1 ) Lire simultanÃ©ment .tra .tud .field et visualiser le tout</span>
<span class="c">#    2 ) Passer de .tra --&gt; .tud</span>
<span class="c">#    3 ) Passer de .tud --&gt; .field</span>
<span class="c">#</span>
<span class="c">#class Interaction(object):</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#       Interaction coefficient</span>
<span class="c">#       &quot;&quot;&quot;</span>
<span class="c">#         def __init__(self,intpara,freq):</span>
<span class="c">#        self.intpara=intpara</span>
<span class="c">#        Nf = len(freq)</span>
<span class="c">#        self.Ci = np.array(np.zeros([Nf,2,2]))</span>
<span class="c">#    def eval(self,freq):</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        Evaluate Interaction Matrix</span>
<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        typ=self.inpara[0]</span>
<span class="c">#        if (typ==-1):</span>
<span class="c">#            self.Ci=intpara[1]</span>
<span class="c">#        elif (typ==0):</span>
<span class="c">#            dist = self.intpara[1]</span>
<span class="c">#            self.Ci=eye(2)/dist</span>
<span class="c">#        elif (typ==1):</span>
<span class="c">#            theta = self.intpara[1]</span>
<span class="c">#            Si    = self.intpara[2]</span>
<span class="c">#            Sr    = self.intpara[3]</span>
<span class="c">#            if (rho1 == 0.0):</span>
<span class="c">#                rho1  = 1/Si</span>
<span class="c">#                rho2  = 1/Si</span>
<span class="c">#</span>
<span class="c">#        #elif (typ==2):</span>
<span class="c">#        #elif (typ==3):</span>


<span class="k">class</span> <span class="nc">Inter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[],</span><span class="n">_filesimul</span><span class="o">=</span><span class="s">&#39;default.ini&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Meta class of specific interactions ( Interactions, IntB/IntL/IntT/intR/intD) </span>


<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        typ : int</span>
<span class="sd">            type of interaction</span>
<span class="sd">        data: np.array</span>
<span class="sd">            data for the interaction</span>
<span class="sd">        idx:</span>
<span class="sd">            idx number of the interaction between 0 and (ray number * inter number)</span>
<span class="sd">        f : np.array</span>
<span class="sd">            frequency range</span>
<span class="sd">        nf : int</span>
<span class="sd">            number of step into freq range</span>
<span class="sd">        olf : np.array</span>
<span class="sd">            np.ones((nf)) used to broacasting</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span>


        <span class="c">## The config parser load is done in order to :</span>
        <span class="c">## All IntB/IntL/IntR/IntT/... inherits of the correct</span>
        <span class="c">## self.frequency from the Interaction class !</span>
        <span class="c">## It could be interesting to find another trick which</span>
        <span class="c">## avoid to give a filesimulname.</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">filesimul</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesimul</span><span class="p">,</span> <span class="s">&quot;ini&quot;</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filesimul</span><span class="p">)</span>

        <span class="c">## frequency load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="s">&quot;fghzmin&quot;</span><span class="p">))</span>
                          <span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="s">&quot;fghzmax&quot;</span><span class="p">))</span>
                          <span class="p">,</span><span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;frequency&quot;</span><span class="p">,</span> <span class="s">&quot;nf&quot;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">olf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>

        <span class="c">## slabDB load</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="o">=</span><span class="n">SlabDB</span><span class="p">(</span><span class="n">filemat</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span> <span class="s">&quot;mat&quot;</span><span class="p">),</span>
                    <span class="n">fileslabini</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;files&quot;</span><span class="p">,</span> <span class="s">&quot;slab&quot;</span><span class="p">))</span>




        <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            calculate delays of a given basis Interaction</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])))</span>



    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        stack data and the associated idx</span>

<span class="sd">        Attributes:</span>
<span class="sd">        ----------</span>
<span class="sd">            a : np.array()</span>
<span class="sd">                data to stack</span>
<span class="sd">            idx : </span>
<span class="sd">                index to stack</span>
<span class="sd">            data: bool</span>
<span class="sd">                False if you just want to stack idx (only used for intE class )</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; I=Inter()</span>
<span class="sd">        &gt;&gt;&gt; data = np.array(([3,4,5]))</span>
<span class="sd">        &gt;&gt;&gt; idx = 0</span>
<span class="sd">        &gt;&gt;&gt; I.stack(data,idx)</span>
<span class="sd">        &gt;&gt;&gt; I.data</span>
<span class="sd">        array([3, 4, 5])</span>
<span class="sd">        &gt;&gt;&gt; I.idx</span>
<span class="sd">        [0]</span>
<span class="sd">        &gt;&gt;&gt; data = np.array(([3,4,5],[7,8,9]))</span>
<span class="sd">        &gt;&gt;&gt; idx = [1,2]</span>
<span class="sd">        &gt;&gt;&gt; I.stack(data,idx)</span>
<span class="sd">        &gt;&gt;&gt; I.data</span>
<span class="sd">        array([[3, 4, 5],</span>
<span class="sd">               [3, 4, 5],</span>
<span class="sd">               [7, 8, 9]])</span>
<span class="sd">        &gt;&gt;&gt; I.idx</span>
<span class="sd">        [0, 1, 2]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">idx</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">a</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">=</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Issue in Inter.stack&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">ii</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>



<div class="viewcode-block" id="Interactions"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Interactions">[docs]</a><span class="k">class</span> <span class="nc">Interactions</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Interaction parameters</span>
<span class="sd">        gather all basis interactions (IntB/L/R/T)</span>

<span class="sd">        Methods</span>
<span class="sd">        -------</span>
<span class="sd">        add(self,li): add a list of basis interatcions</span>
<span class="sd">        addi(self,i): add a single interaction</span>
<span class="sd">        eval(self) : evaluate all the interactions added thanks to self.add or self.addi</span>
<span class="sd">                     and create the self.I which gather all thoses interactions</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        5 types of interactions</span>
<span class="sd">        B : local basis transformation matrix (unitary)</span>
<span class="sd">        L : LOS case</span>
<span class="sd">        R : Reflection</span>
<span class="sd">        T : Transmission</span>
<span class="sd">        D : Diffraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">=</span><span class="bp">False</span>



<div class="viewcode-block" id="Interactions.add"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Interactions.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">li</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a list of interactions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        li :</span>
<span class="sd">            list of interactions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">li</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Interactions.addi"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Interactions.addi">[docs]</a>    <span class="k">def</span> <span class="nf">addi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Add interactions as a member of Interactions class</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;B&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;B&#39;</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;L&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;L&#39;</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;R&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;R&#39;</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;T&#39;</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="s">&#39;D&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;D&#39;</span>

</div>
<div class="viewcode-block" id="Interactions.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Interactions.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            evaluate all the interactions</span>

<span class="sd">        Outputs:</span>
<span class="sd">        --------</span>
<span class="sd">        self.I :np.shape(self.I) = self.nf,self.nimax,2,2</span>
<span class="sd">            with self.nf = number of frequences</span>
<span class="sd">                 self.nimax : the total number of interaction ( of all rays)</span>

<span class="sd">        self.sout :</span>
<span class="sd">            distance from interaction to the next one</span>
<span class="sd">        self.si0 :</span>
<span class="sd">            distance from the previous interaction to the the considered one</span>
<span class="sd">        self.alpha :</span>
<span class="sd">            alpha as described into Legendre Thesis</span>
<span class="sd">        self.gamma :</span>
<span class="sd">            !! gamma**2 !!! (squared included) as described into J.F Legendre Thesis</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Instanciate the global I matrix which gathered all interactions</span>
        <span class="c"># into a single np.array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nimax</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>


        <span class="c"># evaluate B and fill I</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">idx</span><span class="p">,:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">sout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">si0</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># evaluate L and fill I</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">idx</span><span class="p">,:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">sout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">si0</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># evaluate R and fill I</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">idx</span><span class="p">,:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">sout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">si0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">gamma</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c"># evaluate T and fill I</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">idx</span><span class="p">,:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">si0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">gamma</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c"># .. todo</span>
        <span class="c"># evaluate D and fill I</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">idx</span><span class="p">,:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">sout</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">si0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">idx</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">.</span><span class="n">gamma</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">=</span><span class="bp">True</span>

</div></div>
<div class="viewcode-block" id="IntB"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntB">[docs]</a><span class="k">class</span> <span class="nc">IntB</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Local Basis interaction class</span>

<span class="sd">        Basis interactions</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>

<span class="sd">            data : np.array:</span>
<span class="sd">                WARNING np.shape(data) = (ninter x 4)</span>
<span class="sd">                the input matrix 2x2 is rehaped as 1x 4</span>


<span class="sd">            idx : list</span>
<span class="sd">                index of the corresponding ray and interaction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        np.array:</span>
<span class="sd">            (nf,ninter 2, 2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[]):</span>

        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="n">typ</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>


<div class="viewcode-block" id="IntB.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntB.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            evaluation of B interactions</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">        &gt;&gt;&gt; M = np.eye(2).reshape(4)</span>
<span class="sd">        &gt;&gt;&gt; B = IntB(M,0)</span>
<span class="sd">        &gt;&gt;&gt; B.data</span>
<span class="sd">        array([ 1.,  0.,  0.,  1.])</span>
<span class="sd">        &gt;&gt;&gt; B.stack(M,1)</span>
<span class="sd">        &gt;&gt;&gt; B.data</span>
<span class="sd">        array([[ 1.,  0.,  0.,  1.],</span>
<span class="sd">               [ 1.,  0.,  0.,  1.]])</span>
<span class="sd">        &gt;&gt;&gt; eB=B.eval()</span>
<span class="sd">        &gt;&gt;&gt; nf = B.nf</span>
<span class="sd">        &gt;&gt;&gt; ninter = len(B.idx)</span>
<span class="sd">        &gt;&gt;&gt; np.shape(eB)</span>
<span class="sd">        (181, 2, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; B.delay</span>
<span class="sd">        array([ 0.,  0.])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lidx</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">lidx</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">olf</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:,:])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no B interaction to evaluate&#39;</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>




</div></div>
<div class="viewcode-block" id="IntL"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntL">[docs]</a><span class="k">class</span> <span class="nc">IntL</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loss interaction</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>

<span class="sd">            data : np.array((ninter x [dist]))</span>
<span class="sd">            idx : list</span>
<span class="sd">                index of the corresponding ray and interaction</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        np.array:</span>
<span class="sd">            (nf ,ninter, 2, 2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[]):</span>
        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<div class="viewcode-block" id="IntL.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntL.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            evaluation of B interactions</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">        &gt;&gt;&gt; d = np.array(([3]))</span>
<span class="sd">        &gt;&gt;&gt; L = IntL(d,0)</span>
<span class="sd">        &gt;&gt;&gt; L.data</span>
<span class="sd">        array([3])</span>
<span class="sd">        &gt;&gt;&gt; L.stack(d+3,1)</span>
<span class="sd">        &gt;&gt;&gt; L.data</span>
<span class="sd">        array([[3],</span>
<span class="sd">               [6]])</span>
<span class="sd">        &gt;&gt;&gt; eL=L.eval()</span>
<span class="sd">        &gt;&gt;&gt; ninter = len(L.idx)</span>
<span class="sd">        &gt;&gt;&gt; nf = L.nf</span>
<span class="sd">        &gt;&gt;&gt; np.shape(eL)</span>
<span class="sd">        (181, 2, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; L.delay</span>
<span class="sd">        array([ 10.,  20.])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c"># it means that self.data is not a matrix but a number</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="c">## Friis formula</span>
<span class="c">#            self.data=self.data[:,0]</span>
<span class="c">#            dis = (0.3 / (4*np.pi*self.data[np.newaxis,:]*self.f[:,np.newaxis]))</span>
<span class="c">#            return(dis[:,:,np.newaxis,np.newaxis]*self.E[np.newaxis,np.newaxis,:,:])</span>
<span class="c">#            dis = self.data</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">olf</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no L interaction to evaluate&#39;</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="IntR"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntR">[docs]</a><span class="k">class</span> <span class="nc">IntR</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Reflexion interaction class</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[]</span> <span class="p">):</span>
<span class="c">#        self.theta = data[0]</span>
<span class="c">#        self.si = data[1]</span>
<span class="c">#        self.sr = data[2]</span>
        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c">## index for used slab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># dictionnary of used slab key = slab value = index of self.idx </span>
        <span class="c"># WARNING The index of this dictionnary referes to the idex of self.idx</span>
        <span class="c"># not to the global indx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>



<div class="viewcode-block" id="IntR.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntR.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        evaluation of Reflexion interactions</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>

<span class="sd">        data = np.array((ninter x [theta,si,st]))</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>

<span class="sd">        # generate input data</span>
<span class="sd">        &gt;&gt;&gt; theta1 = 0.1</span>
<span class="sd">        &gt;&gt;&gt; theta2 = 0.4</span>
<span class="sd">        &gt;&gt;&gt; si01 = 4</span>
<span class="sd">        &gt;&gt;&gt; si02 = 0.6</span>
<span class="sd">        &gt;&gt;&gt; sir1 = 3.15</span>
<span class="sd">        &gt;&gt;&gt; sir2 = 3.4</span>
<span class="sd">        &gt;&gt;&gt; data1=np.array((theta1,si01,sir1))</span>
<span class="sd">        &gt;&gt;&gt; data2=np.array((theta2,si02,sir2))</span>

<span class="sd">        # store input data to Instance</span>
<span class="sd">        &gt;&gt;&gt; R = IntR(data1,idx=0)</span>
<span class="sd">        &gt;&gt;&gt; R.data</span>
<span class="sd">        array([ 0.1 ,  4.  ,  3.15])</span>
<span class="sd">        &gt;&gt;&gt; R.stack(data2,idx=1)</span>
<span class="sd">        &gt;&gt;&gt; R.uslidx=1</span>
<span class="sd">        &gt;&gt;&gt; R.dusl[&#39;WOOD&#39;]=[0,1]</span>

<span class="sd">        # evaluation parameters (normally read from config.ini)</span>
<span class="sd">        &gt;&gt;&gt; R.f = np.array([  2.,  11.])</span>
<span class="sd">        &gt;&gt;&gt; R.nf = len(R.f)</span>
<span class="sd">        &gt;&gt;&gt; R.olf = np.ones((R.nf))</span>

<span class="sd">        # evaluation</span>
<span class="sd">        &gt;&gt;&gt; eR=R.eval()</span>

<span class="sd">        # examples</span>
<span class="sd">        &gt;&gt;&gt; ninter = len(R.idx)</span>
<span class="sd">        &gt;&gt;&gt; np.shape(eR)</span>
<span class="sd">        (181, 2, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; eR[0,0,0]</span>
<span class="sd">        array([-0.06412945+0.15756758j,  0.00000000+0.j        ])</span>
<span class="sd">        &gt;&gt;&gt; R.delay</span>
<span class="sd">        array([ 13.33333333,   2.        ])</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mapp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c"># loop on all type of materials used for reflexion</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c">#used theta of the given slab</span>
                <span class="n">ut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
                <span class="c"># find the index of angles which satisfied the data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">ut</span><span class="p">,</span><span class="n">RT</span><span class="o">=</span><span class="s">&#39;R&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">R</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">R</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">R</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">mapp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">R</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">R</span>
                    <span class="n">mapp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
            <span class="c"># replace in correct order the reflexion coeff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">mapp</span><span class="p">)),:,:]</span><span class="o">=</span><span class="n">R</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;no R interaction to evaluate&#39;</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>




</div></div>
<div class="viewcode-block" id="IntT"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntT">[docs]</a><span class="k">class</span> <span class="nc">IntT</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Transmission  interaction class</span>

<span class="sd">        self.d        Attribute</span>
<span class="sd">        ---------</span>
<span class="sd">        data = np.array((ninter x [theta,si,st]))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[]):</span>

        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">## index for used slab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># dictionnary of used slab key = slab value = index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="p">[]</span>

<div class="viewcode-block" id="IntT.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntT.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        example given for </span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>

<span class="sd">        # generate input data</span>
<span class="sd">        &gt;&gt;&gt; theta1 = 0.1</span>
<span class="sd">        &gt;&gt;&gt; theta2 = 0.4</span>
<span class="sd">        &gt;&gt;&gt; si01 = 4</span>
<span class="sd">        &gt;&gt;&gt; si02 = 0.6</span>
<span class="sd">        &gt;&gt;&gt; sir1 = 3.15</span>
<span class="sd">        &gt;&gt;&gt; sir2 = 3.4</span>
<span class="sd">        &gt;&gt;&gt; data1=np.array((theta1,si01,sir1))</span>
<span class="sd">        &gt;&gt;&gt; data2=np.array((theta2,si02,sir2))</span>

<span class="sd">        # store input data to Instance</span>
<span class="sd">        &gt;&gt;&gt; T = IntT(data1,idx=0)</span>
<span class="sd">        &gt;&gt;&gt; T.data</span>
<span class="sd">        array([ 0.1 ,  4.  ,  3.15])</span>
<span class="sd">        &gt;&gt;&gt; T.stack(data2,idx=1)</span>
<span class="sd">        &gt;&gt;&gt; T.uslidx=1</span>
<span class="sd">        &gt;&gt;&gt; T.dusl[&#39;WOOD&#39;]=[0,1]</span>

<span class="sd">        # evaluation parameters (normally read from config.ini)</span>
<span class="sd">        &gt;&gt;&gt; T.f = np.array([  2.,  11.])</span>
<span class="sd">        &gt;&gt;&gt; T.nf = len(T.f)</span>
<span class="sd">        &gt;&gt;&gt; T.olf = np.ones((T.nf))</span>

<span class="sd">        # evaluation</span>
<span class="sd">        &gt;&gt;&gt; eT=T.eval()</span>

<span class="sd">        # examples</span>
<span class="sd">        &gt;&gt;&gt; ninter = len(T.idx)</span>
<span class="sd">        &gt;&gt;&gt; np.shape(eT)</span>
<span class="sd">        (181, 2, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; eT[0,0]</span>
<span class="sd">        array([[ 0.43318949-0.87334289j, -0.00000000+0.j        ],</span>
<span class="sd">               [-0.00000000+0.j        ,  0.43247609-0.87414221j]])</span>
<span class="sd">        &gt;&gt;&gt; T.delay()</span>
<span class="sd">        array([ 13.33333333,   2.        ])</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idx</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">mapp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c">#used theta of the given slab</span>
                <span class="n">ut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>

                <span class="c"># get alpha and gamma for divergence factor</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s">&#39;lmat&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;Warning : IntR class implemented for mat with only 1 layer &#39;</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="s">&#39;lmat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;epr&#39;</span><span class="p">]]))</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ut</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">))</span>
                <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ut</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ut</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">alpha</span><span class="p">,</span><span class="n">a</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">gamma</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">gamma</span><span class="p">,</span><span class="n">g</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
<span class="c">#                    print &#39;Warning : alpha or gamma fail&#39;</span>
                    <span class="n">alpha</span><span class="o">=</span> <span class="n">a</span> 
                    <span class="n">gamma</span><span class="o">=</span> <span class="n">g</span>

                <span class="c"># find the index of angles which satisfied the data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">ev</span><span class="p">(</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="n">ut</span><span class="p">,</span><span class="n">RT</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="n">compensate</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">T</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">T</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">mapp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">slab</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">mapp</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
            <span class="c"># replace in correct order the Transmission coeff</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">mapp</span><span class="p">)),:,:]</span><span class="o">=</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">mapp</span><span class="p">))]</span><span class="o">=</span><span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">mapp</span><span class="p">))]</span><span class="o">=</span><span class="n">gamma</span>
<span class="c">#            self.sm[np.array((mapp))]=sm</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no T interaction to evaluate&#39;</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>






</div></div>
<div class="viewcode-block" id="IntD"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.IntD">[docs]</a><span class="k">class</span> <span class="nc">IntD</span><span class="p">(</span><span class="n">Inter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Diffraction interaction class</span>
<span class="sd">        .. todo to be implemented</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span><span class="n">idx</span><span class="o">=</span><span class="p">[]):</span>
<span class="c">#        self.theta = data1[0]</span>
<span class="c">#        self.thetad = data1[1]</span>
<span class="c">#        self.si = data1[2]</span>
<span class="c">#        self.sd = data1[3]</span>
<span class="c">#        self.beta = data1[4]</span>
<span class="c">#        self.N = data1[5]</span>
<span class="c">#        self.typed = data2[0]</span>
        <span class="n">Inter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;not yet implemented&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;no D interaction to evaluate&#39;</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Ray2D"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray2D">[docs]</a><span class="k">class</span> <span class="nc">Ray2D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; 2D Ray class</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nn      :</span>
<span class="sd">        number of nodes (number of interactions + 2)</span>
<span class="sd">    pt      :</span>
<span class="sd">        point coordinates</span>
<span class="sd">    signature   :</span>
<span class="sd">        (new name for nstr)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">signature</span><span class="p">):</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="Ray3D"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D">[docs]</a><span class="k">class</span> <span class="nc">Ray3D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ray3D class</span>

<span class="sd">    This class handles a 3D ray</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nn      : int</span>
<span class="sd">        number of nodes (number of interaction + 2)</span>
<span class="sd">    pt      : np.array</span>
<span class="sd">        point coordinates</span>
<span class="sd">    nstr    : element of a signature</span>
<span class="sd">        structure number (&gt;0 edge) (&lt;0 node) (0 Tx or Rx)</span>
<span class="sd">    deep    : int</span>
<span class="sd">    beta0   : float</span>
<span class="sd">    phii    : float</span>
<span class="sd">    phid    : float</span>
<span class="sd">    length  : float</span>
<span class="sd">    Bi   : interaction input basis    shape=( nn,3,3)</span>
<span class="sd">    Bo   : intercation output basis   shape=( nn,3,3)</span>

<span class="sd">    Bi(l,:,0) = s_in</span>
<span class="sd">    Bi(l,:,1) = etheta_in</span>
<span class="sd">    Bi(l,:,2) = ephi_in</span>

<span class="sd">    Bo(l,:,0) = s_out</span>
<span class="sd">    Bo(l,:,1) = etheta_out</span>
<span class="sd">    Bo(l,:,2) = ephi_out</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    show3(bdis=True,col=np.array([1,0,1]),id=0) : geomview visualization</span>
<span class="sd">    info()  : Ray information</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Ray3D.info"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Number of nodes : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;points : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;nstr   : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">nstr</span>
        <span class="k">print</span> <span class="s">&quot;B in     : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span>
        <span class="k">print</span> <span class="s">&quot;B out    : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span>
        <span class="k">print</span> <span class="s">&quot;AOD : &quot;</span>
        <span class="k">print</span> <span class="s">&quot;thetat (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tht</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;phit   (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pht</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;AOA : &quot;</span>
        <span class="k">print</span> <span class="s">&quot;thetar (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thr</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;phir   (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phr</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ray3D.locbas"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D.locbas">[docs]</a>    <span class="k">def</span> <span class="nf">locbas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluation of local basis over the ray</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        L : Layout Structure Graph</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            evaluate Bi and Bo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># initialize RayTud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span> <span class="o">=</span> <span class="n">RayTud</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span>
        <span class="c">#</span>
        <span class="c"># si : (N-1,3)</span>
        <span class="c">#</span>
        <span class="c">#si  = np.array(np.zeros([nn-1,3],dtype=np.float64))</span>
        <span class="c">#lsi = np.array(np.zeros(nn-1,dtype=np.float64))</span>
        <span class="c">#</span>
        <span class="c"># Calcul des vecteurs unitaires si</span>
        <span class="c"># .. todo:: remove this for loop</span>
        <span class="c">#   not tested</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c"># reshape is required for broadcasting</span>
        <span class="n">lsir</span> <span class="o">=</span> <span class="n">lsi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">lsir</span>
        <span class="c">#for k in range(nn-1):</span>
        <span class="c">#    v  = self.pt[k+1,:]-self.pt[k,:]</span>
        <span class="c">#    nv = np.sqrt(np.dot(v,v))</span>
        <span class="c">#    try:</span>
        <span class="c">#        si[k,:]  = v/nv</span>
        <span class="c">#        lsi[k,:] = nv</span>
        <span class="c">#    except:</span>
        <span class="c">#        print(&quot;error divide by 0 in Ray3D.geom &quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

        <span class="n">nint</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="c">#</span>
        <span class="c"># Repere de sortie du Tx</span>
        <span class="c">#</span>

        <span class="n">BoO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">eth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)])</span>
        <span class="n">eph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> 
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> 
                        <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">Bo0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">eth</span><span class="p">,</span> <span class="n">eph</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Bo0</span>
        <span class="c">#</span>
        <span class="c"># Ray AOD</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tht</span> <span class="o">=</span> <span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pht</span> <span class="o">=</span> <span class="n">ph</span>
        <span class="c">#</span>
        <span class="c"># Repere d&#39;entree du Rx</span>
        <span class="c">#</span>
        <span class="c"># On impose que le vecteur unitaire d&#39;entree sur</span>
        <span class="c"># le recepteur soit confondu avec le vecteur unitaire</span>
        <span class="c"># de sortie de la derniere interaction</span>
        <span class="c">#</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">eth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)])</span>
        <span class="n">eph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">Bini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">eth</span><span class="p">,</span> <span class="n">eph</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">nint</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Bini</span>
        <span class="c">#</span>
        <span class="c"># Ray AOA</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">ph</span>
        <span class="c">#</span>
        <span class="c"># loop over the nn-2 interactions</span>
        <span class="c">#</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">nstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c">#</span>
            <span class="c"># Retrieve the interaction vector</span>
            <span class="c">#   normal (R or T) or edge direction (D)</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="n">nstr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># if wall</span>
                <span class="k">if</span> <span class="n">nstr</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span><span class="p">:</span>
                    <span class="n">vn</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nstr</span><span class="p">][</span><span class="s">&#39;norm&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c"># if ceil or floor</span>
                    <span class="k">if</span> <span class="n">nstr</span> <span class="o">==</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c"># ceil</span>
                        <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">nstr</span> <span class="o">==</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c"># floor</span>
                        <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># diffaction</span>
                <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>

            <span class="c"># .. todo:: regler le proble de nstr sur rayon 358 : sircut.str</span>
            <span class="c">#try:</span>
            <span class="c">#    ps = np.dot(vn,si[l,:])</span>
            <span class="c">#except:</span>
            <span class="c">#    pdb.set_trace()</span>
            <span class="c">#</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:])</span>
            <span class="c"># Si Reflexion ou Transmission inversion signe normale si.n &lt;0</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">vn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">vn</span>
            <span class="c">#</span>
            <span class="c"># Si si et n sont colineaires, le plan d&#39;incidence n&#39;est pas defini</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-7</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s_in</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">pvecn</span><span class="p">(</span><span class="n">s_in</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s_in</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s_in</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">M</span>
                <span class="n">s_out</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">pvecn</span><span class="p">(</span><span class="n">s_out</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s_out</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s_out</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">M</span>
            <span class="c">#</span>
            <span class="c"># Create interaction</span>
            <span class="c"># see GetRayonPram de tratotud.c</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c"># Reflexion</span>
                <span class="c">#theta  = np.arccos(abs(ps))  &#39;validated&#39;</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siR</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">srR</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntR</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">siR</span><span class="p">,</span> <span class="n">srR</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c"># Transmission</span>
                <span class="c">#theta  = np.arccos(abs(ps))  &#39;validated&#39;</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siT</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">srT</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntT</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">siT</span><span class="p">,</span> <span class="n">srT</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c"># Diffraction</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">thetad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siD</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">sdD</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="c">#</span>
                <span class="c"># Attributes for nst &lt;0 of L.Gs</span>
                <span class="c">#</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">typed</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntD</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">thetad</span><span class="p">,</span> <span class="n">siD</span><span class="p">,</span> <span class="n">sdD</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="p">[</span><span class="n">typed</span><span class="p">])</span>
            <span class="c">#</span>
            <span class="c"># add a new interaction in raytud object</span>
            <span class="c">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Insert rotation matrices between interaction</span>
        <span class="c">#</span>
        <span class="c"># M = np.zeros((nn-1,2,2))</span>
        <span class="c">#gt.inter.append(I=[)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">::]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">::])</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">IntB</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="c">#M[k,:,:] = np.dot(self.Bo[k,:,1::].T,self.Bi[k,:,1::])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">ni</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="c">#def show3(self,bdis=True,bbas=False,col=np.array([1,0,1]),id=0):</span>
</div>
<div class="viewcode-block" id="Ray3D.delay"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delay</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        delay : float</span>
<span class="sd">            delay in ns for each segment of the ray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">::,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">ph</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ray3D.show"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">col</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a Ray projection in 2D</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>


        <span class="n">Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">::,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nseg</span><span class="p">):</span>
            <span class="n">pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pz</span><span class="p">,</span> <span class="n">pt</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ph</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">pn</span><span class="p">))</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nseg</span><span class="p">)),</span> <span class="n">m1</span><span class="p">)</span>
        <span class="n">pzz</span> <span class="o">=</span> <span class="n">pz</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">pzz</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s">&#39;ok&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Ray3D.show3"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.Ray3D.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filestr</span><span class="o">=</span><span class="s">&#39;defstr&#39;</span><span class="p">,</span><span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bbas</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bstruc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3(bdis=True,bbas=False,bstruc=True,col=np.array([1,0,1]),id=0)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bdis :</span>
<span class="sd">            display boolean - if False return .vect filename</span>
<span class="sd">        bbas :</span>
<span class="sd">            display local basis</span>
<span class="sd">        bstruc :</span>
<span class="sd">            display structure</span>
<span class="sd">        col  :</span>
<span class="sd">            color of the ray</span>
<span class="sd">        id   :</span>
<span class="sd">            id of the ray</span>
<span class="sd">        linewidth :</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filerac</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;ray&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">_filerac</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filerac</span><span class="p">)</span>
        <span class="n">filename_list</span> <span class="o">=</span> <span class="n">filerac</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">filename_vect</span> <span class="o">=</span> <span class="n">filerac</span> <span class="o">+</span> <span class="s">&#39;.vect&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_vect</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;appearance { linewidth </span><span class="si">%d</span><span class="s"> }</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">linewidth</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VECT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1 </span><span class="si">%d</span><span class="s"> 1</span><span class="se">\n\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span>
                                                            <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c">#fo.write(&quot;%d %d %d 0\n&quot; % (col[0],col[1],col[2]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> 0</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Ajout des bases locales</span>
        <span class="c">#</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_list</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">filename_vect</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bstruc</span><span class="p">):</span>
            <span class="c">#fo.write(&quot;{&lt;strucTxRx.off}\n&quot;)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt;&quot;</span> <span class="o">+</span><span class="n">_filestr</span> <span class="o">+</span><span class="s">&quot;.off}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bbas</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ptb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">fibi</span> <span class="o">=</span> <span class="n">_filerac</span> <span class="o">+</span> <span class="s">&quot;Bi&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">vfibi</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="n">fibi</span><span class="p">)</span>
                <span class="n">colbi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
                <span class="n">vfibi</span><span class="o">.</span><span class="n">geomBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ptb</span><span class="p">,</span> <span class="n">colbi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">fibo</span> <span class="o">=</span> <span class="n">_filerac</span> <span class="o">+</span> <span class="s">&quot;Bo&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">vfibo</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="n">fibo</span><span class="p">)</span>
                <span class="n">colbo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">vfibo</span><span class="o">.</span><span class="n">geomBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ptb</span><span class="p">,</span> <span class="n">colbo</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">fibi</span> <span class="o">+</span> <span class="s">&quot;.vect&quot;</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">fibo</span> <span class="o">+</span> <span class="s">&quot;.vect&quot;</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_list</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
        <span class="c">#</span>
        <span class="c"># Geomview Visualisation</span>
        <span class="c">#</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview -nopanel -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> \
                <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="RayTud"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.RayTud">[docs]</a><span class="k">class</span> <span class="nc">RayTud</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ray Tud</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    ni      :</span>
<span class="sd">        number of interactions</span>
<span class="sd">    inter   :</span>
<span class="sd">        Interaction object</span>
<span class="sd">    C       :</span>
<span class="sd">        Ray Transfer function matrix :  np.array(np.zeros([nf,2,2]),dtype=complex)</span>
<span class="sd">    nf      :</span>
<span class="sd">        number of frequencies</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    info         :</span>
<span class="sd">        Ray informations</span>
<span class="sd">    eval(f)      :</span>
<span class="sd">        Evaluate C tilde matrix for a set of frequencies</span>
<span class="sd">    comp(raytud) :</span>
<span class="sd">        comparaison de deux rayons Tud</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ni</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Number of interactions : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="n">nbi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbi</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Interaction : &quot;</span><span class="p">,</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>

<div class="viewcode-block" id="RayTud.delay"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.RayTud.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            calculate delay of the ray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nbi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbi</span><span class="p">):</span>
            <span class="c"># LOS</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dist</span>
            <span class="c"># Reflexion</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sr</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sr</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
            <span class="c"># Transmission</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">st</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">st</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
            <span class="c"># Diffraction</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sd</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sd</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
        <span class="k">return</span><span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RayTud.signature"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.RayTud.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns ray signature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Signature</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ni</span><span class="p">):</span>
            <span class="n">Signature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Signature</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RayTud.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.RayTud.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fGHz</span><span class="o">=</span><span class="p">[</span><span class="mf">2.4</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot; evaluate the field over the ray</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fGHz : ndarray</span>
<span class="sd">            frequency axis</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nf</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Co</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># Loop over all the ray interactions</span>
        <span class="c">#   + left matrix multiplication</span>
        <span class="c">#   + broadcasting along frequency axis</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ni</span><span class="p">):</span>
            <span class="n">I</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="n">Co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;kpq,kqr-&gt;kpr&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">Co</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="n">nf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">Co</span>

</div></div>
<div class="viewcode-block" id="GrRayTud"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud">[docs]</a><span class="k">class</span> <span class="nc">GrRayTud</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  a cluster of Rays in Tud format </span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nray    : number of rayTud</span>

<span class="sd">    rayTud  : list of RayTud object DEPRECATED</span>

<span class="sd">    I : class interaction which contrinats all the interactionn of The</span>
<span class="sd">        GrRayTud ( see class Interactions help)</span>

<span class="sd">    dli dictionnary of length of interaction.</span>
<span class="sd">        contains information about rays for a given interaction length</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    load(_filetud,sl)  : load from a .tud file</span>
<span class="sd">    eval()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c"># Interactions instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">Interactions</span><span class="p">()</span>
        <span class="c"># dictionnay of interaction legth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="o">=</span><span class="p">{}</span>



<div class="viewcode-block" id="GrRayTud.dir"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.dir">[docs]</a>    <span class="k">def</span> <span class="nf">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in tuddir</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfile_tud : list</span>
<span class="sd">            sorted list of all the .tud file of tuddir</span>
<span class="sd">        lfile_tang : list</span>
<span class="sd">            sorted list of all the .tang file of tuddir</span>
<span class="sd">        lfile_rang : list</span>
<span class="sd">            sorted list of all the .rang file of tuddir</span>
<span class="sd">        lfile_tauk : list</span>
<span class="sd">            sorted list of all the .tauk file of tuddir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tuddir is defined in the Project module</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">        &gt;&gt;&gt; g = GrRay3D()</span>
<span class="sd">        &gt;&gt;&gt; tud,tang,rang,tauk  = g.dir()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">tuddir</span> <span class="o">+</span> <span class="s">&#39;/*.tud&#39;</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tud</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tud</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tud</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">tuddir</span> <span class="o">+</span> <span class="s">&#39;/*.tang&#39;</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tang</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tang</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">tuddir</span> <span class="o">+</span> <span class="s">&#39;/*.rang&#39;</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_rang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_rang</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_rang</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">tuddir</span> <span class="o">+</span> <span class="s">&#39;/*.tauk&#39;</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tauk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tauk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tauk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">lfile_tud</span><span class="p">,</span> <span class="n">lfile_tang</span><span class="p">,</span> <span class="n">lfile_rang</span><span class="p">,</span> <span class="n">lfile_tauk</span>
</div>
<div class="viewcode-block" id="GrRayTud.delay"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return ray delays in an array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GrRayTud.choose"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Choose a tud  file in tuddir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span>
        <span class="n">FD</span> <span class="o">=</span> <span class="n">tkFileDialog</span>
        <span class="n">filetud</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;Fichiers  &quot;</span><span class="p">,</span> <span class="s">&quot;*.tud&quot;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="s">&quot;All&quot;</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="p">)],</span>
                                     <span class="n">title</span><span class="o">=</span><span class="s">&quot;Please choose a Tracing file&quot;</span><span class="p">,</span>
                                     <span class="n">initialdir</span><span class="o">=</span><span class="n">tuddir</span><span class="p">)</span>
        <span class="n">_filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filetud</span><span class="p">)</span>
        <span class="n">tabc</span> <span class="o">=</span> <span class="n">_filetud</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">_filestr</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.str&#39;</span>
        <span class="n">_fileslab</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.slab&#39;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.mat&#39;</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>
        <span class="c">#indoor = Indoor(sl,_filestr)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">sl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GrRayTud.save"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filetud</span><span class="o">=</span><span class="s">&#39;ftud&#39;</span><span class="p">,</span> <span class="n">_filetang</span><span class="o">=</span><span class="s">&#39;ftang&#39;</span><span class="p">,</span> <span class="n">_filerang</span><span class="o">=</span><span class="s">&#39;frang&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            save .tud .tang .rang</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            _filetud  :</span>
<span class="sd">            _filetang :</span>
<span class="sd">            _filerang :</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filetang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetang</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">filerang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filerang</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">])</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetud</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">rk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">ni</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">ni</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">rk</span><span class="o">.</span><span class="n">inter</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;4d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;3d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">sr</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;3d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;6d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">thetad</span><span class="p">,</span>
                                   <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typed</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;8i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                               <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetang</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">,</span> <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filerang</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;2d&#39;</span><span class="p">,</span> <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="GrRayTud.load"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filetud</span><span class="p">,</span> <span class="n">_filetang</span><span class="p">,</span> <span class="n">_filerang</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load a set of Ray from the PulsRay .tud file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename  : tud filename</span>
<span class="sd">        _filetang  : tang filename</span>
<span class="sd">        _filerang  : rang filename</span>
<span class="sd">        sl         : slab database object</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        a filename beginning with _ is a short filename</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        </span>
<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.rays import *</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valerr</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filetang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetang</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filerang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filerang</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTUD&#39;</span><span class="p">])</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetud</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nimax</span><span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span><span class="o">=</span> <span class="mi">0</span>
        <span class="c">## in order to inialize all type of interaction with the correct frequencies</span>

        <span class="n">B</span><span class="o">=</span><span class="n">IntB</span><span class="p">()</span>
        <span class="n">L</span><span class="o">=</span><span class="n">IntL</span><span class="p">()</span>
        <span class="n">R</span><span class="o">=</span><span class="n">IntR</span><span class="p">()</span>
        <span class="n">T</span><span class="o">=</span><span class="n">IntT</span><span class="p">()</span>
        <span class="n">D</span><span class="o">=</span><span class="n">IntD</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mapp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">nir</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">raytud</span> <span class="o">=</span> <span class="n">RayTud</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c">#</span>
            <span class="c"># Interaction number over the ray</span>
            <span class="c">#</span>
            <span class="c"># if ni==0  : LOS case no interaction</span>
            <span class="c">#</span>
            <span class="n">nbint</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nbi</span><span class="o">=</span><span class="n">nbint</span>
<span class="c">#            raytud.ni = nbint</span>
<span class="c">#            Inter = []</span>


            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbint</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">caract</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">decal</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">caract</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="c"># check if first interaction is a IntB.</span>
                        <span class="c"># if not, itthis first interaction is forced to be </span>
                        <span class="c"># an identity matrix</span>
                        <span class="n">M</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">index</span><span class="p">)</span><span class="c">#inter = IntB(M)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">B</span><span class="o">=</span><span class="n">IntB</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                        <span class="c"># because this id matrix, the ray has 1 extra interaction</span>
                        <span class="c"># so we need to </span>
                        <span class="c"># 1.create the correct key dictionnary </span>
                        <span class="c"># 2.remap the index</span>
                        <span class="c"># 3. use another varaible loop (ii) incremented </span>

                        <span class="n">nbi</span><span class="o">=</span><span class="n">nbi</span><span class="o">+</span><span class="mi">1</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nbi</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;nbrays&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;nbrays&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">k</span><span class="p">]))))</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">nbi</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;nbrays&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">k</span><span class="p">]))</span>


                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">nbi</span><span class="p">))))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">nbi</span><span class="p">))</span>


                    <span class="k">if</span> <span class="n">nbi</span> <span class="o">!=</span> <span class="n">nbint</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">index</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mapp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mapp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
                        <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">decal</span><span class="o">=</span><span class="bp">True</span>


                <span class="c"># decal = True if an extra B interaction is added at the begining</span>
                <span class="c"># of the ray</span>
                <span class="k">if</span> <span class="n">decal</span> <span class="p">:</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">index</span>
                <span class="c"># B interaction</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">32</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;4d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">index</span><span class="p">)</span><span class="c">#inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;except B&#39;</span>
                        <span class="n">B</span><span class="o">=</span><span class="n">IntB</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">M</span><span class="p">,</span><span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c">#                   M = np.array([[m[0], m[1]], [m[2], m[3]]])</span>
<span class="c">#                    inter = IntB(M)</span>
            <span class="c">#        inter.data = M</span>

                <span class="c"># Los Interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dist</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">L</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">index</span><span class="p">)</span><span class="c">#inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;except L&#39;</span>
                        <span class="n">L</span><span class="o">=</span><span class="n">IntL</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c">#                    inter = IntL(dist[0])</span>
            <span class="c">#        inter.data = dist</span>

                <span class="c"># Reflexion Interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">24</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datR</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;3d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dat</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">datR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">datR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">datR</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">index</span><span class="p">)</span><span class="c">#inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;except R&#39;</span>
                        <span class="n">R</span><span class="o">=</span><span class="n">IntR</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>
<span class="c">#                    inter = IntR(datR)</span>
<span class="c">#            #        inter.data = datR</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>

                <span class="c"># Transmission interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">24</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datT</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;3d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">datT</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">datT</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">datT</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&#39;except T&#39;</span>
                        <span class="n">T</span><span class="o">=</span><span class="n">IntT</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c">#                    inter = IntT(datT)</span>
<span class="c">#            #        inter.data = datT</span>


                <span class="c"># Diffraction interaction</span>
<span class="c">######################## TODO AFTER THIS POINT !!!!!!!!!!!!!!</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s">&#39;catratct 3&#39;</span>
            <span class="c">#        inter.data = []</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">48</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datD</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;6d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="c">#            #        (inter.data).append(datD)</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">typD</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c">#                    inter = IntD(datD, typD)</span>
<span class="c">#            #        (inter.data).append(typD)</span>


                <span class="n">nir</span> <span class="o">=</span> <span class="n">nir</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">32</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">datMat</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;8i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="n">l2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">r2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

<span class="c">#  if interaction is reflexion or transmission</span>
<span class="c">#                if caract == 1 or caract == 2 or caract == 3:</span>


                    <span class="c">## find corresponding name</span>
<span class="c">#                    slname = self.I.slab.di[slidx]</span>
<span class="c">#                    # if the material hasn&#39;t be evaluated before </span>
<span class="c">#                    if not self.I.slab[slname][&#39;evaluated&#39;]:</span>
<span class="c">#                        # evaluate it</span>
<span class="c">#                        print &quot;evaluate&quot;,slname</span>
<span class="c">#                        self.I.slab[slname].ev(fGHz=self.I.f, theta=self.I.t)</span>


                <span class="c">### fill slab index dictionnary for each type of interactions</span>

                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c">## read material index </span>

                    <span class="n">slidx</span> <span class="o">=</span> <span class="n">c1</span>
                    <span class="c">## find corresponding name</span>
                    <span class="n">slname</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">slab</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">slidx</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">uslidx</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">R</span><span class="o">.</span><span class="n">uslidx</span><span class="p">]</span>
                    <span class="n">R</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">slidx</span> <span class="o">=</span> <span class="n">c1</span>
                    <span class="n">slname</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">slab</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">slidx</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">uslidx</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">uslidx</span><span class="p">]</span>
                    <span class="n">T</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c"># in case of diffraction</span>
                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c">### the total number of interaction( for all rays)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nimax</span><span class="o">=</span><span class="n">index</span>
        <span class="c">### Add all type of interactions into the Interaction class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">B</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">D</span><span class="p">])</span>


</div>
<div class="viewcode-block" id="GrRayTud.ray"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.ray">[docs]</a>    <span class="k">def</span> <span class="nf">ray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Give the ray number and it retruns the index of its interactions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raypos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="s">&#39;rays&#39;</span><span class="p">][</span><span class="n">raypos</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="GrRayTud.typ"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.typ">[docs]</a>    <span class="k">def</span> <span class="nf">typ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            return the list of interaction type of a given ray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>



</div>
<div class="viewcode-block" id="GrRayTud.eval"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        evaluation of Ctilde</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&#39;GrRayTUD evaluation&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">evaluated</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span> <span class="c"># number of frequence</span>


        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c"># l stands for the number of interactions</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;nbrays&#39;</span><span class="p">]</span>
            <span class="c"># reshape in order to have a 1D list of insde</span>
            <span class="c"># reshape ray index</span>
            <span class="n">rrl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">l</span><span class="p">)</span>
            <span class="c"># get the corresponding evaluated interactions</span>
            <span class="n">A</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span><span class="n">rrl</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
            <span class="n">si0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
            <span class="n">sout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">Z</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>



            <span class="c">## loop on the all the interactions of ray with l interactions</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>

<span class="c">###########################################</span>
<span class="c">#                # Divergence factor D</span>
<span class="c">##                 not yet implementented</span>
<span class="c">###########################################</span>
<span class="c">#                if i == 1:</span>
<span class="c">#                    D0=1./si0[:,1]</span>
<span class="c">#                    rho1=si0[:,1]*alpha[:,i]</span>
<span class="c">#                    rho2=si0[:,1]*alpha[:,i]*gamma[:,i]</span>
<span class="c">#                    D=np.sqrt(</span>
<span class="c">#                     ( (rho1 ) / (rho1 + sout[:,i]) )</span>
<span class="c">#                     *( (rho2) / (rho2 + sout[:,i])))</span>
<span class="c">#                    D=D*D0</span>
<span class="c">#                    rho1=rho1+(sout[:,i]*alpha[:,i])</span>
<span class="c">#                    rho2=rho2+(sout[:,i]*alpha[:,i]*gamma[:,i])</span>
<span class="c">#                    pdb.set_trace()</span>
<span class="c">##                     gerer le loss</span>
<span class="c">#                    if np.isnan(D).any():</span>
<span class="c">#                        p=np.nonzero(np.isnan(D))[0]</span>
<span class="c">#                        D[p]=1./sout[p,1]</span>
<span class="c">#                else :</span>
<span class="c">#                    D=np.sqrt(</span>
<span class="c">#                     ( (rho1 ) / (rho1 + sout[:,i]) )</span>
<span class="c">#                     *( (rho2) / (rho2 + sout[:,i])))</span>

<span class="c">#                    rho1=rho1+(sout[:,i]*alpha[:,i])</span>
<span class="c">#                    rho2=rho2+(sout[:,i]*alpha[:,i]*gamma[:,i])</span>
<span class="c">###########################################</span>
                    
                <span class="c">#  A0  (X dot Y)</span>
                <span class="c">#  |    |     |</span>
                <span class="c">#  v    v     v</span>
                <span class="c">##########################</span>
                <span class="c">## B  # I  # B  # I  # B # </span>
                <span class="c">##########################</span>
                <span class="c">#      \_____/   \______/</span>
                <span class="c">#         |         |</span>
                <span class="c">#       Atmp(i)   Atmp(i+1)</span>
                <span class="c">#</span>
                <span class="c"># Z=Atmp(i) dot Atmp(i+1)</span>

                <span class="n">X</span><span class="o">=</span><span class="n">A</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">,:,:]</span>
                <span class="n">Y</span><span class="o">=</span><span class="n">A</span><span class="p">[:,:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:,:]</span>
                <span class="c">## Dot product interaction X Basis</span>
                <span class="n">Atmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">...</span><span class="p">,:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span><span class="c">#*D[np.newaxis,:,np.newaxis,np.newaxis]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c">## First Basis added</span>
                    <span class="n">A0</span><span class="o">=</span><span class="n">A</span><span class="p">[:,:,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span>
                    <span class="n">Z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">A0</span><span class="p">[</span><span class="o">...</span><span class="p">,:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Atmp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="c"># dot product previous interaction with latest</span>
                    <span class="n">Z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Atmp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

            <span class="c"># fill the C tilde</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">],:,:]</span><span class="o">=</span><span class="n">Z</span><span class="p">[:,:,:,:]</span>
            


            <span class="c"># delay computation:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;dis&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


            <span class="c"># Power losses due to distances</span>
            <span class="c"># will be removed once the divergence factor will be implemented</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">],:,:]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">],:,:]</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;dis&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;dis&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">0.3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s">&#39;dis&#39;</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="GrRayTud.info"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            information for a given ray r </span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        r : a ray number</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&#39;-------------------------&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Informations of ray #&#39;</span><span class="p">,</span><span class="n">r</span>
        <span class="k">print</span> <span class="s">&#39;-------------------------</span><span class="se">\n</span><span class="s">&#39;</span>


        <span class="n">ray</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;{0:5} , {1:4}, {2:10}, {3:7}, {4:10}, {5:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Index&#39;</span><span class="p">,</span><span class="s">&#39;type&#39;</span><span class="p">,</span><span class="s">&#39;material&#39;</span><span class="p">,</span><span class="s">&#39;th(rad)&#39;</span><span class="p">,</span><span class="s">&#39;alpha&#39;</span><span class="p">,</span><span class="s">&#39;gamma2&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iidx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">I</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">midx</span><span class="o">=</span><span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                    <span class="n">Iidx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">I</span><span class="o">.</span><span class="n">idx</span><span class="p">))[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="n">th</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">gamma</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span><span class="n">Ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Iidx</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">Ii</span> <span class="ow">in</span> <span class="n">ray</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s">&#39;{0:5} , {1:4}, {2:10}, {3:7.2}, {4:10.2}, {5:10.2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ii</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">th</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">alpha</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span><span class="n">gamma</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;{0:5} , {1:4}, {2:10}, {3:7}, {4:10}, {5:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],</span><span class="n">i</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">----------------------------------------&#39;</span>
        <span class="k">print</span> <span class="s">&#39; Matrix of ray #&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span> <span class="s">&#39;at f=&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&#39;----------------------------------------&#39;</span>

        <span class="k">for</span> <span class="n">iidx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;interaction #&#39;</span><span class="p">,</span><span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],</span><span class="s">&#39;type:&#39;</span><span class="p">,</span><span class="n">i</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],:,:]</span>
</div>
<div class="viewcode-block" id="GrRayTud.imshowinter"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.imshowinter">[docs]</a>    <span class="k">def</span> <span class="nf">imshowinter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">evaluated</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            im show interactions for </span>
<span class="sd">            a given ray r and </span>
<span class="sd">            a given freq index f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="n">nbinter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="c"># find the position of the ray into the dictionnary of legnth of interactions</span>
        <span class="n">pray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s">&#39;rayidx&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">r</span><span class="p">)</span>
        <span class="c"># get the interaciton idx</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s">&#39;rays&#39;</span><span class="p">][</span><span class="n">pray</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="n">nbinter</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">f</span><span class="p">,</span><span class="n">inter</span><span class="p">]):</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;inter&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;imag&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;real&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbinter</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">evaluated</span> <span class="ow">and</span> <span class="n">evaluated</span><span class="p">:</span>
            <span class="n">fig2</span><span class="p">,</span><span class="n">axs2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dli</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s">&#39;Ctilde&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">,</span><span class="n">pray</span><span class="p">,:,:]</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Ctilde ray number :&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;imag&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;real&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbinter</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="GrRayTud.get_thetas"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.get_thetas">[docs]</a>    <span class="k">def</span> <span class="nf">get_thetas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all thetas ( incidence angles ) from all computed RayTud</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            np.array containg all incidence angles theta from all rays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">th</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">IntB</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">IntL</span><span class="p">)):</span>
                    <span class="n">th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">th</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="GrRayTud.get_mat"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRayTud.get_mat">[docs]</a>    <span class="k">def</span> <span class="nf">get_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all used materials from all computed Raytud</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            np.array containg all materials involved in raytracing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">IntB</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">IntL</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">midx</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Mat1</span><span class="p">):</span>
                        <span class="n">mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Mat1</span><span class="p">[</span><span class="n">midx</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mat</span><span class="p">))</span>



<span class="c">#    def info(self, n=-1):</span>
<span class="c">#        &quot;&quot;&quot; info</span>
<span class="c">#        Parameters</span>
<span class="c">#        ----------</span>

<span class="c">#        n : int</span>
<span class="c">#            ray index (default = -1 all rays)</span>

<span class="c">#        &quot;&quot;&quot;</span>
<span class="c">#        print &quot;Nb rayons : &quot;, self.nray</span>
<span class="c">#        if n == -1:</span>
<span class="c">#            for i in range(self.nray):</span>
<span class="c">#                print &quot;Rayon : &quot;, i</span>
<span class="c">#                self.rayTud[i].info()</span>
<span class="c">#                print &quot;\n&quot;</span>
<span class="c">#        else:</span>
<span class="c">#            print &quot;rayon no : &quot;, n</span>
<span class="c">#            self.rayTud[n].info()</span>

</div></div>
<div class="viewcode-block" id="GrRay3D"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D">[docs]</a><span class="k">class</span> <span class="nc">GrRay3D</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A set of Ray3D with the same Tx and Rx</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    A GrRay is a group of rays sharing the same end points (Tx and Rx)</span>
<span class="sd">    n     : number of ray3D</span>
<span class="sd">    Tx    : Tx point (3x1)</span>
<span class="sd">    Rx    : Rx point (3x1)</span>
<span class="sd">    ray3d : list of Ray3D object</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    choose()           : choose tra file</span>
<span class="sd">    load(_filename,L)  : load a grRay3d from .tra file</span>
<span class="sd">    save(_filename)    : load a grRay3d from .tra file</span>
<span class="sd">    info(level)        : display information about GrRay3D</span>
<span class="sd">    show3(self,bdis=True,bstruc=True,id=0) : geomview visualization</span>
<span class="sd">    reciprocal(Gs)     :</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<div class="viewcode-block" id="GrRay3D.dir"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.dir">[docs]</a>    <span class="k">def</span> <span class="nf">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in tradir</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of tradir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tradir is defined in the Project module</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">        &gt;&gt;&gt; g = GrRay3D()</span>
<span class="sd">        &gt;&gt;&gt; lfile = g.dir()</span>

<span class="sd">        .. todo:</span>
<span class="sd">            limit to a given filestruc</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">tradir</span> <span class="o">+</span> <span class="s">&#39;/*.tra&#39;</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lfile_s</span>
</div>
<div class="viewcode-block" id="GrRay3D.info"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        level : int</span>
<span class="sd">            level of information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Number of Ray : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GrRay3D.choose"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Choose a Tracing  file in tradir</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span>
        <span class="n">FD</span> <span class="o">=</span> <span class="n">tkFileDialog</span>
        <span class="n">filetra</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;Fichiers Launching &quot;</span><span class="p">,</span> <span class="s">&quot;*.tra&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;All&quot;</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="p">)],</span> <span class="n">title</span><span class="o">=</span><span class="s">&quot;Please choose a Tracing file&quot;</span><span class="p">,</span> <span class="n">initialdir</span><span class="o">=</span><span class="n">tradir</span><span class="p">)</span>
        <span class="n">_filetra</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filetra</span><span class="p">)</span>
        <span class="n">tabc</span> <span class="o">=</span> <span class="n">_filetra</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">_filestr</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.str&#39;</span>
        <span class="n">_fileslab</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.slab&#39;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;.mat&#39;</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">loadstr</span><span class="p">(</span><span class="n">_filestr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GrRay3D.load"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a .tra de PulsRay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : PulsRay .tra data format  filename</span>
<span class="sd">        L         : Layout object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.rays import *</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.util.project import *</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import scipy as sp</span>
<span class="sd">            &gt;&gt;&gt; g = GrRay3D()</span>
<span class="sd">            &gt;&gt;&gt; lfile = g.dir()</span>
<span class="sd">            &gt;&gt;&gt; n = len(lfile)</span>
<span class="sd">            &gt;&gt;&gt; file0  = lfile[0]</span>
<span class="sd">            &gt;&gt;&gt; s1 = file0.split(&#39;_&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _filestr = s1[0]+&#39;.str&#39;</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.load(_filestr)</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; g.load(file0,L)</span>
<span class="sd">            &gt;&gt;&gt; g.show(f,a,np.arange(10))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; g.show(f,a,np.arange(100))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; g.show(f,a,np.arange(300))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTRA&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#</span>
        <span class="c"># decode read data</span>
        <span class="c">#</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flch</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpatra</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fspa</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="c">#print &quot;Rayon NÂ° : &quot;,i</span>
                <span class="n">ray3D</span> <span class="o">=</span> <span class="n">Ray3D</span><span class="p">()</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c">#</span>
                <span class="c"># local basis creation</span>
                <span class="c">#</span>
                <span class="c"># DEBUG</span>
                <span class="c">#if i &lt; 410:</span>
                <span class="c">#    print ray3D.nstr</span>
                <span class="c">#    n1 = []</span>
                <span class="c">#    for kk in range(len(ray3D.nstr)-2):</span>
                <span class="c">#        p1 = ray3D.pt[kk+1,0:2]</span>
                <span class="c">#        nn = struc.onseg(p1,0.2)</span>
                <span class="c">#        try:</span>
                <span class="c">#            num = nn[0]+1</span>
                <span class="c">#            n1.append(num)</span>
                <span class="c">#        except:</span>
                <span class="c">#            n1.append(-7)</span>
                <span class="c">#    print n1</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">niz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3D</span><span class="p">)</span>
                <span class="c">#if niz==2:</span>
                <span class="c">#    ray3D.locbas(L)</span>
                <span class="c">#    self.ray3d.append(ray3D)</span>
                <span class="c">#else:</span>
                <span class="c">#    self.n = self.n-1</span>
                    <span class="c">#print &quot;Problem with ray : &quot;,i</span>
                    <span class="c">#print ray3D.nstr</span>
                    <span class="c">#print ray3D.pt</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#           except:</span>
<span class="c">#               print &quot;Le fichier&quot;, filename, &quot;est introuvable&quot;</span>
</div>
<div class="viewcode-block" id="GrRay3D.delay"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delay</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        td  : np.array</span>
<span class="sd">            delays</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">td</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span><span class="p">()))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">td</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GrRay3D.save"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        _filename : str</span>

<span class="sd">        Save a  GrRay3d object in a .tra de PulsRay</span>
<span class="sd">        filename : PulsRay .tra data format  filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRTRA&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">dt_lch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flch</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_lch</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_lch</span> <span class="o">=</span> <span class="n">dt_lch</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span>

        <span class="n">dt_patra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpatra</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_patra</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_patra</span> <span class="o">=</span> <span class="n">dt_patra</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span>

        <span class="n">dt_spa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fspa</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_spa</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_spa</span> <span class="o">=</span> <span class="n">dt_spa</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\x00</span><span class="s">&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">dt_lch</span> <span class="o">+</span> <span class="n">dt_patra</span> <span class="o">+</span> <span class="n">dt_spa</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="n">ray3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
                <span class="n">data_ray</span> <span class="o">=</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">data_ray</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GrRay3D.reciprocal"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.reciprocal">[docs]</a>    <span class="k">def</span> <span class="nf">reciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Reciprocity channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        L   : Layout object</span>
<span class="sd">        return a reciprocal GrRay3D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>

        <span class="n">G</span><span class="o">.</span><span class="n">Tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span>
        <span class="k">print</span> <span class="s">&quot;G.Tx = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Tx</span>
        <span class="n">G</span><span class="o">.</span><span class="n">Rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span>
        <span class="k">print</span> <span class="s">&quot;G.Rx = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Rx</span>
        <span class="n">G</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>

        <span class="k">print</span> <span class="s">&quot;G.n = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">n</span>
        <span class="k">print</span> <span class="s">&quot;self.n = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">ray3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ray3d</span> <span class="o">=</span> <span class="n">Ray3D</span><span class="p">()</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nn</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">pht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phr</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pht</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">tht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">thr</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">thr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tht</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">deep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deep</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">elength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">nstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">ray3d</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span>
            <span class="n">ray3D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3d</span><span class="p">)</span>
        <span class="n">G</span><span class="o">.</span><span class="n">ray3d</span> <span class="o">=</span> <span class="n">ray3D</span>
        <span class="k">return</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GrRay3D.show"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">rayset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">col</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a cluster of rays </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fig    : figure instance </span>
<span class="sd">        ax     : axes instance  </span>
<span class="sd">        rayset :</span>
<span class="sd">            set of rays np.array([])</span>
<span class="sd">        col  : string</span>
<span class="sd">            default  {&#39;b&#39;}</span>
<span class="sd">        node : boolean</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rayset</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

</div>
<div class="viewcode-block" id="GrRay3D.show3"><a class="viewcode-back" href="../../../modules/antprop.rays.html#pylayers.antprop.rays.GrRay3D.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rayset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bstruc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 3D show using geomview</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rayset : set of index of rays to be displayed</span>
<span class="sd">        bdis : display boolean - if False return .vect filename</span>
<span class="sd">        id   : id of the grRray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rayset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">rayset</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s">&quot;grRay&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.list&quot;</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bstruc</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt;defstr.off}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="c">#fo.write(&quot;{&lt;strucTxRx.off}\n&quot;)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rayset</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">fileray</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">show3</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;{&lt; &quot;</span> <span class="o">+</span> <span class="n">fileray</span> <span class="o">+</span> <span class="s">&quot; }</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Bernard Uguen,Mohamedh Laaraiedh,Nicolas Amiot.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>