

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.antprop.loss &mdash; Python 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="Python 1 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html">1&nbsp;&nbsp;&nbsp;Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#radio-propagation-simulation">2&nbsp;&nbsp;&nbsp;Radio Propagation Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#handling-agent-mobility">3&nbsp;&nbsp;&nbsp;Handling Agent Mobility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#wireless-body-area-network-related-classes">4&nbsp;&nbsp;&nbsp;Wireless Body Area Network Related Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#some-simulation-examples">5&nbsp;&nbsp;&nbsp;Some Simulation Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#algorithms-for-localization">6&nbsp;&nbsp;&nbsp;Algorithms for Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#measurements-tools">7&nbsp;&nbsp;&nbsp;Measurements Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#pylayers-tools">8&nbsp;&nbsp;&nbsp;PyLayers Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/TOC.html#references">9&nbsp;&nbsp;&nbsp;References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/pylayers.html">PyLayers Modules Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>pylayers.antprop.loss</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.antprop.loss</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding:Utf-8 -*-</span>
<span class="c1">#from numpy import *</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">.. currentmodule:: pylayers.antprop.loss</span>

<span class="sd">Loss module</span>
<span class="sd">===========</span>

<span class="sd">This module implements path loss models for various situations.</span>


<span class="sd">.. automodule:: </span>
<span class="sd">    :members:</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pylayers.measures.mesuwb</span>
<span class="kn">import</span> <span class="nn">pylayers.gis.gisutil</span> <span class="kn">as</span> <span class="nn">gu</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">pdb</span>

<div class="viewcode-block" id="PL0"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.PL0.html#pylayers.antprop.loss.PL0">[docs]</a><span class="k">def</span> <span class="nf">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">GtdB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">GrdB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Path Loss at frequency fGHZ @ R</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz: float</span>
<span class="sd">          frequency GHz</span>
<span class="sd">    GtdB: float</span>
<span class="sd">          transmitting antenna gain dB (default 0 dB)</span>
<span class="sd">    GrdB: float</span>
<span class="sd">          receiving antenna gain dB (default 0 dB)</span>
<span class="sd">    R   : float</span>
<span class="sd">        distance in m</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL0 : float</span>
<span class="sd">          path @ R</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: PL_0 = -20 log_{10}(\\frac{\\lambda}{4\\pi}) - GtdB -GrdB</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; fGHz  = 2.4</span>
<span class="sd">    &gt;&gt;&gt; PL = PL0(fGHz)</span>
<span class="sd">    &gt;&gt;&gt; assert (PL&lt;41)&amp;(PL&gt;40),&quot;something wrong&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fGHz</span><span class="p">])</span>

    <span class="n">ld</span>  <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
    <span class="n">PL0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">R</span><span class="p">))</span><span class="o">-</span><span class="n">GtdB</span><span class="o">-</span><span class="n">GrdB</span>

    <span class="k">return</span> <span class="n">PL0</span></div>

<div class="viewcode-block" id="Dgrid_points"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.Dgrid_points.html#pylayers.antprop.loss.Dgrid_points">[docs]</a><span class="k">def</span> <span class="nf">Dgrid_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">Px</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; distance point to grid</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    points : np.array</span>
<span class="sd">             grid Np x 2 array</span>

<span class="sd">    Px     : np.array</span>
<span class="sd">             point 2 x 1  array</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Dy</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Dx</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">Dy</span><span class="o">*</span><span class="n">Dy</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">D</span><span class="p">)</span></div>


<div class="viewcode-block" id="FMetisShad2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.FMetisShad2.html#pylayers.antprop.loss.FMetisShad2">[docs]</a><span class="k">def</span> <span class="nf">FMetisShad2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; F Metis shadowing function</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz : np.array(Nf)</span>
<span class="sd">        frequency GHz</span>
<span class="sd">    r : np.array(Nseg,)</span>
<span class="sd">        distance between Tx and Rx</span>
<span class="sd">    D : np.array(Nseg,Nscreen)</span>
<span class="sd">        indirect distance between Tx and Rx (screen effect)</span>
<span class="sd">    sign : np.array(Nseg,Nscreen)</span>
<span class="sd">        == 1  : Shadowing NLOS situation</span>
<span class="sd">        ==-1  : No shadowing LOS situation   </span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    F : np.array(Nseg,Nscreen,Nf)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Provides an implementation of formula (6.6) in D1.4 of METIS project</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    LossMetisShadowing</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lamda</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">sign</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lamda</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">D</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">r</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]))))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span><span class="p">(</span><span class="n">F</span><span class="p">)</span></div>
<div class="viewcode-block" id="FMetisShad"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.FMetisShad.html#pylayers.antprop.loss.FMetisShad">[docs]</a><span class="k">def</span> <span class="nf">FMetisShad</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; F Metis shadowing function</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz : float </span>
<span class="sd">        frequency GHz</span>
<span class="sd">    r : float</span>
<span class="sd">        distance between Tx and Rx</span>
<span class="sd">    D : float </span>
<span class="sd">        indirect distance between Tx and Rx (screen effect)</span>
<span class="sd">    sign : int</span>
<span class="sd">        == 1  : Shadowing NLOS situation</span>
<span class="sd">        ==-1  : No shadowing LOS situation   </span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Provides an implementation of formula (6.6) in D1.4 of METIS project</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    LossMetisShadowing</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lamda</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">sign</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lamda</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">r</span><span class="p">))))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">return</span><span class="p">(</span><span class="n">F</span><span class="p">)</span></div>

<div class="viewcode-block" id="LossMetisShadowing"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.LossMetisShadowing.html#pylayers.antprop.loss.LossMetisShadowing">[docs]</a><span class="k">def</span> <span class="nf">LossMetisShadowing</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">pg</span><span class="p">,</span><span class="n">uw</span><span class="p">,</span><span class="n">uh</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the Loss from </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fGHz : float</span>
<span class="sd">        </span>
<span class="sd">    tx  : np.array (,3) of floats  </span>
<span class="sd">        transmiter coordinates </span>
<span class="sd">    rx  : np.array (,3) of floats  </span>
<span class="sd">        receiver coordinates </span>
<span class="sd">    pg  : np.array (,3) of floats </span>
<span class="sd">        center of gravity of the screen </span>
<span class="sd">    uw  : np.array (,3) of floats </span>
<span class="sd">        unitary vector along width dimension</span>
<span class="sd">    uh  : np.array (,3) of floats </span>
<span class="sd">        unitary vector along height dimension</span>
<span class="sd">    w   : float </span>
<span class="sd">        width in meters</span>
<span class="sd">    h   : float </span>
<span class="sd">        height in meters </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Lsh : float </span>
<span class="sd">        Loss in dB to add to the FS path Loss</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This function provides an implementation of formula 6.5 of D1.4 deliverable of METIS project</span>

<span class="sd">    [Metis D1.4](Ahttps://www.metis2020.com/wp-content/uploads/METIS_D1.4_v3.pdf)</span>

<span class="sd">    # geometry parametric issue : find M in [tx-rx] defined as M = alpha*rx + (1-alpha)tx where alpha in [0-1].</span>
<span class="sd">    # if alpha = 0 then M = tx ; if alpha = 1 then M = rx.</span>
<span class="sd">    # Besides, M is defined as M = pg + beta*uw + gamma*uh then  alpha*rx + (1-alpha)tx = pg + beta*uw + gamma*uh</span>
<span class="sd">    # [rx-tx , -uw, -uh]*[alpha,beta,gamma].T = pg - tx &lt;==&gt; Ax = b solved by la.solve ; x[0]=alpha, x[1]=beta and</span>

<span class="sd">    TODO</span>
<span class="sd">    ----</span>

<span class="sd">    To be vectorized </span>

<span class="sd">    &quot;&quot;&quot;</span>

    

    <span class="n">rxtx</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">-</span> <span class="n">tx</span> <span class="c1"># LOS distance</span>
   
    <span class="c1"># x[2]=gamma.</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rxtx</span><span class="p">,</span><span class="o">-</span><span class="n">uw</span><span class="p">,</span><span class="o">-</span><span class="n">uh</span><span class="p">))</span><span class="o">.</span><span class="n">T</span> 
    <span class="n">b</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">-</span> <span class="n">tx</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    
    <span class="c1"># condition of shadowing</span>
    <span class="n">condseg</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">))</span> 
    <span class="n">condw</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> 
    <span class="n">condh</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">h</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">h</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> 
    
    <span class="n">visi</span> <span class="o">=</span> <span class="n">condseg</span> <span class="ow">or</span> <span class="n">condw</span> <span class="ow">or</span> <span class="n">condh</span>
    <span class="k">if</span> <span class="n">visi</span><span class="p">:</span>
        <span class="n">shad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shad</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rxtx</span><span class="p">,</span><span class="n">rxtx</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">w1</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">+</span> <span class="n">uw</span><span class="o">*</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">-</span> <span class="n">uw</span><span class="o">*</span><span class="n">w</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">+</span> <span class="n">uh</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">-</span> <span class="n">uh</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mf">2.</span>

    
    <span class="n">Dtw1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">w1</span><span class="p">,</span><span class="n">tx</span><span class="o">-</span><span class="n">w1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drw1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rx</span><span class="o">-</span><span class="n">w1</span><span class="p">,</span><span class="n">rx</span><span class="o">-</span><span class="n">w1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Dtw2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">w2</span><span class="p">,</span><span class="n">tx</span><span class="o">-</span><span class="n">w2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drw2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rx</span><span class="o">-</span><span class="n">w2</span><span class="p">,</span><span class="n">rx</span><span class="o">-</span><span class="n">w2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Dth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">h1</span><span class="p">,</span><span class="n">tx</span><span class="o">-</span><span class="n">h1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rx</span><span class="o">-</span><span class="n">h1</span><span class="p">,</span><span class="n">rx</span><span class="o">-</span><span class="n">h1</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Dth2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tx</span><span class="o">-</span><span class="n">h2</span><span class="p">,</span><span class="n">tx</span><span class="o">-</span><span class="n">h2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rx</span><span class="o">-</span><span class="n">h2</span><span class="p">,</span><span class="n">rx</span><span class="o">-</span><span class="n">h2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    
    <span class="n">D1w</span> <span class="o">=</span> <span class="n">Dtw1</span><span class="o">+</span><span class="n">Drw1</span>
    <span class="n">D1h</span> <span class="o">=</span> <span class="n">Dth1</span><span class="o">+</span><span class="n">Drh1</span>
    <span class="n">D2w</span> <span class="o">=</span> <span class="n">Dtw2</span><span class="o">+</span><span class="n">Drw2</span>
    <span class="n">D2h</span> <span class="o">=</span> <span class="n">Dth2</span><span class="o">+</span><span class="n">Drh2</span>
    

    <span class="k">if</span> <span class="n">shad</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">signw1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">signw2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">signh1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">signh2</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">condw</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">D1w</span><span class="o">&gt;</span><span class="n">D2w</span><span class="p">:</span>
                <span class="n">signw1</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">signw2</span><span class="o">=-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">signw1</span><span class="o">=-</span><span class="mi">1</span>
                <span class="n">signw2</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">signw1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">signw2</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">condh</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">D1h</span><span class="o">&gt;</span><span class="n">D2h</span><span class="p">:</span>
                <span class="n">signh1</span><span class="o">=</span><span class="mi">1</span>
                <span class="n">signh2</span><span class="o">=-</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">signh1</span><span class="o">=-</span><span class="mi">1</span>
                <span class="n">signh2</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">signh1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">signh2</span> <span class="o">=</span> <span class="mi">1</span>

    
            
    <span class="n">Fw1</span> <span class="o">=</span> <span class="n">FMetisShad</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D1w</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signw1</span><span class="p">)</span>
    <span class="n">Fh1</span> <span class="o">=</span> <span class="n">FMetisShad</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D1h</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signh1</span><span class="p">)</span>
    <span class="n">Fw2</span> <span class="o">=</span> <span class="n">FMetisShad</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D2w</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signw2</span><span class="p">)</span>
    <span class="n">Fh2</span> <span class="o">=</span> <span class="n">FMetisShad</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D2h</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signh2</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Fh1</span><span class="o">+</span><span class="n">Fh2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Fw1</span><span class="o">+</span><span class="n">Fw2</span><span class="p">)</span>
    <span class="n">Lsh</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1">#return(Lsh,shad,tmp,Fw1,Fh1,Fw2,Fh2,condh,condw)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Lsh</span><span class="p">)</span></div>

<div class="viewcode-block" id="LossMetisShadowing2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.LossMetisShadowing2.html#pylayers.antprop.loss.LossMetisShadowing2">[docs]</a><span class="k">def</span> <span class="nf">LossMetisShadowing2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">pg</span><span class="p">,</span><span class="n">uw</span><span class="p">,</span><span class="n">uh</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the Loss from </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz : np.array(,Nf)</span>
<span class="sd">        </span>
<span class="sd">    tx  : np.array (3,Nseg) of floats  </span>
<span class="sd">        transmiter coordinates </span>
<span class="sd">    rx  : np.array (3,Nseg) of floats  </span>
<span class="sd">        receiver coordinates </span>
<span class="sd">    pg  : np.array (3,Nscreen) of floats </span>
<span class="sd">        center of gravity of the screen </span>
<span class="sd">    uw  : np.array (3,Nscreen) of floats </span>
<span class="sd">        unitary vector along width dimension</span>
<span class="sd">    uh  : np.array (3,Nscreen) of floats </span>
<span class="sd">        unitary vector along height dimension</span>
<span class="sd">    w   : np.array (,Nscreen)</span>
<span class="sd">        width in meters</span>
<span class="sd">    h   : np.array (,Nscreen)</span>
<span class="sd">        height in meters </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Lsh : np.array (Nseg,Nscreen,Nf)</span>
<span class="sd">        Loss in dB to add to the FS path Loss</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This function provides an implementation of formula 6.5 of D1.4 deliverable of METIS project</span>

<span class="sd">    [Metis D1.4](Ahttps://www.metis2020.com/wp-content/uploads/METIS_D1.4_v3.pdf)</span>

<span class="sd">    # geometry parametric issue : find M in [tx-rx] defined as M = alpha*rx + (1-alpha)tx where alpha in [0-1].</span>
<span class="sd">    # if alpha = 0 then M = tx ; if alpha = 1 then M = rx.</span>
<span class="sd">    # Besides, M is defined as M = pg + beta*uw + gamma*uh then  alpha*rx + (1-alpha)tx = pg + beta*uw + gamma*uh</span>
<span class="sd">    # [rx-tx , -uw, -uh]*[alpha,beta,gamma].T = pg - tx &lt;==&gt; Ax = b solved by la.solve ; x[0]=alpha, x[1]=beta and</span>

<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Nseg</span> <span class="o">=</span> <span class="n">tx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Nscreen</span> <span class="o">=</span> <span class="n">uw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">rxtx</span> <span class="o">=</span> <span class="n">rx</span> <span class="o">-</span> <span class="n">tx</span> <span class="c1"># (3,Nseg) LOS distance</span>
   

    <span class="c1"># A : (Nseg,Nscreen,3,3)</span>
    <span class="c1"># b : (Nseg,Nscreen,3)</span>
    <span class="c1"># rxtx.T (Nseg,3)</span>
    <span class="c1"># uw.T (Nscreen, 3)</span>
    <span class="c1"># uh.T (Nscreen, 3)</span>

    <span class="n">U</span> <span class="o">=</span> <span class="n">rxtx</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">uw</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,:,</span><span class="bp">None</span><span class="p">]</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">uh</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,:,</span><span class="bp">None</span><span class="p">]</span>

    <span class="n">We</span> <span class="o">=</span> <span class="n">W</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">He</span> <span class="o">=</span> <span class="n">H</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">Ue</span> <span class="o">=</span> <span class="n">U</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">He</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Ue</span><span class="p">,</span><span class="o">-</span><span class="n">We</span><span class="p">,</span><span class="o">-</span><span class="n">He</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1">#A = np.vstack((rxtx,-uw,-uh)).T </span>

    <span class="c1"># pg.T Nscreen, 3</span>
    <span class="c1"># tx.T Nseg,3</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,:]</span><span class="o">-</span><span class="n">tx</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]</span> 
    <span class="c1">#b = pg - tx</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    
    
    <span class="c1"># condition of shadowing</span>
    <span class="n">condseg</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">))</span> 
    <span class="n">condw</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">w</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">w</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> 
    <span class="n">condh</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">h</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">h</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span> 
    
    <span class="n">visi</span> <span class="o">=</span> <span class="p">(</span><span class="n">condseg</span> <span class="o">+</span> <span class="n">condw</span> <span class="o">+</span> <span class="n">condh</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span>

    
    <span class="c1"># if visi:</span>
    <span class="c1">#     shad = -1</span>
    <span class="c1"># else:</span>
    <span class="c1">#     shad = 1</span>
    <span class="c1">#shad = - visi    </span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rxtx</span><span class="o">*</span><span class="n">rxtx</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>


    <span class="n">w1</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">+</span> <span class="n">uw</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">w2</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">-</span> <span class="n">uw</span><span class="o">*</span><span class="n">w</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">+</span> <span class="n">uh</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="n">pg</span> <span class="o">-</span> <span class="n">uh</span><span class="o">*</span><span class="n">h</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">2.</span>


    
    <span class="n">Dtw1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drw1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Dtw2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drw2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">w2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="n">Dth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h1</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Dth2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">Drh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">h2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

    <span class="c1"># Drw1 = np.dot(rx-w1,rx-w1)**0.5</span>
    <span class="c1"># Dtw2 = np.dot(tx-w2,tx-w2)**0.5</span>
    <span class="c1"># Drw2 = np.dot(rx-w2,rx-w2)**0.5</span>
    <span class="c1"># Dth1 = np.dot(tx-h1,tx-h1)**0.5</span>
    <span class="c1"># Drh1 = np.dot(rx-h1,rx-h1)**0.5</span>
    <span class="c1"># Dth2 = np.dot(tx-h2,tx-h2)**0.5</span>
    <span class="c1"># Drh2 = np.dot(rx-h2,rx-h2)**0.5</span>
    
    
    <span class="n">D1w</span> <span class="o">=</span> <span class="n">Dtw1</span><span class="o">+</span><span class="n">Drw1</span>
    <span class="n">D1h</span> <span class="o">=</span> <span class="n">Dth1</span><span class="o">+</span><span class="n">Drh1</span>
    <span class="n">D2w</span> <span class="o">=</span> <span class="n">Dtw2</span><span class="o">+</span><span class="n">Drw2</span>
    <span class="n">D2h</span> <span class="o">=</span> <span class="n">Dth2</span><span class="o">+</span><span class="n">Drh2</span>
    
    <span class="n">signw1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nseg</span><span class="p">,</span><span class="n">Nscreen</span><span class="p">))</span>
    <span class="n">signw2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nseg</span><span class="p">,</span><span class="n">Nscreen</span><span class="p">))</span>
    <span class="n">signh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nseg</span><span class="p">,</span><span class="n">Nscreen</span><span class="p">))</span>
    <span class="n">signh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nseg</span><span class="p">,</span><span class="n">Nscreen</span><span class="p">))</span>


    <span class="n">condw1</span> <span class="o">=</span> <span class="p">(</span><span class="n">visi</span><span class="o">*</span><span class="n">condw</span><span class="o">*</span><span class="p">(</span><span class="n">D1w</span><span class="o">&lt;=</span><span class="n">D2w</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">condw2</span> <span class="o">=</span> <span class="p">(</span><span class="n">visi</span><span class="o">*</span><span class="n">condw</span><span class="o">*</span><span class="p">(</span><span class="n">D1w</span><span class="o">&gt;</span><span class="n">D2w</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">signw1</span><span class="p">[</span><span class="n">condw1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
    <span class="n">signw2</span><span class="p">[</span><span class="n">condw2</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
    <span class="n">condh1</span> <span class="o">=</span> <span class="p">(</span><span class="n">visi</span><span class="o">*</span><span class="n">condh</span><span class="o">*</span><span class="p">(</span><span class="n">D1h</span><span class="o">&lt;=</span><span class="n">D2h</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">condh2</span> <span class="o">=</span> <span class="p">(</span><span class="n">visi</span><span class="o">*</span><span class="n">condh</span><span class="o">*</span><span class="p">(</span><span class="n">D1h</span><span class="o">&gt;</span><span class="n">D2h</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">signh1</span><span class="p">[</span><span class="n">condh1</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
    <span class="n">signh2</span><span class="p">[</span><span class="n">condh2</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
    
            
    <span class="n">Fw1</span> <span class="o">=</span> <span class="n">FMetisShad2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D1w</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signw1</span><span class="p">)</span>
    <span class="n">Fh1</span> <span class="o">=</span> <span class="n">FMetisShad2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D1h</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signh1</span><span class="p">)</span>
    <span class="n">Fw2</span> <span class="o">=</span> <span class="n">FMetisShad2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D2w</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signw2</span><span class="p">)</span>
    <span class="n">Fh2</span> <span class="o">=</span> <span class="n">FMetisShad2</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">D2h</span><span class="p">,</span><span class="n">sign</span><span class="o">=</span><span class="n">signh2</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Fh1</span><span class="o">+</span><span class="n">Fh2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Fw1</span><span class="o">+</span><span class="n">Fw2</span><span class="p">)</span>
    <span class="n">Lsh</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tmp</span><span class="p">)</span>

    <span class="c1">#return(Lsh,shad,tmp,Fw1,Fh1,Fw2,Fh2,condh,condw)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Lsh</span><span class="p">)</span></div>
<div class="viewcode-block" id="Dgrid_zone"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.Dgrid_zone.html#pylayers.antprop.loss.Dgrid_zone">[docs]</a><span class="k">def</span> <span class="nf">Dgrid_zone</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span><span class="n">Px</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Distance point to zone</span>

<span class="sd">    A zone is a quadrilateral zone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    zone : dictionnary</span>
<span class="sd">           xmin xmax Nx</span>
<span class="sd">           ymin ymax Ny</span>

<span class="sd">    Px : np.array</span>
<span class="sd">         point</span>

<span class="sd">    Build the distance matrix between Tx and points in the zone</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    use broadcasting instead</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;xmin&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;xmax&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">])</span>
    <span class="n">ry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;ymin&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;ymax&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">])</span>

    <span class="n">R_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ry</span><span class="p">)),</span><span class="n">rx</span><span class="p">)</span>
    <span class="n">R_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ry</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)))</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">R_x</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Dy</span> <span class="o">=</span> <span class="n">R_y</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Dx</span><span class="o">*</span><span class="n">Dx</span><span class="o">+</span><span class="n">Dy</span><span class="o">*</span><span class="n">Dy</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">D</span><span class="p">)</span></div>

<div class="viewcode-block" id="OneSlopeMdl"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.OneSlopeMdl.html#pylayers.antprop.loss.OneSlopeMdl">[docs]</a><span class="k">def</span> <span class="nf">OneSlopeMdl</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">fGHz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; one slope model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    D   : np.array</span>
<span class="sd">          distance array</span>
<span class="sd">    n   : float</span>
<span class="sd">          path loss exponent</span>
<span class="sd">    fGHz : np.array</span>
<span class="sd">           frequency  GHz</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL : np.array</span>
<span class="sd">          path loss as a function of distance</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PL</span> <span class="o">=</span> <span class="n">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">PL</span><span class="p">)</span></div>

<div class="viewcode-block" id="cost231"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.cost231.html#pylayers.antprop.loss.cost231">[docs]</a><span class="k">def</span> <span class="nf">cost231</span><span class="p">(</span><span class="n">pBS</span><span class="p">,</span><span class="n">pMS</span><span class="p">,</span><span class="n">hroof</span><span class="p">,</span><span class="n">phir</span><span class="p">,</span><span class="n">wr</span><span class="p">,</span><span class="n">fMHz</span><span class="p">,</span><span class="n">wb</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">city</span><span class="o">=</span><span class="s1">&#39;medium&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Walfish Ikegami model (COST 231)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    pBS   : np.array (3xNlink)</span>
<span class="sd">    pMS   : np.array (3xNlink)</span>
<span class="sd">    hroof : np.array (1xNlink)</span>
<span class="sd">    phir  : np.array (1xNlink)</span>
<span class="sd">        degrees</span>
<span class="sd">    wr    : np.array (1xNlink)</span>
<span class="sd">    fMHz  : np.array (1xNf)</span>
<span class="sd">    wb    : float</span>
<span class="sd">        average building separation</span>
<span class="sd">    dB    : boolean</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PathLoss  (Nlink,Nf)</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    http://morse.colorado.edu/~tlen5510/text/classwebch3.html</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.loss import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; # Number of links and BS and MS heights</span>
<span class="sd">        &gt;&gt;&gt; Nlink = 100</span>
<span class="sd">        &gt;&gt;&gt; hBS = 300</span>
<span class="sd">        &gt;&gt;&gt; hMS = 1.5</span>
<span class="sd">        &gt;&gt;&gt; # hroof and phir are drawn uniformily at random </span>
<span class="sd">        &gt;&gt;&gt; hroof = 40*np.random.rand(Nlink)</span>
<span class="sd">        &gt;&gt;&gt; wr = 10*np.ones(Nlink)</span>
<span class="sd">        &gt;&gt;&gt; phir = 90*np.random.rand(Nlink)</span>
<span class="sd">        &gt;&gt;&gt; pMS = np.vstack((np.linspace(10,2500,Nlink),np.zeros(Nlink),hMS*np.ones(Nlink)))</span>
<span class="sd">        &gt;&gt;&gt; pBS = np.vstack((np.zeros(Nlink),np.zeros(Nlink),hBS*np.ones(Nlink)))</span>
<span class="sd">        &gt;&gt;&gt; # frequency range </span>
<span class="sd">        &gt;&gt;&gt; fMHz = np.linspace(700,1900,120)</span>
<span class="sd">        &gt;&gt;&gt; pl = cost231(pBS,pMS,hroof,phir,wr,fMHz)</span>
<span class="sd">        &gt;&gt;&gt; im = plt.imshow(pl,extent=(0,100,0.7,1.9))</span>
<span class="sd">        &gt;&gt;&gt; cb = plt.colorbar()</span>
<span class="sd">        &gt;&gt;&gt; cb.set_label(&#39;Loss (dB)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.axis(&#39;tight&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.xlabel(&#39;Frequency (GHz)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.ylabel(&#39;Link Number&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;100 WI Path Loss realizations &#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hBS</span> <span class="o">=</span> <span class="n">pBS</span><span class="p">[</span><span class="mi">2</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">hMS</span> <span class="o">=</span> <span class="n">pMS</span><span class="p">[</span><span class="mi">2</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">wr</span>  <span class="o">=</span> <span class="n">wr</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">hroof</span> <span class="o">=</span> <span class="n">hroof</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">phir</span> <span class="o">=</span> <span class="n">phir</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">fMHz</span> <span class="o">=</span> <span class="n">fMHz</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
    <span class="n">dm</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">dkm</span> <span class="o">=</span> <span class="n">dm</span><span class="o">/</span><span class="mf">1000.</span>
    <span class="n">Nlink</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>

    <span class="n">pl0</span> <span class="o">=</span> <span class="mf">32.4</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dkm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fMHz</span><span class="p">)</span>

    <span class="n">delta_base</span> <span class="o">=</span> <span class="n">hBS</span><span class="o">-</span><span class="n">hroof</span>

    <span class="n">u035</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">phir</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">phir</span><span class="o">&lt;</span><span class="mi">35</span><span class="p">))</span>
    <span class="n">u3555</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">phir</span><span class="o">&gt;=</span><span class="mi">35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">phir</span><span class="o">&lt;</span><span class="mi">55</span><span class="p">))</span>
    <span class="n">u5590</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">phir</span><span class="o">&gt;=</span><span class="mi">55</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">phir</span><span class="o">&lt;</span><span class="mi">90</span><span class="p">))</span>

    <span class="n">plori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nlink</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="c1"># path loss due to orientation w.r.t road</span>
    <span class="n">plori</span><span class="p">[</span><span class="n">u035</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">+</span><span class="mf">0.354</span><span class="o">*</span><span class="n">phir</span><span class="p">[</span><span class="n">u035</span><span class="p">]</span>
    <span class="n">plori</span><span class="p">[</span><span class="n">u3555</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.5</span><span class="o">+</span><span class="mf">0.075</span><span class="o">*</span><span class="n">phir</span><span class="p">[</span><span class="n">u3555</span><span class="p">]</span>
    <span class="n">plori</span><span class="p">[</span><span class="n">u5590</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span><span class="o">-</span><span class="mf">0.114</span><span class="o">*</span><span class="p">(</span><span class="n">phir</span><span class="p">[</span><span class="n">u5590</span><span class="p">]</span><span class="o">-</span><span class="mi">55</span><span class="p">)</span>

    <span class="c1"># rooftop to street</span>
    <span class="n">plrts</span> <span class="o">=</span> <span class="o">-</span><span class="mf">16.9</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fMHz</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">hroof</span><span class="o">-</span><span class="n">hMS</span><span class="p">)</span><span class="o">+</span><span class="n">plori</span>
    <span class="n">uroofsupBS</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hBS</span><span class="o">&gt;</span><span class="n">hroof</span><span class="p">)</span>
    <span class="n">uroofinfBS</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">hBS</span><span class="o">&lt;=</span><span class="n">hroof</span><span class="p">)</span>
    <span class="n">udistsup500</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">hBS</span><span class="o">&lt;=</span><span class="n">hroof</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dkm</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">))</span>
    <span class="n">udistinf500</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">hBS</span><span class="o">&lt;=</span><span class="n">hroof</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">dkm</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="n">plbsh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nlink</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">plbsh</span><span class="p">[</span><span class="n">uroofsupBS</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">18</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">delta_base</span><span class="p">[</span><span class="n">uroofsupBS</span><span class="p">])</span>

    <span class="n">ka</span>  <span class="o">=</span> <span class="mi">54</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nlink</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ka</span><span class="p">[</span><span class="n">udistsup500</span><span class="p">]</span> <span class="o">=</span> <span class="n">ka</span><span class="p">[</span><span class="n">udistsup500</span><span class="p">]</span><span class="o">-</span><span class="mf">0.8</span><span class="o">*</span><span class="n">delta_base</span><span class="p">[</span><span class="n">udistsup500</span><span class="p">]</span>
    <span class="n">ka</span><span class="p">[</span><span class="n">udistinf500</span><span class="p">]</span> <span class="o">=</span> <span class="n">ka</span><span class="p">[</span><span class="n">udistinf500</span><span class="p">]</span><span class="o">-</span><span class="mf">0.8</span><span class="o">*</span><span class="n">delta_base</span><span class="p">[</span><span class="n">udistinf500</span><span class="p">]</span><span class="o">*</span><span class="n">dkm</span><span class="p">[</span><span class="n">udistinf500</span><span class="p">]</span><span class="o">/</span><span class="mf">0.5</span>

    <span class="n">kd</span>  <span class="o">=</span> <span class="mi">18</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Nlink</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">kd</span><span class="p">[</span><span class="n">uroofinfBS</span><span class="p">]</span> <span class="o">=</span> <span class="n">kd</span><span class="p">[</span><span class="n">uroofinfBS</span><span class="p">]</span><span class="o">-</span><span class="mi">15</span><span class="o">*</span><span class="n">delta_base</span><span class="p">[</span><span class="n">uroofinfBS</span><span class="p">]</span><span class="o">/</span><span class="n">hroof</span><span class="p">[</span><span class="n">uroofinfBS</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">city</span><span class="o">==</span><span class="s1">&#39;medium&#39;</span><span class="p">:</span>
        <span class="n">kf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">+</span><span class="mf">0.7</span><span class="o">*</span><span class="p">(</span><span class="n">fMHz</span><span class="o">/</span><span class="mf">925.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="o">+</span><span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">fMHz</span><span class="o">/</span><span class="mf">925.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">plmsd</span> <span class="o">=</span> <span class="n">plbsh</span><span class="o">+</span><span class="n">ka</span><span class="o">+</span><span class="n">kd</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dkm</span><span class="p">)</span><span class="o">+</span><span class="n">kf</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fMHz</span><span class="p">)</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span>

    <span class="n">pl</span> <span class="o">=</span> <span class="n">pl0</span>
    <span class="n">padd</span> <span class="o">=</span> <span class="n">plmsd</span> <span class="o">+</span> <span class="n">plrts</span>
    <span class="n">ulosspos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">padd</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pl</span><span class="p">[</span><span class="n">ulosspos</span><span class="p">]</span><span class="o">=</span><span class="n">pl</span><span class="p">[</span><span class="n">ulosspos</span><span class="p">]</span><span class="o">+</span><span class="n">padd</span><span class="p">[</span><span class="n">ulosspos</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pl</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span></div>

<div class="viewcode-block" id="cost259"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.cost259.html#pylayers.antprop.loss.cost259">[docs]</a><span class="k">def</span> <span class="nf">cost259</span><span class="p">(</span><span class="n">pMS</span><span class="p">,</span><span class="n">pBS</span><span class="p">,</span><span class="n">fMHz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cost259 model </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    pMS : np.array (position of Mobile Station)</span>
<span class="sd">    pBS : np.array (position of Base station)</span>
<span class="sd">    fMHz : float</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dm</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">))</span>
    <span class="n">lmbd</span> <span class="o">=</span> <span class="mi">300</span><span class="o">/</span><span class="n">fMHz</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mf">2.6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lmbd</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pl</span><span class="o">/</span><span class="mf">20.</span><span class="p">);</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span></div>

<div class="viewcode-block" id="hata"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.hata.html#pylayers.antprop.loss.hata">[docs]</a><span class="k">def</span> <span class="nf">hata</span><span class="p">(</span><span class="n">pMS</span><span class="p">,</span><span class="n">pBS</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">hMS</span><span class="p">,</span><span class="n">hBS</span><span class="p">,</span><span class="n">typ</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Hata Path loss model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    pMS : np.array</span>
<span class="sd">        Mobile position (meters)</span>
<span class="sd">    pBS : np.array</span>
<span class="sd">        Base station position (meters)</span>
<span class="sd">    fGHz : np.array</span>
<span class="sd">    hMS : height mobile station (m)</span>
<span class="sd">    hBS : height base station (m)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    L : Attenuation (dB)</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This model is valid until 1.5GHz, for higher frequency see</span>
<span class="sd">    COST231-Hata model</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    OKUMURA (Y.), OHMORI (E.), KAWANO (T.)</span>
<span class="sd">    et FUKUA (K.).  Field strength and its varia-</span>
<span class="sd">    bility in UHF and VHF land-mobile radio ser-</span>
<span class="sd">    vice. Rev. Elec. Commun. Lab., vol. 16, n o 9,</span>
<span class="sd">    1968.</span>

<span class="sd">    HATA (M.).  Empirical formula for propaga-</span>
<span class="sd">    tion loss in land mobile radio services. IEEE</span>
<span class="sd">    Trans. Veh. Technol., vol. 29, pp. 317-325,</span>
<span class="sd">    Aug. 1980</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dm</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;small&#39;</span><span class="p">):</span>
       <span class="n">CH</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fGHz</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span><span class="mf">0.7</span><span class="p">)</span><span class="o">*</span><span class="n">hMS</span><span class="o">-</span><span class="p">(</span><span class="mf">1.56</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fGHz</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;big&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fGHz</span><span class="o">&lt;</span><span class="mf">0.2</span><span class="p">:</span>
            <span class="n">CH</span> <span class="o">=</span> <span class="mf">8.29</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.54</span><span class="o">*</span><span class="n">hMS</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">1.1</span>
        <span class="k">else</span><span class="p">:</span><span class="c1"># valid until 1.5GHz</span>
            <span class="n">CH</span> <span class="o">=</span> <span class="mf">3.2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">11.75</span><span class="o">*</span><span class="n">hMS</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">4.97</span>

    <span class="n">L</span> <span class="o">=</span> <span class="mf">69.55</span><span class="o">+</span><span class="mf">26.16</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fGHz</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span><span class="mf">13.82</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">hBS</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mf">44.9</span><span class="o">-</span><span class="mf">6.55</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">hBS</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dm</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span><span class="o">-</span><span class="n">CH</span>

    <span class="k">return</span><span class="p">(</span><span class="n">L</span><span class="p">)</span></div>

<div class="viewcode-block" id="cost2100"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.cost2100.html#pylayers.antprop.loss.cost2100">[docs]</a><span class="k">def</span> <span class="nf">cost2100</span><span class="p">(</span><span class="n">pMS</span><span class="p">,</span><span class="n">pBS</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">nfloor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cost 2100 model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    pMS :</span>
<span class="sd">    pBS :</span>
<span class="sd">    fGHz : float</span>
<span class="sd">    nfloor : int</span>
<span class="sd">    dB : boolean</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># distance (meters)</span>
    <span class="n">dm</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pBS</span><span class="o">-</span><span class="n">pMS</span><span class="p">))</span>
    <span class="n">pl0</span> <span class="o">=</span> <span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
    <span class="n">pld</span> <span class="o">=</span> <span class="n">nfloor</span><span class="o">*</span><span class="mi">30</span>
    <span class="n">pl</span>  <span class="o">=</span> <span class="n">pl0</span><span class="o">+</span><span class="n">pld</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">pl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">pl</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pl</span><span class="p">)</span></div>

<div class="viewcode-block" id="PL"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.PL.html#pylayers.antprop.loss.PL">[docs]</a><span class="k">def</span> <span class="nf">PL</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">pts</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">d0</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate Free Space Path Loss</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz   : float</span>
<span class="sd">             frequency (GHz)</span>
<span class="sd">    pts    : np.array (2xNp)</span>
<span class="sd">             points</span>
<span class="sd">    p      : np.array (2x1) or (2xNp)</span>
<span class="sd">    n      : float</span>
<span class="sd">            path loss exponent (default = 2)</span>

<span class="sd">    dB : : boolean</span>
<span class="sd">        return result in dB</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL : np.array</span>
<span class="sd">         path loss w.r.t distance and frequency</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># assert(shp[0]==2)</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pts</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="c1"># f x grid x ap</span>
    <span class="c1">#PL = np.array([PL0(fGHz)])[:,np.newaxis] + 10*n*np.log10(D)[np.newaxis,:]</span>
    
    <span class="n">PL</span> <span class="o">=</span> <span class="n">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">d0</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">D</span><span class="o">/</span><span class="n">d0</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">PL</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">PL</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">PL</span><span class="p">)</span></div>

<div class="viewcode-block" id="Losst"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.Losst.html#pylayers.antprop.loss.Losst">[docs]</a><span class="k">def</span> <span class="nf">Losst</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  calculate Losses between links p1 p2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    L   : Layout object</span>
<span class="sd">    fGHz : np.array</span>
<span class="sd">           frequency GHz</span>
<span class="sd">    p1 : source points</span>
<span class="sd">        (2 x Np1) array or (2,) array</span>
<span class="sd">    p2 : observation point</span>
<span class="sd">        (2 x Np2) array or (2,) array</span>
<span class="sd">    dB : boolean</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.measures.mesuwb import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.loss import *</span>
<span class="sd">        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">        &gt;&gt;&gt; S.layout(&#39;WHERE1.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fGHz = 4</span>
<span class="sd">        &gt;&gt;&gt; Tx,Rx = ptw1()</span>
<span class="sd">        &gt;&gt;&gt; Lwo,Lwp,Edo,Edp = Losst(S.L,fGHz,Tx.T,Rx[1,0:2],dB=True)</span>
<span class="sd">        &gt;&gt;&gt; fig=plt.figure(figsize=(20,10))</span>
<span class="sd">        &gt;&gt;&gt; fig,ax = S.L.showGs(fig=fig)</span>
<span class="sd">        &gt;&gt;&gt; tit = plt.title(&#39;test Losst&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sc2 = ax.scatter(Rx[1,0],Rx[1,1],s=20,marker=&#39;x&#39;,c=&#39;k&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sc1 = ax.scatter(Tx[:,0],Tx[:,1],s=20,c=Lwo,linewidth=0)</span>
<span class="sd">        &gt;&gt;&gt; cb = plt.colorbar(sc1)</span>
<span class="sd">        &gt;&gt;&gt; cb.set_label(&#39;dB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    pylayers.antprop.coverage</span>
<span class="sd">    pylayers.slab.Interface.losst</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fGHz</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">sh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">sh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># determine incidence angles on segment crossing p1-p2 segment</span>
    <span class="c1">#data = L.angleonlink(p1,p2)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">angleonlink3</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
    
    <span class="c1"># as many slabs as segments and subsegments</span>
    <span class="n">us</span>    <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> 
    <span class="n">slabs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">us</span> <span class="p">])</span>





    <span class="c1">#slabs = L.sla[us]</span>
    <span class="n">check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slabs</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># As segment numbering is not necessarily contiguous </span>
    <span class="c1"># there exist void string &#39;&#39; in slabs</span>
    <span class="n">cslab</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">slabs</span><span class="p">))</span>
    <span class="k">if</span> <span class="s1">&#39;&#39;</span> <span class="ow">in</span> <span class="n">cslab</span><span class="p">:</span>
        <span class="n">cslab</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;AIR&#39;</span> <span class="ow">in</span> <span class="n">cslab</span><span class="p">:</span>
        <span class="n">cslab</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;AIR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;_AIR&#39;</span> <span class="ow">in</span> <span class="n">cslab</span><span class="p">:</span>
        <span class="n">cslab</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;_AIR&#39;</span><span class="p">)</span>


    <span class="n">LossWallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">LossWallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">EdWallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">EdWallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">slname</span> <span class="ow">in</span> <span class="n">cslab</span><span class="p">:</span>
        <span class="c1"># u index of slabs of name slname</span>
        <span class="c1"># data[&#39;a&#39;][u] angle</span>
        <span class="c1"># data[&#39;s&#39;][u] segment number including subsegment</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">slabs</span><span class="p">)</span><span class="o">==</span><span class="n">slname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># calculate Loss for slab slname</span>
        <span class="c1">#</span>
        <span class="n">lko</span><span class="p">,</span><span class="n">lkp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">losst</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># calculate Excess delay for slab slname</span>
        <span class="c1">#</span>
        <span class="n">do</span> <span class="p">,</span> <span class="n">dp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">excess_grdelay</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">])</span>
        <span class="c1"># data[&#39;i&#39;][u] links number</span>
        <span class="n">indexu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">]</span>
        <span class="c1"># reduce to involved links</span>
        <span class="n">involved_links</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">indexu</span><span class="p">,</span><span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">indicep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">indexu</span><span class="p">)])))</span>
        <span class="c1"># range on involved links</span>
        <span class="n">irange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">involved_links</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># sum contribution of slab of a same link</span>
        <span class="c1">#</span>
        <span class="n">Wallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lko</span><span class="p">[:,</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Wallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lkp</span><span class="p">[:,</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">Edo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">do</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]]),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Edp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]]),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">LossWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">LossWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wallo</span>
        <span class="n">LossWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">LossWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wallp</span>

        <span class="n">EdWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">EdWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Edo</span>
        <span class="n">EdWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">EdWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Edp</span>


    <span class="c1"># Managing Ceil / Floor transmission</span>


    <span class="c1"># check crossing ceil</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">&gt;</span> <span class="n">L</span><span class="o">.</span><span class="n">zceil</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">&gt;</span> <span class="n">L</span><span class="o">.</span><span class="n">zceil</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>

        <span class="c1"># WARNING : this test sohould be done individually</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p1</span>

        <span class="n">uu</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">-</span> <span class="n">v1</span>
        <span class="c1"># 1 x N</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">uu</span> <span class="o">*</span> <span class="n">uu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># 3 x N</span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">uu</span> <span class="o">/</span> <span class="n">nu</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">dotp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,i-&gt;j&#39;</span><span class="p">,</span><span class="n">un</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dotp</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># calculate Loss for slab CEIL</span>
        <span class="c1">#</span>
        <span class="n">lkco</span><span class="p">,</span><span class="n">lkcp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="s1">&#39;CEIL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">losst</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">alphas</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># calculate Excess delay for slab CEIL</span>
        <span class="c1">#</span>
        <span class="n">dco</span> <span class="p">,</span> <span class="n">dcp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="s1">&#39;CEIL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">excess_grdelay</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>



        <span class="n">LossWallo</span> <span class="o">=</span> <span class="n">LossWallo</span> <span class="o">+</span> <span class="n">lkco</span>
        <span class="n">LossWallp</span> <span class="o">=</span> <span class="n">LossWallp</span> <span class="o">+</span> <span class="n">lkcp</span>

        <span class="n">EdWallo</span> <span class="o">=</span> <span class="n">EdWallo</span> <span class="o">+</span> <span class="n">dco</span>
        <span class="n">EdWallp</span> <span class="o">=</span> <span class="n">EdWallp</span> <span class="o">+</span> <span class="n">dcp</span>


    <span class="c1"># check crossing floor</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">&lt;</span> <span class="n">L</span><span class="o">.</span><span class="n">zfloor</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">&lt;</span> <span class="n">L</span><span class="o">.</span><span class="n">zfloor</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>


        <span class="c1"># WARNING : this test sohould be done individually</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">p2</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v0</span> <span class="o">=</span> <span class="n">p2</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p1</span>

        <span class="n">uu</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">-</span> <span class="n">v1</span>
        <span class="c1"># 1 x N</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">uu</span> <span class="o">*</span> <span class="n">uu</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># 3 x N</span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">uu</span> <span class="o">/</span> <span class="n">nu</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">dotp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,i-&gt;j&#39;</span><span class="p">,</span><span class="n">un</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">dotp</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># calculate Loss for slab CEIL</span>
        <span class="c1">#</span>
        <span class="n">lkfo</span><span class="p">,</span><span class="n">lkfp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="s1">&#39;FLOOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">losst</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">alphas</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># calculate Excess delay for slab CEIL</span>
        <span class="c1">#</span>
        <span class="n">dfo</span> <span class="p">,</span> <span class="n">dfp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="s1">&#39;FLOOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">excess_grdelay</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">alphas</span><span class="p">)</span>



        <span class="n">LossWallo</span> <span class="o">=</span> <span class="n">LossWallo</span> <span class="o">+</span> <span class="n">lkfo</span>
        <span class="n">LossWallp</span> <span class="o">=</span> <span class="n">LossWallp</span> <span class="o">+</span> <span class="n">lkfp</span>

        <span class="n">EdWallo</span> <span class="o">=</span> <span class="n">EdWallo</span> <span class="o">+</span> <span class="n">dfo</span>
        <span class="n">EdWallp</span> <span class="o">=</span> <span class="n">EdWallp</span> <span class="o">+</span> <span class="n">dfp</span>


    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">LossWallo</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">LossWallo</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">LossWallp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">LossWallp</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">LossWallo</span><span class="p">,</span><span class="n">LossWallp</span><span class="p">,</span><span class="n">EdWallo</span><span class="p">,</span><span class="n">EdWallp</span><span class="p">)</span></div>

<div class="viewcode-block" id="gaspl"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.gaspl.html#pylayers.antprop.loss.gaspl">[docs]</a><span class="k">def</span> <span class="nf">gaspl</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">PhPa</span><span class="p">,</span><span class="n">wvden</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; attenuation due to atmospheric gases</span>

<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    d : np.array</span>
<span class="sd">        range (meters) </span>
<span class="sd">    fGHz : np.array </span>
<span class="sd">        frequency (GHz)</span>
<span class="sd">    T : float </span>
<span class="sd">        Temprature in degree Celcius</span>
<span class="sd">    PhPa : float</span>
<span class="sd">        Pressure in hPa</span>
<span class="sd">    wvden : float</span>
<span class="sd">        Water vapor density (g/m**3)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np </span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt </span>
<span class="sd">    &gt;&gt;&gt; T = 15</span>
<span class="sd">    &gt;&gt;&gt; PhPa = 1013</span>
<span class="sd">    &gt;&gt;&gt; wvden = 7.5</span>
<span class="sd">    &gt;&gt;&gt; d = 1000</span>
<span class="sd">    &gt;&gt;&gt; fGHz = np.linspace(1,1000,100)</span>
<span class="sd">    &gt;&gt;&gt; L = gaspl(d,fGHz,T,PhPa,wvden)</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(fGHz,L)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    This function implements the recommandation UIT-P676-10</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">affO2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">50.474214</span><span class="p">,</span><span class="mf">0.975</span><span class="p">,</span><span class="mf">9.651</span><span class="p">,</span><span class="mf">6.690</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.566</span><span class="p">,</span><span class="mf">6.850</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">50.987745</span><span class="p">,</span><span class="mf">2.529</span><span class="p">,</span><span class="mf">8.653</span><span class="p">,</span><span class="mf">7.170</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.246</span><span class="p">,</span><span class="mf">6.800</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">51.503360</span><span class="p">,</span><span class="mf">6.193</span><span class="p">,</span><span class="mf">7.709</span><span class="p">,</span><span class="mf">7.640</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.947</span><span class="p">,</span><span class="mf">6.729</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">52.021429</span><span class="p">,</span><span class="mf">14.320</span><span class="p">,</span><span class="mf">6.819</span><span class="p">,</span><span class="mf">8.110</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.667</span><span class="p">,</span><span class="mf">6.640</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">52.542418</span><span class="p">,</span><span class="mf">31.240</span><span class="p">,</span><span class="mf">5.983</span><span class="p">,</span><span class="mf">8.580</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.388</span><span class="p">,</span><span class="mf">6.526</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">53.066934</span><span class="p">,</span><span class="mf">64.290</span><span class="p">,</span><span class="mf">5.201</span><span class="p">,</span><span class="mf">9.060</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.349</span><span class="p">,</span><span class="mf">6.206</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">53.595775</span><span class="p">,</span><span class="mf">124.600</span><span class="p">,</span><span class="mf">4.474</span><span class="p">,</span><span class="mf">9.550</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.227</span><span class="p">,</span><span class="mf">5.085</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">54.130025</span><span class="p">,</span><span class="mf">227.300</span><span class="p">,</span><span class="mf">3.800</span><span class="p">,</span><span class="mf">9.960</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.170</span><span class="p">,</span><span class="mf">3.750</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">54.671180</span><span class="p">,</span><span class="mf">389.700</span><span class="p">,</span><span class="mf">3.182</span><span class="p">,</span><span class="mf">10.370</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.558</span><span class="p">,</span><span class="mf">2.654</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">55.221384</span><span class="p">,</span><span class="mf">627.100</span><span class="p">,</span><span class="mf">2.618</span><span class="p">,</span><span class="mf">10.890</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.560</span><span class="p">,</span><span class="mf">2.952</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">55.783815</span><span class="p">,</span><span class="mf">945.300</span><span class="p">,</span><span class="mf">2.109</span><span class="p">,</span><span class="mf">11.340</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.172</span><span class="p">,</span><span class="mf">6.135</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">56.264774</span><span class="p">,</span><span class="mf">543.400</span><span class="p">,</span><span class="mf">0.014</span><span class="p">,</span><span class="mf">17.030</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.525</span><span class="p">,</span><span class="o">-</span><span class="mf">0.978</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">56.363399</span><span class="p">,</span><span class="mf">1331.800</span><span class="p">,</span><span class="mf">1.654</span><span class="p">,</span><span class="mf">11.890</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.378</span><span class="p">,</span><span class="mf">6.547</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">56.968211</span><span class="p">,</span><span class="mf">1746.600</span><span class="p">,</span><span class="mf">1.255</span><span class="p">,</span><span class="mf">12.230</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">3.545</span><span class="p">,</span><span class="mf">6.451</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">57.612486</span><span class="p">,</span><span class="mf">2120.100</span><span class="p">,</span><span class="mf">0.910</span><span class="p">,</span><span class="mf">12.620</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">5.416</span><span class="p">,</span><span class="mf">6.056</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">58.323877</span><span class="p">,</span><span class="mf">2363.700</span><span class="p">,</span><span class="mf">0.621</span><span class="p">,</span><span class="mf">12.950</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.932</span><span class="p">,</span><span class="mf">0.436</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">58.446588</span><span class="p">,</span><span class="mf">1442.100</span><span class="p">,</span><span class="mf">0.083</span><span class="p">,</span><span class="mf">14.910</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.768</span><span class="p">,</span><span class="o">-</span><span class="mf">1.273</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">59.164204</span><span class="p">,</span><span class="mf">2379.900</span><span class="p">,</span><span class="mf">0.387</span><span class="p">,</span><span class="mf">13.530</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">6.561</span><span class="p">,</span><span class="mf">2.309</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">59.590983</span><span class="p">,</span><span class="mf">2090.700</span><span class="p">,</span><span class="mf">0.207</span><span class="p">,</span><span class="mf">14.080</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.957</span><span class="p">,</span><span class="o">-</span><span class="mf">0.776</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">60.306056</span><span class="p">,</span><span class="mf">2103.400</span><span class="p">,</span><span class="mf">0.207</span><span class="p">,</span><span class="mf">14.150</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">6.395</span><span class="p">,</span><span class="mf">0.699</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">60.434778</span><span class="p">,</span><span class="mf">2438.000</span><span class="p">,</span><span class="mf">0.386</span><span class="p">,</span><span class="mf">13.390</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">6.342</span><span class="p">,</span><span class="o">-</span><span class="mf">2.825</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">61.150562</span><span class="p">,</span><span class="mf">2479.500</span><span class="p">,</span><span class="mf">0.621</span><span class="p">,</span><span class="mf">12.920</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.014</span><span class="p">,</span><span class="o">-</span><span class="mf">0.584</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">61.800158</span><span class="p">,</span><span class="mf">2275.900</span><span class="p">,</span><span class="mf">0.910</span><span class="p">,</span><span class="mf">12.630</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">5.014</span><span class="p">,</span><span class="o">-</span><span class="mf">6.619</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">62.411220</span><span class="p">,</span><span class="mf">1915.400</span><span class="p">,</span><span class="mf">1.255</span><span class="p">,</span><span class="mf">12.170</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">3.029</span><span class="p">,</span><span class="o">-</span><span class="mf">6.759</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">62.486253</span><span class="p">,</span><span class="mf">1503.000</span><span class="p">,</span><span class="mf">0.083</span><span class="p">,</span><span class="mf">15.130</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">4.499</span><span class="p">,</span><span class="mf">0.844</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">62.997984</span><span class="p">,</span><span class="mf">1490.200</span><span class="p">,</span><span class="mf">1.654</span><span class="p">,</span><span class="mf">11.740</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.856</span><span class="p">,</span><span class="o">-</span><span class="mf">6.675</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">63.568526</span><span class="p">,</span><span class="mf">1078.000</span><span class="p">,</span><span class="mf">2.108</span><span class="p">,</span><span class="mf">11.340</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.658</span><span class="p">,</span><span class="o">-</span><span class="mf">6.139</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">64.127775</span><span class="p">,</span><span class="mf">728.700</span><span class="p">,</span><span class="mf">2.617</span><span class="p">,</span><span class="mf">10.880</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">3.036</span><span class="p">,</span><span class="o">-</span><span class="mf">2.895</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">64.678910</span><span class="p">,</span><span class="mf">461.300</span><span class="p">,</span><span class="mf">3.181</span><span class="p">,</span><span class="mf">10.380</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">3.968</span><span class="p">,</span><span class="o">-</span><span class="mf">2.590</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">65.224078</span><span class="p">,</span><span class="mf">274.000</span><span class="p">,</span><span class="mf">3.800</span><span class="p">,</span><span class="mf">9.960</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">3.528</span><span class="p">,</span><span class="o">-</span><span class="mf">3.680</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">65.764779</span><span class="p">,</span><span class="mf">153.000</span><span class="p">,</span><span class="mf">4.473</span><span class="p">,</span><span class="mf">9.550</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.548</span><span class="p">,</span><span class="o">-</span><span class="mf">5.002</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">66.302096</span><span class="p">,</span><span class="mf">80.400</span><span class="p">,</span><span class="mf">5.200</span><span class="p">,</span><span class="mf">9.060</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.660</span><span class="p">,</span><span class="o">-</span><span class="mf">6.091</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">66.836834</span><span class="p">,</span><span class="mf">39.800</span><span class="p">,</span><span class="mf">5.982</span><span class="p">,</span><span class="mf">8.580</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.680</span><span class="p">,</span><span class="o">-</span><span class="mf">6.393</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">67.369601</span><span class="p">,</span><span class="mf">18.560</span><span class="p">,</span><span class="mf">6.818</span><span class="p">,</span><span class="mf">8.110</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.956</span><span class="p">,</span><span class="o">-</span><span class="mf">6.475</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">67.900868</span><span class="p">,</span><span class="mf">8.172</span><span class="p">,</span><span class="mf">7.708</span><span class="p">,</span><span class="mf">7.640</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.216</span><span class="p">,</span><span class="o">-</span><span class="mf">6.545</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">68.431006</span><span class="p">,</span><span class="mf">3.397</span><span class="p">,</span><span class="mf">8.652</span><span class="p">,</span><span class="mf">7.170</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.492</span><span class="p">,</span><span class="o">-</span><span class="mf">6.600</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">68.960312</span><span class="p">,</span><span class="mf">1.334</span><span class="p">,</span><span class="mf">9.650</span><span class="p">,</span><span class="mf">6.690</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.773</span><span class="p">,</span><span class="o">-</span><span class="mf">6.650</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">118.750334</span><span class="p">,</span><span class="mf">940.300</span><span class="p">,</span><span class="mf">0.010</span><span class="p">,</span><span class="mf">16.640</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">0.439</span><span class="p">,</span><span class="mf">0.079</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">368.498246</span><span class="p">,</span><span class="mf">67.400</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">16.400</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">424.763020</span><span class="p">,</span><span class="mf">637.700</span><span class="p">,</span><span class="mf">0.044</span><span class="p">,</span><span class="mf">16.400</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">487.249273</span><span class="p">,</span><span class="mf">237.400</span><span class="p">,</span><span class="mf">0.049</span><span class="p">,</span><span class="mf">16.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">715.392902</span><span class="p">,</span><span class="mf">98.100</span><span class="p">,</span><span class="mf">0.145</span><span class="p">,</span><span class="mf">16.000</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">773.839490</span><span class="p">,</span><span class="mf">572.300</span><span class="p">,</span><span class="mf">0.141</span><span class="p">,</span><span class="mf">16.200</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">834.145546</span><span class="p">,</span><span class="mf">183.100</span><span class="p">,</span><span class="mf">0.145</span><span class="p">,</span><span class="mf">14.700</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.000</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]])</span>
    <span class="c1">## spectroscopic data for H20</span>
    <span class="c1">## f0 b1 b2 b3 b4 b5 b6</span>
    <span class="n">affH2O</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">22.235080</span><span class="p">,</span><span class="mf">0.1130</span><span class="p">,</span><span class="mf">2.143</span><span class="p">,</span><span class="mf">28.11</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">4.800</span><span class="p">,</span><span class="mf">1.00</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">67.803960</span><span class="p">,</span><span class="mf">0.0012</span><span class="p">,</span><span class="mf">8.735</span><span class="p">,</span><span class="mf">28.58</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">4.930</span><span class="p">,</span><span class="mf">0.82</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">119.995940</span><span class="p">,</span><span class="mf">0.0008</span><span class="p">,</span><span class="mf">8.356</span><span class="p">,</span><span class="mf">29.48</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">4.780</span><span class="p">,</span><span class="mf">0.79</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">183.310091</span><span class="p">,</span><span class="mf">2.4200</span><span class="p">,</span><span class="mf">0.668</span><span class="p">,</span><span class="mf">30.50</span><span class="p">,</span><span class="mf">0.64</span><span class="p">,</span><span class="mf">5.300</span><span class="p">,</span><span class="mf">0.85</span><span class="p">,],</span>
    <span class="p">[</span><span class="mf">321.225644</span><span class="p">,</span><span class="mf">0.0483</span><span class="p">,</span><span class="mf">6.181</span><span class="p">,</span><span class="mf">23.03</span><span class="p">,</span><span class="mf">0.67</span><span class="p">,</span><span class="mf">4.690</span><span class="p">,</span><span class="mf">0.54</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">325.152919</span><span class="p">,</span><span class="mf">1.4990</span><span class="p">,</span><span class="mf">1.540</span><span class="p">,</span><span class="mf">27.83</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="mf">4.850</span><span class="p">,</span><span class="mf">0.74</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">336.222601</span><span class="p">,</span><span class="mf">0.0011</span><span class="p">,</span><span class="mf">9.829</span><span class="p">,</span><span class="mf">26.93</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">4.740</span><span class="p">,</span><span class="mf">0.61</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">380.197372</span><span class="p">,</span><span class="mf">11.5200</span><span class="p">,</span><span class="mf">1.048</span><span class="p">,</span><span class="mf">28.73</span><span class="p">,</span><span class="mf">0.54</span><span class="p">,</span><span class="mf">5.380</span><span class="p">,</span><span class="mf">0.89</span><span class="p">,],</span>
    <span class="p">[</span><span class="mf">390.134508</span><span class="p">,</span><span class="mf">0.0046</span><span class="p">,</span><span class="mf">7.350</span><span class="p">,</span><span class="mf">21.52</span><span class="p">,</span><span class="mf">0.63</span><span class="p">,</span><span class="mf">4.810</span><span class="p">,</span><span class="mf">0.55</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">437.346667</span><span class="p">,</span><span class="mf">0.0650</span><span class="p">,</span><span class="mf">5.050</span><span class="p">,</span><span class="mf">18.45</span><span class="p">,</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">4.230</span><span class="p">,</span><span class="mf">0.48</span><span class="p">,],</span>
    <span class="p">[</span><span class="mf">439.150812</span><span class="p">,</span><span class="mf">0.9218</span><span class="p">,</span><span class="mf">3.596</span><span class="p">,</span><span class="mf">21.00</span><span class="p">,</span><span class="mf">0.63</span><span class="p">,</span><span class="mf">4.290</span><span class="p">,</span><span class="mf">0.52</span><span class="p">,],</span>
    <span class="p">[</span><span class="mf">443.018295</span><span class="p">,</span><span class="mf">0.1976</span><span class="p">,</span><span class="mf">5.050</span><span class="p">,</span><span class="mf">18.60</span><span class="p">,</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">4.230</span><span class="p">,</span><span class="mf">0.50</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">448.001075</span><span class="p">,</span><span class="mf">10.3200</span><span class="p">,</span><span class="mf">1.405</span><span class="p">,</span><span class="mf">26.32</span><span class="p">,</span><span class="mf">0.66</span><span class="p">,</span><span class="mf">4.840</span><span class="p">,</span><span class="mf">0.67</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">470.888947</span><span class="p">,</span><span class="mf">0.3297</span><span class="p">,</span><span class="mf">3.599</span><span class="p">,</span><span class="mf">21.52</span><span class="p">,</span><span class="mf">0.66</span><span class="p">,</span><span class="mf">4.570</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,],</span>
    <span class="p">[</span><span class="mf">474.689127</span><span class="p">,</span><span class="mf">1.2620</span><span class="p">,</span><span class="mf">2.381</span><span class="p">,</span><span class="mf">23.55</span><span class="p">,</span><span class="mf">0.65</span><span class="p">,</span><span class="mf">4.650</span><span class="p">,</span><span class="mf">0.64</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">488.491133</span><span class="p">,</span><span class="mf">0.2520</span><span class="p">,</span><span class="mf">2.853</span><span class="p">,</span><span class="mf">26.02</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">5.040</span><span class="p">,</span><span class="mf">0.72</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">503.568532</span><span class="p">,</span><span class="mf">0.0390</span><span class="p">,</span><span class="mf">6.733</span><span class="p">,</span><span class="mf">16.12</span><span class="p">,</span><span class="mf">0.61</span><span class="p">,</span><span class="mf">3.980</span><span class="p">,</span><span class="mf">0.43</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">504.482692</span><span class="p">,</span><span class="mf">0.0130</span><span class="p">,</span><span class="mf">6.733</span><span class="p">,</span><span class="mf">16.12</span><span class="p">,</span><span class="mf">0.61</span><span class="p">,</span><span class="mf">4.010</span><span class="p">,</span><span class="mf">0.45</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">547.676440</span><span class="p">,</span><span class="mf">9.7010</span><span class="p">,</span><span class="mf">0.114</span><span class="p">,</span><span class="mf">26.00</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">4.500</span><span class="p">,</span><span class="mf">1.00</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">552.020960</span><span class="p">,</span><span class="mf">14.7700</span><span class="p">,</span><span class="mf">0.114</span><span class="p">,</span><span class="mf">26.00</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">4.500</span><span class="p">,</span><span class="mf">1.00</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">556.936002</span><span class="p">,</span><span class="mf">487.4000</span><span class="p">,</span><span class="mf">0.159</span><span class="p">,</span><span class="mf">32.10</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">4.110</span><span class="p">,</span><span class="mf">1.00</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">620.700807</span><span class="p">,</span><span class="mf">5.0120</span><span class="p">,</span><span class="mf">2.200</span><span class="p">,</span><span class="mf">24.38</span><span class="p">,</span><span class="mf">0.71</span><span class="p">,</span><span class="mf">4.680</span><span class="p">,</span><span class="mf">0.68</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">645.866155</span><span class="p">,</span><span class="mf">0.0713</span><span class="p">,</span><span class="mf">8.580</span><span class="p">,</span><span class="mf">18.00</span><span class="p">,</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">4.000</span><span class="p">,</span><span class="mf">0.50</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">658.005280</span><span class="p">,</span><span class="mf">0.3022</span><span class="p">,</span><span class="mf">7.820</span><span class="p">,</span><span class="mf">32.10</span><span class="p">,</span><span class="mf">0.69</span><span class="p">,</span><span class="mf">4.140</span><span class="p">,</span><span class="mf">1.00</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">752.033227</span><span class="p">,</span><span class="mf">239.6000</span><span class="p">,</span><span class="mf">0.396</span><span class="p">,</span><span class="mf">30.60</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="mf">4.090</span><span class="p">,</span><span class="mf">0.84</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">841.053973</span><span class="p">,</span><span class="mf">0.0140</span><span class="p">,</span><span class="mf">8.180</span><span class="p">,</span><span class="mf">15.90</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">5.760</span><span class="p">,</span><span class="mf">0.45</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">859.962313</span><span class="p">,</span><span class="mf">0.1472</span><span class="p">,</span><span class="mf">7.989</span><span class="p">,</span><span class="mf">30.60</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="mf">4.090</span><span class="p">,</span><span class="mf">0.84</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">899.306675</span><span class="p">,</span><span class="mf">0.0605</span><span class="p">,</span><span class="mf">7.917</span><span class="p">,</span><span class="mf">29.85</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="mf">4.530</span><span class="p">,</span><span class="mf">0.90</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">902.616173</span><span class="p">,</span><span class="mf">0.0426</span><span class="p">,</span><span class="mf">8.432</span><span class="p">,</span><span class="mf">28.65</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">5.100</span><span class="p">,</span><span class="mf">0.95</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">906.207325</span><span class="p">,</span><span class="mf">0.1876</span><span class="p">,</span><span class="mf">5.111</span><span class="p">,</span><span class="mf">24.08</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">4.700</span><span class="p">,</span><span class="mf">0.53</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">916.171582</span><span class="p">,</span><span class="mf">8.3400</span><span class="p">,</span><span class="mf">1.442</span><span class="p">,</span><span class="mf">26.70</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">4.780</span><span class="p">,</span><span class="mf">0.78</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">923.118427</span><span class="p">,</span><span class="mf">0.0869</span><span class="p">,</span><span class="mf">10.220</span><span class="p">,</span><span class="mf">29.00</span><span class="p">,</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">5.000</span><span class="p">,</span><span class="mf">0.80</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">970.315022</span><span class="p">,</span><span class="mf">8.9720</span><span class="p">,</span><span class="mf">1.920</span><span class="p">,</span><span class="mf">25.50</span><span class="p">,</span><span class="mf">0.64</span><span class="p">,</span><span class="mf">4.940</span><span class="p">,</span><span class="mf">0.67</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">987.926764</span><span class="p">,</span><span class="mf">132.1000</span><span class="p">,</span><span class="mf">0.258</span><span class="p">,</span><span class="mf">29.85</span><span class="p">,</span><span class="mf">0.68</span><span class="p">,</span><span class="mf">4.550</span><span class="p">,</span><span class="mf">0.90</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1780.000000</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mf">300.0000</span><span class="p">,</span><span class="mf">0.952</span><span class="p">,</span><span class="mf">176.20</span><span class="p">,</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">30.500</span><span class="p">]])</span>
    
    <span class="n">dkm</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">1000.</span>
    <span class="n">TK</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="mf">273.15</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mf">300.</span><span class="o">/</span><span class="n">TK</span> <span class="c1">#3</span>

    <span class="n">fO2</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">a4</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">a5</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">a6</span> <span class="o">=</span> <span class="n">affO2</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">fH2O</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">b3</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">b4</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">b5</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">b6</span> <span class="o">=</span> <span class="n">affH2O</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">wvden</span><span class="o">*</span><span class="n">TK</span><span class="o">/</span><span class="mf">216.7</span>  <span class="c1"># 4</span>

    <span class="n">SO2</span>  <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="mf">1e-7</span><span class="o">*</span><span class="n">PhPa</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">))</span>  <span class="c1"># 3</span>
    <span class="n">DO2</span>  <span class="o">=</span> <span class="n">a3</span><span class="o">*</span><span class="mf">1e-4</span><span class="o">*</span><span class="p">(</span><span class="n">PhPa</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">**</span><span class="p">(</span><span class="mf">0.8</span><span class="o">-</span><span class="n">a4</span><span class="p">))</span><span class="o">+</span><span class="mf">1.1</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>  <span class="c1"># 6a</span>

    <span class="n">SH2O</span> <span class="o">=</span> <span class="n">b1</span><span class="o">*</span><span class="mf">1e-1</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">**</span><span class="p">(</span><span class="mf">3.5</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">))</span> <span class="c1"># 3</span>
    <span class="n">DH2O</span> <span class="o">=</span> <span class="n">b3</span><span class="o">*</span><span class="mf">1e-4</span><span class="o">*</span><span class="p">(</span><span class="n">PhPa</span><span class="o">*</span><span class="n">theta</span><span class="o">**</span><span class="n">b4</span><span class="o">+</span><span class="n">b5</span><span class="o">*</span><span class="n">e</span><span class="o">*</span><span class="n">theta</span><span class="o">**</span><span class="n">b6</span><span class="p">)</span>  <span class="c1"># 6a</span>

    <span class="n">DO2_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DO2</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">2.25e-6</span><span class="p">)</span> <span class="c1"># 6b</span>
    <span class="n">DH2O_m</span> <span class="o">=</span> <span class="mf">0.535</span><span class="o">*</span><span class="n">DH2O</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.217</span><span class="o">*</span><span class="n">DH2O</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="mf">2.1316</span><span class="o">*</span><span class="mf">1e-12</span><span class="o">*</span><span class="n">fH2O</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">deltaO2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a5</span><span class="o">+</span><span class="n">a6</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-4</span><span class="o">*</span><span class="p">(</span><span class="n">PhPa</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">theta</span><span class="o">**</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1">#  O2</span>
    <span class="c1">#</span>
    <span class="n">uO2</span> <span class="o">=</span> <span class="n">fO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">vO2</span> <span class="o">=</span> <span class="n">fO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">n1O2</span> <span class="o">=</span> <span class="n">DO2_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">deltaO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">uO2</span>
    <span class="n">n2O2</span> <span class="o">=</span> <span class="n">DO2_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">deltaO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">vO2</span>
    <span class="n">d1O2</span> <span class="o">=</span> <span class="n">uO2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">DO2_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">d2O2</span> <span class="o">=</span> <span class="n">vO2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">DO2_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">FO2</span> <span class="o">=</span> <span class="p">(</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="n">fO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">n1O2</span><span class="o">/</span><span class="n">d1O2</span><span class="o">+</span><span class="n">n2O2</span><span class="o">/</span><span class="n">d2O2</span><span class="p">)</span>
    <span class="n">UO2</span> <span class="o">=</span> <span class="n">SO2</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">FO2</span>
    <span class="c1">#</span>
    <span class="c1"># H2O</span>
    <span class="c1">#</span>
    <span class="n">uH2O</span> <span class="o">=</span> <span class="n">fH2O</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">vH2O</span> <span class="o">=</span> <span class="n">fH2O</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
    <span class="n">nH2O</span> <span class="o">=</span> <span class="n">DH2O_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
    <span class="n">d1H2O</span> <span class="o">=</span> <span class="n">uH2O</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">DH2O_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">d2H2O</span> <span class="o">=</span> <span class="n">vH2O</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">DH2O_m</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">FH2O</span> <span class="o">=</span> <span class="p">(</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="n">fH2O</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">nH2O</span><span class="o">/</span><span class="n">d1H2O</span><span class="o">+</span><span class="n">nH2O</span><span class="o">/</span><span class="n">d2H2O</span><span class="p">)</span>
    <span class="n">UH2O</span> <span class="o">=</span> <span class="n">SH2O</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">FH2O</span>

    <span class="c1"># Nsec  (8)</span>
    
    <span class="n">dD</span> <span class="o">=</span> <span class="mf">5.6e-4</span><span class="o">*</span><span class="p">(</span><span class="n">PhPa</span><span class="o">+</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">theta</span><span class="o">**</span><span class="p">(</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="mf">6.14e-5</span><span class="o">/</span><span class="p">(</span><span class="n">dD</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="p">(</span><span class="n">fGHz</span><span class="o">/</span><span class="n">dD</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="mf">1.4e-12</span><span class="o">*</span><span class="n">PhPa</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1.9e-5</span><span class="o">*</span><span class="n">fGHz</span><span class="o">**</span><span class="p">(</span><span class="mf">1.5</span><span class="p">))</span>
    <span class="n">Nsec</span> <span class="o">=</span> <span class="n">fGHz</span><span class="o">*</span><span class="n">PhPa</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">t2</span><span class="p">)</span>  <span class="c1"># 9 </span>
    
    <span class="n">ulow</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fGHz</span><span class="o">&lt;</span><span class="mf">118.750343</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">uhigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fGHz</span><span class="o">&gt;=</span><span class="mf">118.750343</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">UO2low</span> <span class="o">=</span> <span class="n">UO2</span><span class="p">[:,</span><span class="n">ulow</span><span class="p">]</span>
    <span class="n">UO2high</span> <span class="o">=</span> <span class="n">UO2</span><span class="p">[:,</span><span class="n">uhigh</span><span class="p">]</span> 
    <span class="n">SO2low</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">UO2low</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">SO2high</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">UO2high</span><span class="p">[</span><span class="mi">38</span><span class="p">:,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sSO2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">SO2low</span><span class="p">,</span><span class="n">SO2high</span><span class="p">))</span>
    <span class="n">Npp</span> <span class="o">=</span> <span class="n">sSO2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">UH2O</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">Nsec</span>
    <span class="n">Npp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">UO2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">UH2O</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">Nsec</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">0.1820</span><span class="o">*</span><span class="n">fGHz</span><span class="o">*</span><span class="n">Npp</span> 
    <span class="n">LgasdB</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">*</span><span class="n">dkm</span> 

    <span class="k">return</span><span class="p">(</span><span class="n">LgasdB</span><span class="p">)</span></div>


<div class="viewcode-block" id="Loss0"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.Loss0.html#pylayers.antprop.loss.Loss0">[docs]</a><span class="k">def</span> <span class="nf">Loss0</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate Loss through Layers for theta=0 deg</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    S  : Simulation object</span>
<span class="sd">    rx : extremity of link </span>
<span class="sd">    ry : extremity of link </span>
<span class="sd">    fGHz : float</span>
<span class="sd">        frequency GHz</span>
<span class="sd">    p :</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nx</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
    <span class="n">Ny</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
    <span class="n">Lw</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">))</span>
    <span class="k">print</span> <span class="n">shape</span><span class="p">(</span><span class="n">Lw</span><span class="p">)</span>
    <span class="n">i</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rx</span><span class="p">:</span>
        <span class="n">j</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ry</span><span class="p">:</span>
            <span class="n">Loss</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
            <span class="n">seglist</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">angleonlinkold</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pxy</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">lk</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">loss0</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">Loss</span>  <span class="o">=</span> <span class="n">Loss</span> <span class="o">+</span> <span class="n">lk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Lw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Loss</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Lw</span><span class="p">)</span></div>

<div class="viewcode-block" id="Loss_diff"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.Loss_diff.html#pylayers.antprop.loss.Loss_diff">[docs]</a><span class="k">def</span> <span class="nf">Loss_diff</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate Path Loss of the diffraction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mf">6.9</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">u</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">u</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Ld</span><span class="p">)</span></div>

<div class="viewcode-block" id="calnu"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.calnu.html#pylayers.antprop.loss.calnu">[docs]</a><span class="k">def</span> <span class="nf">calnu</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">fGHz</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot; Calculate the diffraction Fresnel parameter</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    h  : signed height w.r.t LOS (meter)</span>
<span class="sd">    d1 : distance 1 (meter)</span>
<span class="sd">    d2 : distance 2 (meter)</span>
<span class="sd">    fGHz  : frequency GHz</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math::   \nu = h \sqrt{\frac{2}{\lambda} \frac{d_1+d_2}{d_1 d_2}}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ld</span>  <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
    <span class="n">nu</span>  <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ld</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">d2</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">showfurniture</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; show furniture (not the good module) </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#R1_A.show(fig,ax)</span>
    <span class="c1">#R1_B1.show(fig,ax)</span>
    <span class="c1">#R1_B2.show(fig,ax)</span>
    <span class="c1">#R2_A.show(fig,ax)</span>
    <span class="c1">#R6_A.show(fig,ax)</span>
    <span class="c1">#R6_B.show(fig,ax)</span>
    <span class="c1">#R6_C.show(fig,ax)</span>
    <span class="n">R6_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_E</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_G</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_HA</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_HB</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_IA</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_IB</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_A</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_B</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R12_A1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R12_A2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R12_B.show(fig,ax)</span>
    <span class="c1">#R12_C1.show(fig,ax)</span>
    <span class="c1">#R12_C2.show(fig,ax)</span>
    <span class="n">R12_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R7_A1.show(fig,ax)</span>
    <span class="c1">#R7_A2.show(fig,ax)</span>
    <span class="c1">#R7_B.show(fig,ax)</span>
    <span class="n">R7_C1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R7_C2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R7_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R10_A.show(fig,ax)</span>
    <span class="c1">#R10_B.show(fig,ax)</span>
    <span class="n">R10_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R10_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R11_A.show(fig,ax)</span>
    <span class="c1">#R11_B.show(fig,ax)</span>
    <span class="n">R11_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_D1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_D2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_E1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_E2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R8_A.show(fig,ax)</span>
    <span class="c1">#R8_B.show(fig,ax)</span>
    <span class="c1">#R9_A1.show(fig,ax)</span>
    <span class="c1">#R9_A2.show(fig,ax)</span>
    <span class="n">R9_B1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_B2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_B3</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#R9_C.show(fig,ax)</span>
    <span class="n">R9_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_E1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_E2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_G</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">two_rays_flatearth</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    p0 : transmitter position</span>
<span class="sd">        (3 x Np1) array or (2,) array</span>
<span class="sd">    p1 : receiver position</span>
<span class="sd">        (3 x Np2) array or (2,) array</span>


<span class="sd">    OR :</span>

<span class="sd">    d : distance between Tx and Rx</span>
<span class="sd">        (Np1,)</span>
<span class="sd">    ht : Tx height</span>

<span class="sd">    hr : Rx height</span>
<span class="sd">        (Np1)</span>
<span class="sd">    GtdB : float (0) </span>
<span class="sd">        Transmitter Antenna Gain (dB)</span>
<span class="sd">    GrdB : float(0)</span>
<span class="sd">        Receiver Antenna Gain (dB)</span>
<span class="sd">    fGHz : float (2.4)</span>
<span class="sd">        frequency (GHz)</span>
<span class="sd">    gamma : complex (-1.+0.j)</span>
<span class="sd">        Reflexion coeff</span>

<span class="sd">    </span>
<span class="sd">    dB : boolean (True)</span>
<span class="sd">        return result in d</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    P : </span>
<span class="sd">        received power</span>





<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.loss import *</span>
<span class="sd">        &gt;&gt;&gt; NPT=10000</span>
<span class="sd">        &gt;&gt;&gt; x=np.array([0,0,8])</span>
<span class="sd">        &gt;&gt;&gt; x=x.reshape(3,1)</span>
<span class="sd">        &gt;&gt;&gt; y = np.ones((3,NPT))</span>
<span class="sd">        &gt;&gt;&gt; y[0,:]=0</span>
<span class="sd">        &gt;&gt;&gt; y[1,:]=np.arange(NPT)</span>
<span class="sd">        &gt;&gt;&gt; y[2,:]=2</span>
<span class="sd">        &gt;&gt;&gt; g0=1</span>
<span class="sd">        &gt;&gt;&gt; g1=1</span>
<span class="sd">        &gt;&gt;&gt; fGHz=2.4</span>
<span class="sd">        &gt;&gt;&gt; PL2R=two_rays_flatearth(p0=x,p1=y,fGHz=fGHz,GtdB=g0,GrdB=g1)</span>
<span class="sd">        &gt;&gt;&gt; PL1R = PL(fGHz,x,y,2)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(PL2R,label=&#39;two-ray model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(-PL1R[0,:],label=&#39;one slope model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.axis([10,NPT,-150,-50])</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;Loss 2-rays model vs one slope model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.xlabel(&#39;distance (m)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.ylabel(&#39;Loss Pr/Pt (dB)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &gt;&gt;&gt; d=np.arange(1,1000)</span>
<span class="sd">        &gt;&gt;&gt; PL2Rd = two_rays_flatearth(d=d,ht=np.array([5]),hr=np.array([10]),fGHz=fGHz,GtdB=g0,GrdB=g1)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(PL2Rd,label=&#39;two-ray model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(-PL1R[0,:],label=&#39;one slope model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.axis([10,NPT,-150,-50])</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;Loss 2-rays model vs one slope model&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.xlabel(&#39;distance (m)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.ylabel(&#39;Loss Pr/Pt (dB)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>




<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    https://en.wikipedia.org/wiki/Two-ray_ground-reflection_model#As_a_case_of_log_distance_path_loss_model</span>
<span class="sd">    http://morse.colorado.edu/~tlen5510/text/classwebch3.html#x15-590003.3.3</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;p0&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                 <span class="s1">&#39;p1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span>
                 <span class="s1">&#39;d&#39;</span><span class="p">:[],</span>
                 <span class="s1">&#39;ht&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;hr&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                 <span class="s1">&#39;GtdB&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;GrdB&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.j</span><span class="p">,</span>
                 <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;eps&#39;</span> <span class="p">:[],</span>
                 <span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;dB&#39;</span><span class="p">:</span><span class="bp">True</span>
               <span class="p">}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
       <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
           <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">GtdB</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;GtdB&#39;</span><span class="p">)</span>
    <span class="n">GrdB</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;GrdB&#39;</span><span class="p">)</span>

    <span class="n">Gt</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">GtdB</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
    <span class="n">Gr</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">GrdB</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
    <span class="n">pol</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pol&#39;</span><span class="p">)</span>
    <span class="n">eps</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;eps&#39;</span><span class="p">)</span>
    <span class="n">sig</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sig&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">p0</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span>
        <span class="n">p1</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">p0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;p0 is not 3D&#39;</span>
        <span class="k">assert</span> <span class="n">p1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;p1 is not 3D&#39;</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p0</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">p1</span><span class="o">=</span><span class="n">p1</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">p1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">p0</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">p0</span>
        <span class="n">p1</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">p1</span>

        <span class="n">ht</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">hr</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span>
        <span class="n">dloss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">p0</span><span class="o">-</span><span class="n">p1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="c1">#l0</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">dloss</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
        <span class="n">ht</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ht&#39;</span><span class="p">]</span>
        <span class="n">hr</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hr&#39;</span><span class="p">]</span>
        


    <span class="n">Gt</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">Gt</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
    <span class="n">Gr</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">Gr</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>


    
    <span class="n">d0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">dloss</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">ht</span><span class="o">-</span><span class="n">hr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="c1"># d0</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d0</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">ht</span><span class="o">+</span><span class="n">hr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#l0&#39;</span>


    <span class="k">if</span> <span class="n">eps</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">psy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">ht</span><span class="o">+</span><span class="n">hr</span><span class="p">)</span><span class="o">/</span><span class="n">dref</span><span class="p">)</span>
        <span class="n">er</span> <span class="o">=</span> <span class="n">eps</span>  <span class="o">-</span> <span class="mf">60.j</span><span class="o">*</span><span class="n">sig</span><span class="o">*</span><span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
        <span class="k">if</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="n">Z</span><span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">er</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">er</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="n">Z</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">er</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">+</span><span class="n">Z</span><span class="p">))</span>



    <span class="n">deltad</span><span class="o">=</span> <span class="n">dref</span><span class="o">-</span><span class="n">dloss</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="o">*</span><span class="n">deltad</span><span class="p">)</span><span class="o">/</span><span class="mf">0.3</span>
    <span class="n">E</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gt</span><span class="o">*</span><span class="n">Gr</span><span class="p">)</span><span class="o">/</span><span class="n">dloss</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="o">*</span><span class="n">Gr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.j</span><span class="o">*</span><span class="n">deltaphi</span><span class="p">))</span><span class="o">/</span><span class="n">dref</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># import ipdb</span>
    <span class="c1"># ipdb.set_trace()</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]</span> <span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">P</span>

<span class="k">def</span> <span class="nf">lossref_compute</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    compute loss and reflection rays on curved earth</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    P : float |list </span>

<span class="sd">        if len(P) == 1 =&gt; P is a distance</span>
<span class="sd">        if len(P) == 4 =&gt; P is a list of [lon0,lat0,lon1,lat1]</span>

<span class="sd">        where :</span>
<span class="sd">        lat0 : float |string</span>
<span class="sd">            latitude first point (decimal |deg min sec Direction)</span>
<span class="sd">        lat1 : float |string</span>
<span class="sd">            latitude second point (decimal |deg min sec Direction)</span>
<span class="sd">        lon0 : float |string</span>
<span class="sd">            longitude first point (decimal |deg min sec Direction)</span>
<span class="sd">        lon1 : float |string</span>
<span class="sd">            longitude second point (decimal |deg min sec Direction)</span>
<span class="sd">    h0 : float:</span>
<span class="sd">        height of 1st point </span>
<span class="sd">    h1 : float:</span>
<span class="sd">        height of 2nd point </span>
<span class="sd">    k : electromagnetic earth factor</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    </span>
<span class="sd">    dloss : float</span>
<span class="sd">        length of direct path (meter)</span>
<span class="sd">    dref : float</span>
<span class="sd">        length of reflective path (meter)</span>
<span class="sd">    psy : float</span>
<span class="sd">        Reflection angle</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    B. R. Mahafza, Radar systems analysis and design using MATLAB, Third edition. Boca Raton; London: CRC/Taylor &amp; Francis, chapter 8, 2013.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1">#P is a distance</span>
        <span class="n">r</span><span class="o">=</span><span class="n">P</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;dist&#39;</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#P is a distance</span>
            <span class="n">r</span><span class="o">=</span><span class="n">P</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;dist&#39;</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1">#P is a lonlat</span>
            <span class="n">lat0</span><span class="o">=</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lon0</span><span class="o">=</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">lat1</span><span class="o">=</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">lon1</span><span class="o">=</span><span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;lonlat&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;P must be a list [lat0,lon0,lat1,lon0] or a distance&#39;</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Invalid P format ( list |ndarray )&#39;</span><span class="p">)</span>


    <span class="c1"># if h0&lt;h1:</span>
    <span class="c1">#     h1,h0 = h0,h1</span>

    <span class="n">r0</span> <span class="o">=</span> <span class="mf">6371.e3</span> <span class="c1"># earth radius</span>
    <span class="n">re</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">r0</span> <span class="c1"># telecom earth radius</span>


    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;lonlat&#39;</span><span class="p">:</span>
        <span class="c1"># r = distance curvilignenp.arcsin((h1/R1)-R1/(2.*re)) entre TXetRX / geodesic</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">gu</span><span class="o">.</span><span class="n">distance_on_earth</span><span class="p">(</span><span class="n">lat0</span><span class="p">,</span> <span class="n">lon0</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">r</span><span class="o">=</span><span class="n">P</span>

    <span class="n">r</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">r</span>

    <span class="c1"># import ipdb</span>
    <span class="c1"># ipdb.set_trace()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">re</span><span class="o">*</span><span class="p">(</span><span class="n">h0</span><span class="o">+</span><span class="n">h1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">4.</span><span class="p">))</span> <span class="c1">#eq 8.45</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">re</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">h1</span><span class="o">-</span><span class="n">h0</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># eq 8.46</span>



    <span class="c1">#distance of reflection on curved earth</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">eps</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#eq 8.44</span>

    <span class="n">r2</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span><span class="n">r1</span>

    <span class="n">phi1</span> <span class="o">=</span> <span class="n">r1</span><span class="o">/</span><span class="n">re</span> <span class="c1">#8.47</span>
    <span class="n">phi2</span> <span class="o">=</span> <span class="n">r2</span><span class="o">/</span><span class="n">re</span> <span class="c1"># 8.48</span>

    <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h0</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">re</span><span class="o">*</span><span class="p">(</span><span class="n">re</span><span class="o">+</span><span class="n">h0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 8.51</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h1</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">re</span><span class="o">*</span><span class="p">(</span><span class="n">re</span><span class="o">+</span><span class="n">h1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi2</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#8.52</span>

    <span class="n">Rd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">h1</span><span class="o">-</span><span class="n">h0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">re</span><span class="o">+</span><span class="n">h1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">re</span><span class="o">+</span><span class="n">h0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="n">phi1</span><span class="o">+</span><span class="n">phi2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 8.53</span>
    <span class="c1"># tangente angle on earth</span>
    <span class="n">psy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">((</span><span class="n">h1</span><span class="o">/</span><span class="n">R1</span><span class="p">)</span><span class="o">-</span><span class="n">R1</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">re</span><span class="p">))</span> <span class="c1">#eq 8.55</span>
    <span class="n">deltaR</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">R1</span><span class="o">*</span><span class="n">R2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">R1</span><span class="o">+</span><span class="n">R2</span><span class="o">+</span><span class="n">Rd</span><span class="p">)</span>

    <span class="n">dloss</span> <span class="o">=</span> <span class="n">Rd</span>
    <span class="n">dref</span> <span class="o">=</span> <span class="n">R1</span><span class="o">+</span><span class="n">R2</span>

    <span class="k">return</span> <span class="n">psy</span><span class="p">,</span><span class="n">dloss</span><span class="p">,</span><span class="n">dref</span>

<span class="k">def</span> <span class="nf">two_rays_curvedearthold</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="mf">2.4</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    P : float |list </span>

<span class="sd">        if len(P) == 1 =&gt; P is a distance</span>
<span class="sd">        if len(P) == 4 =&gt; P is a list of [lon0,lat0,lon1,lat1]</span>

<span class="sd">        where :</span>
<span class="sd">        lat0 : float |string</span>
<span class="sd">            latitude first point (decimal |deg min sec Direction)</span>
<span class="sd">        lat1 : float |string</span>
<span class="sd">            latitude second point (decimal |deg min sec Direction)</span>
<span class="sd">        lon0 : float |string</span>
<span class="sd">            longitude first point (decimal |deg min sec Direction)</span>
<span class="sd">        lon1 : float |string</span>
<span class="sd">            longitude second point (decimal |deg min sec Direction)</span>
<span class="sd">    h0 : float:</span>
<span class="sd">        height of 1st point </span>
<span class="sd">    h1 : float:</span>
<span class="sd">        height of 2nd point </span>
<span class="sd">    fGHz : float</span>
<span class="sd">        frequency (GHz)</span>


<span class="sd">    k : float</span>
<span class="sd">        electromagnetic earth factor</span>
<span class="sd">    GtdB : float</span>
<span class="sd">        Transmitter Antenna Gain (dB)</span>
<span class="sd">    GrdB : float</span>
<span class="sd">        Receiver Antenna Gain (dB)</span>
<span class="sd">    gamma : complex (-1.+0.j)</span>
<span class="sd">        Reflexion coeff if eps and sig are not precised</span>

<span class="sd">    &#39;pol&#39;: string (&#39;v&#39;)</span>
<span class="sd">        polarization (&#39;v&#39;|&#39;h&#39;)</span>
<span class="sd">    &#39;eps&#39; : float ([])</span>
<span class="sd">        lossless relative permittivity [],</span>
<span class="sd">    &#39;sig&#39;: float (0.)</span>
<span class="sd">        conductivity </span>


<span class="sd">    dB : boolean (True)</span>
<span class="sd">        return result in dB</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    P : </span>
<span class="sd">        received power</span>



<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        </span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.loss import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; fGHz=2.4</span>
<span class="sd">        &gt;&gt;&gt; p0=np.array(([0,0,20]))</span>
<span class="sd">        &gt;&gt;&gt; p1=np.array(([0,1,20]))</span>
<span class="sd">        &gt;&gt;&gt; p0=p0.reshape(3,1)</span>
<span class="sd">        &gt;&gt;&gt; p1=p1.reshape(3,1)</span>
<span class="sd">        &gt;&gt;&gt; TRF = [] #Two Ray model on flat earth</span>
<span class="sd">        &gt;&gt;&gt; TRC = [] #Two Ray model on curved earth</span>
<span class="sd">        &gt;&gt;&gt; PLoss=[]</span>
<span class="sd">        &gt;&gt;&gt; for d in np.arange(1,10000,1):</span>
<span class="sd">        &gt;&gt;&gt;     p1[1,:]=d</span>
<span class="sd">        &gt;&gt;&gt;     TRF.append(two_rays_flatearth(p0[:,0],p1[:,0],fGHz,GtdB=0.,GrdB=0.,))</span>
<span class="sd">        &gt;&gt;&gt;     TRC.append(two_rays_curvedearth(d,p0[2,:],p1[2,:],fGHz))</span>
<span class="sd">        &gt;&gt;&gt;     PLoss.append(PL(fGHz, p0[:,0],p1[:,0], n=2.0, dB=True, d0=np.array([1])))</span>
<span class="sd">        &gt;&gt;&gt; PLoss=np.array(PLoss)[:,0,0]</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(TRF,label=&#39;two-rays model flat earth&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(TRC,label=&#39;two-rays model curved earth&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.semilogx(-PLoss,label=&#39;Path Loss&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.legend()</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;GtdB&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;GrdB&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="mi">4</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span>
                 <span class="s1">&#39;gamma&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.</span><span class="o">+</span><span class="mf">0.j</span><span class="p">,</span>
                 <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;v&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;eps&#39;</span> <span class="p">:[],</span>
                 <span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;PL&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;dB&#39;</span><span class="p">:</span><span class="bp">True</span>
               <span class="p">}</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

    <span class="n">GtdB</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;GtdB&#39;</span><span class="p">)</span>
    <span class="n">GrdB</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;GrdB&#39;</span><span class="p">)</span>

    <span class="n">Gt</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">GtdB</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
    <span class="n">Gr</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="mf">1.</span><span class="o">*</span><span class="n">GrdB</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
    <span class="n">k</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">gamma</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
    <span class="n">pol</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;pol&#39;</span><span class="p">)</span>
    <span class="n">eps</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;eps&#39;</span><span class="p">)</span>
    <span class="n">sig</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;sig&#39;</span><span class="p">)</span>


    <span class="n">h0</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">h0</span>
    <span class="n">h1</span><span class="o">=</span><span class="mf">1.</span><span class="o">*</span><span class="n">h1</span>

    <span class="n">psy</span><span class="p">,</span><span class="n">dloss</span><span class="p">,</span><span class="n">dref</span> <span class="o">=</span> <span class="n">lossref_compute</span><span class="p">(</span><span class="n">P</span><span class="p">,</span><span class="n">h0</span><span class="p">,</span><span class="n">h1</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">eps</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">er</span> <span class="o">=</span> <span class="n">eps</span>  <span class="o">-</span> <span class="mf">60.j</span><span class="o">*</span><span class="n">sig</span><span class="o">*</span><span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
        <span class="k">if</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span>
            <span class="n">Z</span><span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">er</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">er</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">pol</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="n">Z</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">er</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">-</span><span class="n">Z</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">psy</span><span class="p">)</span><span class="o">+</span><span class="n">Z</span><span class="p">))</span>

    <span class="n">deltad</span><span class="o">=</span> <span class="n">dref</span><span class="o">-</span><span class="n">dloss</span>
    <span class="n">deltaphi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="o">*</span><span class="n">deltad</span><span class="p">)</span><span class="o">/</span><span class="mf">0.3</span>
    <span class="n">E</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gt</span><span class="o">*</span><span class="n">Gr</span><span class="p">)</span><span class="o">/</span><span class="n">dloss</span> <span class="o">+</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="o">*</span><span class="n">Gr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.j</span><span class="o">*</span><span class="n">deltaphi</span><span class="p">))</span><span class="o">/</span><span class="n">dref</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="c1"># import ipdb</span>
    <span class="c1"># ipdb.set_trace()</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]</span> <span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">P</span>


<div class="viewcode-block" id="visuPts"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.visuPts.html#pylayers.antprop.loss.visuPts">[docs]</a><span class="k">def</span> <span class="nf">visuPts</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">nu</span><span class="p">,</span><span class="n">nd</span><span class="p">,</span><span class="n">Pts</span><span class="p">,</span><span class="n">Values</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">sp</span><span class="o">=</span><span class="p">[],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">tit</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">colbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; visuPt  : Visualization of values a given points</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    S       : Simul</span>
<span class="sd">    nu      : useful Points</span>
<span class="sd">    nd      : Points deleted</span>
<span class="sd">    Pts     : Points coordinates</span>
<span class="sd">    Value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vx</span>  <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nu</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vy</span>  <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nu</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">vxd</span> <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vyd</span> <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nd</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">vmax</span><span class="o">&lt;</span><span class="n">vmin</span><span class="p">:</span>
        <span class="c1">#vmin = min(Values)</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">150</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Values</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">]:</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;outward&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># outward by 10 points</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
              <span class="k">elif</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">]:</span>
                 <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t draw spine</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unknown spine location: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]:</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s1">&#39;outward&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c1"># outward by 10 points</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
              <span class="k">elif</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="s1">&#39;top&#39;</span><span class="p">,</span><span class="s1">&#39;bottom&#39;</span><span class="p">]:</span>
                 <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span> <span class="c1"># don&#39;t draw spine</span>
                 <span class="n">sp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unknown spine location: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">loc</span><span class="p">)</span>



        <span class="c1"># no xaxis ticks</span>
        <span class="c1">#ax.xaxis.set_ticks([])</span>
    <span class="c1">#sp.spines[&#39;left&#39;].set_position(&#39;center&#39;)</span>
        <span class="c1">#sp.spines[&#39;left&#39;].set_color(&#39;none&#39;)</span>
    <span class="c1">#sp.spines[&#39;right&#39;].set_position(&#39;center&#39;)</span>
        <span class="c1">#sp.spines[&#39;right&#39;].set_color(&#39;none&#39;)</span>
    <span class="c1">#sp.spines[&#39;bottom&#39;].set_position(&#39;center&#39;)</span>
    <span class="c1">#sp.xaxis.set_ticks_position(&#39;bottom&#39;)</span>
    <span class="c1">#sp.yaxis.set_ticks_position(&#39;left&#39;)</span>
        <span class="c1">#sp.spines[&#39;bottom&#39;].set_color(&#39;none&#39;)</span>
    <span class="c1">#sp.spines[&#39;top&#39;].set_position(&#39;center&#39;)</span>
        <span class="c1">#sp.spines[&#39;top&#39;].set_color(&#39;none&#39;)</span>
    <span class="c1">#</span>
    <span class="c1"># Rooms annotation</span>
    <span class="c1">#</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 8&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">19</span><span class="p">,</span><span class="mf">14.1</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 9&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">24.5</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 14&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 10&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">16.5</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 7&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span><span class="mf">14.1</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 11&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">13.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 12&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">8.7</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 13&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">5.2</span><span class="p">,</span><span class="mf">14.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 1&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 2&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">13.8</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;R 6&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">3.6</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>


    <span class="n">n</span><span class="o">=</span><span class="n">scatter</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">Values</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;face&#39;</span><span class="p">)</span>
<span class="c1">#    m=scatter(vxd,vyd,marker=&#39;o&#39;,c=&#39;k&#39;,s=size)</span>
<span class="c1">#    m.set_edgecolor(&#39;face&#39;)</span>
    <span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;meters&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
        <span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;meters&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colbar</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">=</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span></div>

<div class="viewcode-block" id="cdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.loss.cdf.html#pylayers.antprop.loss.cdf">[docs]</a><span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">colsym</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot the cumulative density function</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    x : np.array()</span>
<span class="sd">    colsym : string</span>
<span class="sd">    lab : string</span>
<span class="sd">    lw : int</span>
<span class="sd">        linewidth</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt </span>
<span class="sd">        &gt;&gt;&gt; x = np.random.randn(10000)</span>
<span class="sd">        &gt;&gt;&gt; cdf(x)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">20</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">20</span>

    <span class="n">x</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">colsym</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Ranging Error[m]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Probability&#39;</span><span class="p">)</span></div>

<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Nov 06, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>