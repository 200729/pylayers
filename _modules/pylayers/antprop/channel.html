<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.channel &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.antprop.channel</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. currentmodule:: pylayers.antprop.channel</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">Ctilde class</span>
<span class="sd">============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Ctilde.__init__</span>
<span class="sd">    Ctilde.__repr__</span>
<span class="sd">    Ctilde.info</span>
<span class="sd">    Ctilde.choose</span>
<span class="sd">    Ctilde.saveh5</span>
<span class="sd">    Ctilde.loadh5</span>
<span class="sd">    Ctilde.load</span>
<span class="sd">    Ctilde.mobility</span>
<span class="sd">    Ctilde.doadod</span>
<span class="sd">    Ctilde.locbas</span>
<span class="sd">    Ctilde.Cg2Cl</span>
<span class="sd">    Ctilde.show</span>
<span class="sd">    Ctilde.plotd</span>
<span class="sd">    Ctilde.check_reciprocity</span>
<span class="sd">    Ctilde.energy</span>
<span class="sd">    Ctilde.sort</span>
<span class="sd">    Ctilde.prop2tran</span>
<span class="sd">    Ctilde.vec2scal</span>
<span class="sd">    Ctilde.vec2scalA</span>
<span class="sd">    Ctilde.PLoss</span>

<span class="sd">Tchannel Class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Tchannel.__init__</span>
<span class="sd">    Tchannel.__repr__</span>
<span class="sd">    Tchannel.info</span>
<span class="sd">    Tchannel.apply</span>
<span class="sd">    Tchannel.applywavC</span>
<span class="sd">    Tchannel.chantap</span>
<span class="sd">    Tchannel.applywavB</span>
<span class="sd">    Tchannel.applywavA</span>
<span class="sd">    Tchannel.plotd</span>
<span class="sd">    Tchannel.plotad</span>
<span class="sd">    Tchannel.doadod</span>
<span class="sd">    Tchannel.energy</span>
<span class="sd">    Tchannel.wavefig</span>
<span class="sd">    Tchannel.rayfig</span>
<span class="sd">    Tchannel.RSSI</span>
<span class="sd">    Tchannel.saveh5</span>
<span class="sd">    Tchannel.loadh5</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.raysc</span> <span class="kn">import</span> <span class="n">GrRay3D</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">h5py</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;h5py is not installed: Ctilde(object cannot be saved)&#39;</span>

<span class="k">class</span> <span class="nc">Ctilde</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; container for the 4 components of the polarimetric ray channel</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    Ctt : FUsignal</span>
<span class="sd">    Ctp : FUsignal</span>
<span class="sd">    Cpt : FUsignal</span>
<span class="sd">    Cpp : FUsignal</span>

<span class="sd">    tauk : ndarray delays</span>
<span class="sd">    tang : ndarray angles of departure</span>
<span class="sd">    rang : ndarray angles of arrival</span>

<span class="sd">    fGHz : np.array</span>
<span class="sd">        frequency array</span>
<span class="sd">    nfreq : int</span>
<span class="sd">        number of frequency point</span>
<span class="sd">    nray  : int</span>
<span class="sd">        number of rays</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    choose</span>
<span class="sd">    load</span>
<span class="sd">    mobility</span>
<span class="sd">    doadod</span>
<span class="sd">    show</span>
<span class="sd">    energy</span>
<span class="sd">    sort</span>
<span class="sd">    prop2tran</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Ctilde.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.__init__.html#pylayers.antprop.channel.Ctilde.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            transpose == False   (r,f)</span>
<span class="sd">            transpose == True    (f,r)</span>

<span class="sd">            A Ctilde object is the output of eval method</span>
<span class="sd">            of a Rays object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.__repr__.html#pylayers.antprop.channel.Ctilde.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;Ctilde&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">---------</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Cpp&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;nray&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;Nray : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;fmin(GHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;fmax(GHz): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;Nfreq : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> methods :&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">---------</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;prop2tran(a=theta,b=phi)</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;energy()</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;doadod(cmap=plt.cm.hot_r,s=30,fontsize=12,phi=(0,360))</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;mobility(v,dt)</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;show(mode=linear)</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&#39;sort()</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.choose"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.choose.html#pylayers.antprop.channel.Ctilde.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Choose a field file in tud directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span> <span class="kn">as</span> <span class="nn">FD</span>
        <span class="n">filefield</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;Files field  &quot;</span><span class="p">,</span> <span class="s">&quot;*.field&quot;</span><span class="p">),</span>
                                                  <span class="p">(</span><span class="s">&quot;All&quot;</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="p">)],</span>
                                       <span class="n">title</span><span class="o">=</span><span class="s">&quot;Please choose a .field file&quot;</span><span class="p">,</span>
                                       <span class="n">initialdir</span><span class="o">=</span><span class="n">tuddir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filefield</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Ctilde.saveh5"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.saveh5.html#pylayers.antprop.channel.Ctilde.saveh5">[docs]</a>    <span class="k">def</span> <span class="nf">saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        a : np.ndarray</span>
<span class="sd">            postion of point a (transmitter)</span>
<span class="sd">        b : np.ndarray</span>
<span class="sd">            postion of point b (receiver)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_filename</span><span class="o">=</span> <span class="n">Lfilename</span> <span class="o">+</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.hdf5&#39;</span>

        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRCT&#39;</span><span class="p">])</span>

        <span class="c"># save channel in global basis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">b2g</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># try/except to avoid loosing the h5 file if </span>
        <span class="c"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Tt&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Tr&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;tang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;rang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;tauk&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;fGHz&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>


            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Ctt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Cpp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Cpt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Ctp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Tx&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Rx&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel.Ctilde: issue when writting h5py file&#39;</span><span class="p">)</span>

    

</div>
<div class="viewcode-block" id="Ctilde.loadh5"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.loadh5.html#pylayers.antprop.channel.Ctilde.loadh5">[docs]</a>    <span class="k">def</span> <span class="nf">loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        output : bool </span>
<span class="sd">            return an output precised in return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        if output:</span>
<span class="sd">        (Layout filename , Tx position, Rx position)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_filename</span><span class="o">=</span> <span class="n">_Lfilename</span> <span class="o">+</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.hdf5&#39;</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRCT&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;tang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;rang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;tauk&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Tt&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Tr&#39;</span><span class="p">][:]</span>

            <span class="n">Ctt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Ctt_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Cpp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Ctp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Ctp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Cpt_y&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpp</span><span class="p">)</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Tx&#39;</span><span class="p">][:]</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Rx&#39;</span><span class="p">][:]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel.Ctilde: issue when reading h5py file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Lfilename</span> <span class="p">,</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format compliant with Link Class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">b2g</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="c"># try/except to avoid loosing the h5 file if </span>
        <span class="c"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grpname</span> <span class="ow">in</span> <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;Ct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;Ct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">grpname</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Warning : Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span> <span class="o">+</span><span class="s">&#39;already exists in &#39;</span><span class="o">+</span><span class="n">filenameh5</span>
            <span class="n">f</span><span class="o">=</span><span class="n">fh5</span><span class="p">[</span><span class="s">&#39;Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="c"># save channel in global basis</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Tt&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Tr&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;tang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;rang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;tauk&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;fGHz&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>


            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Ctt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Cpp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Cpt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s">&#39;Ctp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel.Ctilde: issue when writting h5py file&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>
<span class="sd">        </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRLNK&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;tang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;rang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;tauk&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Tt&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Tr&#39;</span><span class="p">][:]</span>

            <span class="n">Ctt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Ctt_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Cpp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Ctp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Ctp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s">&#39;Cpt_y&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpp</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel.Ctilde: issue when reading h5py file&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Ctilde.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.load.html#pylayers.antprop.channel.Ctilde.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filefield</span><span class="p">,</span> <span class="n">transpose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a Ctilde from a .field file</span>

<span class="sd">        Load the three files .tauk .tang .rang which contain  respectively</span>
<span class="sd">        delay , angle of departure , angle of arrival.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filefield  : string</span>
<span class="sd">        transpose  : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.channel import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">        &gt;&gt;&gt; S.load(&#39;default.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; C = Ctilde()</span>
<span class="sd">        &gt;&gt;&gt; out = C.load(pyu.getlong(S.dtud[1][1],&#39;output&#39;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filetauk</span> <span class="o">=</span> <span class="n">filefield</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.field&#39;</span><span class="p">,</span> <span class="s">&#39;.tauk&#39;</span><span class="p">)</span>
        <span class="n">filetang</span> <span class="o">=</span> <span class="n">filefield</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.field&#39;</span><span class="p">,</span> <span class="s">&#39;.tang&#39;</span><span class="p">)</span>
        <span class="n">filerang</span> <span class="o">=</span> <span class="n">filefield</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.field&#39;</span><span class="p">,</span> <span class="s">&#39;.rang&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filefield</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span> <span class="s">&quot;file &quot;</span> <span class="o">+</span> <span class="n">filefield</span> <span class="o">+</span> <span class="s">&quot; is unreachable&quot;</span><span class="p">)</span>

        <span class="c"># decode filename (*.field file obtained from evalfield simulation)</span>
        <span class="n">nray</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">nfreq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot; Error : incorrect number of frequency points in .field&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">nray</span> <span class="o">*</span> <span class="n">nfreq</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">CMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="nb">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">c11</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span>
        <span class="n">c12</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span>
        <span class="n">c21</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span>
        <span class="n">c22</span> <span class="o">=</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">+</span> <span class="n">CMat</span><span class="p">[:,</span> <span class="mi">7</span><span class="p">]</span><span class="o">*</span><span class="mi">1j</span>

        <span class="n">c11</span> <span class="o">=</span> <span class="n">c11</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>
        <span class="n">c12</span> <span class="o">=</span> <span class="n">c12</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>
        <span class="n">c21</span> <span class="o">=</span> <span class="n">c21</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>
        <span class="n">c22</span> <span class="o">=</span> <span class="n">c22</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
            <span class="n">c11</span> <span class="o">=</span> <span class="n">c11</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">c12</span> <span class="o">=</span> <span class="n">c12</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">c21</span> <span class="o">=</span> <span class="n">c21</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">c22</span> <span class="o">=</span> <span class="n">c22</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="c">#</span>
        <span class="c"># Temporary freq --&gt; read filefreq</span>
        <span class="c">#</span>
        <span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">c11</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">c12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">c21</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">c22</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span> <span class="o">=</span> <span class="n">nfreq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">nray</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetauk</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span> <span class="s">&quot;file &quot;</span><span class="p">,</span> <span class="n">filetauk</span><span class="p">,</span> <span class="s">&quot; is unreachable&quot;</span>
        <span class="c"># decode filetauk</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">:</span>
            <span class="n">nray_tauk</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#print &quot;nb rays in .tauk file: &quot;, nray_tauk</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
            <span class="c">#print &quot;nb rays 2: &quot;, nray</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">nray</span><span class="p">,</span> <span class="nb">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
            <span class="c">#if nray_tauk != nray:</span>
            <span class="c">#    print nray_tauk - nray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span>

        <span class="c"># decode the angular files (.tang and .rang)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetang</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span> <span class="s">&quot;file &quot;</span><span class="p">,</span> <span class="n">filetang</span><span class="p">,</span> <span class="s">&quot; is unreachable&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">:</span>
            <span class="n">nray_tang</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c"># coorectif Bug evalfield</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nray_tang</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nray</span><span class="p">,:]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filerang</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">print</span> <span class="s">&quot;file &quot;</span><span class="p">,</span> <span class="n">filerang</span><span class="p">,</span> <span class="s">&quot; is unreachable&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">:</span>
            <span class="n">nray_rang</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="c"># corectif Bug evalfield</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nray_rang</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">buffer</span><span class="o">=</span><span class="n">buf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nray</span><span class="p">,:]</span>
</div>
<div class="viewcode-block" id="Ctilde.mobility"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.mobility.html#pylayers.antprop.channel.Ctilde.mobility">[docs]</a>    <span class="k">def</span> <span class="nf">mobility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Modify channel for uniform mobility</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        v  : float</span>
<span class="sd">            velocity (m/s)</span>
<span class="sd">        dt : float</span>
<span class="sd">            delta t (s)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate a channel field from Ctilde and v(terminal vitese)</span>
<span class="sd">        and dt(time of deplacement)</span>

<span class="sd">        dt en s  (observation time between 2 Rx position)</span>
<span class="sd">        v en m/s (vitesse de changement de Rx)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        tau : modified Ctilde</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c"># m/ns celerity of light</span>
        <span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span>
        <span class="n">tang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span>
        <span class="n">rang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span>

        <span class="n">rk</span> <span class="o">=</span> <span class="n">tauk</span> <span class="o">*</span> <span class="n">c</span>
        <span class="n">rk_mod</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rk</span><span class="p">)</span>
        <span class="n">sk_ch</span> <span class="o">=</span> <span class="n">rk</span> <span class="o">/</span> <span class="n">rk_mod</span>

        <span class="c"># cos_alph =dot(v/abs(v),sk_ch)</span>

        <span class="n">cos_alph</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">sk_ch</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos_alph</span> <span class="o">=</span> <span class="n">cos_alph</span>
        <span class="n">rk_ch</span> <span class="o">=</span> <span class="n">rk_mod</span> <span class="o">*</span> <span class="n">cos_alph</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">sk_ch_ch</span> <span class="o">=</span> <span class="p">(</span><span class="n">rk</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rk_ch</span> <span class="o">+</span> <span class="n">cos_alph</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">tauk_ch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rk_ch</span><span class="p">)</span> <span class="o">*</span> <span class="n">sk_ch_ch</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span>

        <span class="k">return</span><span class="p">(</span><span class="n">tauk_ch</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.PLoss"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.PLoss.html#pylayers.antprop.channel.Ctilde.PLoss">[docs]</a>    <span class="k">def</span> <span class="nf">PLoss</span><span class="p">(</span><span class="n">sef</span><span class="p">,</span><span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="Ctilde.plotd"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.plotd.html#pylayers.antprop.channel.Ctilde.plotd">[docs]</a>    <span class="k">def</span> <span class="nf">plotd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s">&#39;doa&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot direction of arrival/departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: &#39;doa&#39; | &#39;dod&#39;        </span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis    </span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;title&#39;</span> <span class="p">:</span> <span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span><span class="s">&#39;dod&#39;</span><span class="p">:</span>
            <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;tang&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="s">&#39;doa&#39;</span><span class="p">:</span>
            <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;rang&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;d attribute can only be doa or dod&#39;</span><span class="p">)</span>


        <span class="c"># remove non plt.scatter kwargs</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;phi&#39;</span><span class="p">)</span>
        <span class="n">the</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;reverse&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">Ett</span><span class="p">,</span> <span class="n">Epp</span><span class="p">,</span> <span class="n">Etp</span><span class="p">,</span> <span class="n">Ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">Etot</span> <span class="o">=</span> <span class="n">Ett</span><span class="o">+</span><span class="n">Epp</span><span class="o">+</span><span class="n">Etp</span><span class="o">+</span><span class="n">Ept</span> <span class="o">+</span> <span class="mf">1e-15</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c"># WARNING polar plot require radian angles </span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">the</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>
      
        <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$</span><span class="se">\\</span><span class="s">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;$</span><span class="se">\\</span><span class="s">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">b</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;dB&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Path Loss (dB)&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.doadod"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.doadod.html#pylayers.antprop.channel.Ctilde.doadod">[docs]</a>    <span class="k">def</span> <span class="nf">doadod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; doadod scatter plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">                </span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar bool</span>

<span class="sd">        Summary</span>
<span class="sd">        --------</span>

<span class="sd">        scatter plot of the DoA-DoD channel structure</span>
<span class="sd">        the energy is colorcoded over all couples of DoA-DoD</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;mean&#39;</span>
                    <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;polar&#39;</span><span class="p">])</span>
        <span class="n">ax2</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;polar&#39;</span><span class="p">])</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colorbar&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s">&#39;dod&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colorbar&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s">&#39;doa&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>


    <span class="c"># def doadod(self, **kwargs):</span>
    <span class="c">#     &quot;&quot;&quot; doadod scatter plot</span>

    <span class="c">#     Parameters</span>
    <span class="c">#     -----------</span>

    <span class="c">#     cmap : color map</span>
    <span class="c">#     s    : float</span>
    <span class="c">#         size (default 30)</span>
    <span class="c">#     fontsize : integer</span>
    <span class="c">#         default 12</span>

    <span class="c">#     Summary</span>
    <span class="c">#     --------</span>

    <span class="c">#     scatter plot of the DoA-DoD channel structure</span>
    <span class="c">#     the energy is colorcoded over all couples of DoA-DoD</span>

    <span class="c">#     &quot;&quot;&quot;</span>
    <span class="c">#     defaults = {&#39;cmap&#39; : plt.cm.hot_r,</span>
    <span class="c">#                 &#39;s&#39;: 30,</span>
    <span class="c">#                 &#39;fontsize&#39; : 12,</span>
    <span class="c">#                 &#39;reverse&#39; :False,</span>
    <span class="c">#                 &#39;phi&#39;:(-180,180),</span>
    <span class="c">#                 &#39;normalize&#39;:False,</span>
    <span class="c">#                 &#39;polar&#39;:False,</span>
    <span class="c">#                 &#39;mode&#39;:&#39;center&#39;}</span>

    <span class="c">#     for k in defaults:</span>
    <span class="c">#         if k not in kwargs:</span>
    <span class="c">#             kwargs[k] = defaults[k]</span>

    <span class="c">#     args = {}</span>
    <span class="c">#     for k in kwargs:</span>
    <span class="c">#         if k not in defaults:</span>
    <span class="c">#             args[k] = kwargs[k]</span>

    <span class="c">#     the = (0,180)</span>
    <span class="c">#     dod = self.tang</span>
    <span class="c">#     doa = self.rang</span>

    <span class="c">#     # determine Energy in each channel</span>

    <span class="c">#     Ett, Epp, Etp, Ept = self.energy(mode=kwargs[&#39;mode&#39;])</span>
    <span class="c">#     Etot = Ett+Epp+Etp+Ept + 1e-15</span>

    <span class="c">#     if kwargs[&#39;normalize&#39;]:</span>
    <span class="c">#         Emax = max(Etot)</span>
    <span class="c">#         Etot = Etot / Emax</span>

    <span class="c">#     Emax = max(10 * np.log10(Etot))</span>
    <span class="c">#     Emin = min(10 * np.log10(Etot))</span>
    <span class="c">#     #</span>
    <span class="c">#     #</span>
    <span class="c">#     #</span>
    <span class="c">#     # col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
    <span class="c">#     # WARNING polar plot require radian angles </span>
    <span class="c">#     if kwargs[&#39;polar&#39;] :</span>
    <span class="c">#         al = 1.</span>
    <span class="c">#         phi=np.array(phi)</span>
    <span class="c">#         the=np.array(the)</span>
    <span class="c">#         phi[0] = phi[0]*np.pi/180</span>
    <span class="c">#         phi[1] = phi[1]*np.pi/180</span>
    <span class="c">#         the[0] = the[0]*np.pi/180</span>
    <span class="c">#         the[1] = the[1]*np.pi/180</span>
    <span class="c">#     else :</span>
    <span class="c">#         al = 180./np.pi</span>

    <span class="c">#     col = 10 * np.log10(Etot)</span>

    <span class="c">#     if len(col) != len(dod):</span>
    <span class="c">#         print &quot;len(col):&quot;, len(col)</span>
    <span class="c">#         print &quot;len(dod):&quot;, len(dod)</span>
    <span class="c">#     plt.subplot(121, polar=kwargs[&#39;polar&#39;])</span>
    <span class="c">#     if kwargs[&#39;reverse&#39;]:</span>
    <span class="c">#         plt.scatter(dod[:, 1] * al, dod[:, 0] * al,</span>
    <span class="c">#                     s=kwargs[&#39;s&#39;], c=col,</span>
    <span class="c">#                     cmap=kwargs[&#39;cmap&#39;],</span>
    <span class="c">#                     edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1],the[0],the[1]))</span>
    <span class="c">#         plt.xlabel(&#39;$\phi(^{\circ})$&#39;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\\theta_t(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     else:</span>
    <span class="c">#         plt.scatter(dod[:, 0] * al, dod[:, 1] * al,</span>
    <span class="c">#                     s=kwargs[&#39;s&#39;], c=col,</span>
    <span class="c">#                     cmap=kwargs[&#39;cmap&#39;],</span>
    <span class="c">#                     edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((the[0], the[1], kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\\theta_t(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&#39;$\phi(^{\circ})$&#39;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     # ylabel(&#39;$\phi_t(^{\circ})$&#39;,fontsize=18)</span>
    <span class="c">#     plt.title(&#39;DoD&#39;, fontsize=kwargs[&#39;fontsize&#39;]+2)</span>


    <span class="c">#     plt.subplot(122, polar=kwargs[&#39;polar&#39;])</span>
    <span class="c">#     if kwargs[&#39;reverse&#39;]:</span>
    <span class="c">#         plt.scatter(doa[:, 1] * al, doa[:, 0] * al, s=30, c=col,</span>
    <span class="c">#                     cmap=plt.cm.hot_r, edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1],the[0],the[1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\phi_r (^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\\theta_r(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     else :</span>
    <span class="c">#         plt.scatter(doa[:, 0] * al, doa[:, 1] * al, s=30, c=col,</span>
    <span class="c">#                     cmap=plt.cm.hot_r, edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((the[0], the[1], kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\\theta_r(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\phi_r (^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>

    <span class="c">#     plt.title(&#39;DoA&#39;, fontsize=kwargs[&#39;fontsize&#39;]+2)</span>

    <span class="c">#     # plt.xticks(fontsize=20)</span>
    <span class="c">#     # plt.yticks(fontsize=20)</span>
    <span class="c">#     b = plt.colorbar()</span>
    <span class="c">#     if kwargs[&#39;normalize&#39;]:</span>
    <span class="c">#         b.set_label(&#39;dB&#39;)</span>
    <span class="c">#     else:</span>
    <span class="c">#         b.set_label(&#39;Path Loss (dB)&#39;)</span>
    <span class="c">#     # for t in b.ax.get_yticklabels():</span>
    <span class="c">#     #    t.set_fontsize(20)</span>
    <span class="c">#     plt.axis</span>



</div>
<div class="viewcode-block" id="Ctilde.locbas"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.locbas.html#pylayers.antprop.channel.Ctilde.locbas">[docs]</a>    <span class="k">def</span> <span class="nf">locbas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tt</span><span class="o">=</span><span class="p">[],</span> <span class="n">Tr</span><span class="o">=</span><span class="p">[],</span><span class="n">b2g</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; global reference frame to local reference frame</span>

<span class="sd">        If Tt and Tr are [] the global channel is  retrieved</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tt  : Tx rotation matrix 3x3</span>
<span class="sd">            default []</span>
<span class="sd">        Tr  : Rx rotation matrix 3x3</span>
<span class="sd">            default []</span>
<span class="sd">        b2g: bool</span>
<span class="sd">            back to global reference frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Cl : Ctilde local/global</span>
<span class="sd">            depends on self.islocal boolean value</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get frequency axes</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        <span class="c"># if rot matrices are passed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Tt</span> <span class="o">&lt;&gt;</span><span class="p">[])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Tr</span><span class="o">&lt;&gt;</span><span class="p">[]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tt&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tr&#39;</span><span class="p">)):</span>
                    <span class="c"># run locbas to return to global basis</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">b2g</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel has no self.Tt or self.Tr&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="n">Tt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="n">Tr</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span> <span class="o">=</span> <span class="bp">True</span>
            

        <span class="c"># if a return to gloabl is requested</span>
        <span class="k">elif</span> <span class="n">b2g</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tt&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tr&#39;</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NameError</span> <span class="p">(</span><span class="s">&#39;self.Tt and self.Tr should exist&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;nothing to do to return in global basis&quot;</span>
                <span class="k">return</span> <span class="bp">self</span>
        <span class="c"># if Tt and Tr == []</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c"># get angular axes</span>
        <span class="c"># Rt (2x2)</span>
        <span class="c"># Rr (2x2)</span>
        <span class="c">#</span>
        <span class="c"># tang : r x 2</span>
        <span class="c"># rang : r x 2</span>
        <span class="c">#</span>
        <span class="c"># Rt : 2 x 2 x r</span>
        <span class="c"># Rr : 2 x 2 x r</span>
        <span class="c">#</span>
        <span class="c"># tangl : r x 2</span>
        <span class="c"># rangl : r x 2</span>
        <span class="c">#</span>


        <span class="n">Rt</span><span class="p">,</span> <span class="n">tangl</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">)</span>
        <span class="n">Rr</span><span class="p">,</span> <span class="n">rangl</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB_rx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># update direction of departure and arrival</span>
        <span class="c">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tangl</span> <span class="o">=</span> <span class="n">tangl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rangl</span> <span class="o">=</span> <span class="n">rangl</span>

        <span class="c">#uf = np.ones(self.nfreq)</span>

        <span class="c">#</span>
        <span class="c"># r0 : r x 1(f)</span>
        <span class="c">#</span>

        <span class="c">#r0 = np.outer(Rr[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rr[0, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">t00</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t01</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c">#r0 = np.outer(Rr[1, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rr[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">t10</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t11</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c">#r0 = np.outer(Rt[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rt[1, 0,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">Cttl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cptl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="c">#r0 = np.outer(Rt[0, 1,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rt[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">Ctpl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cppl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cttl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cptl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cppl</span><span class="p">)</span>



        <span class="k">return</span> <span class="bp">self</span>

</div>
<div class="viewcode-block" id="Ctilde.Cg2Cl"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.Cg2Cl.html#pylayers.antprop.channel.Ctilde.Cg2Cl">[docs]</a>    <span class="k">def</span> <span class="nf">Cg2Cl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tt</span><span class="o">=</span><span class="p">[],</span> <span class="n">Tr</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; global reference frame to local reference frame</span>

<span class="sd">        If Tt and Tr are [] the global channel is  retrieved</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tt  : Tx rotation matrix 3x3</span>
<span class="sd">            default []</span>
<span class="sd">        Tr  : Rx rotation matrix 3x3</span>
<span class="sd">            default []</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Cl : Ctilde local</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get frequency axes</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Tt</span> <span class="o">&lt;&gt;</span><span class="p">[])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Tr</span><span class="o">&lt;&gt;</span><span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="n">Tt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="n">Tr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tt&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Tr&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c"># get angular axes</span>
        <span class="c"># Rt (2x2)</span>
        <span class="c"># Rr (2x2)</span>
        <span class="c">#</span>
        <span class="c"># tang : r x 2</span>
        <span class="c"># rang : r x 2</span>
        <span class="c">#</span>
        <span class="c"># Rt : 2 x 2 x r</span>
        <span class="c"># Rr : 2 x 2 x r</span>
        <span class="c">#</span>
        <span class="c"># tangl : r x 2</span>
        <span class="c"># rangl : r x 2</span>
        <span class="c">#</span>

        <span class="n">Rt</span><span class="p">,</span> <span class="n">tangl</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB_tx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tt</span><span class="p">)</span>
        <span class="n">Rr</span><span class="p">,</span> <span class="n">rangl</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB_rx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tr</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># update direction of departure and arrival</span>
        <span class="c">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">tangl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">rangl</span>

        <span class="c">#uf = np.ones(self.nfreq)</span>

        <span class="c">#</span>
        <span class="c"># r0 : r x 1(f)</span>
        <span class="c">#</span>

        <span class="c">#r0 = np.outer(Rr[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rr[0, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">t00</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t01</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c">#r0 = np.outer(Rr[1, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rr[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">t10</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t11</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c">#r0 = np.outer(Rt[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rt[1, 0,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">Cttl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cptl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="c">#r0 = np.outer(Rt[0, 1,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="c">#r1 = np.outer(Rt[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

        <span class="n">Ctpl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cppl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cttl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cptl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cppl</span><span class="p">)</span>



        <span class="k">return</span> <span class="bp">self</span>

</div>
<div class="viewcode-block" id="Ctilde.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.show.html#pylayers.antprop.channel.Ctilde.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show the propagation channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ   : &#39;m&#39;, &#39;l20&#39; , &#39;r&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;typ&#39;</span><span class="p">:</span> <span class="s">&#39;m&#39;</span><span class="p">,</span>
                   <span class="s">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;f (GHz)&#39;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">u&#39;$C_{</span><span class="se">\\</span><span class="s">theta</span><span class="se">\\</span><span class="s">theta}$&#39;</span><span class="p">)</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;f (GHz)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">u&#39;$C_{</span><span class="se">\\</span><span class="s">theta\phi}$&#39;</span><span class="p">)</span>

        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;f (GHz)&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">u&#39;$C_{\phi</span><span class="se">\\</span><span class="s">theta}$&#39;</span><span class="p">)</span>

        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;f (GHz)&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">u&#39;$C_{\phi\phi}$&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.check_reciprocity"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.check_reciprocity.html#pylayers.antprop.channel.Ctilde.check_reciprocity">[docs]</a>    <span class="k">def</span> <span class="nf">check_reciprocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">,:],</span> <span class="n">C</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">,:]):</span>
                <span class="k">print</span> <span class="n">r</span>

        <span class="c"># assert np.allclose(self.tang,C.rang)</span>
        <span class="c"># assert np.allclose(self.rang,C.tang)</span>

</div>
<div class="viewcode-block" id="Ctilde.energy"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.energy.html#pylayers.antprop.channel.Ctilde.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sumray</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates energy on each channel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ECtt  : Energy on co channel    tt</span>
<span class="sd">        ECpp  : Energy on co channel    pp</span>
<span class="sd">        ECtp  : Energy on co channel    tp</span>
<span class="sd">        ECpt  : Energy on co channel    pt</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.FUsignal.energy</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#</span>
        <span class="c">#  r x f</span>
        <span class="c">#  axis 0 : ray</span>
        <span class="c">#  axis 1 : frequency</span>
        <span class="c">#</span>
        <span class="n">ECtt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sumray</span><span class="p">:</span>
            <span class="n">ECtt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECtt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECtp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECtp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECpt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECpp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECpp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ECtt</span><span class="p">,</span> <span class="n">ECpp</span><span class="p">,</span> <span class="n">ECtp</span><span class="p">,</span> <span class="n">ECpt</span>
</div>
<div class="viewcode-block" id="Ctilde.sort"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.sort.html#pylayers.antprop.channel.Ctilde.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;tauk&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sort Ctilde with respect to typ (default tauk)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ  : string</span>
<span class="sd">            which parameter to sort &#39;</span>
<span class="sd">                tauk : (default)</span>
<span class="sd">                att  : theta Tx</span>
<span class="sd">                atp  : phi Tx</span>
<span class="sd">                art  : theta Rx</span>
<span class="sd">                arp  : phi Rx</span>
<span class="sd">                energy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;tauk&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;att&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;atp&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;art&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;arp&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;energy&#39;</span><span class="p">:</span>
            <span class="n">Ett</span><span class="p">,</span> <span class="n">Epp</span><span class="p">,</span> <span class="n">Etp</span><span class="p">,</span> <span class="n">Ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Ett</span><span class="o">+</span><span class="n">Epp</span><span class="o">+</span><span class="n">Etp</span><span class="o">+</span><span class="n">Ept</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
</div>
<div class="viewcode-block" id="Ctilde.prop2tran"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.prop2tran.html#pylayers.antprop.channel.Ctilde.prop2tran">[docs]</a>    <span class="k">def</span> <span class="nf">prop2tran</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s">&#39;theta&#39;</span><span class="p">,</span><span class="n">Ta</span><span class="o">=</span><span class="p">[],</span><span class="n">Tb</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; transform propagation channel into transmission channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : string or antenna array</span>
<span class="sd">            polarization antenna a ( &#39;theta&#39; | &#39;phi&#39; | &#39;ant&#39; )</span>
<span class="sd">        b : string or antenna array</span>
<span class="sd">            polarization antenna b ( &#39;theta&#39; | &#39;phi&#39; | &#39;ant&#39; )</span>

<span class="sd">            0 : theta</span>
<span class="sd">            1 : phi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        H : Tchannel(bs.FUDAsignal)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span>
        <span class="n">nray</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span><span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nray</span><span class="o">*</span><span class="n">nfreq</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;phi&#39;</span><span class="p">:</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nray</span><span class="o">*</span><span class="n">nfreq</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
            <span class="n">Fat</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Fat</span><span class="p">)</span>
            <span class="n">Fap</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Fap</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">fromfile</span> <span class="p">:</span>
                <span class="n">Fat</span><span class="p">,</span> <span class="n">Fap</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">Fat</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">Fap</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fat</span><span class="p">)</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fap</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Fat</span><span class="p">,</span> <span class="n">Fap</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Fpatt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fat</span><span class="p">)</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fap</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span><span class="p">:</span>
                <span class="n">Fbt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
                <span class="n">Fbp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nray</span><span class="o">*</span><span class="n">nfreq</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s">&#39;phi&#39;</span><span class="p">:</span>
                <span class="n">Fbp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>
                <span class="n">Fbt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nray</span><span class="o">*</span><span class="n">nfreq</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nray</span><span class="p">,</span> <span class="n">nfreq</span><span class="p">))</span>

            <span class="n">Fbt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Fbt</span><span class="p">)</span>
            <span class="n">Fbp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Fbp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">fromfile</span> <span class="p">:</span>
                <span class="n">Fbt</span><span class="p">,</span> <span class="n">Fbp</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">Fbt</span> <span class="o">=</span> <span class="n">Fbt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">Fbp</span> <span class="o">=</span> <span class="n">Fbp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="n">Fbt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fbt</span><span class="p">)</span>
                <span class="n">Fbp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fbp</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Fbt</span><span class="p">,</span> <span class="n">Fbp</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">Fpatt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">Fbt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fbt</span><span class="p">)</span>
                <span class="n">Fbp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Fbp</span><span class="p">)</span>
        <span class="c"># Ctt : r x f</span>
        <span class="c"># Cg2cl should be applied here</span>
        <span class="c">#</span>


        <span class="c">#t1 = self.Ctt * Fat + self.Cpt * Fap</span>
        <span class="c">#t2 = self.Ctp * Fat + self.Cpp * Fap</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">*</span> <span class="n">Fat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">*</span> <span class="n">Fap</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">*</span> <span class="n">Fat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">*</span> <span class="n">Fap</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Fbt</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Fbp</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">(</span><span class="n">alpha</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.vec2scal"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.vec2scal.html#pylayers.antprop.channel.Ctilde.vec2scal">[docs]</a>    <span class="k">def</span> <span class="nf">vec2scal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate scalChannel from VectChannel and antenna</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        slach : ScalChannel</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>

<span class="sd">        deprecated this is now replaced by the function prop2tran</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Ftt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span>
        <span class="n">Frt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span>
        <span class="n">Frp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sh</span><span class="p">))</span>
        <span class="n">scalch</span> <span class="o">=</span> <span class="n">ScalChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ftt</span><span class="p">,</span> <span class="n">Ftp</span><span class="p">,</span> <span class="n">Frt</span><span class="p">,</span> <span class="n">Frp</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">scalch</span><span class="p">)</span>

    <span class="c"># Inclusion of realistic antenna behaviour</span>
    <span class="c"># Specify transmitter antenna and receiver antenna</span>
</div>
<div class="viewcode-block" id="Ctilde.vec2scalA"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.vec2scalA.html#pylayers.antprop.channel.Ctilde.vec2scalA">[docs]</a>    <span class="k">def</span> <span class="nf">vec2scalA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">At</span><span class="p">,</span> <span class="n">Ar</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        At : transmitter antenna</span>
<span class="sd">        Ar : receiver antenna</span>
<span class="sd">        alpha : normalization factor</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate ScalChannel by combining the propagation channel VectChannel</span>
<span class="sd">        with realistic antennas transfer function</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Ftt</span><span class="p">,</span> <span class="n">Ftp</span> <span class="o">=</span> <span class="n">At</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">Frt</span><span class="p">,</span> <span class="n">Frp</span> <span class="o">=</span> <span class="n">Ar</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">Ftt</span> <span class="o">=</span> <span class="n">Ftt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="n">Ftp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">Frt</span> <span class="o">=</span> <span class="n">Frt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">Frp</span> <span class="o">=</span> <span class="n">Frp</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="n">Ftt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">At</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Ftt</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">At</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">Frt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">Ar</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Frt</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">Frp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">Ar</span><span class="o">.</span><span class="n">fa</span><span class="p">,</span> <span class="n">Frp</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>

        <span class="n">scalch</span> <span class="o">=</span> <span class="n">ScalChannel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ftt</span><span class="p">,</span> <span class="n">Ftp</span><span class="p">,</span> <span class="n">Frt</span><span class="p">,</span> <span class="n">Frp</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">scalch</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Ctilde.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Ctilde.info.html#pylayers.antprop.channel.Ctilde.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Info (Nf,Nray,shape(y))</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot;Nfreq  :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span>
        <span class="k">print</span> <span class="s">&quot;Nray :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span>
        <span class="k">print</span> <span class="s">&quot;shape Ctt :&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;shape Ctp :&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;shape Cpt :&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;shape Cpp :&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>


</div>
<span class="k">class</span> <span class="nc">Tchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">FUDAsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handle the transmission channel</span>

<span class="sd">    The transmission channel TChannel is obtained through combination of the propagation</span>
<span class="sd">    channel and the antenna transfer functions from both transmitter and receiver.</span>

<span class="sd">    Members</span>
<span class="sd">    -------</span>

<span class="sd">        ray transfer functions  (nray,nfreq)</span>
<span class="sd">    dod  :</span>
<span class="sd">        direction of depature (rad) [theta_t,phi_t]  nray x 2</span>
<span class="sd">    doa  :</span>
<span class="sd">        direction of arrival (rad)  [theta_r,phi_r]  nray x 2</span>
<span class="sd">    tauk :</span>
<span class="sd">        delay ray k in ns</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    imshow()</span>
<span class="sd">    apply(W)</span>
<span class="sd">    applywavB(Wgam,Tw)</span>
<span class="sd">    applywavB(Wgam)</span>
<span class="sd">    applywavC(Wgam)</span>
<span class="sd">    chantap(fcGHz,WGHz,Ntap)</span>
<span class="sd">    doddoa()</span>
<span class="sd">    wavefig(w,Nray)</span>
<span class="sd">    rayfig(w,Nray)</span>
<span class="sd">    RSSI(ufreq)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    pylayers.antprop.Ctilde.prop2tran</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tchannel.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.__init__.html#pylayers.antprop.channel.Tchannel.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">alpha</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">tau</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([],)),</span>
                <span class="n">dod</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[],[]]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">doa</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[],[]]))</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz  :  1 x nfreq</span>
<span class="sd">        alpha :  channel amplitude (nray x nfreq)</span>
<span class="sd">        tau   :  delay (1 x nray)</span>
<span class="sd">        dod   :  direction of departure (nray x 2)</span>
<span class="sd">        doa   :  direction of arrival  (nray x 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bs</span><span class="o">.</span><span class="n">FUDAsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fGHz</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">dod</span><span class="p">,</span> <span class="n">doa</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Tchannel.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.__repr__.html#pylayers.antprop.channel.Tchannel.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;freq :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;shape  :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;tau :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">))</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;dist :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">))</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Tchannel.saveh5"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.saveh5.html#pylayers.antprop.channel.Tchannel.saveh5">[docs]</a>    <span class="k">def</span> <span class="nf">saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Ta</span><span class="p">,</span><span class="n">Tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        a : np.ndarray</span>
<span class="sd">            postion of point a (transmitter)</span>
<span class="sd">        b : np.ndarray</span>
<span class="sd">            postion of point b (receiver)</span>
<span class="sd">        Ta : np.ndarray</span>
<span class="sd">            rotation matrice of antenna a</span>
<span class="sd">        Tb : np.ndarray</span>
<span class="sd">            rotation matrice of antenna b</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filename</span><span class="o">=</span> <span class="n">_Lfilename</span> <span class="o">+</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.h5&#39;</span>
        <span class="n">filenameh5</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRH&#39;</span><span class="p">])</span>

        <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                
        <span class="c"># try/except to avoid loosing the h5 file if </span>
        <span class="c"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">a</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">b</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Ta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Ta</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Tb&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Tb</span>
            <span class="c"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">va</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel Tchannel: issue when writting h5py file&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Tchannel.loadh5"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.loadh5.html#pylayers.antprop.channel.Tchannel.loadh5">[docs]</a>    <span class="k">def</span> <span class="nf">loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        output : bool </span>
<span class="sd">            return an output precised in return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        if output:</span>
<span class="sd">        (a,b,Ta,Tb) </span>
<span class="sd">        </span>
<span class="sd">        with </span>
<span class="sd">            a = np.ndarray</span>
<span class="sd">                postion of point a (transmitter)</span>
<span class="sd">            b = np.ndarray</span>
<span class="sd">                postion of point b (receiver)</span>
<span class="sd">            Ta = np.ndarray</span>
<span class="sd">                rotation matrice of antenna a</span>
<span class="sd">            Tb = np.ndarray</span>
<span class="sd">                rotation matrice of antenna b</span>


<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="n">filename</span> <span class="o">=</span> <span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.h5&#39;</span>
        <span class="n">filenameh5</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRH&#39;</span><span class="p">])</span>
        
        <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&#39;tau1&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">[:])</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">]</span>
            <span class="n">Ta</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Ta&#39;</span><span class="p">]</span>
            <span class="n">Tb</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;Tb&#39;</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">output</span> <span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Ta</span><span class="p">,</span><span class="n">Tb</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel Tchannel: issue when reading h5py file&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Tchannel object in hdf5 format compliant with Link Class</span>

<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRLNK&#39;</span><span class="p">])</span>
                
        <span class="c"># try/except to avoid loosing the h5 file if </span>
        <span class="c"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grpname</span> <span class="ow">in</span> <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
                <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">grpname</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Warning : H/&#39;</span><span class="o">+</span><span class="n">grpname</span> <span class="o">+</span><span class="s">&#39;already exists in &#39;</span><span class="o">+</span><span class="n">filenameh5</span>
            <span class="n">f</span><span class="o">=</span><span class="n">fh5</span><span class="p">[</span><span class="s">&#39;H/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">va</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel Tchannel: issue when writting h5py file&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load Ctilde object in hdf5 format compliant with Link Class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>

<span class="sd">        &quot;&quot;&quot;</span>    
        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRLNK&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fh5</span><span class="p">[</span><span class="s">&#39;H/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="c"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&#39;tau1&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">[:])</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">)</span>

            
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;Channel Tchannel: issue when reading h5py file&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Tchannel.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.info.html#pylayers.antprop.channel.Tchannel.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s">&#39;Ftt,Ftp,Frt,Frp&#39;</span>
        <span class="k">print</span> <span class="s">&#39;dod,doa,tau&#39;</span>
        <span class="k">print</span> <span class="s">&#39;H - FUDsignal &#39;</span>
        <span class="k">print</span> <span class="s">&#39;tau min , tau max :&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Tchannel.apply"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.apply.html#pylayers.antprop.channel.Tchannel.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Apply a FUsignal W to the ScalChannel.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        W :  Bsignal.FUsignal</span>

<span class="sd">        It exploits multigrid convolution from Bsignal.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            + W may have a more important number of points and a smaller frequency band.</span>
<span class="sd">            + If the frequency band of the waveform exceeds the one of the ScalChannei, a warning is sent.</span>
<span class="sd">            + W is a FUsignal whose shape doesn&#39;t need to be homogeneous with FUDsignal H</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">W</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUDAsignal</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Tchannel.applywavC"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.applywavC.html#pylayers.antprop.channel.Tchannel.applywavC">[docs]</a>    <span class="k">def</span> <span class="nf">applywavC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">dxw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method C</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w     :</span>
<span class="sd">            waveform</span>
<span class="sd">        dxw</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The overall received signal is built in time domain</span>
<span class="sd">        w is apply on the overall CIR</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">ft1</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dxh</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dxh</span> <span class="o">-</span> <span class="n">dxw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dxh</span> <span class="o">&lt;</span> <span class="n">dxw</span><span class="p">):</span>
                <span class="c"># reinterpolate w</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># reinterpolate h</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxw</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>

        <span class="n">ri</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Tchannel.chantap"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.chantap.html#pylayers.antprop.channel.Tchannel.chantap">[docs]</a>    <span class="k">def</span> <span class="nf">chantap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; channel tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz :</span>
<span class="sd">            WGHz  :</span>
<span class="sd">        Ntap  :</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s">&#39;WGHz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">&#39;Ntap&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>



        <span class="n">h</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUDsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">)</span>
        <span class="n">htap</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">chantap</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">htap</span>
</div>
<div class="viewcode-block" id="Tchannel.applywavB"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.applywavB.html#pylayers.antprop.channel.Tchannel.applywavB">[docs]</a>    <span class="k">def</span> <span class="nf">applywavB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Wgam</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method B (time domain )</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam : waveform including gamma factor</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ri  : TUDsignal</span>

<span class="sd">            impulse response for each ray separately</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>

<span class="sd">            The overall received signal is built in time domain</span>

<span class="sd">            Wgam is applied on each Ray Transfer function</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.TUDsignal.ft1</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># return a FUDsignal</span>
        <span class="c">#</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Wgam</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">ft1</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Tchannel.applywavA"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.applywavA.html#pylayers.antprop.channel.Tchannel.applywavA">[docs]</a>    <span class="k">def</span> <span class="nf">applywavA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Wgam</span><span class="p">,</span> <span class="n">Tw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method A</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam :</span>
<span class="sd">        Tw   :</span>

<span class="sd">        The overall received signal is built in frequency domain</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Hab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ft2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">HabW</span> <span class="o">=</span> <span class="n">Hab</span> <span class="o">*</span> <span class="n">Wgam</span>
        <span class="n">RI</span> <span class="o">=</span> <span class="n">HabW</span><span class="o">.</span><span class="n">symHz</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">RI</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;natural&#39;</span><span class="p">)</span>
        <span class="n">ri</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">Tw</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span>

   </div>
<div class="viewcode-block" id="Tchannel.plotd"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.plotd.html#pylayers.antprop.channel.Tchannel.plotd">[docs]</a>    <span class="k">def</span> <span class="nf">plotd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s">&#39;doa&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot direction of arrival/departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: &#39;doa&#39; | &#39;dod&#39;        </span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis    </span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s">&#39;doa&#39;</span><span class="p">)</span>


        <span class="c"># remove non plt.scatter kwargs</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;phi&#39;</span><span class="p">)</span>
        <span class="n">the</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;reverse&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">Etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span>


        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c"># WARNING polar plot require radian angles</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">the</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;$</span><span class="se">\\</span><span class="s">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&quot;$</span><span class="se">\\</span><span class="s">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">b</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;dB&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Path Loss (dB)&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Tchannel.plotad"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.plotad.html#pylayers.antprop.channel.Tchannel.plotad">[docs]</a>    <span class="k">def</span> <span class="nf">plotad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s">&#39;phi&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot angular delays</span>

<span class="sd">         Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: &#39;doa&#39; | &#39;dod&#39;        </span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        typ : &#39;ns&#39; | &#39;m&#39;</span>
<span class="sd">            display delays in nano seconds ( ns) or meter (m)</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis    </span>
<span class="sd">        a : str </span>
<span class="sd">            angle &#39;theta&#39; | &#39;phi&#39;</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        titel : bool</span>
<span class="sd">        &#39;clipval&#39;: float</span>
<span class="sd">            remove values below clipval in dB </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;taumin&#39;</span><span class="p">:[],</span>
                    <span class="s">&#39;taumax&#39;</span><span class="p">:[],</span>
                    <span class="s">&#39;typ&#39;</span><span class="p">:</span><span class="s">&#39;m&#39;</span><span class="p">,</span>
                    <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;clipval&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2500</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>



        

        <span class="c"># remove non plt.scatter kwargs</span>

        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">dmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;taumin&#39;</span><span class="p">)</span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;taumax&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">)</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;typ&#39;</span><span class="p">)</span>
        <span class="n">clipval</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;clipval&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span><span class="p">:</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span><span class="o">*</span><span class="mf">0.3</span>

        <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dmax</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

        


        <span class="n">Etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span>


        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c"># WARNING polar plot require radian angles</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>


        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">col</span> <span class="o">&gt;=</span> <span class="n">clipval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="n">cv</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">delay</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;m&#39;</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;distance (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="n">cv</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">delay</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&quot;$</span><span class="se">\\</span><span class="s">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;m&#39;</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&quot;distance (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>        
            <span class="k">if</span> <span class="n">title</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;DoA vs delay (ns)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">b</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;dB&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s">&#39;Path Loss (dB)&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>




</div>
<div class="viewcode-block" id="Tchannel.doadod"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.doadod.html#pylayers.antprop.channel.Tchannel.doadod">[docs]</a>    <span class="k">def</span> <span class="nf">doadod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; doadod scatter plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar bool</span>

<span class="sd">        Summary</span>
<span class="sd">        --------</span>

<span class="sd">        scatter plot of the DoA-DoD channel structure</span>
<span class="sd">        the energy is colorcoded over all couples of DoA-DoD</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;mode&#39;</span><span class="p">:</span><span class="s">&#39;mean&#39;</span>
        
                    <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;polar&#39;</span><span class="p">])</span>
        <span class="n">ax2</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;polar&#39;</span><span class="p">])</span>

        
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colorbar&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s">&#39;dod&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;colorbar&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s">&#39;doa&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Tchannel.energy"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.energy.html#pylayers.antprop.channel.Tchannel.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sumray</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates channel energy including antennas spatial filtering</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        mode : string</span>
<span class="sd">            center | mean | integ    (different manner to get the value)</span>
<span class="sd">        Friis : boolean</span>
<span class="sd">            apply the Frris coeff(2/(4p pi f)</span>
<span class="sd">        sumray: boolean</span>
<span class="sd">            ray energy cummulation indicator</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c">#  r x f</span>
        <span class="c">#  axis 1 : ray</span>
        <span class="c">#  axis 1 : frequency</span>
        <span class="c">#</span>
        <span class="n">Etot</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sumray</span><span class="p">:</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Etot</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Etot</span>




    <span class="c">#def doadod(self, cmap=plt.cm.hot_r, s=30,fontsize = 12,phi=(0, 360),norm=False,polar=False):</span>
    <span class="c"># def doadod(self,**kwargs):</span>
    <span class="c">#     &quot;&quot;&quot; doadod scatter plot</span>

    <span class="c">#     Parameters</span>
    <span class="c">#     -----------</span>

    <span class="c">#     cmap : color map</span>
    <span class="c">#     s    : float</span>
    <span class="c">#         size (default 30)</span>
    <span class="c">#     fontsize : integer</span>
    <span class="c">#         default 12</span>

    <span class="c">#     Summary</span>
    <span class="c">#     --------</span>

    <span class="c">#     scatter plot of the DoA-DoD channel structure</span>
    <span class="c">#     the energy is colorcoded over all couples of DoA-DoD</span>

    <span class="c">#     &quot;&quot;&quot;</span>

    <span class="c">#     defaults = {&#39;cmap&#39; : plt.cm.hot_r,</span>
    <span class="c">#                 &#39;s&#39;: 30,</span>
    <span class="c">#                 &#39;fontsize&#39; : 12,</span>
    <span class="c">#                 &#39;phi&#39;:(-180,180),</span>
    <span class="c">#                 &#39;normalize&#39;:False,</span>
    <span class="c">#                 &#39;polar&#39;:False,</span>
    <span class="c">#                 &#39;mode&#39;:&#39;center&#39;}</span>

    <span class="c">#     for k in defaults:</span>
    <span class="c">#         if k not in kwargs:</span>
    <span class="c">#             kwargs[k] = defaults[k]</span>

    <span class="c">#     args = {}</span>
    <span class="c">#     for k in kwargs:</span>
    <span class="c">#         if k not in defaults:</span>
    <span class="c">#             args[k] = kwargs[k]</span>
                
    <span class="c">#     the = (0,180)</span>
    <span class="c">#     dod = self.dod</span>
    <span class="c">#     doa = self.doa</span>
    <span class="c">#     #</span>
    <span class="c">#     # determine Energy in each channel</span>
    <span class="c">#     #</span>
    <span class="c">#     Etot = self.energy(mode=kwargs[&#39;mode&#39;]) +1e-15</span>

    <span class="c">#     # normalization</span>
    <span class="c">#     if kwargs[&#39;normalize&#39;]:</span>
    <span class="c">#         Emax = max(Etot)</span>
    <span class="c">#         Etot = Etot / Emax</span>

    <span class="c">#     Emax = max(10 * np.log10(Etot))</span>
    <span class="c">#     Emin = min(10 * np.log10(Etot))</span>

    <span class="c">#     #</span>
    <span class="c">#     #</span>
    <span class="c">#     #</span>
    <span class="c">#     # col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
    <span class="c">#     #</span>

    <span class="c">#     if kwargs[&#39;polar&#39;] :</span>
    <span class="c">#         al = 1.</span>
    <span class="c">#         phi=np.array(phi)</span>
    <span class="c">#         the=np.array(the)            </span>
    <span class="c">#         phi[0] = phi[0]*np.pi/180</span>
    <span class="c">#         phi[1] = phi[1]*np.pi/180</span>
    <span class="c">#         the[0] = the[0]*np.pi/180</span>
    <span class="c">#         the[1] = the[1]*np.pi/180</span>
    <span class="c">#     else :</span>
    <span class="c">#         al = 180./np.pi</span>

    <span class="c">#     col = 10 * np.log10(Etot)</span>

    <span class="c">#     if len(col) != len(dod):</span>
    <span class="c">#         print &quot;len(col):&quot;, len(col)</span>
    <span class="c">#         print &quot;len(dod):&quot;, len(dod)</span>

    <span class="c">#     plt.subplot(121, polar=kwargs[&#39;polar&#39;])</span>
    <span class="c">#     if kwargs[&#39;reverse&#39;]:</span>
    <span class="c">#         plt.scatter(dod[:, 1] * al, dod[:, 0] * al,</span>
    <span class="c">#                     s=kwargs[&#39;s&#39;], c=col,</span>
    <span class="c">#                     cmap=kwargs[&#39;cmap&#39;],</span>
    <span class="c">#                     edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1],the[0],the[1]))</span>
    <span class="c">#         plt.xlabel(&#39;$\phi(^{\circ})$&#39;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\\theta_t(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     else:</span>
    <span class="c">#         plt.scatter(dod[:, 0] * al, dod[:, 1] * al,</span>
    <span class="c">#                     s=kwargs[&#39;s&#39;], c=col,</span>
    <span class="c">#                     cmap=kwargs[&#39;cmap&#39;],</span>
    <span class="c">#                     edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((the[0], the[1], kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\\theta_t(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&#39;$\phi(^{\circ})$&#39;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     # ylabel(&#39;$\phi_t(^{\circ})$&#39;,fontsize=18)</span>
    <span class="c">#     plt.title(&#39;DoD&#39;, fontsize=kwargs[&#39;fontsize&#39;]+2)</span>


    <span class="c">#     plt.subplot(122, polar=kwargs[&#39;polar&#39;])</span>
    <span class="c">#     if kwargs[&#39;reverse&#39;]:</span>
    <span class="c">#         plt.scatter(doa[:, 1] * al, doa[:, 0] * al, s=30, c=col,</span>
    <span class="c">#                     cmap=plt.cm.hot_r, edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1],the[0],the[1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\phi_r (^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\\theta_r(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
            
    <span class="c">#     else :</span>
    <span class="c">#         plt.scatter(doa[:, 0] * al, doa[:, 1] * al, s=30, c=col,</span>
    <span class="c">#                     cmap=plt.cm.hot_r, edgecolors=&#39;none&#39;)</span>
    <span class="c">#         plt.axis((the[0], the[1], kwargs[&#39;phi&#39;][0], kwargs[&#39;phi&#39;][1]))</span>
    <span class="c">#         plt.xlabel(&quot;$\\theta_r(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#         plt.ylabel(&quot;$\phi_r (^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>

    <span class="c">#     plt.title(&#39;DoA&#39;, fontsize=kwargs[&#39;fontsize&#39;]+2)</span>

    <span class="c">#     # plt.xticks(fontsize=20)</span>
    <span class="c">#     # plt.yticks(fontsize=20)</span>
    <span class="c">#     b = plt.colorbar()</span>
    <span class="c">#     if kwargs[&#39;normalize&#39;]:</span>
    <span class="c">#         b.set_label(&#39;dB&#39;)</span>
    <span class="c">#     else:</span>
    <span class="c">#         b.set_label(&#39;Path Loss (dB)&#39;)</span>
    <span class="c">#     # for t in b.ax.get_yticklabels():</span>
    <span class="c">#     #    t.set_fontsize(20)</span>
    <span class="c">#     plt.xlabel(&quot;$\\theta_r(^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>
    <span class="c">#     plt.title(&#39;DoA&#39;, fontsize=kwargs[&#39;fontsize&#39;]+2)</span>
    <span class="c">#     plt.ylabel(&quot;$\phi_r (^{\circ})$&quot;, fontsize=kwargs[&#39;fontsize&#39;])</span>


</div>
<div class="viewcode-block" id="Tchannel.wavefig"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.wavefig.html#pylayers.antprop.channel.Tchannel.wavefig">[docs]</a>    <span class="k">def</span> <span class="nf">wavefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Nray</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        w      :  waveform</span>
<span class="sd">        Nray   :  int</span>
<span class="sd">            number of rays to be displayed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Construire W</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">ft</span><span class="p">()</span>
        <span class="c"># Appliquer W</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="c"># r.require(&#39;graphics&#39;)</span>
        <span class="c"># r.postscript(&#39;fig.eps&#39;)</span>
        <span class="c"># r(&#39;par(mfrow=c(2,2))&#39;)</span>
        <span class="c"># Y.fig(Nray)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iftd</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">fig</span><span class="p">(</span><span class="n">Nray</span><span class="p">)</span>
        <span class="c"># r.dev_off()</span>
        <span class="c"># os.system(&quot;gv fig.eps &quot;)</span>
        <span class="c"># y.fidec()</span>
        <span class="c"># Sur le FUsignal retourn</span>
        <span class="c"># A gauche afficher le signal sur chaque rayon</span>
        <span class="c"># A droite le meme signal decal</span>
        <span class="c"># En bas a droite le signal resultant</span>
</div>
<div class="viewcode-block" id="Tchannel.rayfig"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.rayfig.html#pylayers.antprop.channel.Tchannel.rayfig">[docs]</a>    <span class="k">def</span> <span class="nf">rayfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build a figure with rays</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : ray index</span>
<span class="sd">        W : waveform    (FUsignal)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        W is apply on k-th ray and the received signal is built in time domain</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get the kth Ray  Transfer function</span>
        <span class="n">Hk</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUDsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,:])</span>

        <span class="n">dxh</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">dxw</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">w0</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c"># fmin W</span>
        <span class="n">hk0</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c"># fmin Hk</span>

        <span class="c"># on s&#39;arrange pour que hk0 soit egal a w0 (ou hk0 soit legerement inferieur a w0)</span>
        <span class="k">if</span> <span class="n">w0</span> <span class="o">&lt;</span> <span class="n">hk0</span><span class="p">:</span>
            <span class="n">np</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">hk0</span> <span class="o">-</span> <span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dxh</span><span class="p">)</span>
            <span class="n">hk0_new</span> <span class="o">=</span> <span class="n">hk0</span> <span class="o">-</span> <span class="n">np</span> <span class="o">*</span> <span class="n">dxh</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">hk0_new</span><span class="p">,</span> <span class="n">hk0</span> <span class="o">+</span> <span class="n">dxh</span><span class="p">,</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Hk</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">Hk</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="p">),</span> <span class="n">Hk</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dxh</span> <span class="o">-</span> <span class="n">dxw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dxh</span> <span class="o">&lt;</span> <span class="n">dxw</span><span class="p">):</span>
                <span class="c"># reinterpolate w</span>
                <span class="k">print</span> <span class="s">&quot; resampling w&quot;</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxh</span><span class="p">,</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Wk</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">dxh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># reinterpolate h</span>
                <span class="k">print</span> <span class="s">&quot; resampling h&quot;</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxw</span><span class="p">,</span> <span class="n">dxw</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Hk</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">dxw</span>
                <span class="n">Wk</span> <span class="o">=</span> <span class="n">W</span>

        <span class="c"># qHk.x[0]==Wk.x[0]</span>
</div>
<div class="viewcode-block" id="Tchannel.RSSI"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.channel.Tchannel.RSSI.html#pylayers.antprop.channel.Tchannel.RSSI">[docs]</a>    <span class="k">def</span> <span class="nf">RSSI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ufreq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Compute RSSI value from a</span>
<span class="sd">        specific frequency of the transmission channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ufreq : int</span>
<span class="sd">            index in the frequency range</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        RSSI: float</span>
<span class="sd">        RSSI value</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function will be deprecated by energy function</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Tk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="n">ufreq</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Tk</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

<span class="c">#def Cg2Cl(Cg, Tt, Tr):</span>
<span class="c">#    &quot;&quot;&quot; global reference frame to local reference frame</span>
<span class="c">#</span>
<span class="c">#    Parameters</span>
<span class="c">#    ----------</span>
<span class="c">#</span>
<span class="c">#    Cg  : Ctilde global</span>
<span class="c">#    Tt  : Tx rotation matrix 3x3</span>
<span class="c">#    Tr  : Rx rotation matrix 3x3</span>
<span class="c">#</span>
<span class="c">#    Returns</span>
<span class="c">#    -------</span>
<span class="c">#</span>
<span class="c">#    Cl : Ctilde local</span>
<span class="c">#</span>
<span class="c">#    Examples</span>
<span class="c">#    --------</span>
<span class="c">#</span>
<span class="c">#    &quot;&quot;&quot;</span>
<span class="c">#    import copy</span>
<span class="c">#   </span>
<span class="c">#    # don&#39;t loose the global channel</span>
<span class="c">#    Cl = copy.deepcopy(Cg)</span>
<span class="c">#   </span>
<span class="c">#    # get frequency axes   </span>
<span class="c">#    fGHz = Cl.fGHz</span>
<span class="c">#   </span>
<span class="c">#    # get angular axes</span>
<span class="c">#</span>
<span class="c">#    # Rt (2x2)</span>
<span class="c">#    # Rr (2x2)</span>
<span class="c">#    Rt, tangl = geu.BTB_tx(Cg.tang, Tt)</span>
<span class="c">#    Rr, rangl = geu.BTB_rx(Cg.rang, Tr)</span>
<span class="c">#</span>
<span class="c">#    Cl.tang = tangl</span>
<span class="c">#    Cl.rang = rangl</span>
<span class="c">#</span>
<span class="c">#    uf = np.ones(VCg.nfreq)</span>
<span class="c">#    r0 = np.outer(Rr[0, 0,:], uf)</span>
<span class="c">#    r1 = np.outer(Rr[0, 1,:], uf)</span>
<span class="c">#</span>
<span class="c">#    # print &quot;shape r0 = &quot;,np.shape(r0)</span>
<span class="c">#    # print &quot;shape VCg.Ctt.y = &quot;,np.shape(VCg.Ctt.y)</span>
<span class="c">#    # print &quot;shape r1 = &quot;,np.shape(r1)</span>
<span class="c">#    # print &quot;shape VCg.Cpt.y = &quot;,np.shape(VCg.Cpt.y)</span>
<span class="c">#</span>
<span class="c">#    t00 = r0 * VCg.Ctt.y + r1 * VCg.Cpt.y</span>
<span class="c">#    t01 = r0 * VCg.Ctp.y + r1 * VCg.Cpp.y</span>
<span class="c">#</span>
<span class="c">#    r0 = np.outer(Rr[1, 0,:], uf)</span>
<span class="c">#    r1 = np.outer(Rr[1, 1,:], uf)</span>
<span class="c">#</span>
<span class="c">#    t10 = r0 * VCg.Ctt.y + r1 * VCg.Cpt.y</span>
<span class="c">#    t11 = r0 * VCg.Ctp.y + r1 * VCg.Cpp.y</span>
<span class="c">#</span>
<span class="c">#    r0 = np.outer(Rt[0, 0,:], uf)</span>
<span class="c">#    r1 = np.outer(Rt[1, 0,:], uf)</span>
<span class="c">#</span>
<span class="c">#    Cttl = t00 * r0 + t01 * r1</span>
<span class="c">#    Cptl = t10 * r0 + t11 * r1</span>
<span class="c">#</span>
<span class="c">#    r0 = np.outer(Rt[0, 1,:], uf)</span>
<span class="c">#    r1 = np.outer(Rt[1, 1,:], uf)</span>
<span class="c">#    Ctpl = t00 * r0 + t01 * r1</span>
<span class="c">#    Cppl = t10 * r0 + t11 * r1</span>
<span class="c">#</span>
<span class="c">#    Cl.Ctt = bs.FUsignal(fGHz, Cttl)</span>
<span class="c">#    Cl.Ctp = bs.FUsignal(fGHz, Ctpl)</span>
<span class="c">#    Cl.Cpt = bs.FUsignal(fGHz, Cptl)</span>
<span class="c">#    Cl.Cpp = bs.FUsignal(fGHz, Cppl)</span>
<span class="c">#</span>
<span class="c">#    return Cl</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, PyLayers developer team.
      Last updated on mars 27, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_setDomainName', 'pylayers.github.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })(); 
</script> 
 
  </body>
</html>