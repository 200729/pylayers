

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.antprop.channel &mdash; PyLayers</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="PyLayers" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html">1&nbsp;&nbsp;&nbsp;pylayers.util.project Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.layout">2&nbsp;&nbsp;&nbsp;pylayers.gis.layout Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.selectl">3&nbsp;&nbsp;&nbsp;pylayers.gis.selectl Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.srtm">4&nbsp;&nbsp;&nbsp;pylayers.gis.srtm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.osmparser">5&nbsp;&nbsp;&nbsp;pylayers.gis.osmparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.ezone">6&nbsp;&nbsp;&nbsp;pylayers.gis.ezone Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antenna">7&nbsp;&nbsp;&nbsp;pylayers.antprop.antenna Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.aarray">8&nbsp;&nbsp;&nbsp;pylayers.antprop.aarray Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.spharm">9&nbsp;&nbsp;&nbsp;pylayers.antprop.spharm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antssh">10&nbsp;&nbsp;&nbsp;pylayers.antprop.antssh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antvsh">11&nbsp;&nbsp;&nbsp;pylayers.antprop.antvsh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.slab">12&nbsp;&nbsp;&nbsp;pylayers.antprop.slab Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.signature">13&nbsp;&nbsp;&nbsp;pylayers.antprop.signature Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.interactions">14&nbsp;&nbsp;&nbsp;pylayers.antprop.interactions Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffraction">15&nbsp;&nbsp;&nbsp;pylayers.antprop.diffraction Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffRT">16&nbsp;&nbsp;&nbsp;pylayers.antprop.diffRT Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.rays">17&nbsp;&nbsp;&nbsp;pylayers.antprop.rays Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.loss">18&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.channel">19&nbsp;&nbsp;&nbsp;pylayers.antprop.channel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id39">20&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coverage">21&nbsp;&nbsp;&nbsp;pylayers.antprop.coverage Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coeffModel">22&nbsp;&nbsp;&nbsp;pylayers.antprop.coeffModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.link">23&nbsp;&nbsp;&nbsp;pylayers.simul.link Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit">24&nbsp;&nbsp;&nbsp;pylayers.simul.exploit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit_simulnet">25&nbsp;&nbsp;&nbsp;pylayers.simul.exploit_simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simulnet">26&nbsp;&nbsp;&nbsp;pylayers.simul.simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simultraj">27&nbsp;&nbsp;&nbsp;pylayers.simul.simultraj Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.exploit.simnet">28&nbsp;&nbsp;&nbsp;pylayers.exploit.simnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesuwb">29&nbsp;&nbsp;&nbsp;pylayers.measures.mesuwb Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesmimo">30&nbsp;&nbsp;&nbsp;pylayers.measures.mesmimo Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.cormoran">31&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.vna.E5072A">32&nbsp;&nbsp;&nbsp;pylayers.measures.vna.E5072A Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.parker.smparker">33&nbsp;&nbsp;&nbsp;pylayers.measures.parker.smparker Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.bsignal">34&nbsp;&nbsp;&nbsp;pylayers.signal.bsignal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.device">35&nbsp;&nbsp;&nbsp;pylayers.signal.device Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.DF">36&nbsp;&nbsp;&nbsp;pylayers.signal.DF Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.waveform">37&nbsp;&nbsp;&nbsp;pylayers.signal.waveform Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.agent">38&nbsp;&nbsp;&nbsp;pylayers.mobility.agent Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.ban.body">39&nbsp;&nbsp;&nbsp;pylayers.mobility.ban.body Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id134">40&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>pylayers.antprop.channel</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.antprop.channel</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*t coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. currentmodeul:: pylayters.antprop.channel </span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :members:</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="kn">as</span> <span class="nn">si</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">numpy.fft</span> <span class="kn">as</span> <span class="nn">fft</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">import</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">as</span> <span class="nn">ant</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">h5py</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;h5py is not installed: Ctilde(object cannot be saved)&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="AFPchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.AFPchannel.html#pylayers.antprop.channel.AFPchannel">[docs]</a><span class="k">class</span> <span class="nc">AFPchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Angular Frequency Profile channel</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    x : np.array</span>
<span class="sd">        frequency ,Nf</span>
<span class="sd">    y : np.array</span>
<span class="sd">        Amplitude Na,Nf</span>
<span class="sd">    tx : np.array</span>
<span class="sd">        tx coordinate (,3)</span>
<span class="sd">    rx : np.array</span>
<span class="sd">        rx coordinates (,3)</span>
<span class="sd">    az : np.array (,Na)</span>
<span class="sd">        AFP azimutal range in radians</span>
<span class="sd">    theta : link elevation angle </span>
<span class="sd">    phi : link (txrx) azimuth angle (with offset)</span>
<span class="sd">    tau : link delay (ns) </span>
<span class="sd">        </span>
<span class="sd">    offset : float angle in radians</span>
<span class="sd">        azimuth offset w.r.t global frame</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                      <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                      <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                      <span class="n">rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                      <span class="n">az</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> 
                      <span class="p">):</span>
        <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;AFP&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refinement</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="n">az</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Angular Frequency Profile object </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Tx : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Rx : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="AFPchannel.loadmes"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.AFPchannel.html#pylayers.antprop.channel.AFPchannel.loadmes">[docs]</a>    <span class="k">def</span> <span class="nf">loadmes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_filename</span><span class="p">,</span><span class="n">_filecal</span><span class="p">,</span><span class="n">fcGHz</span><span class="o">=</span><span class="mf">32.6</span><span class="p">,</span><span class="n">BW</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span><span class="n">win</span><span class="o">=</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span><span class="n">ang_offset</span><span class="o">=</span><span class="mf">0.37</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span><span class="n">dirmeas</span><span class="o">=</span><span class="s1">&#39;meas/Espoo&#39;</span><span class="p">,</span><span class="n">refinement</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load measurement file </span>

<span class="sd">        Measurement files and the associated back to back calibration files </span>
<span class="sd">        are placed in the mes directory of the project.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filename : string</span>
<span class="sd">            data matfile name</span>
<span class="sd">        _filecal : string </span>
<span class="sd">            calibration matfile name</span>
<span class="sd">        fcGHz : float </span>
<span class="sd">            center frequency </span>
<span class="sd">        BW : float </span>
<span class="sd">            measurement bandwidth </span>
<span class="sd">        win : string </span>
<span class="sd">            window type in [&#39;rect&#39;,&#39;hamming&#39;,&#39;blackman&#39;]</span>
<span class="sd">        ang_offset : float </span>
<span class="sd">            angle in radian</span>
<span class="sd">        ext : string</span>
<span class="sd">            file extension &#39;txt&#39; | &#39;.mat&#39;</span>
<span class="sd">        diremeas : string </span>

<span class="sd">        Notes </span>
<span class="sd">        -----</span>
<span class="sd">        This function updates : </span>
<span class="sd">        + self.x (frequency GHz)</span>
<span class="sd">        + self.y </span>
<span class="sd">        + self.az azimuth radians </span>

<span class="sd">        The calibration file _filecal (.mat file) should be added in the data directory</span>
<span class="sd">        In practice for Espoo B2B.mat</span>

<span class="sd">        SEE ALSO </span>
<span class="sd">        --------</span>
<span class="sd">        pylayers.util.pyutil.getlong </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BW</span> <span class="o">=</span> <span class="n">BW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="n">fcGHz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmin</span> <span class="o">=</span> <span class="n">fcGHz</span><span class="o">-</span><span class="n">BW</span><span class="o">/</span><span class="mf">2.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fmax</span> <span class="o">=</span> <span class="n">fcGHz</span><span class="o">+</span><span class="n">BW</span><span class="o">/</span><span class="mf">2.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">win</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refinement</span> <span class="o">=</span> <span class="n">refinement</span>
        <span class="c1"># read calibration file (Matlab file) in the same directory as measurments (convention)</span>
        <span class="n">filecal</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filecal</span><span class="p">,</span><span class="n">dirmeas</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="n">filecal</span><span class="p">)</span>
        <span class="n">cal_trf</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="s1">&#39;cal_trf&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># read measurement file (.txt or Mat file) </span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">dirmeas</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;txt&#39;</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="c1"># load Back 2 Back calibration file</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">2</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">D</span><span class="p">[:,</span><span class="mi">3</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="s1">&#39;amp&#39;</span><span class="p">]</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="s1">&#39;ang&#39;</span><span class="p">]</span> 
            <span class="n">rotationangle</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="s1">&#39;rotationangle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="c1"># load Back 2 Back calibration file</span>
        
        <span class="c1">#</span>
        <span class="c1"># Transfer function reconstruction </span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Na</span>  <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span>  <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># select apodisation window </span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">win</span><span class="o">==</span><span class="s1">&#39;hamming&#39;</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hamming</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">win</span><span class="o">==</span><span class="s1">&#39;blackman&#39;</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">blackman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># complex transfer function </span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fmin</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fmax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">ang</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span><span class="o">*</span><span class="n">cal_trf</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">window</span>
        <span class="c1">#</span>
        <span class="c1"># if extension is txt file comes from ESPOO measurement</span>
        <span class="c1">#</span>
        <span class="c1"># self.az : 5.86 -&gt; 1.94   </span>
        <span class="k">if</span> <span class="n">ext</span><span class="o">==</span><span class="s1">&#39;txt&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azmes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">360</span><span class="o">-</span><span class="n">D</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">azmes</span> <span class="o">+</span> <span class="n">ang_offset</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">azmes</span> <span class="o">=</span> <span class="n">rotationangle</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="n">ang_offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">azmes</span> 
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span></div>

<div class="viewcode-block" id="AFPchannel.toadp"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.AFPchannel.html#pylayers.antprop.channel.AFPchannel.toadp">[docs]</a>    <span class="k">def</span> <span class="nf">toadp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imax</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; convert afp into adp (frequency-&gt;delay) </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># x : delay (starting at 0 ns) </span>
        <span class="c1"># y : ifft axis 1 (frequency) </span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imax</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span> 
        <span class="n">adp</span> <span class="o">=</span> <span class="n">ADPchannel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                         <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                         <span class="n">az</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">,</span>
                         <span class="n">tx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">,</span>
                         <span class="n">rx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">,</span>
                         <span class="n">fcGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span><span class="p">,</span>
                         <span class="n">_filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                         <span class="n">refinement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">refinement</span><span class="p">,</span>
                         <span class="n">ang_offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ang_offset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adp</span> </div></div>

<div class="viewcode-block" id="ADPchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel">[docs]</a><span class="k">class</span> <span class="nc">ADPchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Angular Delay Profile channel</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    az : array</span>
<span class="sd">        azimuth in radian </span>
<span class="sd">    ang_offset :</span>
<span class="sd">    theta :  float </span>
<span class="sd">    phi : float </span>
<span class="sd">    tau : float </span>
<span class="sd">    _filename : string</span>
<span class="sd">        short filename for saving     </span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
            <span class="n">az</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
            <span class="n">tx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
            <span class="n">rx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
            <span class="n">fcGHz</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span>
            <span class="n">_filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">refinement</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">ang_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x : np.array</span>
<span class="sd">            delay  </span>
<span class="sd">        y : np.array</span>
<span class="sd">            angle x delay  </span>
<span class="sd">        az : np.array</span>
<span class="sd">            azimuth angle</span>
<span class="sd">        tx : np.array</span>
<span class="sd">            tx coordinates</span>
<span class="sd">        rx : np.array</span>
<span class="sd">            rx coordinates</span>
<span class="sd">        _filename :</span>
<span class="sd">        offset  : </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;ADP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="n">az</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">tx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">rx</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="n">fcGHz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ang_offset</span> <span class="o">=</span> <span class="n">ang_offset</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> 
        <span class="n">distLOS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span> <span class="o">=</span> <span class="n">distLOS</span><span class="o">/</span><span class="mf">0.3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">LFS</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fcGHz</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">distLOS</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphalos_geo</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">LFS</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span>

        <span class="n">alphapeak</span><span class="p">,</span><span class="n">taupeak</span><span class="p">,</span><span class="n">angpeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak</span><span class="p">(</span><span class="n">refinement</span><span class="o">=</span><span class="n">refinement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span> <span class="o">=</span> <span class="n">angpeak</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span> <span class="o">=</span> <span class="n">taupeak</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alphapeak_est</span> <span class="o">=</span> <span class="n">alphapeak</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span>
     
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Angular Delay Profile object </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Angular offset (degrees) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cv</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ang_offset</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;agmin : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">cv</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; agmax : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cv</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;alpha (geo): &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphalos_geo</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (est): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphapeak_est</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; GdB : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alphapeak_est</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">alphalos_geo</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;tau (geo): &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (est): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;ang (geo): &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; (est): &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    
<div class="viewcode-block" id="ADPchannel.peak"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.peak">[docs]</a>    <span class="k">def</span> <span class="nf">peak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">refinement</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluate peak of PADP</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        refinment : boolean </span>
<span class="sd">            provide a refined version of angular estimation</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        alphapeak, taupeak , phipeak</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alphapeak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">iphi</span><span class="p">,</span><span class="n">itau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">==</span><span class="n">alphapeak</span><span class="p">)</span>
        <span class="n">taupeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">itau</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">refinement</span><span class="p">:</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="n">iphi</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">iphi</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">itau</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">azr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">iphi</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">iphi</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">Id</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pr</span><span class="p">)</span>
            <span class="n">In</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pr</span><span class="o">*</span><span class="n">azr</span><span class="p">)</span>
            <span class="n">phipeak</span> <span class="o">=</span> <span class="n">In</span><span class="o">/</span><span class="n">Id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">phipeak</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">[</span><span class="n">iphi</span><span class="p">]</span>        
        <span class="k">return</span> <span class="n">alphapeak</span><span class="p">,</span><span class="n">taupeak</span><span class="p">,</span><span class="n">phipeak</span></div>
   
<div class="viewcode-block" id="ADPchannel.cut"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">imax</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span></div>

<div class="viewcode-block" id="ADPchannel.correlate"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.correlate">[docs]</a>    <span class="k">def</span> <span class="nf">correlate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">adp</span><span class="p">,</span><span class="n">thresholddB</span><span class="o">=-</span><span class="mi">105</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; correlate ADP with an other ADP</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        adp : ADPchannel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        rhoE  : energy ratio of padp Eadp/Eself</span>
<span class="sd">        rhoEc : energy ratio of centered padp Ecadp/Ecself</span>
<span class="sd">        rho   : normalized intercorrelation  :  &lt;self-mean(self),adp-mean(adp)&gt;/Eself </span>
<span class="sd">        rhon  : intercorrelation of normalized padp   &lt;self_normalized,adp_normalized&gt; </span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This can be uesd to compare a measured PADP with a Ray tracing PADP </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#import ipdb</span>
        <span class="c1">#ipdb.set_trace()</span>
        <span class="c1">#</span>
        <span class="c1"># apply the min dB level thresholding </span>
        <span class="c1">#</span>
        <span class="n">tmp_self</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">tmp_adp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">adp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmp_self</span><span class="p">)</span><span class="o">&gt;</span><span class="n">thresholddB</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tmp_adp</span><span class="p">)</span><span class="o">&gt;</span><span class="n">thresholddB</span><span class="p">)</span>
        <span class="n">padp_self</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tmp_self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">padp_adp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tmp_adp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">padp_self</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_self</span><span class="p">[</span><span class="n">u1</span><span class="p">]</span>
        <span class="n">padp_adp</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_adp</span><span class="p">[</span><span class="n">u2</span><span class="p">]</span>

        <span class="n">padpc_self</span> <span class="o">=</span> <span class="n">padp_self</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">padp_self</span><span class="p">)</span>
        <span class="n">padpc_adp</span>  <span class="o">=</span> <span class="n">padp_adp</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">padp_adp</span><span class="p">)</span>

        <span class="n">Eself</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padp_self</span><span class="p">,</span><span class="n">padp_self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>
        <span class="n">Ecself</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padpc_self</span><span class="p">,</span><span class="n">padpc_self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>
        <span class="n">Eadp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padp_adp</span><span class="p">,</span><span class="n">padp_adp</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>
        <span class="n">Ecadp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padpc_adp</span><span class="p">,</span><span class="n">padpc_adp</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>
        <span class="c1">#Eself =  np.sum(padp_self*padp_self)</span>
        <span class="c1">#Ecself = np.sum(padpc_self*padpc_self)</span>
        <span class="c1">#Eadp = np.sum(padp_adp*padp_adp)</span>
        <span class="c1">#Ecadp = np.sum(padpc_adp*padpc_adp)</span>

        <span class="n">padpcn_self</span> <span class="o">=</span> <span class="n">padpc_self</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ecself</span><span class="p">)</span>
        <span class="n">padpcn_adp</span> <span class="o">=</span> <span class="n">padpc_adp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ecadp</span><span class="p">)</span>

        <span class="n">rhoE</span> <span class="o">=</span> <span class="n">Eadp</span><span class="o">/</span><span class="n">Eself</span>
        <span class="n">rhoEc</span> <span class="o">=</span> <span class="n">Ecadp</span><span class="o">/</span><span class="n">Ecself</span>
        <span class="c1">#rho  = np.sum(padpc_self*padpc_adp)/Eself</span>
        <span class="c1">#rhoc = np.sum(padpc_self*padpc_adp)/Ecself</span>
        <span class="c1">#rhon = np.sum(padpcn_self*padpcn_adp)</span>
        <span class="n">rho</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padpc_self</span><span class="p">,</span><span class="n">padpc_adp</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">Eself</span>
        <span class="n">rhoc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padpc_self</span><span class="p">,</span><span class="n">padpc_adp</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span><span class="o">/</span><span class="n">Ecself</span>
        <span class="n">rhon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">si</span><span class="o">.</span><span class="n">correlate2d</span><span class="p">(</span><span class="n">padpcn_self</span><span class="p">,</span><span class="n">padpcn_adp</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rhoE</span><span class="p">,</span><span class="n">rhoEc</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">rhoc</span><span class="p">,</span><span class="n">rhon</span></div>
    
<div class="viewcode-block" id="ADPchannel.svd"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.svd">[docs]</a>    <span class="k">def</span> <span class="nf">svd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; perform singular value decomposition of the PADP</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">[</span><span class="n">U</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">]</span><span class="o">=</span><span class="n">la</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">sv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">sv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span><span class="n">k</span><span class="p">][:,</span><span class="bp">None</span><span class="p">],</span><span class="n">V</span><span class="p">[</span><span class="n">k</span><span class="p">,:][</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sv&#39;</span><span class="p">:</span><span class="n">sv</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">b</span><span class="p">}</span></div>

<div class="viewcode-block" id="ADPchannel.imshow"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.imshow">[docs]</a>    <span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show Angular Delay Profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;origin&#39;</span><span class="p">:</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;vmax&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">65</span><span class="p">,</span>
                    <span class="s1">&#39;vmin&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span>
                    <span class="s1">&#39;interpolation&#39;</span> <span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;imin&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;imax&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;dB&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;fonts&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
                    <span class="s1">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;fig&#39;</span> <span class="p">:[],</span>
                    <span class="s1">&#39;ax&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ang_offset&#39;</span><span class="p">:</span><span class="mi">450</span><span class="p">,</span>
                    <span class="s1">&#39;orientation&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;blos&#39;</span><span class="p">:</span><span class="bp">True</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> 

        <span class="n">imin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;imin&#39;</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;imax&#39;</span><span class="p">)</span>
        <span class="n">dB</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
        <span class="n">fig</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">fonts</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fonts&#39;</span><span class="p">)</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
        <span class="n">blos</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;blos&#39;</span><span class="p">)</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;orientation&#39;</span><span class="p">)</span>
        <span class="n">bcolorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">ang_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ang_offset&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">rd2deg</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="c1">#extent = (self.az[-1]*rd2deg+agoffset,</span>
        <span class="c1">#          self.az[0]*rd2deg+agoffset,</span>
        <span class="c1">#          self.x[imin],self.x[imax])</span>
        <span class="c1">#extent = (self.az[0]*rd2deg,</span>
        <span class="c1">#          self.az[-1]*rd2deg,</span>
        <span class="c1">#          self.x[imin],self.x[imax])</span>

        <span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">270</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">imin</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">imax</span><span class="p">])</span>
        <span class="n">padp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[:,</span><span class="n">imin</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">padp</span>  <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">padp</span><span class="p">)</span>
	    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">padp</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">blos</span><span class="p">:</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">ang_offset</span> <span class="o">+</span> <span class="n">orientation</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">ang_offset</span> <span class="o">+</span> <span class="n">orientation</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">anglos_geo</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">bcolorbar</span><span class="p">:</span>
    	    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39; dB&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fonts</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">+</span><span class="s1">&#39; linear&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fonts</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fonts</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Propagation delay [ns]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fonts</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Angle[deg]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fonts</span><span class="p">)</span>

	<span class="c1">#ax.title(&#39;PADP&#39;,fontsize=fonts)</span>
	
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fonts</span><span class="p">)</span> 
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fonts</span><span class="p">)</span> 

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="ADPchannel.clean"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold_dB</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  clean ADP </span>

<span class="sd">        Parameters </span>
<span class="sd">        -----------</span>

<span class="sd">        threshold_dB : float </span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        All values below Max -threshold are set to zero</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">MaxdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">P</span><span class="p">))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MaxdB</span><span class="o">-</span><span class="n">threshold_dB</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">+</span><span class="mi">0j</span></div>

<div class="viewcode-block" id="ADPchannel.pap"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.pap">[docs]</a>    <span class="k">def</span> <span class="nf">pap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">fcGHz</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
            <span class="n">Gmax</span><span class="o">=</span><span class="mf">22.68</span><span class="p">,</span>
            <span class="n">Gmin</span><span class="o">=</span><span class="mi">19</span><span class="p">,</span>
            <span class="n">threshdB</span><span class="o">=-</span><span class="mi">95</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">fig</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">ax</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate Power Angular Profile </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>
<span class="sd">        fontsize : int </span>
<span class="sd">        figsize : tuple</span>
<span class="sd">        fig : </span>
<span class="sd">        ax  : </span>
<span class="sd">        xlabel : boolean  </span>
<span class="sd">        ylabel : boolean </span>
<span class="sd">        legen : boolean</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        fig,ax</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># integration over frequency </span>
        <span class="c1"># adp (angle) </span>
        <span class="n">Gtyp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gmax</span><span class="o">+</span><span class="n">Gmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">Py</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">pdp0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Py</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pdp0dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp0</span><span class="p">)</span>
        <span class="n">u</span>    <span class="o">=</span> <span class="n">pdp0dB</span><span class="o">&gt;</span><span class="n">threshdB</span>
        <span class="n">adp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Py</span><span class="p">[:,</span><span class="n">u</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#mPya = np.median(Py,axis=0)</span>
        <span class="c1">#mPya = np.mean(Py,axis=0)</span>
        <span class="c1">#sPy = Py-mPya[None,:]</span>
        <span class="c1">#adp = np.sum(Pyz,axis=1)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">adp</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">adp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fig</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="c1">#ax.plot(self.az*180/np.pi,10*np.log10(adp),color=&#39;r&#39;,label=r&#39;$10\log_{10}(\sum_{\tau} PADP(\phi,\tau))$&#39;,linewidth=1.5)</span>
        <span class="n">ag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">260</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">adp</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ag</span><span class="p">,</span> <span class="c1">#360self.az*180/np.pi,</span>
                <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">adp</span><span class="p">)</span><span class="o">-</span><span class="n">Gtyp</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="c1">#ax.vlines(self.tau,ymin=-130,ymax=-40,linestyles=&#39;dashed&#39;,color=&#39;blue&#39;)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="n">xmin</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="mi">260</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="c1">#ax.set_ylim(-80,-60)</span>
        <span class="k">if</span> <span class="n">xlabel</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Angle [deg]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;level (dB)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span> 

        <span class="c1">#ax.set_title(self._filename,fontsize=fontsize)</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="ADPchannel.app"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.app">[docs]</a>    <span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate Angular Power Profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="ADPchannel.pltcir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.pltcir">[docs]</a>    <span class="k">def</span> <span class="nf">pltcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phideg</span><span class="p">,</span><span class="n">Gain</span><span class="o">=</span><span class="mi">21</span><span class="p">):</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">phideg</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">dang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dang</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dang</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">FS</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gain</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">FS</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">u</span></div>

<div class="viewcode-block" id="ADPchannel.pdp_v"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.pdp_v">[docs]</a>    <span class="k">def</span> <span class="nf">pdp_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate and plot Power Delay Profile</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                     <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;losdelay&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;freespace&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;desembeded&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;noisefloor&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;typic&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;semilogx&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;bcir&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;Gmax&#39;</span><span class="p">:</span><span class="mf">22.68</span><span class="p">,</span>
                     <span class="s1">&#39;Gmin&#39;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span>
                     <span class="s1">&#39;threshdB&#39;</span><span class="p">:</span><span class="mi">75</span><span class="p">,</span>
                     <span class="s1">&#39;imax&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;Tilt&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                     <span class="s1">&#39;HPBW&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                     <span class="s1">&#39;dphi&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">1</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="n">Gmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Gmax&#39;</span><span class="p">)</span>
        <span class="n">Gmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Gmin&#39;</span><span class="p">)</span>
        <span class="n">imax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;imax&#39;</span><span class="p">)</span>
        <span class="n">threshdB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;threshdB&#39;</span><span class="p">)</span>
        <span class="n">Gtyp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gmax</span><span class="o">+</span><span class="n">Gmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="c1"># get peak value of the PADP</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak</span><span class="p">()</span>
        <span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># pdp : power delay profie </span>
        <span class="n">Py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="n">pap0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Py</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pap0dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pap0</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">pap0dB</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">pap0dB</span><span class="p">,</span><span class="n">threshdB</span><span class="p">)</span>
        <span class="n">pdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Py</span><span class="p">[</span><span class="n">u</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pdp</span> <span class="o">=</span> <span class="n">pdp</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="p">]</span>
        <span class="c1"># spdp : square root of power delay profie </span>
        <span class="n">spdp</span> <span class="o">=</span> <span class="n">TUchannel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pdp</span><span class="p">))</span>
        <span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">pdp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">FS</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span><span class="p">))</span>
        <span class="n">AttmaxdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="c1">#Gmax = AttmaxdB-FS[u] </span>
        <span class="c1">#Gmax_r = np.round(Gmax[0]*100)/100.</span>
        <span class="c1">#</span>
        <span class="c1"># The -3dB is specific to the Aalto measurement and desembeding (1/2)</span>
        <span class="c1">#</span>
        <span class="n">pdp_min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gmax</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">pdp_max</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gmin</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">pdp_typ</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gtyp</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">uflashing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp_typ</span><span class="o">&gt;</span><span class="n">FS</span><span class="p">)</span>

        <span class="n">umin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp_min</span><span class="o">&gt;-</span><span class="mi">118</span><span class="p">)</span>
        <span class="n">pdp_min_thr</span> <span class="o">=</span> <span class="n">pdp_min</span><span class="p">[</span><span class="n">umin</span><span class="p">]</span> 
        <span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp_max</span><span class="o">&gt;-</span><span class="mi">118</span><span class="p">)</span>
        <span class="n">pdp_max_thr</span> <span class="o">=</span> <span class="n">pdp_max</span><span class="p">[</span><span class="n">umax</span><span class="p">]</span> 
        <span class="n">PL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">pdp_min_thr</span><span class="o">/</span><span class="mf">10.</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;semilogx&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi))$&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="c1">#ax.semilogx(np.array([tau]),np.array([AttmaxdB]),color=&#39;k&#39;)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;desembeded&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pdp_min</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmax</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pdp_max</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmin</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pdp_typ</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">pdp_typ</span><span class="p">[</span><span class="n">uflashing</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">uflashing</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;freespace&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;losdelay&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">,</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">xmax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">,</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">xmax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noisefloor&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

            <span class="c1">#ax.set_xlim(10,1000)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Delay (ns) log scale&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
            
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bcir&#39;</span><span class="p">]:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
                <span class="n">dang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dang</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dang</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmax</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmin</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">),</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi))$&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">AttmaxdB</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tau</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;desembeded&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdp_min</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmax</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdp_max</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmin</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdp_typ</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pdp_typ</span><span class="p">[</span><span class="n">uflashing</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">uflashing</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;freespace&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FS</span><span class="o">-</span><span class="p">(</span><span class="n">Gmax</span><span class="o">-</span><span class="n">Gmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FS</span><span class="o">+</span><span class="p">(</span><span class="n">Gmax</span><span class="o">-</span><span class="n">Gmin</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;losdelay&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">,</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">xmax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">,</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">xmax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noisefloor&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="o">-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ymax</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="c1">#ax.set_xlim(0,1000)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Delay (ns)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
            
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bcir&#39;</span><span class="p">]:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
                <span class="n">dang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dang</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dang</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmax</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmin</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;level (dB)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
        <span class="c1">#ax.set_title(self._filename+&#39; &#39;+str(PL))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span> 

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="ADPchannel.pdp"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.pdp">[docs]</a>    <span class="k">def</span> <span class="nf">pdp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate and plot Power Delay Profile</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                     <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;legend&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;losdelay&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;freespace&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;desembeded&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;typic&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;semilogx&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;bcir&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;Gmax&#39;</span><span class="p">:</span><span class="mf">22.68</span><span class="p">,</span>
                     <span class="s1">&#39;Gmin&#39;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span>
                     <span class="s1">&#39;Tilt&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                     <span class="s1">&#39;HPBW&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                     <span class="s1">&#39;dphi&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s1">&#39;marker&#39;</span><span class="p">:</span><span class="s1">&#39;*&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">1</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="n">Gmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Gmax&#39;</span><span class="p">)</span>
        <span class="n">Gmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Gmin&#39;</span><span class="p">)</span>
        <span class="n">Gtyp</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gmax</span><span class="o">+</span><span class="n">Gmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
        <span class="c1"># get peak value of the PADP</span>
        <span class="n">alpha</span><span class="p">,</span><span class="n">tau</span><span class="p">,</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peak</span><span class="p">()</span>
        <span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># pdp : power delay profie </span>
        <span class="n">pdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># spdp : square root of power delay profie </span>
        <span class="n">spdp</span> <span class="o">=</span> <span class="n">TUchannel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pdp</span><span class="p">))</span>
        <span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp</span><span class="o">==</span><span class="nb">max</span><span class="p">(</span><span class="n">pdp</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">FS</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span><span class="p">))</span>
        <span class="n">AttmaxdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="c1">#Gmax = AttmaxdB-FS[u] </span>
        <span class="c1">#Gmax_r = np.round(Gmax[0]*100)/100.</span>
        <span class="c1">#</span>
        <span class="c1"># The -3dB is specific to the Aalto measurement and desembeding (1/2)</span>
        <span class="c1">#</span>
        <span class="n">pdp_min</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gmax</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">pdp_max</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gmin</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">pdp_typ</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span><span class="o">-</span><span class="n">Gtyp</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">umin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp_min</span><span class="o">&gt;-</span><span class="mi">118</span><span class="p">)</span>
        <span class="n">pdp_min_thr</span> <span class="o">=</span> <span class="n">pdp_min</span><span class="p">[</span><span class="n">umin</span><span class="p">]</span> 
        <span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pdp_max</span><span class="o">&gt;-</span><span class="mi">118</span><span class="p">)</span>
        <span class="n">pdp_max_thr</span> <span class="o">=</span> <span class="n">pdp_max</span><span class="p">[</span><span class="n">umax</span><span class="p">]</span> 
        <span class="n">PL</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">pdp_min_thr</span><span class="o">/</span><span class="mf">10.</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;semilogx&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi))$&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="c1">#ax.semilogx(np.array([tau]),np.array([AttmaxdB]),color=&#39;k&#39;)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;desembeded&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_min</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmax</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_max</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmin</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_typ</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;freespace&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">FS</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">FS</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;losdelay&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">,</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">,</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1">#ax.set_xlim(10,1000)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Delay (ns) log scale&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
            
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bcir&#39;</span><span class="p">]:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
                <span class="n">dang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dang</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dang</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmin</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;raw&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pdp</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi))$&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tau</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">AttmaxdB</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;desembeded&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_min</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmax</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_max</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">r&#39;$10\log_{10}(\sum_{\phi} PADP(\phi)) - $&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Gmin</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pdp_typ</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;freespace&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typic&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">FS</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">FS</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Free Space path profile&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;losdelay&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taupeak_est</span><span class="p">,</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taulos_geo</span><span class="p">,</span><span class="n">ymin</span><span class="o">=-</span><span class="mi">130</span><span class="p">,</span><span class="n">ymax</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

            <span class="c1">#ax.set_xlim(0,1000)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Delay (ns)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
            
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bcir&#39;</span><span class="p">]:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">angpeak_est</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
                <span class="n">dang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dang</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dang</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmax</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]))</span><span class="o">-</span><span class="n">Gmin</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;level (dB)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">PL</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span> 

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="ADPchannel.tomap"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.tomap">[docs]</a>    <span class="k">def</span> <span class="nf">tomap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; surimpose PADP on the Layout </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        L : Layout</span>
<span class="sd">        xmin : 10 </span>
<span class="sd">        xmax : 400</span>
<span class="sd">        ymin : 10</span>
<span class="sd">        ymax : 400,</span>
<span class="sd">        Nx  :3000,</span>
<span class="sd">        Ny  :3000,</span>
<span class="sd">        &#39;cmap&#39;:&#39;jet&#39;,</span>
<span class="sd">        &#39;mode&#39;:&#39;image&#39;,</span>
<span class="sd">        &#39;excess&#39;:&#39;los&#39;,</span>
<span class="sd">        &#39;figsize&#39;:(20,20),</span>
<span class="sd">        &#39;thmindB&#39;:-110,</span>
<span class="sd">        &#39;thmaxdB&#39;:-108,</span>
<span class="sd">        &#39;vmindB&#39;:-110,</span>
<span class="sd">        &#39;vmaxdB&#39;:-60,</span>
<span class="sd">        &#39;offset&#39;:0,</span>
<span class="sd">        &#39;display&#39;:True,</span>
<span class="sd">        &#39;compensated&#39;:True,</span>
<span class="sd">        &#39;tauns_excess&#39;:0</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;xmin&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;xmax&#39;</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span>
                    <span class="s1">&#39;ymin&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;ymax&#39;</span><span class="p">:</span><span class="mi">400</span><span class="p">,</span>
                    <span class="s1">&#39;Nx&#39;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span>
                    <span class="s1">&#39;Ny&#39;</span><span class="p">:</span><span class="mi">3000</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;sbounce&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;excess&#39;</span><span class="p">:</span><span class="s1">&#39;los&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
                    <span class="s1">&#39;thmindB&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span>
                    <span class="s1">&#39;thmaxdB&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">108</span><span class="p">,</span>
                    <span class="s1">&#39;vmindB&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span>
                    <span class="s1">&#39;vmaxdB&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span>
                    <span class="s1">&#39;offset&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;display&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;compensated&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;tauns_excess&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> 
        
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xmin&#39;</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ymin&#39;</span><span class="p">)</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xmax&#39;</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ymax&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">vmindB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmindB&#39;</span><span class="p">)</span>
        <span class="n">vmaxdB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmaxdB&#39;</span><span class="p">)</span>
        <span class="n">thmindB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;thmindB&#39;</span><span class="p">)</span>
        <span class="n">thmaxdB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;thmaxdB&#39;</span><span class="p">)</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Nx&#39;</span><span class="p">)</span>
        <span class="n">Ny</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Ny&#39;</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">)</span>
        <span class="n">excess</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;excess&#39;</span><span class="p">)</span>
        <span class="n">display</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
        <span class="n">compensated</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;compensated&#39;</span><span class="p">)</span>
        <span class="n">tauns_excess</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tauns_excess&#39;</span><span class="p">)</span>
        <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> 
        
        <span class="c1">#</span>
        <span class="c1"># Prepare the array for spatial information in horizontal plane x,y</span>
        <span class="c1"># Nx and Ny should be large enough</span>
        <span class="c1">#</span>
        <span class="n">Z</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>

        <span class="c1"># </span>
        <span class="c1"># spatial indexation in x and  y</span>
        <span class="c1">#</span>
        <span class="n">xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">Ny</span><span class="p">)</span>

        <span class="c1"># distance Tx Rx in the horizontal plane (2D) </span>
        <span class="n">dtx_rx_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># distance Tx Rx in the horizontal plane (3D) </span>
        <span class="n">dtx_rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># distance  Tx ground Rx (3D) </span>
        <span class="n">dtx_gr_rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dtx_rx_2D</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">dtx_gr_rx</span><span class="o">&gt;</span><span class="n">dtx_rx</span><span class="p">)</span>
        <span class="c1"># difference of heights beween Tx and Rx </span>
        <span class="n">deltah</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="c1">#</span>
        <span class="c1"># Dt = vec(P,Tx)</span>
        <span class="c1"># Dr = vec(Rx,P)</span>
        <span class="c1">#</span>
        <span class="n">dxt</span> <span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">dyt</span> <span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="c1">#</span>
        <span class="c1"># nwt : distance between Tx and each point of the plane </span>
        <span class="c1"># nwr : distance between Rx and each point of the plane </span>
        <span class="c1">#</span>
        <span class="n">nwt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxt</span><span class="o">*</span><span class="n">dxt</span><span class="o">+</span><span class="n">dyt</span><span class="o">*</span><span class="n">dyt</span><span class="p">)</span>

        <span class="n">dxr</span> <span class="o">=</span><span class="p">(</span><span class="n">xr</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">dyr</span> <span class="o">=</span><span class="p">(</span><span class="n">yr</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">nwr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxr</span><span class="o">*</span><span class="n">dxr</span><span class="o">+</span><span class="n">dyr</span><span class="o">*</span><span class="n">dyr</span><span class="p">)</span>
        
        <span class="c1"># dsbounce : elliposidal distance (single bounce hypothesis) </span>
        <span class="n">dsbounce</span> <span class="o">=</span> <span class="n">nwt</span><span class="o">+</span><span class="n">nwr</span>

        <span class="c1"># maximal ellipsoidal distance on the Z selected region </span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="n">dsbounce</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">taumax</span> <span class="o">=</span> <span class="n">dmax</span><span class="o">/</span><span class="mf">0.3</span>

        <span class="c1"># determine index of maximal distance </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&gt;</span><span class="n">taumax</span><span class="p">:</span>
            <span class="n">itaumax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">&gt;</span><span class="n">taumax</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">itaumax</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="c1"># convert maximal distance into maximal delay (self.x is delay) </span>
        <span class="n">taumax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">itaumax</span><span class="p">]</span>
        <span class="c1"># determine coefficient  between delay and index ( ns --&gt; integer) </span>
        <span class="n">tau2idx</span> <span class="o">=</span> <span class="n">taumax</span><span class="o">/</span><span class="n">itaumax</span>
        
        <span class="c1"># Determine the angle of arraival </span>
        <span class="c1"># direction of arrival normalization of the vector </span>
        <span class="n">dxrn</span> <span class="o">=</span> <span class="n">dxr</span><span class="o">/</span><span class="n">nwr</span>
        <span class="n">dyrn</span> <span class="o">=</span> <span class="n">dyr</span><span class="o">/</span><span class="n">nwr</span>
        
        <span class="c1"># angle of arrival in [-pi,pi]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dyrn</span><span class="p">,</span><span class="n">dxrn</span><span class="p">)</span><span class="o">-</span><span class="n">offset</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="c1"># back in [0-2pi]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">+</span><span class="n">phi</span>

        <span class="c1">#iphi=((315-phi*180/np.pi)/5).astype(int)</span>
        <span class="n">iphi</span><span class="o">=</span><span class="p">((</span><span class="mi">360</span><span class="o">-</span><span class="n">phi</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="n">drpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxr</span><span class="o">*</span><span class="n">dxr</span><span class="o">+</span><span class="n">dyr</span><span class="o">*</span><span class="n">dyr</span><span class="o">+</span><span class="n">dxt</span><span class="o">*</span><span class="n">dxt</span><span class="o">+</span><span class="n">dyt</span><span class="o">*</span><span class="n">dyt</span><span class="p">)</span>
        <span class="n">dpr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxr</span><span class="o">*</span><span class="n">dxr</span><span class="o">+</span><span class="n">dyr</span><span class="o">*</span><span class="n">dyr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;sbounce&#39;</span><span class="p">:</span>
            <span class="n">iid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxt</span><span class="o">*</span><span class="n">dxt</span><span class="o">+</span><span class="n">dyt</span><span class="o">*</span><span class="n">dyt</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dxr</span><span class="o">*</span><span class="n">dxr</span><span class="o">+</span><span class="n">dyr</span><span class="o">*</span><span class="n">dyr</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">tau2idx</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#d = np.round(np.sqrt(dxr*dxr+dyr*dyr)/(0.3*0.625)).astype(&#39;int&#39;)</span>
            <span class="c1">#d = np.round(np.sqrt(dxr*dxr+dyr*dyr)/(0.3*0.625)).astype(&#39;int&#39;)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">deltah</span><span class="o">/</span><span class="n">drpt</span><span class="p">)</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">dpr</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">iid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dv</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">tau2idx</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="c1">#pdb.set_trace()</span>
        
        <span class="c1">#</span>
        <span class="c1"># create indexation for spatial region Z</span>
        <span class="c1">#</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Nx</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ny</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:]</span>
        
        <span class="c1"># ird : index for delays (d for delays) </span>
        <span class="n">ird</span> <span class="o">=</span> <span class="n">iid</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># irp : index for directio of arrival (p for phi)  </span>
        <span class="n">irp</span> <span class="o">=</span> <span class="n">iphi</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1">#  (d &lt; dmax ) and (d&gt;dlos+tauns_excess) </span>
        <span class="c1">#  iphi &gt;= 0 and iphi &lt; Nphimax</span>
        <span class="n">ilos</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">dtx_rx</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">tau2idx</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">iground</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">dtx_gr_rx</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">tau2idx</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">iexcess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tauns_excess</span><span class="o">/</span><span class="n">tau2idx</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">excess</span><span class="o">==</span><span class="s1">&#39;los&#39;</span><span class="p">:</span>
            <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ird</span><span class="o">&lt;</span><span class="n">itaumax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ird</span><span class="o">&gt;</span><span class="n">ilos</span><span class="o">+</span><span class="n">iexcess</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">excess</span><span class="o">==</span><span class="s1">&#39;ground&#39;</span><span class="p">:</span>
            <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ird</span><span class="o">&lt;</span><span class="n">itaumax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ird</span><span class="o">&gt;</span><span class="n">iground</span><span class="o">+</span><span class="n">iexcess</span><span class="p">))</span>

        <span class="n">up</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">irp</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">irp</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">)))</span>

        <span class="c1"># determine the index of points in a corona wich satisfy jointly the </span>
        <span class="c1"># condition on delays and angles</span>
        <span class="c1">#</span>
        <span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">ud</span><span class="p">,</span><span class="n">up</span><span class="p">)</span>
        
        <span class="c1"># rebvelize Z (2D -&gt; 1D) </span>
        <span class="n">rz</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="c1"># filling rz with self.y nphi,Ntau</span>
        <span class="n">rz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">irp</span><span class="p">[</span><span class="n">u</span><span class="p">],</span><span class="n">ird</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span>
        <span class="c1">#</span>
        <span class="c1"># back to matrix form</span>
        <span class="c1">#</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">rz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">)</span>
        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="n">lmbda</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fcGHz</span>
        <span class="n">sqG</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">Z_compensated</span> <span class="o">=</span> <span class="n">Z</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dtx_rx</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sqG</span><span class="o">*</span><span class="n">lmbda</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compensated</span><span class="p">:</span>
            <span class="n">ZdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Z_compensated</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ZdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">ZdB</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">&gt;</span><span class="n">thmindB</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ZdB</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">&lt;</span><span class="n">thmaxdB</span><span class="p">))</span>
        <span class="c1">#mzdB = ma.masked_array(ZdB,mask)</span>

        <span class="n">ZdBmax</span> <span class="o">=</span> <span class="n">ZdB</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ZdBmin</span> <span class="o">=</span> <span class="n">ZdB</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># constructing figure</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="c1">#fig=plt.figure(figsize=figsize)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ZdB</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">yr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=</span><span class="n">ZdBmax</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">ZdBmax</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
            <span class="c1">#plt.imshow(mzdB,alpha=0.9,origin=&#39;lower&#39;)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ob&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
            <span class="c1">#plt.savefig(self._filename+&#39;.png&#39;)</span>

        <span class="c1">#return Z,np.linspace(xr[0],xr[-1],Nx),np.linspace(yr[0],yr[-1],Ny)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="ADPchannel.polarplot"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.polarplot">[docs]</a>    <span class="k">def</span> <span class="nf">polarplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  polar plot of PADP </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        fig</span>
<span class="sd">        ax </span>
<span class="sd">        figsize</span>
<span class="sd">        typ : string </span>
<span class="sd">        Ndec : int </span>
<span class="sd">            decimation factor</span>
<span class="sd">        imax : int </span>
<span class="sd">            max value </span>
<span class="sd">        vmin : float </span>
<span class="sd">        vmax : float </span>
<span class="sd">        cmap : colormap</span>
<span class="sd">        title : PADP</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> 
                     <span class="s1">&#39;typ&#39;</span><span class="p">:</span><span class="s1">&#39;l20&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Ndec&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">110</span><span class="p">,</span>
                     <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span>
                     <span class="s1">&#39;imax&#39;</span><span class="p">:</span><span class="mi">150</span><span class="p">,</span>
                     <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span>
                     <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;PADP&#39;</span>
                   <span class="p">}</span>
        
        <span class="n">cvel</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        
        <span class="n">imax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;imax&#39;</span><span class="p">)</span>
        <span class="n">Ndec</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Ndec&#39;</span><span class="p">)</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmin&#39;</span><span class="p">)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;vmax&#39;</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>

        <span class="n">rho</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">cvel</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">)</span>
        <span class="c1"># convert y data in desired format</span>
        <span class="n">dt</span><span class="p">,</span><span class="n">ylabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cformat</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[:,</span><span class="mi">0</span><span class="p">::</span><span class="n">Ndec</span><span class="p">][:,</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="o">/</span><span class="n">Ndec</span><span class="p">]</span>
        <span class="n">th</span>  <span class="o">=</span> <span class="n">theta</span><span class="p">[:,</span><span class="mi">0</span><span class="p">::</span><span class="n">Ndec</span><span class="p">][:,</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="o">/</span><span class="n">Ndec</span><span class="p">]</span>
        <span class="n">rh</span>  <span class="o">=</span> <span class="n">rho</span><span class="p">[:,</span><span class="mi">0</span><span class="p">::</span><span class="n">Ndec</span><span class="p">][:,</span><span class="mi">0</span><span class="p">:</span><span class="n">imax</span><span class="o">/</span><span class="n">Ndec</span><span class="p">]</span>
        <span class="c1">#vmin = np.min(val)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="c1">#Dynamic = max_val-vmin </span>
        <span class="n">pc</span>  <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">th</span><span class="p">,</span><span class="n">rh</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">ptx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">*</span><span class="n">cvel</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ADPchannel.toafp"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.ADPchannel.html#pylayers.antprop.channel.ADPchannel.toafp">[docs]</a>    <span class="k">def</span> <span class="nf">toafp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">afp</span></div></div>

<div class="viewcode-block" id="TBchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel">[docs]</a><span class="k">class</span> <span class="nc">TBchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">TBsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; radio channel in non uniform delay domain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">label</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1">#super(TUsignal,self).__init__(x,y,label)</span>
        <span class="n">bs</span><span class="o">.</span><span class="n">TBsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>


<div class="viewcode-block" id="TBchannel.tau_Emax"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.tau_Emax">[docs]</a>    <span class="k">def</span> <span class="nf">tau_Emax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the delay of max energy peak</span>

<span class="sd">        .. math::</span>
<span class="sd">            \max_{\tau} y^{2}(\tau)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau_Emax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tau_Emax</span><span class="p">)</span></div>

<div class="viewcode-block" id="TBchannel.tau_moy"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.tau_moy">[docs]</a>    <span class="k">def</span> <span class="nf">tau_moy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">threshold_dB</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate mean excess delay starting from delay tau0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        alpha : float</span>
<span class="sd">        tau0 : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>

        <span class="c1">#cdf, vary = self.ecdf()</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="n">threshold_dB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>

        <span class="n">uf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">&gt;</span><span class="n">v</span><span class="p">)</span>

        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span>
        <span class="n">taum</span> <span class="o">=</span> <span class="n">num</span><span class="o">/</span><span class="n">den</span>
    

        <span class="k">return</span><span class="p">(</span><span class="n">taum</span><span class="p">)</span></div>

<div class="viewcode-block" id="TBchannel.delays"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.delays">[docs]</a>    <span class="k">def</span> <span class="nf">delays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; calculate delay parameters and orthogonality factor from cir</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        taum :</span>
<span class="sd">            mean excess delay</span>
<span class="sd">        delayspread</span>
<span class="sd">            rms delay spread</span>
<span class="sd">        of  :</span>
<span class="sd">            orthogonality factor</span>

<span class="sd">        Neelesh Metha, Andreas Molish, Lary Greenstein &quot;Orthogonality Factor in WCDMA Donlinks in Urban Macrocellular</span>
<span class="sd">        environments&quot;</span>

<span class="sd">        .. :math:</span>

<span class="sd">            \beta0 = 1 \frac{\sum_i=1^L}|\alpha_i|^4}{\left(\sum_i=1^L|\alpha_i|^2)^2}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flatteny</span><span class="p">(</span><span class="n">reversible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yf</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">yf</span>
        <span class="n">y4</span> <span class="o">=</span> <span class="n">y2</span><span class="o">*</span><span class="n">y2</span>
        <span class="n">taum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">delayspread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">taum</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="n">taum</span><span class="p">)</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">of</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y4</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">taum</span><span class="p">,</span><span class="n">delayspread</span><span class="p">,</span><span class="n">of</span></div>


<div class="viewcode-block" id="TBchannel.Kfactor"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.Kfactor">[docs]</a>    <span class="k">def</span> <span class="nf">Kfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold_dB</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; determine Ricean K factor </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>

<span class="sd">        Threshold_dB : float </span>
<span class="sd">            Only the energy above threshold is taken into account</span>
<span class="sd">        dB : boolean </span>
<span class="sd">            if True value in dB is returned</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        
        <span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">v</span>  <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="n">threshold_dB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">==</span><span class="n">u</span><span class="p">)</span>
        <span class="n">Pmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">vmax</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">vmax</span><span class="p">]</span>
        <span class="n">uf</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">&gt;</span><span class="n">v</span><span class="p">)</span>
        <span class="n">Ptot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">Pmax</span><span class="o">/</span><span class="p">(</span><span class="n">Ptot</span><span class="o">-</span><span class="n">Pmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="TBchannel.tau_rms"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.tau_rms">[docs]</a>    <span class="k">def</span> <span class="nf">tau_rms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">threshold_dB</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; calculate root mean square delay spread starting from delay tau_0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        alpha : float</span>
<span class="sd">        threshold : float</span>
<span class="sd">            ( delay interval is defined between :math:`\tau(\alpha)` and :math:`\tau(1 -\alpha)` )</span>
<span class="sd">        tau0 : float</span>
<span class="sd">            argument for specifying the delay start</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. math::</span>

<span class="sd">            \sqrt{\frac{\int_{\tau(\alpha)}^{\tau(1-\alpha)} (\tau-\tau_m)^{2} PDP(\tau) d\tau} {\int_{\tau(\alpha)}^{\tau(1-\alpha)} PDP(\tau) d\tau}}</span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        TUsignal.ecdf</span>
<span class="sd">        TUsignal.tau_moy</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="c1">#cdf, vary = self.ecdf()</span>
        <span class="c1">#pdp = np.diff(cdf.y)</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">-</span><span class="n">threshold_dB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>

        <span class="n">uf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">&gt;</span><span class="n">v</span><span class="p">)</span>

        <span class="n">taum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_moy</span><span class="p">(</span><span class="n">tau0</span><span class="p">,</span><span class="n">threshold_dB</span><span class="o">=</span><span class="n">threshold_dB</span><span class="p">)</span>
        
        <span class="n">num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">uf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">-</span><span class="n">taum</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span>
        
        <span class="n">taurms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">num</span><span class="o">/</span><span class="n">den</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">taurms</span></div>

<div class="viewcode-block" id="TBchannel.toFD"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.toFD">[docs]</a>    <span class="k">def</span> <span class="nf">toFD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">256</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; Transform to Frequency domain</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        H : Tchannel</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fGHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">tau</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H</span></div>

<div class="viewcode-block" id="TBchannel.SalehValenzuela"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TBchannel.html#pylayers.antprop.channel.TBchannel.SalehValenzuela">[docs]</a>    <span class="k">def</span> <span class="nf">SalehValenzuela</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; generic Saleh and Valenzuela Model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lam : clusters Poisson Process parameter (ns)</span>
<span class="sd">        lam : rays Poisson Process parameter (ns)</span>
<span class="sd">        Gam : clusters exponential decay factor</span>
<span class="sd">        gam : rays exponential decay factor</span>
<span class="sd">        T   : observation duration</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.channel import *</span>
<span class="sd">        &gt;&gt;&gt; C=TBchannel()</span>
<span class="sd">        &gt;&gt;&gt; C.SalehValenzuela()</span>
<span class="sd">        &gt;&gt;&gt; f,a = C.stem()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Lam&#39;</span> <span class="p">:</span> <span class="o">.</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;lam&#39;</span> <span class="p">:</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s1">&#39;Gam&#39;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
                     <span class="s1">&#39;gam&#39;</span> <span class="p">:</span> <span class="mi">5</span> <span class="p">,</span>
                     <span class="s1">&#39;T&#39;</span>   <span class="p">:</span> <span class="mi">100</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">Lam</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Lam&#39;</span><span class="p">]</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lam&#39;</span><span class="p">]</span>
        <span class="n">Gam</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Gam&#39;</span><span class="p">]</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gam&#39;</span><span class="p">]</span>
        <span class="n">T</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
        <span class="n">Nr</span>  <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">Lam</span>
        <span class="n">Nc</span>  <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">T</span><span class="o">/</span><span class="n">lam</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">Lam</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">expon</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">lam</span><span class="p">)</span>

        <span class="c1"># cluster time of arrival</span>
        <span class="n">tc</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">e1</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">Nr</span><span class="p">))</span>
        <span class="n">tc</span>   <span class="o">=</span> <span class="n">tc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tc</span><span class="o">&lt;</span><span class="n">T</span><span class="p">)]</span>
        <span class="n">Nc</span>   <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="n">tauc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">Nr</span><span class="p">)))[</span><span class="mi">0</span><span class="p">,:]</span>

        <span class="c1"># rays time of arrival</span>
        <span class="n">taur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">e2</span><span class="o">.</span><span class="n">rvs</span><span class="p">((</span><span class="n">Nr</span><span class="p">,</span><span class="n">Nc</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># exponential decays of cluster and rays</span>
        <span class="n">etc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">tauc</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">Gam</span><span class="p">))</span>
        <span class="n">etr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">taur</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">*</span><span class="n">gam</span><span class="p">))</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">etc</span><span class="o">*</span><span class="n">etr</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">tauc</span><span class="o">+</span><span class="n">taur</span>

        <span class="c1"># filtering &lt; T and reordering in delay domain</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tau</span><span class="o">&lt;</span><span class="n">T</span><span class="p">)]</span>
        <span class="n">et</span> <span class="o">=</span> <span class="n">et</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tau</span><span class="o">&lt;</span><span class="n">T</span><span class="p">)]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">taus</span> <span class="o">=</span> <span class="n">tau</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="n">ets</span>  <span class="o">=</span> <span class="n">et</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># delays and amplitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">taus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ets</span></div></div>

<div class="viewcode-block" id="TUchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel">[docs]</a><span class="k">class</span> <span class="nc">TUchannel</span><span class="p">(</span><span class="n">TBchannel</span><span class="p">,</span><span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uniform channel in delay domain</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">label</span><span class="o">=</span><span class="p">[]):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TBchannel</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>

<div class="viewcode-block" id="TUchannel.toa_max2"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_max2">[docs]</a>    <span class="k">def</span> <span class="nf">toa_max2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival max2 method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">THRE</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="n">VL</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>

        <span class="n">M</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">M</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">THRE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">THRE</span><span class="p">,</span> <span class="n">thre</span><span class="p">))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">VL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span> <span class="n">vl</span><span class="p">))</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">step</span>

    <span class="c1">#       while thre &gt; M/1e2:</span>
        <span class="k">while</span> <span class="n">vl</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
    <span class="c1">#       while v &lt; 50:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">vl</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="n">THRE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">THRE</span><span class="p">,</span> <span class="n">thre</span><span class="p">))</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">VL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span> <span class="n">vl</span><span class="p">))</span>

            <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">THRE</span> <span class="o">/</span> <span class="n">M</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interval number&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">THRE</span> <span class="o">/</span> <span class="n">M</span><span class="p">,</span> <span class="n">VL</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">drawstyle</span><span class="o">=</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interval(Left) number&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Gamma/Vmax&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#       ylabel(&#39;Interval Number&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TUchannel.toa_new"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_new">[docs]</a>    <span class="k">def</span> <span class="nf">toa_new</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; estimate time of arrival (new method)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">Max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nmax</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>

        <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nmax</span> <span class="o">&gt;=</span> <span class="mi">6000</span><span class="p">:</span>
            <span class="c1">#set the fenetre=6000*0.005=30ns</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">nmax</span> <span class="o">-</span> <span class="mi">6000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">hl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">g</span>

            <span class="n">n_int</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">n_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
                <span class="c1">#print(N)</span>

            <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
            <span class="k">if</span> <span class="n">thre</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tau</span></div>

<div class="viewcode-block" id="TUchannel.toa_win"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_win">[docs]</a>    <span class="k">def</span> <span class="nf">toa_win</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calulate time of arrival (window method)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w : parameter between 0 and 100</span>
<span class="sd">        Lei takes w = 9</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxbruit</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">])</span>
        <span class="n">Max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">nmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">Max</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">nmax</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">step</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="c1"># tant delta est plus grande que w% du Max</span>
        <span class="k">while</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">w</span> <span class="o">*</span> <span class="n">Max</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">:</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">nmax</span> <span class="o">&gt;=</span> <span class="mi">6000</span><span class="p">:</span>
            <span class="c1">#set the fenetre=6000*0.005=30ns</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">nmax</span> <span class="o">-</span> <span class="mi">6000</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">hl</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">g</span>

            <span class="n">n_int</span> <span class="o">=</span> <span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">n_int</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">Max</span> <span class="o">-</span> <span class="n">maxbruit</span> <span class="o">-</span> <span class="n">d</span> <span class="o">-</span> <span class="n">step</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>

            <span class="k">if</span> <span class="n">thre</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tau</span></div>

<div class="viewcode-block" id="TUchannel.toa_max"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_max">[docs]</a>    <span class="k">def</span> <span class="nf">toa_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nint</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        descendant threshold based toa estimation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        nint : integer</span>
<span class="sd">            number of intervals</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># seek fot the maximum value of the signal</span>
        <span class="c1">#</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e2</span>
    <span class="c1">#       plot(self.x,self.y)</span>
        <span class="n">thre</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">step</span>
        <span class="k">while</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">M</span> <span class="o">/</span> <span class="mf">1e5</span><span class="p">:</span>
    <span class="c1">#          axhline(y=thre,color=&#39;green&#39;)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">thre</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># nbint : number of contiguous intervals</span>
            <span class="k">if</span> <span class="n">pyu</span><span class="o">.</span><span class="n">nbint</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nint</span><span class="p">:</span>
            <span class="c1"># down</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">-</span> <span class="n">step</span>
            <span class="k">else</span><span class="p">:</span>
            <span class="c1"># up + step reduction</span>
                <span class="n">thre</span> <span class="o">=</span> <span class="n">thre</span> <span class="o">+</span> <span class="n">step</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">step</span> <span class="o">/</span> <span class="mf">2.</span>

    <span class="c1">#       plt.show()</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">tau</span></div>

<div class="viewcode-block" id="TUchannel.toa_th"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_th">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thlos</span><span class="p">,</span> <span class="n">thnlos</span><span class="p">,</span> <span class="n">visibility</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        threshold based toa estimation using energy peak</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#  ( ) ^2</span>
        <span class="c1">#</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="k">if</span> <span class="n">visibility</span> <span class="o">==</span> <span class="s1">&#39;LOS&#39;</span><span class="p">:</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">thlos</span> <span class="o">*</span> <span class="n">maxy2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">thnlos</span> <span class="o">*</span> <span class="n">maxy2</span>
        <span class="c1">#</span>
        <span class="c1">#In the W1-M1 measurement</span>
        <span class="c1">#thlos=0.05   thnlos=0.15</span>
        <span class="c1">#</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_cum"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_cum">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">th</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        threshold based toa estimation using cumulative energy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1">#In the W1-M1 measurement th=0.15</span>
        <span class="c1">#</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_th_tmtm"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_th_tmtm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tmtm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span> <span class="o">/</span>  \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_th_tm"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_th_tm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_th_tmt"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_th_tmt">[docs]</a>    <span class="k">def</span> <span class="nf">toa_th_tmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">(</span>
        <span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Emax</span><span class="p">()))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Etot</span><span class="p">())</span>
        <span class="k">print</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">maxy2</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">&gt;=</span> <span class="n">th</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_cum_tm"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_cum_tm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_cum_tmtm"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_cum_tmtm">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tmtm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>

<div class="viewcode-block" id="TUchannel.toa_cum_tmt"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.toa_cum_tmt">[docs]</a>    <span class="k">def</span> <span class="nf">toa_cum_tmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate time of arrival</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>

        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">toa</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">toa</span></div>



<div class="viewcode-block" id="TUchannel.psd"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.psd">[docs]</a>    <span class="k">def</span> <span class="nf">psd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tpns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">periodic</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate power spectral density</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        R    : Resistance (default 50 Ohms)</span>
<span class="sd">            Ohms</span>
<span class="sd">        Tpns : real</span>
<span class="sd">            Signal period PRP (default 100 ns)</span>

<span class="sd">        .. note::</span>

<span class="sd">            Notice this interesting property that if time is represented in ns</span>
<span class="sd">            the resulting PSD is expressed in dBm/MHz because there is the</span>
<span class="sd">            same scale factor 1e-9 between second and nanosecond as between</span>
<span class="sd">            dBW/Hz and dBm/MHz</span>

<span class="sd">            If periodic is False the signal duration is taken as period.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">P</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">esd</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;unilateral&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">Tpns</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">P</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="o">/</span> <span class="p">(</span><span class="n">R</span><span class="o">*</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">P</span></div>

<div class="viewcode-block" id="TUchannel.awgn"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.awgn">[docs]</a>    <span class="k">def</span> <span class="nf">awgn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PSDdBmpHz</span><span class="o">=-</span><span class="mi">174</span><span class="p">,</span><span class="n">snr</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;psd&#39;</span><span class="p">,</span><span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; add a white Gaussian noise</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        PSDdBmpHz : float</span>
<span class="sd">        snr : float</span>
<span class="sd">        seed : float</span>
<span class="sd">        typ : string</span>
<span class="sd">            &#39;psd&#39; | &#39;snr&#39;</span>
<span class="sd">        R : float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        n</span>
<span class="sd">        sn</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        bsignal.Noise</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tsns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fsGHz</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">tsns</span>

        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;snr&#39;</span><span class="p">:</span>
            <span class="n">Ps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">))</span>
            <span class="n">PW</span> <span class="o">=</span> <span class="n">Ps</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">snr</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span>
            <span class="n">pWpHz</span> <span class="o">=</span> <span class="n">PW</span><span class="o">/</span><span class="p">(</span><span class="n">fsGHz</span><span class="o">*</span><span class="mf">1e9</span><span class="p">)</span>
            <span class="n">pmWpHz</span> <span class="o">=</span> <span class="n">pWpHz</span><span class="o">*</span><span class="mf">1e3</span>
            <span class="n">PSDdBmpHz</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmWpHz</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">Noise</span><span class="p">(</span><span class="n">ti</span> <span class="o">=</span> <span class="n">ti</span><span class="p">,</span>
                  <span class="n">tf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">+</span><span class="n">tsns</span><span class="p">,</span>
                  <span class="n">fsGHz</span> <span class="o">=</span> <span class="n">fsGHz</span><span class="p">,</span>
                  <span class="n">PSDdBmpHz</span> <span class="o">=</span> <span class="n">PSDdBmpHz</span><span class="p">,</span>
                  <span class="n">R</span> <span class="o">=</span> <span class="n">R</span><span class="p">,</span>
                  <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

        <span class="n">sn</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">n</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
        <span class="n">sn</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

        <span class="k">return</span> <span class="n">sn</span><span class="p">,</span><span class="n">n</span></div>

<div class="viewcode-block" id="TUchannel.Etau0"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Etau0">[docs]</a>    <span class="k">def</span> <span class="nf">Etau0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate energy around delay tau0</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau0  : (ns)            (0)</span>
<span class="sd">        Tint  : Integration time (ns)   (1) include the system error</span>
<span class="sd">        sym   : symetrie factor 0.5 = symetric (0.25)</span>
<span class="sd">        dB    : logscale indicator (True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#u  = nonzero((tau0 + Tint*(1-sym) &gt; self.x) &amp; (self.x &gt; tau0 - Tint*sym))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">nonzero</span><span class="p">((</span><span class="n">tau0</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tau0</span><span class="p">))</span>
        <span class="n">etau0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">etau0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">etau0</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">etau0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Ewin"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Ewin">[docs]</a>    <span class="k">def</span> <span class="nf">Ewin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  integrate energy around delay tau</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau   : (ns)            (0)</span>
<span class="sd">        Tint  : Integration time (ns)   (1) include the system error</span>
<span class="sd">        sym   : symetrie factor 0.5 = symetric (0.25)</span>
<span class="sd">        dB    : logscale indicator (True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tstart</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">-</span> <span class="n">Tint</span> <span class="o">*</span> <span class="n">sym</span>
        <span class="n">tstop</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tstart</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">tstop</span><span class="p">))</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Etot"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Etot">[docs]</a>    <span class="k">def</span> <span class="nf">Etot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">taumax</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Etot  calculate the energy of the signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau0 : start value for integration</span>
<span class="sd">        dB   : (False default) if True value in dB</span>

<span class="sd">        usage  :</span>

<span class="sd">            s.Etot(tau0=10,dB=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">tau0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">taumax</span><span class="p">)</span>
        <span class="n">etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">etot</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">etot</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">etot</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Efirst"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Efirst">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toa</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the energy of the first path</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        toa  : float</span>
<span class="sd">            delay value</span>
<span class="sd">        Tint : float</span>
<span class="sd">            duration value (1)</span>
<span class="sd">        sym : float</span>
<span class="sd">            symmetry around delay value ( 0.25)</span>
<span class="sd">        dB : Boolean</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Efirst : Energy amount in the window (in dB if dB)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">toa</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">toa</span><span class="p">))</span>
        <span class="n">efirst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">efirst</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Efirst_corr"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Efirst_corr">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">Sx</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate Efirst utilizing the correlation of signal emission et reponse impulsionnelle</span>

<span class="sd">       Parameters</span>
<span class="sd">       ----------</span>
<span class="sd">       tau0</span>
<span class="sd">       Sx</span>
<span class="sd">       Sy</span>
<span class="sd">       dB</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">E0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">Sy</span> <span class="o">*</span> <span class="n">Sy</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">Correlation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">Sy</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
        <span class="n">seuil</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">):</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">seuil</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="n">seuil</span> <span class="o">/</span> <span class="n">E0</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:][</span><span class="n">v</span><span class="p">])</span> <span class="o">/</span> <span class="n">E0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">w0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Correlation</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Sx</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">200</span><span class="p">:][</span><span class="n">vv</span><span class="p">])</span> <span class="o">/</span> <span class="n">E0</span>

        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">Ef</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Ef</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Efirst_toath"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Efirst_toath">[docs]</a>    <span class="k">def</span> <span class="nf">Efirst_toath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate Efirst</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tau0   : Time of flight</span>
<span class="sd">        Tint</span>
<span class="sd">        sym</span>
<span class="sd">        dB   : if True return value in dBnJ</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">tau0</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">seuil</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span> <span class="o">&gt;</span> <span class="n">seuil</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">toa</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">te</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">w</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:][</span><span class="n">v</span><span class="p">])</span>
                <span class="n">toa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">te</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">vv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">w0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">:][</span><span class="n">vv</span><span class="p">])</span>
                <span class="n">toa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">r</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">te</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">toa</span> <span class="o">+</span> <span class="n">Tint</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">toa</span> <span class="o">-</span> <span class="n">Tint</span> <span class="o">*</span> <span class="n">sym</span><span class="p">))</span>
        <span class="n">efirst</span> <span class="o">=</span> <span class="n">te</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="n">efirst</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">efirst</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Epercent"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Epercent">[docs]</a>    <span class="k">def</span> <span class="nf">Epercent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return N percentile delay of a cdf</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : 10</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cdf</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ecdf</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Cdf</span> <span class="o">=</span> <span class="n">cdf</span><span class="o">.</span><span class="n">y</span>
        <span class="n">pc</span> <span class="o">=</span> <span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Cdf</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span><span class="p">)</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pc</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.Emax"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.Emax">[docs]</a>    <span class="k">def</span> <span class="nf">Emax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tint</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sym</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dB</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the maximum of Energy integrated over a duration Tint</span>

<span class="sd">        A symetry of sym around the max value of the squared signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tint: float</span>
<span class="sd">            Integration time (ns) default 1</span>
<span class="sd">        sym : float</span>
<span class="sd">            Symmetry factor (default 0.5)</span>
<span class="sd">        dB  : boolean</span>
<span class="sd">            default False</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        W1-M1</span>
<span class="sd">        te     = 0.005 ns</span>
<span class="sd">        left  = 12</span>
<span class="sd">        Nright = 33</span>
<span class="sd">        Tint   = 45*te = 0.225 ns</span>
<span class="sd">        sym    = 0.25</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#  ( ) ^2</span>
        <span class="c1">#</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1">#</span>
        <span class="c1"># determine time of maximum value of ()^2</span>
        <span class="c1">#</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>

        <span class="n">Npt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Tint</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">Nleft</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">sym</span> <span class="o">*</span> <span class="n">Npt</span><span class="p">))</span>
        <span class="n">Nright</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sym</span><span class="p">)</span> <span class="o">*</span> <span class="n">Npt</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1">#  Integration around the maximum value of E^2</span>
        <span class="c1">#  In the W1_M1 measurement</span>
        <span class="c1">#  te     = 0.005 ns</span>
        <span class="c1">#  Nleft  = 12</span>
        <span class="c1">#  Nright = 33</span>
        <span class="c1">#  Tint   = 45*te = 0.225 ns</span>
        <span class="c1">#  sym    = 0.25</span>
        <span class="c1">#</span>

        <span class="n">Y</span> <span class="o">=</span> <span class="n">y2</span><span class="p">[</span><span class="n">u</span> <span class="o">-</span> <span class="n">Nleft</span><span class="p">:</span><span class="n">u</span> <span class="o">+</span> <span class="n">Nright</span><span class="p">]</span>
        <span class="n">cumY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">maxY</span> <span class="o">=</span> <span class="n">cumY</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Emax</span> <span class="o">=</span> <span class="n">maxY</span> <span class="o">*</span> <span class="n">te</span>
        <span class="k">if</span> <span class="n">dB</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Emax</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Emax</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.tau_Emax"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.tau_Emax">[docs]</a>    <span class="k">def</span> <span class="nf">tau_Emax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate the delay of max energy peak</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">maxy2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y2</span> <span class="o">==</span> <span class="n">maxy2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tau_Emax</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tau_Emax</span><span class="p">)</span></div>


<div class="viewcode-block" id="TUchannel.aggcir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.aggcir">[docs]</a>    <span class="k">def</span> <span class="nf">aggcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">alphak</span><span class="p">,</span><span class="n">tauk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; aggregation of CIR from (alphak,tauk)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        alphak : ndarray</span>
<span class="sd">            CIR path amplitude</span>
<span class="sd">        tauk : ndarray</span>
<span class="sd">            CIR delay values</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; alphak = 10*np.random.rand(7)</span>
<span class="sd">            &gt;&gt;&gt; tauk = 100*np.random.rand(7)</span>
<span class="sd">            &gt;&gt;&gt; tau = np.arange(0,150,0.1)</span>
<span class="sd">            &gt;&gt;&gt; y = np.zeros(len(tau))</span>
<span class="sd">            &gt;&gt;&gt; # CIR = TUsignal(tau,y)</span>
<span class="sd">            &gt;&gt;&gt; # CIR.aggcir(alphak,tauk)</span>
<span class="sd">            &gt;&gt;&gt; # f,a =CIR.plot(typ=[&#39;v&#39;])</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">t</span><span class="o">-</span><span class="n">eps</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">t</span><span class="o">+</span><span class="n">eps</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">tauk</span><span class="p">)</span>
        <span class="n">ynew</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">ynew</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">alphak</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ynew</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="TUchannel.readcir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.readcir">[docs]</a>    <span class="k">def</span> <span class="nf">readcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">outdir</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; read channel impulse response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            long file name if outdir is []</span>
<span class="sd">            short file name is outdir is &lt;&gt; []</span>
<span class="sd">        outdir : string</span>
<span class="sd">            output directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outdir</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;output/&#39;</span><span class="o">+</span><span class="n">outdir</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>

        <span class="n">cir</span> <span class="o">=</span> <span class="n">ios</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">cir</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">cir</span><span class="p">[</span><span class="s1">&#39;cir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span></div>


<div class="viewcode-block" id="TUchannel.readuwb"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.readuwb">[docs]</a>    <span class="k">def</span> <span class="nf">readuwb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read  Waveform from Matlab file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filename : file name with extension (.mat)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;output/&#39;</span><span class="o">+</span><span class="n">outdir</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
        <span class="n">wfm</span> <span class="o">=</span> <span class="n">ios</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">wfm</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">T0</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">T0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e-9</span>
        <span class="n">Tres</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Tres</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1e-9</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">WformOut1</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Tres</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span></div>

<div class="viewcode-block" id="TUchannel.ecdf"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUchannel.html#pylayers.antprop.channel.TUchannel.ecdf">[docs]</a>    <span class="k">def</span> <span class="nf">ecdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tnoise</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rem_noise</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">in_positivity</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate energy cumulative density function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tnoise     :</span>
<span class="sd">            Time duration of noise only portion (default=5ns)</span>
<span class="sd">        rem_noise  :</span>
<span class="sd">            remove noise if True</span>
<span class="sd">        in_positivity :</span>
<span class="sd">            inforce positivity if True</span>
<span class="sd">        normalize  :</span>
<span class="sd">            normalize if True (Not implemented)</span>
<span class="sd">        display    :</span>
<span class="sd">            display ecdf if True</span>
<span class="sd">        delay      :</span>
<span class="sd">            give a delay for vizualization</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ecdf , vary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#  ( ) ^2</span>
        <span class="c1">#</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="c1">#</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">te</span>
        <span class="c1"># retrieve the noise only portion at the beginning of TUsignal</span>
        <span class="c1">#</span>
        <span class="n">Nnoise</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Tnoise</span> <span class="o">/</span> <span class="n">te</span><span class="p">))</span>
        <span class="n">tn</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">f1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">]</span>
        <span class="n">stdy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nnoise</span><span class="p">])</span>
        <span class="n">vary</span> <span class="o">=</span> <span class="n">stdy</span> <span class="o">*</span> <span class="n">stdy</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">vary</span>
        <span class="c1">#</span>
        <span class="c1"># y : linear interpolation of noise ecdf  (over whole time base)</span>
        <span class="c1">#</span>
        <span class="c1">#(ar,br)= polyfit(tn,fn,1)</span>
        <span class="c1">#print ar</span>
        <span class="c1">#y  = polyval([ar,br],t)</span>
        <span class="k">if</span> <span class="n">rem_noise</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">-</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f1</span>

        <span class="c1">#</span>
        <span class="c1"># inforce positivity</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">in_positivity</span><span class="p">:</span>
            <span class="n">pdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pdf</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">pdf</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">f</span>
        <span class="c1">#</span>
        <span class="c1"># Normalization step</span>
        <span class="c1">#</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">ecdf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#print E</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">ecdf</span> <span class="o">=</span> <span class="n">ecdf</span> <span class="o">/</span> <span class="n">E</span>
        <span class="c1">#</span>
        <span class="c1"># Resizing</span>
        <span class="c1">#</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">Necdf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ecdf</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="n">Necdf</span><span class="p">)</span>
        <span class="n">ecdf</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">],</span> <span class="n">ecdf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">N</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># Display</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
            <span class="n">ecdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">vary</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ecdf</span><span class="p">,</span> <span class="n">vary</span></div></div>

<div class="viewcode-block" id="TUDchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUDchannel.html#pylayers.antprop.channel.TUDchannel">[docs]</a><span class="k">class</span> <span class="nc">TUDchannel</span><span class="p">(</span><span class="n">TUchannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Uniform channel in Time domain with delay</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    x   : ndarray</span>
<span class="sd">    y   : ndarray</span>
<span class="sd">    taud : ndarray</span>
<span class="sd">        direct delay</span>
<span class="sd">    taue : ndarray</span>
<span class="sd">        excess delay</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">taud</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span><span class="n">taue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TUDchannel</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="c1">#TUsignal.__init__(self, x, y)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">=</span> <span class="n">taud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taue</span> <span class="o">=</span> <span class="n">taue</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;Time domain channel with delay </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">TUchannel</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s1</span><span class="o">+</span><span class="n">s</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="TUDchannel.fig"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.TUDchannel.html#pylayers.antprop.channel.TUDchannel.fig">[docs]</a>    <span class="k">def</span> <span class="nf">fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot a figure of the N first signals</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        N : int</span>
<span class="sd">            number of y signal to plot</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="nb">min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ec</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">-</span> <span class="nb">min</span>
        <span class="n">ecmax</span> <span class="o">=</span> <span class="n">ec</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Nmax</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Nmax</span><span class="p">))</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="p">(</span><span class="n">N1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ecmax</span>
        <span class="n">yN1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">N1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">gk</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gk</span><span class="p">)</span>
            <span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">yN1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:])</span></div></div>

           <span class="c1">#r.plot(x, yN1, main=&#39;Ray response&#39;, xlab=&#39;Time (ns)&#39;, ylab=&#39;y&#39;, type=&#39;l&#39;, col=&#39;black&#39; ,frame=&#39;False&#39;,  ylim=r.range(y1,yN1) )</span>
           <span class="c1">#for i in range(N1-1):</span>
           <span class="c1">#    yi = self.y[i+1,:] + (N1-i)*ecmax</span>
           <span class="c1">#    r.lines(x,yi,col=&#39;black&#39;)</span>

<div class="viewcode-block" id="Mchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Mchannel.html#pylayers.antprop.channel.Mchannel">[docs]</a><span class="k">class</span> <span class="nc">Mchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handle the measured channel</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">x</span> <span class="p">,</span>
                <span class="n">y</span> <span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>      
        <span class="sd">&quot;&quot;&quot; class constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x  :  , nfreq</span>
<span class="sd">            frequency GHz</span>
<span class="sd">        y  :  Nm x Nr x Nt x Nf </span>
<span class="sd">            measured channel </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Aat&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Aar&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;calibrated&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
        <span class="s1">&#39;label&#39;</span> <span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mes&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;calibrated&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mes</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mes&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aat</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Aat&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Aar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Aar&#39;</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nm</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nr</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mchannel&#39;</span><span class="p">)</span>

    
        
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Calibrated&#39;</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Not calibrated&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>



<div class="viewcode-block" id="Mchannel.eig"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Mchannel.html#pylayers.antprop.channel.Mchannel.eig">[docs]</a>    <span class="k">def</span> <span class="nf">eig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">HdH</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate eigen values of the transfer matrix.</span>
<span class="sd">            it involves H and Hd against svd() which acts only over H.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        HdH : Hermitian transfer matrix  (nf x nt x nt )</span>
<span class="sd">        U   : Unitary tensor  (nf x nt x nt )</span>
<span class="sd">        S   : Singular values (nf x nt)</span>
<span class="sd">        V   : = Ud (in that case because HdH Hermitian)  (nf x nt x nt)</span>

<span class="sd">        HdH = U L U^{\dagger}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># H  : nm x nr x nt x nf</span>
        <span class="n">H</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="c1"># Hd : nm x nt x nr x nf</span>
        <span class="n">Hd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        
        <span class="k">if</span> <span class="n">HdH</span><span class="p">:</span>
            <span class="c1">#T : nm x nt x nt x nf</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;uijk,ujlk-&gt;uilk&#39;</span><span class="p">,</span><span class="n">Hd</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#T : nm x nr x nr x nf</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;uijk,ujlk-&gt;uilk&#39;</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Hd</span><span class="p">)</span>
        <span class="c1"># HdH : nm x nf x nr x nr</span>
        <span class="n">T</span>  <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">#U   : nm x nf x (nr|nt) x (nr|nt)</span>
        <span class="c1">#S   : nm x nf x (nr|nt)</span>
        <span class="c1">#V   : nm x nf x (nr|nt) x (nr|nt)</span>
        <span class="n">U</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span>  <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
        

        <span class="k">return</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mchannel.Bcapacity"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Mchannel.html#pylayers.antprop.channel.Mchannel.Bcapacity">[docs]</a>    <span class="k">def</span> <span class="nf">Bcapacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e-3</span><span class="p">]),</span><span class="n">Tp</span><span class="o">=</span><span class="mi">273</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates BLAST deterministic MIMO channel capacity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Pt : np.array (,NPt)</span>
<span class="sd">            the total power is assumed uniformaly distributed over the whole bandwidth</span>
<span class="sd">        Tp : Receiver Temperature (K)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        C   : sum rate or spectral efficiency (bit/s)</span>
<span class="sd">            np.array (Nf,NPt)</span>
<span class="sd">        rho : SNR</span>
<span class="sd">            np.array (Nf,Nt,NPt)</span>

<span class="sd">            log_2(det(I+(Et/(N0Nt))HH^{H})</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The returned value is homogeneous to bit/s the aggregated capacity is obtrained by a simple summation </span>
<span class="sd">        of the returned quantity. To obtain the sum rate or the spectral efficiency in (bit/s/Hz ) the returned </span>
<span class="sd">        value should be divided by the frequency step dfGHz</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fGHz</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Nf</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="n">BGHz</span>  <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dfGHz</span> <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Pt</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">:</span>
            <span class="n">Pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Pt</span><span class="p">])</span>

        <span class="c1"># White Noise definition</span>
        <span class="c1">#</span>
        <span class="c1"># Boltzman constantf    = len(fGHz)</span>

        <span class="n">kB</span> <span class="o">=</span> <span class="mf">1.03806488e-23</span>

        <span class="c1"># N0 ~ J ~ W/Hz ~ W.s</span>

        <span class="n">N0</span> <span class="o">=</span> <span class="n">kB</span><span class="o">*</span><span class="n">Tp</span>


        <span class="c1"># Evaluation of the transfer tensor</span>
        <span class="c1">#</span>
        <span class="c1"># HdH :</span>

        <span class="n">U</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">HdH</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        
        <span class="n">Ps</span>  <span class="o">=</span> <span class="n">Pt</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
      

        <span class="n">Pb</span>  <span class="o">=</span> <span class="n">N0</span><span class="o">*</span><span class="n">BGHz</span><span class="o">*</span><span class="mf">1e9</span>   <span class="c1"># Watt</span>


        <span class="c1"># S : nm x nf x nr </span>
        <span class="c1"># rho : nm x nf x nr x power</span>
        <span class="c1">#</span>
        <span class="n">rho</span>  <span class="o">=</span> <span class="p">(</span><span class="n">Ps</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="n">Pb</span><span class="p">)</span><span class="o">*</span><span class="n">S</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">]</span>
        
        <span class="n">CB</span>   <span class="o">=</span> <span class="n">dfGHz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rho</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
       
        <span class="k">return</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">CB</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mchannel.WFcapacity"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Mchannel.html#pylayers.antprop.channel.Mchannel.WFcapacity">[docs]</a>    <span class="k">def</span> <span class="nf">WFcapacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1e-3</span><span class="p">]),</span><span class="n">Tp</span><span class="o">=</span><span class="mi">273</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates deterministic MIMO channel capacity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Pt :  the total power to be distributed over the different spatial</span>
<span class="sd">            channels using water filling</span>
<span class="sd">        Tp : Receiver Noise Temperature (K)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        C : capacity (bit/s)</span>
<span class="sd">        rho : SNR (in linear scale)</span>

<span class="sd">            log_2(det(It + HH^{H})</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fGHz</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">Nf</span>    <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="c1"># Bandwidth</span>
        <span class="n">BGHz</span>  <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Frequency step</span>
        <span class="n">dfGHz</span> <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># White Noise definition</span>
        <span class="c1">#</span>
        <span class="c1"># Boltzman constant</span>

        <span class="n">kB</span> <span class="o">=</span> <span class="mf">1.03806488e-23</span>

        <span class="c1"># N0 ~ J ~ W/Hz ~ W.s</span>

        <span class="n">N0</span> <span class="o">=</span> <span class="n">kB</span><span class="o">*</span><span class="n">Tp</span>

        <span class="c1"># Evaluation of the transfer HHd tensor</span>
        
        <span class="n">U</span><span class="p">,</span><span class="n">ld</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">HdH</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
       
        <span class="c1">#</span>
        <span class="c1"># Iterative implementation of Water Filling algorithm</span>
        <span class="c1">#</span>

        <span class="c1"># pb : (nm,nf,nt)   noise power (Watt)</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">N0</span><span class="o">*</span><span class="n">dfGHz</span><span class="o">*</span><span class="mf">1e9</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">))</span>
        <span class="c1"># pt : (nm,nf,nt,power)  Total power uniformly spread over (nt*nf-1)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">Pt</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="n">Q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mu</span><span class="o">-</span><span class="n">pb</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">/</span><span class="n">ld</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">])</span>
        <span class="n">u</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Q0</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">Peff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">deltamu</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Peff</span><span class="o">-</span><span class="n">Pt</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1e-16</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">deltamu</span>
            <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mu</span><span class="o">-</span><span class="n">pb</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">/</span><span class="n">ld</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">])</span>
            <span class="n">Peff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#print &quot;mu , Peff : &quot;,mu,Peff</span>
            <span class="n">usup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Peff</span><span class="o">&gt;</span><span class="n">Pt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mu</span><span class="p">[:,:,:,</span><span class="n">usup</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[:,:,:,</span><span class="n">usup</span><span class="p">]</span><span class="o">-</span> <span class="n">deltamu</span><span class="p">[:,:,:,</span><span class="n">usup</span><span class="p">]</span>
            <span class="n">deltamu</span><span class="p">[:,:,:,</span><span class="n">usup</span><span class="p">]</span> <span class="o">=</span> <span class="n">deltamu</span><span class="p">[:,:,:,</span><span class="n">usup</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">Qn</span>   <span class="o">=</span> <span class="n">Q</span><span class="o">/</span><span class="n">pb</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">rho</span>  <span class="o">=</span> <span class="n">Qn</span><span class="o">*</span><span class="n">ld</span><span class="p">[:,:,:,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">Cwf</span>  <span class="o">=</span> <span class="n">dfGHz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rho</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


        <span class="k">return</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span><span class="n">Cwf</span><span class="p">)</span></div>

<div class="viewcode-block" id="Mchannel.plot2"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Mchannel.html#pylayers.antprop.channel.Mchannel.plot2">[docs]</a>    <span class="k">def</span> <span class="nf">plot2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[],</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>  
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">mode</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">cir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">ffts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">cir</span><span class="o">.</span><span class="n">y</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">cir</span><span class="o">.</span><span class="n">x</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>    

        <span class="n">my</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">yc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="n">my</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> <span class="c1"># TD centered      ; TDc.shape : (85, 4, 8, 801)</span>

        <span class="n">yc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># square of TD centered     ; TDc2.shape : (85, 4, 8, 801)</span>
        <span class="n">vary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">yc2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#variance of TD  ; varTD.shape : (4, 8, 801)</span>
        
        

        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nr</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">):</span>
                <span class="c1">#cpt=cpt+1</span>
                <span class="c1">#ax = plt.subplot(self.Nr,self.Nt,cpt)</span>
                <span class="c1">#l1, = ax.plot(self.x,np.sqrt(vary[r,t,:]),color=&#39;k&#39;,linewidth=1,alpha=1)</span>
                <span class="c1">#l1, = ax.plot(self.x,np.sqrt(vary[r,t,:]),linewidth=1,alpha=1)</span>
                <span class="c1">#l2, = ax.plot(self.x,my[r,t,:],color=&#39;r&#39;,linewidth=1,alpha=1)</span>
                <span class="n">l2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">my</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">,:],</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                
                <span class="n">ticksx</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
                <span class="n">ticksy</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ticksx</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ticksy</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1">#l1, = ax.plot(self.x,np.sqrt(vary[r,t,:]),color=&#39;k&#39;,label=&#39;sd&#39;,linewidth=1,alpha=1)</span>
                    <span class="n">l2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">my</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">t</span><span class="p">,:]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ticksx</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mf">0.2</span><span class="p">))</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ticksy</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Evolution of the mean and the standard deviation of $\mathbf{H}(f)$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude (linear scale $\in [0,1]$)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (GHz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></div></div>

                


<div class="viewcode-block" id="Tchannel"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel">[docs]</a><span class="k">class</span> <span class="nc">Tchannel</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handle the transmission channel</span>

<span class="sd">    The transmission channel TChannel is obtained through combination of the propagation</span>
<span class="sd">    channel and the antenna transfer functions from both transmitter and receiver.</span>
<span class="sd">    This channel contains all the spatial information for each individual ray. </span>
<span class="sd">    Warning : This is a frequency domain channel deriving from bs.FUsignal </span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">        ray transfer functions  (nray,nfreq)</span>
<span class="sd">    dod  :</span>
<span class="sd">        direction of depature (rad) [theta_t,phi_t]  nray x 2</span>
<span class="sd">    doa  :</span>
<span class="sd">        direction of arrival (rad)  [theta_r,phi_r]  nray x 2</span>
<span class="sd">    tau  :</span>
<span class="sd">        delay ray k in ns</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    imshow()</span>
<span class="sd">    apply(W)</span>
<span class="sd">    applywavB(Wgam)</span>
<span class="sd">    applywavC(Wgam)</span>
<span class="sd">    chantap(fcGHz,WGHz,Ntap)</span>
<span class="sd">    doddoa()</span>
<span class="sd">    wavefig(w,Nray)</span>
<span class="sd">    rayfig(w,Nray)</span>
<span class="sd">    rssi(ufreq)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    pylayers.antprop.Ctilde.prop2tran</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">tau</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([],)),</span>
                <span class="n">dod</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[],[]]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">doa</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[],[]]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        x  :  , nfreq</span>
<span class="sd">            frequency GHz</span>
<span class="sd">        y  :  nray x nfreq</span>
<span class="sd">            path amplitude</span>
<span class="sd">        tau   :  1 x nray</span>
<span class="sd">            path delay (ns)</span>
<span class="sd">        dod   :  direction of departure (nray x 2)</span>
<span class="sd">        doa   :  direction of arrival   (nray x 2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">))</span>
        <span class="c1"># FUDsignal.__init__(self, x, y,taud)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span>  <span class="o">=</span> <span class="n">dod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span>  <span class="o">=</span> <span class="n">doa</span>
        <span class="c1"># , Nf</span>
        <span class="c1"># Nd x Nf x Np x Nu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="s1">&#39;rect&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFriis</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowed</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filcal</span><span class="o">=</span><span class="s2">&quot;calibration.mat&quot;</span>
        <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Channel&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s1">&#39;Tchannel : Ray transfer function (Nray x Nr x Nt x Nf)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;-----------------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;freq : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;shape  : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;tau (min, max) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;dist (min,max) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFriis</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Friis factor -j c/(4 pi f) has been applied&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> calibrated : Yes</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> calibrated : No</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowed</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39; windowed : Yes</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39; windowed : No</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>


<div class="viewcode-block" id="Tchannel.saveh5"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.saveh5">[docs]</a>    <span class="k">def</span> <span class="nf">saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Ta</span><span class="p">,</span><span class="n">Tb</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        Tilde</span>
<span class="sd">            file identifier number</span>
<span class="sd">        a : np.ndarray</span>
<span class="sd">            postion of point a (transmitter)</span>
<span class="sd">        b : np.ndarray</span>
<span class="sd">            postion of point b (receiver)</span>
<span class="sd">        Ta : np.ndarray</span>
<span class="sd">            rotation matrice of antenna a</span>
<span class="sd">        Tb : np.ndarray</span>
<span class="sd">            rotation matrice of antenna b</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filename</span><span class="o">=</span> <span class="n">_Lfilename</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>
        <span class="n">filenameh5</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRH&#39;</span><span class="p">])</span>

        <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">a</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">b</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Ta</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">Tb</span>
            <span class="c1"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">va</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel Tchannel: issue when writting h5py file&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.loadh5"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.loadh5">[docs]</a>    <span class="k">def</span> <span class="nf">loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span> <span class="n">output</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        output : bool</span>
<span class="sd">            return an output precised in return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        if output:</span>
<span class="sd">        (a,b,Ta,Tb)</span>

<span class="sd">        with</span>
<span class="sd">            a = np.ndarray</span>
<span class="sd">                position of point a (transmitter)</span>
<span class="sd">            b = np.ndarray</span>
<span class="sd">                position of point b (receiver)</span>
<span class="sd">            Ta = np.ndarray</span>
<span class="sd">                rotation matrice of antenna a</span>
<span class="sd">            Tb = np.ndarray</span>
<span class="sd">                rotation matrice of antenna b</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>
        <span class="n">filenameh5</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRH&#39;</span><span class="p">])</span>

        <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># if k != &#39;tau1&#39;:</span>
                <span class="c1">#     setattr(self,str(k),va[:])</span>
                <span class="c1"># else :</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">)</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
            <span class="n">Ta</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">]</span>
            <span class="n">Tb</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">output</span> <span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Ta</span><span class="p">,</span><span class="n">Tb</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel Tchannel: issue when reading h5py file&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Tchannel object in hdf5 format compliant with Link Class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>

        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grpname</span> <span class="ow">in</span> <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">grpname</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Warning : H/&#39;</span><span class="o">+</span><span class="n">grpname</span> <span class="o">+</span><span class="s1">&#39;already exists in &#39;</span><span class="o">+</span><span class="n">filenameh5</span><span class="p">)</span>
            <span class="n">f</span><span class="o">=</span><span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;H/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1">#print(k,va)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">va</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">va</span><span class="p">)</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel Tchannel: issue when writting h5py file&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load H object in hdf5 format compliant with Link Class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

            <span class="n">f</span> <span class="o">=</span> <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;H/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="c1"># keys not saved as attribute of h5py file</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">va</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span><span class="s1">&#39;isFriis&#39;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">[:])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">va</span><span class="p">)</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel Tchannel: issue when reading h5py file&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Tchannel.apply"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; apply FUsignal W to the Tchannel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        W :  Bsignal.FUsignal</span>

<span class="sd">        It exploits multigrid convolution from Bsignal.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        V : FUDAsignal</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Returns :math:`W(f) H_k(f)`</span>

<span class="sd">            + W may have a more important number of points and a smaller frequency band.</span>
<span class="sd">            + If the frequency band of the waveform exceeds the one of the</span>
<span class="sd">            transmission channel, a warning is sent.</span>
<span class="sd">            + W is a FUsignal whose shape doesn&#39;t need to be homogeneous with FUChannel H</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">W</span><span class="o">!=</span><span class="p">[]:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="bp">self</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">V</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">(</span><span class="n">x</span><span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span> <span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">,</span> <span class="n">doa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">V</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.applywav"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.applywav">[docs]</a>    <span class="k">def</span> <span class="nf">applywav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Wgam</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform (time domain ) to obtain the</span>
<span class="sd">            rays impulses response</span>

<span class="sd">            this is the 2015 vectorized method for applying </span>
<span class="sd">            wav on Tchannel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam : waveform</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        rir  : array, </span>
<span class="sd">            impulse response for each ray separately</span>
<span class="sd">            the size of the array is (nb_rays, support_length)</span>
<span class="sd">            support_length is calculated in regard of the </span>
<span class="sd">            delays of the channel</span>

<span class="sd">            </span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>

<span class="sd">            The overall received signal is built in time domain</span>

<span class="sd">            Wgam is applied on each Ray Transfer function</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.channel.rir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># product in frequency domain between Channel (self) and waveform</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Wgam</span><span class="p">)</span>
        <span class="c1"># back in time domain</span>
        <span class="n">rir</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">rir</span><span class="p">(</span><span class="n">Nz</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">ffts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rir</span></div>


<div class="viewcode-block" id="Tchannel.getcir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.getcir">[docs]</a>    <span class="k">def</span> <span class="nf">getcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">BWGHz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nf</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span><span class="n">fftshift</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the channel impulse response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        BWGHz : Bandwidth </span>
<span class="sd">        Nf    : Number of frequency points</span>
<span class="sd">        fftshift : boolean </span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.simul.link.DLink.plt_cir</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fGHz</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">BWGHz</span><span class="p">,</span><span class="n">Nf</span><span class="p">)</span>
        <span class="n">dfGHz</span> <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tauns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">dfGHz</span><span class="p">,</span><span class="n">Nf</span><span class="p">)</span>
        <span class="c1"># E : r x nr x nt x f </span>
        <span class="n">E</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span>
        <span class="c1"># self.y : r x nr x nt x f </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">E</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">H</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">H</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">H</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,:,</span><span class="mi">0</span><span class="p">][:,:,:,</span><span class="bp">None</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># back in time - last axis is frequency (axis=2) </span>
        <span class="n">cir</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fftshift</span><span class="p">:</span>
            <span class="n">cir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">cir</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">tauns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">Nf</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">BWGHz</span><span class="p">),</span><span class="n">Nf</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">BWGHz</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">BWGHz</span><span class="p">,</span><span class="n">Nf</span><span class="p">)</span>

        <span class="n">cir</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tauns</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">cir</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">cir</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.get_cir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.get_cir">[docs]</a>    <span class="k">def</span> <span class="nf">get_cir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Wgam</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; get Channel impulse response of the channel </span>
<span class="sd">            for a given waveform</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam : waveform</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ri  : TUsignal</span>

<span class="sd">            impulse response for each ray separately</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel.rir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">applywav</span><span class="p">(</span><span class="n">Wgam</span><span class="p">)</span>
        <span class="n">cir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rir</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">rir</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cir</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="Tchannel.applywavC"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.applywavC">[docs]</a>    <span class="k">def</span> <span class="nf">applywavC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">dxw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method C</span>
<span class="sd">        DEPRECATED</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w :</span>
<span class="sd">            waveform</span>
<span class="sd">        dxw :</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The overall received signal is built in time domain</span>
<span class="sd">        w is apply on the overall CIR</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span>
            <span class="s1">&#39;WARNING : Tchannel.applywavC is going to be replaced by Tchannel.applywav&#39;</span><span class="p">))</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">ft1</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">dxh</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dxh</span> <span class="o">-</span> <span class="n">dxw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dxh</span> <span class="o">&lt;</span> <span class="n">dxw</span><span class="p">):</span>
                <span class="c1"># reinterpolate w</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reinterpolate h</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dxw</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y_new</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>

        <span class="n">ri</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.baseband"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.baseband">[docs]</a>    <span class="k">def</span> <span class="nf">baseband</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Channel transfer function in baseband</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : center frequency </span>
<span class="sd">        WMHz  : bandwidth in MHz </span>
<span class="sd">        Nf    : Number of frequency points</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s1">&#39;WMHz&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                    <span class="s1">&#39;Nf&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fcGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">WMHz</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;WMHz&#39;</span><span class="p">]</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nf&#39;</span><span class="p">]</span>

        <span class="c1"># self.y : Nray x Nr x Nt x Nf</span>
        <span class="c1"># self.taud : (,Nray)</span>

        <span class="c1"># complex amplitude in baseband</span>
        <span class="c1"># Nray x Nr x Nt x Nf1 </span>
        <span class="n">abb</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">fcGHz</span> <span class="p">)</span>
        <span class="n">fMHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">WMHz</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">WMHz</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">Nf</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">fMHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="mf">1e-3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abb</span><span class="o">*</span><span class="n">E</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fMHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">H</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.chantap"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.chantap">[docs]</a>    <span class="k">def</span> <span class="nf">chantap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; channel tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : center frequency </span>
<span class="sd">        WGHz  : bandwidth </span>
<span class="sd">        Ntap  : int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s1">&#39;WGHz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;Ntap&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fcGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">WGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;WGHz&#39;</span><span class="p">]</span>
        <span class="n">Ntap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ntap&#39;</span><span class="p">]</span>
        <span class="c1"># yb : tau x f x 1</span>
        <span class="n">yb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">fcGHz</span> <span class="p">)</span>
        <span class="c1"># l : 1 x 1 x tap</span>
        <span class="n">l</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntap</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="c1"># l : tau x 1 x 1</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau0</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1"># S : tau x f x tap</span>
        <span class="n">S</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">tau</span><span class="o">*</span><span class="n">WGHz</span><span class="p">)</span>
        <span class="c1"># htap : f x tap</span>
        <span class="n">htap</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yb</span><span class="o">*</span><span class="n">S</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">htapi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">htapi</span></div>



<div class="viewcode-block" id="Tchannel.applywavB"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.applywavB">[docs]</a>    <span class="k">def</span> <span class="nf">applywavB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Wgam</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method B (time domain )</span>

<span class="sd">        DEPRECATED</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam : waveform</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ri  : TUDsignal</span>

<span class="sd">            impulse response for each ray separately</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>

<span class="sd">            The overall received signal is built in time domain</span>

<span class="sd">            Wgam is applied on each Ray Transfer function</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.TUDsignal.ft1</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span>
            <span class="s1">&#39;WARNING : Tchannel.applywavB is going to be replaced by Tchannel.applywav&#39;</span><span class="p">))</span>

        <span class="c1"># product in frequency domain between Channel (self) and waveform</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Wgam</span><span class="p">)</span>
        <span class="c1"># back in time domain</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">ft1</span><span class="p">(</span><span class="n">Nz</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">ffts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.applywavA"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.applywavA">[docs]</a>    <span class="k">def</span> <span class="nf">applywavA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Wgam</span><span class="p">,</span> <span class="n">Tw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply waveform method A</span>

<span class="sd">        DEPRECATED</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Wgam :</span>
<span class="sd">        Tw   :</span>

<span class="sd">        The overall received signal is built in frequency domain</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="ne">DeprecationWarning</span><span class="p">(</span>
            <span class="s1">&#39;WARNING : Tchannel.applywavA is going to be replaced by Tchannel.applywav&#39;</span><span class="p">))</span>
        <span class="n">Hab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ft2</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">HabW</span> <span class="o">=</span> <span class="n">Hab</span> <span class="o">*</span> <span class="n">Wgam</span>
        <span class="n">RI</span> <span class="o">=</span> <span class="n">HabW</span><span class="o">.</span><span class="n">symHz</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="n">RI</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;natural&#39;</span><span class="p">)</span>
        <span class="n">ri</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="o">-</span><span class="n">Tw</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">ri</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.plotd"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.plotd">[docs]</a>    <span class="k">def</span> <span class="nf">plotd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot direction of arrival and departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: &#39;doa&#39; | &#39;dod&#39;</span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis</span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s1">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;b3d&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;xa&#39;</span><span class="p">:[],</span>
                    <span class="s1">&#39;xb&#39;</span><span class="p">:[]</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;doa&#39;</span><span class="p">)</span>


        <span class="c1"># remove non plt.scatter kwargs</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">)</span>
<span class="c1">#        b3d = kwargs.pop(&#39;b3d&#39;)</span>
        <span class="n">the</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
        <span class="n">xa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xa&#39;</span><span class="p">)</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xb&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">Etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span>


        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c1">#</span>
        <span class="c1"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c1"># WARNING polar plot require radian angles</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">the</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span><span class="n">cax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Path Loss (dB)&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.plotad"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.plotad">[docs]</a>    <span class="k">def</span> <span class="nf">plotad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot angular delays</span>

<span class="sd">         Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: &#39;doa&#39; | &#39;dod&#39;</span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        typ : &#39;ns&#39; | &#39;m&#39;</span>
<span class="sd">            display delays in nano seconds ( ns) or meter (m)</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis</span>
<span class="sd">        a : str</span>
<span class="sd">            angle &#39;theta&#39; | &#39;phi&#39;</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        titel : bool</span>
<span class="sd">        &#39;clipval&#39;: float</span>
<span class="sd">            remove values below clipval in dB</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;taumin&#39;</span><span class="p">:[],</span>
                    <span class="s1">&#39;taumax&#39;</span><span class="p">:[],</span>
                    <span class="s1">&#39;typ&#39;</span><span class="p">:</span><span class="s1">&#39;m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;clipval&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2500</span><span class="p">,</span>
                    <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;doa&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="c1"># remove non plt.scatter kwargs</span>

        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">dmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;taumin&#39;</span><span class="p">)</span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;taumax&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;typ&#39;</span><span class="p">)</span>
        <span class="n">clipval</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;clipval&#39;</span><span class="p">)</span>
        <span class="n">do</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">do</span><span class="o">==</span><span class="s1">&#39;doa&#39;</span><span class="p">:</span>
            <span class="n">di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span>
        <span class="k">elif</span> <span class="n">do</span><span class="o">==</span><span class="s1">&#39;dod&#39;</span><span class="p">:</span>
            <span class="n">di</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>

        <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">=</span> <span class="n">delay</span><span class="o">*</span><span class="mf">0.3</span>

        <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="mf">0.</span><span class="c1">#min(delay)</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">dmax</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>



        <span class="n">Etot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-15</span>


        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c1"># WARNING polar plot require radian angles</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>


        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">col</span> <span class="o">&gt;=</span> <span class="n">clipval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;phi&#39;</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="n">cv</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">delay</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">))</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span>
            <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[</span><span class="n">cv</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">delay</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">ang</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ang</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">r&quot;$</span><span class="se">\\</span><span class="s2">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;distance (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">r&quot;$\phi(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">title</span> <span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DoA vs delay (ns)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">b</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Path Loss (dB)&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.doadod"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.doadod">[docs]</a>    <span class="k">def</span> <span class="nf">doadod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; doadod scatter plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar bool</span>

<span class="sd">        Summary</span>
<span class="sd">        --------</span>

<span class="sd">        scatter plot of the DoA-DoD channel structure</span>
<span class="sd">        the energy is colorcoded over all couples of DoA-DoD</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s1">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;b3d&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;xa&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;xb&#39;</span><span class="p">:</span><span class="mi">0</span>
                    <span class="p">}</span>


        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">])</span>
        <span class="n">ax2</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xa&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xb&#39;</span><span class="p">]:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;dod&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;dod&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="Tchannel.field"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.field">[docs]</a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">tau</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">tau</span><span class="o">*</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">E</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>
        <span class="c1">#f = bs.FUsignal(x=self.x,y=np.sum(F,axis=0))</span>
        <span class="c1">#return(f)</span>


<div class="viewcode-block" id="Tchannel.energy"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">sumray</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates channel energy including antennas spatial filtering</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        mode : string</span>
<span class="sd">            center | mean | integ  (different manner to get the value)</span>
<span class="sd">        Friis : boolean</span>
<span class="sd">            apply the Frris coeff(2/(4p pi f)</span>
<span class="sd">        sumray: boolean</span>
<span class="sd">            ray energy cummulation indicator</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1">#  r x f</span>
        <span class="c1">#  axis 1 : ray</span>
        <span class="c1">#  axis 1 : frequency</span>
        <span class="c1">#</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFriis</span><span class="p">:</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">sumray</span><span class="p">:</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Etot</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Etot</span></div>

<div class="viewcode-block" id="Tchannel.wavefig"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.wavefig">[docs]</a>    <span class="k">def</span> <span class="nf">wavefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">Nray</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        w      :  waveform</span>
<span class="sd">        Nray   :  int</span>
<span class="sd">            number of rays to be displayed</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Construire W</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">ft</span><span class="p">()</span>
        <span class="c1"># Appliquer W</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">W</span><span class="p">)</span>
        <span class="c1"># r.require(&#39;graphics&#39;)</span>
        <span class="c1"># r.postscript(&#39;fig.eps&#39;)</span>
        <span class="c1"># r(&#39;par(mfrow=c(2,2))&#39;)</span>
        <span class="c1"># Y.fig(Nray)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iftd</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">fig</span><span class="p">(</span><span class="n">Nray</span><span class="p">)</span></div>
        <span class="c1"># r.dev_off()</span>
        <span class="c1"># os.system(&quot;gv fig.eps &quot;)</span>
        <span class="c1"># y.fidec()</span>
        <span class="c1"># Sur le FUsignal retourn</span>
        <span class="c1"># A gauche afficher le signal sur chaque rayon</span>
        <span class="c1"># A droite le meme signal decal</span>
        <span class="c1"># En bas a droite le signal resultant</span>

<div class="viewcode-block" id="Tchannel.rayfig"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.rayfig">[docs]</a>    <span class="k">def</span> <span class="nf">rayfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build a figure with rays</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : ray index</span>
<span class="sd">        W : waveform    (FUsignal)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        W is apply on k-th ray and the received signal is built in time domain</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get the kth Ray  Transfer function</span>
        <span class="n">Hk</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUDsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,:])</span>

        <span class="n">dxh</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">dxw</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">w0</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># fmin W</span>
        <span class="n">hk0</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># fmin Hk</span>

        <span class="c1"># on s&#39;arrange pour que hk0 soit egal a w0 (ou hk0 soit legerement inferieur a w0)</span>
        <span class="k">if</span> <span class="n">w0</span> <span class="o">&lt;</span> <span class="n">hk0</span><span class="p">:</span>
            <span class="n">np</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">((</span><span class="n">hk0</span> <span class="o">-</span> <span class="n">w0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dxh</span><span class="p">)</span>
            <span class="n">hk0_new</span> <span class="o">=</span> <span class="n">hk0</span> <span class="o">-</span> <span class="n">np</span> <span class="o">*</span> <span class="n">dxh</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">hk0_new</span><span class="p">,</span> <span class="n">hk0</span> <span class="o">+</span> <span class="n">dxh</span><span class="p">,</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Hk</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">Hk</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="p">),</span> <span class="n">Hk</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dxh</span> <span class="o">-</span> <span class="n">dxw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e-10</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dxh</span> <span class="o">&lt;</span> <span class="n">dxw</span><span class="p">):</span>
                <span class="c1"># reinterpolate w</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot; resampling w&quot;</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">W</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxh</span><span class="p">,</span> <span class="n">dxh</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Wk</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">dxh</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># reinterpolate h</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot; resampling h&quot;</span><span class="p">)</span>
                <span class="n">x_new</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Hk</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dxw</span><span class="p">,</span> <span class="n">dxw</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Hk</span> <span class="o">=</span> <span class="n">Hk</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">dxw</span>
                <span class="n">Wk</span> <span class="o">=</span> <span class="n">W</span></div>

        <span class="c1"># qHk.x[0]==Wk.x[0]</span>

<div class="viewcode-block" id="Tchannel.rssi"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.rssi">[docs]</a>    <span class="k">def</span> <span class="nf">rssi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ufreq</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; Compute RSSI value for a frequency index</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        ufreq : int</span>
<span class="sd">            index in the frequency range</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        RSSI: float</span>
<span class="sd">        RSSI value in dB</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function will be deprecated by energy function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Amplitude</span>
        <span class="n">Ak</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="n">ufreq</span><span class="p">]</span>
        <span class="c1"># Power </span>
        <span class="n">Pr</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Ak</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ak</span><span class="p">))</span>
        <span class="c1"># Complex amplitude</span>
        <span class="n">akp</span>   <span class="o">=</span> <span class="n">Ak</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ufreq</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">)</span>
        <span class="n">Prp</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">akp</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">PrdB</span>  <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Pr</span><span class="p">)</span>
        <span class="n">PrpdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Prp</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PrdB</span><span class="p">,</span><span class="n">PrpdB</span></div>

<div class="viewcode-block" id="Tchannel.cut"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.99</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cut the signal at an Energy threshold level</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        threshold : float</span>
<span class="sd">            default 0.99</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;energy&#39;</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eprfl</span><span class="p">()</span>
        <span class="n">cumE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cumE</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">&lt;</span><span class="n">threshold</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="c1">#self.tau = self.tau[v]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[</span><span class="n">v</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[</span><span class="n">v</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">v</span><span class="p">,</span><span class="o">...</span><span class="p">]</span></div>

<div class="viewcode-block" id="Tchannel.sort"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;tau&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sort FUD signal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ  : string</span>
<span class="sd">            which parameter to sort &#39;</span>
<span class="sd">                &#39;tau&#39; : (default)</span>
<span class="sd">                &#39;energy&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eprfl</span><span class="p">()</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">taue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.showtap"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.showtap">[docs]</a>    <span class="k">def</span> <span class="nf">showtap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        same as tap</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        tap</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># f x s  x m x tap</span>

        <span class="n">htap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># sum over time m</span>
        <span class="n">Et_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">htap</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">Nm</span>
        <span class="c1"># sum over s</span>
        <span class="n">Er_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ns</span>
        <span class="n">corrtap</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Tchannel.tap"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.tap">[docs]</a>    <span class="k">def</span> <span class="nf">tap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate channel tap</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fcGHz : float</span>
<span class="sd">            center frequency</span>
<span class="sd">        WMHz : float</span>
<span class="sd">            bandwidth</span>
<span class="sd">        Ntap : int</span>
<span class="sd">            number of taps (related to bandwith)</span>
<span class="sd">            as the bandwith increases the potential number of taps increases</span>
<span class="sd">        Ns : int</span>
<span class="sd">            number of spatial realizations</span>
<span class="sd">        Nm : int</span>
<span class="sd">            number of time samples</span>
<span class="sd">            the channel is sampled along a distance of half a wavelength</span>
<span class="sd">        Va : velocity of link termination a</span>
<span class="sd">        Vb : velocity of link termination b</span>
<span class="sd">        theta_va : float</span>
<span class="sd">            theta velocity termination a (in radians)</span>
<span class="sd">        phi_va  :</span>
<span class="sd">            phi  velocity termination a (in radians)</span>
<span class="sd">        theta_vb:</span>
<span class="sd">            theta velocity termination b (in radians)</span>
<span class="sd">        phi_vb  :</span>
<span class="sd">            phi velocity termination b (in radians)</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">4.5</span><span class="p">,</span>
                    <span class="s1">&#39;WMHz&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s1">&#39;Ntap&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                    <span class="s1">&#39;Ns&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                    <span class="s1">&#39;Nm&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                    <span class="s1">&#39;Va&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="c1">#meter/s</span>
                    <span class="s1">&#39;Vb&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>  <span class="c1">#meter/s</span>
                    <span class="s1">&#39;theta_va&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;phi_va&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;theta_vb&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;phi_vb&#39;</span><span class="p">:</span><span class="mi">0</span> <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fcGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">WMHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;WMHz&#39;</span><span class="p">]</span>
        <span class="n">Ntap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ntap&#39;</span><span class="p">]</span>
        <span class="n">Ns</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ns&#39;</span><span class="p">]</span>
        <span class="n">Nm</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nm&#39;</span><span class="p">]</span>
        <span class="n">Va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Va&#39;</span><span class="p">]</span>
        <span class="n">Vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Vb&#39;</span><span class="p">]</span>
        <span class="c1"># direction of link termination velocity vectors</span>
        <span class="n">theta_va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;theta_va&#39;</span><span class="p">]</span>
        <span class="n">theta_vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;theta_vb&#39;</span><span class="p">]</span>
        <span class="n">phi_va</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;phi_va&#39;</span><span class="p">]</span>
        <span class="n">phi_vb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;phi_vb&#39;</span><span class="p">]</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>

        <span class="n">mmax</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">fcGHz</span><span class="o">*</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="n">Vb</span><span class="p">))</span>
        <span class="n">lam</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fcGHz</span>
        <span class="n">lamo2</span> <span class="o">=</span> <span class="n">lam</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">fmaHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Va</span><span class="o">/</span><span class="mf">0.3</span><span class="p">)</span><span class="o">*</span><span class="n">fcGHz</span>
        <span class="n">fmbHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">Vb</span><span class="o">/</span><span class="mf">0.3</span><span class="p">)</span><span class="o">*</span><span class="n">fcGHz</span>
        <span class="c1"># Coherence Time</span>
        <span class="n">Tca</span> <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fmaHz</span><span class="p">)</span>
        <span class="n">Tcb</span> <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fmbHz</span><span class="p">)</span>
        <span class="n">Tc</span>  <span class="o">=</span> <span class="mi">9</span><span class="o">/</span><span class="p">(</span><span class="mi">14</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">fmaHz</span><span class="o">+</span><span class="n">fmbHz</span><span class="p">))</span>

        <span class="c1"># DoD DoA</span>

        <span class="n">theta_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phi_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dod</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">theta_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phi_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># 3 x r</span>
        <span class="n">ska</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_a</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_a</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_a</span><span class="p">)])</span>
        <span class="n">skb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi_b</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi_b</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_b</span><span class="p">)])</span>

        <span class="c1"># Monte Carlo for spatial realization</span>
        <span class="c1"># s x m x tap</span>
        <span class="n">ua0</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_va</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">va0</span> <span class="o">=</span>  <span class="n">phi_va</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ub0</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_vb</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">vb0</span> <span class="o">=</span>  <span class="n">phi_vb</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="c1"># standard deviation of  velocity vector orientation is inversely</span>
        <span class="c1"># proportional to velocity magnitude</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">ua0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">va</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Va</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">va0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Vb</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">ub0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">Vb</span><span class="o">+</span><span class="mf">0.1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span><span class="o">+</span><span class="n">vb0</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>

        <span class="c1"># uniform sampling over the sphere</span>
        <span class="n">tha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">va</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pha</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ua</span>
        <span class="n">thb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">vb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">phb</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ub</span>

        <span class="n">vax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>
        <span class="n">vay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pha</span><span class="p">)</span>
        <span class="n">vaz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pha</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vaxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vax</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">vay</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>
        <span class="n">va</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vaxy</span><span class="p">,</span><span class="n">vaz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="n">vbx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phb</span><span class="p">)</span>
        <span class="n">vby</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phb</span><span class="p">)</span>
        <span class="n">vbz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">thb</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phb</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">vbxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vbx</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">vby</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="c1"># 3 x r x f x s x m x tap</span>
        <span class="n">vb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">vbxy</span><span class="p">,</span><span class="n">vbz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]])</span>

        <span class="c1"># beta : r x f x s x m x tap</span>
        <span class="n">betaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ska</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">va</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">betab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">skb</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">vb</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


        <span class="c1"># m discrete time axis</span>
        <span class="c1"># r x f x s x m x tap</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mmax</span><span class="p">,</span><span class="n">Nm</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1"># r x f x s x m x tap</span>
        <span class="n">l</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Ntap</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="c1"># l : r x f x s x m x tap</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span> \
              <span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">ba</span>  <span class="o">=</span> <span class="n">betaa</span><span class="o">*</span><span class="n">Va</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="n">bb</span>  <span class="o">=</span> <span class="n">betab</span><span class="o">*</span><span class="n">Vb</span><span class="o">*</span><span class="n">m</span><span class="o">/</span><span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">WMHz</span><span class="o">*</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="n">tau2</span> <span class="o">=</span> <span class="n">tau</span> <span class="o">+</span> <span class="n">ba</span> <span class="o">+</span> <span class="n">bb</span>
        <span class="c1"># S : r x f x s x m x tap (form 2.34 [D. Tse])</span>
        <span class="n">S</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="n">tau2</span><span class="o">*</span><span class="n">WMHz</span><span class="o">/</span><span class="mf">1000.</span><span class="p">)</span>
        <span class="c1"># sum over r :  f x s  x m x tap</span>
        <span class="n">htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fcGHz</span><span class="o">*</span><span class="n">tau2</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># f x s  x m x tap</span>
        <span class="n">htap</span>  <span class="o">=</span> <span class="n">htap</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Ns</span><span class="p">,</span><span class="n">Nm</span><span class="p">,</span><span class="n">Ntap</span><span class="p">)</span>
        <span class="n">Et_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">htap</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">Nm</span>
        <span class="n">Er_htap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">Ns</span>
        <span class="n">corrtap</span> <span class="o">=</span> <span class="n">correlate</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Er_htap</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">htap</span><span class="p">,</span><span class="n">Et_htap</span><span class="p">,</span><span class="n">Er_htap</span><span class="p">,</span><span class="n">corrtap</span><span class="p">)</span></div>

    <span class="c1"># def minphas(self):</span>
    <span class="c1">#     &quot;&quot;&quot; construct a minimal phase FUsignal</span>

    <span class="c1">#     - Evaluate slope of the phase</span>
    <span class="c1">#     - deduce delay</span>
    <span class="c1">#     - update delay of FUDSignal</span>
    <span class="c1">#     - Compensation of phase slope to obtain minimal phase</span>

    <span class="c1">#     This methods updates the excess delay taue member.</span>

    <span class="c1">#     The samplinf frequency step should be</span>

    <span class="c1">#     # Examples</span>
    <span class="c1">#     # --------</span>

    <span class="c1">#     # .. plot::</span>
    <span class="c1">#     #     :include-source:</span>

    <span class="c1">#     #     &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
    <span class="c1">#     #     &gt;&gt;&gt; import numpy as np</span>
    <span class="c1">#     #     &gt;&gt;&gt; fGHz = np.arange(2,11,0.1)</span>
    <span class="c1">#     #     &gt;&gt;&gt; tau1 = np.array([1,2,3])[:,None]</span>
    <span class="c1">#     #     &gt;&gt;&gt; y = np.exp(-2*1j*np.pi*fGHz[None,:]*tau1)/fGHz[None,:]</span>
    <span class="c1">#     #     &gt;&gt;&gt; H = Tchannel(x=fGHz,y=y,tau=np.array([15,17,18]))</span>
    <span class="c1">#     #     &gt;&gt;&gt; f,a = H.plot(typ=[&#39;ru&#39;],xlabels=[&#39;Frequency GHz&#39;])</span>
    <span class="c1">#     #     &gt;&gt;&gt; t1 = plt.suptitle(&#39;Before minimal phase compensation&#39;)</span>
    <span class="c1">#     #     &gt;&gt;&gt; H.minphas()</span>
    <span class="c1">#     #     &gt;&gt;&gt; H.taue</span>
    <span class="c1">#     #     array([ 1.,  2.,  3.])</span>
    <span class="c1">#     #     &gt;&gt;&gt; f,a = H.plot(typ=[&#39;ru&#39;],xlabels=[&#39;Frequency GHz&#39;])</span>
    <span class="c1">#     #     &gt;&gt;&gt; t2 = plt.suptitle(&#39;After minimal phase compensation&#39;)</span>

    <span class="c1">#     &quot;&quot;&quot;</span>

    <span class="c1">#     f = self.x</span>
    <span class="c1">#     phase = np.unwrap(np.angle(self.y))</span>
    <span class="c1">#     dphi = phase[:, -1] - phase[:, 0]</span>
    <span class="c1">#     df = self.x[-1] - self.x[0]</span>
    <span class="c1">#     slope = dphi / df</span>
    <span class="c1">#     #if slope &gt;0:</span>
    <span class="c1">#     #   print &#39;m  inphas Warning : non causal FUSignal&#39;</span>
    <span class="c1">#     #phi0      = +1j*slope*(f[-1]+f[0]/2)</span>
    <span class="c1">#     F, S = np.meshgrid(f, slope)</span>
    <span class="c1">#     #E   = exp(-1j*slope*f+phi0)</span>
    <span class="c1">#     E = np.exp(-1j * S * F)</span>
    <span class="c1">#     self.y = self.y * E</span>
    <span class="c1">#     self.taue = -slope / (2 * np.pi)</span>
    <span class="c1">#     # update total delay</span>
    <span class="c1">#     #self.tau = self.tau+self.taue</span>

<div class="viewcode-block" id="Tchannel.ifft"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.ifft">[docs]</a>    <span class="k">def</span> <span class="nf">ifft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; inverse Fourier Transform</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.simul.link import *</span>
<span class="sd">        &gt;&gt;&gt; L = DLink(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; aktk = L.eval(force=True)</span>
<span class="sd">        &gt;&gt;&gt; L.H.cut()</span>
<span class="sd">        &gt;&gt;&gt; #T1 = L.H.totime()</span>
<span class="sd">        &gt;&gt;&gt; #f,a = T1.plot(typ=&#39;v&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #L.H.minphas()</span>
<span class="sd">        &gt;&gt;&gt; #T2 = L.H.totime()</span>
<span class="sd">        &gt;&gt;&gt; #f,a = T2.plot(typ=&#39;v&#39;)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">TUDchannel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.totime"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.totime">[docs]</a>    <span class="k">def</span> <span class="nf">totime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; transform to TUDchannel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">            Nz : int</span>
<span class="sd">                Number of zeros for zero padding</span>
<span class="sd">            ffts : nt</span>
<span class="sd">                fftshift indicator (default 0 )</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; #from pylayers.simul.link import *</span>
<span class="sd">        &gt;&gt;&gt; #L = DLink(verbose=False)</span>
<span class="sd">        &gt;&gt;&gt; #aktk = L.eval()</span>
<span class="sd">        &gt;&gt;&gt; #L.H.cut()</span>
<span class="sd">        &gt;&gt;&gt; #T1 = L.H.totime()</span>
<span class="sd">        &gt;&gt;&gt; #f,a = T1.plot(typ=&#39;v&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #L.H.minphas()</span>
<span class="sd">        &gt;&gt;&gt; #T2 = L.H.totime()</span>
<span class="sd">        &gt;&gt;&gt; #f,a = T2.plot(typ=&#39;v&#39;)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        FUsignal.ift</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">sy_shifted</span> <span class="o">=</span> <span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axes</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">TUDchannel</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sy_shifted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></div>



<div class="viewcode-block" id="Tchannel.iftd"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.iftd">[docs]</a>    <span class="k">def</span> <span class="nf">iftd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">tstart</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">tstop</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time pasting</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz : int</span>
<span class="sd">            Number of zeros</span>
<span class="sd">        tstart : float</span>
<span class="sd">        tstop  : float</span>
<span class="sd">        ffts   : int</span>
<span class="sd">            fftshift indicator</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        rf : TUsignal (1,N)</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        TUsignal.translate</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span>
        <span class="n">Nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">dx</span><span class="p">()</span>
        <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tstart</span><span class="p">,</span> <span class="n">tstop</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">yini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nray</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)))</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">yini</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># initializes a void signal</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nray</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_new</span><span class="p">)))</span>
            <span class="n">si</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
            <span class="n">rf</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">y</span>
        <span class="k">return</span> <span class="n">rf</span></div>

<div class="viewcode-block" id="Tchannel.rir"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.rir">[docs]</a>    <span class="k">def</span> <span class="nf">rir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  construct ray impulse response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz   : number of zeros for zero padding</span>
<span class="sd">        ffts : fftshift indicator</span>
<span class="sd">            0  no fftshift</span>
<span class="sd">            1  apply fftshift</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        rir : TUsignal</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">taue</span>
        <span class="n">taumin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> 
        <span class="n">taumax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
        <span class="n">dtau</span> <span class="o">=</span> <span class="p">(</span><span class="n">taumax</span><span class="o">-</span><span class="n">taumin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">te</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
       

        <span class="n">shy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Delta Tau + Npoints</span>
        <span class="n">N</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">dtau</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">+</span><span class="n">shy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># convert tau in an integer offset</span>
        <span class="c1"># taumin ray is not shifted</span>
        <span class="n">itau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">tau</span><span class="o">-</span><span class="n">taumin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        
        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">shy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">CU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="c1">#-1 to start @ value 0 </span>

        <span class="n">rir</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">N</span><span class="p">))</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span><span class="n">shy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="p">(</span><span class="n">CU</span><span class="o">+</span><span class="n">itau</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">col1</span><span class="p">,</span><span class="n">col2</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    
        <span class="n">rir</span><span class="p">[</span><span class="n">index</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">index</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">taumin</span><span class="p">,</span><span class="n">te</span><span class="o">+</span><span class="n">taumax</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">rir</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.ft1"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.ft1">[docs]</a>    <span class="k">def</span> <span class="nf">ft1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  construct CIR from ifft(RTF)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz   : number of zeros for zero padding</span>
<span class="sd">        ffts : fftshift indicator</span>
<span class="sd">            0  no fftshift</span>
<span class="sd">            1  apply fftshift</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        r : TUsignal</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">taue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tau</span><span class="p">)):</span>
                <span class="n">si</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span>
                <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
            <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="Tchannel.ftau"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.ftau">[docs]</a>    <span class="k">def</span> <span class="nf">ftau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ffts</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; time superposition</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Nz  : number of zeros for zero padding</span>
<span class="sd">        k   : starting index</span>
<span class="sd">        ffts = 0  no fftshift</span>
<span class="sd">        ffts = 1  apply fftshift</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        r : TUsignal</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">taue</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">Nz</span><span class="p">,</span> <span class="n">ffts</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span>
        <span class="n">r</span>  <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:])</span>
        <span class="n">si</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="n">si</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="Tchannel.plot3d"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.plot3d">[docs]</a>    <span class="k">def</span> <span class="nf">plot3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; plot in 3D</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.signal.bsignal import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; N = 20</span>
<span class="sd">            &gt;&gt;&gt; fGHz = np.arange(1,3,1)</span>
<span class="sd">            &gt;&gt;&gt; taud = np.sort(np.random.rand(N))</span>
<span class="sd">            &gt;&gt;&gt; alpha = np.random.rand(N,len(fGHz))</span>
<span class="sd">            &gt;&gt;&gt; #s = Tchannel(x=fGHz,y=alpha,tau=taud)</span>
<span class="sd">            &gt;&gt;&gt; #s.plot3d()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ntau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nf</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">fig</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span> <span class="o">=</span> <span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="n">k</span><span class="p">])):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">],[</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">],</span><span class="n">color</span><span class="o">=</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Delay (ns)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (fGHz)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">powermin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">powermax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Power (linear)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">(</span><span class="n">powermin</span><span class="p">,</span><span class="n">powermax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tchannel.ft2"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.ft2">[docs]</a>    <span class="k">def</span> <span class="nf">ft2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; build channel transfer function (frequency domain)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        df : float</span>
<span class="sd">            frequency step (default 0.01)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        1. get  fmin and fmax</span>
<span class="sd">        2. build a new base with frequency step df</span>
<span class="sd">        3. Initialize a FUsignal with the new frequency base</span>
<span class="sd">        4. build  matrix tau * f  (Nray x Nf)</span>
<span class="sd">        5. buildl matrix E= exp(-2 j pi f tau)</span>
<span class="sd">        6. resampling of FUDsignal according to f --&gt; S</span>
<span class="sd">        7. apply the element wise product E .* S</span>
<span class="sd">        8. add all rays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">taud</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">taue</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>

        <span class="n">TAUF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">TAUF</span><span class="p">)</span>

        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">ES</span> <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">S</span><span class="o">.</span><span class="n">y</span>
        <span class="n">V</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ES</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">U</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">V</span>

        <span class="k">return</span> <span class="n">U</span></div>

<div class="viewcode-block" id="Tchannel.frombuf"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.frombuf">[docs]</a>    <span class="k">def</span> <span class="nf">frombuf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="n">sign</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a buffer from vna</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        S : buffer</span>
<span class="sd">        sign : int (+1 |-1)  for complex reconstruction</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">S21</span> <span class="o">=</span> <span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+</span><span class="n">sign</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">S</span><span class="p">[</span><span class="n">v</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">S21</span></div>

<div class="viewcode-block" id="Tchannel.capacity"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.capacity">[docs]</a>    <span class="k">def</span> <span class="nf">capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">290</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;blast&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;  calculates channel Shannon capacity (no csi)</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            Pt : Power transmitted</span>
<span class="sd">            T : Temperature (Kelvin)</span>
<span class="sd">            mode : string</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            C : Channel capacity (bit/s)</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">kB</span> <span class="o">=</span> <span class="mf">1.3806488e-23</span>
            <span class="n">N0</span> <span class="o">=</span> <span class="n">kB</span><span class="o">*</span><span class="n">T</span>
            <span class="n">dfGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">BGHz</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Pb</span> <span class="o">=</span> <span class="n">N0</span><span class="o">*</span><span class="n">BGHz</span><span class="o">*</span><span class="mf">1e9</span>
            <span class="n">H2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">snr</span> <span class="o">=</span> <span class="n">Pt</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">H2</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="n">Pb</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">snr</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dfGHz</span>
            <span class="n">SNR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">snr</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dfGHz</span>

            <span class="k">return</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="n">SNR</span><span class="p">)</span></div>

<div class="viewcode-block" id="Tchannel.calibrate"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.calibrate">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filecal</span><span class="o">=</span><span class="s1">&#39;calibration.mat&#39;</span><span class="p">,</span><span class="n">conjugate</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calibrate data </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filecal : string</span>
<span class="sd">            calibration file name  &quot;calibration.mat&quot;</span>
<span class="sd">        conjugate : boolean</span>
<span class="sd">            default False</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filecal</span> <span class="o">=</span> <span class="n">filecal</span>
        <span class="n">Hcal</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">()</span>
        <span class="n">Hcal</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filecal</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Hcal</span><span class="o">.</span><span class="n">x</span><span class="p">)),</span><span class="s2">&quot;calibration file has not the same number of points&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">conjugate</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">/</span><span class="n">Hcal</span><span class="o">.</span><span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Hcal</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">conjugate</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">Hcal</span><span class="o">.</span><span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Hcal</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span></div>

<div class="viewcode-block" id="Tchannel.pdp"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Tchannel.html#pylayers.antprop.channel.Tchannel.pdp">[docs]</a>    <span class="k">def</span> <span class="nf">pdp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">win</span><span class="o">=</span><span class="s1">&#39;hamming&#39;</span><span class="p">,</span><span class="n">calibrate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates power delay profile</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        win : string</span>
<span class="sd">            window name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">win</span> <span class="o">=</span> <span class="n">win</span>
        <span class="k">if</span> <span class="n">calibrate</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">calibrated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">)</span>

        <span class="c1"># inverse Fourier transform</span>

        <span class="n">pdp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ift</span><span class="p">(</span><span class="n">ffts</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pdp</span></div></div>

<div class="viewcode-block" id="Ctilde"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde">[docs]</a><span class="k">class</span> <span class="nc">Ctilde</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; container for the 4 components of the polarimetric ray channel</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    Ctt : bsignal.FUsignal</span>
<span class="sd">    Ctp : bsignal.FUsignal</span>
<span class="sd">    Cpt : bsignal.FUsignal</span>
<span class="sd">    Cpp : bsignal.FUsignal</span>

<span class="sd">    tauk : ndarray delays</span>
<span class="sd">    tang : ndarray angles of departure</span>
<span class="sd">    rang : ndarray angles of arrival</span>
<span class="sd">    tangl : ndarray angles of departure (local)</span>
<span class="sd">    rangl : ndarray angles of arrival (local)</span>

<span class="sd">    fGHz : np.array</span>
<span class="sd">        frequency array</span>
<span class="sd">    nfreq : int</span>
<span class="sd">        number of frequency point</span>
<span class="sd">    nray  : int</span>
<span class="sd">        number of rays</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    choose</span>
<span class="sd">    load</span>
<span class="sd">    mobility</span>
<span class="sd">    doadod</span>
<span class="sd">    show</span>
<span class="sd">    energy</span>
<span class="sd">    sort</span>
<span class="sd">    prop2tran</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class constructor</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        transpose == False   (r,f)</span>
<span class="sd">        transpose == True    (f,r)</span>

<span class="sd">        A Ctilde object can be :</span>
<span class="sd">            + returned from eval method of a Rays object.</span>
<span class="sd">            + generated from a statistical model of the propagation channel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># by default C is expressed between the global frames</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># by default antenna rotation matrices are identity </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">])</span>
        <span class="c1"># a single ray</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">]]))</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tangl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rangl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Ctilde : Ray Propagation Channel Tensor (2x2xrxf)&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;between antennas local frames</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;between termination global frames</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Nray : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Nfreq : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fmin(GHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fmax(GHz): &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fGHz : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;---1st ray 1st freq ---</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;global angles (th,ph) degrees : </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">1800</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">1800</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;local angles (th,ph) degrees : </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">1800</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">*</span><span class="mi">1800</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;    | &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; |</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;    | &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; |</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="Ctilde.inforay"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.inforay">[docs]</a>    <span class="k">def</span> <span class="nf">inforay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iray</span><span class="p">,</span><span class="n">ifreq</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provide information about a specific ray </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dray</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">[</span><span class="n">iray</span><span class="p">]</span><span class="o">*</span><span class="mf">0.3</span>
        <span class="n">draydB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">dray</span><span class="p">)</span>

        <span class="n">Ctt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="n">ifreq</span><span class="p">]</span>
        <span class="n">Ctp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="n">ifreq</span><span class="p">]</span>
        <span class="n">Cpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="n">ifreq</span><span class="p">]</span>
        <span class="n">Cpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="n">ifreq</span><span class="p">]</span>

        
        <span class="n">Cttc</span> <span class="o">=</span> <span class="n">Ctt</span><span class="o">*</span><span class="n">dray</span>
        <span class="n">Ctpc</span> <span class="o">=</span> <span class="n">Ctp</span><span class="o">*</span><span class="n">dray</span>
        <span class="n">Cppc</span> <span class="o">=</span> <span class="n">Cpp</span><span class="o">*</span><span class="n">dray</span>
        <span class="n">Cptc</span> <span class="o">=</span> <span class="n">Cpt</span><span class="o">*</span><span class="n">dray</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;between local frames&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;between global frames&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;distance losses&#39;</span><span class="p">,</span><span class="n">draydB</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cttc</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">CttdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ctt</span><span class="p">))</span>
            <span class="n">CttcdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cttc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CttdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">CttcdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cppc</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">CppdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cpp</span><span class="p">))</span>
            <span class="n">CppcdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cppc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CppdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">CppcdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ctpc</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">CtpdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ctp</span><span class="p">))</span>
            <span class="n">CtpcdB</span> <span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ctpc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CtpdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">CtpcdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cptc</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">CptdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cpt</span><span class="p">))</span>
            <span class="n">CptcdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Cptc</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CptdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">CptcdB</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Without distance losses (Interactions only)&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;co-pol (tt,pp)    dB :&#39;</span><span class="p">,</span><span class="n">CttcdB</span><span class="p">,</span><span class="n">CppcdB</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;cross-pol (tt,pp) dB :&#39;</span><span class="p">,</span><span class="n">CtpcdB</span><span class="p">,</span><span class="n">CptcdB</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;With distance losses (Interactions + distance)&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;co-pol (tt,pp)    dB :&#39;</span><span class="p">,</span><span class="n">CttdB</span><span class="p">,</span><span class="n">CppdB</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;cross-pol (tp,pt) dB :&#39;</span><span class="p">,</span><span class="n">CtpdB</span><span class="p">,</span><span class="n">CptdB</span><span class="p">)</span></div>


<div class="viewcode-block" id="Ctilde.saveh5"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.saveh5">[docs]</a>    <span class="k">def</span> <span class="nf">saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        a : np.ndarray</span>
<span class="sd">            postion of point a (transmitter)</span>
<span class="sd">        b : np.ndarray</span>
<span class="sd">            postion of point b (receiver)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_filename</span><span class="o">=</span> <span class="n">Lfilename</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span>

        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRCT&#39;</span><span class="p">])</span>

        <span class="c1"># save channel in global basis</span>
        <span class="c1"># new call to locbas</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span>

        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ta&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Tb&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;tang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;rang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;tauk&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;fGHz&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>


            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ctt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Cpp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Cpt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ctp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Tx&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Rx&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel.Ctilde: issue when writting h5py file&#39;</span><span class="p">)</span></div>




<div class="viewcode-block" id="Ctilde.loadh5"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.loadh5">[docs]</a>    <span class="k">def</span> <span class="nf">loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lfilename</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Lfilename  : string</span>
<span class="sd">            Layout filename</span>
<span class="sd">        idx : int</span>
<span class="sd">            file identifier number</span>
<span class="sd">        output : bool</span>
<span class="sd">            return an output precised in return</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        if output:</span>
<span class="sd">        (Layout filename , Tx position, Rx position)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_Lfilename</span><span class="o">=</span><span class="n">Lfilename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">_filename</span><span class="o">=</span> <span class="n">_Lfilename</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.hdf5&#39;</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRCT&#39;</span><span class="p">])</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;rang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tauk&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">][:]</span>

            <span class="n">Ctt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ctt_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Cpp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Ctp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ctp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Cpt_y&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpp</span><span class="p">)</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Tx&#39;</span><span class="p">][:]</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Rx&#39;</span><span class="p">][:]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel.Ctilde: issue when reading h5py file&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output</span> <span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Lfilename</span> <span class="p">,</span><span class="n">tx</span><span class="p">,</span><span class="n">rx</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Ctilde object in hdf5 format compliant with Link Class</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># back to global frame</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span>


        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grpname</span> <span class="ow">in</span> <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="n">grpname</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Warning : Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span> <span class="o">+</span><span class="s1">&#39;already exists in &#39;</span><span class="o">+</span><span class="n">filenameh5</span><span class="p">)</span>
            <span class="n">f</span><span class="o">=</span><span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="c1"># save channel in global basis</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ta&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Tb&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;tang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;rang&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;tauk&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;fGHz&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>


            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ctt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Cpp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Cpt_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;Ctp_y&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel.Ctilde: issue when writting h5py file&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Ctilde.los"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.los">[docs]</a>    <span class="k">def</span> <span class="nf">los</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Line of site channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d(m)</span>
<span class="sd">        fGHz (,Nf)</span>
<span class="sd">        tang (1x2)</span>
<span class="sd">        rang (1x2)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pa&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">197</span><span class="p">,</span><span class="mf">189.8</span><span class="p">,</span><span class="mf">1.65</span><span class="p">]</span>
                   <span class="p">,</span><span class="s1">&#39;pb&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">220</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
                   <span class="p">,</span><span class="s1">&#39;fGHz&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="mf">32.6</span><span class="p">]</span> 
                   <span class="p">,</span><span class="s1">&#39;Ta&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                   <span class="p">,</span><span class="s1">&#39;Tb&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.28378894</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8972627</span><span class="p">,</span>  <span class="o">-</span><span class="mf">0.33820628</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="mf">0.57674955</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.44149706</span><span class="p">,</span>  <span class="mf">0.68734293</span><span class="p">],</span>
                         <span class="p">[</span><span class="o">-</span><span class="mf">0.76604425</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>         <span class="o">-</span><span class="mf">0.64278784</span><span class="p">]])</span>
                   <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pa&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pb&#39;</span><span class="p">]</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pb</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pa</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">si</span><span class="o">*</span><span class="n">si</span><span class="p">))]</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">si</span><span class="o">/</span><span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="mf">0.3</span>
        <span class="c1">#</span>
        <span class="c1"># ka = - kb for LOS </span>
        <span class="c1">#</span>
        <span class="n">tha</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">pha</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">thb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="n">si</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">phb</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">si</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tha</span><span class="p">,</span><span class="n">pha</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">thb</span><span class="p">,</span><span class="n">phb</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">/</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
         
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_loadh5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">grpname</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Ctilde object in hdf5 format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filenameh5  : str</span>
<span class="sd">            file name of h5py file Link format</span>
<span class="sd">        grpname  : int</span>
<span class="sd">            groupname in filenameh5</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fh5</span><span class="p">[</span><span class="s1">&#39;Ct/&#39;</span><span class="o">+</span><span class="n">grpname</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;rang&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;tauk&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">][:]</span>

            <span class="n">Ctt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ctt_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Cpp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Ctp</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Ctp_y&#39;</span><span class="p">][:]</span>
            <span class="n">Cpt</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Cpt_y&#39;</span><span class="p">][:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cpp</span><span class="p">)</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">fh5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Channel.Ctilde: issue when reading h5py file&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Ctilde.mobility"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.mobility">[docs]</a>    <span class="k">def</span> <span class="nf">mobility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; modify channel for uniform mobility</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        v  : float</span>
<span class="sd">            velocity (m/s)</span>
<span class="sd">        dt : float</span>
<span class="sd">            delta t (s)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate a channel field from Ctilde and v(terminal vitese)</span>
<span class="sd">        and dt(time of deplacement)</span>

<span class="sd">        dt en s  (observation time between 2 Rx position)</span>
<span class="sd">        v en m/s (vitesse de changement de Rx)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        tau : modified Ctilde</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># m/ns celerity of light</span>
        <span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span>
        <span class="n">tang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span>
        <span class="n">rang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span>

        <span class="n">rk</span> <span class="o">=</span> <span class="n">tauk</span> <span class="o">*</span> <span class="n">c</span>
        <span class="n">rk_mod</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rk</span><span class="p">)</span>
        <span class="n">sk_ch</span> <span class="o">=</span> <span class="n">rk</span> <span class="o">/</span> <span class="n">rk_mod</span>

        <span class="c1"># cos_alph =dot(v/abs(v),sk_ch)</span>

        <span class="n">cos_alph</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">sk_ch</span><span class="p">)</span> <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cos_alph</span> <span class="o">=</span> <span class="n">cos_alph</span>
        <span class="n">rk_ch</span> <span class="o">=</span> <span class="n">rk_mod</span> <span class="o">*</span> <span class="n">cos_alph</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">sk_ch_ch</span> <span class="o">=</span> <span class="p">(</span><span class="n">rk</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rk_ch</span> <span class="o">+</span> <span class="n">cos_alph</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
        <span class="n">tauk_ch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rk_ch</span><span class="p">)</span> <span class="o">*</span> <span class="n">sk_ch_ch</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span>

        <span class="k">return</span><span class="p">(</span><span class="n">tauk_ch</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ctilde.plotd"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.plotd">[docs]</a>    <span class="k">def</span> <span class="nf">plotd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot direction of arrival/departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        d: string</span>
<span class="sd">            &#39;doa&#39; | &#39;dod&#39;</span>
<span class="sd">            display direction of departure | arrival</span>
<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis</span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s1">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;b3d&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="k">if</span> <span class="n">d</span> <span class="o">==</span><span class="s1">&#39;dod&#39;</span><span class="p">:</span>
            <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;DOD : A&#39;</span>
            <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;tang&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;doa&#39;</span><span class="p">:</span>
            <span class="n">tit</span> <span class="o">=</span> <span class="s1">&#39;DOA : B&#39;</span>
            <span class="n">di</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rang&#39;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;d attribute can only be doa or dod&#39;</span><span class="p">)</span>


        <span class="c1"># remove non plt.scatter kwargs</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;phi&#39;</span><span class="p">)</span>
        <span class="n">b3d</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;b3d&#39;</span><span class="p">)</span>
        <span class="n">the</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorbar&#39;</span><span class="p">)</span>
        <span class="n">reverse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;reverse&#39;</span><span class="p">)</span>
        <span class="n">normalize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;normalize&#39;</span><span class="p">)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">Ett</span><span class="p">,</span> <span class="n">Epp</span><span class="p">,</span> <span class="n">Etp</span><span class="p">,</span> <span class="n">Ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">Etot</span> <span class="o">=</span> <span class="n">Ett</span><span class="o">+</span><span class="n">Epp</span><span class="o">+</span><span class="n">Etp</span><span class="o">+</span><span class="n">Ept</span> <span class="o">+</span> <span class="mf">1e-15</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">Emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Etot</span> <span class="o">/</span> <span class="n">Emax</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># col  = 1 - (10*log10(Etot)-Emin)/(Emax-Emin)</span>
        <span class="c1"># WARNING polar plot require radian angles</span>
        <span class="k">if</span> <span class="n">polar</span> <span class="p">:</span>
            <span class="n">al</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

            <span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">the</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
                <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">al</span>  <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">alb</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="n">col</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">di</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(col):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;len(di):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">b3d</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">xa</span><span class="p">),</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">ya</span><span class="p">),</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">za</span><span class="p">),</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">xb</span><span class="p">),</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">yb</span><span class="p">),</span><span class="mf">1.05</span><span class="o">*</span><span class="n">array</span><span class="p">(</span><span class="n">zb</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">polar</span><span class="o">=</span><span class="n">polar</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">reverse</span> <span class="p">:</span>
                <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">scat</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">di</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">al</span><span class="p">,</span> <span class="n">di</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">alb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">((</span><span class="n">the</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">the</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">theta_t(^{\circ})$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\phi(^{\circ})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">tit</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">ll</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span><span class="o">+</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
                <span class="c1">#divider = make_axes_locatable(ax)</span>
                <span class="c1">#cax = divider.append_axes(&quot;right&quot;,size=&quot;5%&quot;,pad=0.05)</span>
                <span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                    <span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;dB&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Path Loss (dB)&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">clb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
                    <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ctilde.doadod"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.doadod">[docs]</a>    <span class="k">def</span> <span class="nf">doadod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; doadod scatter plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phi : tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize : bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi representation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap : matplotlib.cmap</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize : float</span>
<span class="sd">        edgecolors : bool</span>
<span class="sd">        colorbar : bool</span>
<span class="sd">        xa :</span>
<span class="sd">        xb :</span>

<span class="sd">        Summary</span>
<span class="sd">        --------</span>

<span class="sd">        scatter plot of the DoA-DoD channel structure</span>
<span class="sd">        the energy is color coded over all couples of DoA-DoD</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.channel import *</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.energy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;phi&#39;</span><span class="p">:(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span>
                    <span class="s1">&#39;normalize&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;reverse&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;b3d&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;colorbar&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;xa&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;xb&#39;</span><span class="p">:</span><span class="mi">1</span>
                    <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">xa</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xa&#39;</span><span class="p">)</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xb&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>


        <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">])</span>
        <span class="n">ax2</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">xa</span><span class="o">&lt;</span><span class="n">xb</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;dod&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="s1">&#39;dod&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,[</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]</span></div>


<div class="viewcode-block" id="Ctilde.locbas"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.locbas">[docs]</a>    <span class="k">def</span> <span class="nf">locbas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; global reference frame to local reference frame</span>

<span class="sd">        If Tt and Tr are [] the global channel is  retrieved</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Ta  : rotation matrix 3x3  side a </span>
<span class="sd">            default []</span>
<span class="sd">        Tb  : rotation matrix 3x3  side b</span>
<span class="sd">            default []</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        </span>
<span class="sd">        This method affects the boolean islocal </span>
<span class="sd">        This method update the ray propagation channel in either local or global frame</span>
<span class="sd">        self.Ta and self.Tb are updated with input parameters Ta an Tb </span>

<span class="sd">        C : ray propagation channel (2x2xrxf) complex </span>
<span class="sd">            either local or global depends on self.islocal boolean value</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; C = Ctilde()</span>
<span class="sd">        &gt;&gt;&gt; Ta = MEulerAngle(np.pi/2,np.pi/2,np.pi/2.)</span>
<span class="sd">        &gt;&gt;&gt; Tb = MEulerAngle(np.pi/3,np.pi/3,np.pi/3.)</span>
<span class="sd">        &gt;&gt;&gt; C.locbas(Ta=Ta,Tb=Tb)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># get Ctilde frequency axes</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
<span class="c1">#       if rotation matrices are passed in argument </span>
<span class="c1">#       back to global if local </span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Ta&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="s1">&#39;Tb&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="o">=</span><span class="bp">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Ta&#39;</span><span class="p">]</span>
        <span class="c1"># angular axes</span>
        <span class="c1">#</span>
        <span class="c1"># tang : r x 2</span>
        <span class="c1"># rang : r x 2</span>
        <span class="c1">#</span>
        <span class="c1"># Ra : 2 x 2 x r</span>
        <span class="c1"># Rb : 2 x 2 x r</span>
        <span class="c1">#</span>
        <span class="c1"># tangl : r x 2</span>
        <span class="c1"># rangl : r x 2</span>
        <span class="c1">#</span>
        <span class="n">tangl</span><span class="p">,</span><span class="n">Ra</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span>
        <span class="n">rangl</span><span class="p">,</span><span class="n">Rb</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="n">Ra</span> <span class="o">=</span> <span class="n">Ra</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Rb</span> <span class="o">=</span> <span class="n">Rb</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">islocal</span><span class="o">=</span><span class="bp">True</span>

        <span class="c1">#</span>
        <span class="c1"># update direction of departure and arrival</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tangl</span> <span class="o">=</span> <span class="n">tangl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rangl</span> <span class="o">=</span> <span class="n">rangl</span>

        <span class="c1">#uf = np.ones(self.nfreq)</span>

        <span class="c1">#</span>
        <span class="c1"># r0 : r x 1(f)</span>
        <span class="c1">#</span>

        <span class="c1">#r0 = rb00</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = rb01</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="n">t00</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t01</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c1">#r0 = rb10 </span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = rb11 </span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,:][:,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="n">t10</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t11</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c1">#r0 = ra00 </span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Ra</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = ra10 </span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Ra</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="n">Cttl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cptl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="c1">#r0 = ra01</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Ra</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = ra11</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Ra</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:][:,</span> <span class="bp">None</span><span class="p">]</span>

        <span class="n">Ctpl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cppl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cttl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cptl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cppl</span><span class="p">)</span></div>

        <span class="c1">#return self</span>

<div class="viewcode-block" id="Ctilde.Cg2Cl"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.Cg2Cl">[docs]</a>    <span class="k">def</span> <span class="nf">Cg2Cl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Tt</span><span class="o">=</span><span class="p">[],</span> <span class="n">Tr</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; global reference frame to local reference frame</span>

<span class="sd">        If Tt and Tr are [] the global channel is  retrieved</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Tt  : Tx rotation matrix 3x3</span>
<span class="sd">            default []</span>
<span class="sd">        Tr  : Rx rotation matrix 3x3</span>
<span class="sd">            default []</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Cl : Ctilde local</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get frequency axes</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Tt</span> <span class="o">!=</span><span class="p">[])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Tr</span><span class="o">!=</span><span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">Tt</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">Tr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Ta&#39;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Tb&#39;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># get angular axes</span>
        <span class="c1"># Rt (2x2)</span>
        <span class="c1"># Rr (2x2)</span>
        <span class="c1">#</span>
        <span class="c1"># tang : r x 2</span>
        <span class="c1"># rang : r x 2</span>
        <span class="c1">#</span>
        <span class="c1"># Rt : 2 x 2 x r</span>
        <span class="c1"># Rr : 2 x 2 x r</span>
        <span class="c1">#</span>
        <span class="c1"># tangl : r x 2</span>
        <span class="c1"># rangl : r x 2</span>
        <span class="c1">#</span>

        <span class="n">tangl</span> <span class="p">,</span> <span class="n">Ra</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span>
        <span class="n">rangl</span> <span class="p">,</span> <span class="n">Rb</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
        <span class="n">Rb</span> <span class="o">=</span> <span class="n">Rb</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># update direction of departure and arrival</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="n">tangl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="n">rangl</span>

        <span class="c1">#uf = np.ones(self.nfreq)</span>

        <span class="c1">#</span>
        <span class="c1"># r0 : r x 1(f)</span>
        <span class="c1">#</span>

        <span class="c1">#r0 = np.outer(Rr[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = np.outer(Rr[0, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">t00</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t01</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c1">#r0 = np.outer(Rr[1, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = np.outer(Rr[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rr</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">t10</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span>
        <span class="n">t11</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">r1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span>

        <span class="c1">#r0 = np.outer(Rt[0, 0,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = np.outer(Rt[1, 0,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">Cttl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cptl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>

        <span class="c1">#r0 = np.outer(Rt[0, 1,:], uf)</span>
        <span class="n">r0</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="c1">#r1 = np.outer(Rt[1, 1,:], uf)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">Rt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,:][:,</span><span class="bp">None</span><span class="p">]</span>

        <span class="n">Ctpl</span> <span class="o">=</span> <span class="n">t00</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t01</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">Cppl</span> <span class="o">=</span> <span class="n">t10</span> <span class="o">*</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">t11</span> <span class="o">*</span> <span class="n">r1</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cttl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Ctpl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cptl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">Cppl</span><span class="p">)</span>



        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Ctilde.show"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show the propagation channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ   : &#39;m&#39;, &#39;l20&#39; , &#39;r&#39;</span>
<span class="sd">        cmap  : colormap</span>
<span class="sd">            default hot</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            default 14</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;typ&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>


        <span class="n">ax1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (GHz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">u&#39;$C_{</span><span class="se">\\</span><span class="s1">theta</span><span class="se">\\</span><span class="s1">theta}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>

        <span class="n">ax2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (GHz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">u&#39;$C_{</span><span class="se">\\</span><span class="s1">theta\phi}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>

        <span class="n">ax3</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (GHz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">u&#39;$C_{\phi</span><span class="se">\\</span><span class="s1">theta}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>

        <span class="n">ax4</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency (GHz)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">u&#39;$C_{\phi\phi}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ctilde.check_reciprocity"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.check_reciprocity">[docs]</a>    <span class="k">def</span> <span class="nf">check_reciprocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; check channel reciprocity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        C : Ctilde</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This is not properly implemented</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">issue</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">,:],</span> <span class="n">C</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">r</span><span class="p">,:]):</span>
                <span class="n">issue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">issue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Channel is reciprocal&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WARNING Reciprocity issue WARNING&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">issue</span><span class="p">),</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">,</span> <span class="s1">&#39;rays are not reciprocal,&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;rays number with an issue :&quot;</span><span class="p">,</span><span class="n">issue</span><span class="p">)</span></div>

        <span class="c1"># assert np.allclose(self.tang,C.rang)</span>
        <span class="c1"># assert np.allclose(self.rang,C.tang)</span>


<div class="viewcode-block" id="Ctilde.energy"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.energy">[docs]</a>    <span class="k">def</span> <span class="nf">energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">sumray</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates energy on each channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        mode : string</span>
<span class="sd">            &#39;mean&#39;</span>
<span class="sd">        Friis: boolean</span>
<span class="sd">            True</span>
<span class="sd">        sumray: boolean</span>
<span class="sd">            False</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        ECtt  : Energy on co channel    tt</span>
<span class="sd">        ECpp  : Energy on co channel    pp</span>
<span class="sd">        ECtp  : Energy on co channel    tp</span>
<span class="sd">        ECpt  : Energy on co channel    pt</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.signal.bsignal.FUsignal.energy</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        r x f+</span>
<span class="sd">          axis 0 : ray</span>
<span class="sd">          axis 1 : frequency</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#</span>
        <span class="c1">#  r x f</span>
        <span class="c1">#  axis 0 : ray</span>
        <span class="c1">#  axis 1 : frequency</span>
        <span class="c1">#</span>

        <span class="n">ECtt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECtp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECpt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">ECpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="n">Friis</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sumray</span><span class="p">:</span>
            <span class="n">ECtt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECtt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECtp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECtp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECpt</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ECpp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ECpp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ECtt</span><span class="p">,</span> <span class="n">ECpp</span><span class="p">,</span> <span class="n">ECtp</span><span class="p">,</span> <span class="n">ECpt</span></div>

<div class="viewcode-block" id="Ctilde.cut"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold_dB</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; cut rays from a energy threshold</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        threshold : float</span>
<span class="sd">            default 0.99</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ett</span><span class="p">,</span> <span class="n">Epp</span><span class="p">,</span> <span class="n">Etp</span><span class="p">,</span> <span class="n">Ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
        <span class="n">Etot</span> <span class="o">=</span> <span class="n">Ett</span><span class="o">+</span><span class="n">Epp</span><span class="o">+</span><span class="n">Etp</span><span class="o">+</span><span class="n">Ept</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Etot</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#cumE = np.cumsum(Etot[u])/sum(Etot)</span>
        <span class="n">profdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Etot</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Etot</span><span class="p">))</span>
        <span class="c1">#v1 = np.where(cumE&lt;threshold)[0]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">profdB</span><span class="o">&gt;-</span><span class="n">threshold_dB</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Eselected</span> <span class="o">=</span> <span class="n">Etot</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">w</span><span class="p">,:]</span></div>

<div class="viewcode-block" id="Ctilde.sort"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;tauk&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sort Ctilde with respect to typ (default tauk)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ  : string</span>
<span class="sd">            sort w.r.t</span>
<span class="sd">                &#39;tauk&#39;   : delay (default)</span>
<span class="sd">                &#39;att&#39;    : theta Tx</span>
<span class="sd">                &#39;atp&#39;    : phi Tx</span>
<span class="sd">                &#39;art&#39;    : theta Rx</span>
<span class="sd">                &#39;arp&#39;    : phi Rx</span>
<span class="sd">                &#39;energy&#39; : energy</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;tauk&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;att&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;atp&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;art&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;arp&#39;</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;energy&#39;</span><span class="p">:</span>
            <span class="n">Ett</span><span class="p">,</span> <span class="n">Epp</span><span class="p">,</span> <span class="n">Etp</span><span class="p">,</span> <span class="n">Ept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
            <span class="n">Etot</span> <span class="o">=</span> <span class="n">Ett</span><span class="o">+</span><span class="n">Epp</span><span class="o">+</span><span class="n">Etp</span><span class="o">+</span><span class="n">Ept</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">Etot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">u</span><span class="p">,:]</span></div>

<div class="viewcode-block" id="Ctilde.prop2tran"><a class="viewcode-back" href="../../../api/pylayers.antprop.channel.Ctilde.html#pylayers.antprop.channel.Ctilde.prop2tran">[docs]</a>    <span class="k">def</span> <span class="nf">prop2tran</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="p">[],</span><span class="n">b</span><span class="o">=</span><span class="p">[],</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; transform propagation channel into transmission channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : antenna or array a</span>
<span class="sd">        b : antenna or array b</span>

<span class="sd">        Ta : np.array(3x3)</span>
<span class="sd">           unitary matrice for antenna orientation</span>
<span class="sd">        Tb : np.array(3x3)</span>
<span class="sd">           unitary matrice for antenna orientation</span>
<span class="sd">        Friis : boolean</span>
<span class="sd">            if True scale with :math:`-j\frac{\lambda}{f}`</span>
<span class="sd">        debug : boolean</span>
<span class="sd">            if True the antenna gain for each ray is stored</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        H : Tchannel(bs.FUsignal)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">freq</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">nfreq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nfreq</span>
        <span class="n">nray</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># select default antennas</span>
        <span class="c1"># omni polar theta &#39;t&#39; &lt;=&gt; vertical polarization</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ant</span><span class="o">.</span><span class="n">Antenna</span><span class="p">(</span><span class="s1">&#39;Omni&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">ant</span><span class="o">.</span><span class="n">Antenna</span><span class="p">(</span><span class="s1">&#39;Omni&#39;</span><span class="p">,</span><span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>

        <span class="n">a</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">th</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">Fat</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Ft</span><span class="p">)</span>
        <span class="n">Fap</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">Fp</span><span class="p">)</span>
        <span class="c1">#b.eval(th=self.rangl[:, 0], ph=self.rangl[:, 1], grid=False)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">th</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rangl</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">Fbt</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">Ft</span><span class="p">)</span>
        <span class="n">Fbp</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">FUsignal</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">Fp</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1">#  C  :  2 x 2 x r x f</span>
        <span class="c1">#</span>
        <span class="c1">#  Ctt : r x f     (complex FUsignal)</span>
        <span class="c1">#  Cpp : r x f     (complex FUsignal)</span>
        <span class="c1">#  Ctp : r x f     (complex FUsignal)</span>
        <span class="c1">#  Cpt : r x f     (complex FUsignal)</span>
        <span class="c1">#</span>
        <span class="c1">#  a.Ft = r x (Na) x f  (complex ndarray)</span>
        <span class="c1">#  a.Fp = r x (Na) x f  (complex ndarray)</span>
        <span class="c1">#  b.Ft = r x (Nb) x f  (complex ndarray)</span>
        <span class="c1">#  b.Fp = r x (Nb) x f  (complex ndarray)</span>
        <span class="c1">#</span>
        <span class="c1">#  (r x f ) (r x Nt x f )</span>
        <span class="c1">#</span>
        <span class="c1"># This exploit * overloading in FUsignal </span>

        <span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctt</span> <span class="o">*</span> <span class="n">Fat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctp</span> <span class="o">*</span> <span class="n">Fap</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpt</span> <span class="o">*</span> <span class="n">Fat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cpp</span> <span class="o">*</span> <span class="n">Fap</span>

        <span class="c1"># depending on SISO or MIMO case</span>
        <span class="c1"># the shape of the received fields T1 and T2 </span>
        <span class="c1"># </span>
        <span class="c1"># In MIMO case</span>
        <span class="c1">#   a.Ft.y.shape == (r x Na x f) </span>
        <span class="c1">#   a.Fp.y.shape == (r x Na x f)</span>
        <span class="c1"># In SISO case </span>
        <span class="c1">#   a.Ft.y.shape == (r x f) </span>
        <span class="c1">#   a.Fp.y.shape == (r x f)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:,:]</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T1</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">T2</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">FBt</span> <span class="o">=</span> <span class="n">Fbt</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">FBp</span> <span class="o">=</span> <span class="n">Fbp</span><span class="o">.</span><span class="n">y</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FBt</span> <span class="o">=</span> <span class="n">Fbt</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">FBp</span> <span class="o">=</span> <span class="n">Fbp</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>

        <span class="c1"># determine the common interval on frequency axis</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="o">!=</span><span class="n">Fbt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">t1x_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">Fbtx_int</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">inter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">t1x_int</span><span class="p">,</span><span class="n">Fbtx_int</span><span class="p">)</span>
            <span class="n">ut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">t1x_int</span><span class="p">,</span><span class="n">inter</span><span class="p">)</span>
            <span class="n">uf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">in1d</span><span class="p">(</span><span class="n">Fbtx_int</span><span class="p">,</span><span class="n">inter</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">uf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ut</span><span class="p">])</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">uf</span><span class="p">])),</span><span class="s2">&quot;problem in common index plage calculation&quot;</span>

        <span class="n">alpha1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ljkm,lkim-&gt;ljim&#39;</span><span class="p">,</span><span class="n">FBt</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">uf</span><span class="p">],</span><span class="n">T1</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ut</span><span class="p">])</span>
        <span class="n">alpha2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ljkm,lkim-&gt;ljim&#39;</span><span class="p">,</span><span class="n">FBp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">uf</span><span class="p">],</span><span class="n">T2</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">ut</span><span class="p">])</span>

        <span class="c1">#alpha = t1 * Fbt + t2 * Fbp</span>
        <span class="c1"># Nd x Nr x Nt x Nf</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha1</span> <span class="o">+</span> <span class="n">alpha2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">t1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">ut</span><span class="p">]</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span>
                     <span class="n">y</span> <span class="o">=</span> <span class="n">alpha</span><span class="p">,</span>
                     <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tauk</span><span class="p">,</span>
                     <span class="n">dod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">,</span>
                     <span class="n">doa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span> <span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Fat</span><span class="o">=</span><span class="n">Fat</span><span class="o">.</span><span class="n">y</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Fap</span><span class="o">=</span><span class="n">Fap</span><span class="o">.</span><span class="n">y</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Fbt</span><span class="o">=</span><span class="n">Fbt</span><span class="o">.</span><span class="n">y</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Fbp</span><span class="o">=</span><span class="n">Fbp</span><span class="o">.</span><span class="n">y</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Gat</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fat</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fat</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Fat</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Gap</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fap</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fap</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Fap</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Gbt</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Fbt</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>
            <span class="n">H</span><span class="o">.</span><span class="n">Gbp</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fbp</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fbp</span><span class="o">.</span><span class="n">y</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">Fbp</span><span class="o">.</span><span class="n">x</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">Friis</span><span class="p">:</span>
            <span class="n">H</span><span class="o">.</span><span class="n">applyFriis</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">H</span></div></div>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Nov 13, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>