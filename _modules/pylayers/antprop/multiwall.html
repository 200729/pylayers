<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.multiwall &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.antprop.multiwall</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="c">#from numpy import *</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Multiwall module</span>
<span class="sd">================</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>


<span class="sd">    PL0</span>
<span class="sd">    PL</span>
<span class="sd">    Losst</span>
<span class="sd">    Loss0_v2</span>
<span class="sd">    Loss_mur_the</span>
<span class="sd">    Loss0</span>
<span class="sd">    Loss_diff</span>
<span class="sd">    Loss_obstacle</span>
<span class="sd">    Loss_2obstacle</span>
<span class="sd">    LOSS_furniture</span>
<span class="sd">    OneSlopeMdl</span>
<span class="sd">    Dgrid_points</span>
<span class="sd">    Dgrid_zone</span>
<span class="sd">    calnu</span>
<span class="sd">    Carretosegment</span>
<span class="sd">    Intersection</span>
<span class="sd">    Dis</span>
<span class="sd">    Interline</span>
<span class="sd">    showfurniture</span>
<span class="sd">    visuPts</span>
<span class="sd">    cdf</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pylayers.simul.simulem</span>
<span class="kn">import</span> <span class="nn">pylayers.measures.mesuwb</span>
<span class="kn">import</span> <span class="nn">pdb</span>

<div class="viewcode-block" id="LOSS_furniture"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.LOSS_furniture.html#pylayers.antprop.multiwall.LOSS_furniture">[docs]</a><span class="k">def</span> <span class="nf">LOSS_furniture</span><span class="p">(</span><span class="n">Tx</span><span class="p">,</span><span class="n">Rx</span><span class="p">,</span><span class="n">furn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters </span>
<span class="sd">    ----------</span>
<span class="sd">    Tx</span>
<span class="sd">    Rx </span>
<span class="sd">    furn </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">Rx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">377</span><span class="p">):</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">Tx</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
            <span class="n">y2</span> <span class="o">=</span> <span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>          
            <span class="n">T</span> <span class="o">=</span> <span class="n">furn</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="PL0"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.PL0.html#pylayers.antprop.multiwall.PL0">[docs]</a><span class="k">def</span> <span class="nf">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">GtdB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">GrdB</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Path Loss at frequency fGHZ @ 1m </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz: float</span>
<span class="sd">          frequency GHz</span>
<span class="sd">    GtdB: float</span>
<span class="sd">          transmitting antenna gain dB (default 0 dB)</span>
<span class="sd">    GrdB: float</span>
<span class="sd">          receiving antenna gain dB (default 0 dB)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL0 : float</span>
<span class="sd">          path @ 1m</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: PL_0 = -20 log_{10}(\\frac{\\lambda}{4\\pi}) - GtdB -GrdB</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; fGHz  = 2.4</span>
<span class="sd">    &gt;&gt;&gt; PL = PL0(fGHz)</span>
<span class="sd">    &gt;&gt;&gt; assert (PL&lt;41)&amp;(PL&gt;40),&quot;something wrong&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ld</span>  <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
    <span class="n">PL0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ld</span><span class="o">/</span><span class="p">(</span><span class="mf">4.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">-</span><span class="n">GtdB</span><span class="o">-</span><span class="n">GrdB</span>

    <span class="k">return</span> <span class="n">PL0</span>
</div>
<div class="viewcode-block" id="Dgrid_points"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Dgrid_points.html#pylayers.antprop.multiwall.Dgrid_points">[docs]</a><span class="k">def</span> <span class="nf">Dgrid_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">Px</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; distance point to grid</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    points : np.array</span>
<span class="sd">             grid Np x 2 array</span>

<span class="sd">    Px     : np.array</span>
<span class="sd">             point 2 x 1  array</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Dy</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">Dx</span><span class="o">*</span><span class="n">Dx</span> <span class="o">+</span> <span class="n">Dy</span><span class="o">*</span><span class="n">Dy</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Dgrid_zone"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Dgrid_zone.html#pylayers.antprop.multiwall.Dgrid_zone">[docs]</a><span class="k">def</span> <span class="nf">Dgrid_zone</span><span class="p">(</span><span class="n">zone</span><span class="p">,</span><span class="n">Px</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Distance point to zone</span>

<span class="sd">    A zone is a quadrilateral zone.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    zone : dictionnary</span>
<span class="sd">           xmin xmax Nx</span>
<span class="sd">           ymin ymax Ny</span>

<span class="sd">    Px : np.array</span>
<span class="sd">         point</span>

<span class="sd">    Build the distance matrix between Tx and points in the zone</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    use broadcasting instead</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;xmin&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;xmax&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;Nx&#39;</span><span class="p">])</span>
    <span class="n">ry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;ymin&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;ymax&#39;</span><span class="p">],</span><span class="n">zone</span><span class="p">[</span><span class="s">&#39;Ny&#39;</span><span class="p">])</span>

    <span class="n">R_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ry</span><span class="p">)),</span><span class="n">rx</span><span class="p">)</span>
    <span class="n">R_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">ry</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)))</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">R_x</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Dy</span> <span class="o">=</span> <span class="n">R_y</span> <span class="o">-</span> <span class="n">Px</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Dx</span><span class="o">*</span><span class="n">Dx</span><span class="o">+</span><span class="n">Dy</span><span class="o">*</span><span class="n">Dy</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">D</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OneSlopeMdl"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.OneSlopeMdl.html#pylayers.antprop.multiwall.OneSlopeMdl">[docs]</a><span class="k">def</span> <span class="nf">OneSlopeMdl</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">fGHz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; one slope model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    D   : np.array</span>
<span class="sd">          distance array</span>
<span class="sd">    n   : float</span>
<span class="sd">          path loss exponent</span>
<span class="sd">    fGHz : np.array</span>
<span class="sd">           frequency  GHz</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL : np.array</span>
<span class="sd">          path loss as a function of distance</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PL</span> <span class="o">=</span> <span class="n">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">PL</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="PL"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.PL.html#pylayers.antprop.multiwall.PL">[docs]</a><span class="k">def</span> <span class="nf">PL</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">pts</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate Free Space Path Loss</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    fGHz   : float</span>
<span class="sd">             frequency (GHz)</span>
<span class="sd">    pts    : np.array (2xNp)</span>
<span class="sd">             points</span>
<span class="sd">    p      : np.array (2x1) or (2xNp)</span>
<span class="sd">    n      : float</span>
<span class="sd">            path loss exponent (default = 2)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    PL : np.array</span>
<span class="sd">         path loss w.r.t distance and frequency</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">shp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pts</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="c"># f x grid x ap</span>
    <span class="n">PL</span> <span class="o">=</span> <span class="n">PL0</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">D</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">PL</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">PL</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">PL</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Losst"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Losst.html#pylayers.antprop.multiwall.Losst">[docs]</a><span class="k">def</span> <span class="nf">Losst</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">dB</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Calculate Loss between links p1  p2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    L   : Layout object</span>

<span class="sd">    fGHz : np.array</span>
<span class="sd">           frequency GHz</span>

<span class="sd">    p1 : source points</span>
<span class="sd">        (2 x Np1) array or (2,) array</span>

<span class="sd">    p2 : observation point</span>
<span class="sd">        (2 x Np2) array or (2,) array</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.measures.mesuwb import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.multiwall import *</span>
<span class="sd">        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">        &gt;&gt;&gt; S.layout(&#39;where1.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fGHz = 4</span>
<span class="sd">        &gt;&gt;&gt; Tx,Rx = ptw1()</span>
<span class="sd">        &gt;&gt;&gt; Lwo,Lwp,Edo,Edp = Losst(S.L,fGHz,Tx.T,Rx[1,0:2],dB=True)</span>
<span class="sd">        &gt;&gt;&gt; fig=plt.figure(figsize=(20,10))</span>
<span class="sd">        &gt;&gt;&gt; fig,ax = S.L.showGs(fig=fig)</span>
<span class="sd">        &gt;&gt;&gt; tit = plt.title(&#39;test Losst&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sc2 = ax.scatter(Rx[1,0],Rx[1,1],s=20,marker=&#39;x&#39;,c=&#39;k&#39;)</span>
<span class="sd">        &gt;&gt;&gt; sc1 = ax.scatter(Tx[:,0],Tx[:,1],s=20,c=Lwo,linewidth=0)</span>
<span class="sd">        &gt;&gt;&gt; cb = plt.colorbar(sc1)</span>
<span class="sd">        &gt;&gt;&gt; cb.set_label(&#39;dB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    pylayers.antprop.coverage</span>
<span class="sd">    pylayers.slab.Interface.losst</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span><span class="o">==</span><span class="nb">float</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">):</span>
        <span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fGHz</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">sh1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
    <span class="n">sh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="n">sh1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="n">sh2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh1</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sh2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">Nlink</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">angleonlink</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>

    <span class="c"># as many slabs as segments</span>
    <span class="n">slabs</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sla</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;s&#39;</span><span class="p">]]</span>

    <span class="n">cslab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">slabs</span><span class="p">)</span>

    <span class="n">LossWallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">LossWallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">EdWallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>
    <span class="n">EdWallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">),</span><span class="n">Nlink</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">slname</span> <span class="ow">in</span> <span class="n">cslab</span><span class="p">:</span>
        <span class="c"># u index of slabs of name slname</span>
        <span class="c"># data[&#39;a&#39;][u] angle</span>
        <span class="c"># data[&#39;s&#39;][u] segment number including subsegment</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">slabs</span><span class="o">==</span><span class="n">slname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># calculate Loss for slab slname</span>
        <span class="c">#</span>
        <span class="n">lko</span><span class="p">,</span><span class="n">lkp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">losst</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">])</span>
        <span class="c">#</span>
        <span class="c"># calculate Excess delay for slab slname</span>
        <span class="c">#</span>
        <span class="n">do</span> <span class="p">,</span> <span class="n">dp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">excess_grdelay</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">])</span>
        <span class="c"># data[&#39;i&#39;][u] links number</span>
        <span class="n">indexu</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">][</span><span class="n">u</span><span class="p">]</span>
        <span class="c"># reduce to involved links</span>
        <span class="n">involved_links</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">indexu</span><span class="p">,</span><span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">indicep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">indexu</span><span class="p">)])))</span>
        <span class="c"># range on involved links</span>
        <span class="n">irange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">involved_links</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># sum contribution of slab of a same link</span>
        <span class="c">#</span>
        <span class="n">Wallo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lko</span><span class="p">[:,</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Wallp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lkp</span><span class="p">[:,</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">Edo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">do</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]]),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">Edp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">indices</span><span class="p">[</span><span class="n">x</span><span class="p">]:</span><span class="n">indicep</span><span class="p">[</span><span class="n">x</span><span class="p">]]),</span><span class="n">irange</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

        <span class="n">LossWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">LossWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wallo</span>
        <span class="n">LossWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">LossWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wallp</span>

        <span class="n">EdWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">EdWallo</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Edo</span>
        <span class="n">EdWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">=</span> <span class="n">EdWallp</span><span class="p">[:,</span><span class="n">involved_links</span><span class="p">]</span> <span class="o">+</span> <span class="n">Edp</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dB</span><span class="p">:</span>
        <span class="n">LossWallo</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">LossWallo</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">LossWallp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">LossWallp</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">LossWallo</span><span class="p">,</span><span class="n">LossWallp</span><span class="p">,</span><span class="n">EdWallo</span><span class="p">,</span><span class="n">EdWallp</span><span class="p">)</span>
<span class="c">#    i = 0</span>
<span class="c">#    for k in seglist:</span>
<span class="c">#        if k != 0:</span>
<span class="c">#            try:</span>
<span class="c">#                # TODO use z to determine ss_name</span>
<span class="c">#                name = L.Gs.node[k][&#39;ss_name&#39;][-2]</span>
<span class="c">#            except:</span>
<span class="c">#                name = L.Gs.node[k][&#39;name&#39;]</span>
<span class="c">#            #if k in S.indoor.ce.keys():</span>
<span class="c">#            #if k in S.L.ce.keys():</span>
<span class="c">#            # nom du sous-segment  </span>
<span class="c">#            #    indss = S.L.ce[k][0]</span>
<span class="c">#            #    name  = S.L.sl.di[indss]</span>
<span class="c">#            #    print name</span>
<span class="c">#            #&quot;else:  </span>
<span class="c">#            # nom du segment   </span>
<span class="c">#            #    name = S.L.Gs.node[k][&#39;name&#39;] </span>
<span class="c">#            the = theta[i]</span>
<span class="c">#            # idea paper : comparison multiwall th=0 th=variable</span>
<span class="c">#            # comparison mesurement</span>
<span class="c">#            #the = 0</span>
<span class="c">#</span>
<span class="c">#            i   = i + 1</span>
<span class="c">#            #</span>
<span class="c">#            # Loss0 du slab</span>
<span class="c">#            #</span>
<span class="c">#            lko,lkp  = L.sl[name].losst(fGHz,the)</span>
<span class="c">#            do , dp  = L.sl[name].excess_grdelay(theta=the)</span>
<span class="c">#            edo = edo - np.mean(do)</span>
<span class="c">#            edp = edp - np.mean(dp)</span>
<span class="c">##           print lko</span>
<span class="c">##           print lkp</span>
<span class="c">#            Lo   = Lo + lko[0]</span>
<span class="c">#            Lp   = Lp + lkp[0]</span>
<span class="c">#    Lwo = np.hstack((Lwo,Lo))</span>
<span class="c">#    Lwp = np.hstack((Lwp,Lp))</span>
<span class="c">#    Edo = np.hstack((Edo,edo))</span>
<span class="c">#    Edp = np.hstack((Edp,edp))</span>

<span class="c">#    return(Lwo,Lwp,Edo,Edp)</span></div>
<div class="viewcode-block" id="Loss0_v2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss0_v2.html#pylayers.antprop.multiwall.Loss0_v2">[docs]</a><span class="k">def</span> <span class="nf">Loss0_v2</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">Pts</span><span class="p">,</span><span class="n">fGHz</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    L   : Layout</span>
<span class="sd">          Layout object</span>

<span class="sd">    Pts : observation grid </span>
<span class="sd">        (Np x 2) array</span>

<span class="sd">    fGHz : np.array</span>
<span class="sd">           frequency </span>
<span class="sd">    p  : point</span>
<span class="sd">        source points</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Lwo : Losses in wall polarization o</span>
<span class="sd">    Lwp : Losses in wall polarization p</span>
<span class="sd">    Edo :  polarization o</span>
<span class="sd">    Edp :  polarization p</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">#        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">#        &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">#        &gt;&gt;&gt; from pylayers.measures.mesuwb import *</span>
<span class="sd">#        &gt;&gt;&gt; from pylayers.antprop.multiwall import *</span>
<span class="sd">#        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">#        &gt;&gt;&gt; S.layout(&#39;Where1.ini&#39;)</span>
<span class="sd">#        &gt;&gt;&gt; fGHz = 4</span>
<span class="sd">#        &gt;&gt;&gt; Tx,Rx = ptw1()</span>
<span class="sd">#        &gt;&gt;&gt; Lwo,Lwp,Edo,Edp = Loss0_v2(S.L,Tx,fGHz,Rx[1,0:2])</span>
<span class="sd">#        &gt;&gt;&gt; fig,ax = S.L.showGs()</span>
<span class="sd">#        &gt;&gt;&gt; tit = plt.title(&#39;test Loss0_v2&#39;)</span>
<span class="sd">#        &gt;&gt;&gt; sc2 = ax.scatter(Rx[1,0],Rx[1,1],s=20,marker=&#39;x&#39;,c=&#39;k&#39;)</span>
<span class="sd">#        &gt;&gt;&gt; sc1 = ax.scatter(Tx[:,0],Tx[:,1],s=Edo,c=Edo,linewidth=0)</span>
<span class="sd">#        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    DEPRECATED : Use losst instead</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;DEPRECATED function&#39;</span><span class="p">)</span>

    <span class="n">N</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Pts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Lwo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">Lwp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">Edo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">Edp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Lo</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">Lp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">edo</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">edp</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
        <span class="n">seglist</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">angleonlinkold</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">124</span><span class="p">:</span>
                    <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># TODO use z to determine ss_name</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;ss_name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
                <span class="c">#if k in S.indoor.ce.keys():</span>
                <span class="c">#if k in S.L.ce.keys():</span>
                <span class="c"># nom du sous-segment</span>
                <span class="c">#    indss = S.L.ce[k][0]</span>
                <span class="c">#    name  = S.L.sl.di[indss]</span>
                <span class="c">#    print name</span>
                <span class="c">#&quot;else:</span>
                <span class="c"># nom du segment</span>
                <span class="c">#    name = S.L.Gs.node[k][&#39;name&#39;]</span>
                <span class="n">the</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="c"># idea paper : comparison multiwall th=0 th=variable</span>
                <span class="c"># comparison mesurement</span>
                <span class="c">#the = 0</span>

                <span class="n">i</span>   <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="c">#</span>
                <span class="c"># Loss0 du slab</span>
                <span class="c">#</span>
                <span class="n">lko</span><span class="p">,</span><span class="n">lkp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">losst</span><span class="p">(</span><span class="n">fGHz</span><span class="p">,</span><span class="n">the</span><span class="p">)</span>
                <span class="n">do</span> <span class="p">,</span> <span class="n">dp</span>  <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">excess_grdelay</span><span class="p">(</span><span class="n">theta</span><span class="o">=</span><span class="n">the</span><span class="p">)</span>
                <span class="n">edo</span> <span class="o">=</span> <span class="n">edo</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">do</span><span class="p">)</span>
                <span class="n">edp</span> <span class="o">=</span> <span class="n">edp</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span>
    <span class="c">#           print lko</span>
    <span class="c">#           print lkp</span>
                <span class="n">Lo</span>   <span class="o">=</span> <span class="n">Lo</span> <span class="o">+</span> <span class="n">lko</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Lp</span>   <span class="o">=</span> <span class="n">Lp</span> <span class="o">+</span> <span class="n">lkp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Lwo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Lwo</span><span class="p">,</span><span class="n">Lo</span><span class="p">))</span>
        <span class="n">Lwp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Lwp</span><span class="p">,</span><span class="n">Lp</span><span class="p">))</span>
        <span class="n">Edo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Edo</span><span class="p">,</span><span class="n">edo</span><span class="p">))</span>
        <span class="n">Edp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Edp</span><span class="p">,</span><span class="n">edp</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Lwo</span><span class="p">,</span><span class="n">Lwp</span><span class="p">,</span><span class="n">Edo</span><span class="p">,</span><span class="n">Edp</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Loss_mur_the"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss_mur_the.html#pylayers.antprop.multiwall.Loss_mur_the">[docs]</a><span class="k">def</span> <span class="nf">Loss_mur_the</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">pi</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seglist</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">angleonlinkold</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">seglist</span><span class="p">,</span><span class="n">theta</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Loss0"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss0.html#pylayers.antprop.multiwall.Loss0">[docs]</a><span class="k">def</span> <span class="nf">Loss0</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate Loss through Layers theta=0 deg</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    S : Simulation object</span>
<span class="sd">    fGHz : float </span>
<span class="sd">        frequency GHz</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Nx</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
    <span class="n">Ny</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span>
    <span class="n">Lw</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">))</span>
    <span class="k">print</span> <span class="n">shape</span><span class="p">(</span><span class="n">Lw</span><span class="p">)</span>
    <span class="n">i</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rx</span><span class="p">:</span>
        <span class="n">j</span>   <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">ry</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
            <span class="n">seglist</span><span class="p">,</span><span class="n">theta</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">angleonlinkold</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pxy</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">seglist</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">lk</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">sl</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">loss0</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">L</span>  <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">lk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Lw</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>  
    <span class="k">return</span><span class="p">(</span><span class="n">Lw</span><span class="p">)</span>  
</div>
<div class="viewcode-block" id="Loss_diff"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss_diff.html#pylayers.antprop.multiwall.Loss_diff">[docs]</a><span class="k">def</span> <span class="nf">Loss_diff</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate Path Loss of the diffraction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">u</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mi">13</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Ld</span> <span class="o">=</span> <span class="mf">6.9</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">u</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">u</span><span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Ld</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="calnu"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.calnu.html#pylayers.antprop.multiwall.calnu">[docs]</a><span class="k">def</span> <span class="nf">calnu</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">fGHz</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate the diffraction Fresnel parameter</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    h  : signed height w.r.t LOS (meter)</span>
<span class="sd">    d1 : distance 1 (meter)</span>
<span class="sd">    d2 : distance 2 (meter)</span>
<span class="sd">    fGHz  : frequency GHz</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math::   \\nu = h \\sqrt{\\frac{2}{\\lambda} \\frac{d_1+d_2}{d_1 d_2}}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ld</span>  <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="n">fGHz</span>
    <span class="n">nu</span>  <span class="o">=</span> <span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ld</span><span class="o">*</span><span class="n">d1</span><span class="o">*</span><span class="n">d2</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Carretosegment"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Carretosegment.html#pylayers.antprop.multiwall.Carretosegment">[docs]</a><span class="k">def</span> <span class="nf">Carretosegment</span><span class="p">(</span><span class="n">Mob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; define 4 segment using the position of the rectangle</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">PC</span> <span class="o">=</span> <span class="n">Mob</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>

    <span class="n">seg1</span> <span class="o">=</span> <span class="p">(</span><span class="n">PC</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">seg2</span> <span class="o">=</span> <span class="p">(</span><span class="n">PC</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">seg3</span> <span class="o">=</span> <span class="p">(</span><span class="n">PC</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">seg4</span> <span class="o">=</span> <span class="p">(</span><span class="n">PC</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PC</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span><span class="p">(</span><span class="n">seg1</span><span class="p">,</span><span class="n">seg2</span><span class="p">,</span><span class="n">seg3</span><span class="p">,</span><span class="n">seg4</span><span class="p">)</span>  
</div>
<div class="viewcode-block" id="Intersection"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Intersection.html#pylayers.antprop.multiwall.Intersection">[docs]</a><span class="k">def</span> <span class="nf">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; check intersecton  of 2 segments </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    segment 1 : </span>
<span class="sd">        ({x1,y1),(x2,y2)}</span>
<span class="sd">    segment 2 : </span>
<span class="sd">        ({x3,y3),(x4,y4)}</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function is implemented better in GeomUtil intersect</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span> <span class="o">&lt;</span>  <span class="nb">min</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
    <span class="c">#    if x3 == x4:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="c">#  y = A1*x+B1  y = x3</span>
                <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">y1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">Xa</span> <span class="o">=</span> <span class="n">x3</span>
                <span class="n">Ya</span> <span class="o">=</span> <span class="n">x3</span><span class="o">*</span><span class="n">A1</span><span class="o">+</span><span class="n">B1</span>
                <span class="k">if</span> <span class="n">Ya</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">y3</span><span class="p">,</span><span class="n">y4</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Ya</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">y3</span><span class="p">,</span><span class="n">y4</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Ya</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Ya</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">Xa</span><span class="p">,</span><span class="n">Ya</span><span class="p">)</span>
    <span class="c">#    elif y3 == y4:</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-9</span><span class="p">:</span>
            <span class="c"># y = A1*x+B1  x = y3</span>
                <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">y1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">Ya</span> <span class="o">=</span> <span class="n">y3</span>
                <span class="n">Xa</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">B1</span><span class="p">)</span><span class="o">/</span><span class="n">A1</span>
                <span class="k">if</span> <span class="n">Xa</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Xa</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Xa</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Xa</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span><span class="p">(</span><span class="n">Xa</span><span class="p">,</span><span class="n">Ya</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
        <span class="c">#  </span>
        <span class="c"># y = A1*x+B1     y = A2*x+B2</span>
        <span class="c">#</span>
                <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x4</span><span class="p">)</span>
                <span class="n">B1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">y1</span><span class="o">-</span><span class="n">x1</span><span class="o">*</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span>
                <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x4</span><span class="o">*</span><span class="n">y3</span><span class="o">-</span><span class="n">x3</span><span class="o">*</span><span class="n">y4</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x4</span><span class="o">-</span><span class="n">x3</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">A1</span> <span class="o">==</span> <span class="n">A2</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>

            <span class="c"># intersect point (Xa,Ya)</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="n">Xa</span> <span class="o">=</span> <span class="p">(</span><span class="n">B2</span><span class="o">-</span><span class="n">B1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">A1</span><span class="o">-</span><span class="n">A2</span><span class="p">)</span>
                    <span class="n">Ya</span> <span class="o">=</span> <span class="n">Xa</span><span class="o">*</span><span class="n">A1</span><span class="o">+</span><span class="n">B1</span>

                    <span class="k">if</span> <span class="p">((</span><span class="n">Xa</span> <span class="o">&lt;</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">)))</span> <span class="ow">or</span>  <span class="p">(</span><span class="n">Xa</span> <span class="o">&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">x4</span><span class="p">)))):</span>
                        <span class="k">return</span> <span class="bp">False</span>
          
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span><span class="p">(</span><span class="n">Xa</span><span class="p">,</span><span class="n">Ya</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Dis"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Dis.html#pylayers.antprop.multiwall.Dis">[docs]</a><span class="k">def</span> <span class="nf">Dis</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Distance between a point and a line</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        point (x1,y1)</span>
<span class="sd">        line  {(x2,y2),(x3,y3)}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">y3</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">x3</span><span class="o">*</span><span class="n">y2</span><span class="o">-</span><span class="n">x2</span><span class="o">*</span><span class="n">y3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">x3</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span>

    <span class="c"># h: distance</span>
    <span class="c"># ax+by+c=0   h = |a*xo+b*yo+c|/np.sqrt(a*a+b*b)</span>
    <span class="c">#</span>

    <span class="n">h</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">x1</span><span class="o">-</span><span class="n">y1</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">A</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span>
</div>
<div class="viewcode-block" id="Interline"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Interline.html#pylayers.antprop.multiwall.Interline">[docs]</a><span class="k">def</span> <span class="nf">Interline</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">Obstacle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x1</span>
<span class="sd">    y1</span>
<span class="sd">    x2</span>
<span class="sd">    y2</span>
<span class="sd">    Obstacle </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    SS</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">SS</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">SEG</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">Pint</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">Pint</span> <span class="o">==</span><span class="bp">False</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;No intersection&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SS</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">SS</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">SS</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Loss_obstacle"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss_obstacle.html#pylayers.antprop.multiwall.Loss_obstacle">[docs]</a><span class="k">def</span> <span class="nf">Loss_obstacle</span><span class="p">(</span><span class="n">SS</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">Obstacle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    SS</span>

<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LD</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">N</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SS</span><span class="p">]</span>
    <span class="n">SEG</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">Obstacle</span><span class="o">.</span><span class="n">height</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SS</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">LM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">SS</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">LM</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span> <span class="o">==</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">P1</span>  <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">P2</span>  <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
                <span class="n">h1</span>  <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
                <span class="n">h2</span>  <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
                <span class="n">d11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h1</span><span class="o">*</span><span class="n">h1</span><span class="p">)</span>
                <span class="n">d12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h1</span><span class="o">*</span><span class="n">h1</span><span class="p">)</span>
                <span class="n">d21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h2</span><span class="o">*</span><span class="n">h2</span><span class="p">)</span>
                <span class="n">d22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">P2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h2</span><span class="o">*</span><span class="n">h2</span><span class="p">)</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span><span class="n">d11</span><span class="p">,</span><span class="n">d12</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">h2</span><span class="p">,</span><span class="n">d21</span><span class="p">,</span><span class="n">d22</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span>
                <span class="n">Ld1</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
              
                <span class="k">if</span> <span class="n">v1</span> <span class="o">==</span><span class="n">v</span><span class="p">:</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">P1</span>
                    <span class="n">pm</span> <span class="o">=</span> <span class="n">P2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">p0</span> <span class="o">=</span> <span class="n">P2</span>
                    <span class="n">pm</span> <span class="o">=</span> <span class="n">P1</span>
                <span class="n">h0</span>  <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
                <span class="n">hm</span>  <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
                <span class="n">d01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h0</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
                <span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hm</span><span class="o">*</span><span class="n">hm</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d01</span> <span class="o">&lt;</span> <span class="n">dm1</span><span class="p">:</span>
                    <span class="c"># new line: p0 Rx</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># new line: p0 Tx</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">]</span>
          
                <span class="n">d0t</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">h0</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
                <span class="n">dmt</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="n">hm</span><span class="o">*</span><span class="n">hm</span><span class="p">)</span>
                <span class="n">d0m</span> <span class="o">=</span> <span class="n">d0t</span> <span class="o">-</span> <span class="n">dmt</span>
                <span class="n">hm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">dmt</span><span class="o">/</span><span class="n">d0t</span><span class="p">)</span><span class="o">*</span><span class="n">h0</span>
                <span class="k">if</span> <span class="n">hm2</span> <span class="o">&gt;</span> <span class="n">hm</span><span class="p">:</span>
                    <span class="n">Ld2</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hmt</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">-</span> <span class="n">hm2</span>
                    <span class="n">v0t</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hmt</span><span class="p">,</span><span class="n">dmt</span><span class="p">,</span><span class="n">d0m</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                    <span class="n">Ld2</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

                <span class="n">Ld</span> <span class="o">=</span> <span class="n">Ld1</span> <span class="o">+</span> <span class="n">Ld2</span>
                <span class="n">LD</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">LD</span><span class="p">,</span><span class="n">Ld</span><span class="p">))</span>                       
            <span class="n">hh</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="mf">1.2</span>
            <span class="n">Pint1</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>  
            <span class="n">Pint2</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">dis11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">vh1</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span><span class="n">dis11</span><span class="p">,</span><span class="n">dis12</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vh2</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span><span class="n">dis21</span><span class="p">,</span><span class="n">dis22</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vh1</span><span class="p">,</span><span class="n">vh2</span><span class="p">)</span>
            <span class="n">Ldh</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vh</span><span class="p">)</span>
            <span class="n">LD</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">LD</span><span class="p">,</span><span class="n">Ldh</span><span class="p">))</span>
        <span class="c">#    consider the path througth from haut of the furniture  </span>
        <span class="c">#    LM = -10*log10(10**((-LD[0]/10))+10**((-LD[1]/10)))</span>
            <span class="n">LM</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>
            <span class="k">if</span> <span class="n">p1</span><span class="o">==</span><span class="n">p4</span><span class="p">:</span>
                <span class="n">Po</span> <span class="o">=</span> <span class="n">p1</span>
            <span class="k">if</span> <span class="n">p2</span><span class="o">==</span><span class="n">p3</span><span class="p">:</span>
                <span class="n">Po</span> <span class="o">=</span> <span class="n">p2</span>  
        <span class="c">#    Po = [val for val in SEG[S[0]] if val in SEG[S[1]]]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Po</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>                  
            <span class="n">d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">Ld</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">LD</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">LD</span><span class="p">,</span><span class="n">Ld</span><span class="p">))</span>

            <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>

            <span class="k">if</span> <span class="n">p2</span> <span class="o">==</span> <span class="n">p3</span><span class="p">:</span>
                <span class="n">pa</span> <span class="o">=</span> <span class="n">p2</span>
                <span class="n">pb</span> <span class="o">=</span> <span class="n">p1</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">p4</span>
            <span class="k">if</span> <span class="n">p1</span> <span class="o">==</span> <span class="n">p4</span><span class="p">:</span>
                <span class="n">pa</span> <span class="o">=</span> <span class="n">p1</span>
                <span class="n">pb</span> <span class="o">=</span> <span class="n">p2</span>
                <span class="n">pc</span> <span class="o">=</span> <span class="n">p3</span>
  
            <span class="n">ha</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">hb</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
            <span class="n">hc</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
          
            <span class="n">da1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">ha</span><span class="o">*</span><span class="n">ha</span><span class="p">)</span>                  
            <span class="n">da2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">ha</span><span class="o">*</span><span class="n">ha</span><span class="p">)</span>

            <span class="n">db1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hb</span><span class="o">*</span><span class="n">hb</span><span class="p">)</span>
            <span class="n">db2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">hb</span><span class="o">*</span><span class="n">hb</span><span class="p">)</span>

            <span class="n">dc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hc</span><span class="o">*</span><span class="n">hc</span><span class="p">)</span>                  
            <span class="n">dc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">hc</span><span class="o">*</span><span class="n">hc</span><span class="p">)</span>

            <span class="n">va</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">ha</span><span class="p">,</span><span class="n">da1</span><span class="p">,</span><span class="n">da2</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vb</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hb</span><span class="p">,</span><span class="n">db1</span><span class="p">,</span><span class="n">db2</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vc</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hc</span><span class="p">,</span><span class="n">dc1</span><span class="p">,</span><span class="n">dc2</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">vb</span><span class="p">,</span><span class="n">vc</span><span class="p">)</span>
            <span class="n">Ld1</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vmax</span> <span class="o">==</span> <span class="n">va</span><span class="p">:</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">pa</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="n">pb</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="n">pc</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">ha</span>
                <span class="n">hm</span> <span class="o">=</span> <span class="n">hb</span>
                <span class="n">hn</span> <span class="o">=</span> <span class="n">hc</span>
            <span class="k">elif</span> <span class="n">vmax</span> <span class="o">==</span><span class="n">vb</span><span class="p">:</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">pb</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="n">pa</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="n">pc</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">hb</span>
                <span class="n">hm</span> <span class="o">=</span> <span class="n">ha</span>
                <span class="n">hn</span> <span class="o">=</span> <span class="n">hc</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">pc</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="n">pa</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="n">pb</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">hc</span>
                <span class="n">hm</span> <span class="o">=</span> <span class="n">ha</span>
                <span class="n">hn</span> <span class="o">=</span> <span class="n">hb</span>
            <span class="n">d01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h0</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
            <span class="n">d02</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h0</span><span class="o">*</span><span class="n">h0</span><span class="p">)</span>
            <span class="n">dm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hm</span><span class="o">*</span><span class="n">hm</span><span class="p">)</span>
            <span class="n">dm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">hm</span><span class="o">*</span><span class="n">hm</span><span class="p">)</span>
            <span class="n">dn1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hn</span><span class="o">*</span><span class="n">hn</span><span class="p">)</span>
            <span class="n">dn2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">hn</span><span class="o">*</span><span class="n">hn</span><span class="p">)</span>
            <span class="n">nl</span>  <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dm1</span><span class="p">,</span><span class="n">dn1</span><span class="p">))</span><span class="o">&lt;</span><span class="n">d01</span><span class="p">)</span>
            <span class="n">nr</span>  <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dm2</span><span class="p">,</span><span class="n">dn2</span><span class="p">))</span><span class="o">&lt;</span><span class="n">d02</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Ldl</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">]</span>
                <span class="n">VL</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="p">)):</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dm1</span><span class="p">,</span><span class="n">dn1</span><span class="p">))[</span><span class="n">nl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">/</span><span class="n">d01</span><span class="p">)</span><span class="o">*</span><span class="n">h0</span>
                    <span class="n">hreal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">hm</span><span class="p">,</span><span class="n">hn</span><span class="p">))[</span><span class="n">nl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">hreal</span> <span class="o">&lt;</span> <span class="n">hh</span><span class="p">:</span>
                        <span class="n">Ldl</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">VL</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span><span class="n">Ldl</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hmt</span> <span class="o">=</span> <span class="n">hreal</span> <span class="o">-</span> <span class="n">hh</span>
                        <span class="n">pp</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pm</span><span class="p">,</span><span class="n">pn</span><span class="p">))[</span><span class="mi">2</span><span class="o">*</span><span class="n">nl</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">pm</span><span class="p">,</span><span class="n">pn</span><span class="p">))[</span><span class="mi">2</span><span class="o">*</span><span class="n">nl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="n">ldt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="o">*</span><span class="n">hreal</span><span class="p">)</span>               
                        <span class="n">ld0</span> <span class="o">=</span> <span class="n">d01</span> <span class="o">-</span> <span class="n">ldt</span>
                        <span class="n">vl</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hmt</span><span class="p">,</span><span class="n">ld0</span><span class="p">,</span><span class="n">ldt</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">Ldl</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vl</span><span class="p">)</span>
                        <span class="n">VL</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">VL</span><span class="p">,</span><span class="n">Ldl</span><span class="p">))</span>   
                <span class="n">Ldl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">VL</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">Ldr</span> <span class="o">=</span> <span class="mi">0</span>          
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">]</span>
                <span class="n">VR</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nr</span><span class="p">)):</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">(</span><span class="n">hstack</span><span class="p">((</span><span class="n">dm2</span><span class="p">,</span><span class="n">dn2</span><span class="p">))[</span><span class="n">nr</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">/</span><span class="n">d02</span><span class="p">)</span><span class="o">*</span><span class="n">h0</span>
                    <span class="n">hreal</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">hm</span><span class="p">,</span><span class="n">hn</span><span class="p">))[</span><span class="n">nr</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">if</span> <span class="n">hreal</span> <span class="o">&lt;</span><span class="n">hh</span><span class="p">:</span>
                        <span class="n">Ldr</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">VR</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">VR</span><span class="p">,</span><span class="n">Ldr</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hmt</span> <span class="o">=</span> <span class="n">hreal</span> <span class="o">-</span> <span class="n">hh</span>
                        <span class="n">pp</span> <span class="o">=</span> <span class="p">[</span><span class="n">hstack</span><span class="p">((</span><span class="n">pm</span><span class="p">,</span><span class="n">pn</span><span class="p">))[</span><span class="mi">2</span><span class="o">*</span><span class="n">nr</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">hstack</span><span class="p">((</span><span class="n">pm</span><span class="p">,</span><span class="n">pn</span><span class="p">))[</span><span class="mi">2</span><span class="o">*</span><span class="n">nr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span>              
                        <span class="n">rdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="o">*</span><span class="n">hreal</span><span class="p">)</span>
                        <span class="n">rd0</span> <span class="o">=</span> <span class="n">d02</span> <span class="o">-</span><span class="n">rdt</span>
                        <span class="n">vr</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hmt</span><span class="p">,</span><span class="n">rd0</span><span class="p">,</span><span class="n">rdt</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
                        <span class="n">Ldr</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vr</span><span class="p">)</span>
                        <span class="n">VR</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">VR</span><span class="p">,</span><span class="n">Ldr</span><span class="p">))</span>
                <span class="n">Ldr</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">VR</span><span class="p">)</span>
      
            <span class="n">Ld</span> <span class="o">=</span> <span class="n">Ld1</span><span class="o">+</span><span class="n">Ldl</span><span class="o">+</span><span class="n">Ldr</span>
            <span class="n">LD</span> <span class="o">=</span><span class="n">hstack</span><span class="p">((</span><span class="n">LD</span><span class="p">,</span><span class="n">Ld</span><span class="p">))</span>
          
            <span class="n">hh</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="mf">1.2</span>
            <span class="n">Pint1</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>  
            <span class="n">Pint2</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">SS</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">dis11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">dis22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
            <span class="n">vh1</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span><span class="n">dis11</span><span class="p">,</span><span class="n">dis12</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vh2</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh</span><span class="p">,</span><span class="n">dis21</span><span class="p">,</span><span class="n">dis22</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
            <span class="n">vh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vh1</span><span class="p">,</span><span class="n">vh2</span><span class="p">)</span>
            <span class="n">Ldh</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vh</span><span class="p">)</span>
            <span class="n">LD</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">((</span><span class="n">LD</span><span class="p">,</span><span class="n">Ldh</span><span class="p">))</span>
          
            <span class="n">LM</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">LD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)))</span>  
            <span class="c">#LM = -10*log10(10**((-LD[0]/10))+10**((-LD[1]/10)))</span>
          
    <span class="k">return</span><span class="p">(</span><span class="n">LM</span><span class="p">)</span>                              
</div>
<div class="viewcode-block" id="Loss_2obstacle"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.Loss_2obstacle.html#pylayers.antprop.multiwall.Loss_2obstacle">[docs]</a><span class="k">def</span> <span class="nf">Loss_2obstacle</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">Obstacle1</span><span class="p">,</span><span class="n">Obstacle2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Yu Lei function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S1</span> <span class="o">=</span> <span class="n">Interline</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">Obstacle1</span><span class="p">)</span>
    <span class="n">S2</span> <span class="o">=</span> <span class="n">Interline</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">Obstacle2</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">N</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">S1</span><span class="p">]</span>
    <span class="n">SEG</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle1</span><span class="p">)</span>
    <span class="n">height1</span> <span class="o">=</span> <span class="n">Obstacle1</span><span class="o">.</span><span class="n">height</span>
    <span class="n">height2</span> <span class="o">=</span> <span class="n">Obstacle2</span><span class="o">.</span><span class="n">height</span>
    <span class="k">if</span> <span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">==</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">Ga</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">]</span>
        <span class="n">Gb</span> <span class="o">=</span> <span class="p">[</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">p1</span><span class="o">==</span><span class="n">p4</span><span class="p">:</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="n">p2</span><span class="o">==</span><span class="n">p3</span><span class="p">:</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="n">Ga</span> <span class="o">=</span> <span class="p">[</span><span class="n">po</span><span class="p">]</span>

        <span class="n">Pa</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Pb</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">Pc</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Pd</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">Pa</span><span class="o">==</span><span class="n">Pd</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">Pa</span>
            <span class="n">Gb</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pa</span><span class="p">,</span><span class="n">Pb</span><span class="p">,</span><span class="n">Pc</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Pb</span><span class="o">==</span><span class="n">Pc</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">Pb</span>
            <span class="n">Gb</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pa</span><span class="p">,</span><span class="n">Pc</span><span class="p">,</span><span class="n">Pd</span><span class="p">]</span>

    <span class="n">SEG</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle2</span><span class="p">)</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">N</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">S2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">==</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>

        <span class="n">Ga2</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">]</span>
        <span class="n">Gb2</span> <span class="o">=</span> <span class="p">[</span><span class="n">p3</span><span class="p">,</span><span class="n">p4</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">p1</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">p4</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">p1</span><span class="o">==</span><span class="n">p4</span><span class="p">:</span>
                <span class="n">po</span> <span class="o">=</span> <span class="n">p1</span>
        <span class="k">if</span> <span class="n">p2</span><span class="o">==</span><span class="n">p3</span><span class="p">:</span>
                <span class="n">po</span> <span class="o">=</span> <span class="n">p2</span>
        <span class="n">Ga2</span> <span class="o">=</span> <span class="p">[</span><span class="n">po</span><span class="p">]</span>

        <span class="n">Pa</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Pb</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>
        <span class="n">Pc</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Pd</span> <span class="o">=</span> <span class="p">[</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="mi">3</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">Pa</span><span class="o">==</span><span class="n">Pd</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">Pa</span>
            <span class="n">Gb2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pa</span><span class="p">,</span><span class="n">Pb</span><span class="p">,</span><span class="n">Pc</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">Pb</span><span class="o">==</span><span class="n">Pc</span><span class="p">:</span>
            <span class="n">pp</span> <span class="o">=</span> <span class="n">Pb</span>
            <span class="n">Gb2</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pa</span><span class="p">,</span><span class="n">Pc</span><span class="p">,</span><span class="n">Pd</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">Ga</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">Ga</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">Ga2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">Ga2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">Gupper</span>  <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">Ga</span><span class="p">,</span><span class="n">Ga2</span><span class="p">))</span>
        <span class="n">Gbottom</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">Gb</span><span class="p">,</span><span class="n">Gb2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Gupper</span>  <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">Ga</span><span class="p">,</span><span class="n">Gb2</span><span class="p">))</span>
        <span class="n">Gbottom</span> <span class="o">=</span> <span class="n">vstack</span><span class="p">((</span><span class="n">Ga2</span><span class="p">,</span><span class="n">Gb</span><span class="p">))</span>

    <span class="n">h_upper</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">h_bottom</span> <span class="o">=</span> <span class="n">Dis</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
    <span class="n">d1_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h_upper</span><span class="p">[:]</span><span class="o">*</span><span class="n">h_upper</span><span class="p">[:])</span>
    <span class="n">d2_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h_upper</span><span class="p">[:]</span><span class="o">*</span><span class="n">h_upper</span><span class="p">[:])</span>
    <span class="n">v_upper</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">h_upper</span><span class="p">[:],</span><span class="n">d1_upper</span><span class="p">[:],</span><span class="n">d2_upper</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
    <span class="n">v_max1</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">v_upper</span><span class="p">)</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v_upper</span><span class="o">==</span><span class="n">v_max1</span><span class="p">)</span>
    <span class="n">Ld</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">v_max1</span><span class="p">)</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">d1_upper</span><span class="o">&lt;</span><span class="n">d1_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">d1_upper</span><span class="o">&gt;</span><span class="n">d1_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">Hstd</span> <span class="o">=</span> <span class="n">h_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d1_upper</span><span class="p">[</span><span class="n">left</span><span class="p">][:]</span><span class="o">/</span><span class="n">d1_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="n">hreal</span> <span class="o">=</span> <span class="n">h_upper</span><span class="p">[</span><span class="n">left</span><span class="p">]</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">find</span><span class="p">((</span><span class="n">Hstd</span><span class="o">-</span><span class="n">hreal</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">hreal</span> <span class="o">-</span> <span class="n">Hstd</span><span class="p">)[</span><span class="n">nl</span><span class="p">]</span>
            <span class="n">dl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gupper</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xt</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">left</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="p">[</span><span class="n">nl</span><span class="p">][:]</span><span class="o">*</span><span class="n">hreal</span><span class="p">[</span><span class="n">nl</span><span class="p">][:])</span>
            <span class="n">dl2</span> <span class="o">=</span> <span class="n">d1_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">-</span> <span class="n">dl1</span>
            <span class="n">vl</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">height</span><span class="p">[:],</span><span class="n">dl1</span><span class="p">[:],</span><span class="n">dl2</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">Ll</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vl</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ll</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">else</span><span class="p">:</span>
         <span class="n">Ll</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">Hstd</span> <span class="o">=</span> <span class="n">h_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d2_upper</span><span class="p">[</span><span class="n">right</span><span class="p">][:]</span><span class="o">/</span><span class="n">d2_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
        <span class="n">hreal</span> <span class="o">=</span> <span class="n">h_upper</span><span class="p">[</span><span class="n">right</span><span class="p">]</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="n">find</span><span class="p">((</span><span class="n">Hstd</span><span class="o">-</span><span class="n">hreal</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">hreal</span> <span class="o">-</span> <span class="n">Hstd</span><span class="p">)[</span><span class="n">nr</span><span class="p">]</span>
            <span class="n">dr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gupper</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gupper</span><span class="p">[</span><span class="n">right</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="p">[</span><span class="n">nr</span><span class="p">][:]</span><span class="o">*</span><span class="n">hreal</span><span class="p">[</span><span class="n">nr</span><span class="p">][:])</span>  
            <span class="n">dr1</span> <span class="o">=</span> <span class="n">d2_upper</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr2</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">height</span><span class="p">[:],</span><span class="n">dr1</span><span class="p">[:],</span><span class="n">dr2</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">Lr</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Lr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Lr</span> <span class="o">=</span> <span class="mi">0</span>      

    <span class="n">Lupper</span> <span class="o">=</span> <span class="n">Ld</span> <span class="o">+</span> <span class="n">Ll</span> <span class="o">+</span> <span class="n">Lr</span>
<span class="c">#    Lupper = -10*log10(10**((-Ld/10))+10**((-Ll/10))+10**((-Lr/10)))</span>


    <span class="n">d1_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">-</span><span class="n">h_bottom</span><span class="p">[:]</span><span class="o">*</span><span class="n">h_bottom</span><span class="p">[:])</span>
    <span class="n">d2_bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">-</span><span class="n">h_bottom</span><span class="p">[:]</span><span class="o">*</span><span class="n">h_bottom</span><span class="p">[:])</span>
    <span class="n">v_bottom</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">h_bottom</span><span class="p">[:],</span><span class="n">d1_bottom</span><span class="p">[:],</span><span class="n">d2_bottom</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
    <span class="n">v_max2</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">v_bottom</span><span class="p">)</span>
    <span class="n">nn2</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">v_bottom</span><span class="o">==</span><span class="n">v_max2</span><span class="p">)</span>
    <span class="n">Ld2</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">v_max2</span><span class="p">)</span>
      
    <span class="n">left2</span><span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">d1_bottom</span><span class="o">&lt;</span><span class="n">d1_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">])</span>  
    <span class="n">right2</span><span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">d1_bottom</span><span class="o">&gt;</span><span class="n">d1_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">])</span>
  
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left2</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">Hstd</span> <span class="o">=</span> <span class="n">h_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d1_bottom</span><span class="p">[</span><span class="n">left2</span><span class="p">][:]</span><span class="o">/</span><span class="n">d1_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">]</span>
        <span class="n">hreal</span> <span class="o">=</span> <span class="n">h_bottom</span><span class="p">[</span><span class="n">left2</span><span class="p">]</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">find</span><span class="p">((</span><span class="n">Hstd</span><span class="o">-</span><span class="n">hreal</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">hreal</span> <span class="o">-</span> <span class="n">Hstd</span><span class="p">)[</span><span class="n">nl</span><span class="p">]</span>
            <span class="n">dl1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">left2</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">left2</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xt</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">left2</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">left2</span><span class="p">][</span><span class="n">nl</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yt</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="p">[</span><span class="n">nl</span><span class="p">][:]</span><span class="o">*</span><span class="n">hreal</span><span class="p">[</span><span class="n">nl</span><span class="p">][:])</span>
            <span class="n">dl2</span> <span class="o">=</span> <span class="n">d1_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dl1</span>
            <span class="n">vl</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">height</span><span class="p">[:],</span><span class="n">dl1</span><span class="p">[:],</span><span class="n">dl2</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">Ll</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vl</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ll</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">else</span><span class="p">:</span>
         <span class="n">Ll</span> <span class="o">=</span> <span class="mi">0</span>
      
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">right2</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">Hstd</span> <span class="o">=</span> <span class="n">h_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d2_bottom</span><span class="p">[</span><span class="n">right2</span><span class="p">][:]</span><span class="o">/</span><span class="n">d2_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">]</span>
        <span class="n">hreal</span> <span class="o">=</span> <span class="n">h_bottom</span><span class="p">[</span><span class="n">right2</span><span class="p">]</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="n">find</span><span class="p">((</span><span class="n">Hstd</span><span class="o">-</span><span class="n">hreal</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">hreal</span> <span class="o">-</span><span class="n">Hstd</span><span class="p">)[</span><span class="n">nr</span><span class="p">]</span>
            <span class="n">dr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">right2</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">right2</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">xr</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">right2</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Gbottom</span><span class="p">[</span><span class="n">right2</span><span class="p">][</span><span class="n">nr</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yr</span><span class="p">)</span><span class="o">-</span><span class="n">hreal</span><span class="p">[</span><span class="n">nr</span><span class="p">][:]</span><span class="o">*</span><span class="n">hreal</span><span class="p">[</span><span class="n">nr</span><span class="p">][:])</span>  
            <span class="n">dr1</span> <span class="o">=</span> <span class="n">d2_bottom</span><span class="p">[</span><span class="n">nn2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr2</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">height</span><span class="p">[:],</span><span class="n">dr1</span><span class="p">[:],</span><span class="n">dr2</span><span class="p">[:],</span><span class="n">f</span><span class="p">)</span>
            <span class="n">Lr</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">vr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Lr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Lr</span> <span class="o">=</span> <span class="mi">0</span>      

    <span class="n">Lbottom</span> <span class="o">=</span> <span class="n">Ld2</span> <span class="o">+</span> <span class="n">Ll</span> <span class="o">+</span> <span class="n">Lr</span>
<span class="c">#    Lbottom = -10*log10(10**((-Ld2/10))+10**((-Ll/10))+10**((-Lr/10)))</span>

  
    <span class="n">hh1</span> <span class="o">=</span> <span class="n">height1</span> <span class="o">-</span> <span class="mf">1.2</span>
    <span class="n">SEG1</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle1</span><span class="p">)</span>
    <span class="n">SEG2</span> <span class="o">=</span> <span class="n">Carretosegment</span><span class="p">(</span><span class="n">Obstacle2</span><span class="p">)</span>
    <span class="n">Pint1</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>  
    <span class="n">Pint2</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG1</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S1</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>
    <span class="c">#print Pint1</span>
    <span class="c">#print Pint2</span>
    <span class="n">dis11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh1</span><span class="o">*</span><span class="n">hh1</span><span class="p">)</span>
    <span class="n">dis12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh1</span><span class="o">*</span><span class="n">hh1</span><span class="p">)</span>
    <span class="n">dis21</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh1</span><span class="o">*</span><span class="n">hh1</span><span class="p">)</span>
    <span class="n">dis22</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh1</span><span class="o">*</span><span class="n">hh1</span><span class="p">)</span>
    <span class="n">vh1</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh1</span><span class="p">,</span><span class="n">dis11</span><span class="p">,</span><span class="n">dis12</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
    <span class="n">vh2</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh1</span><span class="p">,</span><span class="n">dis21</span><span class="p">,</span><span class="n">dis22</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

    <span class="n">hh2</span> <span class="o">=</span> <span class="n">height2</span><span class="o">-</span><span class="mf">1.2</span>
    <span class="n">Pint3</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">0</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>  
    <span class="n">Pint4</span> <span class="o">=</span> <span class="n">Intersection</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">0</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">1</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">2</span><span class="p">],</span><span class="n">SEG2</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">S2</span><span class="p">[</span><span class="mi">1</span><span class="p">])][</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">dis31</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh2</span><span class="o">*</span><span class="n">hh2</span><span class="p">)</span>
    <span class="n">dis32</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh2</span><span class="o">*</span><span class="n">hh2</span><span class="p">)</span>
    <span class="n">dis41</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">hh2</span><span class="o">*</span><span class="n">hh2</span><span class="p">)</span>
    <span class="n">dis42</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Pint4</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y2</span><span class="p">)</span><span class="o">+</span><span class="n">hh2</span><span class="o">*</span><span class="n">hh2</span><span class="p">)</span>
    <span class="n">vh3</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh2</span><span class="p">,</span><span class="n">dis31</span><span class="p">,</span><span class="n">dis32</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
    <span class="n">vh4</span> <span class="o">=</span> <span class="n">calnu</span><span class="p">(</span><span class="n">hh2</span><span class="p">,</span><span class="n">dis41</span><span class="p">,</span><span class="n">dis42</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>


    <span class="n">vh</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vh1</span><span class="p">,</span><span class="n">vh2</span><span class="p">,</span><span class="n">vh3</span><span class="p">,</span><span class="n">vh4</span><span class="p">)</span>
    <span class="n">Lheight</span> <span class="o">=</span> <span class="n">Loss_diff</span><span class="p">(</span><span class="n">vh</span><span class="p">)</span>


    <span class="n">Ltotal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">Lupper</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">Lbottom</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span><span class="o">+</span><span class="mi">10</span><span class="o">**</span><span class="p">((</span><span class="o">-</span><span class="n">Lheight</span><span class="o">/</span><span class="mi">10</span><span class="p">)))</span>
<span class="c">#    Ltotal = -10*log10(10**((-Lupper/10))+10**((-Lbottom/10)))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">Ltotal</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="showfurniture"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.showfurniture.html#pylayers.antprop.multiwall.showfurniture">[docs]</a><span class="k">def</span> <span class="nf">showfurniture</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="c">#R1_A.show(fig,ax)</span>
    <span class="c">#R1_B1.show(fig,ax)</span>
    <span class="c">#R1_B2.show(fig,ax)</span>
    <span class="c">#R2_A.show(fig,ax)</span>
    <span class="c">#R6_A.show(fig,ax)</span>
    <span class="c">#R6_B.show(fig,ax)</span>
    <span class="c">#R6_C.show(fig,ax)</span>
    <span class="n">R6_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_E</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_G</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_HA</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_HB</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_IA</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R6_IB</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_A</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_B</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R13_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R12_A1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R12_A2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R12_B.show(fig,ax)</span>
    <span class="c">#R12_C1.show(fig,ax)</span>
    <span class="c">#R12_C2.show(fig,ax)</span>
    <span class="n">R12_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R7_A1.show(fig,ax)</span>
    <span class="c">#R7_A2.show(fig,ax)</span>
    <span class="c">#R7_B.show(fig,ax)</span>
    <span class="n">R7_C1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R7_C2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R7_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R10_A.show(fig,ax)</span>
    <span class="c">#R10_B.show(fig,ax)</span>
    <span class="n">R10_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R10_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R11_A.show(fig,ax)</span>
    <span class="c">#R11_B.show(fig,ax)</span>
    <span class="n">R11_C</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_D1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_D2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_E1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_E2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R11_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R8_A.show(fig,ax)</span>
    <span class="c">#R8_B.show(fig,ax)</span>
    <span class="c">#R9_A1.show(fig,ax)</span>
    <span class="c">#R9_A2.show(fig,ax)</span>
    <span class="n">R9_B1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_B2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_B3</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="c">#R9_C.show(fig,ax)</span>
    <span class="n">R9_D</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_E1</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_E2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_F</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">R9_G</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="visuPts"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.visuPts.html#pylayers.antprop.multiwall.visuPts">[docs]</a><span class="k">def</span> <span class="nf">visuPts</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">nu</span><span class="p">,</span><span class="n">nd</span><span class="p">,</span><span class="n">Pts</span><span class="p">,</span><span class="n">Values</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">sp</span><span class="o">=</span><span class="p">[],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">tit</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">colbar</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">xticks</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    visuPt  : Visualization of values a given points</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    S       : Simul </span>
<span class="sd">    nu      : useful Points</span>
<span class="sd">    nd      : Points deleted</span>
<span class="sd">    Pts     : Points coordinates</span>
<span class="sd">    Value</span>
<span class="sd">    &quot;&quot;&quot;</span>
  
    <span class="n">vx</span>  <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nu</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vy</span>  <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nu</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">vxd</span> <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nd</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">vyd</span> <span class="o">=</span> <span class="n">Pts</span><span class="p">[</span><span class="n">nd</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">vmax</span><span class="o">&lt;</span><span class="n">vmin</span><span class="p">:</span>
        <span class="c">#vmin = min(Values)</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">150</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Values</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">,</span><span class="s">&#39;bottom&#39;</span><span class="p">]:</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s">&#39;outward&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c"># outward by 10 points</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&#39;bottom&#39;</span><span class="p">)</span>
              <span class="k">elif</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;right&#39;</span><span class="p">,</span><span class="s">&#39;top&#39;</span><span class="p">]:</span>
                 <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">)</span> <span class="c"># don&#39;t draw spine</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknown spine location: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">loc</span><span class="p">,</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">sp</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
              <span class="k">if</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">]:</span>
                <span class="n">spine</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="s">&#39;outward&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="c"># outward by 10 points</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">)</span>
              <span class="k">elif</span> <span class="n">loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;right&#39;</span><span class="p">,</span><span class="s">&#39;top&#39;</span><span class="p">,</span><span class="s">&#39;bottom&#39;</span><span class="p">]:</span>
                 <span class="n">spine</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;none&#39;</span><span class="p">)</span> <span class="c"># don&#39;t draw spine</span>
                 <span class="n">sp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
              <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unknown spine location: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">loc</span><span class="p">)</span>



        <span class="c"># no xaxis ticks</span>
        <span class="c">#ax.xaxis.set_ticks([])</span>
    <span class="c">#sp.spines[&#39;left&#39;].set_position(&#39;center&#39;)</span>
        <span class="c">#sp.spines[&#39;left&#39;].set_color(&#39;none&#39;)</span>
    <span class="c">#sp.spines[&#39;right&#39;].set_position(&#39;center&#39;)</span>
        <span class="c">#sp.spines[&#39;right&#39;].set_color(&#39;none&#39;)</span>
    <span class="c">#sp.spines[&#39;bottom&#39;].set_position(&#39;center&#39;)</span>
    <span class="c">#sp.xaxis.set_ticks_position(&#39;bottom&#39;)</span>
    <span class="c">#sp.yaxis.set_ticks_position(&#39;left&#39;)</span>
        <span class="c">#sp.spines[&#39;bottom&#39;].set_color(&#39;none&#39;)</span>
    <span class="c">#sp.spines[&#39;top&#39;].set_position(&#39;center&#39;)</span>
        <span class="c">#sp.spines[&#39;top&#39;].set_color(&#39;none&#39;)</span>
    <span class="c">#</span>
    <span class="c"># Rooms annotation</span>
    <span class="c">#</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 8&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">19</span><span class="p">,</span><span class="mf">14.1</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 9&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">24.5</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 14&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 10&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">16.5</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 7&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span><span class="mf">14.1</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 11&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">13.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 12&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">8.7</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 13&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">5.2</span><span class="p">,</span><span class="mf">14.5</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 1&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 2&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">13.8</span><span class="p">))</span>
    <span class="n">annotate</span><span class="p">(</span><span class="s">&#39;R 6&#39;</span><span class="p">,</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">3.6</span><span class="p">,</span><span class="mf">6.5</span><span class="p">))</span>
  

    <span class="n">n</span><span class="o">=</span><span class="n">scatter</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;o&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">Values</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s">&#39;face&#39;</span><span class="p">)</span>
<span class="c">#    m=scatter(vxd,vyd,marker=&#39;o&#39;,c=&#39;k&#39;,s=size)</span>
<span class="c">#    m.set_edgecolor(&#39;face&#39;)</span>
    <span class="n">axis</span><span class="p">(</span><span class="s">&#39;scaled&#39;</span><span class="p">)</span>
    <span class="n">title</span><span class="p">(</span><span class="n">tit</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;meters&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span><span class="p">:</span>
        <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;meters&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">colbar</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">=</span><span class="n">colorbar</span><span class="p">(</span><span class="n">orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="cdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.multiwall.cdf.html#pylayers.antprop.multiwall.cdf">[docs]</a><span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">colsym</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Plot the cumulative density function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.fontsize&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">20</span>
    <span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">20</span>

    <span class="n">x</span>  <span class="o">=</span> <span class="n">sort</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">n</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">repeat</span><span class="p">(</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">colsym</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
<span class="c">#    plt.semilogx(x2,y2,colsym,label=lab,linewidth=lw)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
    <span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Ranging Error[m]&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Cumulative Probability&#39;</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, PyLayers developer team.
      Last updated on mars 20, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_setDomainName', 'pylayers.github.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })(); 
</script> 
 
  </body>
</html>