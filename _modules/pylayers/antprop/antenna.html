

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.antprop.antenna &mdash; PyLayers</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="PyLayers" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html">1&nbsp;&nbsp;&nbsp;pylayers.util.project Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.layout">2&nbsp;&nbsp;&nbsp;pylayers.gis.layout Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.selectl">3&nbsp;&nbsp;&nbsp;pylayers.gis.selectl Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.srtm">4&nbsp;&nbsp;&nbsp;pylayers.gis.srtm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.osmparser">5&nbsp;&nbsp;&nbsp;pylayers.gis.osmparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.ezone">6&nbsp;&nbsp;&nbsp;pylayers.gis.ezone Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antenna">7&nbsp;&nbsp;&nbsp;pylayers.antprop.antenna Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.aarray">8&nbsp;&nbsp;&nbsp;pylayers.antprop.aarray Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.spharm">9&nbsp;&nbsp;&nbsp;pylayers.antprop.spharm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antssh">10&nbsp;&nbsp;&nbsp;pylayers.antprop.antssh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antvsh">11&nbsp;&nbsp;&nbsp;pylayers.antprop.antvsh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.slab">12&nbsp;&nbsp;&nbsp;pylayers.antprop.slab Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.signature">13&nbsp;&nbsp;&nbsp;pylayers.antprop.signature Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.interactions">14&nbsp;&nbsp;&nbsp;pylayers.antprop.interactions Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffraction">15&nbsp;&nbsp;&nbsp;pylayers.antprop.diffraction Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffRT">16&nbsp;&nbsp;&nbsp;pylayers.antprop.diffRT Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.rays">17&nbsp;&nbsp;&nbsp;pylayers.antprop.rays Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.loss">18&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.channel">19&nbsp;&nbsp;&nbsp;pylayers.antprop.channel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id39">20&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coverage">21&nbsp;&nbsp;&nbsp;pylayers.antprop.coverage Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coeffModel">22&nbsp;&nbsp;&nbsp;pylayers.antprop.coeffModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.link">23&nbsp;&nbsp;&nbsp;pylayers.simul.link Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit">24&nbsp;&nbsp;&nbsp;pylayers.simul.exploit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit_simulnet">25&nbsp;&nbsp;&nbsp;pylayers.simul.exploit_simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simulnet">26&nbsp;&nbsp;&nbsp;pylayers.simul.simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simultraj">27&nbsp;&nbsp;&nbsp;pylayers.simul.simultraj Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.exploit.simnet">28&nbsp;&nbsp;&nbsp;pylayers.exploit.simnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesuwb">29&nbsp;&nbsp;&nbsp;pylayers.measures.mesuwb Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesmimo">30&nbsp;&nbsp;&nbsp;pylayers.measures.mesmimo Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.cormoran">31&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.vna.E5072A">32&nbsp;&nbsp;&nbsp;pylayers.measures.vna.E5072A Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.parker.smparker">33&nbsp;&nbsp;&nbsp;pylayers.measures.parker.smparker Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.agent">34&nbsp;&nbsp;&nbsp;pylayers.mobility.agent Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>pylayers.antprop.antenna</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.antprop.antenna</h1><div class="highlight"><pre>
<span></span><span class="c1">#-*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. currentmodule:: pylayers.antprop.antenna</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :members:</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">PIL.Image</span> <span class="kn">as</span> <span class="nn">Image</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">mayavi.mlab</span> <span class="kn">as</span> <span class="nn">mlab</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.spharm</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pylayers.antprop.antvsh</span> <span class="kn">import</span> <span class="n">vsh</span> 
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.antssh</span> <span class="kn">import</span> <span class="n">ssh</span><span class="p">,</span><span class="n">SSHFunc2</span><span class="p">,</span> <span class="n">SSHFunc</span><span class="p">,</span> <span class="n">SSHCoeff</span><span class="p">,</span> <span class="n">CartToSphere</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.coeffModel</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span> <span class="c1"># colormaps</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">sici</span> <span class="p">,</span> <span class="n">fresnel</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<div class="viewcode-block" id="Pattern"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern">[docs]</a><span class="k">class</span> <span class="nc">Pattern</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class Pattern</span>

<span class="sd">    MetaClass of Antenna</span>

<span class="sd">    A pattern is evaluated with the 3 np.array parameters</span>

<span class="sd">    theta</span>
<span class="sd">    phi</span>
<span class="sd">    fGHz</span>

<span class="sd">    This class implements pattern methods.</span>
<span class="sd">    The name of a pattern method starts by p.</span>
<span class="sd">    Each pattern method has a unique dictionnary argument &#39;param&#39;</span>

<span class="sd">    If self.grid dimensions are</span>
<span class="sd">        Nt x Np x Nf</span>
<span class="sd">    else:</span>
<span class="sd">        Ndir x Nf</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PyLayers</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Antenna type : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">st</span><span class="p">)</span>

<div class="viewcode-block" id="Pattern.eval"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  evaluate pattern functions</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        th: list </span>
<span class="sd">            []</span>
<span class="sd">        ph: list </span>
<span class="sd">            []</span>
<span class="sd">        pt : np.array (3,N)</span>
<span class="sd">        pr : np.array (3,N)</span>
<span class="sd">        azoffset : int (0) </span>
<span class="sd">        Rfloor:bool</span>
<span class="sd">            if true add gain value to reflected ray on the floor. </span>
<span class="sd">            values are append at the end of sqG.</span>
<span class="sd">        fGHz:list </span>
<span class="sd">            []</span>
<span class="sd">        nth: int </span>
<span class="sd">            90</span>
<span class="sd">        nph: int </span>
<span class="sd">            181</span>
<span class="sd">        first: boolean </span>
<span class="sd">            True if first call (to define self.param)</span>
<span class="sd">        grid:  boolean </span>
<span class="sd">            True for pattern mode, False for Ray Tracing mode</span>
<span class="sd">        th0 : float </span>
<span class="sd">            theta initial value</span>
<span class="sd">        th1 : float </span>
<span class="sd">            theta finale value</span>
<span class="sd">        ph0 : float </span>
<span class="sd">            phi initial value</span>
<span class="sd">        ph1 : float </span>
<span class="sd">            phi final value</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>



<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.aarray import *</span>
<span class="sd">        &gt;&gt;&gt; A0=Antenna(&#39;Omni&#39;,param={&#39;pol&#39;:&#39;t&#39;,&#39;GmaxdB&#39;:0})</span>
<span class="sd">        &gt;&gt;&gt; A1=Antenna(&#39;Gauss&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A2=Antenna(&#39;3gpp&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A3=ULArray()</span>
<span class="sd">        &gt;&gt;&gt; A0.eval()</span>
<span class="sd">        &gt;&gt;&gt; A1.eval()</span>
<span class="sd">        &gt;&gt;&gt; A2.eval()</span>
<span class="sd">        &gt;&gt;&gt; #A3.eval()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Rfloor&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;nth&#39;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span>
                    <span class="s1">&#39;nph&#39;</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span>
                    <span class="s1">&#39;grid&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;th0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;th1&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                    <span class="s1">&#39;ph0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;ph1&#39;</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                    <span class="s1">&#39;azoffset&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;inplace&#39;</span><span class="p">:</span><span class="bp">True</span>
                   <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="k">if</span> <span class="s1">&#39;fGHz&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;fGHz&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># if th and ph are empty </span>
        <span class="c1">#    if pt and pr are empty </span>
        <span class="c1">#          calculates from th0,th1,nth </span>
        <span class="c1">#                           ph0,phi,nph</span>
        <span class="c1">#    else</span>
        <span class="c1">#          calculates from points coordinates pt and pr</span>
        <span class="c1"># else</span>
        <span class="c1">#     take specified values</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;th&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;ph&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;pt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;pr&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;th0&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;th1&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nth&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ph0&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ph1&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nph&#39;</span><span class="p">],</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_evaluated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">si</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pt&#39;</span><span class="p">]</span>
                <span class="n">ssi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">si</span><span class="o">*</span><span class="n">si</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="n">si</span><span class="o">/</span><span class="n">ssi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">sn</span><span class="p">[</span><span class="mi">2</span><span class="p">,:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">sn</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span><span class="n">sn</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;azoffset&#39;</span><span class="p">],</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_evaluated</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Rfloor&#39;</span><span class="p">]:</span>
                    <span class="n">dR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ssi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pt&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1">#  reflexion length</span>
                    <span class="n">thetaR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">((</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pt&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,:])</span> <span class="o">/</span> <span class="n">dR</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span><span class="n">thetaR</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">])</span>
                    
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">])</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ph&#39;</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ph&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_evaluated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;azel&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">360</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_evaluated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># evaluation of the specific Pattern__p function </span>
        <span class="c1">#</span>
        <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self._Pattern__p&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)(</span><span class="n">param</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inplace&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span></div>
        
<div class="viewcode-block" id="Pattern.vsh"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.vsh">[docs]</a>    <span class="k">def</span> <span class="nf">vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">s1tos2</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">s2tos3</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span></div>

<div class="viewcode-block" id="Pattern.ssh"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.ssh">[docs]</a>    <span class="k">def</span> <span class="nf">ssh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="mi">89</span><span class="p">,</span><span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">ssh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">dsf</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__pdipole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dipole antenna along z axis </span>

<span class="sd">        From Balanis (Formula 4.62(a)) </span>
<span class="sd">        </span>
<span class="sd">        .. math:: </span>
<span class="sd">        </span>
<span class="sd">            F_{\theta}(\theta,\phi) = \left[  \frac{\cos\left(\frac{kl}{2}\cos\theta\right)- \cos\left(\frac{kl}{2}\right)}{\sin \theta} \right] </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;param&#39;</span> <span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;l&#39;</span> <span class="p">:</span> <span class="mf">0.25</span> <span class="p">}</span> <span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        
        <span class="n">l</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1"># Nth x Nphx Nf</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">/</span><span class="mf">0.3</span>
            <span class="n">usmall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">&lt;=</span><span class="mf">1e-1</span>
            <span class="n">Ft</span>  <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">])</span>
            <span class="n">Ft</span><span class="p">[</span><span class="n">usmall</span><span class="p">,:,:]</span>   <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">usmall</span><span class="p">][:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span> <span class="o">/</span><span class="mf">0.3</span>
            <span class="n">usmall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">&lt;=</span><span class="mf">1e-1</span>
            <span class="n">Ft</span>  <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span>
            <span class="n">Ft</span><span class="p">[</span><span class="n">usmall</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">usmall</span><span class="p">][:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># Nd x Nf</span>

        <span class="n">Fp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pOmni</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  omnidirectional pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        param : dict </span>
<span class="sd">            dictionnary of parameters</span>
<span class="sd">            + pol : string </span>
<span class="sd">                &#39;t&#39;| &#39;p&#39;</span>
<span class="sd">            + GmaxdB : float</span>
<span class="sd">                0</span>


<span class="sd">        self.grid is used for switching between : </span>

<span class="sd">          if True   angular grid : nth x nph x nf</span>
<span class="sd">          if False  direction    : ndir x nf</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;param&#39;</span> <span class="p">:</span> <span class="p">{</span> <span class="s1">&#39;pol&#39;</span> <span class="p">:</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;GmaxdB&#39;</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GmaxdB</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pol</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span>
        <span class="n">G</span>    <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GmaxdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span> <span class="c1"># linear gain</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1"># Nth x Nphx Nf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Nd x Nf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radF</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>


    <span class="k">def</span> <span class="nf">__paperture</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Aperture Pattern </span>

<span class="sd">        Aperture in the (x,y) plane. Main lobe in theta=0 direction</span>

<span class="sd">        polar indicates the orientation of the Electric field either &#39;x&#39; or &#39;y&#39;</span>
<span class="sd">       </span>
<span class="sd">        See theoretical background in : </span>

<span class="sd">        http://www.ece.rutgers.edu/~orfanidi/ewa/ch18.pdf</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        HPBW_x_deg : float </span>
<span class="sd">            Half Power Beamwidth (degrees)</span>
<span class="sd">        HPBW_y_deg : float </span>
<span class="sd">            Half Power Beamwidth (degrees)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;HPBW_x_deg&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span>
                              <span class="s1">&#39;HPBW_y_deg&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                              <span class="s1">&#39;Gfactor&#39;</span><span class="p">:</span><span class="mi">27000</span><span class="p">,</span>
                              <span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span> <span class="mf">27.5</span><span class="p">,</span>
                              <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;window&#39;</span><span class="p">:</span><span class="s1">&#39;rect&#39;</span>
                             <span class="p">}}</span>
        
        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="n">deg_to_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">ld_c</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">ld</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">Dx</span> <span class="o">=</span> <span class="mf">0.886</span><span class="o">*</span><span class="n">ld_c</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;HPBW_x_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">deg_to_rad</span><span class="p">)</span>
        <span class="n">Dy</span> <span class="o">=</span> <span class="mf">0.886</span><span class="o">*</span><span class="n">ld_c</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;HPBW_y_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">deg_to_rad</span><span class="p">)</span>
        <span class="n">Dx_n</span> <span class="o">=</span> <span class="n">Dx</span><span class="o">/</span><span class="n">ld</span>
        <span class="n">Dy_n</span> <span class="o">=</span> <span class="n">Dy</span><span class="o">/</span><span class="n">ld</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span> 
            <span class="c1"># Nth x Nph x Nf</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ndir x Nf </span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
        
        <span class="n">vx</span> <span class="o">=</span> <span class="n">Dx_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.1.4</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">Dy_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.1.4</span>

        <span class="n">F_nor</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">vx</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">vy</span><span class="p">))</span>
        <span class="n">HPBW_x</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.886</span><span class="o">*</span><span class="n">ld</span><span class="o">/</span><span class="n">Dx</span><span class="p">)</span><span class="o">/</span><span class="n">deg_to_rad</span>
        <span class="n">HPBW_y</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.886</span><span class="o">*</span><span class="n">ld</span><span class="o">/</span><span class="n">Dy</span><span class="p">)</span><span class="o">/</span><span class="n">deg_to_rad</span>
        <span class="n">Gmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Gfactor&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">HPBW_x</span><span class="o">*</span><span class="n">HPBW_y</span><span class="p">)</span>
        <span class="n">F</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="o">...</span><span class="p">,:])</span><span class="o">*</span><span class="n">F_nor</span> <span class="c1"># Ndir x Nf </span>

        <span class="c1"># Handling repartition on both vector components</span>
        <span class="c1"># enforce E.y = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 
        <span class="c1"># enforce E.x = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 
        <span class="c1"># enforce E.x = 0 </span>
        <span class="c1">#</span>
        <span class="c1"># This is experimental </span>
        <span class="c1"># How to apply the 2D windowing properly ?</span>
        <span class="c1">#</span>
<span class="c1">#        if self.param[&#39;window&#39;]!=&#39;rect&#39;:</span>
<span class="c1">#            Nt = self.Fp.shape[0] </span>
<span class="c1">#            Np = self.Fp.shape[1] </span>
<span class="c1">#            Wp = np.fft.ifftshift(np.hamming(Nt)[:,None]*np.ones(Np)[None,:])[:,:,None]</span>
<span class="c1">#            Wt = np.fft.ifftshift(np.ones(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            Wu = np.fft.ifftshift(np.ones(Nt)[:,None]*np.ones(Np)[None,:])[:,:,None] </span>
<span class="c1">#            Wi = np.fft.ifftshift(np.hamming(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            W = np.fft.fftshift(np.hamming(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            # Fp : t x p x f   ou r x f </span>
<span class="c1">#            # Ft : t x p x f   ou r x f </span>
<span class="c1">#</span>
<span class="c1">#            Kp = np.fft.ifft2(self.Fp,axes=(0,1))</span>
<span class="c1">#            Kt = np.fft.ifft2(self.Ft,axes=(0,1))</span>
<span class="c1">#            </span>
<span class="c1">#            self.Fp = np.fft.fft2(Kp*Wt,axes=(0,1))</span>
<span class="c1">#            self.Ft = np.fft.fft2(Kt*Wp,axes=(0,1))</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__paperture2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Aperture Pattern </span>

<span class="sd">        Aperture in the (x,y) plane. Main lobe in theta=0 direction</span>

<span class="sd">        polar indicates the orientation of the Electric field either &#39;x&#39; or &#39;y&#39;</span>
<span class="sd">       </span>
<span class="sd">        See theoretical background in : </span>

<span class="sd">        http://www.ece.rutgers.edu/~orfanidi/ewa/ch18.pdf</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        HPBW_x_deg : float </span>
<span class="sd">            Half Power Beamwidth (degrees)</span>
<span class="sd">        HPBW_y_deg : float </span>
<span class="sd">            Half Power Beamwidth (degrees)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;HPBW_a_deg&#39;</span><span class="p">:</span><span class="mi">40</span><span class="p">,</span>
                              <span class="s1">&#39;HPBW_b_deg&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                              <span class="s1">&#39;Gfactor&#39;</span><span class="p">:</span><span class="mi">27000</span><span class="p">,</span>
                              <span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span> <span class="mf">27.5</span><span class="p">,</span>
                              <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;window&#39;</span><span class="p">:</span><span class="s1">&#39;rect&#39;</span>
                             <span class="p">}}</span>
        
        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="n">deg_to_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">ld_c</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">ld</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.189</span><span class="o">*</span><span class="n">ld_c</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;HPBW_a_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">deg_to_rad</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mf">0.886</span><span class="o">*</span><span class="n">ld_c</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;HPBW_b_deg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">deg_to_rad</span><span class="p">)</span>
        <span class="n">a_n</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">ld</span>
        <span class="n">b_n</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">ld</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span> 
            <span class="c1"># Nth x Nph x Nf</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ndir x Nf </span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
        
        <span class="n">vx</span> <span class="o">=</span> <span class="n">a_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.1.4</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">b_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.1.4</span>

        <span class="c1">#F_nor = ((1+np.cos(theta))/2.)*np.abs(np.sinc(vx)*np.sinc(vy))</span>
        <span class="n">F_nor</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">vx</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">vx</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span> <span class="c1"># 18.1.3 + suppression rear radiation</span>

        <span class="n">HPBW_a</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.189</span><span class="o">*</span><span class="n">ld</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">deg_to_rad</span>
        <span class="n">HPBW_b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.886</span><span class="o">*</span><span class="n">ld</span><span class="o">/</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">deg_to_rad</span>
        <span class="n">Gmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Gfactor&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">HPBW_a</span><span class="o">*</span><span class="n">HPBW_b</span><span class="p">)</span>
        <span class="n">F</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="o">...</span><span class="p">,:])</span><span class="o">*</span><span class="n">F_nor</span> <span class="c1"># Ndir x Nf </span>

        <span class="c1"># Handling repartition on both vector components</span>
        <span class="c1"># enforce E.y = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 
        <span class="c1"># enforce E.x = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 
        <span class="c1"># enforce E.x = 0 </span>
        <span class="c1">#</span>
        <span class="c1"># This is experimeintal </span>
        <span class="c1"># How to apply the 2D windowing properly ?</span>
        <span class="c1">#</span>
<span class="c1">#        if self.param[&#39;window&#39;]!=&#39;rect&#39;:</span>
<span class="c1">#            Nt = self.Fp.shape[0] </span>
<span class="c1">#            Np = self.Fp.shape[1] </span>
<span class="c1">#            Wp = np.fft.ifftshift(np.hamming(Nt)[:,None]*np.ones(Np)[None,:])[:,:,None]</span>
<span class="c1">#            Wt = np.fft.ifftshift(np.ones(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            Wu = np.fft.ifftshift(np.ones(Nt)[:,None]*np.ones(Np)[None,:])[:,:,None] </span>
<span class="c1">#            Wi = np.fft.ifftshift(np.hamming(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            W = np.fft.fftshift(np.hamming(Nt)[:,None]*np.hamming(Np)[None,:])[:,:,None] </span>
<span class="c1">#            # Fp : t x p x f   ou r x f </span>
<span class="c1">#            # Ft : t x p x f   ou r x f </span>
<span class="c1">#</span>
<span class="c1">#            Kp = np.fft.ifft2(self.Fp,axes=(0,1))</span>
<span class="c1">#            Kt = np.fft.ifft2(self.Ft,axes=(0,1))</span>
<span class="c1">#            </span>
<span class="c1">#            self.Fp = np.fft.fft2(Kp*Wt,axes=(0,1))</span>
<span class="c1">#            self.Ft = np.fft.fft2(Kt*Wp,axes=(0,1))</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__phplanesectoralhorn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; H plane sectoral horn </span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        rho1 : float </span>
<span class="sd">            sector radius (meter)</span>
<span class="sd">        a1 : float</span>
<span class="sd">            aperture dimension along x (greatest value in meters)</span>
<span class="sd">        b1 : float </span>
<span class="sd">            aperture dimension along y (greatest value in meters) </span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Maximum gain in theta =0 </span>
<span class="sd">        Polarized along y axis (Jx=0,Jz=0)  </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rho1&#39;</span><span class="p">:</span><span class="mf">0.198</span><span class="p">,</span>
                              <span class="s1">&#39;a1&#39;</span><span class="p">:</span><span class="mf">0.088</span><span class="p">,</span>  <span class="c1"># aperture dimension along x</span>
                              <span class="s1">&#39;b1&#39;</span><span class="p">:</span><span class="mf">0.0126</span><span class="p">,</span> <span class="c1"># aperture dimension along y </span>
                              <span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span>
                              <span class="s1">&#39;GcmaxdB&#39;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span>
                              <span class="s1">&#39;Nx&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                              <span class="s1">&#39;Ny&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">}}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        <span class="c1">#H-plane antenna</span>
        <span class="n">rho1</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;rho1&#39;</span><span class="p">]</span>
        <span class="n">a1</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;a1&#39;</span><span class="p">]</span>
        <span class="n">b1</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;b1&#39;</span><span class="p">]</span>
        <span class="n">Nx</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Nx&#39;</span><span class="p">]</span>
        <span class="n">Ny</span>              <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ny&#39;</span><span class="p">]</span>
        <span class="n">fcGHz</span>           <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">GcmaxdB</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;GcmaxdB&#39;</span><span class="p">]</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">a1</span><span class="o">&gt;</span><span class="n">b1</span><span class="p">),</span> <span class="s2">&quot;a1 should be greater than b1 (see fig 13.1O(a) Balanis&quot;</span>

        <span class="n">lbda</span>   <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">k</span>      <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lbda</span>
        <span class="n">eta0</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span><span class="o">/</span><span class="mf">8.85429e-12</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1"># X,Y aperture points (t,p,x,y,f)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">a1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">a1</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">b1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">b1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">b1</span><span class="o">/</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="c1"># angular domain (theta,phi)</span>
            <span class="n">Theta</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># X,Y aperture points (r,x,y,f)</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">a1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">a1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">a1</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">b1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">b1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">b1</span><span class="o">/</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="c1"># angular domain (theta,phi)</span>
            <span class="n">Theta</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Phi</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>


        <span class="c1">#% Aperture field Ea:</span>
        <span class="c1"># Ea is an approximation of the aperture field:</span>
        <span class="c1"># (from: C. A. Balanis, Antenna Theoy: Analysis and Design. New York</span>
        <span class="c1"># Wiley, 1982. ... Section 13.3.1 )</span>

        <span class="n">Ea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">X</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">a1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-.</span><span class="mi">5</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">((</span><span class="n">X</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rho1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rho1</span><span class="p">)))</span>
        <span class="n">Jy</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ea</span><span class="o">/</span><span class="n">eta0</span>
        <span class="n">Mx</span> <span class="o">=</span> <span class="n">Ea</span>

        <span class="c1"># cosine direction</span>
        <span class="n">ctsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
        <span class="n">ctcp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> 
        <span class="n">stcp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
        <span class="n">stsp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span>
        <span class="c1"># N &amp; L</span>
        <span class="n">ejkrrp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span> <span class="n">X</span><span class="o">*</span><span class="n">stcp</span> <span class="o">+</span> <span class="n">Y</span><span class="o">*</span><span class="n">stsp</span><span class="p">))</span>        <span class="c1"># exp(jk (r.r&#39;))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">N_theta</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;tpnmf-&gt;tpf&#39;</span><span class="p">,</span><span class="n">Jy</span><span class="o">*</span><span class="n">ctsp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span> <span class="c1"># 12-12 a assuming Jx,Jz=0</span>
            <span class="n">N_phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;tpnmf-&gt;tpf&#39;</span><span class="p">,</span><span class="n">Jy</span><span class="o">*</span><span class="n">cp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span>   <span class="c1"># 12-12 b &quot;&quot;</span>
            <span class="n">L_theta</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;tpnmf-&gt;tpf&#39;</span><span class="p">,</span><span class="n">Mx</span><span class="o">*</span><span class="n">ctcp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span> <span class="c1"># 12-12 c assuming My,Mz=0 </span>
            <span class="n">L_phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;tpnmf-&gt;tpf&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="n">sp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span>  <span class="c1"># 12-12 d &quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N_theta</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;rnmf-&gt;rf&#39;</span><span class="p">,</span><span class="n">Jy</span><span class="o">*</span><span class="n">ctsp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span> <span class="c1"># 12-12 a assuming Jx,Jz=0</span>
            <span class="n">N_phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;rnmf-&gt;rf&#39;</span><span class="p">,</span><span class="n">Jy</span><span class="o">*</span><span class="n">cp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span>   <span class="c1"># 12-12 b &quot;&quot;</span>
            <span class="n">L_theta</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;rnmf-&gt;rf&#39;</span><span class="p">,</span><span class="n">Mx</span><span class="o">*</span><span class="n">ctcp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span> <span class="c1"># 12-12 c assuming My,Mz=0 </span>
            <span class="n">L_phi</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;rnmf-&gt;rf&#39;</span><span class="p">,</span><span class="o">-</span><span class="n">Mx</span><span class="o">*</span><span class="n">sp</span><span class="o">*</span><span class="n">ejkrrp</span><span class="p">)</span>  <span class="c1"># 12-12 d &quot;&quot;</span>


        <span class="c1"># Far-Field</span>
        <span class="n">Ft</span>  <span class="o">=</span> <span class="o">-</span><span class="n">L_phi</span>  <span class="o">-</span> <span class="n">eta0</span><span class="o">*</span><span class="n">N_theta</span> <span class="c1"># 12-10b p 661</span>
        <span class="n">Fp</span>  <span class="o">=</span> <span class="n">L_theta</span> <span class="o">-</span> <span class="n">eta0</span><span class="o">*</span><span class="n">N_phi</span>   <span class="c1"># 12-10c p 661 </span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ft</span><span class="p">)</span><span class="o">+</span><span class="n">Fp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1"># Umax : ,f </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Umax</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Umax</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Umax</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="c1"># centered frequency range</span>
            <span class="n">fcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="o">-</span><span class="n">fcGHz</span><span class="p">)</span>
            <span class="n">idxc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fcc</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fcc</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> 
            <span class="c1"># Gain @ center frequency </span>
            <span class="c1">#G = _gain(Ft[:,:,idxc],Fp[:,:,idxc])</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">_gain</span><span class="p">(</span><span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span><span class="p">)</span>
            <span class="c1"># effective half power beamwidth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hpster</span>  <span class="o">=</span> <span class="n">_hpbw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Gfactor</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">GcmaxdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="p">[</span><span class="n">idxc</span><span class="p">]</span>
            <span class="n">Gmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gfactor</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="n">Fp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">##</span>
            <span class="c1">## Ft (r x f ) </span>
            <span class="c1">## Fp (r x f ) </span>
            <span class="c1">##</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Umax</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Umax</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">Gmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Gfactor</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span><span class="o">*</span><span class="n">Fp</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__phorn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Horn antenna </span>


<span class="sd">        http://www.ece.rutgers.edu/~orfanidi/ewa/ch18.pdf (18.2) </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">            Half Power Beamwidth (degrees)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sigma_a&#39;</span><span class="p">:</span><span class="mf">1.2593</span><span class="p">,</span>
                              <span class="s1">&#39;sigma_b&#39;</span><span class="p">:</span><span class="mf">1.0246</span><span class="p">,</span>
                              <span class="s1">&#39;A_wl&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span>
                              <span class="s1">&#39;B_wl&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                              <span class="s1">&#39;fcGHz&#39;</span><span class="p">:</span><span class="mf">28.</span><span class="p">,</span>
                              <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="s1">&#39;x&#39;</span>
                             <span class="p">}}</span>
        
        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="n">deg_to_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">ld_c</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]</span>
        <span class="n">ld</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
        <span class="n">A_wl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;A_wl&#39;</span><span class="p">]</span>
        <span class="n">B_wl</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;B_wl&#39;</span><span class="p">]</span>

        <span class="n">A</span> <span class="o">=</span> <span class="n">A_wl</span><span class="o">*</span><span class="n">ld_c</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">B_wl</span><span class="o">*</span><span class="n">ld_c</span>
        <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_a&#39;</span><span class="p">]</span>
        <span class="n">sigma_b</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;sigma_b&#39;</span><span class="p">]</span>
        <span class="c1">#b = kwargs[&#39;param&#39;][&#39;b&#39;]</span>
        <span class="c1">#Ra = (A/(A-a))*RA</span>
        <span class="c1">#Rb = (B/(B-b))*RB</span>
        <span class="c1">#La = np.sqrt(Ra**2+A**2/4)</span>
        <span class="c1">#Lb = np.sqrt(Rb**2+B**2/4)</span>
        <span class="c1">#alpha = np.arctan(A/(2*Ra))</span>
        <span class="c1">#beta = np.arctan(B/(2*Rb))</span>
        <span class="c1">#Delta_a = A**2/(8*Ra)</span>
        <span class="c1">#Delta_b = B**2/(8*Rb)</span>
        <span class="c1">#sigma_a = A/np.sqrt((2*ld*Ra))</span>
        <span class="c1">#sigma_b = B/np.sqrt((2*ld*Rb))</span>
        <span class="n">A_n</span> <span class="o">=</span> <span class="n">A</span><span class="o">/</span><span class="n">ld</span>
        <span class="n">B_n</span> <span class="o">=</span> <span class="n">B</span><span class="o">/</span><span class="n">ld</span>



        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span> 
            <span class="c1"># Nth x Nph x Nf</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Ndir x Nf </span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
        
        <span class="n">vx</span> <span class="o">=</span> <span class="n">A_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.3.4</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">B_n</span><span class="p">[</span><span class="o">...</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="c1"># 18.3.4</span>

        <span class="n">F</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">F1</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">sigma_a</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">))</span>
        <span class="n">normF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">F1</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma_a</span><span class="p">)</span><span class="o">*</span><span class="n">F0</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma_b</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>  
        <span class="n">F_nor</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">normF</span><span class="p">)</span>
        <span class="n">efficiency</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="n">normF</span> <span class="c1"># 18.4.3</span>
        <span class="n">Gmax</span> <span class="o">=</span> <span class="n">efficiency</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="o">/</span><span class="n">ld</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">F</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">[</span><span class="o">...</span><span class="p">,:])</span><span class="o">*</span><span class="n">F_nor</span> <span class="c1"># Ndir x Nf </span>

        <span class="c1"># Handling repatition on both vector components</span>
        <span class="c1"># enforce E.y = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 
        <span class="c1"># enforce E.x = 0 </span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">F</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span><span class="o">*</span><span class="n">Ft</span>
            <span class="n">nan_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
            <span class="n">Fp</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">nan_bool</span><span class="p">]</span> 

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> 

    <span class="k">def</span> <span class="nf">__pazel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Azimuth Elevation pattern from file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename : ANT filename</span>

<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;filename&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;V&#39;</span><span class="p">}}</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span>
        <span class="n">Gthetaphi</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">Gthetaphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Gthetaphi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        <span class="n">Gaz</span> <span class="o">=</span> <span class="n">Gthetaphi</span><span class="p">[</span><span class="mi">360</span><span class="p">:]</span>
        <span class="n">Gel</span> <span class="o">=</span> <span class="n">Gthetaphi</span><span class="p">[:</span><span class="mi">360</span><span class="p">]</span>

        <span class="n">sqGazlin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">Gaz</span><span class="o">/</span><span class="mf">10.</span><span class="p">))</span>
        <span class="n">sqGellin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">Gel</span><span class="o">/</span><span class="mf">10.</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="p">:</span>
            <span class="c1"># Nth x Nph x Nf</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;V&#39;</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="c1">#Ft[180,:] = sqGazlin[:,None]</span>
                <span class="c1">#Ft[:,180] = sqGellin[:,None]</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">sqGazlin</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">sqGellin</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;H&#39;</span><span class="p">:</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">sqGazlin</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">sqGellin</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
                <span class="c1">#self.Fp[180,:]= sqGazlin[:,None]</span>
                <span class="c1">#self.Fp[:,180]= sqGellin[:,None]</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">][</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;45&#39;</span><span class="p">:</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                <span class="c1"># Azimuth</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sqGazlin</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">sqGellin</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sqGazlin</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">sqGellin</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
                <span class="c1">#self.Fp[180,:]= sqGazlin[:,None]</span>
                <span class="c1">#self.Fp[180,:]= (1/sqrt(2))*sqGazlin[:,None]</span>
                <span class="c1">#Ft[180,:]= (1/sqrt(2))*sqGazlin[:,None]</span>
                <span class="c1"># Elevation</span>
                <span class="c1">#self.Fp[:,180]= (1/sqrt(2))*sqGellin[:,None]</span>
                <span class="c1">#Ft[:,180]= (1/sqrt(2))*sqGellin[:,None]</span>

            <span class="c1">#Ft = sqGthlin[:,None,None]</span>
            <span class="c1">#self.Fp = sqGphlin[None,:,None]</span>
            <span class="c1"># Ft = self.sqGmax * ( np.exp(-2.76*argth[:,None,None]) * np.exp(-2.76*argphi[None,:,None]) )</span>
            <span class="c1"># self.Fp = self.sqGmax * ( np.exp(-2.76*argth[:,None,None]) * np.exp(-2.76*argphi[None,:,None]) )</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># #</span>
            <span class="c1"># #  Nd x Nf</span>
            <span class="c1"># #</span>
            <span class="c1"># Ft = self.sqGmax * ( np.exp(-2.76*argth) * np.exp(-2.76*argphi) )</span>
            <span class="c1"># Fp = self.sqGmax * ( np.exp(-2.76*argth) * np.exp(-2.76*argphi) )</span>
            <span class="c1"># # add frequency axis (Ndir x Nf)</span>
            <span class="c1"># Ft = np.dot(Ft[:,None],np.ones(len(self.fGHz))[None,:])</span>
            <span class="c1"># self.Fp = np.dot(Fp[:,None],np.ones(len(self.fGHz))[None,:])</span>
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>


    <span class="k">def</span> <span class="nf">__pGauss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gauss pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p0 : phi main lobe (0-2pi)</span>
<span class="sd">        p3 : 3dB aperture angle</span>
<span class="sd">        t0 : theta main lobe (0-pi)</span>
<span class="sd">        t3 : 3dB aperture angle</span>

<span class="sd">        TODO : finish implementation of polar</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;p0&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;t0&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;p3&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span>
                    <span class="s1">&#39;t3&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span>
                    <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;th&#39;</span>
                   <span class="p">}}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;Gauss&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="n">p0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p3&#39;</span><span class="p">]</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]</span>
        <span class="n">pol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Gmax</span> <span class="o">=</span> <span class="mi">16</span><span class="o">/</span><span class="p">(</span><span class="n">t3</span><span class="o">*</span><span class="n">p3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gmax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqGmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Gmax</span><span class="p">)</span>

        <span class="n">argth</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">t3</span>

        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">-</span><span class="n">p0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">p0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)))</span>
        <span class="n">argphi</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">p3</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="p">:</span>
            <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="c1"># Nth x Nph x Nf</span>
            <span class="c1"># Ft = self.sqGmax * ( np.exp(-2.76*argth[:,None,None]) * np.exp(-2.76*argphi[None,:,None]) )</span>
            <span class="c1"># self.Fp = self.sqGmax * ( np.exp(-2.76*argth[:,None,None]) * np.exp(-2.76*argphi[None,:,None]) )</span>
            <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s1">&#39;th&#39;</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">])</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">,</span><span class="n">Nf</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s1">&#39;ph&#39;</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">,</span><span class="n">Nf</span><span class="p">))</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">])</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1">#  Nd x Nf</span>
            <span class="c1">#</span>
            <span class="n">Nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span><span class="o">==</span><span class="n">Nd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s1">&#39;th&#39;</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pol</span><span class="o">==</span><span class="s1">&#39;ph&#39;</span><span class="p">:</span>
                <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nd</span><span class="p">)</span>
                <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">)</span> <span class="p">)</span>
            <span class="c1"># add frequency axis (Ndir x Nf)</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ft</span><span class="p">[:,</span><span class="bp">None</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fp</span><span class="p">[:,</span><span class="bp">None</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:])</span>
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__p3gpp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 3GPP antenna pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        thtilt : theta tilt antenna</span>
<span class="sd">        hpbwv  : half power beamwidth v</span>
<span class="sd">        hpbwh  : half power beamwidth h</span>
<span class="sd">        sllv   : side lobe level</span>
<span class="sd">        fbrh   : front back ratio</span>
<span class="sd">        gm     :</span>
<span class="sd">        pol    : h | v | c</span>


<span class="sd">        if pattern</span>
<span class="sd">            Ft  nth x nphi x nf</span>
<span class="sd">            Fp  nth x nphi x nf</span>
<span class="sd">        else</span>
<span class="sd">            Ft  ndir x nf (==nth, ==nph)</span>
<span class="sd">            Fp  ndir x nf (==nth, ==nph)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;thtilt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># antenna tilt</span>
                    <span class="s1">&#39;hpbwv&#39;</span> <span class="p">:</span><span class="mf">6.2</span><span class="p">,</span><span class="c1"># half power beamwidth v</span>
                    <span class="s1">&#39;hpbwh&#39;</span> <span class="p">:</span><span class="mi">65</span><span class="p">,</span> <span class="c1"># half power beamwidth h</span>
                    <span class="s1">&#39;sllv&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span> <span class="c1"># side lobe level</span>
                    <span class="s1">&#39;fbrh&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>  <span class="c1"># front back ratio</span>
                    <span class="s1">&#39;gm&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>    <span class="c1">#</span>
                    <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;p&#39;</span>    <span class="c1">#t , p , c</span>
                    <span class="p">}}</span>


        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>


        <span class="c1">#if &#39;param&#39; not in kwargs:</span>
            <span class="c1">#kwargs[&#39;param&#39;]=defaults[&#39;param&#39;]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="s2">&quot;3gpp&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        <span class="n">thtilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;thtilt&#39;</span><span class="p">]</span>
        <span class="n">hpbwh</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;hpbwh&#39;</span><span class="p">]</span>
        <span class="n">hpbwv</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;hpbwv&#39;</span><span class="p">]</span>
        <span class="n">sllv</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;sllv&#39;</span><span class="p">]</span>
        <span class="n">fbrh</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;fbrh&#39;</span><span class="p">]</span>
        <span class="n">gm</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;gm&#39;</span><span class="p">]</span>
        <span class="n">pol</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;pol&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="n">pol</span>

        <span class="c1"># convert radian to degree</span>
        <span class="n">phi</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">180</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">90</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1">#Nth x Nph x Nf</span>
            <span class="n">GvdB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="p">((</span><span class="n">theta</span><span class="o">-</span><span class="n">thtilt</span><span class="p">)</span><span class="o">/</span><span class="n">hpbwv</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">sllv</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">GhdB</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="n">hpbwh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">fbrh</span><span class="p">)</span><span class="o">+</span><span class="n">gm</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">GdB</span>  <span class="o">=</span> <span class="n">GhdB</span><span class="o">+</span><span class="n">GvdB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">GdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Nd x Nf</span>
            <span class="n">GvdB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="p">((</span><span class="n">theta</span><span class="o">-</span><span class="n">thtilt</span><span class="p">)</span><span class="o">/</span><span class="n">hpbwv</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">sllv</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">GhdB</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="p">(</span><span class="n">phi</span><span class="o">/</span><span class="n">hpbwh</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">fbrh</span><span class="p">)</span><span class="o">+</span><span class="n">gm</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">GdB</span>  <span class="o">=</span> <span class="n">GhdB</span><span class="o">+</span><span class="n">GvdB</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">GdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">))</span>
        <span class="c1"># radiating functions are deduced from square root of gain</span>
        <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radF</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pvsh1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate pattern from VSH Coeffs (shape 1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta  : ndarray (1xNdir)</span>
<span class="sd">        phi    : ndarray (1xNdir)</span>
<span class="sd">        k      : int</span>
<span class="sd">            frequency index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Ft , Fp </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">),</span><span class="s1">&#39;no spherical coefficient&#39;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">,</span><span class="s1">&#39;s1&#39;</span><span class="p">),</span><span class="s1">&#39;no shape 1 coeff in vsh&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">L1</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M1</span>
        <span class="c1"># The - sign is necessary to get the good reconstruction</span>
        <span class="c1">#     deduced from observation</span>
        <span class="c1">#     May be it comes from a different definition of theta in SPHEREPACK</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># broadcasting along frequency axis</span>
        <span class="c1">#</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#   k : frequency axis</span>
        <span class="c1">#   l : axis l (theta)</span>
        <span class="c1">#   m : axis m (phi)</span>
        <span class="c1">#</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="c1"># here Nf x Nd</span>

        <span class="n">Ft</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="c1"># then Nd x Nf</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
        <span class="c1"># Nth x Nph x Nf</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>

        <span class="c1"># last axis should be frequency </span>
        <span class="k">assert</span><span class="p">(</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span> <span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pvsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate pattern from vsh3</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">),</span><span class="s1">&#39;no spherical coefficient&#39;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">,</span><span class="s1">&#39;s3&#39;</span><span class="p">),</span><span class="s1">&#39;no shape 3 coeff in vsh&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Br</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">lBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">mBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">Bi</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">Cr</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">Ci</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>

        <span class="n">L</span> <span class="o">=</span> <span class="n">lBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">mBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># vector spherical harmonics basis functions</span>

        <span class="c1"># V, W = VW(lBr, mBr, theta, phi)</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">lBr</span><span class="p">,</span> <span class="n">mBr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
               <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
               <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
               <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="c1"># here Nf x Nd</span>

        <span class="n">Ft</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="c1"># then Nd x Nf</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
        <span class="c1"># Nth x Nph x Nf</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>

        <span class="c1"># last axis should be frequency </span>
        <span class="k">assert</span><span class="p">(</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__psh3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate pattern for sh3</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">),</span><span class="s1">&#39;no spherical coefficient&#39;</span>
        <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="p">,</span><span class="s1">&#39;s3&#39;</span><span class="p">),</span><span class="s1">&#39;no shape 3 coeff in ssh&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s3</span>
        <span class="n">cz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s3</span>

        <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
        <span class="n">Y</span> <span class="p">,</span><span class="n">indx</span> <span class="o">=</span> <span class="n">SSHFunc2</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">k2</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pwireplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; pattern wire plate antenna</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;t0&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span>
                             <span class="s1">&#39;GmaxdB&#39;</span><span class="p">:</span> <span class="mi">5</span>
                   <span class="p">}}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;wireplate&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
        <span class="n">GmaxdB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">]</span>
        <span class="n">Gmax</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">GmaxdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">sqGmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gmax</span><span class="p">)</span>

        <span class="n">uth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="n">t0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uth2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="n">t0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">t0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">],[</span><span class="n">q</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">]]))</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="n">sqGmax</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>

        <span class="n">argth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">])</span>

        <span class="n">argth2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth2</span><span class="p">]</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">argth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">argth1</span><span class="p">,</span><span class="n">argth2</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span><span class="n">argth</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">sqGmax</span> <span class="o">*</span> <span class="p">(</span><span class="n">argth</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Fat</span> <span class="o">=</span> <span class="n">sqGmax</span> <span class="o">*</span> <span class="n">argth</span>
            <span class="n">Fap</span> <span class="o">=</span> <span class="n">sqGmax</span> <span class="o">*</span> <span class="n">argth</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fat</span><span class="p">[:,</span><span class="bp">None</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fap</span><span class="p">[:,</span><span class="bp">None</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:])</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>


    <span class="k">def</span> <span class="nf">__pcst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; read antenna in text format</span>
<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="s1">&#39;directory&#39;</span><span class="p">:</span><span class="s1">&#39;ant/FF_Results_txt_port_1_2/&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;fGHz&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)}}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">param</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">param</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="mi">10</span><span class="p">))</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
               <span class="n">_filename1</span> <span class="o">=</span> <span class="s1">&#39;E_port&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;_f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;GHz.txt&#39;</span>
               <span class="n">_filename2</span> <span class="o">=</span> <span class="s1">&#39;E_port&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;_f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;Ghz.txt&#39;</span>
        <span class="c1">#    print &#39;toto&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_filename1</span> <span class="o">=</span> <span class="s1">&#39;E_port&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;_f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;GHz.txt&#39;</span>
                <span class="n">_filename2</span> <span class="o">=</span> <span class="s1">&#39;E_port&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;_f&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Ghz.txt&#39;</span>
        
            
            <span class="n">filename1</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename1</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>
            <span class="n">filename2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename2</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>
            
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename1</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename2</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

            <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
            <span class="n">modGrlzdB</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
            <span class="n">mFt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
            <span class="n">pFt</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
            <span class="n">mFp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">5</span><span class="p">]]</span>
            <span class="n">pFp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">6</span><span class="p">]]</span>
            <span class="n">ratiodB</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">[</span><span class="mi">7</span><span class="p">]]</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">mFt</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">pFt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">mFp</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">pFp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">72</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tFt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tFt</span><span class="p">,</span><span class="n">Ft</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">tFp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">tFp</span><span class="p">,</span><span class="n">Fp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tFt</span><span class="o">=</span><span class="n">Ft</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
                <span class="n">tFp</span><span class="o">=</span><span class="n">Fp</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Ft</span> <span class="o">=</span> <span class="n">tFt</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">tFp</span> 
        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pHertz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Hertz dipole</span>
<span class="sd">        </span>
<span class="sd">        param = {&#39;param&#39;:{&#39;le&#39;:np.array([0,0,1])}}</span>
<span class="sd">        le unit vector defining the dipole orientation </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;le&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])}}</span>


        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="c1">#k = 2*np.pi*self.fGHz[None,None,None,:]/0.3</span>
        <span class="n">param</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">le</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;le&#39;</span><span class="p">][:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">zr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">yp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">zp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">zp</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">zt</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">vec</span> <span class="o">=</span> <span class="n">le</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">le</span><span class="p">,</span><span class="n">r</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">r</span>
            <span class="c1">#G = 1j*30*k*vec</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">th</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">ph</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">le</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;le&#39;</span><span class="p">][:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))</span>
            <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">zp</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">zt</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">vec</span> <span class="o">=</span> <span class="n">le</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">le</span><span class="p">,</span><span class="n">r</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">r</span>
            <span class="c1">#G = 1j*30*k*vec</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">th</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">ph</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

    <span class="k">def</span> <span class="nf">__pHuygens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Huygens source</span>

<span class="sd">        param : dict</span>

<span class="sd">        le : direction of electric current</span>
<span class="sd">        n  : normal to aperture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;le&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span>
                             <span class="s1">&#39;n&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])}}</span>


        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="c1">#k = 2*np.pi*self.fGHz[None,None,None,:]/0.3</span>
        <span class="n">param</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">le</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;le&#39;</span><span class="p">][:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">n</span>  <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">zr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">yp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">zp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">zp</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">zt</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">vec1</span> <span class="o">=</span> <span class="n">le</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">le</span><span class="p">,</span><span class="n">r</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">r</span>
            <span class="n">cro1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">le</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">axisa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cro1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">axisa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">vec</span>  <span class="o">=</span> <span class="n">vec1</span><span class="o">-</span><span class="n">vec2</span>

            <span class="c1">#G = 1j*30*k*vec</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">th</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kij,kij-&gt;ij&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">ph</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="c1">#Ft = np.einsum(&#39;kij,kij-&gt;ij&#39;,vec,th)[...,None]</span>
            <span class="c1">#Fp = np.einsum(&#39;kij,kij-&gt;ij&#39;,vec,ph)[...,None]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">le</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;le&#39;</span><span class="p">][:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xr</span><span class="p">,</span><span class="n">yr</span><span class="p">,</span><span class="n">zr</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yp</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))</span>
            <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span><span class="n">zp</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">zt</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xt</span><span class="p">,</span><span class="n">yt</span><span class="p">,</span><span class="n">zt</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">vec1</span> <span class="o">=</span> <span class="n">le</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">le</span><span class="p">,</span><span class="n">r</span><span class="p">)[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">r</span>
            <span class="n">cro1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">le</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">axisa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">vec2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">cro1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">axisa</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">axisc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">vec</span>  <span class="o">=</span> <span class="n">vec1</span><span class="o">-</span><span class="n">vec2</span>
            <span class="c1">#G = 1j*30*k*vec</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">th</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,ki-&gt;i&#39;</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">ph</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> 

    <span class="k">def</span> <span class="nf">__pArray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Array factor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Sc : np.array</span>
<span class="sd">            coupling S matrix</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Nd : Number of directions</span>
<span class="sd">        Np : Number of points (antenna elements)</span>
<span class="sd">        Nf : Number of frequency</span>
<span class="sd">        Nb : Number of beams</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;param&#39;</span><span class="p">:{</span><span class="s1">&#39;Sc&#39;</span><span class="p">:[]}}</span>

        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">{}:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="n">lamda</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="n">k</span>     <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">lamda</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>    <span class="c1"># Ntheta x Nphi</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>    <span class="c1"># Ntheta x Nphi</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))[</span><span class="bp">None</span><span class="p">,:]</span>   <span class="c1"># Ntheta x Nphi</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="n">sx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">sz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>    <span class="c1"># ,Nd</span>
            <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>    <span class="c1"># ,Nd</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>                     <span class="c1"># ,Nd</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">s</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">sx</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">sz</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>         <span class="c1"># Nd x 3</span>
        <span class="c1">#</span>
        <span class="c1"># F = exp(+jk s.p)</span>
        <span class="c1">#</span>

        <span class="n">lshp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lshp</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">lshp</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        
        <span class="n">Np</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;Sc&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Sc</span><span class="o">==</span><span class="p">[]:</span>
            <span class="c1"># Sc : Np x Np x Nf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">Np</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="c1">#Sc2 = np.random.rand(Np,Np)[...,None]</span>
            <span class="c1">#pdb.set_trace()</span>

        <span class="c1">#</span>
        <span class="c1"># Get the weights </span>
        <span class="c1">#</span>
        <span class="c1">#   w :  b x a x f </span>
        <span class="n">lshw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lshw</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">Np2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">lshw</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">Np2</span><span class="o">==</span><span class="n">Np</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">lshw</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span>
        <span class="c1"># s : Nd x 3</span>
        <span class="c1"># p : 3 x Np</span>
        <span class="c1">#</span>
        <span class="c1"># sdotp : Nd x Np</span>

        <span class="n">sdotp</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>   <span class="c1"># s . p</span>
        
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">la</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span><span class="n">ph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="n">th</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">grid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span>
            <span class="c1"># aFt : Nt x Np x Nf  |Nd x Nf</span>
            <span class="c1"># aFp : Nt x Np x Nf  |Nd x Nf</span>
            <span class="n">aFt</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Ft</span>
            <span class="n">aFp</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">Fp</span>
        <span class="c1">#</span>
        <span class="c1"># Force conversion to Nd x Nf</span>
        <span class="c1">#</span>

        <span class="n">shF</span> <span class="o">=</span> <span class="n">aFt</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">aFt</span> <span class="o">=</span> <span class="n">aFt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shF</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">shF</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">aFp</span> <span class="o">=</span> <span class="n">aFp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shF</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span><span class="n">shF</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1">#</span>
        <span class="c1"># Same pattern on each point</span>
        <span class="c1">#</span>
        <span class="n">aFt</span> <span class="o">=</span> <span class="n">aFt</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">aFp</span> <span class="o">=</span> <span class="n">aFp</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]</span>

        <span class="c1">#</span>
        <span class="c1"># Nf : frequency</span>
        <span class="c1"># Nd : direction</span>
        <span class="c1"># Np : points or array antenna element position</span>
        <span class="c1"># Nb : number of beams  </span>
        <span class="c1">#</span>
        <span class="c1"># w  : Np x Nf</span>
        <span class="c1"># Sc : Np x Np x Nf</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># w&#39; = w.Sc   Np x  Nf</span>
        <span class="c1">#</span>
        <span class="c1"># Coupling is implemented here</span>

        <span class="c1"># Rules : The repeated index k is the common dimension of the product</span>
        <span class="c1"># w    :  Np(k) x Nf(i)</span>
        <span class="c1"># Sc   :  Np(k) x Np(m) x Nf(i)</span>
        <span class="c1"># wp   :  Np(m) x Nf(i)</span>
        <span class="n">wp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ki,kmi-&gt;mi&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Sc</span><span class="p">)</span>

        <span class="c1"># add direction axis (=0) in w</span>

        <span class="c1">#if len(.w.shape)==3:</span>
        <span class="c1">#    self.wp   = self.wp[None,:,:,:]</span>

        <span class="c1"># aFT :  Nd x Np x Nf</span>
        <span class="c1"># E   :  Nd x Np x Nf</span>

        <span class="n">E</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">sdotp</span><span class="p">[:,:,</span><span class="bp">None</span><span class="p">])</span>

        <span class="c1">#</span>
        <span class="c1"># wp  : Np x Nf </span>
        <span class="c1"># Fp  : Nd x Np x Nf</span>
        <span class="c1"># Ft  : Nd x Np x Nf</span>
        <span class="c1">#</span>
        <span class="n">Ft</span> <span class="o">=</span> <span class="n">wp</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">aFt</span><span class="o">*</span><span class="n">E</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">wp</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">*</span><span class="n">aFp</span><span class="o">*</span><span class="n">E</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Integrate over the Np points (axis =1)</span>
        <span class="c1"># only if self.grid</span>
        <span class="c1"># Fp  : Nd x Nf</span>
        <span class="c1"># Ft  : Nd x Nf</span>
        <span class="c1">#</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Ft</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Fp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">Ft</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">,</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span>

<div class="viewcode-block" id="Pattern.radF"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.radF">[docs]</a>    <span class="k">def</span> <span class="nf">radF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluate radiation fonction w.r.t polarization</span>

<span class="sd">        self.pol : &#39;t&#39; : theta , &#39;p&#39; : phi n, &#39;c&#39; : circular </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span><span class="o">==</span><span class="s1">&#39;p&#39;</span><span class="p">:</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="c1">#if len(self.sqG.shape)==3:</span>
            <span class="c1">#    Ft = np.array([0])*np.ones(len(self.fGHz))[None,None,:]</span>
            <span class="c1">#else:</span>
            <span class="c1">#    Ft = np.array([0])*np.ones(len(self.fGHz))[None,:]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span><span class="o">==</span><span class="s1">&#39;t&#39;</span><span class="p">:</span>
            <span class="c1">#if len(self.sqG.shape)==3:</span>
            <span class="c1">#    Fp = np.array([0])*np.ones(len(self.fGHz))[None,None,:]</span>
            <span class="c1">#else:</span>
            <span class="c1">#    Fp = np.array([0])*np.ones(len(self.fGHz))[None,:]</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pol</span><span class="o">==</span><span class="s1">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1j</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>

        <span class="k">return</span> <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span></div>

<div class="viewcode-block" id="Pattern.gain"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.gain">[docs]</a>    <span class="k">def</span> <span class="nf">gain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  calculates antenna gain</span>
<span class="sd">        </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function updates the following attributes</span>

<span class="sd">        + self.G  : np.array(Nt,Np,Nf) dtype:float</span>
<span class="sd">            linear gain </span>
<span class="sd">                  or np.array(Nr,Nf)</span>
<span class="sd">        + self.sqG : np.array(Nt,Np,Nf) dtype:float </span>
<span class="sd">            linear sqare root of gain </span>
<span class="sd">                  or np.array(Nr,Nf)</span>
<span class="sd">        + self.efficiency : np.array (,Nf) dtype:float </span>
<span class="sd">            efficiency </span>
<span class="sd">        + self.hpster : np.array (,Nf) dtype:float</span>
<span class="sd">            half power solid angle :  1 ~ 4pi steradian </span>
<span class="sd">        + self.ehpbw : np.array (,Nf) dtyp:float </span>
<span class="sd">            equivalent half power beamwidth (radians)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. math:: G(\\theta,\\phi) = |F_{\\theta}|^2 + |F_{\\phi}|^2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">)</span>
                       <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">)</span> <span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">efficiency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Gs</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dp</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
            <span class="c1"># GdBmax (,Nf)</span>
            <span class="c1"># Get direction of Gmax and get the polarisation state in that direction </span>
            <span class="c1"># </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GdBmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">))[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">SphericalBasis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">theta_max</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_max</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
            <span class="n">uth</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">uph</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> 

            <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">)]</span><span class="o">*</span><span class="n">uth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">umax</span><span class="p">)]</span><span class="o">*</span><span class="n">uph</span>
            <span class="n">eln</span> <span class="o">=</span> <span class="n">el</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eln</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">el</span><span class="p">)</span>
            <span class="c1">#assert((self.efficiency&lt;1.0).all()),pdb.set_trace()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hpster</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)):</span>
                <span class="n">U</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">))</span>
                <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">U</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">V</span>  <span class="o">=</span> <span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hpster</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dp</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">hpster</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span></div>





<div class="viewcode-block" id="Pattern.plotG"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Pattern.html#pylayers.antprop.antenna.Pattern.plotG">[docs]</a>    <span class="k">def</span> <span class="nf">plotG</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; antenna plot gain in 2D</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz : frequency</span>
<span class="sd">        plan : &#39;theta&#39; | &#39;phi&#39; depending on the selected plan to be displayed</span>
<span class="sd">        angdeg : phi or theta in degrees, if plan==&#39;phi&#39; it corresponds to theta</span>
<span class="sd">        GmaxdB :  max gain to be displayed</span>
<span class="sd">        polar : boolean</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        fig</span>
<span class="sd">        ax</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.vsh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = A.plotG(fGHz=[2,3,4],plan=&#39;theta&#39;,angdeg=0)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = A.plotG(fGHz=[2,3,4],plan=&#39;phi&#39;,angdeg=90)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">dtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fGHz&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;dyn&#39;</span> <span class="p">:</span> <span class="mi">8</span> <span class="p">,</span>
                    <span class="s1">&#39;plan&#39;</span><span class="p">:</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;angdeg&#39;</span> <span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
                    <span class="s1">&#39;legend&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;GmaxdB&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                    <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;topos&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="s1">&#39;satimo&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;show&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;index&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;u&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c1">#ax = fig.add_axes([0.1, 0.1, 0.8, 0.8], polar=True, facecolor=&#39;#d5de9c&#39;)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">polar</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#316931&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">DyndB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dyn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="n">GmindB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DyndB</span>
        <span class="c1">#print &quot;DyndB&quot;,DyndB</span>
        <span class="c1">#print &quot;GmindB&quot;,GmindB</span>

        <span class="c1"># force square figure and square axes looks better for polar, IMO</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">DyndB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;GmaxdB&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#if len(self.fGHz) &gt; 1 :</span>
        <span class="c1">#    fstep = self.fGHz[1]-self.fGHz[0]</span>
        <span class="c1">#else :</span>
        <span class="c1">#    fstep = np.array((abs(self.fGHz-kwargs[&#39;fGHz&#39;][0])+1))</span>
        <span class="c1">#dtheta = self.theta[1,0]-self.theta[0,0]</span>
        <span class="c1">#dphi = self.phi[0,1]-self.phi[0,0]</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">lfreq</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lfreq</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">lfreq</span><span class="p">:</span>
            <span class="n">df</span>  <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="o">-</span><span class="n">f</span><span class="p">)</span>
            <span class="n">ik0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">==</span><span class="nb">min</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
            <span class="n">ik</span> <span class="o">=</span> <span class="n">ik0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#ik=0</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s1">&#39;f = </span><span class="si">%3.2f</span><span class="s1"> GHz&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="n">ik</span><span class="p">])</span>
            <span class="c1"># all theta</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plan&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;theta&#39;</span><span class="p">:</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span>
                <span class="n">iphi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;angdeg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span><span class="o">&lt;</span><span class="n">dphi</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span>
                <span class="c1">#   0 &lt;= theta  &lt;= pi/2</span>
                <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1">#   0 &lt; theta &lt; pi</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span>
                <span class="c1">#   pi/2 &lt; theta  &lt;= pi</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1">#</span>
                <span class="c1"># handle broadcasted axis =1 --&gt; index 0</span>
                <span class="n">shsqG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">.</span><span class="n">shape</span>
                <span class="k">if</span> <span class="n">shsqG</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">u1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">u2</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">u3</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">shsqG</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">iphi1</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shsqG</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>  <span class="c1"># if only one frequency point</span>
                    <span class="k">if</span> <span class="n">shsqG</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shsqG</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ik</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># handle parity</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">iphi1</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">iphi1</span> <span class="o">+</span> <span class="p">(</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">shsqG</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">iphi1</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="n">iphi2</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>
                    <span class="n">arg3</span> <span class="o">=</span> <span class="p">(</span><span class="n">u3</span><span class="p">,</span><span class="n">iphi1</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">shsqG</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">arg1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u1</span><span class="p">,</span><span class="n">iphi1</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>
                    <span class="n">arg2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u2</span><span class="p">,</span><span class="n">iphi2</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>
                    <span class="n">arg3</span> <span class="o">=</span> <span class="p">(</span><span class="n">u3</span><span class="p">,</span><span class="n">iphi1</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ik</span><span class="p">)</span>

                <span class="c1"># polar diagram</span>
                <span class="c1">#pdb.set_trace()</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;satimo&#39;</span><span class="p">:</span>
                        <span class="n">r1</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                        <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                        <span class="n">r3</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg3</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                        <span class="c1">#print max(r1)+GmindB</span>
                        <span class="c1">#print max(r2)+GmindB</span>
                        <span class="c1">#print max(r3)+GmindB</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span>
                        <span class="n">r1</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                        <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                        <span class="n">r3</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg3</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>

                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span><span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r1</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span><span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r2</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">r3</span><span class="p">)</span><span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">r3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r3</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">))</span>

                    <span class="n">negr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">negr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">negr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>

                    <span class="n">r1</span><span class="p">[</span><span class="n">negr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">r2</span><span class="p">[</span><span class="n">negr2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">r3</span><span class="p">[</span><span class="n">negr3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">r1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                    <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
                    <span class="n">rline2</span><span class="p">,</span> <span class="n">rtext2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">thetagrids</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>

                <span class="c1"># linear diagram</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r1</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg1</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                    <span class="n">r2</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg2</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                    <span class="n">r3</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg3</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>

                    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">r1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                <span class="c1"># angular basis for phi</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">u&#39;$</span><span class="se">\\</span><span class="s1">theta$ plane&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plan&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;phi&#39;</span><span class="p">:</span>
                <span class="n">iphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;angdeg&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span><span class="o">&lt;</span><span class="n">dtheta</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">iphi</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">itheta</span><span class="p">,</span><span class="n">iphi</span><span class="p">,</span><span class="n">ik</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">itheta</span><span class="p">,</span><span class="n">iphi</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ik</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>
                        <span class="n">neg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">r</span><span class="p">[</span><span class="n">neg</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span><span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">angle</span><span class="p">)))</span>
               <span class="c1"># plt.title(u&#39;H plane - $\phi$ degrees&#39;)</span>
                    <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                    <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span> <span class="p">,</span> <span class="mi">150</span> <span class="p">,</span> <span class="mi">180</span> <span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span> <span class="p">,</span> <span class="mi">300</span> <span class="p">,</span> <span class="mi">330</span><span class="p">]</span>
                    <span class="c1">#rline2, rtext2 = plt.thetagrids(a1, a2)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span>  <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">arg</span><span class="p">])</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">u&#39;$</span><span class="se">\\</span><span class="s1">phi$ plane &#39;</span><span class="p">)</span>
            <span class="c1"># actual plotting</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lfreq</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> 
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">cpt</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">chaine</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">chaine</span><span class="p">)</span>
            <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;polar&#39;</span><span class="p">]:</span>
            <span class="n">rline1</span><span class="p">,</span> <span class="n">rtext1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rgrids</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
            <span class="c1">#ax.set_rmax(t1[-1])</span>
            <span class="c1">#ax.set_rmin(t1[0])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legend&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="Antenna"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna">[docs]</a><span class="k">class</span> <span class="nc">Antenna</span><span class="p">(</span><span class="n">Pattern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Antenna</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    name   : Antenna name</span>

<span class="sd">    nf     : number of frequency</span>
<span class="sd">    nth    : number of theta</span>
<span class="sd">    nph    : number of phi</span>

<span class="sd">    Ft     : Normalized Ftheta    (ntheta,nphi,nf)</span>
<span class="sd">    Fp     : Normalized Fphi      (ntheta,nphi,nf)</span>
<span class="sd">    sqG    : square root of gain  (ntheta,nphi,nf)</span>


<span class="sd">    theta  : theta base            1 x ntheta</span>
<span class="sd">    phi    : phi base              1 x phi</span>

<span class="sd">    C      : VSH Coefficients</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    info  : Display information about antenna</span>
<span class="sd">    vsh   : calculates Vector Spherical Harmonics</span>
<span class="sd">    show3 : Geomview diagram</span>
<span class="sd">    plot3d : 3D diagram plotting using matplotlib toolkit</span>

<span class="sd">    Antenna trx file can be stored in various order</span>
<span class="sd">        natural : HFSS</span>
<span class="sd">        ncp     : near filed chamber</span>

<span class="sd">    It is important when initializing an antenna object</span>
<span class="sd">    to be aware of the typ of trx file</span>

<span class="sd">    .trx (ASCII Vectorial antenna Pattern)</span>

<span class="sd">    F   Phi   Theta  Fphi  Ftheta</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;Omni&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ  : &#39;Omni&#39;,&#39;Gauss&#39;,&#39;WirePlate&#39;,&#39;3GPP&#39;,&#39;atoll&#39;</span>

<span class="sd">        _filename : string</span>
<span class="sd">                    antenna file name</span>
<span class="sd">        directory : str</span>
<span class="sd">                    antenna subdirectory of the current project</span>
<span class="sd">                    the file is seek in the $BASENAME/ant directory</span>
<span class="sd">        nf        : integer</span>
<span class="sd">                     number of frequency </span>
<span class="sd">        ntheta    : integer</span>
<span class="sd">                    number of theta (default 181)</span>
<span class="sd">        nphi      : integer</span>
<span class="sd">                    number of phi (default 90)</span>
<span class="sd">        source    : string</span>
<span class="sd">                source of data { &#39;satimo&#39; | &#39;cst&#39; | &#39;hfss&#39; }</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The supported data formats for storing antenna patterns are</span>

<span class="sd">        &#39;mat&#39;: Matlab File</span>
<span class="sd">        &#39;vsh2&#39;: unthresholded vector spherical coefficients</span>
<span class="sd">        &#39;vsh3&#39;: thresholded vector spherical cpoefficients</span>
<span class="sd">        &#39;atoll&#39;: Atoll antenna file format</span>
<span class="sd">        &#39;trx&#39; : Satimo NFC raw data</span>
<span class="sd">        &#39;trx1&#39; : Satimo NFC raw data  (deprecated)</span>

<span class="sd">         A = Antenna(&#39;my_antenna.mat&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;directory&#39;</span><span class="p">:</span> <span class="s1">&#39;ant&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;source&#39;</span><span class="p">:</span><span class="s1">&#39;satimo&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ntheta&#39;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span>
                    <span class="s1">&#39;nphi&#39;</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span>
                    <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span> <span class="c1"># L max</span>
                    <span class="s1">&#39;param&#39;</span><span class="p">:{}</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;fGHz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">])</span><span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]])</span>


        <span class="c1">#mayavi selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_selected</span><span class="o">=</span><span class="bp">False</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;param&#39;</span><span class="p">]</span>

        <span class="c1">#super(Antenna,self).__init__()</span>
        <span class="c1">#Pattern.__init__(self)</span>
        <span class="c1">#</span>
        <span class="c1"># if typ string has an extension it is a file</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">AntennaName</span><span class="p">,</span><span class="n">Extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1">#determine if pattern for all theta/phi is constructed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;vsh3&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;vsh3&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh3</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;vsh2&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;vsh2&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh2</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;sh3&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;sh3&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadsh3</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;sh2&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;sh2&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadsh2</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;trx1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;trx&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_trx</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;trx&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;trx&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadtrx</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;mat&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;mat&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;cst&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;cst&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;txt&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;atoll&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_atoll</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;directory&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ext</span><span class="o">=</span><span class="s1">&#39;hfss&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadhfss</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># not from file </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;vsh3&#39;</span><span class="p">:</span>  
                <span class="bp">self</span><span class="o">.</span><span class="n">initvsh</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;type : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;param&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;atoll&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoll</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">k2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoll</span><span class="p">[</span><span class="n">k1</span><span class="p">]:</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">rtd</span> <span class="o">=</span> <span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;file name : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)):</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;FileName : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="c1">#        #st = st + &#39;file type : &#39; + self.typ+&#39;\n&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;fGHz&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;fmin : </span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;GHz</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;fmax : </span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;GHz</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;step : </span><span class="si">%4.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;MHz</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;step : None</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Nf : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="c1">#</span>
<span class="c1">#</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;-----------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;      evaluated        </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;-----------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Ntheta : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Nphi : </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="c1">#                kwargs[k] = defaults[k]</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="n">ut</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                    <span class="n">ut</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                    <span class="n">ud</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                    <span class="n">ud</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;GdBmax :&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Gmax direction : .sl&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Orientation of E field in Gmax direction : .el &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">el</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;Orientation of H field in Gmax direction : .hl &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hl</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;effective HPBW : .ehpbw &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ehpbw</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;satimo&#39;</span><span class="p">:</span>
                <span class="n">GdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
            <span class="c1"># see WHERE1 D4.1 sec 3.1.1.2.2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s1">&#39;cst&#39;</span><span class="p">:</span>
                <span class="n">GdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
            <span class="c1">#st = st + &quot;GmaxdB : %4.2f dB \n&quot; % (GdB)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;   f = </span><span class="si">%4.2f</span><span class="s2"> GHz </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;   theta = </span><span class="si">%4.2f</span><span class="s2"> (degrees) </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ut</span><span class="p">]</span><span class="o">*</span><span class="n">rtd</span><span class="p">)</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot;   phi = </span><span class="si">%4.2f</span><span class="s2">  (degrees) </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">up</span><span class="p">]</span><span class="o">*</span><span class="n">rtd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s2">&quot; Ray n :&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ud</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Not evaluated</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#        if self.typ == &#39;mat&#39;:</span>
<span class="c1">#            #st = st + self.DataFile + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;antenna name : &#39;+ self.AntennaName + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;date : &#39; + self.Date +&#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;time : &#39; + self.StartTime +&#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;Notes : &#39; + self.Notes+&#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;Serie : &#39; + str(self.Serie)+&#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;Run : &#39; + str(self.Run)+&#39;\n&#39;</span>
<span class="c1">#            st = st + &quot;Nb theta (lat) : &quot;+ str(self.nth)+&#39;\n&#39;</span>
<span class="c1">#            st = st + &quot;Nb phi (lon) :&quot;+ str(self.nph)+&#39;\n&#39;</span>
<span class="c1">#</span>
<span class="c1">#        if self.typ == &#39;Gauss&#39;:</span>
<span class="c1">#            st = st + &#39;Gaussian pattern&#39; + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;phi0 : &#39; + str(self.p0) +&#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;theta0 :&#39; + str(self.t0) + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;phi 3dB :&#39; + str(self.p3) + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;theta 3dB :&#39; + str(self.t3) + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;Gain dB :&#39; + str(self.GdB) + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;Gain linear :&#39; + str(self.G ) + &#39;\n&#39;</span>
<span class="c1">#            st = st + &#39;sqrt G :&#39; + str(self.sqG) + &#39;\n&#39;</span>

        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

<div class="viewcode-block" id="Antenna.initvsh"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.initvsh">[docs]</a>    <span class="k">def</span> <span class="nf">initvsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lmax</span><span class="o">=</span><span class="mi">45</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize a void vsh structure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz : array</span>
<span class="sd">        lmax : int</span>
<span class="sd">            level max</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="n">Br</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lmax</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lmax</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lmax</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="mi">1j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">lmax</span><span class="p">,</span> <span class="n">lmax</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Br</span><span class="p">)</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Bi</span><span class="p">)</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Cr</span><span class="p">)</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">Ci</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.ls"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.ls">[docs]</a>    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;vsh3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the antenna files in antenna project directory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ : string optional</span>
<span class="sd">            {&#39;mat&#39;|&#39;trx&#39;|&#39;vsh2&#39;|&#39;sh2&#39;|&#39;vsh3&#39;|&#39;sh3&#39;}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of strdir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;vsh3&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;sh3&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;mat&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;trx&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>

        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">lfile_s</span></div>


<div class="viewcode-block" id="Antenna.photo"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.photo">[docs]</a>    <span class="k">def</span> <span class="nf">photo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a picture of the antenna </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        directory : string</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">directory</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;ant&#39;</span><span class="p">,</span><span class="s1">&#39;UWBAN&#39;</span><span class="p">,</span><span class="s1">&#39;PhotosVideos&#39;</span><span class="p">)</span>

        <span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;IMG_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">PhotoFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.JPG&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">I</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Antenna.load_atoll"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.load_atoll">[docs]</a>    <span class="k">def</span> <span class="nf">load_atoll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s2">&quot;ant&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load antenna from Atoll file </span>
<span class="sd">        </span>
<span class="sd">        Atoll format provides Antenna gain given for the horizontal and vertical plane </span>
<span class="sd">        for different frequencies and different tilt values </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        directory : string </span>

<span class="sd">        The dictionnary attol is created </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">fileatoll</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filemat</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileatoll</span><span class="p">)</span>
        <span class="n">lis</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
            <span class="n">lispl</span><span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lispl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lispl</span><span class="p">)</span>

        <span class="n">deg_to_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
        <span class="n">lbs_to_kg</span> <span class="o">=</span> <span class="mf">0.45359237</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#pdb.set_trace()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">tab</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dff</span><span class="o">=</span><span class="n">dff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">dff</span><span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw</span> <span class="o">=</span> <span class="n">dff</span>
        <span class="n">dff</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">]]</span>
        <span class="c1">#dff = df[&#39;Name&#39;,&#39;Gain  (dBi)&#39;,&#39;FMin&#39;,&#39;FMax&#39;,&#39;FREQUENCY&#39;,&#39;Pattern&#39;,&#39;V_WIDTH&#39;,&#39;H_WIDTH&#39;,&#39;DIMENSIONS HxWxD   (INCHES)&#39;,&#39;WEIGHT (LBS)&#39;]</span>
        <span class="n">dff</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="s1">&#39;Fmin&#39;</span><span class="p">,</span><span class="s1">&#39;Fmax&#39;</span><span class="p">,</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;Gmax&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="s1">&#39;Hpbw&#39;</span><span class="p">,</span><span class="s1">&#39;H_width&#39;</span><span class="p">,</span><span class="s1">&#39;V_width&#39;</span><span class="p">,</span><span class="s1">&#39;HxWxD&#39;</span><span class="p">,</span><span class="s1">&#39;Weight&#39;</span><span class="p">,</span><span class="s1">&#39;Tilt&#39;</span><span class="p">,</span><span class="s1">&#39;Etilt&#39;</span><span class="p">,</span><span class="s1">&#39;Ftob&#39;</span><span class="p">]</span>
        <span class="n">dff</span><span class="o">=</span><span class="n">dff</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># Parse polarization in the field name</span>
        <span class="c1">#</span>
        <span class="n">upolarp45</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(+45)&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dff</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span>
        <span class="n">upolarm45</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(-45)&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dff</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]]</span>  
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">upolarp45</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">upolarp45</span><span class="p">,</span><span class="s1">&#39;Polar&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">45</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">upolarm45</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
            <span class="n">dff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">upolarm45</span><span class="p">,</span><span class="s1">&#39;Polar&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">45</span>

        <span class="n">atoll</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dfband</span> <span class="o">=</span> <span class="n">dff</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Fmin&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">dfband</span><span class="p">:</span>
            <span class="n">keyband</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Fmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>  <span class="c1"># band</span>
            <span class="n">dfpol</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Polar&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">dfpol</span><span class="p">:</span>
                <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># polar</span>
                <span class="n">dftilt</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Tilt&#39;</span><span class="p">])</span>
                <span class="n">Ghor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># angle , tilt , frequency</span>
                <span class="n">Gver</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">360</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># angle , </span>
                <span class="n">ct</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tilt</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dftilt</span><span class="p">:</span>
                    <span class="n">dffreq</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;F&#39;</span><span class="p">])</span>
                    <span class="n">ct</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">cf</span><span class="o">=</span><span class="mi">0</span> 
                    <span class="n">tilt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">freq</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">dffreq</span><span class="p">:</span>
                        <span class="n">freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">cf</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">df</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">Gmax</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Gmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                        <span class="n">str1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;G&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">lstr</span> <span class="o">=</span> <span class="n">str1</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">Pattern</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lstr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="c1"># 4 fist field / # of points</span>
                        <span class="n">Nd</span><span class="p">,</span><span class="n">db</span><span class="p">,</span><span class="n">dc</span><span class="p">,</span><span class="n">Np</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
                        <span class="c1">#print(Nd,b,c,Np)</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Pattern</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Np</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">ah</span>   <span class="o">=</span> <span class="n">tmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">ghor</span> <span class="o">=</span> <span class="n">Gmax</span><span class="o">-</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># 4 fist field / # of points</span>
                        <span class="n">da</span><span class="p">,</span><span class="n">db</span><span class="p">,</span><span class="n">dc</span><span class="p">,</span><span class="n">dd</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Np</span><span class="p">:</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Np</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
                        <span class="c1">#pdb.set_trace()</span>
                        <span class="c1">#print a,b,c,d</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Pattern</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">Np</span><span class="o">+</span><span class="mi">4</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dc</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">gver</span> <span class="o">=</span> <span class="n">Gmax</span><span class="o">-</span><span class="n">tmp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">av</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">Ghor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Ghor</span><span class="p">,</span><span class="n">ghor</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]))</span>
                            <span class="n">Gver</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Gver</span><span class="p">,</span><span class="n">gver</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]))</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                <span class="n">Ghor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">Ghor</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">Gver</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">Gver</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;hor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ghor</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">360</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">cf</span><span class="p">)</span>
                <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ver&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gver</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">360</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">cf</span><span class="p">)</span>
                <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span>
                <span class="n">atoll</span><span class="p">[</span><span class="n">keyband</span><span class="p">][</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;freq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoll</span> <span class="o">=</span> <span class="n">atoll</span></div>
        <span class="c1"># Gmax = eval(self.df[&#39;Gain  (dBi)&#39;].values[0])</span>
        <span class="c1">#fig = plt.figure()</span>
        <span class="c1">#ax =plt.gca(projection=&#39;polar&#39;)</span>
        <span class="c1">#ax =plt.gca()</span>
        <span class="c1">#ax.plot(H2[:,1]*deg_to_rad,Gain-H2[:,0],&#39;r&#39;,label=&#39;vertical&#39;,linewidth=2)</span>
        <span class="c1">#ax.plot(H1[:,0]*deg_to_rad,Gain-H1[:,1],&#39;b&#39;,label=&#39;horizontal&#39;,linewidth=2)</span>
        <span class="c1">#ax.set_rmin(-30)</span>
        <span class="c1">#plt.title(dir1+&#39;/&#39;+filename+&#39; Gain : &#39;+df[&#39;Gain  (dBi)&#39;].values[0])</span>
        <span class="c1">#BXD-634X638XCF-EDIN.txt</span>
        <span class="c1">#BXD-636X638XCF-EDIN.txt        </span>

<div class="viewcode-block" id="Antenna.loadmat"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadmat">[docs]</a>    <span class="k">def</span> <span class="nf">loadmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;ant&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load an antenna stored in a mat file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str , optional</span>
<span class="sd">            default &#39;ant&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            Read an Antenna file in UWBAN directory and plot a polar plot</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;S1R1.mat&#39;,directory=&#39;ant/UWBAN/Matfile&#39;)</span>
<span class="sd">            &gt;&gt;&gt; f,a = A.plotG(plan=&#39;theta&#39;,angdeg=0)</span>
<span class="sd">            &gt;&gt;&gt; f,a = A.plotG(plan=&#39;phi&#39;,angdeg=90,fig=f,ax=a)</span>
<span class="sd">            &gt;&gt;&gt; txt = plt.title(&#39;S1R1 antenna : st loadmat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filemat</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filemat</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filemat</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">struct_as_record</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">_filemat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.mat&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;mat&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Notes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PhotoFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">PhotoFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Serie</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Serie</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Run</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">DataFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">StartTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">AntennaName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">freq</span><span class="o">/</span><span class="mf">1.e9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">theta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">phi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Ftheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Fphi</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span> <span class="o">==</span>  <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="Antenna.load_trx"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.load_trx">[docs]</a>    <span class="k">def</span> <span class="nf">load_trx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;ant&quot;</span><span class="p">,</span> <span class="n">nf</span><span class="o">=</span><span class="mi">104</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">181</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a trx file (deprecated)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str</span>
<span class="sd">                    directory where is located the trx file (default : ant)</span>
<span class="sd">        nf : float</span>
<span class="sd">             number of frequency points</span>
<span class="sd">        ntheta : float</span>
<span class="sd">               number of theta</span>
<span class="sd">        nphi : float</span>
<span class="sd">               number of phi</span>

<span class="sd">        TODO : DEPRECATED (Fix the Ft and Fp format with Nf as last axis)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncol</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*$&quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*</span><span class="se">\t</span><span class="s2">.*$&quot;&quot;&quot;</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#while ((re.search(pattern1,d[k]) is None ) &amp; (re.search(pattern2,d[k]) is None )):</span>
        <span class="k">while</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># TODO Parsing the header</span>
        <span class="c1">#</span>
        <span class="c1">#nf     = 104</span>
        <span class="c1">#nphi   = 90</span>
        <span class="c1">#ntheta = 181</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">nf</span> <span class="o">*</span> <span class="n">nphi</span> <span class="o">*</span> <span class="n">ntheta</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">PHI</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">THETA</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">THETA</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">PHI</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1">#self.phi     = Tphi[0,0,:]</span>

        <span class="c1">#</span>
        <span class="c1"># Temporaire</span>
        <span class="c1">#</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="mi">104</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="Antenna.pattern"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.pattern">[docs]</a>    <span class="k">def</span> <span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="p">[],</span><span class="n">phi</span><span class="o">=</span><span class="p">[],</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return multidimensionnal radiation patterns</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta   : array</span>
<span class="sd">            1xNt</span>
<span class="sd">        phi     : array</span>
<span class="sd">            1xNp</span>
<span class="sd">        typ : string</span>
<span class="sd">            {s1|s2|s3}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">theta</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="c1">#Th = np.kron(theta, np.ones(Np))</span>
        <span class="c1">#Ph = np.kron(np.ones(Nt), phi)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s1&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth1</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s2&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth2b</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s3&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="c1">#FTh = Fth.reshape(Nf, Nt, Np)</span>
        <span class="c1">#FPh = Fph.reshape(Nf, Nt, Np)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">FTh</span><span class="p">,</span><span class="n">FPh</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.coeffshow"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.coeffshow">[docs]</a>    <span class="k">def</span> <span class="nf">coeffshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display antenna coefficient</span>

<span class="sd">            typ : string</span>
<span class="sd">                &#39;ssh&#39; |&#39;vsh&#39;</span>
<span class="sd">            L  : maximum level</span>
<span class="sd">            kf : frequency index</span>
<span class="sd">            vmin  : float</span>
<span class="sd">            vmax  : float</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;typ&#39;</span><span class="p">:</span><span class="s1">&#39;vsh&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                    <span class="s1">&#39;kf&#39;</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span>
                    <span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span>
                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span>
                    <span class="s1">&#39;dB&#39;</span><span class="p">:</span><span class="bp">True</span>
                   <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">L</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span>
        <span class="n">kf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;kf&#39;</span><span class="p">]</span>

        <span class="c1"># calculates mode energy</span>
        <span class="c1"># linear and log scale</span>
        <span class="c1"># E : f , l , m</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;vsh&#39;</span><span class="p">:</span>
            <span class="n">E</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ssh&#39;</span><span class="p">:</span>
            <span class="n">E</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">energy</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s1&#39;</span><span class="p">)</span>

        <span class="c1"># Aem : f,l</span>
        <span class="c1"># calculates energy integrated over m</span>

        <span class="n">Aem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Aem_dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Aem</span><span class="p">)</span>

        <span class="c1"># Ael : f,m</span>
        <span class="c1"># calculates energy integrated over l</span>

        <span class="n">Ael</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">Ael_dB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ael</span><span class="p">)</span>


        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figwidth</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_figheight</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="n">kf</span><span class="p">,:,:]),</span>
                           <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span>
                           <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">],</span>
                           <span class="n">extent</span> <span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                           <span class="n">cmap</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">])</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">axHistx</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">axHisty</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c1">#axHistx.bar(range(-L,L),Aem)</span>
        <span class="c1">#axHisty.barh(range(0,L),Ael )</span>
        <span class="n">axHistx</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.8</span><span class="p">]))</span>
        <span class="n">axHisty</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]))</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.6</span> <span class="p">,</span><span class="s1">&#39;levels&#39;</span><span class="p">,</span>
             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
             <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
             <span class="n">rotation</span> <span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.1</span> <span class="p">,</span><span class="s1">&#39;free space&#39;</span><span class="p">,</span>
             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
             <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
             <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.55</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span> <span class="p">,</span><span class="s1">&#39;modes&#39;</span><span class="p">,</span>
             <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span>
             <span class="p">,</span><span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>


<div class="viewcode-block" id="Antenna.errel"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.errel">[docs]</a>    <span class="k">def</span> <span class="nf">errel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kf</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates error between antenna pattern and reference pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kf  : integer</span>
<span class="sd">            frequency index. If k=-1 integration over all frequency</span>
<span class="sd">        dsf : down sampling factor</span>
<span class="sd">        typ :</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        errelTh : float</span>
<span class="sd">            relative error on :math:`F_{\\theta}`</span>
<span class="sd">        errelPh : float</span>
<span class="sd">            relative error on :math:`F_{\phi}`</span>
<span class="sd">        errel   : float</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. math::</span>

<span class="sd">            \epsilon_r^{\\theta} =</span>
<span class="sd">            \\frac{|F_{\\theta}(\\theta,\phi)-\hat{F}_{\\theta}(\\theta,\phi)|^2}</span>
<span class="sd">                 {|F_{\\theta}(\\theta,\phi)|^2}</span>

<span class="sd">            \epsilon_r^{\phi} =</span>
<span class="sd">            \\frac{|F_{\phi}(\\theta,\phi)-\hat{F}_{\phi}(\\theta,\phi)|^2}</span>
<span class="sd">                 {|F_{\\theta}(\\theta,\phi)|^2}</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Retrieve angular bases from the down sampling factor dsf</span>
        <span class="c1">#</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="c1">#Th = np.kron(theta, np.ones(Np))</span>
        <span class="c1">#Ph = np.kron(np.ones(Nt), phi)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s1&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth1</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s2&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth2b</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;s3&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

        <span class="c1">#FTh = Fth.reshape(self.nf, Nt, Np)</span>
        <span class="c1">#FPh = Fph.reshape(self.nf, Nt, Np)</span>
        <span class="c1">#</span>
        <span class="c1">#  Jacobian</span>
        <span class="c1">#</span>
        <span class="c1">#st    = outer(sin(theta),ones(len(phi)))</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># Construct difference between reference and reconstructed</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">kf</span><span class="o">!=-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FTh</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="n">dPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FPh</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="c1">#</span>
            <span class="c1"># squaring  + Jacobian</span>
            <span class="c1">#</span>
            <span class="n">dTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dTh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dTh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">dPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dPh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dPh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">vTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">vPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">mvTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vTh2</span><span class="p">)</span>
            <span class="n">mvPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vPh2</span><span class="p">)</span>

            <span class="n">errTh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dTh2</span><span class="p">)</span>
            <span class="n">errPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dPh2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FTh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="n">dPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FPh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="c1">#</span>
            <span class="c1"># squaring  + Jacobian</span>
            <span class="c1">#</span>
            <span class="n">dTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dTh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dTh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">dPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dPh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dPh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">vTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">vPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">mvTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vTh2</span><span class="p">)</span>
            <span class="n">mvPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vPh2</span><span class="p">)</span>

            <span class="n">errTh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dTh2</span><span class="p">)</span>
            <span class="n">errPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dPh2</span><span class="p">)</span>

        <span class="n">errelTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">errTh</span> <span class="o">/</span> <span class="n">mvTh2</span><span class="p">)</span>
        <span class="n">errelPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">errPh</span> <span class="o">/</span> <span class="n">mvPh2</span><span class="p">)</span>
        <span class="n">errel</span> <span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="n">errTh</span> <span class="o">+</span> <span class="n">errPh</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mvTh2</span> <span class="o">+</span> <span class="n">mvPh2</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">errelTh</span><span class="p">,</span> <span class="n">errelPh</span><span class="p">,</span> <span class="n">errel</span><span class="p">)</span></div>


<div class="viewcode-block" id="Antenna.loadhfss"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadhfss">[docs]</a>    <span class="k">def</span> <span class="nf">loadhfss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lfa</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">Nt</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span><span class="n">Np</span><span class="o">=</span><span class="mi">37</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load antenna from HFSS file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        lfa : list of antenna file</span>
<span class="sd">        Nt  : int</span>
<span class="sd">            Number of angle theta</span>
<span class="sd">        Np  : int</span>
<span class="sd">            Number of angle phi</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        One file per frequency point</span>

<span class="sd">        th , ph , abs_grlz,th_absdB,th_phase,ph_absdB,ph_phase_ax_ratio</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># lfa : list file antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lfa</span><span class="p">)</span>
        <span class="n">fGHz</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lacsv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lfa</span><span class="p">)):</span>

            <span class="n">fGHz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">lfa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">lacsv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">lfa</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                     <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="s1">&#39;ph&#39;</span><span class="p">,</span><span class="s1">&#39;abs_grlz&#39;</span><span class="p">,</span><span class="s1">&#39;th_absdB&#39;</span><span class="p">,</span><span class="s1">&#39;th_phase&#39;</span><span class="p">,</span><span class="s1">&#39;ph_absdB&#39;</span><span class="p">,</span><span class="s1">&#39;ph_phase&#39;</span><span class="p">,</span><span class="s1">&#39;ax_ratio&#39;</span><span class="p">],</span>
                                     <span class="n">index_col</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

            <span class="n">th</span><span class="o">=</span><span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">th</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="n">ph</span><span class="o">=</span><span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="n">Greal</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">abs_grlz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>

            <span class="n">th_dB</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">th_absdB</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>
            <span class="n">ph_dB</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ph_absdB</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>

            <span class="n">th_lin</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">th_dB</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>
            <span class="n">ph_lin</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">ph_dB</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>

            <span class="c1">#th_phase = lacsv[i].th_phase.reshape(72,37)*np.pi/180.</span>
            <span class="c1">#ph_phase = lacsv[i].ph_phase.reshape(72,37)*np.pi/180.</span>
            <span class="c1">#axratio=lacsv[i].ax_ratio.reshape(72,37)</span>
            <span class="n">Fphi</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">ph_lin</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Ftheta</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">th_lin</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">SqG</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">Greal</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="c1">#self.theta = th[0,:].reshape(Nt,1)</span>
        <span class="c1">#self.phi = ph[:,0].reshape(1,Np)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">=</span><span class="n">Fphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">=</span><span class="n">Ftheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">=</span><span class="n">SqG</span></div>



<div class="viewcode-block" id="Antenna.loadtrx"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadtrx">[docs]</a>    <span class="k">def</span> <span class="nf">loadtrx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load trx file (SATIMO Near Field Chamber raw data)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        directory</span>

<span class="sd">        self._filename: short name of the antenna file</span>

<span class="sd">        the file is seek in the $BASENAME/ant directory</span>

<span class="sd">        .. todo:</span>
<span class="sd">            consider using an ini file for the header</span>

<span class="sd">        Trx header structure</span>

<span class="sd">        fmin fmax Nf  phmin   phmax   Nphi    thmin    thmax    Ntheta  #EDelay</span>
<span class="sd">        0     1   2   3       4       5       6        7        8       9</span>
<span class="sd">        1     10  121 0       6.19    72      0        3.14     37      0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="s1">&#39;header_&#39;</span> <span class="o">+</span> <span class="n">_filetrx</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="n">_headtrx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;trx&#39;</span><span class="p">,</span> <span class="s1">&#39;txt&#39;</span><span class="p">)</span>
        <span class="n">headtrx</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_headtrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># Trx header structure</span>
    <span class="c1">#</span>
    <span class="c1"># fmin fmax Nf  phmin   phmax   Nphi    thmin    thmax    Ntheta  #EDelay</span>
    <span class="c1"># 0     1   2   3       4       5       6        7        8       9</span>
    <span class="c1"># 1     10  121 0       6.19    72      0        3.14     37      0</span>
    <span class="c1">#</span>
    <span class="c1">#</span>
        <span class="n">foh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">headtrx</span><span class="p">)</span>
        <span class="n">ligh</span> <span class="o">=</span> <span class="n">foh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">foh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nf</span>   <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">phmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">phmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">thmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">thmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">ntheta</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># The electrical delay in column 9 is optional</span>
        <span class="c1">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span>  <span class="c1"># tau : delay (ns)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1">#</span>
        <span class="c1"># Data are stored in 7 columns</span>
        <span class="c1">#</span>
        <span class="c1"># 0  1   2     3        4       5       6</span>
        <span class="c1"># f  phi th    ReFph   ImFphi  ReFth    ImFth</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fi</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">7</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;error : frequency cannot be zero&quot;</span><span class="p">)</span>
        <span class="c1"># detect frequency unit</span>
        <span class="c1"># if values are above 2000 its means frequency is not expressed</span>
        <span class="c1"># in GHz</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mf">1.0e9</span>

        <span class="n">phi</span>   <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1">#</span>
        <span class="c1"># type : refers to the way the angular values are stored in the file</span>
        <span class="c1"># Detection of file type</span>
        <span class="c1">#</span>
        <span class="c1"># nfc</span>
        <span class="c1">#    f  phi theta</span>
        <span class="c1">#    2    1    0</span>
        <span class="c1"># Natural</span>
        <span class="c1">#    f  phi theta</span>
        <span class="c1">#    2    0    1</span>
        <span class="c1">#</span>
        <span class="c1"># auto detect storage mode looping</span>
        <span class="c1">#</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;nfc&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;natural&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">Fphi</span>   <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="c1">#</span>
        <span class="c1"># Normalization</span>
        <span class="c1">#</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ftheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">))</span>
        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="c1">#Fphi    = Fphi/SqG</span>
        <span class="c1">#Ftheta  = Ftheta/SqG</span>
        <span class="c1">#Fphi    = Fphi</span>
        <span class="c1">#Ftheta  = Ftheta</span>
        <span class="c1">#</span>
        <span class="c1"># Reshaping</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;natural&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;nfc&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="c1">#</span>
        <span class="c1"># Force natural order (f,theta,phi)</span>
        <span class="c1"># This is not the order of the satimo nfc which is  (f,phi,theta)</span>
        <span class="c1">#</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1">#</span>
        <span class="c1"># check header consistency</span>
        <span class="c1">#</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fmin</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">fmax</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">thmin</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">thmax</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">phmin</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">phmax</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="n">nf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="n">ntheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="n">nphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="Antenna.checkpole"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.checkpole">[docs]</a>    <span class="k">def</span> <span class="nf">checkpole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kf</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display the reconstructed field on pole for integrity verification</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kf : int</span>
<span class="sd">             frequency index default 0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ft0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Ex0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Ey0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Exp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Eyp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span></div>

<div class="viewcode-block" id="Antenna.info"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives info about antenna object</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;type : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;mat&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Notes</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Serie</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Run</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Nb theta (lat) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Nb phi (lon) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;nfc&#39;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;--------------------------&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;fmin (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;fmax (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;Nf   :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;thmin (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;thmax (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;Nth  :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;phmin (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;phmax (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span> <span class="s2">&quot;Nph  :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No vsh coefficient calculated yet&quot;</span><span class="p">)</span></div>

    <span class="c1">#@mlab.show</span>
    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">bnewfig</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="n">bcolorbar</span> <span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">btitle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">bcircle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 mayavi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        btitle : boolean</span>
<span class="sd">            display title</span>
<span class="sd">        bcolorbar : boolean</span>
<span class="sd">            display colorbar</span>
<span class="sd">        binteract : boolean </span>
<span class="sd">            enable interactive mode</span>
<span class="sd">        newfig: boolean</span>


<span class="sd">        see also</span>
<span class="sd">        --------</span>

<span class="sd">        antprop.antenna._computemesh</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># k is the frequency index</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">):</span>
            <span class="n">lpshp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="n">sum_index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">lpshp</span><span class="p">))</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">sum_index</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;po&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">po</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">scalar</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computemesh</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bnewfig</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">f</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;opacity&#39;</span><span class="p">):</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">opacity</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mayamesh</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span>
                                   <span class="n">scalars</span><span class="o">=</span> <span class="n">scalar</span><span class="p">,</span>
                                   <span class="n">resolution</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                   <span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span><span class="p">,</span><span class="n">reset_zoom</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Antenna &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>

        <span class="k">if</span> <span class="n">bcolorbar</span> <span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">btitle</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s1">&#39; @ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; GHz&#39;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mf">1.2</span><span class="p">):</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="p">,</span>
                         <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="p">,</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span>
                         <span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;yz&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)),</span>
                         <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="p">,</span>
                         <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> 
                         <span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;xz&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
                         <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> 
                         <span class="p">]</span>
        <span class="c1"># draw 3D circle around pattern</span>
        <span class="k">if</span> <span class="n">bcircle</span><span class="p">:</span>
            <span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span> <span class="o">=</span><span class="n">circle</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">)</span> <span class="c1"># blue</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span> <span class="o">=</span><span class="n">circle</span><span class="p">(</span><span class="s1">&#39;yz&#39;</span><span class="p">)</span> <span class="c1"># red</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span> <span class="o">=</span><span class="n">circle</span><span class="p">(</span><span class="s1">&#39;xz&#39;</span><span class="p">)</span> <span class="c1"># green</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">plot3d</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">zc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">binteract</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outline</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mayamesh</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">,</span> <span class="o">.</span><span class="mi">7</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_outline</span><span class="o">.</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">def</span> <span class="nf">picker_callback</span><span class="p">(</span><span class="n">picker</span><span class="p">):</span>
                <span class="sd">&quot;&quot;&quot; Picker callback: this get called when on pick events.</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="k">if</span> <span class="n">picker</span><span class="o">.</span><span class="n">actor</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mayamesh</span><span class="o">.</span><span class="n">actor</span><span class="o">.</span><span class="n">actors</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_outline</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outline</span><span class="o">.</span><span class="n">visible</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_is_selected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_outline</span><span class="o">.</span><span class="n">visible</span>
            <span class="n">picker</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">on_mouse_pick</span><span class="p">(</span><span class="n">picker_callback</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>




    <span class="k">def</span> <span class="nf">_computemesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; compute mesh from theta phi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz : np.array()</span>
<span class="sd">            default [] : takes center frequency fa[len(fa)/2]</span>
<span class="sd">        po   : np.array()</span>
<span class="sd">            location point of the antenna</span>
<span class="sd">        T    : np.array</span>
<span class="sd">            rotation matrix</span>
<span class="sd">        minr : float</span>
<span class="sd">            minimum radius in meter</span>
<span class="sd">        maxr : float</span>
<span class="sd">            maximum radius in meters</span>
<span class="sd">        tag : string</span>
<span class="sd">        ilog : boolean</span>
<span class="sd">        title : boolean</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        (x, y, z, k)</span>

<span class="sd">        x , y , z values in cartesian axis</span>
<span class="sd">        k frequency point evaluated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fGHz&#39;</span> <span class="p">:[],</span>
                     <span class="s1">&#39;po&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="s1">&#39;T&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                     <span class="s1">&#39;minr&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;maxr&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">,</span>
                     <span class="s1">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.</span><span class="p">,</span>
                     <span class="s1">&#39;tag&#39;</span> <span class="p">:</span> <span class="s1">&#39;Pat&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;txru&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;ilog&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>

                     <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fGHz&#39;</span><span class="p">]</span>
        <span class="n">minr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;minr&#39;</span><span class="p">]</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;maxr&#39;</span><span class="p">]</span>
        <span class="n">tag</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tag&#39;</span><span class="p">]</span>
        <span class="n">ilog</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ilog&#39;</span><span class="p">]</span>
        <span class="n">txru</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;txru&#39;</span><span class="p">]</span>
        <span class="n">scale</span><span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>

        <span class="n">po</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;po&#39;</span><span class="p">]</span>
        <span class="c1"># T is an unitary matrix</span>
        <span class="n">T</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fGHz</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c1"># self.ext == &#39;&#39; &lt;=&gt; mathematically generated =&gt; nf = 1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ext</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="o">&gt;=</span><span class="n">fGHz</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,:,</span><span class="n">txru</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>

        <span class="k">if</span> <span class="n">ilog</span> <span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">!=</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">u</span> <span class="o">=</span> <span class="n">r</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">minr</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxr</span><span class="o">-</span><span class="n">minr</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">scale</span><span class="o">*</span><span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">],</span>
                            <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">],</span>
                            <span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># antenna cs -&gt; glogal cs</span>
        <span class="c1"># q : Nt x Np x 3</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># translation</span>
        <span class="c1">#</span>
        <span class="n">scalar</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>



        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">scalar</span>

<div class="viewcode-block" id="Antenna.show3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="p">[],</span><span class="n">T</span><span class="o">=</span><span class="p">[],</span><span class="n">txru</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 geomview</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : frequency index</span>
<span class="sd">        po : poition of the antenna</span>
<span class="sd">        T  : GCS of the antenna</span>
<span class="sd">        typ : string</span>
<span class="sd">            &#39;G&#39; | &#39;Ft&#39; | &#39;Fp&#39;</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;linear&#39;| &#39;not implemented&#39;</span>
<span class="sd">        silent : boolean</span>
<span class="sd">            True    | False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.sh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; #A.show3()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># 3 axis : nth x nph x nf</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Ft&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Fp&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Ft&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span>

        <span class="c1"># 4 axis : nth x nph x ntxru x nf</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">txru</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Ft&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="p">:</span> <span class="p">,</span><span class="n">txru</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Fp&#39;</span><span class="p">:</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">txru</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">po</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">T</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;antbody&#39;</span>

        <span class="n">geo</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">Geomoff</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="c1"># geo.pattern requires the following shapes</span>
        <span class="c1"># theta (Ntx1)</span>
        <span class="c1"># phi (1xNp)</span>
        <span class="c1">#if len(np.shape(self.theta))==1:</span>
        <span class="c1">#    theta = self.theta[:,None]</span>
        <span class="c1">#else:</span>
        <span class="c1">#    theta=self.theta</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
        <span class="c1">#if len(np.shape(self.phi))==1:</span>
        <span class="c1">#    phi = self.phi[None,:]</span>
        <span class="c1">#else:</span>
        <span class="c1">#    phi=self.phi</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">geo</span><span class="o">.</span><span class="n">pattern</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="n">po</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">minr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">maxr</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c1">#filename = geom_pattern(self.theta, self.phi, V, k, po, minr, maxr, typ)</span>
        <span class="c1">#filename = geom_pattern(self.theta, self.phi, V, k, po, minr, maxr, typ)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">show3</span><span class="p">()</span></div>

<div class="viewcode-block" id="Antenna.plot3d"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.plot3d">[docs]</a>    <span class="k">def</span> <span class="nf">plot3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;Gain&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show 3D pattern in matplotlib</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : frequency index</span>

<span class="sd">        typ =  &#39;Gain&#39;</span>
<span class="sd">            = &#39;Ftheta&#39;</span>
<span class="sd">            = &#39;Fphi&#39;</span>

<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        else    -&gt; simple plot3D</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Gain&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Ftheta&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;Fphi&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]</span>

        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
        <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
        <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="Antenna.pol3d"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.pol3d">[docs]</a>    <span class="k">def</span> <span class="nf">pol3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">St</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Sp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Display polarisation diagram  in 3D</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>

<span class="sd">           k  : int</span>
<span class="sd">               frequency index</span>
<span class="sd">           R  : float</span>
<span class="sd">               radius of the sphere</span>
<span class="sd">           St : int</span>
<span class="sd">               downsampling factor along theta</span>
<span class="sd">           Sp : int</span>
<span class="sd">               downsampling factor along phi</span>
<span class="sd">           silent : Boolean</span>
<span class="sd">               (if True the file is created and not displayed&#39;)</span>

<span class="sd">           The file created is named : Polar{ifreq}.list</span>
<span class="sd">           it is placed in the /geom directory of the project</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;Polar&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10000</span> <span class="o">+</span> <span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s1">&#39;.list&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIST</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">plth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">St</span><span class="p">)</span>
        <span class="n">plph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">Sp</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">plph</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">plth</span><span class="p">:</span>
                <span class="c1">#theta = self.theta[n,0]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c1">#print &quot;m,theta= :&quot;,m,theta*180/np.pi</span>
                <span class="c1">#phi = self.phi[0,m]</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                <span class="c1">#print &quot;n,phi=:&quot;,n,phi*180/np.pi</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">vec_sph</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;{</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">geu</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s2">&quot;geomview &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.mse"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.mse">[docs]</a>    <span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mean square error between original and reconstructed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Fth  : np.array</span>
<span class="sd">        Fph  : np.array</span>
<span class="sd">        N    : int</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate the relative mean square error between original pattern A.Ftheta , A.Fphi and the</span>
<span class="sd">        pattern given as argument of the function  Fth , Fph</span>

<span class="sd">        The mse is evaluated on both polarization and normalized over the energy of each</span>
<span class="sd">        original pattern.</span>

<span class="sd">        The function returns the maximum between those two errors</span>

<span class="sd">        N is a parameter which allows to suppress value at the pole for the calculation of the error</span>
<span class="sd">        if N=0 all values are kept else   N &lt; n &lt; Nt - N</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">)</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># plage de theta (exclusion du pole)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Nt</span> <span class="o">-</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

        <span class="n">Gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphr</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fthr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fthr</span><span class="p">))</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fthr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fphr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">SqGr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Ftho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fpho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Etho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">))</span>
        <span class="n">Epho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>
        <span class="n">Eo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>

        <span class="n">errth</span> <span class="o">=</span> <span class="n">Ftho</span> <span class="o">-</span> <span class="n">Fthr</span>
        <span class="n">errph</span> <span class="o">=</span> <span class="n">Fpho</span> <span class="o">-</span> <span class="n">Fphr</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="n">Errth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)))</span>
        <span class="n">Errph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="c1">#Errth_rel = Errth/Etho</span>
        <span class="c1">#Errph_rel = Errph/Epho</span>
        <span class="n">Errth_rel</span> <span class="o">=</span> <span class="n">Errth</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Errph_rel</span> <span class="o">=</span> <span class="n">Errph</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Err_rel</span> <span class="o">=</span> <span class="n">Err</span> <span class="o">/</span> <span class="n">Eo</span>

        <span class="k">return</span> <span class="n">Err_rel</span><span class="p">,</span> <span class="n">Errth_rel</span><span class="p">,</span> <span class="n">Errph_rel</span></div>

<div class="viewcode-block" id="Antenna.getdelay"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.getdelay">[docs]</a>    <span class="k">def</span> <span class="nf">getdelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delayCandidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.001</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; get electrical delay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        delayCandidates : ndarray dalay in (ns)</span>
<span class="sd">            default np.arange(-10,10,0.001)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        electricalDelay  : float</span>

<span class="sd">        Author : Troels Pedersen (Aalborg University)</span>
<span class="sd">                 B.Uguen</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">maxPowerInd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">))</span>
            <span class="n">elD</span>  <span class="o">=</span> <span class="n">delayCandidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[</span><span class="n">maxPowerInd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">maxPowerInd</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span>
                       <span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
                               <span class="o">*</span><span class="n">delayCandidates</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]))))]</span>
            <span class="c1">#electricalDelay  = delayCandidates[np.argmax(abs(</span>
            <span class="c1">#    np.dot(self.Ft[:,maxPowerInd[1],maxPowerInd[2]]</span>
            <span class="c1">#        ,np.exp(2j*np.pi*freq.reshape(len(freq),1)</span>
            <span class="c1">#          *delayCandidates.reshape(1,len(delayCandidates))))</span>
            <span class="c1">#        ))]</span>
            <span class="k">return</span><span class="p">(</span><span class="n">elD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Antenna has not been evaluated&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.elec_delay"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.elec_delay">[docs]</a>    <span class="k">def</span> <span class="nf">elec_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tau</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; apply an electrical delay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau : float</span>
<span class="sd">            electrical delay in nanoseconds</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">         This function applies an electrical delay math::`\exp{+2 j \pi f \tau)`</span>
<span class="sd">         on the phase of diagram math::``F_{\theta}`` and math::`F_{\phi}`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;S2R2.sh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; A.eval()</span>
<span class="sd">            &gt;&gt;&gt; tau = A.getdelay()</span>
<span class="sd">            &gt;&gt;&gt; A.elec_delay(tau)</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">+</span><span class="n">tau</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span>
            <span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span> <span class="n">tau</span><span class="p">)</span>
            <span class="c1">#E = np.outer(e, ones(sh[1] * sh[2]))</span>
            <span class="c1">#Fth = Ftheta.reshape(sh[0], sh[1] * sh[2])</span>
            <span class="c1">#EFth = Fth * E</span>
            <span class="c1">#self.Ft = EFth.reshape(sh[0], sh[1], sh[2])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="o">*</span><span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="o">*</span><span class="n">e</span>
            <span class="c1">#Fph = Fphi.reshape(sh[0], sh[1] * sh[2])</span>
            <span class="c1">#EFph = Fph * E</span>
            <span class="c1">#self.Fp = EFph.reshape(sh[0], sh[1], sh[2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;antenna has not been evaluated&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Antenna.Fsynth"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="p">[],</span><span class="n">phi</span><span class="o">=</span><span class="p">[],):</span>
        <span class="sd">&quot;&quot;&quot; Perform Antenna synthesis</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : np.array</span>
<span class="sd">        phi :   np.array</span>
<span class="sd">            call Antenna.Fpatt or Antenna.Fsynth3</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The antenna pattern synthesis is done either from spherical</span>
<span class="sd">        harmonics coefficients or from an analytical expression of the</span>
<span class="sd">        radiation pattern.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;vsh&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;ssh&#39;</span><span class="p">)):</span>
            <span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gain</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">Ft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span>
            <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.p&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)()</span>
            <span class="c1">#Ft,Fp = self.Fpatt(theta,phi,pattern)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span><span class="p">)</span></div>


    <span class="c1">#def Fsynth1(self, theta, phi, k=0):</span>

<div class="viewcode-block" id="Antenna.Fsynth1"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth1">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate complex antenna pattern  from VSH Coefficients (shape 1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta  : ndarray (1xNdir)</span>
<span class="sd">        phi    : ndarray (1xNdir)</span>
<span class="sd">        k      : int</span>
<span class="sd">            frequency index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Ft , Fp </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="c1">#Br = self.C.Br.s1[k, :, :]</span>
        <span class="c1">#Bi = self.C.Bi.s1[k, :, :]</span>
        <span class="c1">#Cr = self.C.Cr.s1[k, :, :]</span>
        <span class="c1">#Ci = self.C.Ci.s1[k, :, :]</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N1</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M1</span>
        <span class="c1">#print &quot;N,M&quot;,N,M</span>
        <span class="c1">#</span>
        <span class="c1"># The - sign is necessary to get the good reconstruction</span>
        <span class="c1">#     deduced from observation</span>
        <span class="c1">#     May be it comes from a different definition of theta in SPHEREPACK</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c1">#~ V, W = VW(n, m, x, phi, Pmm1n, Pmp1n)</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># broadcasting along frequency axis</span>
        <span class="c1">#</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1">#   k : frequency axis</span>
        <span class="c1">#   l : coeff l</span>
        <span class="c1">#   m</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s1">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="c1">#Fth = np.dot(Br, np.real(V.T)) - \</span>
        <span class="c1">#    np.dot(Bi, np.imag(V.T)) + \</span>
        <span class="c1">#    np.dot(Ci, np.real(W.T)) + \</span>
        <span class="c1">#    np.dot(Cr, np.imag(W.T))</span>

        <span class="c1">#Fph = -np.dot(Cr, np.real(V.T)) + \</span>
        <span class="c1">#    np.dot(Ci, np.imag(V.T)) + \</span>
        <span class="c1">#    np.dot(Bi, np.real(W.T)) + \</span>
        <span class="c1">#    np.dot(Br, np.imag(W.T))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span></div>


<div class="viewcode-block" id="Antenna.Fsynth2s"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth2s">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coefficients</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phi</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span> <span class="n">phi</span><span class="p">)</span>

        <span class="n">Ndir</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span> <span class="c1"># int</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span> <span class="c1"># int</span>

        <span class="c1">#print &quot;N,M&quot;,N,M</span>
        <span class="c1">#</span>
        <span class="c1"># The - sign is necessary to get the good reconstruction</span>
        <span class="c1">#     deduced from observation</span>
        <span class="c1">#     May be it comes from a different definition of theta in SPHEREPACK</span>

        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW2</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>  <span class="c1"># K2 x Ndir</span>

        <span class="c1"># Fth , Fph are Nf x Ndir</span>

        <span class="n">tEBr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tEBi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tECr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tECi</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K2</span><span class="p">):</span>
            <span class="n">BrVr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BiVi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CiWr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CrWi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>

            <span class="n">CrVr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CiVi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BiWr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BrWi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>

            <span class="n">EBr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BrVr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BrVr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BrWi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BrWi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">EBi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BiVi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BiVi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BiWr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BiWr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">ECr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CrWi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CrWi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CrVr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CrVr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">ECi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CiWr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CiWr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CiVi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CiVi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">tEBr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EBr</span><span class="p">)</span>
            <span class="n">tEBi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EBi</span><span class="p">)</span>
            <span class="n">tECr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ECr</span><span class="p">)</span>
            <span class="n">tECi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ECi</span><span class="p">)</span>

        <span class="c1">#Fth = np.dot(Br, np.real(V.T)) - np.dot(Bi, np.imag(V.T)) + \</span>
        <span class="c1">#      np.dot(Ci, np.real(W.T)) + np.dot(Cr, np.imag(W.T))</span>
        <span class="c1">#Fph = -np.dot(Cr, np.real(V.T)) + np.dot(Ci, np.imag(V.T)) + \</span>
        <span class="c1">#      np.dot(Bi, np.real(W.T)) + np.dot(Br, np.imag(W.T))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tEBr</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tEBi</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tECr</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tECi</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.Fsynth2b"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth2b">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coefficients</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : 1 x Nt</span>
<span class="sd">        phi   : 1 x Np</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span> <span class="c1"># Nf x K2</span>

        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span> <span class="c1"># int</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span> <span class="c1"># int</span>

        <span class="c1">#print &quot;N,M&quot;,N,M</span>
        <span class="c1">#</span>
        <span class="c1"># The - sign is necessary to get the good reconstruction</span>
        <span class="c1">#     deduced from observation</span>
        <span class="c1">#     May be it comes from a different definition of theta in SPHEREPACK</span>

        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW2</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>  <span class="c1"># K2 x Ndir</span>

        <span class="c1"># Fth , Fph are Nf x Ndir</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span></div>

<div class="viewcode-block" id="Antenna.Fsynth2"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth2">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;vsh&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : array 1 x Nt</span>
<span class="sd">        phi : array 1 x Np</span>
<span class="sd">        pattern : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        typ : string</span>
<span class="sd">            {vsh | ssh}</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;vsh&#39;</span> <span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">))</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

            <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span>

            <span class="c1">#print &quot;N,M&quot;,N,M</span>
            <span class="c1">#</span>
            <span class="c1"># The - sign is necessary to get the good reconstruction</span>
            <span class="c1">#     deduced from observation</span>
            <span class="c1">#     May be it comes from a different definition of theta in SPHEREPACK</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

            <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

            <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1">#~ V, W = VW(n, m, x, phi, Pmm1n, Pmp1n)</span>
            <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>


            <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s1">&#39;ssh&#39;</span><span class="p">:</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">cz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">Y</span> <span class="p">,</span><span class="n">indx</span> <span class="o">=</span> <span class="n">SSHFunc</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nth</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nph</span><span class="p">)</span>

            <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span></div>


<div class="viewcode-block" id="Antenna.Fsynth3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.Fsynth3">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="p">[],</span><span class="n">phi</span><span class="o">=</span><span class="p">[],</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;vsh&#39;</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; synthesis of a complex antenna pattern from SH coefficients</span>
<span class="sd">        (vsh or ssh  in shape 3)</span>


<span class="sd">        Ndir is the number of directions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : ndarray (1xNdir if not pattern)  (1xNtheta if pattern)</span>
<span class="sd">        phi   : ndarray (1xNdir if not pattter)  (1xNphi if pattern)</span>

<span class="sd">        pattern : boolean</span>
<span class="sd">            if True theta and phi are reorganized for building the pattern</span>
<span class="sd">        typ  : &#39;vsh&#39; | &#39;ssh&#39; | &#39;hfss&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        if self.grid:</span>
<span class="sd">            Fth   : ndarray (Ntheta x Nphi)</span>
<span class="sd">            Fph   : ndarray (Ntheta x Nphi)</span>
<span class="sd">        else:</span>
<span class="sd">            Fth   : ndarray (1 x Ndir)</span>
<span class="sd">            Fph   : ndarray (1 x Ndir)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel._vec2scalA</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.vsh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; F = A.eval(grid=True)</span>

<span class="sd">        All Br,Cr,Bi,Ci have the same (l,m) index in order to evaluate only</span>
<span class="sd">        once the V,W function</span>

<span class="sd">        If the data comes from a cst file like the antenna used in WHERE1 D4.1</span>
<span class="sd">        the pattern is multiplied by $\frac{4\pi}{120\pi}=\frac{1}{\sqrt{30}$</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#typ = self.typ</span>
        <span class="c1">#self._filename.split(&#39;.&#39;)[1]</span>
        <span class="c1">#if typ==&#39;satimo&#39;:</span>
        <span class="c1">#    coeff=1.</span>
        <span class="c1">#if typ==&#39;cst&#39;:</span>
        <span class="c1">#    coeff=1./sqrt(30)</span>


        <span class="c1">#assert typ in [&#39;ssh&#39;,&#39;vsh&#39;,&#39;hfss&#39;], </span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">)),</span><span class="s2">&quot;No SH coeffs evaluated&quot;</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theta</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">phi</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="c1">#self.theta = theta[:,None]</span>
            <span class="c1">#self.phi = phi[None,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;vsh&#39;</span><span class="p">:</span>

            <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

            <span class="n">Br</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">lBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">mBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">Bi</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">Cr</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">Ci</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">L</span> <span class="o">=</span> <span class="n">lBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">mBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="c1"># vector spherical harmonics basis functions</span>
            <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">lBr</span><span class="p">,</span> <span class="n">mBr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

            <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                   <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                   <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                   <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>

                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;ssh&#39;</span><span class="p">:</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">cz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">Y</span> <span class="p">,</span><span class="n">indx</span> <span class="o">=</span> <span class="n">SSHFunc2</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="c1">#k = self.S.Cx.k2[:,0]</span>
            <span class="c1"># same k for x y and z</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">k2</span>
            <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>
                <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>

                <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

            <span class="c1">#self.Fp = Fph</span>
            <span class="c1">#self.Ft = Fth</span>
            <span class="c1">#G = np.real(Fph * np.conj(Fph) + Fth * np.conj(Fth))</span>
            <span class="c1">#self.sqG = np.sqrt(G)</span>


        <span class="c1">#if self.grid:</span>
        <span class="c1">#    self.Fp = Fph</span>
        <span class="c1">#    self.Ft = Fth</span>
        <span class="c1">#    G = np.real(Fph * np.conj(Fph) + Fth * np.conj(Fth))</span>
        <span class="c1">#    self.sqG = np.sqrt(G)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c1">#if typ == &#39;hfss&#39;:</span>
        <span class="c1">#    scipy.interpolate.griddata()</span>

        <span class="c1">#    Fth = self.Ft</span>
        <span class="c1">#    Fph = self.Fp</span>
        <span class="c1"># TODO create 2 different functions for pattern and not pattern</span>
        <span class="c1">#if not self.grid:</span>
        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span></div>
        <span class="c1">#else:</span>
        <span class="c1">#    return None,None</span>

<div class="viewcode-block" id="Antenna.movie_vsh"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.movie_vsh">[docs]</a>    <span class="k">def</span> <span class="nf">movie_vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; animates vector spherical coeff w.r.t frequency</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;linear&#39; |</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Brmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Brmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Bimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Bimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">Crmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Crmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Cimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Cimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="c1"># print(Brmin, Brmax, Bimin, Bimax, Crmin, Crmax, Cimin, Cimax)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">stf</span> <span class="o">=</span> <span class="s1">&#39; f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; GHz&#39;</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Brmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Brmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="c1">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|Br_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Bimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Bimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="c1">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|Bi_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Crmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Crmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|Cr_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Cimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Cimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c1">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|Ci_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%03d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            <span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">clf</span><span class="p">()</span>

        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;mencoder&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;mf://*.png&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;-mf&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;type=png:w=800:h=600:fps=1&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;-ovc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;lavc&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;-lavcopts&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;vcodec=mpeg4&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;-oac&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;copy&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;-o&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;vshcoeff.avi&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.minsh3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.minsh3">[docs]</a>    <span class="k">def</span> <span class="nf">minsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates vsh3 with significant coeff until given relative reconstruction error</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        emax : float</span>
<span class="sd">            error default 0.05</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        Create antenna&#39;s vsh3 file which only contains</span>
<span class="sd">        the significant vsh coefficients in shape 3,</span>
<span class="sd">        in order to obtain a reconstruction maximal error =  emax</span>

<span class="sd">        This function requires a reading of .trx file before being executed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#th = np.kron(self.theta, np.ones(self.nph))</span>
        <span class="c1">#ph = np.kron(np.ones(self.nth), self.phi)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">Enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">ens3</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Enc</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">emax</span><span class="p">):</span>

            <span class="n">Emin</span> <span class="o">=</span> <span class="n">Enc</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">drag3</span><span class="p">(</span><span class="n">Emin</span><span class="p">)</span>
            <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">emax</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">i3</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
                <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
                <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Antenna.savevsh3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.savevsh3">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save antenna in vsh3 format</span>

<span class="sd">        Create a .vsh3 antenna file</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create vsh3 file</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.vsh3&#39;</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="c1">#filevsh3 = pyu.getlong(self._filename,&#39;ant&#39;)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s1">&#39; already exist&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="s1">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s1">&#39; file&#39;</span><span class="p">)</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.savesh2"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.savesh2">[docs]</a>    <span class="k">def</span> <span class="nf">savesh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save coeff in  .sh2 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create sh2 file</span>
        <span class="c1">#typ = self._filename.split(&#39;.&#39;)[1]</span>
        <span class="c1">#self.typ = typ</span>

        <span class="n">_filesh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;.sh2&#39;</span><span class="p">)</span>
        <span class="n">filesh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh2</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">filesh2</span><span class="p">,</span> <span class="s1">&#39; already exist&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;create &#39;</span><span class="p">,</span> <span class="n">filesh2</span><span class="p">,</span> <span class="s1">&#39; file&#39;</span><span class="p">)</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">lmax</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filesh2</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.savesh3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.savesh3">[docs]</a>    <span class="k">def</span> <span class="nf">savesh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save antenna in sh3 format</span>

<span class="sd">        create a .sh3 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create sh3 file</span>
        <span class="c1"># if self._filename has an extension </span>
        <span class="c1"># it is replace by .sh3</span>
        <span class="c1">#typ = self._filename.split(&#39;.&#39;)[1]</span>
        <span class="c1">#self.typ = typ</span>
        <span class="n">_filesh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;.sh3&#39;</span><span class="p">)</span>
        <span class="n">filesh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh3</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">filesh3</span><span class="p">,</span> <span class="s1">&#39; already exist&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;create &#39;</span><span class="p">,</span> <span class="n">filesh3</span><span class="p">,</span> <span class="s1">&#39; file&#39;</span><span class="p">)</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">ind3</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">k2</span>


            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">lmax</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s3</span>


            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filesh3</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.loadvsh3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadvsh3">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna&#39;s vsh3 file</span>

<span class="sd">            vsh3 file contains a thresholded version of vsh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># This test is to fix a problem with 2 different</span>
            <span class="c1"># behavior of io.loadmat</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># .. Warning</span>
            <span class="c1"># Warning modification takes only one dimension for k</span>
            <span class="c1"># if the .vsh3 format evolve it may not work anymore</span>
            <span class="c1">#</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.loadsh3"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadsh3">[docs]</a>    <span class="k">def</span> <span class="nf">loadsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna&#39;s sh3 file</span>

<span class="sd">            sh3 file contains a thesholded version of ssh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filesh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.sh3&#39;</span>
        <span class="n">filesh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filesh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="c1"># This test is to fix a problem with 2 different</span>
            <span class="c1"># behavior of io.loadmat</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># .. Warning</span>
            <span class="c1"># Warning modification takes only one dimension for k</span>
            <span class="c1"># if the .sh3 format evolve it may not work anymore</span>
            <span class="c1">#</span>


            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">Cx</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.s3&#39;</span><span class="p">],</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.k&#39;</span><span class="p">]))</span>


            <span class="n">Cy</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.s3&#39;</span><span class="p">],</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.k&#39;</span><span class="p">]))</span>



            <span class="n">Cz</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.s3&#39;</span><span class="p">],</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.k&#39;</span><span class="p">]))</span>


            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;S&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">SSHCoeff</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">sets3</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">_filesh3</span><span class="p">,</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.savevsh2"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.savevsh2">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save coeff in  a .vsh2 antenna file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename : string </span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># create vsh2 file</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.trx&#39;</span><span class="p">,</span> <span class="s1">&#39;.vsh2&#39;</span><span class="p">)</span>

        <span class="n">_filevsh2</span>  <span class="o">=</span> <span class="n">filename</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="s1">&#39; already exist&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh2</span><span class="p">,</span> <span class="s1">&#39; file&#39;</span><span class="p">)</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Antenna.loadsh2"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadsh2">[docs]</a>    <span class="k">def</span> <span class="nf">loadsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load  spherical harmonics coefficient in shape  2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filesh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.sh2&#39;</span>
        <span class="n">filesh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh2</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filesh2</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># This test is to fix a problem with 2 different</span>
            <span class="c1"># behavior of io.loadmat</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.lmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


            <span class="n">Cx</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cx.ind&#39;</span><span class="p">])</span>

            <span class="n">Cy</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cy.ind&#39;</span><span class="p">])</span>
            <span class="n">Cz</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cz.ind&#39;</span><span class="p">])</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">SSHCoeff</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">_filesh2</span><span class="p">,</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Antenna.loadvsh2"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadvsh2">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load antenna from .vsh2 file format</span>

<span class="sd">        Load antenna&#39;s vsh2 file which only contains</span>
<span class="sd">        the vsh coefficients in shape 2</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># This test is to fix a problem with 2 different</span>
            <span class="c1"># behavior of io.loadmat</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.ind&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.ind&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.ind&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.ind&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">_filevsh2</span><span class="p">,</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.loadvsh3_old"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.loadvsh3_old">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh3_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna vsh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="mf">8.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Br.k&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Bi.k&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Cr.k&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s1">&#39;Ci.k&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="s1">&#39; does not exist&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.pol2cart"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.pol2cart">[docs]</a>    <span class="k">def</span> <span class="nf">pol2cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts FTheta, FPhi to Fx,Fy,Fz for theta=ith</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ith : theta index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Fx</span>
<span class="sd">        Fy</span>
<span class="sd">        Fz</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        cart2pol</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fx</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fy</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">)</span></div>

<div class="viewcode-block" id="Antenna.cart2pol"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.Antenna.html#pylayers.antprop.antenna.Antenna.cart2pol">[docs]</a>    <span class="k">def</span> <span class="nf">cart2pol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts Fx,Fy,Fz to Ftheta, Fphi for theta=ith</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Fx  : np.array</span>
<span class="sd">        Fy  : np.array</span>
<span class="sd">        Fz  : np.array</span>
<span class="sd">        ith : theta index</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pol2cart</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">Fx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fth</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">SqG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fph</span></div></div>

<div class="viewcode-block" id="forcesympol"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.forcesympol.html#pylayers.antprop.antenna.forcesympol">[docs]</a><span class="k">def</span> <span class="nf">forcesympol</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot VSH transform vsh basis in 3D plot</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    n,m   : integer values (m&lt;=n)</span>
<span class="sd">    theta : ndarray</span>
<span class="sd">    phi   : ndarray</span>
<span class="sd">    sf    : boolean</span>
<span class="sd">        if sf : plotted figures are saved in a *.png file</span>
<span class="sd">        else  : plotted figures aren&#39;t saved</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; import  matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; n=5</span>
<span class="sd">        &gt;&gt;&gt; m=3</span>
<span class="sd">        &gt;&gt;&gt; theta = np.linspace(0,np.pi,30)</span>
<span class="sd">        &gt;&gt;&gt; phi   = np.linspace(0,2*np.pi,60)</span>
<span class="sd">        &gt;&gt;&gt; plotVW(n,m,theta,phi)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># calculate v and w</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">theta</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> \
            <span class="mf">1e-10</span>  <span class="c1"># .. todo :: not clean</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

        <span class="n">Ephi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">cphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>

        <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ephi</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">ve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span>
        <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">EPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">Ephi</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">Y1</span> <span class="o">*</span> <span class="n">EPh</span>
        <span class="c1">#V[np.isinf(V)|isnan(V)]=0</span>
        <span class="n">Vcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">V</span>
        <span class="n">Vsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">V</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#W=np.zeros((len(theta),len(phi)))</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Waux</span> <span class="o">=</span> <span class="n">Y2</span> <span class="o">*</span> <span class="n">EPh</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span> <span class="o">*</span> <span class="n">Waux</span>
        <span class="n">Wcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">W</span>
        <span class="n">Wsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">W</span>

        <span class="c1"># plot V and W</span>
        <span class="n">Ntheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntheta</span><span class="p">)</span>
        <span class="n">Nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nphi</span><span class="p">)</span>
        <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

        <span class="c1">#figdirV=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_V_Vsin_Vcos/&#39;</span>
        <span class="n">figdirV</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>
        <span class="n">ext1</span> <span class="o">=</span> <span class="s1">&#39;.pdf&#39;</span>
        <span class="n">ext2</span> <span class="o">=</span> <span class="s1">&#39;.eps&#39;</span>
        <span class="n">ext3</span> <span class="o">=</span> <span class="s1">&#39;.png&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s1">&#39;Vcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s1">&#39;Vsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="c1">#figdirW=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_W_Wsin_Wcos/&#39;</span>
        <span class="n">figdirW</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s1">&#39;W&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s1">&#39;Wcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s1">&#39;Wsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Error: m&gt;n!!!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="compdiag"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.compdiag.html#pylayers.antprop.antenna.compdiag">[docs]</a><span class="k">def</span> <span class="nf">compdiag</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">Fthr</span><span class="p">,</span> <span class="n">Fphr</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s1">&#39;modulus&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; makes comparison between original pattern and reconstructed pattern</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    k : frequency index</span>
<span class="sd">    A : Antenna</span>

<span class="sd">    ph : phi base      (1 x Np)</span>
<span class="sd">    th : theta base    (1 x Nt)</span>

<span class="sd">    Fthr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>
<span class="sd">    Fphr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>

<span class="sd">    lang = &#39;french&#39;</span>
<span class="sd">         = &#39;english&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Fthr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1">#Fthr = Fthr.reshape(Nf,len(th),len(ph))</span>
    <span class="c1">#Fphr = Fphr.reshape(Nf,len(th),len(ph))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">rc</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">Ftho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Ftheta</span>
    <span class="n">Fpho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Fphi</span>

    <span class="c1"># limites module Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTr</span><span class="p">,</span> <span class="n">maxTo</span><span class="p">)</span>

    <span class="n">minTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTr</span><span class="p">,</span> <span class="n">minTo</span><span class="p">)</span>

    <span class="n">maxPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPr</span><span class="p">,</span> <span class="n">maxPo</span><span class="p">)</span>

    <span class="n">minPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPr</span><span class="p">,</span> <span class="n">minPo</span><span class="p">)</span>

    <span class="c1"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTrr</span><span class="p">,</span> <span class="n">maxTor</span><span class="p">)</span>

    <span class="n">minTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTrr</span><span class="p">,</span> <span class="n">minTor</span><span class="p">)</span>

    <span class="n">maxPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPrr</span><span class="p">,</span> <span class="n">maxPor</span><span class="p">)</span>

    <span class="n">minPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPrr</span><span class="p">,</span> <span class="n">minPor</span><span class="p">)</span>

    <span class="c1"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxToi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTri</span><span class="p">,</span> <span class="n">maxToi</span><span class="p">)</span>

    <span class="n">minTri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minToi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTri</span><span class="p">,</span> <span class="n">minToi</span><span class="p">)</span>

    <span class="n">maxPri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPri</span><span class="p">,</span> <span class="n">maxPoi</span><span class="p">)</span>

    <span class="n">minPri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPri</span><span class="p">,</span> <span class="n">minPoi</span><span class="p">)</span>

    <span class="c1"># limithes arg Fth,Fph</span>
    <span class="n">maxATr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxATo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxATr</span><span class="p">,</span> <span class="n">maxATo</span><span class="p">)</span>
    <span class="n">minATr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minATo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maT0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minATr</span><span class="p">,</span> <span class="n">minATo</span><span class="p">)</span>

    <span class="n">maxAPr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxAPo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxAPr</span><span class="p">,</span> <span class="n">maxAPo</span><span class="p">)</span>
    <span class="n">minAPr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minAPo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maP0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minAPr</span><span class="p">,</span> <span class="n">minAPo</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">rtd</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;modulus&#39;</span><span class="p">:</span>
    <span class="c1">#</span>
    <span class="c1">#cmap=cm.jet</span>
        <span class="c1">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),vmin=0,vmax=mmT)</span>
            <span class="c1">#</span>
    <span class="c1">#cmap= gray</span>
    <span class="c1">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
            <span class="c1">#</span>
    <span class="c1">#cmap=cm.hot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;$|F_{\theta}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
        <span class="c1">#pcolor(A.phi*rtd,A.theta*rtd,real(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Re ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;imag&#39;</span><span class="p">:</span>
        <span class="c1">#pcolor(A.phi*rtd,A.theta*rtd,imag(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Im ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span>
        <span class="c1">#pcolor(A.phi*rtd,A.theta*rtd,angle(Ftho[k,:,:]),cmap=cm.gray_r,vmin=maT0,vmax=maT)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Arg ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Ang ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|F_{\phi}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Re ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Im ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Arg ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ang ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;$|F_{\theta}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;$|F_{\theta}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[:,:,</span><span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Re ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Re ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">k</span> <span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Im ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Im ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Arg ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">r&#39;Ang ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|F_{\phi}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$|F_{\phi}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Re ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Re ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Im ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Im ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span> <span class="p">:,</span> <span class="p">:,</span><span class="n">k</span><span class="p">]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Arg ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ang ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span></div>

<div class="viewcode-block" id="BeamGauss"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.BeamGauss.html#pylayers.antprop.antenna.BeamGauss">[docs]</a><span class="k">def</span> <span class="nf">BeamGauss</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">Gmax</span><span class="o">=</span><span class="mf">19.77</span><span class="p">,</span><span class="n">HPBW_az</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">HPBW_el</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">Tilt</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Beam with a Gaussian shape</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">                </span>
<span class="sd">    theta : float </span>
<span class="sd">          angle in degree</span>
<span class="sd">    phi   : float </span>
<span class="sd">          angle in degree</span>
<span class="sd">    Gmax  : float </span>
<span class="sd">    HPBW_az : float  </span>
<span class="sd">        Half Power Beamwidth azimuth degree</span>
<span class="sd">    HPBW_el : float</span>
<span class="sd">        Half Power Beamwidth elevation degree</span>
<span class="sd">    Tilt : float </span>
<span class="sd">        angle in degree </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
    <span class="n">az</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">-</span><span class="p">(</span><span class="n">Tilt</span><span class="o">+</span><span class="mi">90</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">el</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">phi</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">taz</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">az</span><span class="o">/</span><span class="p">(</span><span class="n">HPBW_az</span><span class="o">*</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">tel</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">el</span><span class="o">/</span><span class="p">(</span><span class="n">HPBW_el</span><span class="o">*</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">Gmax</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">taz</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">tel</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span></div>

<div class="viewcode-block" id="show3D"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.show3D.html#pylayers.antprop.antenna.show3D">[docs]</a><span class="k">def</span> <span class="nf">show3D</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; show 3D matplotlib diagram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    F      : ndarray (Nf,Nt,Np)</span>
<span class="sd">    theta  : ndarray (1xNt)</span>
<span class="sd">        angle</span>
<span class="sd">    phi    : ndarray (1xNp)</span>
<span class="sd">        angle</span>
<span class="sd">    theta  : ndarray (Nt)</span>
<span class="sd">    k      : int</span>
<span class="sd">        frequency index</span>
<span class="sd">    col    : boolean</span>
<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        if col == False -&gt; simple plot3D</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; A = Antenna(&#39;defant.vsh3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A.eval(grid=True)</span>


<span class="sd">    Warnings</span>
<span class="sd">    --------</span>

<span class="sd">        len(theta) must be equal with shape(F)[1]</span>
<span class="sd">        len(phi) must be equal with shape(F)[2]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error: frequency index k not in F defined interval&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nth</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error: shape mistmatch between theta and F&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">nph</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error: shape mistmatch between phi and F&#39;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nth</span><span class="p">)</span>
    <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nph</span><span class="p">)</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
    <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span></div>

<div class="viewcode-block" id="AntPosRot"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.AntPosRot.html#pylayers.antprop.antenna.AntPosRot">[docs]</a><span class="k">class</span> <span class="nc">AntPosRot</span><span class="p">(</span><span class="n">Antenna</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Antenna + position + Rotation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">T</span><span class="p">):</span>
        <span class="n">Antenna</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span> 
    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Antenna</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">interact</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="AntPosRot.field"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.AntPosRot.html#pylayers.antprop.antenna.AntPosRot.field">[docs]</a>    <span class="k">def</span> <span class="nf">field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate field </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        p : np.array (N,3)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rad_to_deg</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">assert</span> <span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="n">dist</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">u</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">u</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">tang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">th</span><span class="p">,</span><span class="n">ph</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#print(&quot;global&quot;,tang*rad_to_deg)</span>
        <span class="n">Rt</span><span class="p">,</span> <span class="n">tangl</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">BTB</span><span class="p">(</span><span class="n">tang</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="c1">#print(&quot;local&quot;,tangl*rad_to_deg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">th</span><span class="o">=</span><span class="n">tangl</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">ph</span><span class="o">=</span><span class="n">tangl</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ft</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Fp</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">])</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1j</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="n">dist</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">/</span><span class="mf">0.3</span><span class="p">)</span><span class="o">/</span><span class="n">dist</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">EP</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">P</span>
        <span class="k">return</span><span class="p">(</span><span class="n">EP</span><span class="p">)</span></div></div>
        <span class="c1">#Rr, rangl = geu.BTB_rx(rang, self.Tr)</span>

<span class="k">def</span> <span class="nf">_gain</span><span class="p">(</span><span class="n">Ft</span><span class="p">,</span><span class="n">Fp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  calculates antenna gain</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    G  : np.array(Nt,Np,Nf) dtype:float</span>
<span class="sd">        linear gain </span>
<span class="sd">              or np.array(Nr,Nf)</span>
<span class="sd">    sqG : np.array(Nt,Np,Nf) dtype:float </span>
<span class="sd">        linear sqare root of gain </span>
<span class="sd">              or np.array(Nr,Nf)</span>
<span class="sd">    efficiency : np.array (,Nf) dtype:float </span>
<span class="sd">        efficiency </span>
<span class="sd">    hpster : np.array (,Nf) dtype:float</span>
<span class="sd">        half power solid angle :  1 ~ 4pi steradian </span>
<span class="sd">    ehpbw : np.array (,Nf) dtyp:float </span>
<span class="sd">        equivalent half power beamwidth (radians)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: </span>
<span class="sd">    </span>
<span class="sd">        G(\theta,phi) = |F_{\\theta}|^2 + |F_{\\phi}|^2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span> <span class="n">Fp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fp</span><span class="p">)</span>
              <span class="o">+</span>  <span class="n">Ft</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ft</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_hpbw</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">ph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; half power beamwidth </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Gain : Ftheta</span>
<span class="sd">        Nt x Np </span>
<span class="sd">    th : np.array</span>
<span class="sd">        ,Nt</span>
<span class="sd">    ph : np.array</span>
<span class="sd">        ,Np</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ehpbw : effective half power beamwidth </span>
<span class="sd">    hpster : half power solid angle (steradians)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">GdBmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">GdB</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">dt</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ph</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
    <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="n">Nf</span> <span class="o">=</span> <span class="n">GdB</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">hpster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
    <span class="n">ehpbw</span>  <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nf</span><span class="p">):</span>
        <span class="n">U</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">GdB</span><span class="p">[:,:,</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:]</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">A</span><span class="o">&gt;</span><span class="p">(</span><span class="n">GdBmax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">U</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">V</span>  <span class="o">=</span> <span class="n">U</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">hpster</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">V</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dp</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">ehpbw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">hpster</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">ehpbw</span><span class="p">,</span><span class="n">hpster</span> 

<span class="k">def</span> <span class="nf">_efficiency</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">ph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; determine antenna efficiency </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Gain : Ftheta</span>
<span class="sd">        Nt x Np </span>
<span class="sd">    th : np.array</span>
<span class="sd">        ,Nt</span>
<span class="sd">    ph : np.array</span>
<span class="sd">        ,Np</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    oefficiency : </span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ph</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
    <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
    <span class="n">Gs</span> <span class="o">=</span> <span class="n">G</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">)[</span><span class="bp">None</span><span class="p">,:,</span><span class="bp">None</span><span class="p">]</span>
    <span class="n">efficiency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Gs</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">dp</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">efficiency</span>

<span class="k">def</span> <span class="nf">_dirmax</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">ph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; determine information in Gmax direction </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Gain : Ftheta</span>
<span class="sd">        Nt x Np </span>
<span class="sd">    th : np.array</span>
<span class="sd">        ,Nt</span>
<span class="sd">    # GdBmax (,Nf)</span>
<span class="sd">    # Get direction of Gmax and get the polarisation state in that direction </span>
<span class="sd">    # </span>
<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">GdBmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">GdB</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">GdB</span><span class="o">==</span><span class="n">GdBmax</span><span class="p">))[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">theta_max</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="n">umax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">phi_max</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[</span><span class="n">umax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">SphericalBasis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">theta_max</span><span class="p">,</span><span class="n">phi_max</span><span class="p">]]))</span>
    <span class="n">sl</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">uth</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">uph</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> 
    <span class="n">el</span> <span class="o">=</span> <span class="n">Ft</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">umax</span><span class="p">)]</span><span class="o">*</span><span class="n">uth</span> <span class="o">+</span> <span class="n">Fp</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">umax</span><span class="p">)]</span><span class="o">*</span><span class="n">uph</span>
    <span class="n">eln</span> <span class="o">=</span> <span class="n">el</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="n">el</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">eln</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
    <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GdBmax</span><span class="p">,</span><span class="n">theta_max</span><span class="p">,</span><span class="n">phi_max</span><span class="p">,(</span><span class="n">hl</span><span class="p">,</span><span class="n">sl</span><span class="p">,</span><span class="n">el</span><span class="p">)</span>

<div class="viewcode-block" id="F0"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.F0.html#pylayers.antprop.antenna.F0">[docs]</a><span class="k">def</span> <span class="nf">F0</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; F0 function for horn antenna pattern </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    nu : np.array </span>
<span class="sd">        (....,nf)</span>
<span class="sd">    sigma : np.array </span>
<span class="sd">        (,nf) </span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    http://www.ece.rutgers.edu/~orfanidi/ewa/ch18.pdf</span>

<span class="sd">    18.3.2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nuos</span>  <span class="o">=</span> <span class="n">nu</span><span class="o">/</span><span class="n">sigma</span>
    <span class="n">argp</span> <span class="o">=</span> <span class="n">nuos</span> <span class="o">+</span> <span class="n">sigma</span>
    <span class="n">argm</span> <span class="o">=</span> <span class="n">nuos</span> <span class="o">-</span> <span class="n">sigma</span>
    <span class="n">expf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">nuos</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sf</span>   <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">sigma</span>
    <span class="n">sp</span> <span class="p">,</span> <span class="n">cp</span> <span class="o">=</span> <span class="n">fresnel</span><span class="p">(</span><span class="n">argp</span><span class="p">)</span>
    <span class="n">sm</span> <span class="p">,</span> <span class="n">cm</span> <span class="o">=</span> <span class="n">fresnel</span><span class="p">(</span><span class="n">argm</span><span class="p">)</span>
    <span class="n">Fp</span> <span class="o">=</span> <span class="n">cp</span><span class="o">-</span><span class="mi">1j</span><span class="o">*</span><span class="n">sp</span>
    <span class="n">Fm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">-</span><span class="mi">1j</span><span class="o">*</span><span class="n">sm</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">sf</span><span class="o">*</span><span class="n">expf</span><span class="o">*</span><span class="p">(</span><span class="n">Fp</span> <span class="o">-</span><span class="n">Fm</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span> </div>

<div class="viewcode-block" id="F1"><a class="viewcode-back" href="../../../api/pylayers.antprop.antenna.F1.html#pylayers.antprop.antenna.F1">[docs]</a><span class="k">def</span> <span class="nf">F1</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; F1 function for horn antenna pattern </span>
<span class="sd">   </span>
<span class="sd">    http://www.ece.rutgers.edu/~orfanidi/ewa/ch18.pdf</span>

<span class="sd">    18.3.3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">F0</span><span class="p">(</span><span class="n">nu</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span><span class="o">+</span><span class="n">F0</span><span class="p">(</span><span class="n">nu</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">sigma</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">F</span></div>

<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Nov 08, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>