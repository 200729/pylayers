<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.antenna &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.antprop.antenna</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">.. currentmodule:: pylayers.antprop.antenna</span>

<span class="sd">This module handles antennas</span>
<span class="sd">An antenna can be loaded from various specific file formats among </span>
<span class="sd">them ( .vsh2 .vsh3 .sh2 .sh3 .mat)</span>


<span class="sd">Antenna Class</span>
<span class="sd">=============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>


<span class="sd">Utility Functions</span>
<span class="sd">-----------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Antenna.__init__</span>
<span class="sd">    Antenna.__repr__</span>
<span class="sd">    Antenna.ls</span>

<span class="sd">    Antenna.errel</span>
<span class="sd">    Antenna.checkpole</span>
<span class="sd">    Antenna.info</span>


<span class="sd">    Antenna.pol2cart</span>
<span class="sd">    Antenna.cart2pol</span>
<span class="sd">    Antenna.minsh3</span>
<span class="sd">    Antenna.mse</span>
<span class="sd">    Antenna.getdelay</span>
<span class="sd">    Antenna.elec_delay</span>

<span class="sd">Synthesis Functions</span>
<span class="sd">-------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Antenna.Fsynth</span>
<span class="sd">    Antenna.Fsynth1</span>
<span class="sd">    Antenna.Fsynth2s</span>
<span class="sd">    Antenna.Fsynth2b</span>
<span class="sd">    Antenna.Fsynth2</span>
<span class="sd">    Antenna.Fsynth3</span>
<span class="sd">    Antenna.Fpatt</span>

<span class="sd">Visualization functions</span>
<span class="sd">-----------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Antenna.pattern</span>
<span class="sd">    Antenna.polar</span>
<span class="sd">    Antenna._show3</span>
<span class="sd">    Antenna.show3</span>
<span class="sd">    Antenna.plot3d</span>
<span class="sd">    Antenna.pol3d</span>
<span class="sd">    Antenna.load_trx</span>
<span class="sd">    Antenna.movie_vsh</span>

<span class="sd">Loading and Saving</span>
<span class="sd">------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Antenna.loadhfss</span>
<span class="sd">    Antenna.loadtrx</span>
<span class="sd">    Antenna.loadmat</span>
<span class="sd">    Antenna.savevsh3</span>
<span class="sd">    Antenna.savesh2</span>
<span class="sd">    Antenna.savesh3</span>
<span class="sd">    Antenna.loadvsh3</span>
<span class="sd">    Antenna.loadsh3</span>
<span class="sd">    Antenna.savevsh2</span>
<span class="sd">    Antenna.loadsh2</span>
<span class="sd">    Antenna.loadvsh2</span>

<span class="sd">Miscellianous  functions</span>
<span class="sd">========================</span>


<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    forcesympol</span>
<span class="sd">    compdiag</span>
<span class="sd">    show3D</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c">#from mayavi import mlab</span>
    <span class="kn">import</span> <span class="nn">mayavi.mlab</span> <span class="kn">as</span> <span class="nn">mlab</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;mayavi not installed&#39;</span>

<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">Image</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="kn">as</span> <span class="nn">special</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.spharm</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">FontProperties</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">axes3d</span>
<span class="c">#from scipy import sparse</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span> <span class="c"># colormaps</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.antssh</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="k">class</span> <span class="nc">Antenna</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Antenna</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    name   : Antenna name</span>

<span class="sd">    Nf     : number of frequency</span>
<span class="sd">    Nt     : number of theta</span>
<span class="sd">    Np     : number of phi</span>

<span class="sd">    Ftheta : Normalized Ftheta    (nf,ntheta,nphi)</span>
<span class="sd">    Fphi   : Normalized Fphi      (nf,ntheta,nphi)</span>
<span class="sd">    SqG    : Square root of gain  (nf,ntheta,nphi)</span>

<span class="sd">    Ttheta : theta                (nf,ntheta,nphi)</span>
<span class="sd">    Tphi   : phi                  (nf,ntheta,nphi)</span>

<span class="sd">    theta  : theta base            1 x ntheta</span>
<span class="sd">    phi    : phi base              1 x phi</span>

<span class="sd">    C      : VSH Coefficients</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    info  : Display information about antenna</span>
<span class="sd">    vsh   : calculates Vector Spherical Harmonics</span>
<span class="sd">    show3 : Geomview diagram</span>
<span class="sd">    plot3d : 3D diagram plotting using matplotlib toolkit</span>
<span class="sd">    Fsynth2 : Antenna F synthesis from coeff in s2</span>

<span class="sd">    Antenna trx file can be stored in various order</span>
<span class="sd">        natural : HFSS</span>
<span class="sd">        bcp     : near filed chamber</span>

<span class="sd">    It is important when initializing an antenna object to be aware of the typ of trx file</span>


<span class="sd">    .trx (ASCII Vectorial antenna Pattern)</span>

<span class="sd">    F   Phi   Theta  Fphi  Ftheta</span>

<span class="sd">    &quot;&quot;&quot;</span>


<div class="viewcode-block" id="Antenna.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.__init__.html#pylayers.antprop.antenna.Antenna.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;S2R2.sh3&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; class constructor</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filename : string</span>
<span class="sd">                    antenna file name</span>
<span class="sd">        directory : str</span>
<span class="sd">                    subdirectory of the current project where to find the antenna file</span>
<span class="sd">                    the file is seek in the $PyProject/ant directory</span>
<span class="sd">        nf        : integer</span>
<span class="sd">                     number of frequency (default 104)</span>
<span class="sd">        ntheta    : integer</span>
<span class="sd">                    number of theta (default 181)</span>
<span class="sd">        nph       : integer</span>
<span class="sd">                    number of phi (default 90)</span>
<span class="sd">        source    : string</span>
<span class="sd">                source of data { &#39;satimo&#39; | &#39;cst&#39; | &#39;hfss&#39; }</span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        There are various supported data formats for storing antenna patterns</span>

<span class="sd">        &#39;mat&#39;: Matlab File</span>
<span class="sd">        &#39;vsh2&#39;: un thresholdes vector spherical coefficients</span>
<span class="sd">        &#39;vsh3&#39;: thresholded vector spherical cpoefficients</span>
<span class="sd">        &#39;trx&#39; : Satimo NFC raw data</span>
<span class="sd">        &#39;trx1&#39; : Satimo NFC raw data  (deprecated)</span>

<span class="sd">         A = Antenna(&#39;my_antenna.mat&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;directory&#39;</span><span class="p">:</span> <span class="s">&#39;ant&#39;</span><span class="p">,</span>
                    <span class="s">&#39;nf&#39;</span><span class="p">:</span><span class="mi">104</span><span class="p">,</span>
                    <span class="s">&#39;source&#39;</span><span class="p">:</span><span class="s">&#39;satimo&#39;</span><span class="p">,</span>
                    <span class="s">&#39;ntheta&#39;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span>
                    <span class="s">&#39;nphi&#39;</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span>
                    <span class="s">&#39;p0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                    <span class="s">&#39;t0&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                    <span class="s">&#39;p3&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span>
                    <span class="s">&#39;t3&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nf&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ntheta&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nphi&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;source&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">AntennaName</span><span class="p">,</span><span class="n">Extension</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">typ</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">Extension</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;vsh3&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh3</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;vsh2&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadvsh2</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;sh3&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadsh3</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;sh2&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadsh2</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;trx1&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_trx</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;directory&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;trx&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadtrx</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;directory&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;mat&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;directory&#39;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;hfss&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadhfss</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">typ</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gauss&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">p0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;p0&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;t0&#39;</span><span class="p">]</span><span class="c">#np.pi/2.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p3</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;p3&#39;</span><span class="p">]</span><span class="c">#np.pi/6. # 30 degrees</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t3</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;t3&#39;</span><span class="p">]</span><span class="c">#np.pi/6. # 30 degrees</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">G</span>  <span class="o">=</span> <span class="mi">16</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span> <span class="c"># gain 16/\theta^{2}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;WirePlate&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p0</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;p0&#39;</span><span class="p">]</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;t0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">t0</span> <span class="o">=</span>  <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;t0&#39;</span><span class="p">]</span><span class="c">#</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span> <span class="o">=</span> <span class="mf">5.</span> <span class="c"># gain</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">G</span>  <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span> <span class="c"># gain</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Omni&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GdB</span>  <span class="o">=</span> <span class="mf">0.</span> <span class="c"># gain</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">G</span>  <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="o">/</span><span class="mf">10.</span><span class="p">)</span> <span class="c"># gain</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&#39;antenna typ is not known&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Antenna.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.__repr__.html#pylayers.antprop.antenna.Antenna.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rtd</span> <span class="o">=</span> <span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;FileName : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;-----------------------</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)):</span>
                    <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;FileName : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;-----------------------</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="c">#st = st + &#39;file type : &#39; + self.typ+&#39;\n&#39;</span>
        <span class="k">if</span> <span class="s">&#39;fa&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;fmin : </span><span class="si">%4.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;GHz</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;fmax : </span><span class="si">%4.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;GHz</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;step : </span><span class="si">%4.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;MHz</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Nf : </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">))</span> <span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;-----------------------</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Ntheta : </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Nphi : </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
                <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ut</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
                <span class="n">uf</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ut</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;satimo&#39;</span><span class="p">:</span>
                <span class="n">GdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
            <span class="c"># see WHERE1 D4.1 sec 3.1.1.2.2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;cst&#39;</span><span class="p">:</span>
                <span class="n">GdB</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;GmaxdB : </span><span class="si">%4.2f</span><span class="s"> dB </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GdB</span><span class="p">)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;   f = </span><span class="si">%4.2f</span><span class="s"> GHz </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">uf</span><span class="p">])</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;   theta = </span><span class="si">%4.2f</span><span class="s"> (degrees) </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ut</span><span class="p">]</span><span class="o">*</span><span class="n">rtd</span><span class="p">)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;   phi = </span><span class="si">%4.2f</span><span class="s">  (degrees) </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">up</span><span class="p">]</span><span class="o">*</span><span class="n">rtd</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Not evaluated</span><span class="se">\n</span><span class="s">&#39;</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;mat&#39;</span><span class="p">:</span>
            <span class="c">#st = st + self.DataFile + &#39;\n&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;antenna name : &#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;date : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Date</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;time : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Notes : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Serie : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Serie</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Run : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Run</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Nb theta (lat) : &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&quot;Nb phi (lon) :&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gauss&#39;</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Gaussian pattern&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;phi0 : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p0</span><span class="p">)</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;theta0 :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;phi 3dB :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;theta 3dB :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Gain dB :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GdB</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;Gain linear :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;sqrt G :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.ls"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.ls.html#pylayers.antprop.antenna.Antenna.ls">[docs]</a>    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;vsh3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the antenna files in antenna project directory</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typ : string optional</span>
<span class="sd">            {&#39;mat&#39;|&#39;trx&#39;|&#39;vsh2&#39;|&#39;sh2&#39;|&#39;vsh3&#39;|&#39;sh3&#39;}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of strdir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;vsh3&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;sh3&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;mat&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;trx&#39;</span><span class="p">:</span>
            <span class="n">pathname</span> <span class="o">=</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;/*.&#39;</span> <span class="o">+</span> <span class="n">typ</span>

        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">basename</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="o">+</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">lfile_s</span>

</div>
    <span class="k">def</span> <span class="nf">photo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="s">&#39;ant/UWBAN/PhotosVideos&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a picture of the antenna &quot;&quot;&quot;</span>

        <span class="n">_filename</span> <span class="o">=</span> <span class="s">&#39;IMG_&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">PhotoFile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.JPG&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">directory</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">I</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<div class="viewcode-block" id="Antenna.Fpatt"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fpatt.html#pylayers.antprop.antenna.Antenna.Fpatt">[docs]</a>    <span class="k">def</span> <span class="nf">Fpatt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">th</span><span class="o">=</span><span class="p">[],</span><span class="n">ph</span><span class="o">=</span><span class="p">[],</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  generate antenna pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        th  :</span>
<span class="sd">        ph  :</span>
<span class="sd">        pattern : boolean</span>
<span class="sd">            default True</span>

<span class="sd">        if pattern</span>
<span class="sd">            The pattern is generated from self.Nt and self.Np points</span>
<span class="sd">        else:</span>
<span class="sd">            phi and theta have the same length (typically ray direction)</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna  import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(typ=&#39;Gauss&#39;)</span>
<span class="sd">            &gt;&gt;&gt; A.Fpatt()</span>
<span class="sd">            &gt;&gt;&gt; f,a = A.polar()</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span> <span class="p">,</span> <span class="s">&#39;Error : this is not a pattern antenna&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">th</span> <span class="o">==</span> <span class="p">[])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ph</span> <span class="o">==</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">th</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">ph</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gauss&#39;</span><span class="p">:</span>


            <span class="n">argth</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">t3</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">p0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">zip</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)))</span>
            <span class="n">argphi</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">p3</span>

            <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span> <span class="p">)</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span> <span class="p">)</span>
                <span class="c">#self.theta=self.th[:,np.newaxis]</span>
                <span class="c">#self.phi=self.ph[np.newaxis,:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:]</span><span class="o">=</span><span class="n">Fap</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argth</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span><span class="o">*</span><span class="n">argphi</span><span class="p">)</span> <span class="p">)</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fat</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fap</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;WirePlate&#39;</span><span class="p">:</span>

            <span class="n">uth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">uth2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">t0</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([[</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="n">p</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">],[</span><span class="n">q</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span><span class="n">q</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">]]))</span>
            <span class="n">Y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sqG</span><span class="p">)]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poly</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>

            <span class="n">argth1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span>
                     <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                             <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth1</span><span class="p">])</span>

            <span class="n">argth2</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">uth2</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">t0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">argth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">argth1</span><span class="p">,</span><span class="n">argth2</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span><span class="n">argth</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="p">(</span><span class="n">argth</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
                <span class="c">#self.theta=self.theta[:,np.newaxis]</span>
                <span class="c">#self.phi=self.ph[np.newaxis,:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:]</span><span class="o">=</span><span class="n">Fap</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="n">argth</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="n">argth</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fat</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Fap</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">))[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Omni&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
                <span class="c">#self.theta = self.theta[:,np.newaxis]</span>
                <span class="c">#self.phi = self.ph[np.newaxis,:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">Fat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">))</span>
                <span class="n">Fap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sqG</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">))</span>

        <span class="c"># TODO create 2 separate functions</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">Fat</span><span class="p">,</span><span class="n">Fap</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Antenna.loadmat"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadmat.html#pylayers.antprop.antenna.Antenna.loadmat">[docs]</a>    <span class="k">def</span> <span class="nf">loadmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;ant&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load an antenna stored in a mat file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str , optional</span>
<span class="sd">            default &#39;ant&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            Read an Antenna file in UWBAN directory and plot a polar plot</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;S1R1.mat&#39;,directory=&#39;ant/UWBAN/Matfile&#39;)</span>
<span class="sd">            &gt;&gt;&gt; f,a = A.polar(phd=0)</span>
<span class="sd">            &gt;&gt;&gt; f,a = A.polar(thd=90,fig=f,ax=a)</span>
<span class="sd">            &gt;&gt;&gt; txt = plt.title(&#39;S1R1 antenna : st loadmat&#39;)</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filemat</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filemat</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filemat</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">struct_as_record</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">_filemat</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.mat&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">ext</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;mat&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Notes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PhotoFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">PhotoFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Serie</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Serie</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Run</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">Run</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">DataFile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">StartTime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">AntennaName</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">freq</span><span class="o">/</span><span class="mf">1.e9</span>
        <span class="c">#self.theta = d.theta[:,np.newaxis]</span>
        <span class="c">#self.phi = d.phi[np.newaxis,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">theta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">phi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Ftheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Fphi</span>
        <span class="n">Gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">)</span> <span class="o">+</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="p">)</span>
        <span class="c">#self.Nt = np.shape(self.theta)[0]</span>
        <span class="c">#self.Np = np.shape(self.phi)[1]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span> <span class="o">==</span>  <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Antenna.load_trx"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.load_trx.html#pylayers.antprop.antenna.Antenna.load_trx">[docs]</a>    <span class="k">def</span> <span class="nf">load_trx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="s">&quot;ant&quot;</span><span class="p">,</span> <span class="n">nf</span><span class="o">=</span><span class="mi">104</span><span class="p">,</span> <span class="n">ntheta</span><span class="o">=</span><span class="mi">181</span><span class="p">,</span> <span class="n">nphi</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a trx file (deprecated)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        directory : str</span>
<span class="sd">                    directory where is located the trx file (default : ant)</span>
<span class="sd">        nf : float</span>
<span class="sd">             number of frequency points</span>
<span class="sd">        ntheta : float</span>
<span class="sd">               number of theta</span>
<span class="sd">        nphi : float</span>
<span class="sd">               number of phi</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ncol</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*$&quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*</span><span class="se">\t</span><span class="s">.*$&quot;&quot;&quot;</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c">#while ((re.search(pattern1,d[k]) is None ) &amp; (re.search(pattern2,d[k]) is None )):</span>
        <span class="k">while</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c"># TODO Parsing the header</span>
        <span class="c">#</span>
        <span class="c">#nf     = 104</span>
        <span class="c">#nphi   = 90</span>
        <span class="c">#ntheta = 181</span>

        <span class="n">N</span> <span class="o">=</span> <span class="n">nf</span> <span class="o">*</span> <span class="n">nphi</span> <span class="o">*</span> <span class="n">ntheta</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">PHI</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">THETA</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">THETA</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">PHI</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tphi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Tf</span> <span class="o">=</span> <span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c">#self.phi     = Tphi[0,0,:]</span>

        <span class="c">#</span>
        <span class="c"># Temporaire</span>
        <span class="c">#</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">A1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="mi">90</span><span class="p">:</span><span class="mi">181</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">A2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">91</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="mi">91</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="mi">104</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Antenna.pattern"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.pattern.html#pylayers.antprop.antenna.Antenna.pattern">[docs]</a>    <span class="k">def</span> <span class="nf">pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">theta</span><span class="o">=</span><span class="p">[],</span><span class="n">phi</span><span class="o">=</span><span class="p">[],</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return multidimensionnal radiation patterns</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta   : array</span>
<span class="sd">            1xNt</span>
<span class="sd">        phi     : array</span>
<span class="sd">            1xNp</span>
<span class="sd">        typ : string</span>
<span class="sd">            {s1|s2|s3}</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">theta</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
        <span class="c">#Th = np.kron(theta, np.ones(Np))</span>
        <span class="c">#Ph = np.kron(np.ones(Nt), phi)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s1&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth1</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s2&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth2b</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s3&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
        <span class="c">#FTh = Fth.reshape(Nf, Nt, Np)</span>
        <span class="c">#FPh = Fph.reshape(Nf, Nt, Np)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">FTh</span><span class="p">,</span><span class="n">FPh</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.errel"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.errel.html#pylayers.antprop.antenna.Antenna.errel">[docs]</a>    <span class="k">def</span> <span class="nf">errel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kf</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;s3&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates error between antenna pattern and reference pattern</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kf  : integer</span>
<span class="sd">            frequency index. If k=-1 integration over all frequency</span>
<span class="sd">        dsf : down sampling factor</span>
<span class="sd">        typ :</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        errelTh : float</span>
<span class="sd">            relative error on :math:`F_{\\theta}`</span>
<span class="sd">        errelPh : float</span>
<span class="sd">            relative error on :math:`F_{\phi}`</span>
<span class="sd">        errel   : float</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        .. math::</span>

<span class="sd">            \epsilon_r^{\\theta} =</span>
<span class="sd">            \\frac{|F_{\\theta}(\\theta,\phi)-\hat{F}_{\\theta}(\\theta)(\phi)|^2}</span>
<span class="sd">                 {|F_{\\theta}(\\theta,\phi)|^2}</span>

<span class="sd">            \epsilon_r^{\phi} =</span>
<span class="sd">            \\frac{|F_{\phi}(\\theta,\phi)-\hat{F}_{\phi}(\\theta)(\phi)|^2}</span>
<span class="sd">                 {|F_{\\theta}(\\theta,\phi)|^2}</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#</span>
        <span class="c"># Retrieve angular bases from the down sampling factor dsf</span>
        <span class="c">#</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="c">#Th = np.kron(theta, np.ones(Np))</span>
        <span class="c">#Ph = np.kron(np.ones(Nt), phi)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s1&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth1</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s2&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth2b</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;s3&#39;</span><span class="p">:</span>
            <span class="n">FTh</span><span class="p">,</span> <span class="n">FPh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c">#FTh = Fth.reshape(self.Nf, Nt, Np)</span>
        <span class="c">#FPh = Fph.reshape(self.Nf, Nt, Np)</span>
        <span class="c">#</span>
        <span class="c">#  Jacobian</span>
        <span class="c">#</span>
        <span class="c">#st    = outer(sin(theta),ones(len(phi)))</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Construct difference between reference and reconstructed</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">kf</span><span class="o">&lt;&gt;-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">dTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FTh</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="n">dPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FPh</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="c">#</span>
            <span class="c"># squaring  + Jacobian</span>
            <span class="c">#</span>
            <span class="n">dTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dTh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dTh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">dPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dPh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dPh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">vTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">vPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">mvTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vTh2</span><span class="p">)</span>
            <span class="n">mvPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vPh2</span><span class="p">)</span>

            <span class="n">errTh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dTh2</span><span class="p">)</span>
            <span class="n">errPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dPh2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FTh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="n">dPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">FPh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">])</span>
            <span class="c">#</span>
            <span class="c"># squaring  + Jacobian</span>
            <span class="c">#</span>
            <span class="n">dTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dTh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dTh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">dPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">dPh</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">dPh</span><span class="p">))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">vTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>
            <span class="n">vPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]</span> \
                 <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">,</span> <span class="p">::</span><span class="n">dsf</span><span class="p">]))</span> <span class="o">*</span> <span class="n">st</span>

            <span class="n">mvTh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vTh2</span><span class="p">)</span>
            <span class="n">mvPh2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vPh2</span><span class="p">)</span>

            <span class="n">errTh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dTh2</span><span class="p">)</span>
            <span class="n">errPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dPh2</span><span class="p">)</span>

        <span class="n">errelTh</span> <span class="o">=</span> <span class="p">(</span><span class="n">errTh</span> <span class="o">/</span> <span class="n">mvTh2</span><span class="p">)</span>
        <span class="n">errelPh</span> <span class="o">=</span> <span class="p">(</span><span class="n">errPh</span> <span class="o">/</span> <span class="n">mvPh2</span><span class="p">)</span>
        <span class="n">errel</span> <span class="o">=</span><span class="p">(</span> <span class="p">(</span><span class="n">errTh</span> <span class="o">+</span> <span class="n">errPh</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mvTh2</span> <span class="o">+</span> <span class="n">mvPh2</span><span class="p">))</span>

        <span class="k">return</span><span class="p">(</span><span class="n">errelTh</span><span class="p">,</span> <span class="n">errelPh</span><span class="p">,</span> <span class="n">errel</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Antenna.loadhfss"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadhfss.html#pylayers.antprop.antenna.Antenna.loadhfss">[docs]</a>    <span class="k">def</span> <span class="nf">loadhfss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lfa</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">Nt</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span><span class="n">Np</span><span class="o">=</span><span class="mi">37</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load antenna from HFSS file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        lfa : list of antenna file</span>
<span class="sd">        Nt  : int</span>
<span class="sd">            Number of angle theta</span>
<span class="sd">        Np  : int</span>
<span class="sd">            Number of angle phi</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        One file per frequency point</span>

<span class="sd">        th , ph , abs_grlz,th_absdB,th_phase,ph_absdB,ph_phase_ax_ratio</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># lfa : list file antenna</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lfa</span><span class="p">)</span>
        <span class="n">fGHz</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lacsv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Fphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lfa</span><span class="p">)):</span>

            <span class="n">fGHz</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">lfa</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.csv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]))</span>
            <span class="n">lacsv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">lfa</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                     <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                     <span class="n">sep</span><span class="o">=</span><span class="s">&#39;,&#39;</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;th&#39;</span><span class="p">,</span><span class="s">&#39;ph&#39;</span><span class="p">,</span><span class="s">&#39;abs_grlz&#39;</span><span class="p">,</span><span class="s">&#39;th_absdB&#39;</span><span class="p">,</span><span class="s">&#39;th_phase&#39;</span><span class="p">,</span><span class="s">&#39;ph_absdB&#39;</span><span class="p">,</span><span class="s">&#39;ph_phase&#39;</span><span class="p">,</span><span class="s">&#39;ax_ratio&#39;</span><span class="p">],</span>
                                     <span class="n">index_col</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

            <span class="n">th</span><span class="o">=</span><span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">th</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="n">ph</span><span class="o">=</span><span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
            <span class="n">Greal</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">abs_grlz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>

            <span class="n">th_dB</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">th_absdB</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>
            <span class="n">ph_dB</span> <span class="o">=</span> <span class="n">lacsv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ph_absdB</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="n">Nt</span><span class="p">)</span>

            <span class="n">th_lin</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">th_dB</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>
            <span class="n">ph_lin</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">ph_dB</span><span class="o">/</span><span class="mf">20.</span><span class="p">)</span>

            <span class="c">#th_phase = lacsv[i].th_phase.reshape(72,37)*np.pi/180.</span>
            <span class="c">#ph_phase = lacsv[i].ph_phase.reshape(72,37)*np.pi/180.</span>
            <span class="c">#axratio=lacsv[i].ax_ratio.reshape(72,37)</span>
            <span class="n">Fphi</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">ph_lin</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Ftheta</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">th_lin</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">SqG</span><span class="p">[</span><span class="n">i</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">Greal</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="c">#self.theta = th[0,:].reshape(Nt,1)</span>
        <span class="c">#self.phi = ph[:,0].reshape(1,Np)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">ph</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">=</span><span class="n">Fphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">=</span><span class="n">Ftheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">=</span><span class="n">SqG</span>


</div>
<div class="viewcode-block" id="Antenna.loadtrx"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadtrx.html#pylayers.antprop.antenna.Antenna.loadtrx">[docs]</a>    <span class="k">def</span> <span class="nf">loadtrx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load trx file (SATIMO Near Field Chamber raw data)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        directory</span>

<span class="sd">        self._filename: short name of the antenna file</span>

<span class="sd">        the file is seek in the $BASENAME/ant directory</span>

<span class="sd">        .. todo:</span>
<span class="sd">            consider using an ini file for the header</span>

<span class="sd">        Trx header structure</span>

<span class="sd">        fmin fmax Nf  phmin   phmax   Nphi    thmin    thmax    Ntheta  #EDelay</span>
<span class="sd">        0     1   2   3       4       5       6        7        8       9</span>
<span class="sd">        1     10  121 0       6.19    72      0        3.14     37      0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filetrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="s">&#39;header_&#39;</span> <span class="o">+</span> <span class="n">_filetrx</span>
        <span class="n">_headtrx</span> <span class="o">=</span> <span class="n">_headtrx</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;trx&#39;</span><span class="p">,</span> <span class="s">&#39;txt&#39;</span><span class="p">)</span>
        <span class="n">headtrx</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_headtrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetrx</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># Trx header structure</span>
    <span class="c">#</span>
    <span class="c"># fmin fmax Nf  phmin   phmax   Nphi    thmin    thmax    Ntheta  #EDelay</span>
    <span class="c"># 0     1   2   3       4       5       6        7        8       9</span>
    <span class="c"># 1     10  121 0       6.19    72      0        3.14     37      0</span>
    <span class="c">#</span>
    <span class="c">#</span>
        <span class="n">foh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">headtrx</span><span class="p">)</span>
        <span class="n">ligh</span> <span class="o">=</span> <span class="n">foh</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">foh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">nf</span>   <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">phmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">phmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">nphi</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">thmin</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">thmax</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">ntheta</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">8</span><span class="p">])</span>
        <span class="c">#</span>
        <span class="c"># The electrical delay in column 9 is optional</span>
        <span class="c">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">ligh</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">9</span><span class="p">])</span>  <span class="c"># tau : delay (ns)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c">#</span>
        <span class="c"># Data are stored in 7 columns</span>
        <span class="c">#</span>
        <span class="c"># 0  1   2     3        4       5       6</span>
        <span class="c"># f  phi th    ReFph   ImFphi  ReFth    ImFth</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fi</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">7</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;float&#39;</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;error : frequency cannot be zero&quot;</span>
        <span class="c"># detect frequency unit</span>
        <span class="c"># if values are above 2000 its means frequency is not expressed</span>
        <span class="c"># in GHz</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="mf">1.0e9</span>

        <span class="n">phi</span>   <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c">#</span>
        <span class="c"># type : refers to the way the angular values are stored in the file</span>
        <span class="c"># Detection of file type</span>
        <span class="c">#</span>
        <span class="c"># Bcp</span>
        <span class="c">#    f  phi theta</span>
        <span class="c">#    2    1    0</span>
        <span class="c"># Natural</span>
        <span class="c">#    f  phi theta</span>
        <span class="c">#    2    0    1</span>
        <span class="c">#</span>
        <span class="c"># auto detect storage mode looping</span>
        <span class="c">#</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;bcp&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtheta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dphi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;natural&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">Fphi</span>   <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="n">Ftheta</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1j</span>
        <span class="c">#</span>
        <span class="c"># Normalization</span>
        <span class="c">#</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Ftheta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">))</span>
        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="c">#Fphi    = Fphi/SqG</span>
        <span class="c">#Ftheta  = Ftheta/SqG</span>
        <span class="c">#Fphi    = Fphi</span>
        <span class="c">#Ftheta  = Ftheta</span>
        <span class="c">#</span>
        <span class="c"># Reshaping</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;natural&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">,</span> <span class="n">nphi</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;bcp&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fphi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Ftheta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">SqG</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nf</span><span class="p">,</span> <span class="n">nphi</span><span class="p">,</span> <span class="n">ntheta</span><span class="p">))</span>
        <span class="c">#</span>
        <span class="c"># Force natural order (f,theta,phi)</span>
        <span class="c"># This is not the order of the satimo nfc which is  (f,phi,theta)</span>
        <span class="c">#</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Ttheta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Tphi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Tf</span> <span class="o">=</span> <span class="n">Tf</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">Tf</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Ttheta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">Tphi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c">#</span>
        <span class="c"># check header consistency</span>
        <span class="c">#</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fmin</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">fmax</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">thmin</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">thmax</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">phmin</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">phmax</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">nf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="n">ntheta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">nphi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Antenna.checkpole"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.checkpole.html#pylayers.antprop.antenna.Antenna.checkpole">[docs]</a>    <span class="k">def</span> <span class="nf">checkpole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kf</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display the reconstructed field on pole for integrity verification</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kf : int</span>
<span class="sd">             frequency index default 0</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ft0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fp0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Ftp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fpp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">kf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Ex0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Ey0</span> <span class="o">=</span> <span class="n">Ft0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fp0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Exp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">Eyp</span> <span class="o">=</span> <span class="n">Ftp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fpp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ex0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ey0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Exp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eyp</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Antenna.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.info.html#pylayers.antprop.antenna.Antenna.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives info about antenna object</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="k">print</span> <span class="s">&quot;type : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;mat&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">DataFile</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">AntennaName</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Date</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">StartTime</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Notes</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Serie</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Run</span>
            <span class="k">print</span> <span class="s">&quot;Nb theta (lat) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
            <span class="k">print</span> <span class="s">&quot;Nb phi (lon) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span><span class="s">&#39;bcp&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;--------------------------&quot;</span>
            <span class="k">print</span> <span class="s">&quot;fmin (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;fmax (GHz) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;Nf   :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span>
            <span class="k">print</span> <span class="s">&quot;thmin (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;thmax (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;Nth  :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
            <span class="k">print</span> <span class="s">&quot;phmin (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;phmax (rad) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;Nph  :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;No vsh coefficient calculated yet&quot;</span>
</div>
<div class="viewcode-block" id="Antenna.polar"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.polar.html#pylayers.antprop.antenna.Antenna.polar">[docs]</a>    <span class="k">def</span> <span class="nf">polar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; antenna 2D polar plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        &#39;fGHz&#39; : frequzncy</span>
<span class="sd">        phd : phi in degrees</span>
<span class="sd">        thd : theta in degrees</span>
<span class="sd">        &#39;GmaxdB&#39;:  max gain to be displayed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        fig</span>
<span class="sd">        ax</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.trx&#39;)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = A.polar(fGHz=[2,3,4],phd=0)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = A.polar(fGHz=[2,3,4],thd=90)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">dtr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;fGHz&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="s">&#39;dyn&#39;</span> <span class="p">:</span> <span class="mi">8</span> <span class="p">,</span>
                    <span class="s">&#39;phd&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s">&#39;legend&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;GmaxdB&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                    <span class="s">&#39;topos&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
                <span class="n">args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;ax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="c">#ax = fig.add_axes([0.1, 0.1, 0.8, 0.8], polar=True, axisbg=&#39;#d5de9c&#39;)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="n">polar</span><span class="o">=</span><span class="bp">True</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;grid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#316931&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
        <span class="n">rc</span><span class="p">(</span><span class="s">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

        <span class="n">DyndB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dyn&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span>
        <span class="n">GmindB</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;GmaxdB&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">DyndB</span>
        <span class="c">#print &quot;DyndB&quot;,DyndB</span>
        <span class="c">#print &quot;GmindB&quot;,GmindB</span>

        <span class="c"># force square figure and square axes looks better for polar, IMO</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">DyndB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;GmaxdB&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>




        <span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">]</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span>
            <span class="n">fstep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="n">fstep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="c">#dtheta = self.theta[1,0]-self.theta[0,0]</span>
        <span class="c">#dphi = self.phi[0,1]-self.phi[0,0]</span>
        <span class="n">dtheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">]:</span>
            <span class="n">ik</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">&lt;</span><span class="n">fstep</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&#39;f = </span><span class="si">%3.2f</span><span class="s"> GHz&#39;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">ik</span><span class="p">])</span>
            <span class="c"># all theta</span>
            <span class="k">if</span> <span class="s">&#39;phd&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
                <span class="c">#iphi1 = np.where(abs(self.phi[0,:]-kwargs[&#39;phd&#39;]*dtr)&lt;dtheta)[0][0]</span>
                <span class="n">iphi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;phd&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span><span class="o">&lt;</span><span class="n">dphi</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">iphi1</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">iphi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">iphi1</span> <span class="o">+</span> <span class="p">(</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

                <span class="c">#   0 &lt; theta &lt; pi/2</span>
                <span class="c">#u1 = np.where((self.theta[:,0] &lt;= np.pi / 2) &amp;</span>
                <span class="c">#              (self.theta[:,0] &gt;= 0))[0]</span>
                <span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#   0:Nt-1</span>
                <span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
                <span class="c">#   pi/2 &lt; theta &lt; pi</span>
                <span class="c">#u3 = np.nonzero((self.theta[:,0] &lt;= np.pi) &amp; ( self.theta[:,0]</span>
                <span class="c">#                                              &gt; np.pi / 2))[0]</span>
                <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;satimo&#39;</span><span class="p">:</span>
                    <span class="n">r1</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">iphi1</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;cst&#39;</span><span class="p">:</span>
                    <span class="n">r1</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">iphi1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>

                <span class="c">#r1  = self.SqG[k,u1[0],iphi1]</span>
                <span class="n">negr1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r1</span><span class="p">[</span><span class="n">negr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;satimo&#39;</span><span class="p">:</span>
                    <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">iphi2</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;cst&#39;</span><span class="p">:</span>
                    <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">iphi2</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                <span class="c">#r2  = self.SqG[k,u2,iphi2]</span>
                <span class="n">negr2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">[</span><span class="n">negr2</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;satimo&#39;</span><span class="p">:</span>
                    <span class="n">r3</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u3</span><span class="p">,</span> <span class="n">iphi1</span><span class="p">]</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="s">&#39;cst&#39;</span><span class="p">:</span>
                    <span class="n">r3</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>  <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">u3</span><span class="p">,</span> <span class="n">iphi1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-12</span><span class="p">)</span>
                <span class="c">#r3  = self.SqG[k,u3[0],iphi1]</span>
                <span class="n">negr3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r3</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r3</span><span class="p">[</span><span class="n">negr3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">r1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">r1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

                <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">330</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">120</span><span class="p">]</span>
                <span class="n">rline2</span><span class="p">,</span> <span class="n">rtext2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">thetagrids</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>

                <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
              <span class="c">#  plt.title(u&#39;V plane $\\theta$ (degrees)&#39;)</span>

            <span class="k">if</span> <span class="s">&#39;thd&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">iphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
                <span class="c">#itheta = np.where(abs(self.theta[:,0]-kwargs[&#39;thd&#39;]*dtr)&lt;dtheta)[0][0]</span>
                <span class="c">#angle = self.phi[0,iphi]</span>
                <span class="n">itheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;thd&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">dtr</span><span class="p">)</span><span class="o">&lt;</span><span class="n">dtheta</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#angle = self.phi[0,iphi]</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">iphi</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">GmindB</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">itheta</span><span class="p">,</span> <span class="n">iphi</span><span class="p">])</span>
                <span class="n">neg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">r</span><span class="p">[</span><span class="n">neg</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="c"># plt.title(u&#39;H plane - $\phi$ degrees&#39;)</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span> <span class="p">,</span> <span class="mi">150</span> <span class="p">,</span> <span class="mi">180</span> <span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span> <span class="p">,</span> <span class="mi">300</span> <span class="p">,</span> <span class="mi">330</span><span class="p">]</span>
                <span class="n">rline2</span><span class="p">,</span> <span class="n">rtext2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">thetagrids</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">cpt</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">chaine</span><span class="p">)</span>
            <span class="n">rline1</span><span class="p">,</span> <span class="n">rtext1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rgrids</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
            <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;legend&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>

    <span class="c">#@mlab.show</span></div>
<div class="viewcode-block" id="Antenna._show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna._show3.html#pylayers.antprop.antenna.Antenna._show3">[docs]</a>    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newfig</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">colorbar</span> <span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="p">[],</span><span class="n">title</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 mayavi</span>

<span class="sd">        fGHz : float</span>
<span class="sd">            frequency</span>
<span class="sd">        title : bool</span>
<span class="sd">            display title</span>
<span class="sd">        colorbar :</span>
<span class="sd">            display colorbar</span>
<span class="sd">        &quot;&quot;&quot;</span>




        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_computemesh</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">newfig</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">f</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mayamesh</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Antenna &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>

        <span class="k">if</span> <span class="n">colorbar</span> <span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s">&#39; @ &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; GHz&#39;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_computemesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; compute mesh from theta phi</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        (x, y, z, k)</span>
<span class="sd">        x , y z value in carteisan axis</span>
<span class="sd">        k frequency point evaluated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;fGHz&#39;</span> <span class="p">:[],</span>
                     <span class="s">&#39;po&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="s">&#39;T&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                     <span class="s">&#39;minr&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                     <span class="s">&#39;maxr&#39;</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">,</span>
                     <span class="s">&#39;tag&#39;</span> <span class="p">:</span> <span class="s">&#39;Pat&#39;</span><span class="p">,</span>
                     <span class="s">&#39;ilog&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                     <span class="s">&#39;title&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s">&#39;ilog&#39;</span><span class="p">:</span><span class="bp">False</span>
                     <span class="p">}</span>


        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">fGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fGHz&#39;</span><span class="p">]</span>
        <span class="n">minr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;minr&#39;</span><span class="p">]</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;maxr&#39;</span><span class="p">]</span>
        <span class="n">tag</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;tag&#39;</span><span class="p">]</span>
        <span class="n">ilog</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ilog&#39;</span><span class="p">]</span>
        <span class="n">po</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;po&#39;</span><span class="p">]</span>
        <span class="c"># T is an unitary matrix</span>
        <span class="n">T</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">fGHz</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fGHz</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">k</span><span class="p">,:,:]</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>

        <span class="k">if</span> <span class="n">ilog</span> <span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">!=</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">():</span>
            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="k">else</span> <span class="p">:</span> <span class="n">u</span> <span class="o">=</span> <span class="n">r</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">minr</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxr</span><span class="o">-</span><span class="n">minr</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> 
        <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> 
        <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> 

        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># antenna cs -&gt; glogal cs</span>
        <span class="c"># q : Nt x Np x 3</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ij,klj-&gt;kli&#39;</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># translation</span>
        <span class="c">#</span>
        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span>

<div class="viewcode-block" id="Antenna.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.show3.html#pylayers.antprop.antenna.Antenna.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="p">[],</span><span class="n">T</span><span class="o">=</span><span class="p">[],</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;Gain&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 geomview</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : frequency index</span>
<span class="sd">        po : poition of the antenna</span>
<span class="sd">        T  : GCS of the antenna</span>
<span class="sd">        typ : string</span>
<span class="sd">            &#39;Gain&#39; | &#39;Ftheta&#39; | &#39;Fphi&#39;</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;linear&#39;| &#39;not implemented&#39;</span>
<span class="sd">        silent : boolean</span>
<span class="sd">            True    | False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.trx&#39;)</span>
<span class="sd">            &gt;&gt;&gt; #A.show3()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gain&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Ftheta&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Fphi&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">po</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">po</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">T</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="n">_filename</span> <span class="o">=</span> <span class="s">&#39;antbody&#39;</span>

        <span class="n">geo</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">Geomoff</span><span class="p">(</span><span class="n">_filename</span><span class="p">)</span>
        <span class="c"># geo.pattern requires the following shapes</span>
        <span class="c"># theta (Ntx1)</span>
        <span class="c"># phi (1xNp)</span>
        <span class="c">#if len(np.shape(self.theta))==1:</span>
        <span class="c">#    theta = self.theta[:,np.newaxis]</span>
        <span class="c">#else:</span>
        <span class="c">#    theta=self.theta</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
        <span class="c">#if len(np.shape(self.phi))==1:</span>
        <span class="c">#    phi = self.phi[np.newaxis,:]</span>
        <span class="c">#else:</span>
        <span class="c">#    phi=self.phi</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">geo</span><span class="o">.</span><span class="n">pattern</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="n">po</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">minr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">maxr</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="c">#filename = geom_pattern(self.theta, self.phi, V, k, po, minr, maxr, typ)</span>
        <span class="c">#filename = geom_pattern(self.theta, self.phi, V, k, po, minr, maxr, typ)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">geo</span><span class="o">.</span><span class="n">show3</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Antenna.plot3d"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.plot3d.html#pylayers.antprop.antenna.Antenna.plot3d">[docs]</a>    <span class="k">def</span> <span class="nf">plot3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;Gain&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show 3D pattern in matplotlib</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        k : frequency index</span>

<span class="sd">        typ = &#39;Gain&#39;</span>
<span class="sd">             = &#39;Ftheta&#39;</span>
<span class="sd">             = &#39;Fphi&#39;</span>

<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        else    -&gt; simple plot3D</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Gain&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Ftheta&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;Fphi&#39;</span><span class="p">:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
        <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
        <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">col</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Antenna.pol3d"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.pol3d.html#pylayers.antprop.antenna.Antenna.pol3d">[docs]</a>    <span class="k">def</span> <span class="nf">pol3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">St</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Sp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Display polarisation diagram  in 3D</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>

<span class="sd">           k  : int</span>
<span class="sd">               frequency index</span>
<span class="sd">           R  : float</span>
<span class="sd">                Radius of the sphere</span>
<span class="sd">           St : int</span>
<span class="sd">               Downsampling factor along theta</span>
<span class="sd">           Sp : int</span>
<span class="sd">               Downsampling factor along phi</span>
<span class="sd">           silent : Boolean</span>
<span class="sd">                (If True the file is created and not displayed&#39;)</span>

<span class="sd">           The file created is named : Polar{ifreq}.list</span>
<span class="sd">           it is placed in the /geom directory of the project</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="s">&#39;Polar&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">10000</span> <span class="o">+</span> <span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;LIST</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">plth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">St</span><span class="p">)</span>
        <span class="n">plph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Np</span><span class="p">,</span> <span class="n">Sp</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">plph</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">plth</span><span class="p">:</span>
                <span class="c">#theta = self.theta[n,0]</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="c">#print &quot;m,theta= :&quot;,m,theta*180/np.pi</span>
                <span class="c">#phi = self.phi[0,m]</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                <span class="c">#print &quot;n,phi=:&quot;,n,phi*180/np.pi</span>
                <span class="n">B</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">vec_sph</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)))</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="n">geu</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">],</span> <span class="n">N</span><span class="p">)</span>
                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;}</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">silent</span><span class="p">:</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.mse"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.mse.html#pylayers.antprop.antenna.Antenna.mse">[docs]</a>    <span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mean square error between original and reconstructed</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Fth  : np.array</span>
<span class="sd">        Fph  : np.array</span>
<span class="sd">        N    : int</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate the relative mean square error between original pattern A.Ftheta , A.Fphi and the</span>
<span class="sd">        pattern given as argument of the function  Fth , Fph</span>

<span class="sd">        The mse is evaluated on both polarization and normalized over the energy of each</span>
<span class="sd">        original pattern.</span>

<span class="sd">        The function returns the maximum between those two errors</span>

<span class="sd">        N is a parameter which allows to suppress value at the pole for the calculation of the error</span>
<span class="sd">        if N=0 all values are kept else   N &lt; n &lt; Nt - N</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">)</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="n">sh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c"># plage de theta (exclusion du pole)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Nt</span> <span class="o">-</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span>

        <span class="n">Gr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fphr</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fthr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fthr</span><span class="p">))</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Gr</span><span class="p">)</span>

        <span class="n">Fthr</span> <span class="o">=</span> <span class="n">Fthr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fphr</span> <span class="o">=</span> <span class="n">Fphr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGr</span> <span class="o">=</span> <span class="n">SqGr</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Ftho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Fpho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">SqGo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:,</span> <span class="n">pt</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">Etho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">))</span>
        <span class="n">Epho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>
        <span class="n">Eo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Ftho</span><span class="p">),</span> <span class="n">Ftho</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fpho</span><span class="p">),</span> <span class="n">Fpho</span><span class="p">))</span>

        <span class="n">errth</span> <span class="o">=</span> <span class="n">Ftho</span> <span class="o">-</span> <span class="n">Fthr</span>
        <span class="n">errph</span> <span class="o">=</span> <span class="n">Fpho</span> <span class="o">-</span> <span class="n">Fphr</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="n">Errth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errth</span><span class="p">),</span> <span class="n">errth</span><span class="p">)))</span>
        <span class="n">Errph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">errph</span><span class="p">),</span> <span class="n">errph</span><span class="p">)))</span>

        <span class="c">#Errth_rel = Errth/Etho</span>
        <span class="c">#Errph_rel = Errph/Epho</span>
        <span class="n">Errth_rel</span> <span class="o">=</span> <span class="n">Errth</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Errph_rel</span> <span class="o">=</span> <span class="n">Errph</span> <span class="o">/</span> <span class="n">Eo</span>
        <span class="n">Err_rel</span> <span class="o">=</span> <span class="n">Err</span> <span class="o">/</span> <span class="n">Eo</span>

        <span class="k">return</span> <span class="n">Err_rel</span><span class="p">,</span> <span class="n">Errth_rel</span><span class="p">,</span> <span class="n">Errph_rel</span>
</div>
<div class="viewcode-block" id="Antenna.getdelay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.getdelay.html#pylayers.antprop.antenna.Antenna.getdelay">[docs]</a>    <span class="k">def</span> <span class="nf">getdelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delayCandidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">0.001</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; get electrical delay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        delayCandidates : ndarray</span>
<span class="sd">            default np.arange(-10,10,0.001)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        electricalDelay  : float</span>

<span class="sd">        Author : Troels Pedersen (Aalborg University)</span>
<span class="sd">                 B.Uguen</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">maxPowerInd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">))</span>
            <span class="n">elD</span>  <span class="o">=</span> <span class="n">delayCandidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span><span class="n">maxPowerInd</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">maxPowerInd</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                       <span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
                               <span class="o">*</span><span class="n">delayCandidates</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]))))]</span>
            <span class="c">#electricalDelay  = delayCandidates[np.argmax(abs(</span>
            <span class="c">#    np.dot(self.Ftheta[:,maxPowerInd[1],maxPowerInd[2]]</span>
            <span class="c">#        ,np.exp(2j*np.pi*freq.reshape(len(freq),1)</span>
            <span class="c">#          *delayCandidates.reshape(1,len(delayCandidates))))</span>
            <span class="c">#        ))]</span>
            <span class="k">return</span><span class="p">(</span><span class="n">elD</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;Antenna has not been evaluated&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.elec_delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.elec_delay.html#pylayers.antprop.antenna.Antenna.elec_delay">[docs]</a>    <span class="k">def</span> <span class="nf">elec_delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tau</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; apply an electrical delay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        tau : float</span>
<span class="sd">            electrical delay in nanoseconds</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">         This function applies an electrical delay math::`\exp{+2 j \pi f \tau)`</span>
<span class="sd">         on the phase of diagram math::``F_{\theta}`` and math::`F_{\phi}`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;S2R2.sh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; A.Fsynth()</span>
<span class="sd">            &gt;&gt;&gt; tau = A.getdelay()</span>
<span class="sd">            &gt;&gt;&gt; A.elec_delay(tau)</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">+</span><span class="n">tau</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span>
            <span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span>
            <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Ftheta</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">1j</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span> <span class="n">tau</span><span class="p">)</span>
            <span class="c">#E = np.outer(e, ones(sh[1] * sh[2]))</span>
            <span class="c">#Fth = Ftheta.reshape(sh[0], sh[1] * sh[2])</span>
            <span class="c">#EFth = Fth * E</span>
            <span class="c">#self.Ftheta = EFth.reshape(sh[0], sh[1], sh[2])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="o">*</span><span class="n">e</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="o">*</span><span class="n">e</span>
            <span class="c">#Fph = Fphi.reshape(sh[0], sh[1] * sh[2])</span>
            <span class="c">#EFph = Fph * E</span>
            <span class="c">#self.Fphi = EFph.reshape(sh[0], sh[1], sh[2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s">&#39;antenna has not been evaluated&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Antenna.Fsynth"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth.html#pylayers.antprop.antenna.Antenna.Fsynth">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">phi</span><span class="o">=</span><span class="p">[],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Perform Antenna synthesis</span>
<span class="sd">            call Antenna.Fpatt or Antenna.Fsynth3</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fpatt</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="p">)</span>


    <span class="c">#def Fsynth1(self, theta, phi, k=0):</span></div>
<div class="viewcode-block" id="Antenna.Fsynth1"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth1.html#pylayers.antprop.antenna.Antenna.Fsynth1">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate complex antenna pattern  from VSH Coefficients (shape 1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta  : ndarray (1xNdir)</span>
<span class="sd">        phi    : ndarray (1xNdir)</span>
<span class="sd">        k      : int</span>
<span class="sd">            frequency index</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="c">#Br = self.C.Br.s1[k, :, :]</span>
        <span class="c">#Bi = self.C.Bi.s1[k, :, :]</span>
        <span class="c">#Cr = self.C.Cr.s1[k, :, :]</span>
        <span class="c">#Ci = self.C.Ci.s1[k, :, :]</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span>

        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N1</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M1</span>
        <span class="c">#print &quot;N,M&quot;,N,M</span>
        <span class="c">#</span>
        <span class="c"># The - sign is necessary to get the good reconstruction</span>
        <span class="c">#     deduced from observation</span>
        <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="c">#~ V, W = VW(n, m, x, phi, Pmm1n, Pmp1n)</span>
        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c"># broadcasting along frequency axis</span>
        <span class="c">#</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c">#</span>
        <span class="c">#   k : frequency axis</span>
        <span class="c">#   l : coeff l</span>
        <span class="c">#   m</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Cr</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Ci</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Bi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">eisum</span><span class="p">(</span><span class="s">&#39;klm,kilm-&gt;ki&#39;</span><span class="p">,</span><span class="n">Br</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="c">#Fth = np.dot(Br, np.real(V.T)) - \</span>
        <span class="c">#    np.dot(Bi, np.imag(V.T)) + \</span>
        <span class="c">#    np.dot(Ci, np.real(W.T)) + \</span>
        <span class="c">#    np.dot(Cr, np.imag(W.T))</span>

        <span class="c">#Fph = -np.dot(Cr, np.real(V.T)) + \</span>
        <span class="c">#    np.dot(Ci, np.imag(V.T)) + \</span>
        <span class="c">#    np.dot(Bi, np.real(W.T)) + \</span>
        <span class="c">#    np.dot(Br, np.imag(W.T))</span>

        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
            <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>


</div>
<div class="viewcode-block" id="Antenna.Fsynth2s"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth2s.html#pylayers.antprop.antenna.Antenna.Fsynth2s">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dsf</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coefficients</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        phi</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">[::</span><span class="n">dsf</span><span class="p">]</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span> <span class="n">phi</span><span class="p">)</span>

        <span class="n">Ndir</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span> <span class="c"># int</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span> <span class="c"># int</span>

        <span class="c">#print &quot;N,M&quot;,N,M</span>
        <span class="c">#</span>
        <span class="c"># The - sign is necessary to get the good reconstruction</span>
        <span class="c">#     deduced from observation</span>
        <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>

        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW2</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>  <span class="c"># K2 x Ndir</span>

        <span class="c"># Fth , Fph are Nf x Ndir</span>

        <span class="n">tEBr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tEBi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tECr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tECi</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K2</span><span class="p">):</span>
            <span class="n">BrVr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BiVi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CiWr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CrWi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>

            <span class="n">CrVr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">CiVi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BiWr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>
            <span class="n">BrWi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)[</span><span class="n">k</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Ndir</span><span class="p">))</span>

            <span class="n">EBr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BrVr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BrVr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BrWi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BrWi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">EBi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BiVi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BiVi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">BiWr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">BiWr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">ECr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CrWi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CrWi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CrVr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CrVr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">ECi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CiWr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CiWr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span> <span class="o">+</span> \
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">CiVi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">CiVi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>

            <span class="n">tEBr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EBr</span><span class="p">)</span>
            <span class="n">tEBi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">EBi</span><span class="p">)</span>
            <span class="n">tECr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ECr</span><span class="p">)</span>
            <span class="n">tECi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ECi</span><span class="p">)</span>

        <span class="c">#Fth = np.dot(Br, np.real(V.T)) - np.dot(Bi, np.imag(V.T)) + \</span>
        <span class="c">#      np.dot(Ci, np.real(W.T)) + np.dot(Cr, np.imag(W.T))</span>
        <span class="c">#Fph = -np.dot(Cr, np.real(V.T)) + np.dot(Ci, np.imag(V.T)) + \</span>
        <span class="c">#      np.dot(Bi, np.real(W.T)) + np.dot(Br, np.imag(W.T))</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tEBr</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tEBi</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tECr</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tECi</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.Fsynth2b"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth2b.html#pylayers.antprop.antenna.Antenna.Fsynth2b">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coefficients</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : 1 x Nt</span>
<span class="sd">        phi   : 1 x Np</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

        <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>
        <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span> <span class="c"># Nf x K2</span>

        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span> <span class="c"># int</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span> <span class="c"># int</span>

        <span class="c">#print &quot;N,M&quot;,N,M</span>
        <span class="c">#</span>
        <span class="c"># The - sign is necessary to get the good reconstruction</span>
        <span class="c">#     deduced from observation</span>
        <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>

        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW2</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span><span class="p">)</span>  <span class="c"># K2 x Ndir</span>

        <span class="c"># Fth , Fph are Nf x Ndir</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
            <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>
</div>
<div class="viewcode-block" id="Antenna.Fsynth2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth2.html#pylayers.antprop.antenna.Antenna.Fsynth2">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;vsh&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  pattern synthesis from shape 2 vsh coeff</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : array 1 x Nt</span>
<span class="sd">        phi : array 1 x Np</span>
<span class="sd">        pattern : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        typ : string</span>
<span class="sd">            {vsh | ssh}</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Calculate complex antenna pattern from VSH Coefficients (shape 2)</span>
<span class="sd">        for the specified directions (theta,phi)</span>
<span class="sd">        theta and phi arrays needs to have the same size</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;vsh&#39;</span> <span class="p">:</span>

            <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">))</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>

            <span class="n">Br</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">N2</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">M2</span>

            <span class="c">#print &quot;N,M&quot;,N,M</span>
            <span class="c">#</span>
            <span class="c"># The - sign is necessary to get the good reconstruction</span>
            <span class="c">#     deduced from observation</span>
            <span class="c">#     May be it comes from a different definition of theta in SPHEREPACK</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

            <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre3</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">index_vsh</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

            <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c">#~ V, W = VW(n, m, x, phi, Pmm1n, Pmp1n)</span>
            <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>


            <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">cz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">Y</span> <span class="p">,</span><span class="n">indx</span> <span class="o">=</span> <span class="n">SSHFunc</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
            <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>
            <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span>

            <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>

</div>
<div class="viewcode-block" id="Antenna.Fsynth3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.Fsynth3.html#pylayers.antprop.antenna.Antenna.Fsynth3">[docs]</a>    <span class="k">def</span> <span class="nf">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">phi</span><span class="o">=</span><span class="p">[],</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;sh3&#39;</span><span class="p">):</span>
        <span class="sd">r&quot;&quot;&quot; synthesis of a complex antenna pattern from VSH coefficients (shape 3)</span>


<span class="sd">        Ndir is the number of directions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        theta : ndarray (1xNdir if not pattern)  (1xNtheta if pattern)</span>
<span class="sd">        phi   : ndarray (1xNdir if not pattter)  (1xNphi if pattern)</span>

<span class="sd">        pattern : boolean</span>
<span class="sd">            if True theta and phi are reorganized for building the pattern</span>
<span class="sd">        typ  : &#39;vsh3&#39; | &#39;sh3&#39; | &#39;hfss&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        if pattern:</span>
<span class="sd">            Fth   : ndarray (Ntheta x Nphi)</span>
<span class="sd">            Fph   : ndarray (Ntheta x Nphi)</span>
<span class="sd">        else:</span>
<span class="sd">            Fth   : ndarray (1 x Ndir)</span>
<span class="sd">            Fph   : ndarray (1 x Ndir)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel._vec2scalA</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">            &gt;&gt;&gt; A = Antenna(&#39;defant.vsh3&#39;)</span>
<span class="sd">            &gt;&gt;&gt; theta = np.linspace(0,np.pi,70)</span>
<span class="sd">            &gt;&gt;&gt; phi = np.linspace(0,2*np.pi,180)</span>
<span class="sd">            &gt;&gt;&gt; F = A.Fsynth3(theta,phi,pattern=True)</span>

<span class="sd">        All Br,Cr,Bi,Ci have the same (l,m) index in order to evaluate only</span>
<span class="sd">        once the V,W function</span>

<span class="sd">        If the data comes from a cst file like the antenna used in WHERE1 D4.1</span>
<span class="sd">        the pattern is multiplied by $\frac{4\pi}{120\pi}=\frac{1}{\sqrt{30}$</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="c">#self._filename.split(&#39;.&#39;)[1]</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;satimo&#39;</span><span class="p">:</span>
            <span class="n">coeff</span><span class="o">=</span><span class="mf">1.</span>
        <span class="k">if</span> <span class="n">typ</span><span class="o">==</span><span class="s">&#39;cst&#39;</span><span class="p">:</span>
            <span class="n">coeff</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;sh3&#39;</span><span class="p">,</span><span class="s">&#39;vsh3&#39;</span><span class="p">],</span> <span class="s">&quot;Error wrong file type&quot;</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">theta</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">theta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">45</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">phi</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">90</span><span class="p">)</span>

        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="c">#self.theta = theta[:,np.newaxis]</span>
            <span class="c">#self.phi = phi[np.newaxis,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">phi</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Np</span><span class="p">))</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nt</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span><span class="s">&#39;vsh3&#39;</span><span class="p">:</span>

            <span class="n">nray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

            <span class="n">Br</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">lBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">mBr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">Bi</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">Cr</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">Ci</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">L</span> <span class="o">=</span> <span class="n">lBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">mBr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="c"># vector spherical harmonics basis functions</span>

            <span class="n">V</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">VW</span><span class="p">(</span><span class="n">lBr</span><span class="p">,</span> <span class="n">mBr</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
            <span class="n">Fth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Cr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Bi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">pattern</span><span class="p">:</span>

                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span> <span class="n">Nt</span><span class="p">,</span> <span class="n">Np</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;sh3&#39;</span><span class="p">:</span>
            <span class="n">cx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">cz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s3</span>

            <span class="n">lmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">Y</span> <span class="p">,</span><span class="n">indx</span> <span class="o">=</span> <span class="n">SSHFunc2</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="c">#k = self.S.Cx.k2[:,0]</span>
            <span class="c"># same k for x y and z</span>
            <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">k2</span>
            <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>
                <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
                <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fth</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>
                <span class="n">Fph</span> <span class="o">=</span> <span class="n">Fph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Nf</span><span class="p">,</span><span class="n">Nt</span><span class="p">,</span><span class="n">Np</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>

                <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cy</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Ez</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span><span class="n">Y</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">Fth</span><span class="p">,</span><span class="n">Fph</span> <span class="o">=</span> <span class="n">CartToSphere</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span><span class="n">Ez</span><span class="p">,</span> <span class="n">bfreq</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pattern</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Fth</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fth</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">pattern</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span> <span class="o">=</span> <span class="n">Fph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span> <span class="o">=</span> <span class="n">Fth</span>
            <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fth</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;hfss&#39;</span><span class="p">:</span>
            <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">griddata</span><span class="p">()</span>

            <span class="n">Fth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span>
            <span class="n">Fph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span>
        <span class="c"># TODO create 2 different functions for pattern and not pattern</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Fth</span><span class="p">,</span> <span class="n">Fph</span>

</div>
<div class="viewcode-block" id="Antenna.movie_vsh"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.movie_vsh.html#pylayers.antprop.antenna.Antenna.movie_vsh">[docs]</a>    <span class="k">def</span> <span class="nf">movie_vsh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; animates vector spherical coeff w.r.t frequency</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;linear&#39; |</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Brmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Brmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Bimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Bimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">Crmin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Crmax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">Cimin</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">Cimax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="k">print</span> <span class="n">Brmin</span><span class="p">,</span> <span class="n">Brmax</span><span class="p">,</span> <span class="n">Bimin</span><span class="p">,</span> <span class="n">Bimax</span><span class="p">,</span> <span class="n">Crmin</span><span class="p">,</span> <span class="n">Crmax</span><span class="p">,</span> <span class="n">Cimin</span><span class="p">,</span> <span class="n">Cimax</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nf</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">stf</span> <span class="o">=</span> <span class="s">&#39; f=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39; GHz&#39;</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Brmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Brmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="c">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Br_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Bimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Bimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="c">#xlabel(&#39;m&#39;,fontsize=12)</span>
            <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Bi_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Crmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Crmax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Cr_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
            <span class="n">pcolor</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s1</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">]),</span>
                   <span class="n">vmin</span><span class="o">=</span><span class="n">Cimin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">Cimax</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="c">#ylabel(&#39;n&#39;,fontsize=12)</span>
            <span class="n">title</span><span class="p">(</span><span class="s">&#39;$|Ci_{n}^{(m)}|$&#39;</span> <span class="o">+</span> <span class="n">stf</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">colorbar</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%03d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span>
            <span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="n">clf</span><span class="p">()</span>

        <span class="n">command</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;mencoder&#39;</span><span class="p">,</span>
                   <span class="s">&#39;mf://*.png&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-mf&#39;</span><span class="p">,</span>
                   <span class="s">&#39;type=png:w=800:h=600:fps=1&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-ovc&#39;</span><span class="p">,</span>
                   <span class="s">&#39;lavc&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-lavcopts&#39;</span><span class="p">,</span>
                   <span class="s">&#39;vcodec=mpeg4&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-oac&#39;</span><span class="p">,</span>
                   <span class="s">&#39;copy&#39;</span><span class="p">,</span>
                   <span class="s">&#39;-o&#39;</span><span class="p">,</span>
                   <span class="s">&#39;vshcoeff.avi&#39;</span><span class="p">)</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.minsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.minsh3.html#pylayers.antprop.antenna.Antenna.minsh3">[docs]</a>    <span class="k">def</span> <span class="nf">minsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates vsh3 with significant coeff until given relative reconstruction error</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        emax : float</span>
<span class="sd">            error default 0.05</span>

<span class="sd">        Summary</span>
<span class="sd">        -------</span>

<span class="sd">        Create antenna&#39;s vsh3 file which only contains</span>
<span class="sd">        the significant vsh coefficients in shape 3,</span>
<span class="sd">        in order to obtain a reconstruction maximal error =  emax</span>

<span class="sd">        This function requires a reading of .trx file before being executed</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#th = np.kron(self.theta, np.ones(self.Np))</span>
        <span class="c">#ph = np.kron(np.ones(self.Nt), self.phi)</span>

        <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">Enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">ens3</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Enc</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">emax</span><span class="p">):</span>

            <span class="n">Emin</span> <span class="o">=</span> <span class="n">Enc</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">drag3</span><span class="p">(</span><span class="n">Emin</span><span class="p">)</span>
            <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">Err</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">emax</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">i3</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">put3</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i3</span><span class="p">)</span>
                <span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fsynth3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span><span class="n">pattern</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">Err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mse</span><span class="p">(</span><span class="n">Fth3</span><span class="p">,</span> <span class="n">Fph3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="Antenna.savevsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savevsh3.html#pylayers.antprop.antenna.Antenna.savevsh3">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save antenna in vsh3 format</span>

<span class="sd">        Create a .vsh3 antenna file</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># create vsh3 file</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.vsh3&#39;</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="c">#filevsh3 = pyu.getlong(self._filename,&#39;ant&#39;)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh3</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.savesh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savesh2.html#pylayers.antprop.antenna.Antenna.savesh2">[docs]</a>    <span class="k">def</span> <span class="nf">savesh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save coeff in  .sh2 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># create sh2 file</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>

        <span class="n">_filesh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">+</span> <span class="n">typ</span><span class="p">,</span> <span class="s">&#39;.sh2&#39;</span><span class="p">)</span>
        <span class="n">filesh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh2</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filesh2</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filesh2</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">lmax</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filesh2</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.savesh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savesh3.html#pylayers.antprop.antenna.Antenna.savesh3">[docs]</a>    <span class="k">def</span> <span class="nf">savesh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save antenna in sh3 format</span>

<span class="sd">        Create a .sh3 antenna file</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># create sh3 file</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">_filesh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="o">+</span> <span class="n">typ</span><span class="p">,</span> <span class="s">&#39;.sh3&#39;</span><span class="p">)</span>
        <span class="n">filesh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh3</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filesh3</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filesh3</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">ind3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">ind3</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">k2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">k2</span>


            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">lmax</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.lmax&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">lmax</span>

            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cy</span><span class="o">.</span><span class="n">s3</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.s3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">Cz</span><span class="o">.</span><span class="n">s3</span>


            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filesh3</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.loadvsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadvsh3.html#pylayers.antprop.antenna.Antenna.loadvsh3">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna&#39;s vsh3 file</span>

<span class="sd">            vsh3 file contains a thesholded version of vsh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># .. Warning</span>
            <span class="c"># Warning modification take only one dimension for k</span>
            <span class="c"># if the .vsh3 format evolve it may not work anymore</span>
            <span class="c">#</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh3</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
<div class="viewcode-block" id="Antenna.loadsh3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadsh3.html#pylayers.antprop.antenna.Antenna.loadsh3">[docs]</a>    <span class="k">def</span> <span class="nf">loadsh3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna&#39;s sh3 file</span>

<span class="sd">            sh3 file contains a thesholded version of ssh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filesh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.sh3&#39;</span>
        <span class="n">filesh3</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filesh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># .. Warning</span>
            <span class="c"># Warning modification takes only one dimension for k</span>
            <span class="c"># if the .sh3 format evolve it may not work anymore</span>
            <span class="c">#</span>


            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">Cx</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.s3&#39;</span><span class="p">],</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.k&#39;</span><span class="p">]))</span>


            <span class="n">Cy</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span> <span class="s">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.s3&#39;</span><span class="p">],</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.k&#39;</span><span class="p">]))</span>



            <span class="n">Cz</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span> <span class="o">=</span> <span class="s">&#39;s3&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span> <span class="o">=</span> <span class="n">fmin</span> <span class="p">,</span>
                        <span class="n">fmax</span> <span class="o">=</span> <span class="n">fmax</span> <span class="p">,</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.s3&#39;</span><span class="p">],</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">ind</span> <span class="o">=</span>  <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.ind&#39;</span><span class="p">],</span>
                        <span class="n">k</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.k&#39;</span><span class="p">]))</span>


            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;S&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">SSHCoeff</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">.</span><span class="n">sets3</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Cx</span><span class="o">.</span><span class="n">s3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filesh3</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
<div class="viewcode-block" id="Antenna.savevsh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.savevsh2.html#pylayers.antprop.antenna.Antenna.savevsh2">[docs]</a>    <span class="k">def</span> <span class="nf">savevsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save coeff in  a .vsh2 antenna file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># create vsh2 file</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.trx&#39;</span><span class="p">,</span> <span class="s">&#39;.vsh2&#39;</span><span class="p">)</span>

        <span class="n">_filevsh2</span>  <span class="o">=</span> <span class="n">filename</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">filevsh2</span><span class="p">,</span> <span class="s">&#39; already exist&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;create &#39;</span><span class="p">,</span> <span class="n">filevsh2</span><span class="p">,</span> <span class="s">&#39; file&#39;</span>

            <span class="n">coeff</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fa</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">ind2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Bi</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cr</span><span class="o">.</span><span class="n">s2</span>
            <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ci</span><span class="o">.</span><span class="n">s2</span>

            <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Antenna.loadsh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadsh2.html#pylayers.antprop.antenna.Antenna.loadsh2">[docs]</a>    <span class="k">def</span> <span class="nf">loadsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load  spherical harmonics coefficient in shape  2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filesh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.sh2&#39;</span>
        <span class="n">filesh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filesh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filesh2</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filesh2</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.lmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>


            <span class="n">Cx</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cx.ind&#39;</span><span class="p">])</span>

            <span class="n">Cy</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cy.ind&#39;</span><span class="p">])</span>
            <span class="n">Cz</span> <span class="o">=</span> <span class="n">SCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span>
                        <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span>
                        <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                        <span class="n">lmax</span> <span class="o">=</span> <span class="n">lmax</span><span class="p">,</span>
                        <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.s2&#39;</span><span class="p">],</span>
                        <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cz.ind&#39;</span><span class="p">])</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">SSHCoeff</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">,</span><span class="n">Cz</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Cx</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filesh2</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>


</div>
<div class="viewcode-block" id="Antenna.loadvsh2"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.loadvsh2.html#pylayers.antprop.antenna.Antenna.loadvsh2">[docs]</a>    <span class="k">def</span> <span class="nf">loadvsh2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load antenna from .vsh2 file format</span>

<span class="sd">        Load antenna&#39;s vsh2 file which only contains</span>
<span class="sd">        the vsh coefficients in shape 2</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh2</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh2</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh2</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="c">#</span>
            <span class="c"># This test is to fix a problem with 2 different</span>
            <span class="c"># behavior of io.loadmat</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fmin</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">fmax</span> <span class="o">=</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;fmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s">&#39;s2&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="o">=</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="o">=</span><span class="n">fmax</span><span class="p">,</span>
                         <span class="n">data</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s2&#39;</span><span class="p">],</span> <span class="n">ind</span><span class="o">=</span><span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Br</span><span class="o">.</span><span class="n">s2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">Nf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh2</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>
</div>
    <span class="k">def</span> <span class="nf">loadvsh3_old</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load antenna vsh coefficients in shape 3</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_filevsh3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span>
        <span class="n">filevsh3</span> <span class="o">=</span> <span class="n">getlong</span><span class="p">(</span><span class="n">_filevsh3</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s">&#39;DIRANT&#39;</span><span class="p">])</span>
        <span class="n">fmin</span> <span class="o">=</span> <span class="mf">2.</span>
        <span class="n">fmax</span> <span class="o">=</span> <span class="mf">8.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">):</span>
            <span class="n">coeff</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filevsh3</span><span class="p">,</span> <span class="n">appendmat</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">Br</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Br.k&#39;</span><span class="p">])</span>
            <span class="n">Bi</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Bi.k&#39;</span><span class="p">])</span>
            <span class="n">Cr</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Cr.k&#39;</span><span class="p">])</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">VCoeff</span><span class="p">(</span><span class="s">&#39;s3&#39;</span><span class="p">,</span> <span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.s3&#39;</span><span class="p">],</span>
                         <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.ind&#39;</span><span class="p">],</span> <span class="n">coeff</span><span class="p">[</span><span class="s">&#39;Ci.k&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">VSHCoeff</span><span class="p">(</span><span class="n">Br</span><span class="p">,</span> <span class="n">Bi</span><span class="p">,</span> <span class="n">Cr</span><span class="p">,</span> <span class="n">Ci</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fmin</span><span class="p">,</span> <span class="n">fmax</span><span class="p">,</span> <span class="mi">121</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">_filevsh3</span><span class="p">,</span> <span class="s">&#39; does not exist&#39;</span>

<div class="viewcode-block" id="Antenna.pol2cart"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.pol2cart.html#pylayers.antprop.antenna.Antenna.pol2cart">[docs]</a>    <span class="k">def</span> <span class="nf">pol2cart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts FTheta, FPhi to Fx,Fy,Fz for theta=ith</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ith : theta index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Fx</span>
<span class="sd">        Fy</span>
<span class="sd">        Fz</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        cart2pol</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Fth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fx</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fy</span> <span class="o">=</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span>
        <span class="n">Fz</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Antenna.cart2pol"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.Antenna.cart2pol.html#pylayers.antprop.antenna.Antenna.cart2pol">[docs]</a>    <span class="k">def</span> <span class="nf">cart2pol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Fx</span><span class="p">,</span> <span class="n">Fy</span><span class="p">,</span> <span class="n">Fz</span><span class="p">,</span> <span class="n">ith</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; converts Fx,Fy,Fz to Ftheta, Fphi for theta=ith</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Fx  : np.array</span>
<span class="sd">        Fy  : np.array</span>
<span class="sd">        Fz  : np.array</span>
<span class="sd">        ith : theta index</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pol2cart</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">ith</span><span class="p">]</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>

        <span class="n">Fth</span> <span class="o">=</span> <span class="n">Fx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fz</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
        <span class="n">Fph</span> <span class="o">=</span> <span class="o">-</span><span class="n">Fx</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fy</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>

        <span class="n">SqG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fph</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fph</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fth</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">Fth</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SqG</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">SqG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ftheta</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fphi</span><span class="p">[:,</span> <span class="n">ith</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Fph</span>
</div>
<div class="viewcode-block" id="forcesympol"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.forcesympol.html#pylayers.antprop.antenna.forcesympol">[docs]</a><span class="k">def</span> <span class="nf">forcesympol</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot VSH transform vsh basis in 3D plot</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    n,m   : integer values (m&lt;=n)</span>
<span class="sd">    theta : ndarray</span>
<span class="sd">    phi   : ndarray</span>
<span class="sd">    sf    : boolean</span>
<span class="sd">        if sf : plotted figures are saved in a *.png file</span>
<span class="sd">        else  : plotted figures aren&#39;t saved</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; import  matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; n=5</span>
<span class="sd">        &gt;&gt;&gt; m=3</span>
<span class="sd">        &gt;&gt;&gt; theta = np.linspace(0,np.pi,30)</span>
<span class="sd">        &gt;&gt;&gt; phi   = np.linspace(0,2*np.pi,60)</span>
<span class="sd">        &gt;&gt;&gt; plotVW(n,m,theta,phi)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># calculate v and w</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">theta</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">theta</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> \
            <span class="mf">1e-10</span>  <span class="c"># .. todo :: not clean</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">Pmm1n</span><span class="p">,</span> <span class="n">Pmp1n</span> <span class="o">=</span> <span class="n">AFLegendre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">Pmm1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">Pmp1n</span><span class="p">[:,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

        <span class="n">Ephi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">cphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">phi</span><span class="p">)</span>

        <span class="n">ny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
        <span class="n">ne</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ephi</span><span class="p">)</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span>
        <span class="n">ve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ne</span><span class="p">)</span>
        <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">ve</span><span class="p">)</span>
        <span class="n">EPh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vy</span><span class="p">,</span> <span class="n">Ephi</span><span class="p">)</span>

        <span class="n">const</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">Y1</span> <span class="o">*</span> <span class="n">EPh</span>
        <span class="c">#V[np.isinf(V)|isnan(V)]=0</span>
        <span class="n">Vcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">V</span>
        <span class="n">Vsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">V</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c">#W=np.zeros((len(theta),len(phi)))</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)))</span> <span class="o">*</span> <span class="mf">1e-10</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Waux</span> <span class="o">=</span> <span class="n">Y2</span> <span class="o">*</span> <span class="n">EPh</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">const</span><span class="p">)</span> <span class="o">*</span> <span class="n">Waux</span>
        <span class="n">Wcos</span> <span class="o">=</span> <span class="n">cphi</span> <span class="o">*</span> <span class="n">W</span>
        <span class="n">Wsin</span> <span class="o">=</span> <span class="n">sphi</span> <span class="o">*</span> <span class="n">W</span>

        <span class="c"># plot V and W</span>
        <span class="n">Ntheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Ntheta</span><span class="p">)</span>
        <span class="n">Nphi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Nphi</span><span class="p">)</span>
        <span class="n">Phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">Theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>

        <span class="c">#figdirV=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_V_Vsin_Vcos/&#39;</span>
        <span class="n">figdirV</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span>
        <span class="n">ext1</span> <span class="o">=</span> <span class="s">&#39;.pdf&#39;</span>
        <span class="n">ext2</span> <span class="o">=</span> <span class="s">&#39;.eps&#39;</span>
        <span class="n">ext3</span> <span class="o">=</span> <span class="s">&#39;.png&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;V&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;Vcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Vsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirV</span> <span class="o">+</span> <span class="s">&#39;Vsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;.jpg&#39;</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="c">#figdirW=&#39;/home/rburghel/Bureau/bases_decomposition_VW/base_W_Wsin_Wcos/&#39;</span>
        <span class="n">figdirW</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">W</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;W&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wcos</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;Wcos&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Wsin</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Theta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim3d</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sf</span><span class="p">:</span>
            <span class="n">sz</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">sz</span> <span class="o">*</span> <span class="mf">1.8</span><span class="p">)</span>
            <span class="n">figname</span> <span class="o">=</span> <span class="n">figdirW</span> <span class="o">+</span> <span class="s">&#39;Wsin&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figname</span> <span class="o">+</span> <span class="n">ext3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;portrait&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;Error: m&gt;n!!!&quot;</span>
</div>
<div class="viewcode-block" id="compdiag"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.compdiag.html#pylayers.antprop.antenna.compdiag">[docs]</a><span class="k">def</span> <span class="nf">compdiag</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">,</span> <span class="n">Fthr</span><span class="p">,</span> <span class="n">Fphr</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;modulus&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">&#39;english&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; makes comparison between original pattern and reconstructed pattern</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    k : frequency index</span>
<span class="sd">    A : Antenna</span>

<span class="sd">    ph : phi base      (1 x Np)</span>
<span class="sd">    th : theta base    (1 x Nt)</span>

<span class="sd">    Fthr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>
<span class="sd">    Fphr : Fth output of Fsynth Nf x (Ntheta*Tphi)</span>

<span class="sd">    lang = &#39;french&#39;</span>
<span class="sd">         = &#39;english&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Fthr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c">#Fthr = Fthr.reshape(Nf,len(th),len(ph))</span>
    <span class="c">#Fphr = Fphr.reshape(Nf,len(th),len(ph))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">Ftho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Ftheta</span>
    <span class="n">Fpho</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">Fphi</span>

    <span class="c"># limites module Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTr</span><span class="p">,</span> <span class="n">maxTo</span><span class="p">)</span>

    <span class="n">minTr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTr</span><span class="p">,</span> <span class="n">minTo</span><span class="p">)</span>

    <span class="n">maxPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MmP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPr</span><span class="p">,</span> <span class="n">maxPo</span><span class="p">)</span>

    <span class="n">minPr</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPo</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mmP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPr</span><span class="p">,</span> <span class="n">minPo</span><span class="p">)</span>

    <span class="c"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTrr</span><span class="p">,</span> <span class="n">maxTor</span><span class="p">)</span>

    <span class="n">minTrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minTor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTrr</span><span class="p">,</span> <span class="n">minTor</span><span class="p">)</span>

    <span class="n">maxPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MrP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPrr</span><span class="p">,</span> <span class="n">maxPor</span><span class="p">)</span>

    <span class="n">minPrr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">mrP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPrr</span><span class="p">,</span> <span class="n">minPor</span><span class="p">)</span>

    <span class="c"># limites real Fthr, Ftho, Fphr, Fpho</span>
    <span class="n">maxTri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxToi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxTri</span><span class="p">,</span> <span class="n">maxToi</span><span class="p">)</span>

    <span class="n">minTri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minToi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miT</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minTri</span><span class="p">,</span> <span class="n">minToi</span><span class="p">)</span>

    <span class="n">maxPri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxPoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">MiP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxPri</span><span class="p">,</span> <span class="n">maxPoi</span><span class="p">)</span>

    <span class="n">minPri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minPoi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">miP</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minPri</span><span class="p">,</span> <span class="n">minPoi</span><span class="p">)</span>

    <span class="c"># limithes arg Fth,Fph</span>
    <span class="n">maxATr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxATo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maT</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxATr</span><span class="p">,</span> <span class="n">maxATo</span><span class="p">)</span>
    <span class="n">minATr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minATo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maT0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minATr</span><span class="p">,</span> <span class="n">minATo</span><span class="p">)</span>

    <span class="n">maxAPr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maxAPo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">maP</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxAPr</span><span class="p">,</span> <span class="n">maxAPo</span><span class="p">)</span>
    <span class="n">minAPr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">minAPo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">maP0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">minAPr</span><span class="p">,</span> <span class="n">minAPo</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">rtd</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
    <span class="c">#</span>
    <span class="c">#cmap=cm.jet</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),vmin=0,vmax=mmT)</span>
            <span class="c">#</span>
    <span class="c">#cmap= gray</span>
    <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,abs(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
            <span class="c">#</span>
    <span class="c">#cmap=cm.hot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,real(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,imag(Ftho[k,:,:]),cmap=cm.gray_r,vmin=0,vmax=mmT)</span>
        <span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
               <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="c">#pcolor(A.phi*rtd,A.theta*rtd,angle(Ftho[k,:,:]),cmap=cm.gray_r,vmin=maT0,vmax=maT)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Ftho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Arg ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Ang ($F_{\theta}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fpho</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Arg ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Ang ($F_{\phi}$) original&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;$|F_{\theta}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title</span><span class="p">(</span><span class="s">r&#39;Re ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miT</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Im ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fthr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maT0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Arg ($F_{\theta}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">r&#39;Ang ($F_{\theta}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&#39;$\theta$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;modulus&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mmP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MmP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;$|F_{\phi}|$ reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;real&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">mrP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MrP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Re ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;imag&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">ph</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">th</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">miP</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">MiP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Im ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;phase&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">phi</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">A</span><span class="o">.</span><span class="n">theta</span> <span class="o">*</span> <span class="n">rtd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">Fphr</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]),</span>
                   <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">maP0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">maP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="o">==</span> <span class="s">&#39;french&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Arg ($F_{\phi}$) reconstruit&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Ang ($F_{\phi}$) reconstructed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&#39;$\phi$ (deg)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
        <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="show3D"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.antenna.show3D.html#pylayers.antprop.antenna.show3D">[docs]</a><span class="k">def</span> <span class="nf">show3D</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; show 3D matplotlib diagram</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    F      : ndarray (Nf,Nt,Np)</span>
<span class="sd">    theta  : ndarray (1xNt)</span>
<span class="sd">        angle</span>
<span class="sd">    phi    : ndarray (1xNp)</span>
<span class="sd">        angle</span>
<span class="sd">    theta  : ndarray (Nt)</span>
<span class="sd">    k      : int</span>
<span class="sd">        frequency index</span>
<span class="sd">    col    : boolean</span>
<span class="sd">        if col  -&gt; color coded plot3D</span>
<span class="sd">        if col == False -&gt; simple plot3D</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.antenna import *</span>
<span class="sd">        &gt;&gt;&gt; A = Antenna(&#39;defant.vsh3&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A.Fsynth()</span>


<span class="sd">    Warnings</span>
<span class="sd">    --------</span>

<span class="sd">        len(theta) must be equal with shape(F)[1]</span>
<span class="sd">        len(phi) must be equal with shape(F)[2]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">nph</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: frequency index k not in F defined interval&#39;</span>
    <span class="k">if</span> <span class="n">nth</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: shape mistmatch between theta and F&#39;</span>

    <span class="k">if</span> <span class="n">nph</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">F</span><span class="p">)[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&#39;Error: shape mistmatch between phi and F&#39;</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes3d</span><span class="o">.</span><span class="n">Axes3D</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="n">V</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="n">vt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nth</span><span class="p">)</span>
    <span class="n">vp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nph</span><span class="p">)</span>
    <span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">vp</span><span class="p">)</span>
    <span class="n">Ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vt</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

    <span class="n">X</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s">&#39;Z&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">rstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">hot_r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot3D</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Z</span><span class="p">))</span>

</div>
<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebook/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2014, PyLayers developer team.
      Last updated on oct. 04, 2014.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_setDomainName', 'pylayers.github.io']);
  _gaq.push(['_setAllowLinker', true]);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })(); 
</script> 
 
  </body>
</html>