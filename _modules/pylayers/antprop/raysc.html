
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.antprop.raysc &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img src="../../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../../download.html">Download</a></li>
            <li><a href="../../../notebook/TOC.html">User Guide</a></li>
            <li><a href="../../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	  <div class="rel">
	   
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="../../../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module...
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
	<div class="spacer">
	&nbsp;
	</div>
	<div class="rellink">
	<a href="../../index.html" title="Module code" >
	Up
	<br>
	<span class="smallrellink">
	Module code
	</span>
	<span class="hiddenrellink">
	Module code
	</span>
	
	</a>
	</div>
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	
    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylayers.antprop.raysc</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: latin1 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">This modules contains classes for old code PulsRay</span>

<span class="sd">Ray3D class</span>
<span class="sd">===========</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Ray3D.info</span>
<span class="sd">    Ray3D.locbas</span>
<span class="sd">    Ray3D.delay</span>
<span class="sd">    Ray3D.show</span>
<span class="sd">    Ray3D.show3</span>

<span class="sd">RayTud class</span>
<span class="sd">============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    RayTud.__init__</span>
<span class="sd">    RayTud.info</span>
<span class="sd">    RayTud.delay</span>
<span class="sd">    RayTud.signature</span>
<span class="sd">    RayTud.eval</span>


<span class="sd">GrRayTud class</span>
<span class="sd">==============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    GrRayTud.__init__</span>
<span class="sd">    GrRayTud.__repr__</span>
<span class="sd">    GrRayTud.dir</span>
<span class="sd">    GrRayTud.delay</span>
<span class="sd">    GrRayTud.choose</span>
<span class="sd">    GrRayTud.save</span>
<span class="sd">    GrRayTud.load</span>
<span class="sd">    GrRayTud.ray</span>
<span class="sd">    GrRayTud.typ</span>
<span class="sd">    GrRayTud.eval</span>
<span class="sd">    GrRayTud.info</span>
<span class="sd">    GrRayTud.imshowinter</span>
<span class="sd">    GrRayTud.get_thetas</span>
<span class="sd">    GrRayTud.get_mat</span>

<span class="sd">GrRay3D class</span>
<span class="sd">=============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    GrRay3D.__init__</span>
<span class="sd">    GrRay3D.dir</span>
<span class="sd">    GrRay3D.info</span>
<span class="sd">    GrRay3D.choose</span>
<span class="sd">    GrRay3D.load</span>
<span class="sd">    GrRay3D.delay</span>
<span class="sd">    GrRay3D.save</span>
<span class="sd">    GrRay3D.reciprocal</span>
<span class="sd">    GrRay3D.show</span>
<span class="sd">    GrRay3D.show3</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.slab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.interactions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">Ray3D</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ray3D class</span>

<span class="sd">    This class handles a 3D ray</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nn      : int</span>
<span class="sd">        number of nodes (number of interaction + 2)</span>
<span class="sd">    pt      : np.array</span>
<span class="sd">        point coordinates</span>
<span class="sd">    nstr    : element of a signature</span>
<span class="sd">        structure number (&gt;0 edge) (&lt;0 node) (0 Tx or Rx)</span>
<span class="sd">    deep    : int</span>
<span class="sd">    beta0   : float</span>
<span class="sd">    phii    : float</span>
<span class="sd">    phid    : float</span>
<span class="sd">    length  : float</span>
<span class="sd">    Bi   : interaction input basis    shape=( nn,3,3)</span>
<span class="sd">    Bo   : intercation output basis   shape=( nn,3,3)</span>

<span class="sd">    Bi(l,:,0) = s_in</span>
<span class="sd">    Bi(l,:,1) = etheta_in</span>
<span class="sd">    Bi(l,:,2) = ephi_in</span>

<span class="sd">    Bo(l,:,0) = s_out</span>
<span class="sd">    Bo(l,:,1) = etheta_out</span>
<span class="sd">    Bo(l,:,2) = ephi_out</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    show3(bdis=True,col=np.array([1,0,1]),id=0) : geomview visualization</span>
<span class="sd">    info()  : Ray information</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Ray3D.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.Ray3D.info.html#pylayers.antprop.raysc.Ray3D.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;Number of nodes : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;points : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="k">print</span> <span class="s2">&quot;nstr   : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">nstr</span>
        <span class="k">print</span> <span class="s2">&quot;B in     : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span>
        <span class="k">print</span> <span class="s2">&quot;B out    : &quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span>
        <span class="k">print</span> <span class="s2">&quot;AOD : &quot;</span>
        <span class="k">print</span> <span class="s2">&quot;thetat (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tht</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;phit   (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pht</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;AOA : &quot;</span>
        <span class="k">print</span> <span class="s2">&quot;thetar (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thr</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">print</span> <span class="s2">&quot;phir   (deg)   : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phr</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ray3D.locbas"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.Ray3D.locbas.html#pylayers.antprop.raysc.Ray3D.locbas">[docs]</a>    <span class="k">def</span> <span class="nf">locbas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluation of local basis over the ray</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        L : Layout Structure Graph</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            evaluate Bi and Bo</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># initialize RayTud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span> <span class="o">=</span> <span class="n">RayTud</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span>
        <span class="c1">#</span>
        <span class="c1"># si : (N-1,3)</span>
        <span class="c1">#</span>
        <span class="c1"># si  = np.array(np.zeros([nn-1,3],dtype=np.float64))</span>
        <span class="c1"># lsi = np.array(np.zeros(nn-1,dtype=np.float64))</span>
        <span class="c1">#</span>
        <span class="c1"># Calcul des vecteurs unitaires si</span>
        <span class="c1"># .. todo:: remove this for loop</span>
        <span class="c1">#   not tested</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="c1"># reshape is required for broadcasting</span>
        <span class="n">lsir</span> <span class="o">=</span> <span class="n">lsi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">si</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">lsir</span>
        <span class="c1"># for k in range(nn-1):</span>
        <span class="c1">#    v  = self.pt[k+1,:]-self.pt[k,:]</span>
        <span class="c1">#    nv = np.sqrt(np.dot(v,v))</span>
        <span class="c1">#    try:</span>
        <span class="c1">#        si[k,:]  = v/nv</span>
        <span class="c1">#        lsi[k,:] = nv</span>
        <span class="c1">#    except:</span>
        <span class="c1">#        print(&quot;error divide by 0 in Ray3D.geom &quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>

        <span class="n">nint</span> <span class="o">=</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span>

        <span class="c1">#</span>
        <span class="c1"># Repere de sortie du Tx</span>
        <span class="c1">#</span>

        <span class="n">BoO</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">eth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)])</span>
        <span class="n">eph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">Bo0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">si</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">eth</span><span class="p">,</span> <span class="n">eph</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Bo0</span>
        <span class="c1">#</span>
        <span class="c1"># Ray AOD</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tht</span> <span class="o">=</span> <span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pht</span> <span class="o">=</span> <span class="n">ph</span>
        <span class="c1">#</span>
        <span class="c1"># Repere d&#39;entree du Rx</span>
        <span class="c1">#</span>
        <span class="c1"># input unitary vector  impose que le vecteur unitaire d&#39;entree sur</span>
        <span class="c1"># le recepteur soit confondu avec le vecteur unitaire</span>
        <span class="c1"># de sortie de la derniere interaction</span>
        <span class="c1">#</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">eth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)])</span>
        <span class="n">eph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="n">Bini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">si</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">eth</span><span class="p">,</span> <span class="n">eph</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">nint</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Bini</span>
        <span class="c1">#</span>
        <span class="c1"># Ray AOA</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="n">ph</span>
        <span class="c1">#</span>
        <span class="c1"># loop over the nn-2 interactions</span>
        <span class="c1">#</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">nstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

            <span class="c1">#</span>
            <span class="c1"># Retrieve the interaction vector</span>
            <span class="c1">#   normal (R or T) or edge direction (D)</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">nstr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># if wall</span>
                <span class="k">if</span> <span class="n">nstr</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span><span class="p">:</span>
                    <span class="n">vn</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">nstr</span><span class="p">][</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># if ceil or floor</span>
                    <span class="k">if</span> <span class="n">nstr</span> <span class="o">==</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># ceil</span>
                        <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">nstr</span> <span class="o">==</span> <span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># floor</span>
                        <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># diffaction</span>
                <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>

            <span class="c1"># .. todo:: regler le proble de nstr sur rayon 358 : sircut.str</span>
            <span class="c1"># try:</span>
            <span class="c1">#    ps = np.dot(vn,si[l,:])</span>
            <span class="c1"># except:</span>
            <span class="c1">#    pdb.set_trace()</span>
            <span class="c1">#</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:])</span>
            <span class="c1"># Si Reflexion ou Transmission inversion signe normale si.n &lt;0</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">vn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">vn</span>
            <span class="c1">#</span>
            <span class="c1"># Si si et n sont colineaires, le plan d&#39;incidence n&#39;est pas defini</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-7</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s_in</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">pvecn</span><span class="p">(</span><span class="n">s_in</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s_in</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s_in</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">l</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">M</span>
                <span class="n">s_out</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">pvecn</span><span class="p">(</span><span class="n">s_out</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s_out</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s_out</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">M</span>
            <span class="c1">#</span>
            <span class="c1"># Create interaction</span>
            <span class="c1"># see GetRayonPram de tratotud.c</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Reflexion</span>
                <span class="c1"># theta  = np.arccos(abs(ps))  &#39;validated&#39;</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siR</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">srR</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntR</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">siR</span><span class="p">,</span> <span class="n">srR</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Transmission</span>
                <span class="c1"># theta  = np.arccos(abs(ps))  &#39;validated&#39;</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siT</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">srT</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntT</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">siT</span><span class="p">,</span> <span class="n">srT</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># Diffraction</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">thetad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">siD</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                <span class="n">sdD</span> <span class="o">=</span> <span class="n">lsi</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="c1">#</span>
                <span class="c1"># Attributes for nst &lt;0 of L.Gs</span>
                <span class="c1">#</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">typed</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">I</span> <span class="o">=</span> <span class="n">IntD</span><span class="p">([</span><span class="n">theta</span><span class="p">,</span> <span class="n">thetad</span><span class="p">,</span> <span class="n">siD</span><span class="p">,</span> <span class="n">sdD</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="p">[</span><span class="n">typed</span><span class="p">])</span>
            <span class="c1">#</span>
            <span class="c1"># add a new interaction in raytud object</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Insert rotation matrices between interaction</span>
        <span class="c1">#</span>
        <span class="c1"># M = np.zeros((nn-1,2,2))</span>
        <span class="c1"># gt.inter.append(I=[)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">::]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">::])</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">IntB</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">inter</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>
            <span class="c1"># M[k,:,:] = np.dot(self.Bo[k,:,1::].T,self.Bi[k,:,1::])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="o">.</span><span class="n">ni</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nn</span> <span class="o">-</span> <span class="mi">3</span></div>
    <span class="c1"># def show3(self,bdis=True,bbas=False,col=np.array([1,0,1]),id=0):</span>

<div class="viewcode-block" id="Ray3D.delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.Ray3D.delay.html#pylayers.antprop.raysc.Ray3D.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates delay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">::,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">ph</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span></div>

<div class="viewcode-block" id="Ray3D.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.Ray3D.show.html#pylayers.antprop.raysc.Ray3D.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a Ray projection in 2D</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : figure</span>
<span class="sd">        ax  : axes</span>
<span class="sd">        col : string</span>
<span class="sd">        node : boolean</span>
<span class="sd">            (default False)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">ph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">::,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="n">pn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nseg</span><span class="p">):</span>
            <span class="n">pz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pz</span><span class="p">,</span> <span class="n">pt</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">ph</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">pn</span><span class="p">))</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nseg</span><span class="p">)),</span> <span class="n">m1</span><span class="p">)</span>
        <span class="n">pzz</span> <span class="o">=</span> <span class="n">pz</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">pzz</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Ray3D.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.Ray3D.show3.html#pylayers.antprop.raysc.Ray3D.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filestr</span><span class="o">=</span><span class="s1">&#39;defstr&#39;</span><span class="p">,</span> <span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bbas</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bstruc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show in geomview</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bdis :</span>
<span class="sd">            display boolean - if False return .vect filename</span>
<span class="sd">        bbas :</span>
<span class="sd">            display local basis</span>
<span class="sd">        bstruc :</span>
<span class="sd">            display structure</span>
<span class="sd">        col  :</span>
<span class="sd">            color of the ray</span>
<span class="sd">        id   :</span>
<span class="sd">            id of the ray</span>
<span class="sd">        linewidth :</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filerac</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s2">&quot;ray&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">),</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">_filerac</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filerac</span><span class="p">)</span>
        <span class="n">filename_list</span> <span class="o">=</span> <span class="n">filerac</span> <span class="o">+</span> <span class="s1">&#39;.list&#39;</span>
        <span class="n">filename_vect</span> <span class="o">=</span> <span class="n">filerac</span> <span class="o">+</span> <span class="s1">&#39;.vect&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_vect</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;appearance { linewidth </span><span class="si">%d</span><span class="s2"> }</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">linewidth</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;VECT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1 </span><span class="si">%d</span><span class="s2"> 1</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span>
                                                            <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c1"># fo.write(&quot;%d %d %d 0\n&quot; % (col[0],col[1],col[2]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1">#</span>
        <span class="c1"># Ajout des bases locales</span>
        <span class="c1">#</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename_list</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIST</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">filename_vect</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bstruc</span><span class="p">):</span>
            <span class="c1"># fo.write(&quot;{&lt;strucTxRx.off}\n&quot;)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">_filestr</span> <span class="o">+</span> <span class="s2">&quot;.off}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bbas</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ptb</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">fibi</span> <span class="o">=</span> <span class="n">_filerac</span> <span class="o">+</span> <span class="s2">&quot;Bi&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">vfibi</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="n">fibi</span><span class="p">)</span>
                <span class="n">colbi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]])</span>
                <span class="n">vfibi</span><span class="o">.</span><span class="n">geomBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bi</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ptb</span><span class="p">,</span> <span class="n">colbi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">fibo</span> <span class="o">=</span> <span class="n">_filerac</span> <span class="o">+</span> <span class="s2">&quot;Bo&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">vfibo</span> <span class="o">=</span> <span class="n">GeomVect</span><span class="p">(</span><span class="n">fibo</span><span class="p">)</span>
                <span class="n">colbo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">vfibo</span><span class="o">.</span><span class="n">geomBase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">ptb</span><span class="p">,</span> <span class="n">colbo</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">fibi</span> <span class="o">+</span> <span class="s2">&quot;.vect&quot;</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">fibo</span> <span class="o">+</span> <span class="s2">&quot;.vect&quot;</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename_list</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
        <span class="c1">#</span>
        <span class="c1"># Geomview Visualisation</span>
        <span class="c1">#</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s2">&quot;geomview -nopanel -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> \
                <span class="s2">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<span class="k">class</span> <span class="nc">RayTud</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ray Tud</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    ni      :</span>
<span class="sd">        number of interactions</span>
<span class="sd">    inter   :</span>
<span class="sd">        Interaction object</span>
<span class="sd">    C       :</span>
<span class="sd">        Ray Transfer function matrix :  np.array(np.zeros([nf,2,2]),dtype=complex)</span>
<span class="sd">    nf      :</span>
<span class="sd">        number of frequencies</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    info         :</span>
<span class="sd">        Ray informations</span>
<span class="sd">    eval(f)      :</span>
<span class="sd">        Evaluate C tilde matrix for a set of frequencies</span>
<span class="sd">    comp(raytud) :</span>
<span class="sd">        comparaison de deux rayons Tud</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RayTud.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.RayTud.__init__.html#pylayers.antprop.raysc.RayTud.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ni</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="RayTud.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.RayTud.info.html#pylayers.antprop.raysc.RayTud.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s2">&quot;Number of interactions : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="n">nbi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbi</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;Interaction : &quot;</span><span class="p">,</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span></div>

<div class="viewcode-block" id="RayTud.delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.RayTud.delay.html#pylayers.antprop.raysc.RayTud.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates delay of the ray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nbi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ni</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbi</span><span class="p">):</span>
            <span class="c1"># LOS</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dist</span>
            <span class="c1"># Reflexion</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sr</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sr</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
            <span class="c1"># Transmission</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">st</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">st</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
            <span class="c1"># Diffraction</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">si</span>
                    <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sd</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sd</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">l</span>
        <span class="k">return</span><span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span></div>

<div class="viewcode-block" id="RayTud.signature"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.RayTud.signature.html#pylayers.antprop.raysc.RayTud.signature">[docs]</a>    <span class="k">def</span> <span class="nf">signature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns ray signature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Signature</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ni</span><span class="p">):</span>
            <span class="n">Signature</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">Signature</span><span class="p">)</span></div>

<div class="viewcode-block" id="RayTud.eval"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.RayTud.eval.html#pylayers.antprop.raysc.RayTud.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fGHz</span><span class="o">=</span><span class="p">[</span><span class="mf">2.4</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot; evaluate the field over the ray</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz : ndarray</span>
<span class="sd">            frequency axis</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">Co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Loop over all the ray interactions</span>
        <span class="c1">#   + left matrix multiplication</span>
        <span class="c1">#   + broadcasting along frequency axis</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ni</span><span class="p">):</span>
            <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">Ci</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="n">Co</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;kpq,kqr-&gt;kpr&#39;</span><span class="p">,</span> <span class="n">Ci</span><span class="p">,</span> <span class="n">Co</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nf</span> <span class="o">=</span> <span class="n">nf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">Co</span></div>

<span class="k">class</span> <span class="nc">GrRayTud</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  a cluster of Rays in Tud format</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    nray    : number of rayTud</span>

<span class="sd">    rayTud  : list of RayTud object DEPRECATED</span>

<span class="sd">    I : class interaction which contrinats all the interactionn of The</span>
<span class="sd">        GrRayTud ( see class Interactions help)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    load(_filetud,sl)  : load from a .tud file</span>
<span class="sd">    eval()</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GrRayTud.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.__init__.html#pylayers.antprop.raysc.GrRayTud.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Interactions instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">Interactions</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrRayTud.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.__repr__.html#pylayers.antprop.raysc.GrRayTud.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; / &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nr</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">ni</span> <span class="o">+</span> <span class="n">nr</span><span class="o">*</span><span class="n">k</span>
            <span class="n">nl</span> <span class="o">=</span> <span class="n">nl</span> <span class="o">+</span> <span class="n">nr</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;-----&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span><span class="s1">&#39;ni : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ni</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">+</span><span class="s1">&#39;nl : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRayTud.dir"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.dir.html#pylayers.antprop.raysc.GrRayTud.dir">[docs]</a>    <span class="k">def</span> <span class="nf">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in tuddir</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        lfile_tud : list</span>
<span class="sd">            sorted list of all the .tud file of tuddir</span>
<span class="sd">        lfile_tang : list</span>
<span class="sd">            sorted list of all the .tang file of tuddir</span>
<span class="sd">        lfile_rang : list</span>
<span class="sd">            sorted list of all the .rang file of tuddir</span>
<span class="sd">        lfile_tauk : list</span>
<span class="sd">            sorted list of all the .tauk file of tuddir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tuddir is defined in the Project module</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.raysc import *</span>
<span class="sd">        &gt;&gt;&gt; g = GrRay3D()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pathname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tuddir</span><span class="p">,</span><span class="s1">&#39;/*.tud&#39;</span><span class="p">)</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tud</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tud</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tud</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tuddir</span><span class="p">,</span><span class="s1">&#39;/*.tang&#39;</span><span class="p">)</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tang</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tang</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tuddir</span><span class="p">,</span><span class="s1">&#39;/*.rang&#39;</span><span class="p">)</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_rang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_rang</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_rang</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="n">pathname</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">tuddir</span><span class="p">,</span><span class="s1">&#39;/*.tauk&#39;</span><span class="p">)</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_tauk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_tauk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_tauk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">lfile_tud</span><span class="p">,</span> <span class="n">lfile_tang</span><span class="p">,</span> <span class="n">lfile_rang</span><span class="p">,</span> <span class="n">lfile_tauk</span></div>

<div class="viewcode-block" id="GrRayTud.delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.delay.html#pylayers.antprop.raysc.GrRayTud.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns ray delays</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">nr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dt</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRayTud.choose"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.choose.html#pylayers.antprop.raysc.GrRayTud.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; choose a tud  file in tuddir</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span>
        <span class="n">FD</span> <span class="o">=</span> <span class="n">tkFileDialog</span>
        <span class="n">filetud</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Fichiers  &quot;</span><span class="p">,</span> <span class="s2">&quot;*.tud&quot;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)],</span>
                                     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Please choose a Tracing file&quot;</span><span class="p">,</span>
                                     <span class="n">initialdir</span><span class="o">=</span><span class="n">tuddir</span><span class="p">)</span>
        <span class="n">_filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filetud</span><span class="p">)</span>
        <span class="n">tabc</span> <span class="o">=</span> <span class="n">_filetud</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">_filestr</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.str&#39;</span>
        <span class="n">_fileslab</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.slab&#39;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mat&#39;</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>
        <span class="c1"># indoor = Indoor(sl,_filestr)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">sl</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRayTud.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.save.html#pylayers.antprop.raysc.GrRayTud.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filetud</span><span class="o">=</span><span class="s1">&#39;ftud&#39;</span><span class="p">,</span> <span class="n">_filetang</span><span class="o">=</span><span class="s1">&#39;ftang&#39;</span><span class="p">,</span> <span class="n">_filerang</span><span class="o">=</span><span class="s1">&#39;frang&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            save .tud .tang .rang</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            _filetud  :</span>
<span class="sd">            _filetang :</span>
<span class="sd">            _filerang :</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filetang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetang</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filerang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filerang</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetud</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">rk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">ni</span> <span class="o">=</span> <span class="n">rk</span><span class="o">.</span><span class="n">ni</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ni</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">rk</span><span class="o">.</span><span class="n">inter</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;4d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">dist</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">sr</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">st</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;6d&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">theta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">thetad</span><span class="p">,</span>
                                   <span class="n">it</span><span class="o">.</span><span class="n">si</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">sd</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">typed</span><span class="p">)</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span>
                    <span class="s1">&#39;8i&#39;</span><span class="p">,</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span>
                        <span class="mi">1</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                               <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">it</span><span class="o">.</span><span class="n">datMat</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetang</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tang</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">,</span> <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filerang</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rang</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">,</span> <span class="n">ag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ag</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrRayTud.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.load.html#pylayers.antprop.raysc.GrRayTud.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filetud</span><span class="p">,</span> <span class="n">_filetang</span><span class="p">,</span> <span class="n">_filerang</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a set of Ray from the PulsRay .tud file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename  : tud filename</span>
<span class="sd">        _filetang  : tang filename</span>
<span class="sd">        _filerang  : rang filename</span>
<span class="sd">        sl         : slab database object</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        a filename beginning with _ is a short filename</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">valerr</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">filetud</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetud</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filetang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filetang</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>
        <span class="n">filerang</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filerang</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetud</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nray</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">nimax</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#</span>
        <span class="c1"># in order to initialize all type of interaction with the correct</span>
        <span class="c1"># frequencies</span>

        <span class="n">B</span> <span class="o">=</span> <span class="n">IntB</span><span class="p">()</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">IntL</span><span class="p">()</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">IntR</span><span class="p">()</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">IntT</span><span class="p">()</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">IntD</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mapp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">):</span>
            <span class="n">nir</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">raytud</span> <span class="o">=</span> <span class="n">RayTud</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="c1">#</span>
            <span class="c1"># Interaction number over the ray</span>
            <span class="c1">#</span>
            <span class="c1"># if ni==0  : LOS case no interaction</span>
            <span class="c1">#</span>
            <span class="n">nbint</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nbi</span> <span class="o">=</span> <span class="n">nbint</span>
<span class="c1">#            raytud.ni = nbint</span>
<span class="c1">#            Inter = []</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbint</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">caract</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">decal</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">caract</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="c1"># check if first interaction is a IntB.</span>
                        <span class="c1"># if not, this first interaction is forced to be</span>
                        <span class="c1"># an identity matrix</span>
                        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>  <span class="c1"># inter = IntB(M)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">B</span> <span class="o">=</span> <span class="n">IntB</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                        <span class="c1"># because this id matrix, the ray has 1 extra interaction</span>
                        <span class="c1"># so we need to</span>
                        <span class="c1"># 1.create the correct key dictionnary</span>
                        <span class="c1"># 2.remap the index</span>
                        <span class="c1"># 3. use another variable loop (ii) incremented</span>

                        <span class="n">nbi</span> <span class="o">=</span> <span class="n">nbi</span><span class="o">+</span><span class="mi">1</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">],</span>
                                                       <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)))</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;nbrays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;nbrays&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span>
                            <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">k</span><span class="p">]))))</span>

                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nbi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;nbrays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">k</span><span class="p">]))</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">nbi</span><span class="p">))))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">nbi</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">nbi</span> <span class="o">!=</span> <span class="n">nbint</span><span class="p">:</span>
                        <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mapp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">mapp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">index</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
                        <span class="n">decal</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="c1"># decal = True if an extra B interaction is added at the begining</span>
                <span class="c1"># of the ray</span>
                <span class="k">if</span> <span class="n">decal</span><span class="p">:</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">nbi</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
                <span class="c1"># B interaction</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">32</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;4d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s1">&#39;except B&#39;</span>
                        <span class="n">B</span> <span class="o">=</span> <span class="n">IntB</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#                   M = np.array([[m[0], m[1]], [m[2], m[3]]])</span>
<span class="c1">#                    inter = IntB(M)</span>
            <span class="c1">#        inter.data = M</span>

                <span class="c1"># Los Interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">dist</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">L</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s1">&#39;except L&#39;</span>
                        <span class="n">L</span> <span class="o">=</span> <span class="n">IntL</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#                    inter = IntL(dist[0])</span>
            <span class="c1">#        inter.data = dist</span>

                <span class="c1"># Reflexion Interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">24</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datR</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">datR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datR</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">datR</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># inter = IntB(M)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s1">&#39;except R&#39;</span>
                        <span class="n">R</span> <span class="o">=</span> <span class="n">IntR</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#                    inter = IntR(datR)</span>
<span class="c1">#            #        inter.data = datR</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>

                <span class="c1"># Transmission interaction</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">24</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datT</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">datT</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">datT</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">datT</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s1">&#39;except T&#39;</span>
                        <span class="n">T</span> <span class="o">=</span> <span class="n">IntT</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dat</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#                    inter = IntT(datT)</span>
<span class="c1">#            #        inter.data = datT</span>

                <span class="c1"># Diffraction interaction</span>
<span class="c1">######################## TODO AFTER THIS POINT !!!!!!!!!!!!!!</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">caract</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s1">&#39;caract 3&#39;</span>
            <span class="c1">#        inter.data = []</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">48</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">datD</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;6d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="c1">#            #        (inter.data).append(datD)</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">typD</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span>
<span class="c1">#                    inter = IntD(datD, typD)</span>
<span class="c1">#            #        (inter.data).append(typD)</span>

                <span class="n">nir</span> <span class="o">=</span> <span class="n">nir</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">32</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">datMat</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;8i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                <span class="n">l1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">r1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

                <span class="n">l2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">r2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">datMat</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>

<span class="c1">#  if interaction is reflexion or transmission</span>
<span class="c1">#                if caract == 1 or caract == 2 or caract == 3:</span>

                    <span class="c1">## find corresponding name</span>
<span class="c1">#                    slname = self.I.slab.di[slidx]</span>
<span class="c1">#                    # if the material hasn&#39;t be evaluated before</span>
<span class="c1">#                    if not self.I.slab[slname][&#39;evaluated&#39;]:</span>
<span class="c1">#                        # evaluate it</span>
<span class="c1">#                        print &quot;evaluate&quot;,slname</span>
<span class="c1">#                        self.I.slab[slname].ev(fGHz=self.I.f, theta=self.I.t)</span>
                <span class="c1">### fill slab index dictionnary for each type of interactions</span>
                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1">## read material index</span>

                    <span class="n">slidx</span> <span class="o">=</span> <span class="n">c1</span>
                    <span class="c1">## find corresponding name</span>
                    <span class="n">slname</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">slab</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">slidx</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">uslidx</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">R</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">R</span><span class="o">.</span><span class="n">uslidx</span><span class="p">]</span>
                    <span class="n">R</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">slidx</span> <span class="o">=</span> <span class="n">c1</span>
                    <span class="n">slname</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">slab</span><span class="o">.</span><span class="n">di</span><span class="p">[</span><span class="n">slidx</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">uslidx</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">T</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">slname</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">T</span><span class="o">.</span><span class="n">uslidx</span><span class="p">]</span>
                    <span class="n">T</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">uslidx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># in case of diffraction</span>
                <span class="k">if</span> <span class="n">caract</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="c1">### the total number of interaction( for all rays)</span>
<span class="c1">#        self.I.nimax=index</span>
        <span class="c1">### Add all type of interactions into the Interaction class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">B</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">D</span><span class="p">])</span></div>

<div class="viewcode-block" id="GrRayTud.ray"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.ray.html#pylayers.antprop.raysc.GrRayTud.ray">[docs]</a>    <span class="k">def</span> <span class="nf">ray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Give the ray number and it returns the index of its interactions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raypos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]][</span><span class="s1">&#39;rays&#39;</span><span class="p">][</span><span class="n">raypos</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="GrRayTud.typ"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.typ.html#pylayers.antprop.raysc.GrRayTud.typ">[docs]</a>    <span class="k">def</span> <span class="nf">typ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; return the list of interaction type of a given ray</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">a</span><span class="p">])</span></div>

<div class="viewcode-block" id="GrRayTud.eval"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.eval.html#pylayers.antprop.raysc.GrRayTud.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluation of Ctilde</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s1">&#39;GrRayTUD evaluation&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delays</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nray</span><span class="p">))</span>
        <span class="n">nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span>  <span class="c1"># number of frequence</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># l stands for the number of interactions</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;nbrays&#39;</span><span class="p">]</span>
            <span class="c1"># reshape in order to have a 1D list of insde</span>
            <span class="c1"># reshape ray index</span>
            <span class="n">rrl</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">l</span><span class="p">)</span>
            <span class="c1"># get the corresponding evaluated interactions</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[:,</span> <span class="n">rrl</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">nf</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">si0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
            <span class="n">sout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="n">rrl</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">Z</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="c1">## loop on the all the interactions of ray with l interactions</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>

<span class="c1">###########################################</span>
<span class="c1">#                # Divergence factor D</span>
<span class="c1">##                 not yet implementented</span>
<span class="c1">###########################################</span>
<span class="c1">#                if i == 1:</span>
<span class="c1">#                    D0=1./si0[:,1]</span>
<span class="c1">#                    rho1=si0[:,1]*alpha[:,i]</span>
<span class="c1">#                    rho2=si0[:,1]*alpha[:,i]*gamma[:,i]</span>
<span class="c1">#                    D=np.sqrt(</span>
<span class="c1">#                     ( (rho1 ) / (rho1 + sout[:,i]) )</span>
<span class="c1">#                     *( (rho2) / (rho2 + sout[:,i])))</span>
<span class="c1">#                    D=D*D0</span>
<span class="c1">#                    rho1=rho1+(sout[:,i]*alpha[:,i])</span>
<span class="c1">#                    rho2=rho2+(sout[:,i]*alpha[:,i]*gamma[:,i])</span>
<span class="c1">#                    pdb.set_trace()</span>
<span class="c1">##                     gerer le loss</span>
<span class="c1">#                    if np.isnan(D).any():</span>
<span class="c1">#                        p=np.nonzero(np.isnan(D))[0]</span>
<span class="c1">#                        D[p]=1./sout[p,1]</span>
<span class="c1">#                else :</span>
<span class="c1">#                    D=np.sqrt(</span>
<span class="c1">#                     ( (rho1 ) / (rho1 + sout[:,i]) )</span>
<span class="c1">#                     *( (rho2) / (rho2 + sout[:,i])))</span>

<span class="c1">#                    rho1=rho1+(sout[:,i]*alpha[:,i])</span>
<span class="c1">#                    rho2=rho2+(sout[:,i]*alpha[:,i]*gamma[:,i])</span>
<span class="c1">###########################################</span>

                <span class="c1">#  A0  (X dot Y)</span>
                <span class="c1">#  |    |     |</span>
                <span class="c1">#  v    v     v</span>
                <span class="c1">##########################</span>
                <span class="c1">## B  # I  # B  # I  # B #</span>
                <span class="c1">##########################</span>
                <span class="c1">#      \_____/   \______/</span>
                <span class="c1">#         |         |</span>
                <span class="c1">#       Atmp(i)   Atmp(i+1)</span>
                <span class="c1">#</span>
                <span class="c1"># Z=Atmp(i) dot Atmp(i+1)</span>

                <span class="n">X</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                <span class="c1">## Dot product interaction X Basis</span>
                <span class="n">Atmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Y</span><span class="p">[</span>
                              <span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># *D[np.newaxis,:,np.newaxis,np.newaxis]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">## First Baspdis added</span>
                    <span class="n">A0</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">A0</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Atmp</span><span class="p">[</span>
                               <span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># dot product previous interaction with latest</span>
                    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">Atmp</span><span class="p">[</span>
                               <span class="o">...</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># fill the C tilde</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Z</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span>

            <span class="c1"># delay computation:</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">si0</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">][</span>
                <span class="p">:,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">sout</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Power losses due to distances</span>
            <span class="c1"># will be removed once the divergence factor will be implemented</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ctilde</span><span class="p">[:,</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span>
                <span class="s1">&#39;rayidx&#39;</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;dis&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delays</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">0.3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dis</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">&#39;dis&#39;</span><span class="p">]</span></div>

<div class="viewcode-block" id="GrRayTud.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.info.html#pylayers.antprop.raysc.GrRayTud.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; information for a given ray r</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        r : int</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s1">&#39;-------------------------&#39;</span>
        <span class="k">print</span> <span class="s1">&#39;Informations of ray #&#39;</span><span class="p">,</span> <span class="n">r</span>
        <span class="k">print</span> <span class="s1">&#39;-------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">ray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">print</span> <span class="s1">&#39;{0:5} , {1:4}, {2:10}, {3:7}, {4:10}, {5:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;material&#39;</span><span class="p">,</span> <span class="s1">&#39;th(rad)&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;gamma2&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">I</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">midx</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
                    <span class="n">Iidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">I</span><span class="o">.</span><span class="n">idx</span><span class="p">))[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="n">th</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">I</span><span class="o">.</span><span class="n">dusl</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">gamma</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">gamma</span><span class="p">[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">alpha</span><span class="p">[</span><span class="n">midx</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">Ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Iidx</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">Ii</span> <span class="ow">in</span> <span class="n">ray</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s1">&#39;{0:5} , {1:4}, {2:10}, {3:7.2}, {4:10.2}, {5:10.2}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Ii</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">th</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">gamma</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;{0:5} , {1:4}, {2:10}, {3:7}, {4:10}, {5:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">----------------------------------------&#39;</span>
        <span class="k">print</span> <span class="s1">&#39; Matrix of ray #&#39;</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s1">&#39;at f=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s1">&#39;----------------------------------------&#39;</span>

        <span class="k">for</span> <span class="n">iidx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;interaction #&#39;</span><span class="p">,</span> <span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],</span> <span class="s1">&#39;type:&#39;</span><span class="p">,</span> <span class="n">i</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">ray</span><span class="p">[</span><span class="n">iidx</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:]</span></div>

<div class="viewcode-block" id="GrRayTud.imshowinter"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.imshowinter.html#pylayers.antprop.raysc.GrRayTud.imshowinter">[docs]</a>    <span class="k">def</span> <span class="nf">imshowinter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">evaluated</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            im show interactions for</span>
<span class="sd">            a given ray r and</span>
<span class="sd">            a given freq index f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
        <span class="n">nbinter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayidx</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="c1"># find the position of the ray into the dictionnary of legnth of</span>
        <span class="c1"># interactions</span>
        <span class="n">pray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s1">&#39;rayidx&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
        <span class="c1"># get the interaciton idx</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s1">&#39;rays&#39;</span><span class="p">][</span><span class="n">pray</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nbinter</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">inter</span><span class="p">]):</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;inter&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">typ</span><span class="p">[</span><span class="n">inter</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;imag&#39;</span><span class="p">)</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;real&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbinter</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="o">.</span><span class="n">evaluated</span> <span class="ow">and</span> <span class="n">evaluated</span><span class="p">:</span>
            <span class="n">fig2</span><span class="p">,</span> <span class="n">axs2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">nbinter</span><span class="p">][</span><span class="s1">&#39;Ctilde&#39;</span><span class="p">][</span><span class="n">f</span><span class="p">,</span> <span class="n">pray</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Ctilde ray number :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;imag&#39;</span><span class="p">)</span>
            <span class="n">axs2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;real&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">nbinter</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrRayTud.get_thetas"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.get_thetas.html#pylayers.antprop.raysc.GrRayTud.get_thetas">[docs]</a>    <span class="k">def</span> <span class="nf">get_thetas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all thetas ( incidence angles ) from all computed RayTud</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            np.array containg all incidence angles theta from all rays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">th</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IntB</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IntL</span><span class="p">)):</span>
                    <span class="n">th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">th</span><span class="p">))</span></div>

<div class="viewcode-block" id="GrRayTud.get_mat"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRayTud.get_mat.html#pylayers.antprop.raysc.GrRayTud.get_mat">[docs]</a>    <span class="k">def</span> <span class="nf">get_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all used materials from all computed Raytud</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            np.array containg all materials involved in raytracing</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rayTud</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IntB</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">IntL</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">midx</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Mat1</span><span class="p">):</span>
                        <span class="n">mat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">Mat1</span><span class="p">[</span><span class="n">midx</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mat</span><span class="p">))</span></div>


<span class="c1">#    def info(self, n=-1):</span>
<span class="c1">#        &quot;&quot;&quot; info</span>
<span class="c1">#        Parameters</span>
<span class="c1">#        ----------</span>
<span class="c1">#        n : int</span>
<span class="c1">#            ray index (default = -1 all rays)</span>
<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        print &quot;Nb rayons : &quot;, self.nray</span>
<span class="c1">#        if n == -1:</span>
<span class="c1">#            for i in range(self.nray):</span>
<span class="c1">#                print &quot;Rayon : &quot;, i</span>
<span class="c1">#                self.rayTud[i].info()</span>
<span class="c1">#                print &quot;\n&quot;</span>
<span class="c1">#        else:</span>
<span class="c1">#            print &quot;rayon no : &quot;, n</span>
<span class="c1">#            self.rayTud[n].info()</span>

<span class="k">class</span> <span class="nc">GrRay3D</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A set of Ray3D with the same Tx and Rx</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    A GrRay is a group of rays sharing the same end points (Tx and Rx)</span>
<span class="sd">    n     : number of ray3D</span>
<span class="sd">    Tx    : Tx point (3x1)</span>
<span class="sd">    Rx    : Rx point (3x1)</span>
<span class="sd">    ray3d : list of Ray3D object</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    choose()           : choose tra file</span>
<span class="sd">    load(_filename,L)  : load a grRay3d from .tra file</span>
<span class="sd">    save(_filename)    : load a grRay3d from .tra file</span>
<span class="sd">    info(level)        : display information about GrRay3D</span>
<span class="sd">    show3(self,bdis=True,bstruc=True,id=0) : geomview visualization</span>
<span class="sd">    reciprocal(Gs)     :</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GrRay3D.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.__init__.html#pylayers.antprop.raysc.GrRay3D.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span></div>

<div class="viewcode-block" id="GrRay3D.dir"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.dir.html#pylayers.antprop.raysc.GrRay3D.dir">[docs]</a>    <span class="k">def</span> <span class="nf">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; list the available file in tradir</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        lfile_s : list</span>
<span class="sd">            sorted list of all the .str file of tradir</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        tradir is defined in the Project module</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.antprop.raysc import *</span>
<span class="sd">        &gt;&gt;&gt; g = GrRay3D()</span>
<span class="sd">        &gt;&gt;&gt; lfile = g.dir()</span>

<span class="sd">        .. todo:</span>
<span class="sd">            limit to a given filestruc</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pathname</span> <span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">ppath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">tradir</span><span class="p">,</span> <span class="s1">&#39;/*.tra&#39;</span><span class="p">)</span>
        <span class="n">lfile_l</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pathname</span><span class="p">)</span>
        <span class="n">lfile_s</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">lfile_l</span><span class="p">:</span>
            <span class="n">fis</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
            <span class="n">lfile_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fis</span><span class="p">)</span>
        <span class="n">lfile_s</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lfile_s</span></div>

<div class="viewcode-block" id="GrRay3D.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.info.html#pylayers.antprop.raysc.GrRay3D.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  provides info</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        level : int</span>
<span class="sd">            level of information</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;Number of Ray : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">info</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrRay3D.choose"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.choose.html#pylayers.antprop.raysc.GrRay3D.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Choose a Tracing  file in tradir</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span>
        <span class="n">FD</span> <span class="o">=</span> <span class="n">tkFileDialog</span>
        <span class="n">filetra</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Fichiers Launching &quot;</span><span class="p">,</span> <span class="s2">&quot;*.tra&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)],</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Please choose a Tracing file&quot;</span><span class="p">,</span> <span class="n">initialdir</span><span class="o">=</span><span class="n">tradir</span><span class="p">)</span>
        <span class="n">_filetra</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">filetra</span><span class="p">)</span>
        <span class="n">tabc</span> <span class="o">=</span> <span class="n">_filetra</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">_filestr</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.str&#39;</span>
        <span class="n">_fileslab</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.slab&#39;</span>
        <span class="n">_filemat</span> <span class="o">=</span> <span class="n">tabc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mat&#39;</span>
        <span class="n">sl</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">SlabDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">Slab</span><span class="o">.</span><span class="n">MatDB</span><span class="p">()</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filemat</span><span class="p">)</span>
        <span class="n">sl</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_fileslab</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">loadstr</span><span class="p">(</span><span class="n">_filestr</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRay3D.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.load.html#pylayers.antprop.raysc.GrRay3D.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a .tra de PulsRay</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : PulsRay .tra data format  filename</span>
<span class="sd">        L         : Layout object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.antprop.raysc import *</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.util.project import *</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.gis.layout import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import scipy as sp</span>
<span class="sd">            &gt;&gt;&gt; g = GrRay3D()</span>
<span class="sd">            &gt;&gt;&gt; lfile = g.dir()</span>
<span class="sd">            &gt;&gt;&gt; n = len(lfile)</span>
<span class="sd">            &gt;&gt;&gt; file0  = lfile[0]</span>
<span class="sd">            &gt;&gt;&gt; s1 = file0.split(&#39;_&#39;)</span>
<span class="sd">            &gt;&gt;&gt; _filestr = s1[0]+&#39;.str&#39;</span>
<span class="sd">            &gt;&gt;&gt; L = Layout()</span>
<span class="sd">            &gt;&gt;&gt; L.load(_filestr)</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; g.load(file0,L)</span>
<span class="sd">            &gt;&gt;&gt; f1 = g.show(f,a,np.arange(10))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; f2 = g.show(f,a,np.arange(100))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>
<span class="sd">            &gt;&gt;&gt; f,a = L.showGs()</span>
<span class="sd">            &gt;&gt;&gt; f3 = g.show(f,a,np.arange(300))</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTRA&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># decode read data</span>
        <span class="c1">#</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flch</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fpatra</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1024</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fspa</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="c1"># print &quot;Rayon N : &quot;,i</span>
                <span class="n">ray3D</span> <span class="o">=</span> <span class="n">Ray3D</span><span class="p">()</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                <span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">8</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">4</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
                    <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1">#</span>
                <span class="c1"># local basis creation</span>
                <span class="c1">#</span>
                <span class="c1"># DEBUG</span>
                <span class="c1"># if i &lt; 410:</span>
                <span class="c1">#    print ray3D.nstr</span>
                <span class="c1">#    n1 = []</span>
                <span class="c1">#    for kk in range(len(ray3D.nstr)-2):</span>
                <span class="c1">#        p1 = ray3D.pt[kk+1,0:2]</span>
                <span class="c1">#        nn = struc.onseg(p1,0.2)</span>
                <span class="c1">#        try:</span>
                <span class="c1">#            num = nn[0]+1</span>
                <span class="c1">#            n1.append(num)</span>
                <span class="c1">#        except:</span>
                <span class="c1">#            n1.append(-7)</span>
                <span class="c1">#    print n1</span>
                <span class="n">iz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">niz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">iz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3D</span><span class="p">)</span>
                <span class="c1"># if niz==2:</span>
                <span class="c1">#    ray3D.locbas(L)</span>
                <span class="c1">#    self.ray3d.append(ray3D)</span>
                <span class="c1"># else:</span>
                <span class="c1">#    self.n = self.n-1</span>
                    <span class="c1"># print &quot;Problem with ray : &quot;,i</span>
                    <span class="c1"># print ray3D.nstr</span>
                    <span class="c1"># print ray3D.pt</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<span class="c1">#           except:</span>
<span class="c1">#               print &quot;Le fichier&quot;, filename, &quot;est introuvable&quot;</span>

<div class="viewcode-block" id="GrRay3D.delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.delay.html#pylayers.antprop.raysc.GrRay3D.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculates delay</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        td  : np.array</span>
<span class="sd">            delays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">td</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span><span class="p">()))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">td</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRay3D.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.save.html#pylayers.antprop.raysc.GrRay3D.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        _filename : str</span>

<span class="sd">        Save a  GrRay3d object in a .tra de PulsRay</span>
<span class="sd">        filename : PulsRay .tra data format  filename</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTRA&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">dt_lch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flch</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_lch</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_lch</span> <span class="o">=</span> <span class="n">dt_lch</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

        <span class="n">dt_patra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fpatra</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_patra</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_patra</span> <span class="o">=</span> <span class="n">dt_patra</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

        <span class="n">dt_spa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fspa</span>
        <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt_spa</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">L</span> <span class="o">&lt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1024</span> <span class="o">-</span> <span class="n">L</span><span class="p">):</span>
                <span class="n">dt_spa</span> <span class="o">=</span> <span class="n">dt_spa</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">dt_lch</span> <span class="o">+</span> <span class="n">dt_patra</span> <span class="o">+</span> <span class="n">dt_spa</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">ack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tracing_exist</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">dt</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                <span class="n">ray3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">)</span>
                <span class="n">data_ray</span> <span class="o">=</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">deep</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3D</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">stru</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">ray3D</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="n">data_ray</span> <span class="o">=</span> <span class="n">data_ray</span> <span class="o">+</span> <span class="n">dt</span>

                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="n">data_ray</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="GrRay3D.reciprocal"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.reciprocal.html#pylayers.antprop.raysc.GrRay3D.reciprocal">[docs]</a>    <span class="k">def</span> <span class="nf">reciprocal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Reciprocity channel</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        L   : Layout object</span>
<span class="sd">        return a reciprocal GrRay3D</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>

        <span class="n">G</span><span class="o">.</span><span class="n">Tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rx</span>
        <span class="k">print</span> <span class="s2">&quot;G.Tx = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Tx</span>
        <span class="n">G</span><span class="o">.</span><span class="n">Rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tx</span>
        <span class="k">print</span> <span class="s2">&quot;G.Rx = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Rx</span>
        <span class="n">G</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>

        <span class="k">print</span> <span class="s2">&quot;G.n = &quot;</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">n</span>
        <span class="k">print</span> <span class="s2">&quot;self.n = &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="n">ray3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">ray3d</span> <span class="o">=</span> <span class="n">Ray3D</span><span class="p">()</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nn</span>
            <span class="n">nn</span> <span class="o">=</span> <span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">pht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phr</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pht</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">tht</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">thr</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">thr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tht</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">deep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">deep</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">elength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">etype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">elength</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">etype</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">phid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">beta0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>
            <span class="n">ray3d</span><span class="o">.</span><span class="n">nstr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray3d</span><span class="o">.</span><span class="n">nn</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pt</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phid</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">phii</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">ray3d</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">beta0</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">ray3d</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="n">nn</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">ray3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="p">)</span>
            <span class="n">ray3D</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ray3d</span><span class="p">)</span>
        <span class="n">G</span><span class="o">.</span><span class="n">ray3d</span> <span class="o">=</span> <span class="n">ray3D</span>
        <span class="k">return</span><span class="p">(</span><span class="n">G</span><span class="p">)</span></div>

<div class="viewcode-block" id="GrRay3D.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.show.html#pylayers.antprop.raysc.GrRay3D.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="p">[],</span> <span class="n">rayset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show a cluster of rays</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig    : figure instance</span>
<span class="sd">        ax     : axes instance</span>
<span class="sd">        rayset :</span>
<span class="sd">            set of rays np.array([])</span>
<span class="sd">        col  : string</span>
<span class="sd">            default  {&#39;b&#39;}</span>
<span class="sd">        node : boolean</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rayset</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="GrRay3D.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.antprop.raysc.GrRay3D.show3.html#pylayers.antprop.raysc.GrRay3D.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rayset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">bdis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">bstruc</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 3D show using geomview</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rayset : set of index of rays to be displayed</span>
<span class="sd">        bdis : display boolean - if False return .vect filename</span>
<span class="sd">        id   : id of the grRray</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rayset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">rayset</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="s2">&quot;grRay&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.list&quot;</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIST</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bstruc</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;defstr.off}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># fo.write(&quot;{&lt;strucTxRx.off}\n&quot;)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rayset</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">fileray</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">show3</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt; &quot;</span> <span class="o">+</span> <span class="n">fileray</span> <span class="o">+</span> <span class="s2">&quot; }</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bdis</span><span class="p">):</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="s2">&quot;geomview &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; 2&gt;/dev/null &amp;&quot;</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span></div>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2016, PyLayers developer team.
      Last updated on Jul 29, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5a0. Design by <a href="http://desgrana.es">Desgrana</a>.
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="../../../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>