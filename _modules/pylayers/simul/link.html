

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pylayers.simul.link &mdash; PyLayers</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
  

  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="PyLayers" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Python
          

          
            
            <img src="../../../_static/pylayers.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebook/index.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout1.html">Loading an outdoor layout from its address</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_antenna.html">Antenna Pattern for an H plane sectoral antenna &#64; 32GHz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLayout2.html">Building graphs of a Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_coverage.html">Indoor Radio Coverage with Motley Keenan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_layout.html">8 Random Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exAbsGas.html">Attenuation due to atmospheric gases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exDLink.html">Evaluation of a radio link DLink</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_w1.html">Indoor Radio Coverage FP7 WHERE1 M1 setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_exLuebbers.html">UWB Ray tracing simulation  in outdoor scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../auto_examples/plot_diffraction.html">Diffraction coefficient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html">1&nbsp;&nbsp;&nbsp;pylayers.util.project Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.layout">2&nbsp;&nbsp;&nbsp;pylayers.gis.layout Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.selectl">3&nbsp;&nbsp;&nbsp;pylayers.gis.selectl Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.srtm">4&nbsp;&nbsp;&nbsp;pylayers.gis.srtm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.osmparser">5&nbsp;&nbsp;&nbsp;pylayers.gis.osmparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.gis.ezone">6&nbsp;&nbsp;&nbsp;pylayers.gis.ezone Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antenna">7&nbsp;&nbsp;&nbsp;pylayers.antprop.antenna Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.aarray">8&nbsp;&nbsp;&nbsp;pylayers.antprop.aarray Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.spharm">9&nbsp;&nbsp;&nbsp;pylayers.antprop.spharm Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antssh">10&nbsp;&nbsp;&nbsp;pylayers.antprop.antssh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.antvsh">11&nbsp;&nbsp;&nbsp;pylayers.antprop.antvsh Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.slab">12&nbsp;&nbsp;&nbsp;pylayers.antprop.slab Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.signature">13&nbsp;&nbsp;&nbsp;pylayers.antprop.signature Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.interactions">14&nbsp;&nbsp;&nbsp;pylayers.antprop.interactions Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffraction">15&nbsp;&nbsp;&nbsp;pylayers.antprop.diffraction Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.diffRT">16&nbsp;&nbsp;&nbsp;pylayers.antprop.diffRT Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.rays">17&nbsp;&nbsp;&nbsp;pylayers.antprop.rays Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.loss">18&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.channel">19&nbsp;&nbsp;&nbsp;pylayers.antprop.channel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id39">20&nbsp;&nbsp;&nbsp;pylayers.antprop.loss Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coverage">21&nbsp;&nbsp;&nbsp;pylayers.antprop.coverage Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.antprop.coeffModel">22&nbsp;&nbsp;&nbsp;pylayers.antprop.coeffModel Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.link">23&nbsp;&nbsp;&nbsp;pylayers.simul.link Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit">24&nbsp;&nbsp;&nbsp;pylayers.simul.exploit Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.exploit_simulnet">25&nbsp;&nbsp;&nbsp;pylayers.simul.exploit_simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simulnet">26&nbsp;&nbsp;&nbsp;pylayers.simul.simulnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.simul.simultraj">27&nbsp;&nbsp;&nbsp;pylayers.simul.simultraj Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.exploit.simnet">28&nbsp;&nbsp;&nbsp;pylayers.exploit.simnet Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesuwb">29&nbsp;&nbsp;&nbsp;pylayers.measures.mesuwb Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.mesmimo">30&nbsp;&nbsp;&nbsp;pylayers.measures.mesmimo Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.cormoran">31&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.vna.E5072A">32&nbsp;&nbsp;&nbsp;pylayers.measures.vna.E5072A Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.measures.parker.smparker">33&nbsp;&nbsp;&nbsp;pylayers.measures.parker.smparker Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.bsignal">34&nbsp;&nbsp;&nbsp;pylayers.signal.bsignal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.device">35&nbsp;&nbsp;&nbsp;pylayers.signal.device Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.DF">36&nbsp;&nbsp;&nbsp;pylayers.signal.DF Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.signal.waveform">37&nbsp;&nbsp;&nbsp;pylayers.signal.waveform Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.agent">38&nbsp;&nbsp;&nbsp;pylayers.mobility.agent Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#module-pylayers.mobility.ban.body">39&nbsp;&nbsp;&nbsp;pylayers.mobility.ban.body Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/references.html#id134">40&nbsp;&nbsp;&nbsp;pylayers.measures.cormoran Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>pylayers.simul.link</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pylayers.simul.link</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="sd">r&quot;&quot;&quot;</span>

<span class="sd">.. currentmodule:: pylayers.simul.link</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :members:</span>

<span class="sd">&quot;&quot;&quot;</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
    <span class="kn">from</span> <span class="nn">mayavi.sources.vtk_data_source</span> <span class="kn">import</span> <span class="n">VTKDataSource</span>
    <span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Layout:Mayavi is not installed&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.waveform</span> <span class="kn">as</span> <span class="nn">wvf</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span> 

<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">from</span> <span class="nn">pylayers.simul.radionode</span> <span class="kn">import</span> <span class="n">RadioNode</span>
<span class="c1"># Handle Layout</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="c1"># Handle Antenna</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">import</span> <span class="n">Antenna</span>

<span class="c1"># Handle Signature</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.signature</span> <span class="kn">import</span> <span class="n">Signatures</span><span class="p">,</span><span class="n">Signature</span>
<span class="c1"># Handle Rays</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.rays</span> <span class="kn">import</span> <span class="n">Rays</span>
<span class="c1"># Handle VectChannel and ScalChannel</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.channel</span> <span class="kn">import</span> <span class="n">Ctilde</span><span class="p">,</span> <span class="n">Tchannel</span> <span class="p">,</span> <span class="n">AFPchannel</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.statModel</span> <span class="kn">import</span> <span class="n">getchannel</span>
<span class="kn">import</span> <span class="nn">tqdm</span>


<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pdb</span>



<div class="viewcode-block" id="Link"><a class="viewcode-back" href="../../../api/pylayers.simul.link.Link.html#pylayers.simul.link.Link">[docs]</a><span class="k">class</span> <span class="nc">Link</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Link is a MetaClass, which derives from `Tchannel`.</span>
<span class="sd">        Tchannel is a transmission channel i.e a radio channel</span>
<span class="sd">        which includes both link termination antennas.</span>

<span class="sd">        A common factor of both statistical (SLink) and deterministic channel (DLink)</span>
<span class="sd">        is the exitence of :math:`\alpha_k` and :math:`\tau_k`</span>
<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Link evaluation metaclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PyLayers</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
   


    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; merge ak and tauk of 2 Links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">L</span>  <span class="o">=</span> <span class="n">Link</span><span class="p">()</span>
        <span class="n">tk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">tk</span><span class="p">,</span><span class="n">l</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">tk</span><span class="p">))</span>
        <span class="n">ak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ak</span><span class="p">,</span><span class="n">l</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ak</span><span class="p">))</span>
        <span class="n">us</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">tk</span><span class="p">)</span>
        <span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ak</span> <span class="o">=</span> <span class="n">ak</span><span class="p">[</span><span class="n">us</span><span class="p">]</span>
        <span class="n">L</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">tk</span> <span class="o">=</span> <span class="n">tk</span><span class="p">[</span><span class="n">us</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">L</span></div>


<div class="viewcode-block" id="SLink"><a class="viewcode-back" href="../../../api/pylayers.simul.link.SLink.html#pylayers.simul.link.SLink">[docs]</a><span class="k">class</span> <span class="nc">SLink</span><span class="p">(</span><span class="n">Link</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Statistical Link evaluation class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SLink</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>


<div class="viewcode-block" id="SLink.onbody"><a class="viewcode-back" href="../../../api/pylayers.simul.link.SLink.html#pylayers.simul.link.SLink.onbody">[docs]</a>    <span class="k">def</span> <span class="nf">onbody</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">dida</span><span class="p">,</span> <span class="n">didb</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Statistical evaluation of a on-body link</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        B : Body</span>
<span class="sd">            Body object on which devices are held</span>
<span class="sd">        dida: int</span>
<span class="sd">            device a id number on body</span>
<span class="sd">        didb: int</span>
<span class="sd">            device b id number on body</span>
<span class="sd">        a : nd array</span>
<span class="sd">            position of device a</span>
<span class="sd">        b : nd array</span>
<span class="sd">            position of device b</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        (ak, tk, eng )</span>

<span class="sd">        ak : ndarray</span>
<span class="sd">            alpha_k</span>
<span class="sd">        tk : ndarray</span>
<span class="sd">            tau_k</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.mobility.ban.body</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># inter to be replace by engaement</span>
        <span class="n">eng</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">intersectBody3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">topos</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">empa</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">dida</span><span class="p">][</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span>
        <span class="n">empb</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">didb</span><span class="p">][</span><span class="s1">&#39;cyl&#39;</span><span class="p">]</span>

        <span class="n">emp</span> <span class="o">=</span> <span class="n">empa</span>
        <span class="k">if</span> <span class="n">empa</span> <span class="o">==</span> <span class="s1">&#39;trunkb&#39;</span><span class="p">:</span>
            <span class="n">emp</span> <span class="o">=</span> <span class="n">empb</span>
        <span class="k">if</span> <span class="n">emp</span> <span class="o">==</span> <span class="s1">&#39;forearml&#39;</span><span class="p">:</span>
            <span class="n">emp</span> <span class="o">=</span> <span class="s1">&#39;forearmr&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ak</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">tk</span> <span class="o">=</span> <span class="n">getchannel</span><span class="p">(</span><span class="n">emplacement</span><span class="o">=</span><span class="n">emp</span><span class="p">,</span> <span class="n">intersection</span><span class="o">=</span><span class="n">eng</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eng</span> <span class="o">=</span> <span class="n">eng</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">ak</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">tk</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eng</span></div></div>



<div class="viewcode-block" id="DLink"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink">[docs]</a><span class="k">class</span> <span class="nc">DLink</span><span class="p">(</span><span class="n">Link</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Deterministic Link Class</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">        L : Layout</span>
<span class="sd">            Layout to be used</span>
<span class="sd">        Aa : Antenna</span>
<span class="sd">            Antenna of device dev_a</span>
<span class="sd">        Ab : Antenna</span>
<span class="sd">            Antenna of device dev_b</span>
<span class="sd">        a : np.ndarray (3,)</span>
<span class="sd">            position of a device dev_a</span>
<span class="sd">        b : np.ndarray (3,)</span>
<span class="sd">            position of a device dev_b</span>
<span class="sd">        ca : int </span>
<span class="sd">            cycle a number</span>
<span class="sd">        cb : int </span>
<span class="sd">            cycle b number</span>
<span class="sd">        Ta : np.ndarray (3,3)</span>
<span class="sd">            Rotation matrice of Antenna of device dev_a relative to global Layout scene</span>
<span class="sd">        Tb : np.ndarray (3,3)</span>
<span class="sd">            Rotation matrice of Antenna of device dev_b relative to global Layout scene</span>
<span class="sd">        fGHz : np.ndarray (Nf,)</span>
<span class="sd">            frequency range of Nf points used for evaluation of channel</span>
<span class="sd">        wav : Waveform</span>
<span class="sd">            Waveform to be applied on the channel</span>
<span class="sd">        save_idx : int</span>
<span class="sd">            number to identify the h5 file generated</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; deterministic link evaluation</span>

<span class="sd">        </span>
<span class="sd">        Advanced (change only if you really know what you do !)</span>

<span class="sd">        save_opt : list ([&#39;sig&#39;,&#39;ray&#39;,&#39;Ct&#39;,&#39;H&#39;])</span>
<span class="sd">            information to be saved in the Links h5 file. Should never be Modified !</span>

<span class="sd">        force_create : Boolean (False)</span>
<span class="sd">            force creating the h5py file (if already exist, will be erased)</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        All simulations are stored into a unique file in your &lt;PyProject&gt;/output directory</span>
<span class="sd">        using the following convention:</span>

<span class="sd">        Links_&lt;save_idx&gt;_&lt;LayoutFilename&gt;.h5</span>

<span class="sd">        where</span>
<span class="sd">            &lt;save_idx&gt; is an integer number to distinguish different links simulations</span>
<span class="sd">        and &lt;LayoutFilename&gt; is the Layout used for the link simulation.</span>



<span class="sd">        Dataset organisation:</span>

<span class="sd">        Links_&lt;idx&gt;_&lt;Layout_name&gt;.h5</span>
<span class="sd">            |</span>
<span class="sd">            |/sig/si_ID#0/</span>
<span class="sd">            |    /si_ID#1/</span>
<span class="sd">            |    ...</span>
<span class="sd">            |</span>
<span class="sd">            |/ray/ray_ID#0/</span>
<span class="sd">            |    /ray_ID#1/</span>
<span class="sd">            |    ...</span>
<span class="sd">            |</span>
<span class="sd">            |/Ct/Ct_ID#0/</span>
<span class="sd">            |   /Ct_ID#1/</span>
<span class="sd">            |    ...</span>
<span class="sd">            |</span>
<span class="sd">            |/H/H_ID#0/</span>
<span class="sd">            |  /H_ID#1/</span>
<span class="sd">            |    ...</span>
<span class="sd">            |</span>
<span class="sd">            |</span>
<span class="sd">            |p_map</span>
<span class="sd">            |c_map</span>
<span class="sd">            |f_map</span>
<span class="sd">            |A_map</span>
<span class="sd">            |T_map</span>



<span class="sd">        Roots Dataset :</span>

<span class="sd">        c_map : Cycles (Nc x 3)</span>
<span class="sd">        p_map : Positions (Np x 3)</span>
<span class="sd">        f_map : Frequency (Nf x 3)</span>
<span class="sd">        T_map : Rotation matrices (Nt x 3)</span>
<span class="sd">        A_map : Antenna name (Na x 3)</span>

<span class="sd">        Groups and subgroups:</span>


<span class="sd">            Signature identifier (si_ID#N):</span>
<span class="sd">                ca_cb_cutoff_th</span>

<span class="sd">            Ray identifier (ray_ID#N):</span>
<span class="sd">                cutoff_th_ua_ub</span>

<span class="sd">            Ctilde identifier (Ct_ID#N):</span>
<span class="sd">                ua_ub_uf</span>

<span class="sd">            H identifier (H_ID#N):</span>
<span class="sd">                ua_ub_uf_uTa_uTb_uAa_uAb</span>

<span class="sd">            with</span>
<span class="sd">            ca : cycle number of a</span>
<span class="sd">            cb : cycle number of b</span>
<span class="sd">            cutoff : signature.run cutoff</span>
<span class="sd">            th : signature.run threshold * 100</span>
<span class="sd">            ua : indice of a position in &#39;p_map&#39; position dataset</span>
<span class="sd">            ub : indice of a position in &#39;p_map&#39; position dataset</span>
<span class="sd">            uf : indice of freq position in &#39;f_map&#39; frequency dataset</span>
<span class="sd">            uTa : indice of a position in &#39;T_map&#39; Rotation dataset</span>
<span class="sd">            uTb : indice of a position in &#39;T_map&#39; Rotation dataset</span>
<span class="sd">            uAa : indice of a position in &#39;A_map&#39; Antenna name dataset</span>
<span class="sd">            uAb : indice of b position in &#39;A_map&#39; Antenna name dataset</span>



<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.simul.link import *</span>
<span class="sd">        &gt;&gt;&gt; DL = DLink(L=Layout(&#39;DLR.lay&#39;))</span>
<span class="sd">        &gt;&gt;&gt; DL.eval()</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">Link</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span>
                   <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(()),</span>
                   <span class="s1">&#39;Aa&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;Ab&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;Ta&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                   <span class="s1">&#39;Tb&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                   <span class="s1">&#39;fGHz&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">]),</span>
                   <span class="s1">&#39;wav&#39;</span><span class="p">:</span><span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">(),</span>
                   <span class="s1">&#39;cutoff&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span>
                   <span class="s1">&#39;threshold&#39;</span><span class="p">:</span><span class="mf">0.8</span><span class="p">,</span>
                   <span class="s1">&#39;delay_excess_max_ns&#39;</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span>
                   <span class="s1">&#39;save_opt&#39;</span><span class="p">:[</span><span class="s1">&#39;sig&#39;</span><span class="p">,</span><span class="s1">&#39;ray2&#39;</span><span class="p">,</span><span class="s1">&#39;ray&#39;</span><span class="p">,</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">],</span>
                   <span class="s1">&#39;save_idx&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                   <span class="s1">&#39;force_create&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;verbose&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;seed&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                   <span class="s1">&#39;graph&#39;</span><span class="p">:</span><span class="s1">&#39;tcvirw&#39;</span>
                <span class="p">}</span>



        <span class="c1"># self._ca = -1</span>
        <span class="c1"># self._cb = -1</span>

        <span class="n">specset</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;Aa&#39;</span><span class="p">,</span><span class="s1">&#39;Ab&#39;</span><span class="p">,</span><span class="s1">&#39;Ta&#39;</span><span class="p">,</span><span class="s1">&#39;Tb&#39;</span><span class="p">,</span><span class="s1">&#39;cutoff&#39;</span><span class="p">,</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;fGHz&#39;</span><span class="p">,</span><span class="s1">&#39;wav&#39;</span><span class="p">]</span>

        <span class="c1"># set default attribute</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">specset</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">specset</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

                <span class="k">else</span> <span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="c1"># if self._L == &#39;&#39;:</span>
        <span class="c1">#     raise AttributeError(&#39;Please specify a Layout&#39;)</span>


        <span class="n">force</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force_create</span>
        <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;force_create&#39;</span><span class="p">)</span>

       
        <span class="c1"># dictionnary data exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sig&#39;</span><span class="p">:{</span><span class="s1">&#39;exist&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;grpname&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">},</span>
                     <span class="s1">&#39;ray&#39;</span><span class="p">:{</span><span class="s1">&#39;exist&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;grpname&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">},</span>
                     <span class="s1">&#39;ray2&#39;</span><span class="p">:{</span><span class="s1">&#39;exist&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;grpname&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">},</span>
                     <span class="s1">&#39;Ct&#39;</span><span class="p">:{</span><span class="s1">&#39;exist&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;grpname&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">},</span>
                     <span class="s1">&#39;H&#39;</span><span class="p">:{</span><span class="s1">&#39;exist&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;grpname&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">}</span>
                    <span class="p">}</span>

        <span class="c1"># The link frequency range depends on the antenna </span>
        <span class="c1"># self.fGHz = kwargs[&#39;fGHz&#39;]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">==</span><span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">=</span><span class="n">Antenna</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;Omni&#39;</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">==</span><span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">=</span><span class="n">Antenna</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;Omni&#39;</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span><span class="p">,</span><span class="n">bgraphs</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">bcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="o">.</span><span class="n">_filename</span>



        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Links_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>
            <span class="n">filenameh5</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
            <span class="c1"># check if save file alreasdy exists</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">)</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Links save file for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s1">&#39; does not exist.&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Creating file. You</span><span class="se">\&#39;</span><span class="s1">ll see this message only once per Layout&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_init</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">)</span>

            
            
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Layout Graph loaded&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;This is the first time the Layout is used. Graphs have to be built. Please Wait&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>
            
            <span class="c1">#</span>
            <span class="c1"># In outdoor situation we delete transmission node involving  </span>
            <span class="c1"># an indoor cycle at the exception of AIR </span>
            <span class="c1">#</span>
            <span class="n">cindoor</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s1">&#39;indoor&#39;</span><span class="p">]]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span><span class="s1">&#39;outdoor&#39;</span><span class="p">:</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="c1"># lT : list of transmission interactions </span>
                <span class="n">lT</span>  <span class="o">=</span>  <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">u</span> <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)]</span>
                <span class="c1"># lTi : transmission connected at least to an indoor cycle</span>
                <span class="n">lTi</span> <span class="o">=</span> <span class="p">[</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lT</span> <span class="k">if</span> <span class="p">((</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="ow">in</span> <span class="n">cindoor</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cindoor</span><span class="p">))]</span>
                <span class="c1"># lTiw : those which are wall (not those above buildings) </span>
                <span class="n">lTiw</span> <span class="o">=</span> <span class="p">[</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lTi</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;AIR&#39;</span> <span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">lTiw</span><span class="p">)</span>
                <span class="n">lE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lE</span><span class="p">)):</span>
                    <span class="n">e</span> <span class="o">=</span> <span class="n">lE</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lTiw</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">output</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gi</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">output</span>
                
            <span class="c1">#self.L.dumpw()</span>
            <span class="c1">#self.L.build()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">init_positions</span><span class="p">()</span>


           
            <span class="c1">###########</span>
            <span class="c1"># init freq</span>
            <span class="c1"># TODO Check where it is used redundant with fGHz</span>
            <span class="c1">###########</span>
            <span class="c1">#self.fmin  = self.fGHz[0]</span>
            <span class="c1">#self.fmax  = self.fGHz[-1]</span>
            <span class="c1">#self.fstep = self.fGHz[1]-self.fGHz[0]</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">Rays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">Ctilde</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">()</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Lname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_a</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_b</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ca</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Aa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Aa</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ab</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Ta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Ta</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Tb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Tb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fGHz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fGHz</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">delay_excess_max_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delay_excess_max_ns</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">wav</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wav</span>

    <span class="nd">@L.setter</span>
    <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">L</span><span class="p">):</span>
        <span class="c1"># change layout and build/load</span>
        <span class="n">plotfig</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">plotfig</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">bgraphs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">=</span> <span class="n">L</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">Layout</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">L</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">_filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_config</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">plotfig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show3</span><span class="p">()</span>

    <span class="nd">@Lname.setter</span>
    <span class="k">def</span> <span class="nf">Lname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Lname</span><span class="p">):</span>
        <span class="c1"># change layout and build/load</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">Lname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">=</span> <span class="n">Lname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_config</span><span class="p">()</span>


    <span class="nd">@a.setter</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ptin</span><span class="p">(</span><span class="n">position</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="c1"># raise NameError (&#39;Warning : point a is not inside the Layout&#39;)</span>
            <span class="c1"># raise NameError (&#39;Warning : point a is not inside the Layout&#39;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_a</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">delrays</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autocufoff</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

    <span class="nd">@b.setter</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ptin</span><span class="p">(</span><span class="n">position</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="c1"># raise NameError (&#39;Warning : point b is not inside the Layout&#39;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_b</span> <span class="o">=</span> <span class="n">position</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">delrays</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autocufoff</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

    <span class="nd">@ca.setter</span>
    <span class="k">def</span> <span class="nf">ca</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cycle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NameError</span> <span class="p">(</span><span class="s1">&#39;cycle ca is not inside Gt&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ca</span> <span class="o">=</span> <span class="n">cycle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">cy2pt</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

    <span class="nd">@cb.setter</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cycle</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cycle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">NameError</span> <span class="p">(</span><span class="s1">&#39;cycle cb is not inside Gt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cb</span> <span class="o">=</span> <span class="n">cycle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">cy2pt</span><span class="p">(</span><span class="n">cycle</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

    <span class="nd">@Aa.setter</span>
    <span class="k">def</span> <span class="nf">Aa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Ant</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="p">,</span><span class="s1">&#39;_mayamesh&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">_mayamesh</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="c1"># save rot</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Aa</span> <span class="o">=</span> <span class="n">Ant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span> <span class="o">=</span> <span class="n">rot</span>
        <span class="k">if</span> <span class="n">Ant</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">Ant</span><span class="o">.</span><span class="n">fGHz</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Warning : frequency range modified by antenna Aa&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Aa</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        <span class="c1"># self.initfreq()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>


    <span class="nd">@Ab.setter</span>
    <span class="k">def</span> <span class="nf">Ab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Ant</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="p">,</span><span class="s1">&#39;_mayamesh&#39;</span><span class="p">):</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">_mayamesh</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>


        
        <span class="c1">#save rot</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ab</span> <span class="o">=</span> <span class="n">Ant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">rot</span>
        <span class="k">if</span> <span class="n">Ant</span><span class="o">.</span><span class="n">fromfile</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">Ant</span><span class="o">.</span><span class="n">fGHz</span>
           <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Warning : frequency range modified by antenna Ab&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">_Ab</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>


    <span class="nd">@Ta.setter</span>
    <span class="k">def</span> <span class="nf">Ta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">orientation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Ta</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>



    <span class="nd">@Tb.setter</span>
    <span class="k">def</span> <span class="nf">Tb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">orientation</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Tb</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_maya_fig&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">_is_running</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_show3</span><span class="p">(</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

        <span class="c1"># if self.dexist[&#39;Ct&#39;][&#39;exist&#39;]:</span>
        <span class="c1">#     self.C.locbas(Ta=self.Ta, Tb=self.Tb)</span>
        <span class="c1">#     #T channel</span>
        <span class="c1">#     self.H = self.C.prop2tran(a=self.Aa,b=self.Ab,Friis=True)</span>


    <span class="nd">@cutoff.setter</span>
    <span class="k">def</span> <span class="nf">cutoff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="p">):</span>

        <span class="n">co</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cutoff</span><span class="o">=</span><span class="n">co</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>


    <span class="nd">@threshold.setter</span>
    <span class="k">def</span> <span class="nf">threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="p">):</span>

        <span class="n">th</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">th</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threshold</span><span class="o">=</span> <span class="n">th</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

    <span class="nd">@delay_excess_max_ns.setter</span>
    <span class="k">def</span> <span class="nf">delay_excess_max_ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">delay_excess_max_ns</span><span class="p">):</span>

        <span class="n">delay_excess_max_ns</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">delay_excess_max_ns</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">_delay_excess_max_ns</span> <span class="o">=</span> <span class="n">delay_excess_max_ns</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span>


    <span class="nd">@fGHz.setter</span>
    <span class="k">def</span> <span class="nf">fGHz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">freq</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">freq</span><span class="p">])</span>

        <span class="n">diff_freq_a</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">fGHz</span><span class="o">!=</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">diff_freq_b</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">fGHz</span><span class="o">!=</span><span class="n">freq</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">diff_freq_a</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            <span class="n">cond_a</span> <span class="o">=</span> <span class="n">diff_freq_a</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">cond_a</span> <span class="o">=</span> <span class="n">diff_freq_a</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="k">if</span>  <span class="nb">isinstance</span><span class="p">(</span><span class="n">diff_freq_b</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            <span class="n">cond_b</span> <span class="o">=</span> <span class="n">diff_freq_b</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">cond_b</span> <span class="o">=</span> <span class="n">diff_freq_b</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>


        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">fromfile</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">cond_a</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Antenna Aa frequency range is fixed, you cannot change frequency&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">fromfile</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">cond_b</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot; Antenna Ab frequency range is fixed,you cannot change frequency&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fGHz</span> <span class="o">=</span> <span class="n">freq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span>

        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ca&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cb&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span>

        <span class="c1"># if self.Aa.typ == &#39;Omni&#39;:</span>
        <span class="c1">#     self.Aa.fGHz = self.fGHz</span>
        <span class="c1"># if self.Ab.typ == &#39;Omni&#39;:</span>
        <span class="c1">#     self.Ab.fGHz = self.fGHz</span>
        <span class="c1">#if len(freq)&gt;1:</span>
        <span class="c1">#    self.fmin = freq[0]</span>
        <span class="c1">#    self.fmax = freq[-1]</span>
        <span class="c1">#    self.fstep = freq[1]-freq[0]</span>
        <span class="c1">#else:</span>
        <span class="c1">#    self.fmin = freq</span>
        <span class="c1">#    self.fmax = freq</span>
        <span class="c1">#    self.step = 0</span>

    <span class="nd">@wav.setter</span>
    <span class="k">def</span> <span class="nf">wav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">waveform</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wav</span> <span class="o">=</span> <span class="n">waveform</span>
        <span class="k">if</span> <span class="s1">&#39;H&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chanreal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">get_cir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; __repr__</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;filename: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Link Parameters :</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;------- --------</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Layout : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Lname</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Node a   </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;------  </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;position : &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;  in cycle &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Antenna : &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Rotation matrice : </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Node b   </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;------  </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;position : &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; in cycle &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Antenna : &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Rotation matrice : </span><span class="se">\n</span><span class="s1"> &#39;</span> <span class="o">+</span> <span class="nb">str</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Link evaluation information : </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;----------------------------- </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;distance : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%6.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span> <span class="o">+</span> <span class="s1">&#39; m </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;delay : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%6.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="mf">0.3</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; ns</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">rd2deg</span> <span class="o">=</span> <span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
                <span class="n">vsba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">angledir</span><span class="p">(</span><span class="n">vsba</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">angledir</span><span class="p">(</span><span class="o">-</span><span class="n">vsba</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;azimuth (a | b ) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; deg  | &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;elevation (a | b ) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; deg |  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;tilt (a |  b ) : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="n">a1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; deg  | &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">rd2deg</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; deg</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="c1">#s = s + &#39;Frequency range :  \n&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fmin (fGHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fmax (fGHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Nf</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fstep (fGHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;fstep (fGHz) : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Nf : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> &#39;</span>
            <span class="n">d</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">Nf</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">fcGHz</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fcGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">L</span>  <span class="o">=</span> <span class="mf">32.4</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fcGHz</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;Algorithm information : </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;----------------------------- </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;cutoff : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;threshold :&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;delay_excess_max : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_excess_max_ns</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; ns </span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;dist_excess_max : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delay_excess_max_ns</span><span class="o">*</span><span class="mf">0.3</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; m </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;No Layout specified&#39;</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="DLink.inforay"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.inforay">[docs]</a>    <span class="k">def</span> <span class="nf">inforay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; provide full information about a specified ray</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        iray : int </span>
<span class="sd">            ray index</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ray : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iray</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">PM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">iray</span><span class="p">,</span><span class="n">ifGHz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">matrix</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Propagation Channel 2x2 (C):&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">inforay</span><span class="p">(</span><span class="n">iray</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">islocal</span><span class="p">:</span>
            <span class="c1"># back to global frame</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">tauk</span><span class="p">[</span><span class="n">iray</span><span class="p">]</span><span class="o">*</span><span class="mf">0.3</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">dist</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ctt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Ctp</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">Cpt</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">iray</span><span class="p">,</span><span class="mi">0</span><span class="p">]]]</span> <span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">PM</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">locbas</span><span class="p">()</span></div>

    <span class="c1"># def initfreq(self):</span>
    <span class="c1">#     &quot;&quot;&quot; Automatic freq determination from</span>
    <span class="c1">#         Antennas</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     #sf = self.fGHz[1]-self.fGHz[0]</span>
    <span class="c1">#     sf = 1e15</span>
    <span class="c1">#     if hasattr(self.Aa,&#39;fGHz&#39;):</span>
    <span class="c1">#         fa = self.Aa.fGHz</span>
    <span class="c1">#         if len(fa)==0:</span>
    <span class="c1">#             fa = np.array([2.4])</span>
    <span class="c1">#             self.Aa.fGHz = fa</span>
    <span class="c1">#             # raise AttributeError(&quot;Incompatible frequency range in Antenna. Consider change Dlink.fGHz&quot;) </span>
    <span class="c1">#             print &quot;Incompatible frequency range in Antenna. WARNING  Dlink.fGHz changed to 2.4GHz&quot;</span>
    <span class="c1">#         try:</span>
    <span class="c1">#             sa = fa[1]-fa[0]  # step frequecy </span>
    <span class="c1">#         except: #single frequency</span>
    <span class="c1">#             sa = fa[0]</span>
    <span class="c1">#         # step</span>
    <span class="c1">#         if len(self.fGHz)&gt;0:</span>
    <span class="c1">#             minfa = max(min(fa),min(self.fGHz))</span>
    <span class="c1">#             maxfa = min(max(fa),max(self.fGHz))</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             minfa = min(fa)</span>
    <span class="c1">#             maxfa = max(fa)</span>
    <span class="c1">#         sf = min(sa,sf)</span>
    <span class="c1">#         self.fGHz = np.arange(minfa,maxfa+sf,sf)</span>

    <span class="c1">#     elif hasattr(self.Ab,&#39;fGHz&#39;):</span>
    <span class="c1">#         fb = self.Ab.fGHz</span>
    <span class="c1">#         if len(fb)==0:</span>
    <span class="c1">#             # raise AttributeError(&quot;Incompatible frequency range in Antenna. Consider change Dlink.fGHz&quot;)</span>
    <span class="c1">#             fb = np.array([2.4])</span>
    <span class="c1">#             self.Ab.fGHz=fb</span>
    <span class="c1">#             # raise AttributeError(&quot;Incompatible frequency range in Antenna. Consider change Dlink.fGHz&quot;) </span>
    <span class="c1">#             print &quot;Incompatible frequency range in Antenna. WARNING  Dlink.fGHz changed to 2.4GHz&quot;</span>
        
    <span class="c1">#         try:</span>
    <span class="c1">#             sb = fb[1]-fb[0] # step frequency </span>
    <span class="c1">#         except:</span>
    <span class="c1">#             sb = fb[0]</span>

    <span class="c1">#         if len(self.fGHz)&gt;0:</span>
    <span class="c1">#             minfb = max(min(self.fGHz),min(fb))</span>
    <span class="c1">#             maxfb = min(max(self.fGHz),max(fb))</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             minfb = min(fb)</span>
    <span class="c1">#             maxfb = max(fb)</span>

    <span class="c1">#         sf = min(sf,sb)</span>
    <span class="c1">#         self.fGHz = np.arange(minfb,maxfb+sf,sf)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         self.fGHz = np.array([2.3,2.4,2.5])</span>


<div class="viewcode-block" id="DLink.init_positions"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.init_positions">[docs]</a>    <span class="k">def</span> <span class="nf">init_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize random positions for a link</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        force : boolean </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">###########</span>
        <span class="c1"># init pos &amp; cycles</span>
        <span class="c1">#</span>
        <span class="c1"># If a and b are not specified</span>
        <span class="c1">#  they are chosen as center of gravity of cycle 0</span>
        <span class="c1">#</span>
        <span class="c1">###########</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># pick the point outside building if Layout.indoor not activated </span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;outdoor&#39;</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">!=</span><span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gt</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;indoor&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">!=</span><span class="mi">0</span> <span class="p">]</span>

        <span class="c1"># draw the link extremities randomly</span>

        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>    
        <span class="n">ib</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span>    
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">ib</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span></div>

<div class="viewcode-block" id="DLink.reset_config"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.reset_config">[docs]</a>    <span class="k">def</span> <span class="nf">reset_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reset configuration when a new layout is loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpr</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">dumpw</span><span class="p">()</span>



        <span class="c1"># self.a = self.L.cy2pt(self.ca)</span>
        <span class="c1"># self.b = self.L.cy2pt(self.cb)</span>

        <span class="c1"># change h5py file if layout changed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;Links_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Lname</span> <span class="o">+</span> <span class="s1">&#39;.h5&#39;</span>
        <span class="n">filenameh5</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Links save file for &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s1">&#39; does not exist.&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;It is beeing created. You</span><span class="se">\&#39;</span><span class="s1">ll see that message only once per Layout&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_init</span><span class="p">(</span><span class="n">filenameh5</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">ca</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_positions</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Si&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="DLink.checkh5"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.checkh5">[docs]</a>    <span class="k">def</span> <span class="nf">checkh5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; check existence of previous simulations run with the same parameters.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        update self.dexist dictionnary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get identifier group name in h5py file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_grpname</span><span class="p">()</span>
        <span class="c1"># check if group name exists in the h5py file</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">check_grpname</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">])</span>   <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_opt</span><span class="p">]</span></div>



<div class="viewcode-block" id="DLink.save_init"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.save_init">[docs]</a>    <span class="k">def</span> <span class="nf">save_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename_long</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initialize the hdf5 file for link saving </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        filename_long : str</span>
<span class="sd">            complete path and filename</span>
<span class="sd">        </span>
<span class="sd">        &#39;sig&#39;    : Signatures</span>
<span class="sd">        &#39;ray2&#39;   : 2D rays </span>
<span class="sd">        &#39;ray&#39;    : 3D rays </span>
<span class="sd">        &#39;Ct&#39;     : Propagation channel </span>
<span class="sd">        &#39;H&#39;      : Transmission channel </span>
<span class="sd">        &#39;p_map&#39;  : points  </span>
<span class="sd">        &#39;c_map&#39;  : cycles </span>
<span class="sd">        &#39;f_map&#39;  : frequency </span>
<span class="sd">        &#39;A_map&#39;  : antennas </span>
<span class="sd">        &#39;T_map&#39;  : rotation </span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename_long</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;sig&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;ray2&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;ray&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;Ct&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
            <span class="c1"># mapping point a</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;p_map&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="c1"># mapping cycles</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;c_map&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="c1"># mapping (fmin,fmax,fstep)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;f_map&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="c1"># mapping Antenna name</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;A_map&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;S10&quot;</span><span class="p">)</span>
            <span class="c1"># mapping rotation matrices Antenna</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;T_map&#39;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">maxshape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Links: issue when initializing h5py file&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DLink.stack"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.stack">[docs]</a>    <span class="k">def</span> <span class="nf">stack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; stack new array in h5py file</span>
<span class="sd">            for a given key (dataframe/group)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        key : string</span>

<span class="sd">        array : np.ndarray</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        idx : int</span>
<span class="sd">            indice of last element of the array of key</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">lfilename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">lfilename</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;T_map&#39;</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">=</span><span class="n">array</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
                <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">sc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sc</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">=</span><span class="n">array</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sc</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Link stack: issue during stacking&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete a key and associated data into h5py file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        key : string</span>
<span class="sd">            key of the h5py file</span>
<span class="sd">        grpname : string</span>
<span class="sd">            groupe name of the h5py file</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lfilename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">lfilename</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="c1"># try/except to avoid loosing the h5 file if</span>
        <span class="c1"># read/write error</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">grpname</span><span class="p">]</span>
            <span class="c1"># print &#39;delete &#39;,key , &#39; in &#39;, grpname</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Link._delete: issue when deleting in h5py file&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="DLink.save"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">grpname</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Save a given object in the correct group</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        obj : Object</span>
<span class="sd">            (Signatures|Rays|Ctilde|Tchannel)</span>
<span class="sd">        key : string</span>
<span class="sd">            key of the h5py file</span>
<span class="sd">        gpname : string</span>
<span class="sd">            groupe name of the h5py file</span>
<span class="sd">        force : boolean or list </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">grpname</span><span class="p">)</span>
        <span class="c1"># if save is forced, previous existing data are removed and</span>
        <span class="c1"># replaced by new ones.</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">grpname</span><span class="p">)</span>
              
            <span class="n">obj</span><span class="o">.</span><span class="n">_saveh5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">grpname</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; from &#39;</span><span class="o">+</span> <span class="n">grpname</span> <span class="o">+</span> <span class="s1">&#39; saved&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DLink.load"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">obj</span><span class="p">,</span><span class="n">grpname</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Load a given object in the correct grp</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        obj : Object</span>
<span class="sd">            (Signatures|Rays|Ctilde|Tchannel)</span>
<span class="sd">        grpname : string</span>
<span class="sd">            groupe name of the h5py file</span>

<span class="sd">        kwargs : </span>
<span class="sd">        layout for sig and rays</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">obj</span><span class="o">.</span><span class="n">_loadh5</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">grpname</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; from &#39;</span><span class="o">+</span> <span class="n">grpname</span> <span class="o">+</span> <span class="s1">&#39; loaded&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DLink.get_grpname"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.get_grpname">[docs]</a>    <span class="k">def</span> <span class="nf">get_grpname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Determine the data group name for the given configuration</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Update the key grpname of self.dexist[key] dictionnary,</span>
<span class="sd">        where key  = &#39;sig&#39;|&#39;ray&#39;|&#39;Ct&#39;|&#39;H&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">############</span>
        <span class="c1"># Signatures</span>
        <span class="c1">############</span>

        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">]))</span>
        <span class="n">ua_opt</span><span class="p">,</span> <span class="n">ua</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;c_map&#39;</span><span class="p">,</span><span class="n">array</span><span class="p">)</span>
        <span class="n">th</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>


        <span class="n">grpname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">th</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">grpname</span>



        <span class="c1">############</span>
        <span class="c1"># Rays</span>
        <span class="c1">#############</span>

        <span class="c1"># check existence of self.a in h5py file</span>

        <span class="n">ua_opt</span><span class="p">,</span> <span class="n">ua</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;p_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="c1"># check existence of self.b in h5py file</span>
        <span class="n">ub_opt</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;p_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="c1"># Write in h5py if no prior a-b link</span>

        <span class="n">grpname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">th</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray2&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">grpname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">grpname</span>
        


        <span class="c1">############</span>
        <span class="c1"># Ctilde</span>
        <span class="c1">#############</span>

        <span class="c1"># check existence of frequency in h5py file</span>
        <span class="c1">#farray = np.array(([self.fmin,self.fmax,self.fstep]))</span>
        <span class="n">Nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Nf</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">farray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">farray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">uf_opt</span><span class="p">,</span> <span class="n">uf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;f_map&#39;</span><span class="p">,</span><span class="n">farray</span><span class="p">)</span>

        <span class="n">grpname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grpname</span>

        <span class="c1">############</span>
        <span class="c1"># H</span>
        <span class="c1">#############</span>


        <span class="c1"># check existence of Rot a (Ta) in h5py file</span>
        <span class="n">uTa_opt</span><span class="p">,</span> <span class="n">uTa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;T_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">)</span>
        <span class="c1"># check existence of Rot b (Tb) in h5py file</span>
        <span class="n">uTb_opt</span><span class="p">,</span> <span class="n">uTb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;T_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
        <span class="c1"># check existence of Antenna a (Aa) in h5py file</span>
        <span class="c1">#uAa_opt, uAa = self.get_idx(&#39;A_map&#39;,self.Aa._filename)</span>
        <span class="n">uAa_opt</span><span class="p">,</span> <span class="n">uAa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;A_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>
        <span class="c1"># check existence of Antenna b (Ab) in h5py file</span>
        <span class="n">uAb_opt</span><span class="p">,</span> <span class="n">uAb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_idx</span><span class="p">(</span><span class="s1">&#39;A_map&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span>


        <span class="n">grpname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ua</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uf</span><span class="p">)</span> <span class="o">+</span> \
                  <span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uTa</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uTb</span><span class="p">)</span> <span class="o">+</span> \
                  <span class="s1">&#39;_&#39;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uAa</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uAb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grpname</span></div>


<div class="viewcode-block" id="DLink.check_grpname"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.check_grpname">[docs]</a>    <span class="k">def</span> <span class="nf">check_grpname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">grpname</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if the key&#39;s data with a given groupname</span>
<span class="sd">            already exists in the h5py file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        key: string</span>
<span class="sd">            key of the h5py group</span>
<span class="sd">        grpname : string</span>
<span class="sd">            groupe name of the h5py file</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        update the key grpname of self.dexist[key] dictionnary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">lfilename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">lfilename</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">grpname</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Link exist: issue during stacking&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DLink.get_idx"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.get_idx">[docs]</a>    <span class="k">def</span> <span class="nf">get_idx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; try to get the index of the requested array in the group key</span>
<span class="sd">            of the hdf5 file.</span>
<span class="sd">            If array doesn&#39;t exist, the hdf5file[key] array is stacked</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        key: string</span>
<span class="sd">            key of the h5py group</span>
<span class="sd">        array : np.ndarray</span>
<span class="sd">            array to check existence</span>
<span class="sd">        tol : np.float64</span>
<span class="sd">            tolerance (in meters for key == &#39;p_map&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        (u_opt, u): tuple</span>

<span class="sd">        u : np.ndarray</span>
<span class="sd">            the index in the array of the file[key] group</span>
<span class="sd">        u_opt : string (&#39;r&#39;|&#39;s&#39;)</span>
<span class="sd">            return &#39;r&#39; if array has been read into h5py file</span>
<span class="sd">            return &#39;s&#39; if array has been stacked into the array of group key</span>



<span class="sd">        See Also:</span>
<span class="sd">        --------</span>

<span class="sd">        Links.array_exist</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">umap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array_exist</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
        <span class="n">lu</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">umap</span><span class="p">)</span>
        <span class="c1"># if exists take the existing one</span>
        <span class="c1"># otherwise value is created</span>
        <span class="k">if</span> <span class="n">lu</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">umap</span>
            <span class="n">u_opt</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">array</span><span class="p">)</span>
            <span class="n">u_opt</span><span class="o">=</span><span class="s1">&#39;s&#39;</span>
        <span class="k">return</span> <span class="n">u_opt</span><span class="p">,</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="DLink.array_exist"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.array_exist">[docs]</a>    <span class="k">def</span> <span class="nf">array_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">array</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot; check an array key has already been stored in h5py file</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        key: string</span>
<span class="sd">            key of the h5py group</span>
<span class="sd">        array : np.ndarray</span>
<span class="sd">            array type to check existency</span>
<span class="sd">        tol : np.float64</span>
<span class="sd">            tolerance (in meter for key == &#39;p_map&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (ua)</span>

<span class="sd">        ua : np.ndarray</span>
<span class="sd">            the indice in the array of the file[key] group</span>
<span class="sd">            if the array is emtpy, value doesn&#39;t exist</span>

<span class="sd">        TODO</span>
<span class="sd">        ----</span>

<span class="sd">        Add a tolerance on the rotation angle (T_map)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lfilename</span><span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRLNK&#39;</span><span class="p">])</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">lfilename</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="o">...</span><span class="p">]</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Link check_exist: issue during reading&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;c_map&#39;</span><span class="p">:</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">array</span> <span class="o">==</span> <span class="n">fa</span>
            <span class="c1"># sum eq = 3 means cy0,cy1 and cutoff are the same in fa and array</span>
            <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;p_map&#39;</span><span class="p">:</span>

            <span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">array</span><span class="o">-</span><span class="n">fa</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="c1"># indice points candidate in db for a</span>

            <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">da</span><span class="o">&lt;</span><span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;f_map&#39;</span><span class="p">:</span>
            <span class="c1"># import ipdb</span>
            <span class="c1"># ipdb.set_trace()</span>
            <span class="c1">#### fmin_h5 &lt; fmin_rqst</span>
            <span class="n">ufmi</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># old version</span>
                <span class="c1"># ufmi = np.where(fa[:,0]&lt;=array[0])[0]</span>
                <span class="c1"># lufmi = len(ufmi)</span>

            <span class="c1">#### fmax_h5 &gt; fmax_rqst</span>
            <span class="n">ufma</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># old version</span>
                <span class="c1"># ufma = np.where(fa[:,1]&gt;=array[1])[0]</span>
                <span class="c1"># lufma = len(ufma)</span>

            <span class="c1">### fstep_h5 &lt; fstep_rqst</span>
            <span class="n">ufst</span> <span class="o">=</span> <span class="n">fa</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">array</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># old version</span>
                <span class="c1"># ufst = np.where(fa[:,2]&lt;=array[2])[0]</span>
                <span class="c1"># lufst = len(ufst)</span>

            <span class="c1"># if fmin, fmax or fstep</span>
            <span class="c1">#if (lufmi==0) and (lufma==0) and (lufst==0):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ufmi</span><span class="o">.</span><span class="n">any</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ufma</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
                <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># find common lines of fmin and fmax and fstep</span>
                <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ufmi</span> <span class="o">&amp;</span> <span class="n">ufma</span> <span class="o">&amp;</span> <span class="n">ufst</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># ua = np.where(np.in1d(ufmi,ufma,ufst))[0]</span>
                <span class="c1"># # find common lines of fmin and fmax</span>
                <span class="c1"># ufmima = np.where(np.in1d(ufmi,ufma))[0]</span>
                <span class="c1"># # find common lines of fmin, fmax and fstep</span>
                <span class="c1"># ua = np.where(np.in1d(ufmima,ufst))[0]</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;A_map&#39;</span><span class="p">:</span>
            <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fa</span><span class="o">==</span><span class="n">array</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;T_map&#39;</span><span class="p">:</span>
            <span class="n">eq</span> <span class="o">=</span> <span class="n">array</span> <span class="o">==</span> <span class="n">fa</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">seq</span><span class="o">==</span><span class="mi">9</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Link.array_exist : invalid key&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ua</span></div>

<div class="viewcode-block" id="DLink.evalH"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.evalH">[docs]</a>    <span class="k">def</span> <span class="nf">evalH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluate channel transfer function</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function modifies the orientation of the antenna at both sides</span>
<span class="sd">        via Ta and Tb 3x3 matrices and recalculates the channel transfer function </span>
<span class="sd">        for those new orientations. </span>
<span class="sd">        The self.H variable is updated</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Antenna Rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">Ta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">,</span> <span class="n">Tb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
        <span class="c1"># Transmission channel calculation</span>
        <span class="n">H</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span></div>

<div class="viewcode-block" id="DLink.eval"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; link evaluation</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        applywav :boolean</span>
<span class="sd">         Apply waveform to H</span>
<span class="sd">        force : list</span>
<span class="sd">            Force the computation ([&#39;sig&#39;,&#39;ray2&#39;,&#39;ray,&#39;Ct&#39;,&#39;H&#39;]) AND save (replace previous computations)</span>
<span class="sd">        alg : 1|&#39;old&#39;|&#39;exp&#39;|&#39;exp2&#39;</span>
<span class="sd">            version of run for signature</span>
<span class="sd">        si_progress: bollean ( False)</span>
<span class="sd">            display progression bar for signatures</span>
<span class="sd">        diffraction : boolean (False)</span>
<span class="sd">            takes into consideration diffraction points</span>
<span class="sd">        ra_number_mirror_cf : int</span>
<span class="sd">            rays.to3D number of ceil/floor reflexions</span>
<span class="sd">        ra_ceil_H: float, (default [])</span>
<span class="sd">            ceil height . </span>
<span class="sd">                If [] : Layout max ceil height </span>
<span class="sd">                If 0 : only floor reflection (outdoor case) </span>
<span class="sd">                If -1 : neither ceil nor floor reflection (2D case) </span>
<span class="sd">        ra_vectorized: boolean (True)</span>
<span class="sd">            if True used the (2015 new) vectorized approach to determine 2drays</span>
<span class="sd">        progressbar: str</span>
<span class="sd">            None: no progress bar</span>
<span class="sd">            python : progress bar in ipython</span>


<span class="sd">    </span>
<span class="sd">        Notes    </span>
<span class="sd">        -----</span>

<span class="sd">        update self.ak and self.tk</span>

<span class="sd">        self.ak : ndarray</span>
<span class="sd">            alpha_k</span>
<span class="sd">        self.tk : ndarray</span>
<span class="sd">            tau_k</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.simul.link import *</span>
<span class="sd">            &gt;&gt;&gt; DL=DLink(L=&quot;defstr.lay&quot;)</span>
<span class="sd">            &gt;&gt;&gt; DL.eval()</span>
<span class="sd">            &gt;&gt;&gt; DL.show()</span>
<span class="sd">            &gt;&gt;&gt; DL.plt_cir()</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>


<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.signature</span>
<span class="sd">        pylayers.antprop.rays</span>


<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;applywav&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;si_progress&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;diffraction&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;ra_vectorized&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;ra_ceil_H&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;ra_number_mirror_cf&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;force&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;bt&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;alg&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;si_reverb&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                   <span class="s1">&#39;nD&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                   <span class="s1">&#39;nR&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                   <span class="s1">&#39;nT&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span>
                   <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;verbose&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;progressbar&#39;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                   <span class="p">}</span>
        <span class="c1"># check antenna frequency range compatibility</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">fGHz</span><span class="o">!=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Antenna frequency range are not compatible&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="s1">&#39;delay_excess_max_ns&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;delay_excess_max_ns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay_excess_max_ns</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delay_excess_max_ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;delay_excess_max_ns&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;cutoff&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;threshold&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;force&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span> <span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">,</span><span class="s1">&#39;ray2&#39;</span><span class="p">,</span><span class="s1">&#39;ray&#39;</span><span class="p">,</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="c1"># Ct and H are not yet saved/load </span>
                    <span class="c1"># compliantly with the given configutain</span>
                    <span class="c1"># their are disabled here</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span>

        
        <span class="c1"># must be placed after all the init !!!!</span>
        <span class="c1"># if self.verbose :</span>
        <span class="c1">#     print(&quot;checkh5&quot;)</span>
        <span class="c1"># self.checkh5()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progressbar&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progressbar&#39;</span><span class="p">]</span> <span class="o">==</span><span class="s1">&#39;notebook&#39;</span><span class="p">:</span>
                <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm_notebook</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progressbar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;python&#39;</span><span class="p">:</span>
                <span class="n">pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progressbar&#39;</span><span class="p">],</span><span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">):</span>
            <span class="n">pbar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;progressbar&#39;</span><span class="p">]</span>



        <span class="c1">############</span>
        <span class="c1"># Signatures</span>
        <span class="c1">############</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Start Signatures&quot;</span><span class="p">)</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">Si</span> <span class="o">=</span> <span class="n">Signatures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ca</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cb</span><span class="p">,</span>
                        <span class="n">cutoff</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">],</span>
                        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;sig&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">Si</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">L</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;load signature&quot;</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1">## 1 is the default signature determination algorithm</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                
                <span class="n">Si</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">],</span>
                        <span class="n">diffraction</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;diffraction&#39;</span><span class="p">],</span>
                        <span class="n">threshold</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;threshold&#39;</span><span class="p">],</span>
                        <span class="n">delay_excess_max_ns</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;delay_excess_max_ns&#39;</span><span class="p">],</span>
                        <span class="n">nD</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nD&#39;</span><span class="p">],</span>
                        <span class="n">nR</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nR&#39;</span><span class="p">],</span>
                        <span class="n">nT</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;nT&#39;</span><span class="p">],</span>
                        <span class="n">progress</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;si_progress&#39;</span><span class="p">],</span>
                        <span class="n">bt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bt&#39;</span><span class="p">])</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;default algorithm&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;exp&#39;</span><span class="p">:</span>
                <span class="n">TMP</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">run_exp</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">],</span>
                         <span class="n">cutoffbound</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;si_reverb&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;experimental (ex 2015)&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alg&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;exp2&#39;</span><span class="p">:</span>
                <span class="n">TMP</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">run_exp2</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">],</span>
                        <span class="n">cutoffbound</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;si_reverb&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;algo exp2 ( ex 20152)&quot;</span><span class="p">)</span>

        <span class="c1">#Si.run6(diffraction=kwargs[&#39;diffraction&#39;])</span>
        <span class="c1"># save sig</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">Si</span><span class="p">,</span><span class="s1">&#39;sig&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Si</span> <span class="o">=</span> <span class="n">Si</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stop signature&quot;</span><span class="p">,</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>



        <span class="c1">############</span>
        <span class="c1"># Rays</span>
        <span class="c1">############</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Start Rays&quot;</span><span class="p">)</span>
        <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">r2d</span> <span class="o">=</span> <span class="n">Rays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
       

        <span class="c1">#</span>
        <span class="c1"># get 2D rays </span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray2&#39;</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;ray2&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">r2d</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray2&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">L</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1"># perform computation ...</span>
            <span class="c1"># ... with vectorized ray evaluation </span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ra_vectorized&#39;</span><span class="p">]:</span>
                <span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">raysv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># ... or with original and slow approach ( to be removed in a near future)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># save 2D rays</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">r2d</span><span class="p">,</span><span class="s1">&#39;ray2&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray2&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r2d</span> <span class="o">=</span> <span class="n">r2d</span>

        <span class="c1">#</span>
        <span class="c1"># get 3D rays </span>
        <span class="c1">#</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Rays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">R</span><span class="o">.</span><span class="n">is3D</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;ray&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">L</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ra_ceil_H&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;indoor&#39;</span><span class="p">:</span>
                    <span class="n">ceilheight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">maxheight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ceilheight</span> <span class="o">=</span> <span class="mi">0</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ceilheight</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ra_ceil_H&#39;</span><span class="p">]</span>


            <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">H</span><span class="o">=</span><span class="n">ceilheight</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ra_number_mirror_cf&#39;</span><span class="p">])</span>
            
            <span class="c1"># </span>
            <span class="c1"># TODO </span>
            <span class="c1"># R.remove_air()</span>

            <span class="n">R</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
            

            <span class="n">R</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>

            <span class="c1"># C = Ctilde()</span>

            <span class="c1"># C = R.eval(self.fGHz)</span>

            <span class="c1"># save 3D rays </span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="s1">&#39;ray&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;ray&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
        <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Stop rays&quot;</span><span class="p">,</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">nray</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;No rays have been found. Try to re-run the simulation with a higher S.cutoff &#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>
        <span class="c1">############</span>
        <span class="c1"># Ctilde</span>
        <span class="c1">############</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;Ct&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">Ctilde</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1">#if not hasattr(R,&#39;I&#39;):</span>
            <span class="c1"># Ctilde...</span>
            <span class="c1"># Find an other criteria in order to decide if the R has</span>
            <span class="c1"># already been evaluated</span>
            
            <span class="n">C</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="c1"># ...save Ct</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="s1">&#39;Ct&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;Ct&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">C</span> <span class="o">=</span> <span class="n">C</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>
        <span class="c1">############</span>
        <span class="c1"># H</span>
        <span class="c1">############</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">Tchannel</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;exist&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;H&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1"># Ctilde antenna</span>
            <span class="n">C</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="n">Ta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ta</span><span class="p">,</span> <span class="n">Tb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Tb</span><span class="p">)</span>
            <span class="c1">#T channel</span>
            <span class="n">H</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="p">,</span><span class="n">Friis</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dexist</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">][</span><span class="s1">&#39;grpname&#39;</span><span class="p">],</span><span class="n">force</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;force&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>



        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;applywav&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">isFriis</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">get_cir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">get_cir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkh5</span><span class="p">()</span></div>


<div class="viewcode-block" id="DLink.adp"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.adp">[docs]</a>    <span class="k">def</span> <span class="nf">adp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imax</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; construct the angular delay profile</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        imax : int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adpmes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afpmes</span><span class="o">.</span><span class="n">toadp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adpmes</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imax</span><span class="o">=</span><span class="n">imax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adprt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">toadp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adprt</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">imax</span><span class="o">=</span><span class="n">imax</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="DLink.afp"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.afp">[docs]</a>    <span class="k">def</span> <span class="nf">afp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Evaluate angular frequency profile </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fGHz  : np.array </span>
<span class="sd">            frequency range </span>
<span class="sd">        az : azimuth angle (radian)  </span>
<span class="sd">        tilt : tilt angle (-pi/2&lt;tilt&lt;pi/2) </span>
<span class="sd">        polar : string</span>
<span class="sd">        win : string &#39;rect&#39; | &#39;hamming&#39;</span>
<span class="sd">        _filemeas : string </span>
<span class="sd">        _filecal : string </span>
<span class="sd">        ang_offset : </span>
<span class="sd">        BW : float </span>
<span class="sd">            bandwidth</span>
<span class="sd">        ext : string </span>
<span class="sd">            &#39;txt&#39; | &#39;mat&#39;</span>
<span class="sd">        dirmeas : string </span>
<span class="sd">            directory of the data in the project path </span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        If a measurement file is given the angular range is obtained from the measurement</span>
<span class="sd">        otherwise the variable az is used. </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fGHz&#39;</span><span class="p">:</span><span class="mf">32.6</span><span class="p">,</span>
                     <span class="s1">&#39;az&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;tilt&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;polar&#39;</span><span class="p">:</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;win&#39;</span><span class="p">:</span><span class="s1">&#39;rect&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;_filemeas&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;_filecal&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ang_offset&#39;</span> <span class="p">:</span> <span class="mf">0.37</span><span class="p">,</span>
                     <span class="s1">&#39;BW&#39;</span><span class="p">:</span> <span class="mf">1.6</span><span class="p">,</span>
                     <span class="s1">&#39;ext&#39;</span><span class="p">:</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;dirmeas&#39;</span><span class="p">:</span><span class="s1">&#39;meas&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;refinement&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> 

        <span class="n">fGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fGHz&#39;</span><span class="p">)</span>
        <span class="n">az</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;az&#39;</span><span class="p">)</span>
        <span class="n">tilt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tilt&#39;</span><span class="p">)</span>
        <span class="n">polar</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
        <span class="n">win</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">)</span>               <span class="c1"># argument for loadmes</span>
        <span class="n">_filemeas</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_filemeas&#39;</span><span class="p">)</span>   <span class="c1"># argument for loadmes</span>
        <span class="n">_filecal</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;_filecal&#39;</span><span class="p">)</span>     <span class="c1"># argument for loadmes</span>
        <span class="n">dirmeas</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dirmeas&#39;</span><span class="p">)</span>      <span class="c1"># argument for loadmes</span>
        <span class="n">ang_offset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ang_offset&#39;</span><span class="p">)</span> <span class="c1"># argument for loadmes</span>
        <span class="n">BW</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;BW&#39;</span><span class="p">)</span>                 <span class="c1"># argument for loadmes</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ext&#39;</span><span class="p">)</span>               <span class="c1"># argument for loadmes</span>
        <span class="n">refinement</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;refinement&#39;</span><span class="p">)</span>  <span class="c1"># argument for loadmes</span>

        <span class="c1"># read measurement if available</span>
        <span class="k">if</span> <span class="n">_filemeas</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">fcGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afpmes</span> <span class="o">=</span> <span class="n">AFPchannel</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afpmes</span><span class="o">.</span><span class="n">loadmes</span><span class="p">(</span><span class="n">_filemeas</span><span class="p">,</span>
                                <span class="n">_filecal</span><span class="p">,</span>
                                 <span class="n">fcGHz</span><span class="o">=</span><span class="n">fcGHz</span><span class="p">,</span>
                                 <span class="n">BW</span><span class="o">=</span><span class="n">BW</span><span class="p">,</span>
                                 <span class="n">win</span><span class="o">=</span><span class="n">win</span><span class="p">,</span>
                                 <span class="n">ang_offset</span><span class="o">=</span><span class="n">ang_offset</span><span class="p">,</span>
                                 <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">,</span>
                                 <span class="n">dirmeas</span><span class="o">=</span><span class="n">dirmeas</span><span class="p">,</span>
                                 <span class="n">refinement</span><span class="o">=</span><span class="n">refinement</span><span class="p">)</span>
            <span class="n">az</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afpmes</span><span class="o">.</span><span class="n">az</span>
            <span class="c1">#</span>
            <span class="c1"># afpmes.x</span>
            <span class="c1"># afpmes.y</span>
            <span class="c1"># afpmes.fcGHz</span>
            <span class="c1"># afpmes.az     measure angular range </span>
            <span class="c1"># afpmes.azrt   ray tracing angular range  </span>
        <span class="c1"># create an empty AFP </span>
        <span class="c1"># tx = a</span>
        <span class="c1"># rx = b </span>
        <span class="c1"># angular range (a) : phi </span>
        <span class="c1">#</span>
       
        <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span> <span class="o">=</span> <span class="n">AFPchannel</span><span class="p">(</span><span class="n">tx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="n">rx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="n">az</span><span class="o">=</span><span class="n">az</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">ph</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">az</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span> <span class="o">=</span> <span class="n">geu</span><span class="o">.</span><span class="n">MATP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">sl</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">el</span><span class="p">,</span><span class="n">ph</span><span class="p">,</span><span class="n">tilt</span><span class="p">,</span><span class="n">polar</span><span class="p">)</span>
            <span class="c1"># self._update_show3(ant=&#39;b&#39;)</span>
            <span class="c1"># pdb.set_trace()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">evalH</span><span class="p">()</span>
            <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">energy</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpadp</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpadp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dpadp</span><span class="p">,</span><span class="n">E</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="o">...</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,:]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="mi">1j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fGHz</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">[:,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S</span><span class="p">)))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">!=</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">fGHz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">afprt</span><span class="o">.</span><span class="n">fcGHz</span> <span class="o">=</span> <span class="n">fGHz</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">fGHz</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dpdp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpadp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpadp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>
        <span class="c1">#return(afp)</span>



<div class="viewcode-block" id="DLink.select"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnClick</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span></div>

<div class="viewcode-block" id="DLink.OnClick"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.OnClick">[docs]</a>    <span class="k">def</span> <span class="nf">OnClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mf">1.2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caf</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mf">1.2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbf</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show3</span><span class="p">()</span>
        <span class="k">print</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></div>

<div class="viewcode-block" id="DLink.show"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show the link</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        s   : int</span>
<span class="sd">            size of Tx/Rx circle in points </span>
<span class="sd">        ca  : string</span>
<span class="sd">            color of termination a (Tx)</span>
<span class="sd">        cb  : string</span>
<span class="sd">            color of termination b (Rx)</span>
<span class="sd">        alpha : float </span>
<span class="sd">            transparency </span>
<span class="sd">        axis : boolean </span>
<span class="sd">            display axis boolean (default True)</span>
<span class="sd">        figsize : tuple</span>
<span class="sd">            figure size if fig not specified default (20,10)</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            default 20</span>
<span class="sd">        rays : boolean</span>
<span class="sd">            activation of rays vizalization (True)  </span>
<span class="sd">        bsig : boolean </span>
<span class="sd">            activation of signature vizualization (False)</span>
<span class="sd">        laddr : list </span>
<span class="sd">            list of signature addresses </span>
<span class="sd">        cmap : colormap</span>
<span class="sd">        radius : float </span>
<span class="sd">            radius in meters for layout vizualization </span>
<span class="sd">        labels : boolean</span>
<span class="sd">            enabling edge label (useful for signature identification)</span>
<span class="sd">        pol : string</span>
<span class="sd">            &#39;tt&#39;,&#39;pp&#39;,&#39;tp&#39;,&#39;pt&#39;,&#39;co&#39;,&#39;cross&#39;,tot&#39;</span>
<span class="sd">        col : string</span>
<span class="sd">            &#39;cmap&#39;</span>
<span class="sd">        width : float</span>
<span class="sd">        alpha : float</span>
<span class="sd">        dB    : boolean</span>
<span class="sd">            default False</span>
<span class="sd">        dyn : float</span>
<span class="sd">            dynamic in dB</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.simul.link import *</span>
<span class="sd">        &gt;&gt;&gt; DL=Link()</span>
<span class="sd">        &gt;&gt;&gt; DL.show(lr=-1,rays=True,dB=True,col=&#39;cmap&#39;,cmap=plt.cm.jet)</span>
<span class="sd">        &gt;&gt;&gt; DL.show(laddr=[(6,2)],bsig=True)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">80</span><span class="p">,</span>   <span class="c1"># size points</span>
                   <span class="s1">&#39;ca&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="c1"># color a </span>
                   <span class="s1">&#39;cb&#39;</span><span class="p">:</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="c1"># color b </span>
                   <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;axis&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;lr&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;ls&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                   <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                   <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>
                   <span class="s1">&#39;rays&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                   <span class="s1">&#39;bsig&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;laddr&#39;</span><span class="p">:[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span>
                   <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span>
                   <span class="s1">&#39;pol&#39;</span><span class="p">:</span><span class="s1">&#39;tot&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;col&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;col&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;radius&#39;</span><span class="p">:</span><span class="mi">90</span><span class="p">,</span>
                   <span class="s1">&#39;dB&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;labels&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;aw&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                   <span class="s1">&#39;dyn&#39;</span><span class="p">:</span><span class="mi">70</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> 

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="c1">#</span>
        <span class="c1"># Layout</span>
        <span class="c1">#</span>
       
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span>
                              <span class="n">nodes</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                              <span class="n">fig</span> <span class="o">=</span> <span class="n">fig</span><span class="p">,</span>
                              <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
                              <span class="n">labels</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">],</span>
                              <span class="n">aw</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;aw&#39;</span><span class="p">],</span>
                              <span class="n">axis</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># Point A</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ca&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># Point B</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbf</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cb&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="c1">#</span>
        <span class="c1"># Plot Rays</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rays&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">nray</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="c1">#ECtt,ECpp,ECtp,ECpt = self.C.energy()</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;tt&#39;:</span>
            <span class="c1">#    val = ECtt</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;pp&#39;:</span>
            <span class="c1">#    val = ECpp</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;tp&#39;:</span>
            <span class="c1">#    val = ECtp</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;pt&#39;:</span>
            <span class="c1">#    val = ECpt</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;tot&#39;:</span>
            <span class="c1">#    val = ECtt+ECpp+ECpt+ECtp</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;co&#39;:</span>
            <span class="c1">#    val = ECtt+ECpp</span>
            <span class="c1">#if kwargs[&#39;pol&#39;]==&#39;cross&#39;:</span>
            <span class="c1">#&quot;    val = ECtp+ECpt</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">energy</span><span class="p">()[:,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> 

            <span class="n">clm</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span>
            <span class="c1">#</span>
            <span class="c1"># Select group of interactions</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">lr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">nray</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lr</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span>
            
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> 
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmin</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span>
            
            
            <span class="c1">#</span>
            <span class="c1"># limitation of the vizualization zone around the center of the link </span>
            <span class="c1">#</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">],</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">],</span><span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">ir</span>  <span class="ow">in</span> <span class="n">lr</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]:</span>
                    <span class="n">RayEnergy</span><span class="o">=</span><span class="nb">max</span><span class="p">((</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span><span class="o">/</span><span class="n">val</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dyn&#39;</span><span class="p">]),</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dyn&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">RayEnergy</span><span class="o">=</span><span class="n">val</span><span class="p">[</span><span class="n">ir</span><span class="p">]</span><span class="o">/</span><span class="n">val</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">clm</span><span class="p">(</span><span class="n">RayEnergy</span><span class="p">)</span>
                    <span class="c1">#width = 10*RayEnergy</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> 
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">col</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
                
                <span class="c1"># plot ray (i,r) </span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">rlist</span><span class="o">=</span><span class="p">[</span><span class="n">ir</span><span class="p">],</span>
                               <span class="n">colray</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                               <span class="n">widthray</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                               <span class="n">alpharay</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                               <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                               <span class="n">layout</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                               <span class="n">points</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span>
                <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">))</span>
                <span class="n">sm</span><span class="o">.</span><span class="n">_A</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="c1"># Plot signature</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bsig&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">addr</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;laddr&#39;</span><span class="p">]:</span> 
                <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Si</span><span class="p">[</span><span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">2</span><span class="o">*</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="mi">2</span><span class="o">*</span><span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">,:]</span>
                <span class="n">Si</span> <span class="o">=</span> <span class="n">Signature</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                <span class="n">isvalid</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">u</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">sig2ray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rays</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lay</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">ant</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">newfig</span><span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display the simulation scene using Mayavi</span>
<span class="sd">            using Mayavi</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        rays: boolean </span>
<span class="sd">        lay : boolean </span>
<span class="sd">        ant : boolean </span>
<span class="sd">        newfig : boolean (default : False)</span>
<span class="sd">        kwargs of Rays.show3()</span>


<span class="sd">        see also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.gis.layout</span>
<span class="sd">        pylayers.antprop.antenna</span>
<span class="sd">        pylayers.antprop.rays</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">            &gt;&gt;&gt; from pylayers.simul.link import *</span>
<span class="sd">            &gt;&gt;&gt; L=DLink(verbose=False)</span>
<span class="sd">            &gt;&gt;&gt; L.eval()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">newfig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">bgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">fgcolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;centered&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">centered</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;centered&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">centered</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">centered</span><span class="p">:</span>
            <span class="n">pg</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">pg</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pg</span>


        <span class="k">if</span> <span class="n">centered</span> <span class="p">:</span>
            <span class="n">ptx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="n">pg</span>
            <span class="n">prx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">-</span><span class="n">pg</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ptx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
            <span class="n">prx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">disable_render</span> <span class="o">=</span> <span class="bp">True</span>


        <span class="k">if</span> <span class="n">ant</span> <span class="p">:</span>
            <span class="n">Atx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span>
            <span class="n">Arx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span>
            <span class="n">Ttx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ta</span>
            <span class="n">Trx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tb</span>

            <span class="c1"># evaluate antenna if required</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Atx</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
                <span class="n">Atx</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Atx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Ttx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                           <span class="n">po</span><span class="o">=</span><span class="n">ptx</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">bcolorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">bnewfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">bcircle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                           <span class="n">name</span> <span class="o">=</span> <span class="n">Atx</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                           <span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                           <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">Atx</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
                <span class="n">Atx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Ttx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                            <span class="n">po</span><span class="o">=</span><span class="n">ptx</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcolorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bnewfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcircle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">Atx</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                            <span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Arx</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
                <span class="n">Arx</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Arx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Trx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                            <span class="n">po</span><span class="o">=</span><span class="n">prx</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcolorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bnewfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcircle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">Arx</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                            <span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">Arx</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
                <span class="n">Arx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Trx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                            <span class="n">po</span><span class="o">=</span><span class="n">prx</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcolorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bnewfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">bcircle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">Arx</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                            <span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                            <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lay</span><span class="p">:</span>
            <span class="c1"># check if indoor/outdoor, outdoor or indoor situations</span>
            <span class="c1"># a_in = self.L.Gt.node[self.ca][&#39;indoor&#39;]</span>
            <span class="c1"># b_in = self.L.Gt.node[self.cb][&#39;indoor&#39;]</span>

            <span class="c1"># if (a_in) &amp; (b_in):</span>
            <span class="c1">#     # indoor</span>
            <span class="c1">#     show_ceil=False</span>
            <span class="c1">#     opacity = 0.7</span>
            <span class="c1">#     ceil_opacity = 0.</span>
            <span class="c1"># elif ((not a_in) &amp; (not b_in)):</span>
            <span class="c1">#     # outdoor</span>
            <span class="c1">#     show_ceil=True</span>
            <span class="c1">#     opacity = 1.</span>
            <span class="c1">#     ceil_opacity = 1.</span>
            <span class="c1"># else:</span>
            <span class="c1">#     # indoor/outdoor</span>
            <span class="c1">#     show_ceil=True</span>
            <span class="c1">#     opacity = 0.7</span>
            <span class="c1">#     ceil_opacity = 0.7</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;outdoor&#39;</span><span class="p">:</span>
                <span class="n">show_ceil</span><span class="o">=</span><span class="bp">True</span>
                <span class="n">opacity</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">ceil_opacity</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;indoor&#39;</span><span class="p">:</span>
                <span class="n">show_ceil</span><span class="o">=</span><span class="bp">False</span>
                <span class="n">opacity</span> <span class="o">=</span> <span class="mf">0.7</span>
                <span class="n">ceil_opacity</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                          <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>
                          <span class="n">ceil_opacity</span><span class="o">=</span><span class="n">ceil_opacity</span><span class="p">,</span>
                          <span class="n">show_ceil</span><span class="o">=</span><span class="n">show_ceil</span><span class="p">,</span>
                          <span class="n">centered</span><span class="o">=</span><span class="n">centered</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># mlab.text3d(self.a[0],self.a[1],self.a[2],&#39;a&#39;,</span>
        <span class="c1">#             scale=1,</span>
        <span class="c1">#             color=(1,0,0))</span>
        <span class="c1"># mlab.text3d(self.b[0],self.b[1],self.b[2],&#39;b&#39;,</span>
        <span class="c1">#             scale=1,</span>
        <span class="c1">#             color=(1,0,0))</span>
        <span class="k">if</span> <span class="n">rays</span> <span class="p">:</span>
            <span class="c1"># check rays with energy</span>
            <span class="c1"># if hasattr(self,&#39;H&#39;) and not kwargs.has_key(&#39;rlist&#39;):</span>
            <span class="c1">#     urays = np.where(self.H.y!=0)[0]</span>
            <span class="c1">#     kwargs[&#39;rlist&#39;]=urays</span>
            <span class="c1">#     import ipdb</span>
            <span class="c1">#     ipdb.set_trace()</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ndim</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
                    <span class="n">ER</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">energy</span><span class="p">())</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ER&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ER</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="p">[],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>

        <span class="n">dab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">focalpoint</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span><span class="c1">#,distance=15*dab-55)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">disable_render</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">orientation_axes</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span>
        <span class="c1">#return(self._maya_fig)</span>


    <span class="k">def</span> <span class="nf">_update_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ant</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">delrays</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">view</span><span class="o">=</span><span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">()</span>


        <span class="n">antenna</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.A&#39;</span><span class="o">+</span><span class="n">ant</span><span class="p">)</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.T&#39;</span><span class="o">+</span><span class="n">ant</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;self.&#39;</span><span class="o">+</span><span class="n">ant</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">antenna</span><span class="o">.</span><span class="n">full_evaluated</span><span class="p">:</span>
            <span class="n">antenna</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>


        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">antenna</span><span class="p">,</span><span class="s1">&#39;_mayamesh&#39;</span><span class="p">):</span>
            <span class="c1"># antenna.eval()</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">scalar</span> <span class="o">=</span> <span class="n">antenna</span><span class="o">.</span><span class="n">_computemesh</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">antenna</span><span class="o">.</span><span class="n">_mayamesh</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">scalars</span><span class="o">=</span><span class="n">scalar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">antenna</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">rot</span><span class="p">,</span><span class="n">po</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">bcolorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">bcircle</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                <span class="n">bnewfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">antenna</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span>
                <span class="n">binteract</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delrays</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">time</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maya_fig</span><span class="o">.</span><span class="n">children</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;Rays&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">view</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">view</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">view</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
             <span class="c1"># [x.remove() for x in self._maya_fig.children ]</span>

        <span class="c1"># # update wall opaccity</span>
        
        
        <span class="c1"># ds  =[i for i in self._maya_fig.children if self.L._filename in i.name][0]</span>
        <span class="c1"># a_in = self.L.Gt.node[self.ca][&#39;indoor&#39;]</span>
        <span class="c1"># b_in = self.L.Gt.node[self.cb][&#39;indoor&#39;]</span>

        <span class="c1"># if </span>
        <span class="c1"># if a_in or b_in:</span>
        <span class="c1">#     # indoor situation</span>
        <span class="c1">#     ds.children[0].children[0].actor.property.opacity=0.5</span>
        <span class="c1"># else:</span>
        <span class="c1">#     ds.children[0].children[0].actor.property.opacity=1.</span>

<div class="viewcode-block" id="DLink.plt_cir"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.plt_cir">[docs]</a>    <span class="k">def</span> <span class="nf">plt_cir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot link channel impulse response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        BWGHz : Bandwidth </span>
<span class="sd">        Nf    : Number of frequency points</span>
<span class="sd">        fftshift : boolean </span>
<span class="sd">        rays : boolean</span>
<span class="sd">            display rays contributors</span>
<span class="sd">        fspl : boolean</span>
<span class="sd">            display free space path loss</span>
<span class="sd">        </span>
<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel.Tchannel.getcir</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                    <span class="s1">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                     <span class="s1">&#39;BWGHz&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                    <span class="s1">&#39;Nf&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span>
                    <span class="s1">&#39;rays&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;fspl&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;vmin&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span>
                    <span class="s1">&#39;vmax&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">40</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
        
        <span class="n">taumax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">BWGHz</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;BWGHz&#39;</span><span class="p">]</span>

        <span class="n">Nf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;Nf&#39;</span><span class="p">],</span><span class="n">taumax</span><span class="o">*</span><span class="n">BWGHz</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># getcir is a Tchannel method </span>

        <span class="n">ir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">getcir</span><span class="p">(</span><span class="n">BWGHz</span> <span class="o">=</span><span class="n">BWGHz</span><span class="p">,</span><span class="n">Nf</span><span class="o">=</span><span class="n">Nf</span><span class="p">)</span>
        <span class="n">ir</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])</span>


        <span class="n">delay</span> <span class="o">=</span> <span class="n">ir</span><span class="o">.</span><span class="n">x</span> 
        <span class="n">dist</span> <span class="o">=</span> <span class="n">delay</span><span class="o">*</span><span class="mf">0.3</span>
        <span class="n">FSPL0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">32.4</span><span class="o">-</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span> 
        <span class="n">FSPLG</span> <span class="o">=</span> <span class="n">FSPL0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Aa</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ab</span><span class="o">.</span><span class="n">GdBmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fspl&#39;</span><span class="p">]:</span>
            <span class="c1"># Free space path loss</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span><span class="n">FSPL0</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;FSPL&#39;</span><span class="p">)</span>
            <span class="c1"># Free space path loss + gain</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span><span class="n">FSPLG</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;FSPL+Gtmax+Grmax&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rays&#39;</span><span class="p">]</span> <span class="p">:</span> 
            <span class="c1"># energy of each ray</span>
            <span class="n">ER</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">energy</span><span class="p">())</span>
            <span class="n">color_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ER</span><span class="p">))</span><span class="c1">#np.linspace( 0, np.pi, len(ER))</span>
            <span class="c1"># sort rays by increasing energy</span>
            <span class="n">uER</span> <span class="o">=</span> <span class="n">ER</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">colors</span><span class="o">=</span> <span class="n">color_range</span><span class="p">[</span><span class="n">uER</span><span class="p">]</span>
            <span class="c1"># most important rays , it=0 ir=0 , if =0 </span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">[</span><span class="n">uER</span><span class="p">],</span><span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">uER</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])),</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;hot&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">)</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">)</span><span class="o">+</span><span class="mi">10</span><span class="p">])</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ir</span></div>


<div class="viewcode-block" id="DLink.plt_doa"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.plt_doa">[docs]</a>    <span class="k">def</span> <span class="nf">plt_doa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot direction of arrival and departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis</span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel.Tchannel.plotd</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;doa&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="DLink.plt_dod"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.plt_dod">[docs]</a>    <span class="k">def</span> <span class="nf">plt_dod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plot direction of arrival and departure</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        fig : plt.figure</span>
<span class="sd">        ax : plt.axis</span>
<span class="sd">        phi: tuple (-180, 180)</span>
<span class="sd">            phi angle</span>
<span class="sd">        normalize: bool</span>
<span class="sd">            energy normalized</span>
<span class="sd">        reverse : bool</span>
<span class="sd">            inverse theta and phi represenation</span>
<span class="sd">        polar : bool</span>
<span class="sd">            polar representation</span>
<span class="sd">        cmap: matplotlib.cmap</span>
<span class="sd">        mode: &#39;center&#39; | &#39;mean&#39; | &#39;in&#39;</span>
<span class="sd">            see bsignal.energy</span>
<span class="sd">        s : float</span>
<span class="sd">            scatter dot size</span>
<span class="sd">        fontsize: float</span>
<span class="sd">        edgecolors: bool</span>
<span class="sd">        colorbar: bool</span>
<span class="sd">        title : bool</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.channel.Tchannel.plotd</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;dod&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">plotd</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="DLink.plt_dspread"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.plt_dspread">[docs]</a>    <span class="k">def</span> <span class="nf">plt_dspread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot delay spread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[]</span>
                    <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">taud</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="DLink.plt_aspread"><a class="viewcode-back" href="../../../api/pylayers.simul.link.DLink.html#pylayers.simul.link.DLink.plt_aspread">[docs]</a>    <span class="k">def</span> <span class="nf">plt_aspread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot angular spread</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[]</span>
                    <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">doa</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_autocufoff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; automatically determine minimum cutoff</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.antprop.loss.losst</span>
<span class="sd">        pylayers.gis.layout.angleonlink3</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Gs</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="c1"># determine incidence angles on segment crossing p1-p2 segment</span>
        <span class="c1">#data = L.angleonlink(p1,p2)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">angleonlink3</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># as many slabs as segments and subsegments</span>
            <span class="n">us</span>  <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">]</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">us</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="n">us</span><span class="p">)</span>
                <span class="n">uus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sl</span> <span class="o">!=</span> <span class="s1">&#39;AIR&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sl</span> <span class="o">!=</span> <span class="s1">&#39;_AIR&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">uus</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutoff</span></div>

<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="c1">#plt.ion()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, PyLayers developer team.
      Last updated on Nov 14, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>