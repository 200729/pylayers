
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.simul.simulem &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/gallery.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img src="../../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../../download.html">Download</a></li>
            <li><a href="../../../notebook/TOC.html">User Guide</a></li>
            <li><a href="../../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	  <div class="rel">
	   
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="../../../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module...
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
	<div class="spacer">
	&nbsp;
	</div>
	<div class="rellink">
	<a href="../../index.html" title="Module code" >
	Up
	<br>
	<span class="smallrellink">
	Module code
	</span>
	<span class="hiddenrellink">
	Module code
	</span>
	
	</a>
	</div>
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	
    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylayers.simul.simulem</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    This module run the electromagnetic simulation with an old</span>
<span class="sd">    version of the Ray Tracing tool</span>

<span class="sd">    Deprecated</span>

<span class="sd">Utility Functions</span>
<span class="sd">=================</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">     rename</span>
<span class="sd">     spafile</span>

<span class="sd">Pafreq class</span>
<span class="sd">=============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">     Pafreq.__init__</span>
<span class="sd">     Pafreq.info</span>
<span class="sd">     Pafreq.load</span>
<span class="sd">     Pafreq.save</span>
<span class="sd">     Pafreq.gui</span>




<span class="sd">Simul class</span>
<span class="sd">============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    Simul.__init__</span>
<span class="sd">    Simul.gui</span>
<span class="sd">    Simul.updcfg</span>
<span class="sd">    Simul.clean</span>
<span class="sd">    Simul.clean_project</span>
<span class="sd">    Simul.save</span>
<span class="sd">    Simul.save_project</span>
<span class="sd">    Simul.load_project</span>
<span class="sd">    Simul.choose</span>
<span class="sd">    Simul.load</span>
<span class="sd">    Simul.layout</span>
<span class="sd">    Simul.show</span>
<span class="sd">    Simul.PL</span>
<span class="sd">    Simul.evalcir</span>
<span class="sd">    Simul.loadcir</span>
<span class="sd">    Simul.pltcir</span>
<span class="sd">    Simul.scatter</span>
<span class="sd">    Simul.info</span>
<span class="sd">    Simul.info2</span>
<span class="sd">    Simul.filtray</span>
<span class="sd">    Simul.showray</span>
<span class="sd">    Simul.show3l</span>
<span class="sd">    Simul._show3</span>
<span class="sd">    Simul.show3</span>
<span class="sd">    Simul.freq</span>
<span class="sd">    Simul.getlaunch</span>
<span class="sd">    Simul.gettra</span>
<span class="sd">    Simul.gettud</span>
<span class="sd">    Simul.run</span>
<span class="sd">    Simul.gt</span>
<span class="sd">    Simul.delay</span>
<span class="sd">    Simul.gr</span>
<span class="sd">    Simul.VC</span>
<span class="sd">    Simul.cir</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">getopt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">Tkinter</span><span class="o">,</span> <span class="nn">tkFileDialog</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="kn">as</span> <span class="nn">spio</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">struct</span> <span class="kn">as</span> <span class="nn">stru</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.geomutil</span> <span class="kn">as</span> <span class="nn">geu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.plotutil</span> <span class="kn">as</span> <span class="nn">plu</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.waveform</span> <span class="kn">as</span> <span class="nn">wvf</span>
<span class="kn">import</span> <span class="nn">pylayers.signal.bsignal</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="kn">from</span> <span class="nn">pylayers.simul.radionode</span> <span class="kn">import</span> <span class="n">RadioNode</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">easygui</span>
<span class="kn">from</span> <span class="nn">pylayers.simul.link</span> <span class="kn">import</span> <span class="n">DLink</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.slab</span> <span class="kn">import</span> <span class="n">Slab</span><span class="p">,</span> <span class="n">SlabDB</span><span class="p">,</span> <span class="n">Mat</span><span class="p">,</span> <span class="n">MatDB</span>
<span class="c1"># Handle Layout</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="c1"># Handle Rays</span>
<span class="c1">#from   Channel import *</span>
<span class="c1"># Handle directory hierarchy</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># Handle UWB measurements</span>
<span class="kn">from</span> <span class="nn">pylayers.measures</span> <span class="kn">import</span> <span class="n">mesuwb</span> <span class="k">as</span> <span class="n">muwb</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">tvtk.api</span> <span class="kn">import</span> <span class="n">tvtk</span>
    <span class="kn">from</span> <span class="nn">mayavi.sources.vtk_data_source</span> <span class="kn">import</span> <span class="n">VTKDataSource</span>
    <span class="kn">from</span> <span class="nn">mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s1">&#39;Layout:Mayavi is not installed&#39;</span>
<span class="kn">import</span> <span class="nn">pdb</span>


<div class="viewcode-block" id="rename"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.rename.html#pylayers.simul.simulem.rename">[docs]</a><span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">itx</span><span class="p">,</span><span class="n">irx</span><span class="p">,</span><span class="n">rep</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; rename simulation file with proper itx/irx </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    _filmename : short file name</span>
<span class="sd">    itx : transmitter index</span>
<span class="sd">    irx : transmitter index</span>
<span class="sd">    rep : directory</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    tratotud</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">f1</span>  <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;tx_[0-9]*&#39;</span><span class="p">,</span><span class="s1">&#39;tx_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">itx</span><span class="p">),</span><span class="n">_filename</span><span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;rx_[0-9]*&#39;</span><span class="p">,</span><span class="s1">&#39;rx_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">),</span><span class="n">f1</span><span class="p">)</span>
    <span class="n">filenew</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">new</span><span class="p">,</span><span class="n">rep</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">filenew</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">new</span><span class="p">)</span></div>

<div class="viewcode-block" id="spafile"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.spafile.html#pylayers.simul.simulem.spafile">[docs]</a><span class="k">def</span> <span class="nf">spafile</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">sdir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        create a .spa file for  Ray Tracing</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            _filename</span>
<span class="sd">                shortname of the file .spa</span>
<span class="sd">            point</span>
<span class="sd">                3d coordinates string</span>
<span class="sd">            sdir</span>
<span class="sd">                save directory relative to $BASENAME</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filespaTx</span> <span class="o">=</span> <span class="n">_filename</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">sdir</span><span class="p">)</span>
    <span class="n">fspa</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">fspa</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fspa</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">chaine</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">point</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">fspa</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fspa</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="k">class</span> <span class="nc">Simul</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Simulation Class</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    gui()</span>
<span class="sd">        graphical user interface</span>
<span class="sd">    choose()</span>
<span class="sd">        choose a simulation file in simuldir</span>
<span class="sd">    info()</span>
<span class="sd">        info about the simulation</span>
<span class="sd">    showray(itx,irx,iray)</span>
<span class="sd">        show a single ray</span>
<span class="sd">    help()</span>
<span class="sd">        help on using Simulation object</span>
<span class="sd">    freq()</span>
<span class="sd">        return the frequency base</span>
<span class="sd">    save()</span>
<span class="sd">        save Simulation file</span>
<span class="sd">    layout</span>
<span class="sd">        load a Layout file</span>
<span class="sd">    load()</span>
<span class="sd">        load Simulation</span>
<span class="sd">    show3()</span>
<span class="sd">        geomview vizualization</span>
<span class="sd">    show3l(itx,irx)</span>
<span class="sd">        geomview vizualization of link itx irx</span>
<span class="sd">    show()</span>
<span class="sd">        2D visualization of simulation with furniture</span>
<span class="sd">    run(itx,irx)</span>
<span class="sd">        run simulation for links (itx,irx)</span>
<span class="sd">    cir(itx,irx,store_level=0,alpha=1.0)</span>
<span class="sd">        Channel Impulse Response calculation</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    fileconf</span>

<span class="sd">    filetauk</span>
<span class="sd">    filetang</span>
<span class="sd">    filerang</span>

<span class="sd">    tx</span>
<span class="sd">    rx</span>

<span class="sd">    progress</span>

<span class="sd">    indoor</span>
<span class="sd">    mat</span>
<span class="sd">    sl</span>

<span class="sd">    Notes</span>
<span class="sd">    ------</span>

<span class="sd">    This class group together all the parametrization files of a simulation</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Simul.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.__init__.html#pylayers.simul.simulem.Simul.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filesimul</span><span class="o">=</span><span class="s1">&#39;default.ini&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span> <span class="o">=</span> <span class="n">_filesimul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtang</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drang</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtauk</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfield</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#</span>
        <span class="c1"># Here was a nasty bug : Rule for the future</span>
        <span class="c1">#    &quot;Always precise the key value of the passed argument&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># Mal nommer les choses, c&#39;est ajouter au malheur du monde ( Albert Camus )</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;tx&#39;</span><span class="p">,</span>
                            <span class="n">_fileini</span> <span class="o">=</span> <span class="s1">&#39;radiotx.ini&#39;</span><span class="p">,</span>
                            <span class="n">_fileant</span> <span class="o">=</span> <span class="s1">&#39;defant.vsh3&#39;</span><span class="p">,</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span>
                            <span class="n">_fileini</span> <span class="o">=</span> <span class="s1">&#39;radiorx.ini&#39;</span><span class="p">,</span>
                            <span class="n">_fileant</span> <span class="o">=</span> <span class="s1">&#39;defant.vsh3&#39;</span><span class="p">,</span>
                            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filefreq</span> <span class="o">=</span> <span class="s2">&quot;def.freq&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># simulation not loaded</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filetang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filerang</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filetauk</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filefield</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fileconf</span> <span class="o">=</span> <span class="s2">&quot;project.conf&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfield</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">_filesimul</span><span class="p">)</span></div>


<div class="viewcode-block" id="Simul.gui"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.gui.html#pylayers.simul.simulem.Simul.gui">[docs]</a>    <span class="k">def</span> <span class="nf">gui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gui to modify the simulation file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">simulgui</span> <span class="o">=</span> <span class="n">multenterbox</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulation file&#39;</span><span class="p">,</span>
                                <span class="p">(</span><span class="s1">&#39;filesimul&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;filestr&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;filefreq&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;filespaTx&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;filespaRx&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;fileantTx&#39;</span>
                                 <span class="s1">&#39;fileantRx&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">filefreq</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">filespaTx</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">filespaRx</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">fileantTx</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">fileantRx</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">simulgui</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filefreq</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filespaTx</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filespaRx</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileantTx</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fileantRx</span> <span class="o">=</span> <span class="n">simulgui</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span></div>

<div class="viewcode-block" id="Simul.updcfg"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.updcfg.html#pylayers.simul.simulem.Simul.updcfg">[docs]</a>    <span class="k">def</span> <span class="nf">updcfg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update simulation .ini config file </span>
<span class="sd">        </span>
<span class="sd">        with values currently in use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;struc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;conf&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileconf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;txant&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">fileant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;rxant&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">fileant</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;tx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">fileini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">fileini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;mat&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;slab&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;tud&quot;</span><span class="p">,</span> <span class="s2">&quot;purc&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patud</span><span class="o">.</span><span class="n">purc</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;tud&quot;</span><span class="p">,</span> <span class="s2">&quot;nrmax&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patud</span><span class="o">.</span><span class="n">nrmax</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;tud&quot;</span><span class="p">,</span> <span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patud</span><span class="o">.</span><span class="n">num</span><span class="p">))</span>

        <span class="c1">#</span>
        <span class="c1"># frequency section</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmin&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmax&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;nf&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)))</span>
        <span class="c1">#</span>
        <span class="c1"># waveform section</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;tw&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;twns&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;bandGHz&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;fc&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;fcGHz&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;thresh&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;threshdB&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;waveform&quot;</span><span class="p">,</span> <span class="s2">&quot;fe&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="p">[</span><span class="s1">&#39;feGHz&#39;</span><span class="p">]))</span>
        <span class="c1">#</span>
        <span class="c1"># output section</span>
        <span class="c1">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">dout</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># Initialize waveform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">()</span>
        <span class="c1"># Update waveform </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>


<div class="viewcode-block" id="Simul.clean_project"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.clean_project.html#pylayers.simul.simulem.Simul.clean_project">[docs]</a>    <span class="k">def</span> <span class="nf">clean_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean Pyrpoject directory</span>

<span class="sd">        remove .lch, .tra, .field .tud, .tauk, .tang, .rang, &lt;pyproject&gt;/output</span>

<span class="sd">        remove [output] entries into .ini of self.filesimul</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd"> </span>
<span class="sd">        verbose : boolean</span>
<span class="sd">            Verbose mode on/off</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Boolean:</span>
<span class="sd">                True if the project has been cleaned, False otherwise</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>

            <span class="k">print</span> <span class="s2">&quot;-----------------------------------&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;-----------------------------------&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;          WARNING                  &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;-----------------------------------&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;-----------------------------------&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;You are about to remove ALL previous computed raytracing files.&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;If you decide to remove it, you will need to restart the entire </span><span class="se">\</span>
<span class="s2">    raytracing simulation to exploit simulation results&quot;</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Do you want to remove these simulation files ? y/n&quot;</span>
            <span class="n">r</span><span class="o">=</span><span class="nb">raw_input</span><span class="p">()</span>

        <span class="k">else</span> <span class="p">:</span>
            <span class="n">r</span> <span class="o">==</span><span class="s1">&#39;y&#39;</span>

        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="n">inifile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;BASENAME&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Error : there is no project  directory in $BASENAME&#39;</span><span class="p">)</span>



            <span class="n">dirlist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
            <span class="n">extension</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;.lch&#39;</span><span class="p">,</span><span class="s1">&#39;.field&#39;</span><span class="p">,</span><span class="s1">&#39;.tra&#39;</span><span class="p">,</span><span class="s1">&#39;.tud&#39;</span><span class="p">,</span><span class="s1">&#39;.tang&#39;</span><span class="p">,</span><span class="s1">&#39;.rang&#39;</span><span class="p">,</span><span class="s1">&#39;.tauk&#39;</span><span class="p">]</span>
            <span class="n">rindic</span><span class="o">=</span><span class="bp">False</span>


            <span class="c1"># remove file</span>

            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirlist</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">extension</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span><span class="n">d</span> <span class="p">)</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">f</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                            <span class="n">rindic</span><span class="o">=</span><span class="bp">True</span>
                            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                                <span class="k">print</span> <span class="n">f</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">f</span><span class="p">)</span>



                    <span class="k">if</span> <span class="n">rindic</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                            <span class="k">print</span> <span class="s1">&#39;removed *&#39;</span> <span class="o">+</span> <span class="n">ex</span> <span class="o">+</span><span class="s1">&#39; from &#39;</span> <span class="o">+</span><span class="n">d</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                        <span class="n">rindic</span><span class="o">=</span><span class="bp">False</span>


            <span class="c1"># remove output into the self.filesimul ini file</span>

            <span class="n">simcfg</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
            <span class="n">simcfg</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">inifile</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRSIMUL&#39;</span><span class="p">]))</span>
            <span class="n">simcfg</span><span class="o">.</span><span class="n">remove_section</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">inifile</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRSIMUL&#39;</span><span class="p">]),</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span>
            <span class="n">simcfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dout</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dlch</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtra</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtud</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtang</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">drang</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtauk</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfield</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;removed [output] entries into &#39;</span> <span class="o">+</span><span class="n">inifile</span> <span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">print</span> <span class="s1">&#39;Project CLEANED&#39;</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;clean project process ABORTED&quot;</span>
            <span class="k">return</span> <span class="bp">False</span></div>


<div class="viewcode-block" id="Simul.save"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.save.html#pylayers.simul.simulem.Simul.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save simulation file</span>

<span class="sd">        Simulation files are .ini files which are saved in a dedicated</span>
<span class="sd">        directory basename/ini in the Project tree</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filesimul</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span><span class="p">,</span> <span class="s2">&quot;ini&quot;</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filesimul</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="c1"># getting current spa file if any</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;tx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">fileini</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">fileini</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c1"># save tx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># save rx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># save slab and mat file</span>
        <span class="c1"># --</span>
        <span class="c1"># self.slab.save(self.fileslabini)</span>
        <span class="c1"># self.slab.mat.save(self.filematini)</span>
        <span class="c1"># --</span>
        <span class="c1"># fix bug #189</span>
        <span class="c1">#   slab is a member of S.L not of S anymore</span>
        <span class="c1">#   mat is a member of S.L.sl not of S.slab</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileslabini</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">sl</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filematini</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span></div>

<span class="c1">#    def saveold(self):</span>
<span class="c1">#        &quot;&quot;&quot; save simulation file</span>

<span class="c1">#        &quot;&quot;&quot;</span>
<span class="c1">#        filesimul = pyu.getlong(self.filesimul, &quot;ini&quot;)</span>
<span class="c1">#        fd = open(filesimul, &quot;w&quot;)</span>
<span class="c1">#        config = ConfigParser.ConfigParser()</span>

<span class="c1">#        #</span>
<span class="c1">#        # files section</span>
<span class="c1">#        #</span>
<span class="c1">#        #config.add_section(&quot;files&quot;)</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;conf&quot;, self.fileconf)</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;struc&quot;, self.filestr)</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;slab&quot;, self.fileslab)</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;mat&quot;, self.filemat)</span>

<span class="c1">#        try:</span>
<span class="c1">#            self.config.set(&quot;files&quot;, &quot;tx&quot;, self.tx.filespa)</span>
<span class="c1">#        except:</span>
<span class="c1">#            pass</span>
<span class="c1">#        try:</span>
<span class="c1">#            self.config.set(&quot;files&quot;, &quot;rx&quot;, self.rx.filespa)</span>
<span class="c1">#        except:</span>
<span class="c1">#            pass</span>
<span class="c1">#        try:</span>
<span class="c1">#            self.config.set(&quot;files&quot;, &quot;txant&quot;, self.tx.fileant)</span>
<span class="c1">#        except:</span>
<span class="c1">#            pass</span>
<span class="c1">#        try:</span>
<span class="c1">#            self.config.set(&quot;files&quot;, &quot;rxant&quot;, self.rx.fileant)</span>
<span class="c1">#        except:</span>
<span class="c1">#            pass</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;patra&quot;, self.filepatra)</span>
<span class="c1">#        self.config.set(&quot;files&quot;, &quot;palch&quot;, self.filepalch)</span>
<span class="c1">#        self.palch.save()</span>
<span class="c1">#        self.patra.save()</span>

<span class="c1">#        #</span>
<span class="c1">#        # tud section</span>
<span class="c1">#        #</span>

<span class="c1">#        self.config.set(&quot;tud&quot;, &quot;purc&quot;, self.patud.purc)</span>
<span class="c1">#        self.config.set(&quot;tud&quot;, &quot;nrmax&quot;, self.patud.nrmax)</span>
<span class="c1">#        self.config.set(&quot;tud&quot;, &quot;num&quot;, self.patud.num)</span>

<span class="c1">#        #</span>
<span class="c1">#        # frequency section</span>
<span class="c1">#        #</span>
<span class="c1">#        self.config.set(&quot;frequency&quot;, &quot;fghzmin&quot;, self.freq[0])</span>
<span class="c1">#        self.config.set(&quot;frequency&quot;, &quot;fghzmax&quot;, self.freq[-1])</span>
<span class="c1">#        self.config.set(&quot;frequency&quot;, &quot;Nf&quot;, len(self.freq))</span>

<span class="c1">#        #</span>
<span class="c1">#        # output section</span>
<span class="c1">#        #</span>
<span class="c1">#        #filelch exists</span>
<span class="c1">#        if self.progress &gt; 0:</span>
<span class="c1">#            #config.add_section(&quot;output&quot;)</span>
<span class="c1">#            for k in range(len(self.filelch)):</span>
<span class="c1">#                _fileout = &quot;out&quot; + &quot;???&quot;</span>
<span class="c1">#                filename = self.filelch[k]</span>
<span class="c1">#                self.config.set(&quot;launch&quot;, str(k + 1), filename)</span>

<span class="c1">#        # filetra exists</span>
<span class="c1">#        for k in range(len(self.filelch)):</span>
<span class="c1">#            if self.progress &gt; 1:</span>
<span class="c1">#                #self.config.add_section(&quot;trace&quot;)</span>
<span class="c1">#                for l in arange(len(self.filetra[k])):</span>
<span class="c1">#                    filename = self.filetra[k][l]</span>
<span class="c1">#                    self.config.set(&quot;trace&quot;, &quot;rx&quot; + str(l + 1), filename)</span>

<span class="c1">#        # .tang exists</span>
<span class="c1">#        # .rang exists</span>
<span class="c1">#        # .tud exists</span>
<span class="c1">#            if self.progress &gt; 2:</span>
<span class="c1">#                #config.add_section(&quot;tud&quot;)</span>
<span class="c1">#                #config.add_section(&quot;tang&quot;)</span>
<span class="c1">#                #config.add_section(&quot;rang&quot;)</span>

<span class="c1">#                for l in arange(len(self.filetud[k])):</span>
<span class="c1">#                    ftud = self.filetud[k][l]</span>
<span class="c1">#                    self.config.set(&quot;tud&quot;, &quot;rx&quot; + str(l + 1), ftud)</span>

<span class="c1">#                for l in arange(len(self.filetang[k])):</span>
<span class="c1">#                    ftang = self.filetang[k][l]</span>
<span class="c1">#                    self.config.set(&quot;tang&quot;, &quot;rx&quot; + str(l + 1), ftang)</span>

<span class="c1">#                for l in arange(len(self.filerang[k])):</span>
<span class="c1">#                    frang = self.filerang[k][l]</span>
<span class="c1">#                    self.config.set(&quot;rang&quot;, &quot;rx&quot; + str(l + 1), frang)</span>

<span class="c1">#        # .field exist</span>
<span class="c1">#        # .tauk exist</span>
<span class="c1">#            if self.progress &gt; 3:</span>
<span class="c1">#                #config.add_section(&quot;tauk&quot;)</span>
<span class="c1">#                #config.add_section(&quot;field&quot;)</span>
<span class="c1">#                for l in arange(len(self.filetud[k])):</span>
<span class="c1">#                    ftauk = self.filetud[k][l]</span>
<span class="c1">#                    self.config.set(&quot;tauk&quot;, &quot;rx&quot; + str(l + 1), ftauk)</span>

<span class="c1">#                for l in arange(len(self.filefield[k])):</span>
<span class="c1">#                    ffield = self.filefield[k][l]</span>
<span class="c1">#                    self.config.set(&quot;field&quot;, &quot;rx&quot; + str(l + 1), ffield)</span>

<span class="c1">#        self.config.write(fd)</span>
<span class="c1">#        fd.close()</span>

<div class="viewcode-block" id="Simul.save_project"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.save_project.html#pylayers.simul.simulem.Simul.save_project">[docs]</a>    <span class="k">def</span> <span class="nf">save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save Simulation files in a zipfile</span>

<span class="sd">        Simulation files are .ini files which are saved in a dedicated</span>
<span class="sd">        directory basename/ini in the Project tree</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">zipfileName</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
                            <span class="n">filetypes</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;zipped file&quot;</span><span class="p">,</span><span class="s2">&quot;zip&quot;</span><span class="p">)]</span> <span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Save Project&quot;</span><span class="p">,</span>
                            <span class="p">)</span>
        <span class="n">pyu</span><span class="o">.</span><span class="n">zipd</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span><span class="n">zipfileName</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
        <span class="k">print</span> <span class="s2">&quot;Current project saved in&quot;</span><span class="p">,</span> <span class="n">zipfileName</span></div>

<div class="viewcode-block" id="Simul.load_project"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.load_project.html#pylayers.simul.simulem.Simul.load_project">[docs]</a>    <span class="k">def</span> <span class="nf">load_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load Simulation files from a zipfile</span>

<span class="sd">        Simulation files are .ini files which are saved in a dedicated</span>
<span class="sd">        directory basename/ini in the Project tree</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">Tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="n">zipfileName</span><span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfile</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
                                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span><span class="p">,</span>
                                            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Choose a project&#39;</span><span class="p">)</span>
        <span class="n">dirname</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askdirectory</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
                                    <span class="n">initialdir</span><span class="o">=</span><span class="n">basename</span><span class="p">,</span>
                                    <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Please select a directory&#39;</span><span class="p">,</span>
                                    <span class="n">mustexist</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">pyu</span><span class="o">.</span><span class="n">unzipd</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="n">zipfileName</span><span class="p">)</span>
        <span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
        <span class="k">print</span> <span class="s2">&quot;Current project loaded in&quot;</span><span class="p">,</span> <span class="n">dirname</span></div>

<div class="viewcode-block" id="Simul.choose"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.choose.html#pylayers.simul.simulem.Simul.choose">[docs]</a>    <span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Choose a simulation file in simuldir</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">tkFileDialog</span> <span class="kn">as</span> <span class="nn">FD</span>
        <span class="n">fichsimul</span> <span class="o">=</span> <span class="n">FD</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;Fichiers simul &quot;</span><span class="p">,</span>
                                                   <span class="s2">&quot;*.simul&quot;</span><span class="p">),</span>
                                                  <span class="p">(</span><span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)],</span>
                                       <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Please choose a simulation file&quot;</span><span class="p">,</span>
                                       <span class="n">initialdir</span><span class="o">=</span><span class="n">simuldir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="n">fichsimul</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span></div>

<div class="viewcode-block" id="Simul.load"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.load.html#pylayers.simul.simulem.Simul.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filesimul</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a simulation configuration file</span>

<span class="sd">         each transmiter simulation results in the creation of an .ini file</span>
<span class="sd">         with the following sections</span>
<span class="sd">         related to the results obtained for different receivers</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filesimul   : file in the simul directory of the Project</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span> <span class="o">=</span> <span class="n">_filesimul</span>
        <span class="n">filesimul</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span><span class="p">,</span> <span class="s2">&quot;ini&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filesimul</span><span class="p">)</span>

        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_filetx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;tx&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section tx from &#39;</span><span class="o">+</span> <span class="n">_filesimul</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_filerx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;rx&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section rx from &#39;</span><span class="o">+</span> <span class="n">_filesimul</span><span class="p">)</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="n">_fileini</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;struc&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section struc from &#39;</span><span class="o">+</span> <span class="n">_fileini</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_fileanttx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;txant&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section txant from &#39;</span><span class="o">+</span> <span class="n">_filesimul</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
           <span class="n">_fileantrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;rxant&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section rxant from &#39;</span><span class="o">+</span> <span class="n">_filesimul</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;tx&#39;</span><span class="p">,</span>
                                <span class="n">_fileini</span> <span class="o">=</span> <span class="n">_filetx</span><span class="p">,</span>
                                <span class="n">_fileant</span> <span class="o">=</span> <span class="n">_fileanttx</span>
                                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span> <span class="o">=</span> <span class="n">RadioNode</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                <span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;rx&#39;</span><span class="p">,</span>
                                <span class="n">_fileini</span> <span class="o">=</span> <span class="n">_filerx</span><span class="p">,</span>
                                <span class="n">_fileant</span> <span class="o">=</span> <span class="n">_fileantrx</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error during Radionode load&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># Load Layout</span>
<span class="c1"># </span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">_fileini</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Layout load error&#39;</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Frequency base</span>
<span class="c1">#</span>
        <span class="k">if</span> <span class="s2">&quot;frequency&quot;</span> <span class="ow">in</span> <span class="n">sections</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmin&quot;</span><span class="p">)),</span>
                                        <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getfloat</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmax&quot;</span><span class="p">)),</span>
                                        <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;nf&quot;</span><span class="p">)),</span>
                                        <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Error in section frequency from &#39;</span><span class="o">+</span> <span class="n">_filesimul</span><span class="p">)</span>
            <span class="c1"># update .freq file in tud directory</span>

            <span class="n">filefreq</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filefreq</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRTUD&#39;</span><span class="p">])</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filefreq</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">chaine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmin&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;fghzmax&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;nf&quot;</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">close</span>
<span class="c1">#</span>
<span class="c1"># Simulation Progress</span>
<span class="c1">#</span>
<span class="c1">#        self.output = {}</span>
<span class="c1">#        if &quot;output&quot; in sections:</span>
<span class="c1">#            for itx in self.config.options(&quot;output&quot;):</span>
<span class="c1">#                _filename  =  self.config.get(&quot;output&quot;, itx)</span>
<span class="c1">#                self.dout[int(itx)] = _filename</span>
<span class="c1">#                filename = pyu.getlong(_filename, &quot;output&quot;)</span>
<span class="c1">#                output = ConfigParser.ConfigParser()</span>
<span class="c1">#                output.read(filename)</span>
<span class="c1">#                secout = output.sections()</span>
<span class="c1">#                self.dtra[int(itx)] = {}</span>
<span class="c1">#                self.dtud[int(itx)] = {}</span>
<span class="c1">#                self.dtang[int(itx)] = {}</span>
<span class="c1">#                self.drang[int(itx)] = {}</span>
<span class="c1">#                self.dtauk[int(itx)] = {}</span>
<span class="c1">#                self.dfield[int(itx)] = {}</span>
<span class="c1">#                self.dcir[int(itx)] = {}</span>
<span class="c1">#                if &quot;launch&quot; in secout:</span>
<span class="c1">#                    self.progress = 1</span>
<span class="c1">#                    keys_launch = output.options(&quot;launch&quot;)</span>
<span class="c1">#                    for kl in keys_launch:</span>
<span class="c1">#                        self.dlch[int(kl)] = output.get(&quot;launch&quot;, kl)</span>
<span class="c1">#                if &quot;trace&quot; in secout:</span>
<span class="c1">#                    self.progress = 2</span>
<span class="c1">#                    keys_tra = output.options(&quot;trace&quot;)</span>
<span class="c1">#                    for kt in keys_tra:</span>
<span class="c1">#                        self.dtra[int(itx)][int(kt)] = output.get(&quot;trace&quot;, kt)</span>
<span class="c1">#</span>
<span class="c1">#                if &quot;tang&quot; in secout:</span>
<span class="c1">#                    self.progress = 3</span>
<span class="c1">#                    keys_tang = output.options(&quot;tang&quot;)</span>
<span class="c1">#                    for kt in keys_tang:</span>
<span class="c1">#                        self.dtang[int(itx)][int(kt)] = output.get(&quot;tang&quot;, kt)</span>
<span class="c1">#                        self.drang[int(itx)][int(kt)] = output.get(&quot;rang&quot;, kt)</span>
<span class="c1">#                        self.dtud[int(itx)][int(kt)] = output.get(&quot;tud&quot;, kt)</span>
<span class="c1">#                if &quot;field&quot; in secout:</span>
<span class="c1">#                    self.progress = 4</span>
<span class="c1">#                    keys_field = output.options(&quot;field&quot;)</span>
<span class="c1">#                    for kt in keys_field:</span>
<span class="c1">#                        self.dfield[int(itx)][int(kt)] = output.get(</span>
<span class="c1">#                            &quot;field&quot;, kt)</span>
<span class="c1">#                        self.dtauk[int(itx)][int(kt)] = output.get(&quot;tauk&quot;, kt)</span>
<span class="c1">#                if &quot;cir&quot; in secout:</span>
<span class="c1">#                    self.progress = 5</span>
<span class="c1">#                    keys_cir = output.options(&quot;cir&quot;)</span>
<span class="c1">#                    for kt in keys_cir:</span>
<span class="c1">#                        self.dcir[int(itx)][int(kt)] = output.get(&quot;cir&quot;, kt)</span>
<span class="c1">#</span>
<span class="c1">#                self.output[int(itx)] = output</span>
        <span class="c1">#</span>
        <span class="c1"># Waveform section</span>
        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav</span> <span class="o">=</span> <span class="n">wvf</span><span class="o">.</span><span class="n">Waveform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul.layout"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.layout.html#pylayers.simul.simulem.Simul.layout">[docs]</a>    <span class="k">def</span> <span class="nf">layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filestruc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load a layout in the simulation oject</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        _filestruc : string</span>
<span class="sd">            short file name of the Layout object</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">        &gt;&gt;&gt; S.layout(&#39;defstr.ini&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span> <span class="o">=</span> <span class="n">_filestruc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">_filestruc</span><span class="p">)</span>
        <span class="c1"># update config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="s2">&quot;struc&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filestr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span></div>

    <span class="c1">#def show(self, itx=[-1], irx=[-1], furniture=True, s=8, c=&#39;b&#39;, traj=False, num=False,fig=[],ax=[]):</span>
<div class="viewcode-block" id="Simul.show"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.show.html#pylayers.simul.simulem.Simul.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show simulation</span>

<span class="sd">            Parameters</span>
<span class="sd">            -----------</span>
<span class="sd">            itx        : list of tx indices</span>
<span class="sd">            irx        : list of rx indices</span>
<span class="sd">            furniture  : boolean for METALIC furniture display</span>
<span class="sd">            s          : scale fir scatter plot  (default 8)</span>
<span class="sd">            c          : color for scatter plot  (default &#39;b&#39;)</span>
<span class="sd">            traj       : boolean  (def False)</span>
<span class="sd">            num        : boolean  (def False)</span>
<span class="sd">                display a number</span>


<span class="sd">            Examples</span>
<span class="sd">            --------</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">            &gt;&gt;&gt; S = Simul()</span>
<span class="sd">            &gt;&gt;&gt; S.load(&#39;w1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; S.L.loadfur(&#39;FurW1.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; S.show()</span>
<span class="sd">            &gt;&gt;&gt; plt.show()</span>



<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;itx&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                     <span class="s1">&#39;irx&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                     <span class="s1">&#39;furniture&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;s&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
                     <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;num&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;aw&#39;</span><span class="p">:</span><span class="bp">False</span>
                     <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="s2">&quot;=kwargs[&#39;&quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot;&#39;]&quot;</span>
            <span class="k">exec</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">itx</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">itx</span> <span class="o">=</span> <span class="p">[</span><span class="n">itx</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">irx</span> <span class="o">=</span> <span class="p">[</span><span class="n">irx</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="c1">#self.L.display[&#39;scaled&#39;]=False</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showG</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">aw</span><span class="o">=</span><span class="n">aw</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">furniture</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;lfur&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fur</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">lfur</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fur</span><span class="o">.</span><span class="n">Matname</span> <span class="o">==</span> <span class="s1">&#39;METAL&#39;</span><span class="p">:</span>
                        <span class="n">fur</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s2">&quot;Warning : no furniture file loaded&quot;</span>

        <span class="k">if</span> <span class="n">irx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="c1">#ax.scatter(self.rx.position[0,0],self.rx.position[0,1],c=&#39;k&#39;,s=s,linewidth=0)</span>
            <span class="c1">#ax.scatter(self.rx.position[1,0],self.rx.position[1,1],c=&#39;b&#39;,s=s,linewidth=0)</span>
            <span class="c1">#ax.scatter(self.rx.position[2,0],self.rx.position[2,1],c=&#39;g&#39;,s=s,linewidth=0)</span>
            <span class="c1">#ax.scatter(self.rx.position[3,0],self.rx.position[3,1],c=&#39;c&#39;,s=s,linewidth=0)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">irx</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">itx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">traj</span><span class="p">:</span>
                <span class="n">cpt</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">itx</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">traj</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">cpt</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
                        <span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span></div>
        <span class="c1">#for k in range(self.tx.N):</span>
        <span class="c1">#    ax.text(self.tx.position[0,k],self.tx.position[1,k],str(k+1),color=&#39;black&#39;)</span>
        <span class="c1">#    ax.scatter(self.tx.position[0,:],self.tx.position[0,:],</span>

        <span class="c1">#for k in range(self.rx.N):</span>
        <span class="c1">#   ax.text(self.rx.position[0,k],self.rx.position[1,k],str(k),color=&#39;black&#39;)</span>

<div class="viewcode-block" id="Simul.PL"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.PL.html#pylayers.simul.simulem.Simul.PL">[docs]</a>    <span class="k">def</span> <span class="nf">PL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot Path Loss</span>

<span class="sd">        itx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">td</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tEa</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tEo</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">irx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span>
            <span class="n">cira</span><span class="p">,</span> <span class="n">ciro</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadcir</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">)</span>

            <span class="n">td</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
            <span class="n">tEa</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ea</span><span class="p">)</span>
            <span class="n">tEo</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Eo</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tEa</span><span class="p">),</span> <span class="s1">&#39;xr&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">td</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tEo</span><span class="p">),</span> <span class="s1">&#39;xb&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">td</span><span class="p">,</span> <span class="n">tEa</span><span class="p">,</span> <span class="n">tEo</span></div>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwrgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">kt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nb_tx</span><span class="p">):</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">kt</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">link</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">tx</span>
            <span class="k">for</span> <span class="n">kr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nb_Run</span><span class="p">):</span>
                <span class="n">rx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">Run</span><span class="p">],</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">Run</span><span class="p">],</span> <span class="n">S</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">Run</span><span class="p">]])</span>
                <span class="n">link</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">rx</span>
                <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
                <span class="n">ak</span><span class="p">,</span><span class="n">tk</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">diffraction</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
                <span class="n">ciro</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">applywav</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
                <span class="n">cir</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">ciro</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ciro</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
                <span class="n">tac</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
                <span class="n">tcir</span><span class="p">[</span><span class="n">Run</span><span class="p">]</span> <span class="o">=</span> <span class="n">cir</span>
                <span class="k">print</span> <span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">,</span><span class="n">tac</span><span class="o">-</span><span class="n">toc</span>


<div class="viewcode-block" id="Simul.evalcir"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.evalcir.html#pylayers.simul.simulem.Simul.evalcir">[docs]</a>    <span class="k">def</span> <span class="nf">evalcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">algo</span><span class="o">=</span><span class="s1">&#39;new&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        S</span>
<span class="sd">        tx</span>
<span class="sd">        rx</span>
<span class="sd">        wav</span>
<span class="sd">        cutoff</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">crxp</span> <span class="o">=-</span><span class="mi">1</span>
        <span class="n">ctxp</span> <span class="o">=-</span><span class="mi">1</span>
        <span class="n">tcir</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span>
        <span class="n">Ntx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span>
        <span class="n">Nrx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1">#for kt in range(1,Ntx-1):</span>
        <span class="c1">#print kt+1</span>
        <span class="n">kt</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">tcir</span><span class="p">[</span><span class="n">kt</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">kt</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">kt</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">kt</span><span class="p">]])</span>
        <span class="k">for</span> <span class="n">kr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nrx</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">kr</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="n">kr</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">kr</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">kr</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">kr</span><span class="p">]])</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">crx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ctx</span><span class="o">&lt;&gt;</span><span class="n">ctxp</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">crx</span><span class="o">&lt;&gt;</span><span class="n">crxp</span><span class="p">):</span>
                <span class="n">Si</span>  <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">Signatures</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">)</span>
                <span class="n">ctxp</span> <span class="o">=</span> <span class="n">ctx</span>
                <span class="n">crxp</span> <span class="o">=</span> <span class="n">crx</span>
                <span class="n">Si</span><span class="o">.</span><span class="n">run4</span><span class="p">(</span><span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span><span class="n">algo</span><span class="o">=</span><span class="n">algo</span><span class="p">)</span>
            <span class="n">r2d</span> <span class="o">=</span> <span class="n">Si</span><span class="o">.</span><span class="n">rays</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
            <span class="c1">#r2d.show(S.L)</span>

            <span class="n">r3d</span> <span class="o">=</span> <span class="n">r2d</span><span class="o">.</span><span class="n">to3D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
            <span class="n">r3d</span><span class="o">.</span><span class="n">locbas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
            <span class="n">r3d</span><span class="o">.</span><span class="n">fillinter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
            <span class="n">Ct</span>  <span class="o">=</span> <span class="n">r3d</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">)</span>
            <span class="n">sca</span> <span class="o">=</span> <span class="n">Ct</span><span class="o">.</span><span class="n">prop2tran</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span><span class="p">)</span>
            <span class="n">cir</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">applywavB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wav</span><span class="o">.</span><span class="n">sfg</span><span class="p">)</span>
            <span class="n">tcir</span><span class="p">[</span><span class="n">kt</span><span class="p">][</span><span class="n">kr</span><span class="p">]</span> <span class="o">=</span> <span class="n">cir</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tcir</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul.loadcir"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.loadcir.html#pylayers.simul.simulem.Simul.loadcir">[docs]</a>    <span class="k">def</span> <span class="nf">loadcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        itx : Tx index</span>
<span class="sd">        irx : Rx index</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        cir(itx,irx)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_filecir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mat&#39;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">itx</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;00&#39;</span> <span class="o">+</span> <span class="n">ext</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">ext</span>

        <span class="n">filecir</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filecir</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRCIR&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/Tx&#39;</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filecir</span><span class="p">)</span>

        <span class="n">kxa</span> <span class="o">=</span> <span class="s1">&#39;ta&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>
        <span class="n">kya</span> <span class="o">=</span> <span class="s1">&#39;cira&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>

        <span class="n">kxo</span> <span class="o">=</span> <span class="s1">&#39;to&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>
        <span class="n">kyo</span> <span class="o">=</span> <span class="s1">&#39;ciro&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>

        <span class="n">cira</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">kxa</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">kya</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ciro</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">kxo</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">kyo</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">return</span><span class="p">(</span><span class="n">cira</span><span class="p">,</span> <span class="n">ciro</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul.pltcir"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.pltcir.html#pylayers.simul.simulem.Simul.pltcir">[docs]</a>    <span class="k">def</span> <span class="nf">pltcir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">irx</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; plot Channel Impulse Response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        itx : Tx index</span>
<span class="sd">        irx : Rx index</span>
<span class="sd">        mode : str</span>
<span class="sd">            {&#39;linear&#39;,&#39;dB&#39;}</span>
<span class="sd">            noise : boolean</span>
<span class="sd">        color : string</span>
<span class="sd">            default &#39;b&#39;</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">        &gt;&gt;&gt; S = Simul()</span>
<span class="sd">        &gt;&gt;&gt; S.load(&#39;where2.ini&#39;)</span>
<span class="sd">        &gt;&gt;&gt; S.run(1,1)</span>
<span class="sd">        &gt;&gt;&gt; S.pltcir(1,1,mode=&#39;linear&#39;,noise=False,color=&#39;k&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="c1">#if ax==[]:</span>
        <span class="c1">#    ax = fig.gca()</span>

        <span class="n">_filecir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.mat&#39;</span>
        <span class="n">filecir</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filecir</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRCIR&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/Tx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.3d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">itx</span><span class="p">))</span>
        <span class="n">D</span> <span class="o">=</span> <span class="n">spio</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">filecir</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;211&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;212&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">format</span> <span class="p">:</span>
            <span class="n">kxa</span> <span class="o">=</span> <span class="s1">&#39;t&#39;</span>
            <span class="n">kya</span> <span class="o">=</span> <span class="s1">&#39;cir&#39;</span>
            <span class="n">ta</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">kxa</span><span class="p">]</span>
            <span class="n">Tobs</span> <span class="o">=</span> <span class="n">ta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">te</span> <span class="o">=</span> <span class="n">ta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
                <span class="n">na</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">Noise</span><span class="p">(</span><span class="n">Tobs</span> <span class="o">+</span> <span class="n">te</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">te</span><span class="p">)</span>
                <span class="n">naf</span> <span class="o">=</span> <span class="n">na</span><span class="o">.</span><span class="n">gating</span><span class="p">(</span><span class="mf">4.493</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">cira</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">kya</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span>


        <span class="k">if</span> <span class="s1">&#39;o&#39;</span> <span class="ow">in</span> <span class="n">format</span><span class="p">:</span>
            <span class="n">kxo</span> <span class="o">=</span> <span class="s1">&#39;to&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>
            <span class="n">kyo</span> <span class="o">=</span> <span class="s1">&#39;ciro&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">kxo</span><span class="p">]</span>
            <span class="n">Tobs</span> <span class="o">=</span> <span class="n">to</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">te</span> <span class="o">=</span> <span class="n">to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">noise</span><span class="p">:</span>
                <span class="n">no</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">Noise</span><span class="p">(</span><span class="n">Tobs</span> <span class="o">+</span> <span class="n">te</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">te</span><span class="p">)</span>
                <span class="n">nof</span> <span class="o">=</span> <span class="n">no</span><span class="o">.</span><span class="n">gating</span><span class="p">(</span><span class="mf">4.493</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ciro</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">TUsignal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">kyo</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="c1">#plt.plot(ta,naf.y,color=&#39;k&#39;,label=&#39;Noise&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">kya</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rx &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ns)&#39;</span><span class="p">)</span>

            <span class="sd">&#39;&#39;&#39;if noise:</span>
<span class="sd">                naf.plot(col=&#39;k&#39;)</span>
<span class="sd">            cira.plot(col=color)&#39;&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&#39;&#39;&#39;if noise:</span>
<span class="sd">                naf.plotdB(col=&#39;k&#39;)</span>
<span class="sd">            cira.plotdB()&#39;&#39;&#39;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ta</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">kya</span><span class="p">])),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rx &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ns)&#39;</span><span class="p">)</span>
<span class="c1">#        plt.legend()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        <span class="c1">#plt.savefig(&#39;Tx&#39;+str(itx),format=pdf,dpi=300)</span>

<div class="viewcode-block" id="Simul.scatter"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.scatter.html#pylayers.simul.simulem.Simul.scatter">[docs]</a>    <span class="k">def</span> <span class="nf">scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                <span class="n">spl</span><span class="o">=</span><span class="mi">221</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">vaxis</span><span class="o">=</span><span class="p">((</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">)),</span>
                <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">colbool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">cblabel</span><span class="o">=</span><span class="s1">&#39;dB&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            itx</span>
<span class="sd">            irx</span>
<span class="sd">            values</span>
<span class="sd">            cmap</span>
<span class="sd">            s</span>
<span class="sd">            spl</span>
<span class="sd">            title</span>
<span class="sd">            vaxis</span>
<span class="sd">            vmin</span>
<span class="sd">            vmax</span>
<span class="sd">            colbool</span>
<span class="sd">            clabel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spl</span><span class="p">)</span>
        <span class="n">xtx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">itx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">ytx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">itx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">xrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">irx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">yrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">irx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">furk</span> <span class="ow">in</span> <span class="n">siradel</span><span class="o">.</span><span class="n">siradel_furniture</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fur</span> <span class="o">=</span> <span class="n">siradel</span><span class="o">.</span><span class="n">siradel_furniture</span><span class="p">[</span><span class="n">furk</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fur</span><span class="o">.</span><span class="n">Matname</span> <span class="o">==</span> <span class="s1">&#39;METAL&#39;</span><span class="p">:</span>
                <span class="n">fur</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>

        <span class="c1">#self.show(furniture=True)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="n">vaxis</span><span class="p">)</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xtx</span><span class="p">,</span> <span class="n">ytx</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xrx</span><span class="p">,</span> <span class="n">yrx</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colbool</span><span class="p">:</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="n">colorbar</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">cblabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul.info"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.info.html#pylayers.simul.simulem.Simul.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="o">=</span><span class="p">[],</span> <span class="n">irx</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; display simulation information</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         itx : Tx index</span>
<span class="sd">         irx : Rx index</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span>
        <span class="k">print</span> <span class="s1">&#39;------------------------------------------&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Layout Info : </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;provide a Layout in the simulation : S.L &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;&gt;&gt;&gt; S.layout(filename.str) &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;or &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;&gt;&gt;&gt; S.layout(filename.str2 &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;or &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;&gt;&gt;&gt; S.layout(filename.str,filematini,filematini) &quot;</span>
            <span class="k">print</span> <span class="s2">&quot;default files exists for filematini and fileslabini &quot;</span>

            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Tx Info :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;provide a tx in the simulation : S.tx &quot;</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;Rx Info :</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;provide a rx in the simulation : S.rx &quot;</span>
            <span class="k">return</span>

        <span class="c1">#    print &quot;Tx : &quot;,self.tx.points[itx]</span>
            <span class="k">print</span> <span class="s2">&quot;Rx : &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span>
            <span class="k">print</span> <span class="s2">&quot;Delay (ns) :&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">)</span>
            <span class="k">print</span> <span class="s2">&quot;Distance (m) :&quot;</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">)</span>
            <span class="k">print</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">itx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlch</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot;Launching &quot;</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dlch</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">irx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot;Tracing &quot;</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="n">gr</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
                <span class="n">gr</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">irx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtud</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot;Tud parameters &quot;</span>
                <span class="k">print</span> <span class="s2">&quot;-----&quot;</span>
                <span class="k">print</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtud</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="k">print</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtang</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="k">print</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drang</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="n">gt</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="o">.</span><span class="n">GrRayTud</span><span class="p">()</span>
                <span class="n">gt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtud</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dtang</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">drang</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">irx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtauk</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtauk</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfield</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
                <span class="n">VC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VC</span><span class="p">(</span><span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">irx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">dcir</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span></div>

<div class="viewcode-block" id="Simul.info2"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.info2.html#pylayers.simul.simulem.Simul.info2">[docs]</a>    <span class="k">def</span> <span class="nf">info2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">print</span> <span class="n">j</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span></div>

<div class="viewcode-block" id="Simul.filtray"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.filtray.html#pylayers.simul.simulem.Simul.filtray">[docs]</a>    <span class="k">def</span> <span class="nf">filtray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">,</span> <span class="n">tau0</span><span class="p">,</span> <span class="n">tau1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; filter rays</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        itx :</span>
<span class="sd">        irx :</span>
<span class="sd">        tau0 :</span>
<span class="sd">        tau1 :</span>
<span class="sd">        col :</span>

<span class="sd">        Display ray and nstr</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;NodeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;EdgeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="c1">#self.L.show(fig,ax,nodelist,seglist)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">()</span>
        <span class="n">delays</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">delay</span><span class="p">()</span>
        <span class="n">rayset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">delays</span> <span class="o">&gt;=</span> <span class="n">tau0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">delays</span> <span class="o">&lt;=</span> <span class="n">tau1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rayset</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">itx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-Rx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; : &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
            <span class="n">tau0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &lt; tau &lt; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tau1</span><span class="p">))</span></div>

<div class="viewcode-block" id="Simul.showray"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.showray.html#pylayers.simul.simulem.Simul.showray">[docs]</a>    <span class="k">def</span> <span class="nf">showray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">,</span> <span class="n">iray</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span> <span class="n">fig</span><span class="o">=</span><span class="p">[],</span> <span class="n">ax</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; show layout and rays for a radio link</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        itx  : tx index</span>
<span class="sd">        irx  : rx index</span>
<span class="sd">        iray : list of rays to be displayed ndarray</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#if ax==[]:</span>
        <span class="c1">#    fig = plt.figure()</span>
        <span class="c1">#    ax  = fig.add_subplot(&#39;111&#39;)</span>

        <span class="n">gr</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iray</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ray</span> <span class="o">=</span> <span class="n">gr</span><span class="o">.</span><span class="n">ray3d</span><span class="p">[</span><span class="n">iray</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">nstr</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">nstr</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">uneg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nstr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">upos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">((</span><span class="n">nstr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nstr</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Ne</span><span class="p">))</span>
            <span class="n">uceil</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nstr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ufloor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nstr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">Ne</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1">#seglist  = nstr[upos[0]]-1</span>
        <span class="c1">#nodelist = -nstr[uneg[0]]-1</span>
        <span class="c1">#seglist2 = S.L.segpt(nodelist)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;NodeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;EdgeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1">#self.L.show(fig,ax)</span>
        <span class="c1">#print ray.nn</span>
        <span class="c1">#print len(ray.nstr)</span>
        <span class="c1">#print ray.nstr</span>
        <span class="c1">#print nodelist</span>
        <span class="c1">#print seglist</span>
        <span class="c1">#print seglist2</span>
        <span class="c1">#seglist = hstack((seglist,seglist2))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;Thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;NodeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">display</span><span class="p">[</span><span class="s1">&#39;EdgeNum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;scaled&#39;</span><span class="p">)</span>
        <span class="c1">#self.L.show(fig,ax,nodelist,seglist)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">showGs</span><span class="p">(</span><span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">iray</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iray</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nstr</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">itx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-Rx&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">irx</span><span class="p">)</span> <span class="o">+</span>
                      <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">iray</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">iray</span><span class="p">)))</span></div>

<div class="viewcode-block" id="Simul.show3l"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.show3l.html#pylayers.simul.simulem.Simul.show3l">[docs]</a>    <span class="k">def</span> <span class="nf">show3l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; geomview display of a specific link</span>

<span class="sd">        g = S.show3l(itx,irx)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        itx</span>
<span class="sd">            transmitter index</span>
<span class="sd">        irx</span>
<span class="sd">            receiver index</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filetra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtra</span><span class="p">[</span><span class="n">itx</span><span class="p">][</span><span class="n">irx</span><span class="p">]</span>
        <span class="n">gr</span> <span class="o">=</span> <span class="n">GrRay3D</span><span class="p">()</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filetra</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">)</span>
        <span class="n">gr</span><span class="o">.</span><span class="n">show3</span><span class="p">()</span>

        <span class="k">return</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul._show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul._show3.html#pylayers.simul.simulem.Simul._show3">[docs]</a>    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rays</span><span class="o">=</span><span class="p">[],</span><span class="n">newfig</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display of the simulation configuration</span>
<span class="sd">            using Mayavi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        rays: Ray3d object :</span>
<span class="sd">            display the rays of the simulation</span>
<span class="sd">        newfig : boolean (default : False)</span>
<span class="sd">        kwargs of Rays.show3()</span>


<span class="sd">        see also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.gis.layout</span>
<span class="sd">        pylayers.antprop.antenna</span>
<span class="sd">        pylayers.antprop.rays</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Atx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">A</span>
        <span class="n">Arx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">A</span>
        <span class="n">Ttx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">orientation</span>
        <span class="n">Trx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">orientation</span>
        <span class="n">ptx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">position</span>
        <span class="n">prx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">position</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        <span class="n">Atx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Ttx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">po</span><span class="o">=</span><span class="n">ptx</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">Arx</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">Trx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">po</span><span class="o">=</span><span class="n">prx</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rays</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">rays</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>



<div class="viewcode-block" id="Simul.show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.show3.html#pylayers.simul.simulem.Simul.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rays</span><span class="o">=</span><span class="p">[],</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; geomview display of the simulation configuration</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        centered : boolean</span>
<span class="sd">            center the scene if True</span>
<span class="sd">        bdis  : boolean</span>
<span class="sd">            display local basis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;tx set is no defined&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rx set is no defined&#39;</span><span class="p">)</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;.off&#39;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRGEOM&#39;</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LIST</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sttx</span> <span class="o">=</span> <span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">filegeom</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">sttx</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">strx</span> <span class="o">=</span> <span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">filegeom</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">strx</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stst</span> <span class="o">=</span> <span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">filegeom</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">stst</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sttx</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strx</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stst</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;/usr/share/geomview/geom/xyz.vect}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rays</span> <span class="o">!=</span><span class="p">[]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bdis&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;centered&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;{&lt;&quot;</span> <span class="o">+</span> <span class="n">rays</span><span class="o">.</span><span class="n">show3</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;geomview -nopanel -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; 2&gt;/dev/null &amp;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">command</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simul.run"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.run.html#pylayers.simul.simulem.Simul.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">cirforce</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">cutoff</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; run the simulation for 1 tx and a set of rx</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            itx      : tx index</span>
<span class="sd">            srx      : list of rx index</span>
<span class="sd">            cirforce : boolean</span>

<span class="sd">            Warnings</span>
<span class="sd">            --------</span>

<span class="sd">            index point start with 1</span>

<span class="sd">            Example</span>
<span class="sd">            -------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.simul.simulem import *</span>
<span class="sd">            &gt;&gt;&gt; itx = 1</span>
<span class="sd">            &gt;&gt;&gt; srx = [1,2,3]</span>
<span class="sd">            &gt;&gt;&gt; S   = Simul()</span>
<span class="sd">            &gt;&gt;&gt; S.load(&#39;where2.ini&#39;)</span>
<span class="sd">            &gt;&gt;&gt; out = S.run(itx,srx)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># get file prefix</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="n">DLink</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">L</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span><span class="n">fGHz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fGHz</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filesimul</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ini&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
        <span class="n">lsig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">il</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
            <span class="n">tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">il</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">il</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
            <span class="n">crx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">pt2cy</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
            <span class="n">_filecir</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span><span class="s1">&#39;-cir-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">link</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="n">ctx</span><span class="p">,</span><span class="n">crx</span><span class="p">))</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">D</span><span class="p">[</span><span class="s1">&#39;Tx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span>
            <span class="n">D</span><span class="p">[</span><span class="s1">&#39;Rx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rx</span>

            
            <span class="n">dl</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">tx</span>
            <span class="n">dl</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">rx</span>
            <span class="n">ak</span><span class="p">,</span><span class="n">tauk</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">diffraction</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chan</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">dl</span></div>
            <span class="c1">#cira = dl.H.applywavB(self.wav.sf)</span>
            <span class="c1">#cira = dl.H.applywavB(self.wav.sfg)</span>

            <span class="c1">#D[&#39;t&#39;] = cira.x</span>
            <span class="c1">#D[&#39;cir&#39;] = cira.y</span>

            <span class="c1">#filename = pyu.getlong(_filecir, &#39;output&#39;)</span>
            <span class="c1">#spio.savemat(filename, D)</span>
            
<div class="viewcode-block" id="Simul.delay"><a class="viewcode-back" href="../../../modules/generated/pylayers.simul.simulem.Simul.delay.html#pylayers.simul.simulem.Simul.delay">[docs]</a>    <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itx</span><span class="p">,</span> <span class="n">irx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; calculate LOS link delay</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            itx</span>
<span class="sd">            irx</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            delay : float </span>
<span class="sd">                delay in ns</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">itx</span><span class="p">]</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">irx</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">tx</span> <span class="o">-</span> <span class="n">rx</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="n">dist</span> <span class="o">/</span> <span class="mf">0.3</span><span class="p">)</span></div>

<span class="k">if</span> <span class="p">(</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="c1">#plt.ion()</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2016, PyLayers developer team.
      Last updated on Sep 30, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.5a0. Design by <a href="http://desgrana.es">Desgrana</a>.
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="../../../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>