<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.util.geomutil &mdash; PyLayers</title>
    
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyLayers" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
<div style="color: black;background-color: white; font-size: 3.2em; text-align: left; padding: 15px 10px 10px 15px">
    PyLayers
<!--
<a href="../../../index.html"><img src="../../../_static/logo.png" height="200" border="0"
    alt="pylayers"/></a>
-->
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebooks/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylayers.util.geomutil</h1><div class="highlight"><pre>
<span class="c"># -*- coding:Utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">pylayers.util</span> <span class="kn">import</span> <span class="n">easygui</span>
<span class="kn">from</span> <span class="nn">pylayers.antprop.slab</span> <span class="kn">import</span> <span class="n">Slab</span><span class="p">,</span> <span class="n">SlabDB</span><span class="p">,</span> <span class="n">Mat</span><span class="p">,</span> <span class="n">MatDB</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">sh</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="c">#! /usr/bin/python</span>
<span class="c"># geomutil.py</span>
<span class="sd">&quot;&quot;&quot; functions related to geometry</span>

<span class="sd"> Routines</span>
<span class="sd"> --------</span>

<span class="sd">     SignedArea(p=np.array([[0,10,10,0],[0,0,-2,-2]]))</span>

<span class="sd">     Centroid(p=np.array([[0,10,10,0],[0,0,-2,-2]]))</span>

<span class="sd">     Lr2n(p=np.array([[0,10,10,0],[0,0,-2,-2]]),closed=True)</span>

<span class="sd">     isBetween(p1, p2, p,epsilon=1e-5)</span>

<span class="sd">     pvec(v1,v2)</span>

<span class="sd">     pvecn(v1,v2)</span>

<span class="sd">     vec_sph(th,ph)</span>

<span class="sd">     ellipse(fd,p,vth,vph,Eth,Eph,N)</span>

<span class="sd">     ptonseg(pta,phe,pt)</span>

<span class="sd">     linet(sp,p1,p2,al,col,lwidth)</span>

<span class="sd">     ccw(A,B,C)</span>

<span class="sd">     intersect(A,B,C,D)</span>

<span class="sd">     mul3(A,B)</span>

<span class="sd">     MRot3(a,axe)</span>

<span class="sd">     MEulerAngle(alpha,beta,gamma)</span>

<span class="sd">     SphericalBasis(a)</span>

<span class="sd">     angledir(s)</span>

<span class="sd">     BTB_rx(a_g,T)</span>

<span class="sd">     BTB_tx(a_g,T)</span>

<span class="sd">     plotPolygon(poly,color=&quot;#abcdef&quot;,alpha=0.8)</span>

<span class="sd">     simplifyPolygon(poly1)</span>

<span class="sd">     shrinkPolygon(poly,d=0.1)</span>

<span class="sd">     shrinkPolygon2(poly1,d=0.1)</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="kn">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span>   <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span>   <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">toeplitz</span><span class="p">,</span> <span class="n">triu</span>
<span class="kn">from</span>   <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">as</span> <span class="nn">pyu</span>
<span class="kn">import</span> <span class="nn">pylayers.util.graphutil</span> <span class="kn">as</span> <span class="nn">gru</span>
<span class="c">#from antenna import *</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="kn">as</span> <span class="nn">shg</span>
<span class="kn">import</span> <span class="nn">shapely.ops</span> <span class="kn">as</span> <span class="nn">sho</span>
<span class="kn">from</span>   <span class="nn">descartes.patch</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>
<span class="kn">from</span>   <span class="nn">shapely.wkt</span> <span class="kn">import</span> <span class="n">loads</span>
<span class="kn">from</span>   <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>


<span class="n">COLOR</span> <span class="o">=</span> <span class="p">{</span>
    <span class="bp">True</span><span class="p">:</span> <span class="s">&#39;#6699cc&#39;</span><span class="p">,</span>
    <span class="bp">False</span><span class="p">:</span> <span class="s">&#39;#ff3333&#39;</span>
<span class="p">}</span>


<div class="viewcode-block" id="Geomview"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomview">[docs]</a><span class="k">class</span> <span class="nc">Geomview</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Geomview file class</span>

<span class="sd">    This class is parent of  GeomVect Geomlist Geomoff</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    show3</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="n">_filename</span><span class="p">,</span> <span class="s">&quot;geom&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

<div class="viewcode-block" id="Geomview.show3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomview.show3">[docs]</a>    <span class="k">def</span> <span class="nf">show3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. todo:</span>
<span class="sd">             change  background</span>
<span class="sd">             look for other geomview options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chaine</span> <span class="o">=</span> <span class="s">&quot;geomview  -b 1 1 1 &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; 2&gt;/dev/null &amp;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Geomlist"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomlist">[docs]</a><span class="k">class</span> <span class="nc">Geomlist</span><span class="p">(</span><span class="n">Geomview</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span> <span class="o">+</span> <span class="s">&#39;.list&#39;</span>
        <span class="n">Geomview</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">)</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;LIST</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Geomlist.append"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomlist.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">           append a line in .list file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strg</span><span class="p">)</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="GeomVect"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.GeomVect">[docs]</a><span class="k">class</span> <span class="nc">GeomVect</span><span class="p">(</span><span class="n">Geomview</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Geomview VECT file class</span>

<span class="sd">       + NPolylines  NVertices  NColors</span>
<span class="sd">       + Nv[0] ... Nv[NPolylines-1]     # number of vertices in each polyline</span>
<span class="sd">       + Nc[0] ... Nc[NPolylines-1]     # number of colors supplied in each polyline</span>
<span class="sd">       + Vert[0] ... Vert[NVertices-1]  # All the vertices (3*NVertices floats)</span>
<span class="sd">       + Color[0] ... Color[NColors-1]  # All the colors   (4*NColors floats, RGBA)</span>

<span class="sd">        VECT objects represent lists of polylines (strings of connected line segments, possibly closed).</span>

<span class="sd">       A degenerate polyline can be used to represent a point:</span>
<span class="sd">       A VECT file begins with the key word VECT or 4VECT and three integers:</span>

<span class="sd">       NLines, NVertices, and NColors.</span>
<span class="sd">           Here NLines is the number of polylines in the file,</span>
<span class="sd">           NVertices the total number of vertices, and NColors the number of</span>
<span class="sd">           colors as explained below.</span>
<span class="sd">           Next come NLines 16-bit integers</span>
<span class="sd">       Nv[0] Nv[1] Nv[2] ... Nv[NLines-1]</span>
<span class="sd">           giving the number of vertices in each polyline.</span>
<span class="sd">           A negative number indicates a closed polyline; 1 denotes a single-pixel point.</span>
<span class="sd">           The sum (of absolute values) of the Nv[i] must equal NVertices.</span>
<span class="sd">           Next come NLines more 16-bit integers</span>
<span class="sd">           Nc[i]: the number of colors in each polyline.</span>
<span class="sd">           Normally one of three values:</span>
<span class="sd">                0 : No color is specified for this polyline.</span>
<span class="sd">                    It&#39;s drawn in the same color as the previous polyline.</span>
<span class="sd">                1 : A single color is specified.</span>
<span class="sd">                    The entire polyline is drawn in that color.</span>
<span class="sd">                abs(Nv[i]) : Each vertex has a color.</span>
<span class="sd">                    Either each segment is drawn in the corresponding color,</span>
<span class="sd">                    or the colors are smoothly interpolated along the line segments,</span>
<span class="sd">                    depending on the implementation.</span>

<span class="sd">            Next come NVertices groups of 3 or 4 floating-point numbers:</span>
<span class="sd">                            the coordinates of all the vertices.</span>
<span class="sd">            If the keyword is 4VECT then there are 4 values per vertex.</span>
<span class="sd">            The first abs(Nv[0]) of them form the first polyline,</span>
<span class="sd">                    the next abs(Nv[1]) form the second and so on.</span>
<span class="sd">            Finally NColors groups of 4 floating-point numbers give red,</span>
<span class="sd">                    green, blue and alpha (opacity) values.</span>
<span class="sd">            The first Nc[0] of them apply to the first polyline, and so on.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    geomBase</span>
<span class="sd">        display a frame</span>
<span class="sd">    ellipse</span>
<span class="sd">        display an ellipse</span>
<span class="sd">    points</span>
<span class="sd">        display a set of points</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="o">=</span><span class="s">&#39;geomdef&#39;</span><span class="p">):</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span> <span class="o">+</span> <span class="s">&#39;.vect&#39;</span>
        <span class="n">Geomview</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">)</span>

<div class="viewcode-block" id="GeomVect.segments"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.GeomVect.segments">[docs]</a>    <span class="k">def</span> <span class="nf">segments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">i2d</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ds   : dictionnary</span>
<span class="sd">            len ds</span>
<span class="sd">        i2d  : boolean (defaut True)</span>
<span class="sd">            2d indicator</span>
<span class="sd">        linewidth : float</span>
<span class="sd">            default 2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;appearance { linewidth </span><span class="si">%d</span><span class="s"> }</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">linewidth</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VECT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">Ns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Ns</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Ns</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="c"># 3 Lines 6 Vertices 3 colors</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;2 &quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0 &quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
            <span class="p">(</span><span class="n">pta</span><span class="p">,</span> <span class="n">phe</span><span class="p">)</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i2d</span><span class="p">:</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pta</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">phe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phe</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">phe</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">geomBase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">pt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]),</span>
                 <span class="n">col</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construct a geomview vect file for vizualisation of a frame</span>
<span class="sd">            by default the geomview filename is base0.vect</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        M     : ndarray (3 x 3 )</span>
<span class="sd">            [ v1, v2, v3 ]</span>
<span class="sd">        pt    : np.array</span>
<span class="sd">            origin point  (default (0,0,0))</span>
<span class="sd">        col   :</span>
<span class="sd">            color (3x3)</span>
<span class="sd">        linewidth :</span>
<span class="sd">            linewidth (default 3)</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; v1 = np.array([1,0,0])</span>
<span class="sd">        &gt;&gt;&gt; v2 = np.array([0,1,0])</span>
<span class="sd">        &gt;&gt;&gt; v3 = np.array([0,0,1])</span>
<span class="sd">        &gt;&gt;&gt; M  = np.vstack((v1,v2,v3))</span>
<span class="sd">        &gt;&gt;&gt; #gv = GeomVect(&#39;test&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #gv.geomBase(M)</span>
<span class="sd">        &gt;&gt;&gt; #gv.show3()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;appearance { linewidth </span><span class="si">%d</span><span class="s"> }</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">linewidth</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VECT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;3 6 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># 3 Lines 6 Vertices 3 colors</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;2 2 2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># 2 points per lines</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1 1 1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>   <span class="c"># 1 color per line</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">M</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s">  0.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s">  0.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s">  0.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="c">#fo.write(&quot;{&lt;}\n&quot;)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="GeomVect.points"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.GeomVect.points">[docs]</a>    <span class="k">def</span> <span class="nf">points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">colorname</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Geomview display a set of points with color</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pt</span>
<span class="sd">           sequence of points np.ndarray or dictionnary whose value is a tuple (x,y,z)</span>
<span class="sd">        colorname</span>
<span class="sd">            a colorname from coldict keys</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; import scipy as sp</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">            &gt;&gt;&gt; pt1 = sp.rand(3,10)</span>
<span class="sd">            &gt;&gt;&gt; pt2 = { 1:(0,0,0),2:(10,10,10),3:(0,10,0),4:(10,0,0)}</span>
<span class="sd">            &gt;&gt;&gt; gv1 = GeomVect(&#39;test1&#39;)</span>
<span class="sd">            &gt;&gt;&gt; gv1.points(pt1)</span>
<span class="sd">            &gt;&gt;&gt; #gv1.show3()</span>
<span class="sd">            &gt;&gt;&gt; gv2 = GeomVect(&#39;test2&#39;)</span>
<span class="sd">            &gt;&gt;&gt; gv2.points(pt2)</span>
<span class="sd">            &gt;&gt;&gt; #gv2.show3()</span>

<span class="sd">        .. todo::</span>
<span class="sd">            colorbar depending of a value associated with point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="n">npt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pt</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">snpt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">snpt2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">npt</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">if</span> <span class="n">npt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;appearance{</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;linewidth 8}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VECT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">snpt2</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1 &quot;</span> <span class="o">*</span> <span class="n">npt</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1 &quot;</span> <span class="o">*</span> <span class="n">npt</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;ESPHERE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npt</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">i</span><span class="p">]][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">i</span><span class="p">]][</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npt</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="n">chaine</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">z</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chaine</span><span class="p">)</span>

        <span class="n">coldic</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">coldic</span><span class="p">[</span><span class="n">colorname</span><span class="p">],</span> <span class="s">&#39;float&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">npt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npt</span><span class="p">):</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> 1</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="Geomoff"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomoff">[docs]</a><span class="k">class</span> <span class="nc">Geomoff</span><span class="p">(</span><span class="n">Geomview</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    Class Geomview OFF File (Object File Format)</span>
<span class="sd">    [ST][C][N][4][n]OFF  #header keyword</span>
<span class="sd">    [Ndim] # spac dimension of vertices, present only if nOFF</span>
<span class="sd">    NVertices NFaces NEdges</span>

<span class="sd">    x[0],y[0] z[0]</span>

<span class="sd">    # Vertices,possibly with normals</span>
<span class="sd">    #colors, and/or texture coordinates, in that order, if the</span>
<span class="sd">    # prefixes N , C , ST are present</span>
<span class="sd">    # If 4OFF , each vertex has 4 components</span>
<span class="sd">    # including a final homogeneous component</span>
<span class="sd">    # If nOFF, each vertex has Ndim components</span>
<span class="sd">    # If 4nOFF , each vertex has Ndim+1 components</span>
<span class="sd">    ....</span>
<span class="sd">    x[NVertices-1],y[NVertices-1],z[NVertices-1]</span>

<span class="sd">    # Faces</span>
<span class="sd">    # Nv = # vertices on this face</span>
<span class="sd">    # v[0] ... v[Nv-1] : vertex indices</span>
<span class="sd">    # in range 0... NVertices -1</span>

<span class="sd">    Nv v[0] v[1] ....v[Nv-1] colorspec</span>

<span class="sd">    # colorspec continues past v[Nv-1]</span>
<span class="sd">    # to end-of-line may be 0 to 4 numbers</span>
<span class="sd">    # nothing default</span>
<span class="sd">    # integer : colormap index (read from the file cmap.fmap)</span>
<span class="sd">    # 3 or 4 integers RGB[A] values 0..255</span>
<span class="sd">    #</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">):</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">_filename</span> <span class="o">+</span> <span class="s">&#39;.off&#39;</span>
        <span class="n">Geomview</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_filename</span><span class="p">)</span>

<div class="viewcode-block" id="Geomoff.polygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomoff.polygon">[docs]</a>    <span class="k">def</span> <span class="nf">polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">poly</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  create geomview off for polygon</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p    : nparray</span>
<span class="sd">               sequence of points</span>
<span class="sd">        poly : list</span>
<span class="sd">               point numbers (index starting in 0) </span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">npt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">npoly</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> 1 </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000 </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npt</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npoly</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">poly</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="c">#fo.write(%6.3f %6.3f %6.3f 0.4\n&quot; % (col[0],col[1],col[2]))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1.0 1.0 1.0 0.4</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Geomoff.polygons"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomoff.polygons">[docs]</a>    <span class="k">def</span> <span class="nf">polygons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">polys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create a gemoff file for a list of polygons</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p    : nparray</span>
<span class="sd">               sequence of points</span>
<span class="sd">        poly : list</span>
<span class="sd">               point numbers (index starting in 0) </span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">npt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">npoly</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polys</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">npt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">npoly</span><span class="p">))</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;0.000 0.000 0.000 </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npt</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="k">for</span>  <span class="n">poly</span> <span class="ow">in</span> <span class="n">polys</span><span class="p">:</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nv</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">poly</span><span class="p">:</span>
                <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%i</span><span class="s">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="c">#fo.write(%6.3f %6.3f %6.3f 0.4\n&quot; % (col[0],col[1],col[2]))</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;1.0 0.0 1.0 0.4</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Geomoff.box"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Geomoff.box">[docs]</a>    <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extrem</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">])):</span>
        <span class="sd">&quot;&quot;&quot; Geomview file for creating a box</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        extrem : ndarray</span>
<span class="sd">                 (1x6) [xmin,xmax,ymin,ymax,zmin,zmax]</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">            &gt;&gt;&gt; geo = Geomoff(&#39;test&#39;)</span>
<span class="sd">            &gt;&gt;&gt; geo.box()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">zmin</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="n">extrem</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmin</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmax</span><span class="p">])</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmax</span><span class="p">])</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;8 6 12</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
            <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 0 1 2 3 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 7 4 0 3 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 4 5 1 0 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 5 6 2 1 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 3 2 6 7 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;4 6 5 4 7 1 0 0 0.3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#class Polygon2(object):</span>
<span class="c">#        def __init__(self,p):</span>
<span class="c">#                self.p = p</span>
<span class="c">#</span>
<span class="c">#        def SignedArea(self,p):</span>
<span class="c">#                &quot;&quot;&quot;</span>
<span class="c">#                area  = P.SignedArea()</span>
<span class="c">#                p : coordinates of the polygon vertices (2 x Np)</span>
<span class="c">#                R eferences: [O&#39;Rourke (C)] Thm. 1.3.3, p. 21; [Gems II] pp. 5-6:</span>
<span class="c">#                       &quot;The Area of a Simple Polygon&quot;, Jon Rokne. Dan Sunday&#39;s</span>
<span class="c">#                       explanation:</span>
<span class="c">#                http://www.cgafaq.info/wiki/Polygon_Area</span>
<span class="c">#                &quot;&quot;&quot;</span>
<span class="c">#                self.area = sum(np.hstack((self.p[0,1::],self.p[0:0]))*(np.hstack((self.p[1,2::],self.p[1,0:2]))-self.p[1,:])/2.</span>
<span class="c">#</span>
<span class="c">#</span>

</div></div>
<div class="viewcode-block" id="angular"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.angular">[docs]</a><span class="k">def</span> <span class="nf">angular</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; determine angle between p1 and p2 in [0 2pi]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p1</span>
<span class="sd">        point p1</span>
<span class="sd">    p2</span>
<span class="sd">        point p2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">        weird the origin is p2</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">    &gt;&gt;&gt; p21 = np.array([1,0])</span>
<span class="sd">    &gt;&gt;&gt; p22 = np.array([1,1])</span>
<span class="sd">    &gt;&gt;&gt; p23 = np.array([0,1])</span>
<span class="sd">    &gt;&gt;&gt; p24 = np.array([-1,1])</span>
<span class="sd">    &gt;&gt;&gt; p25 = np.array([-1,0])</span>
<span class="sd">    &gt;&gt;&gt; p26 = np.array([-1,-1])</span>
<span class="sd">    &gt;&gt;&gt; p27 = np.array([0,-1])</span>
<span class="sd">    &gt;&gt;&gt; p28 = np.array([1,-1])</span>
<span class="sd">    &gt;&gt;&gt; a1  = angular(p21,p1)</span>
<span class="sd">    &gt;&gt;&gt; a2  = angular(p22,p1)</span>
<span class="sd">    &gt;&gt;&gt; a3  = angular(p23,p1)</span>
<span class="sd">    &gt;&gt;&gt; a4  = angular(p24,p1)</span>
<span class="sd">    &gt;&gt;&gt; a5  = angular(p25,p1)</span>
<span class="sd">    &gt;&gt;&gt; a6  = angular(p26,p1)</span>
<span class="sd">    &gt;&gt;&gt; a7  = angular(p27,p1)</span>
<span class="sd">    &gt;&gt;&gt; a8  = angular(p28,p1)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">elif</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">elif</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">((</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">return</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">SignedArea</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]])):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the signed area of a sequence of points in a  plane</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : array 2 x Np</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">        &gt;&gt;&gt; p = np.array([[0,10,10,0],[0,0,-2,-2]])</span>
<span class="sd">        &gt;&gt;&gt; A = SignedArea(p)</span>
<span class="sd">        &gt;&gt;&gt; assert(A+20&lt;1e-15)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span> <span class="o">/</span> <span class="mf">2.</span>


<span class="k">def</span> <span class="nf">Centroid</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]])):</span>
    <span class="sd">&quot;&quot;&quot; Determine the centroid of the polygon defined by a sequence of points in a plane</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://en.wikipedia.org/wiki/Centroid</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        p : np array polygon (2xNp)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        pc = Centroid()</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">    &gt;&gt;&gt; p  = np.array([[0,10,10,0],[0,0,-2,-2]])</span>
<span class="sd">    &gt;&gt;&gt; pc = Centroid(p)</span>
<span class="sd">    &gt;&gt;&gt; d  = pc-np.array([5.,-1])</span>
<span class="sd">    &gt;&gt;&gt; md = np.dot(d,d)</span>
<span class="sd">    &gt;&gt;&gt; assert(md&lt;1e-15)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">SignedArea</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">A</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">-</span> \
        <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> 
    <span class="n">Cx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span>
    <span class="n">Cy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">A</span><span class="p">)</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span><span class="p">])</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">Lr2n</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]]),</span> <span class="n">closed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  Linear Ring to normal</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p      : np.array (2xN)</span>
<span class="sd">        closed : boolean</span>
<span class="sd">            default True</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        n   : np.array (2xN)</span>
<span class="sd">              normal</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            This function returns the internal normals to the LinearString of a Polygon</span>

<span class="sd">            The algoritm exploits the algebraic relation which exists</span>
<span class="sd">            between points coordinates and normal coordinates which involves</span>
<span class="sd">            the quasi toeplitz matrix M</span>

<span class="sd">            [-1  1  0 0 0  ...]</span>
<span class="sd">            [0  -1  1 0 0  ...]</span>
<span class="sd">            [</span>
<span class="sd">            [</span>
<span class="sd">            [           0 -1 1]  (truncate here if LineRing is open)</span>
<span class="sd">            -------------------</span>
<span class="sd">            [1          0 0 -1]  (add this line if LineRing is closed)</span>

<span class="sd">            p0                   p1</span>
<span class="sd">            x------------------x</span>
<span class="sd">            |        |         |</span>
<span class="sd">            |        v         |</span>
<span class="sd">            |                  |</span>
<span class="sd">            |-&gt;              &lt;-|</span>
<span class="sd">            |        ^         |</span>
<span class="sd">            |        |         |</span>
<span class="sd">         p3 x------------------x p2</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import shapely.geometry as shg</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; points1 = shg.MultiPoint([(0, 0), (0, 1), (1, 1), (1,0 )])</span>
<span class="sd">    &gt;&gt;&gt; points2 = shg.MultiPoint([(0, 0), (1, 0), (1, 1), (0,1 )])</span>
<span class="sd">    &gt;&gt;&gt; poly1   = shg.Polygon(points1)</span>
<span class="sd">    &gt;&gt;&gt; poly2   = shg.Polygon(points2)</span>
<span class="sd">    &gt;&gt;&gt; lring1  = poly1.exterior</span>
<span class="sd">    &gt;&gt;&gt; lring2  = poly2.exterior</span>
<span class="sd">    &gt;&gt;&gt; x1,y1    = lring1.xy</span>
<span class="sd">    &gt;&gt;&gt; x2,y2    = lring2.xy</span>
<span class="sd">    &gt;&gt;&gt; p1 = np.array([x1[0:-1],y1[0:-1]])</span>
<span class="sd">    &gt;&gt;&gt; p2 = np.array([x2[0:-1],y2[0:-1]])</span>
<span class="sd">    &gt;&gt;&gt; n1 = Lr2n(p1)</span>
<span class="sd">    &gt;&gt;&gt; n2 = Lr2n(p2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">toeplitz</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">closed</span><span class="p">:</span>
        <span class="n">M</span><span class="p">[</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Np</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">n</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">n</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c">#</span>
    <span class="c"># normalize normal</span>
    <span class="c">#</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">T</span>
    <span class="n">modn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">modn</span>
    <span class="c">#</span>
    <span class="c"># enforce inwards normal whatever the linear ring orientation</span>
    <span class="c">#</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">SignedArea</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sa</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nn</span> <span class="o">=</span> <span class="o">-</span><span class="n">nn</span>
    <span class="k">return</span> <span class="n">nn</span>


<div class="viewcode-block" id="isBetween"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.isBetween">[docs]</a><span class="k">def</span> <span class="nf">isBetween</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; test if p is between p1 and p2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p1 : np.array</span>
<span class="sd">    p2 : np.array</span>
<span class="sd">    p  : np.array</span>
<span class="sd">    epsilon : float</span>
<span class="sd">        tolerance default 1e-5</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    boolean</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">    &gt;&gt;&gt; p2 = np.array([2,0])</span>
<span class="sd">    &gt;&gt;&gt; p  = np.array([1,0])</span>
<span class="sd">    &gt;&gt;&gt; assert(isBetween(p1,p2,p)),&#39;error&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">crossproduct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">crossproduct</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">epsilon</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">dotproduct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dotproduct</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">squaredlengthba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dotproduct</span> <span class="o">&gt;</span> <span class="n">squaredlengthba</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="pvec"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.pvec">[docs]</a><span class="k">def</span> <span class="nf">pvec</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cross product between v1 and v2</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     v1 : numpy array</span>
<span class="sd">     v2 : numpy array</span>
<span class="sd">     Returns</span>
<span class="sd">     -------</span>
<span class="sd">     v3 = v1 x v2</span>

<span class="sd">     See Also</span>
<span class="sd">     --------</span>
<span class="sd">     np.cross</span>

<span class="sd">     Examples</span>
<span class="sd">     --------</span>
<span class="sd">     &gt;&gt;&gt; v1 = np.array([1,0,0])</span>
<span class="sd">     &gt;&gt;&gt; v2 = np.array([0,1,0])</span>
<span class="sd">     &gt;&gt;&gt; v3 = pvec(v1,v2)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">]])</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="pvecn"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.pvecn">[docs]</a><span class="k">def</span> <span class="nf">pvecn</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; cross product and normalization</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">     v1 : numpy array</span>
<span class="sd">     v2 : numpy array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">     v3 = v1 x v2 / | v1 x v2 |</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; v1 = np.array([2,0,0])</span>
<span class="sd">    &gt;&gt;&gt; v2 = np.array([0,2,0])</span>
<span class="sd">    &gt;&gt;&gt; v3 = pvecn(v1,v2)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">        numpy.cross</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="n">v3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v3</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;error divide by zero in pvecn&quot;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vec_sph"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.vec_sph">[docs]</a><span class="k">def</span> <span class="nf">vec_sph</span><span class="p">(</span><span class="n">th</span><span class="p">,</span> <span class="n">ph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    vec_sph(th,ph)</span>

<span class="sd">    return Spherical orthonormal frame</span>

<span class="sd">    [ [ eth]</span>
<span class="sd">      [ eph]    (theta,phi)</span>
<span class="sd">      [ er ] ]</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">e_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)))</span>
    <span class="n">e_ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">e_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ph</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)))</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">e_th</span><span class="p">,</span> <span class="n">e_ph</span><span class="p">,</span> <span class="n">e_r</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ellipse"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.ellipse">[docs]</a><span class="k">def</span> <span class="nf">ellipse</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">vth</span><span class="p">,</span> <span class="n">vph</span><span class="p">,</span> <span class="n">Eth</span><span class="p">,</span> <span class="n">Eph</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; build a geomview file of an ellipse</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">       fd    : file descriptor</span>
<span class="sd">       p     : ellipse center</span>
<span class="sd">       vth   : unitary vector along theta</span>
<span class="sd">       vph   : unitary vector along phi</span>
<span class="sd">       Eth   : complex</span>
<span class="sd">       Eph   : complex</span>
<span class="sd">       N     : descretization step</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pas</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">pas</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">Rth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Eth</span><span class="p">)</span>
    <span class="n">Rph</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Eph</span><span class="p">)</span>
    <span class="n">delta_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eth</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eth</span><span class="p">))</span>
    <span class="n">delta_ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eph</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eph</span><span class="p">))</span>

    <span class="n">pu1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">Rth</span> <span class="o">*</span> <span class="n">vth</span>
    <span class="n">pu2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">Rph</span> <span class="o">*</span> <span class="n">vph</span>

    <span class="n">u3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">uN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Al_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">delta_th</span><span class="p">)</span>
    <span class="n">Al_ph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">u3</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">delta_ph</span><span class="p">)</span>

    <span class="n">U1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vth</span><span class="p">,</span> <span class="n">uN</span><span class="p">)</span>
    <span class="n">U2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">vph</span><span class="p">,</span> <span class="n">uN</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">uN</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># Un point de l&#39;ellipse</span>
    <span class="c">#</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">P</span> <span class="o">+</span> <span class="p">(</span><span class="n">Rth</span> <span class="o">*</span> <span class="n">U1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Al_th</span><span class="p">)</span> <span class="o">+</span> <span class="n">Rph</span> <span class="o">*</span> <span class="n">U2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Al_ph</span><span class="p">))</span>

    <span class="n">vEre</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eth</span><span class="p">)</span> <span class="o">*</span> <span class="n">vth</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Eph</span><span class="p">)</span> <span class="o">*</span> <span class="n">vph</span><span class="p">)</span>
    <span class="n">vEim</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eth</span><span class="p">)</span> <span class="o">*</span> <span class="n">vth</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Eph</span><span class="p">)</span> <span class="o">*</span> <span class="n">vph</span><span class="p">)</span>

    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;appearance { linewidth 3 }</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;VECT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span>
                                                           <span class="mi">1</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span>
                                                                     <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="s"> </span><span class="si">%6.3f</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pc</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">N</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="s"> </span><span class="si">%g</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; normalize an array of N ndim  vectors</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vec : ndarray (N x ndim)</span>
<span class="sd">        N ndim vectors</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vecn : ndarray (N x ndim)</span>
<span class="sd">        N normalized ndim vectors</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">    &gt;&gt;&gt; vec = np.array([[1,1,0],[1,1,0],[1,0,1],[1,1,1]])</span>
<span class="sd">    &gt;&gt;&gt; normalize(vec)</span>
<span class="sd">    array([[ 0.70710678,  0.70710678,  0.        ],</span>
<span class="sd">           [ 0.70710678,  0.70710678,  0.        ],</span>
<span class="sd">           [ 0.70710678,  0.        ,  0.70710678],</span>
<span class="sd">           [ 0.57735027,  0.57735027,  0.57735027]])</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">vec</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vec</span><span class="o">*</span><span class="n">vec</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">vecn</span> <span class="o">=</span> <span class="n">vec</span><span class="o">/</span><span class="n">m</span>
    <span class="k">return</span><span class="p">(</span><span class="n">vecn</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ptonseg"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.ptonseg">[docs]</a><span class="k">def</span> <span class="nf">ptonseg</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span> <span class="n">phe</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Return a point on the segment pta pte</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pta : ndarray</span>
<span class="sd">    phe : ndarray</span>
<span class="sd">    pt  : ndarray</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    p   : ndarray</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">phe</span> <span class="o">-</span> <span class="n">pta</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">pt</span> <span class="o">-</span> <span class="n">pta</span>
    <span class="n">Lv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="n">Lu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">Lv</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">Lu</span><span class="o">&lt;&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">Lv</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">u</span> <span class="o">/</span> <span class="n">Lu</span>
    <span class="n">ctheta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">un</span><span class="p">,</span> <span class="n">vn</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">ctheta</span> <span class="o">*</span> <span class="n">Lu</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">&lt;</span> <span class="n">Lv</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pta</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">vn</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">return</span> <span class="n">p</span>
</div>
<div class="viewcode-block" id="dptseg"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.dptseg">[docs]</a><span class="k">def</span> <span class="nf">dptseg</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pt</span><span class="p">,</span><span class="n">ph</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Distance between a set of points and a segment</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ps  : ndim x Np</span>
<span class="sd">          array of Np points</span>
<span class="sd">    pt  : ndim x 1 </span>
<span class="sd">          tail coordinates of segment</span>
<span class="sd">    ph  : ndim x 1</span>
<span class="sd">          head coordinates of segment</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    d1 : 1 x Np</span>
<span class="sd">        distance between pt and ortho projection of ps </span>
<span class="sd">    d2 : 1 x Np</span>
<span class="sd">        distance between ph and ortho projection of ps </span>
<span class="sd">    h  : distance between ps and ortho projection of ps </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    </span>
<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">        &gt;&gt;&gt; pt = np.array([0,0])</span>
<span class="sd">        &gt;&gt;&gt; ph = np.array([10,0])</span>
<span class="sd">        &gt;&gt;&gt; p  = np.array([[-1,1 ,3,4,11],[8,1,2,3,3]])</span>
<span class="sd">        &gt;&gt;&gt; d1,d2,h = dptseg(p,pt,ph)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">pt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ndim</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">norml</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
    <span class="n">ln</span> <span class="o">=</span> <span class="n">l</span><span class="o">/</span><span class="n">norml</span>

    <span class="n">ptp</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">pt</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ln</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">ptp</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">norml</span> <span class="o">-</span> <span class="n">d1</span>
    <span class="n">ptpl</span> <span class="o">=</span> <span class="n">d1</span><span class="o">*</span><span class="n">ln</span>
    <span class="n">ptpo</span> <span class="o">=</span> <span class="n">ptp</span> <span class="o">-</span> <span class="n">ptpl</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ptpo</span><span class="o">*</span><span class="n">ptpo</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="n">d2</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="linet"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.linet">[docs]</a><span class="k">def</span> <span class="nf">linet</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">al</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  draw a short line segment</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    ax : axes</span>
<span class="sd">    p1 : np.array</span>
<span class="sd">        start point</span>
<span class="sd">    p2 : np.array</span>
<span class="sd">        end point</span>
<span class="sd">    al : float</span>
<span class="sd">        0 &lt; al &lt; 1   percentage of drawing  default 0.9</span>
<span class="sd">    color :  string</span>
<span class="sd">        color default &#39;blue&#39;</span>
<span class="sd">    linewidth : float</span>
<span class="sd">        line width default 1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ax  : Axes instance</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">        &gt;&gt;&gt; ax  = fig.gca()</span>
<span class="sd">        &gt;&gt;&gt; p1 = np.array([0,0])</span>
<span class="sd">        &gt;&gt;&gt; p2 = np.array([1,0])</span>
<span class="sd">        &gt;&gt;&gt; p3 = np.array([0,1])</span>
<span class="sd">        &gt;&gt;&gt; p4 = np.array([1,1])</span>
<span class="sd">        &gt;&gt;&gt; ax = linet(ax,p1,p2,al=0.7,color=&#39;red&#39;,linewidth=3)</span>
<span class="sd">        &gt;&gt;&gt; ax = linet(ax,p2,p3,al=0.8,color=&#39;blue&#39;,linewidth=2)</span>
<span class="sd">        &gt;&gt;&gt; ax = linet(ax,p3,p4,al=0.9,color=&#39;green&#39;,linewidth=1)</span>
<span class="sd">        &gt;&gt;&gt; ax = linet(ax,p4,p1,al=1,color=&#39;cyan&#39;,linewidth=0.2)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">L</span>
    <span class="n">pi</span> <span class="o">=</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">vn</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">al</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span>
    <span class="n">pf</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">vn</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">al</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pf</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">pi</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pf</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ccw"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.ccw">[docs]</a><span class="k">def</span> <span class="nf">ccw</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; counter clock wise order</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : array(2,N)</span>
<span class="sd">    B : array(2,N)</span>
<span class="sd">    C : array(2,N)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    array of booleans</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    `Line Segment Intersection &lt;http://www.bryceboe.com/2006/10/23/line-segment-intersection-algorithm/&gt;`_</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import scipy as sp</span>
<span class="sd">    &gt;&gt;&gt; A = sp.rand(2,100)</span>
<span class="sd">    &gt;&gt;&gt; B = sp.rand(2,100)</span>
<span class="sd">    &gt;&gt;&gt; C = sp.rand(2,100)</span>
<span class="sd">    &gt;&gt;&gt; u = ccw(A,B,C)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">((</span><span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>

</div>
<div class="viewcode-block" id="intersect"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.intersect">[docs]</a><span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; check if segment AB intersects segment CD</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : np.array (2xN)</span>
<span class="sd">    B : np.array (2xN)</span>
<span class="sd">    C : np.array (2xN)</span>
<span class="sd">    D : np.array (2xN)</span>


<span class="sd">    Exemples</span>
<span class="sd">    --------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import scipy as sp</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.plotutil import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">        &gt;&gt;&gt; N = 10</span>
<span class="sd">        &gt;&gt;&gt; A = sp.rand(2,N)</span>
<span class="sd">        &gt;&gt;&gt; B = sp.rand(2,N)</span>
<span class="sd">        &gt;&gt;&gt; C = sp.rand(2,N)</span>
<span class="sd">        &gt;&gt;&gt; D = sp.rand(2,N)</span>
<span class="sd">        &gt;&gt;&gt; b1 = intersect(A,B,C,D)</span>
<span class="sd">        &gt;&gt;&gt; pt1 = A[:,b1]</span>
<span class="sd">        &gt;&gt;&gt; ph1 = B[:,b1]</span>
<span class="sd">        &gt;&gt;&gt; pt2 = C[:,b1]</span>
<span class="sd">        &gt;&gt;&gt; ph2 = D[:,b1]</span>
<span class="sd">        &gt;&gt;&gt; f1,a1 = displot(pt1,ph1,&#39;r&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f2,a2 = displot(pt2,ph2,&#39;b&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ti = plt.title(&#39;test intersect&#39;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([[0],[0]])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([[1],[1]])</span>
<span class="sd">        &gt;&gt;&gt; C = np.array([[1],[0]])</span>
<span class="sd">        &gt;&gt;&gt; D = np.array([[0],[1]])</span>
<span class="sd">        &gt;&gt;&gt; intersect(A,B,C,D)</span>
<span class="sd">        array([ True], dtype=bool)</span>
<span class="sd">        &gt;&gt;&gt; intersect(A,B,C,D)[0]</span>
<span class="sd">        True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">ccw</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ccw</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ccw</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ccw</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">D</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="mul3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.mul3">[docs]</a><span class="k">def</span> <span class="nf">mul3</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A :</span>
<span class="sd">    B :</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    C</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="n">la</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
    <span class="n">lb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">la</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lb</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="k">if</span><span class="p">((</span><span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">sb</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">MA</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">MB</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">MB</span><span class="p">)</span>
                <span class="n">C</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
            <span class="k">return</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;wrong shape&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">sb</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">la</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lb</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sa</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">MA</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
                <span class="n">C</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
            <span class="k">return</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;wrong shape&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">sb</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">la</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lb</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sb</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sb</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sb</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">MB</span> <span class="o">=</span> <span class="n">B</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">MB</span><span class="p">)</span>
                <span class="n">C</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">P</span>
            <span class="k">return</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;wrong shape&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">,</span> <span class="n">sb</span>

</div>
<div class="viewcode-block" id="MRot3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.MRot3">[docs]</a><span class="k">def</span> <span class="nf">MRot3</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axe</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a 3D rotation matrix along axe 1|2|3</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    a   :  angle (radians)</span>
<span class="sd">    axe :  1:x 2:y 3:z</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">M2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">))))</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">M3</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">M2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axe</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">M3</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">M2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axe</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">M3</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">M2</span>
    <span class="k">return</span><span class="p">(</span><span class="n">M3</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="MEulerAngle"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.MEulerAngle">[docs]</a><span class="k">def</span> <span class="nf">MEulerAngle</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Calculate a rotation matrix from 3 Euler angles</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    alpha  : float</span>
<span class="sd">        rotation along axis z</span>
<span class="sd">    beta : float</span>
<span class="sd">        rotation along axis x</span>
<span class="sd">    gamma : float</span>
<span class="sd">        rotation along axis y</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    T    : np.array (3x3)</span>
<span class="sd">        rotation matrix</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; T=MEulerAngle(np.pi/2,np.pi/2,np.pi/2)</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">    Bizarre I was expected</span>

<span class="sd">    -1  0  0</span>
<span class="sd">     0  0  1</span>
<span class="sd">     0  1  0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Ra</span> <span class="o">=</span> <span class="n">MRot3</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">Rb</span> <span class="o">=</span> <span class="n">MRot3</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Rg</span> <span class="o">=</span> <span class="n">MRot3</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ra</span><span class="p">,</span> <span class="n">Rb</span><span class="p">),</span> <span class="n">Rg</span><span class="p">)</span>
    <span class="c">#T  = np.dot(np.dot(Rg,Rb),Ra)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SphericalBasis"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.SphericalBasis">[docs]</a><span class="k">def</span> <span class="nf">SphericalBasis</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SphericalBasis(a):</span>

<span class="sd">    a[:,0] : N x theta   theta angle</span>
<span class="sd">    a[:,1] : N x phi     phi angle</span>

<span class="sd">    M = N x [th,ph,s]  : 3 x 3 x N</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">pha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
        <span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])))</span><span class="o">.</span><span class="n">T</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">tha</span><span class="p">,</span> <span class="n">pha</span><span class="p">,</span> <span class="n">sa</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">M</span>

</div>
<div class="viewcode-block" id="angledir"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.angledir">[docs]</a><span class="k">def</span> <span class="nf">angledir</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; evaluate (theta,phi) from direction vector</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    s  : ndarray N x 3</span>
<span class="sd">         N direction vector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">      a  : ndarray 2xN</span>
<span class="sd">           N angle (theta,phi)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: </span>

<span class="sd">        \\theta = \\arccos{(\\frac{\\mathbf{s}}{\\hat{\mathbf{z}})}}</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; s = np.array([[2,0,0],[0,2,0],[0,0,1],[1,1,1]])    </span>
<span class="sd">        &gt;&gt;&gt; angledir(s)*180/np.pi</span>
<span class="sd">        array([[ 90.        ,   0.        ],</span>
<span class="sd">               [ 90.        ,  90.        ],</span>
<span class="sd">               [  0.        ,   0.        ],</span>
<span class="sd">               [ 54.73561032,  45.        ]])</span>


<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    BTB_Rx</span>
<span class="sd">    BTB_Tx</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">z</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">z</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">inull</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n</span><span class="p">[</span><span class="n">inull</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">vnx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">vny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vn</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">vny</span><span class="p">,</span> <span class="n">vnx</span><span class="p">)</span>
    <span class="n">a_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">))</span>
    <span class="n">a_new</span><span class="p">[</span><span class="n">inull</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">a_new</span><span class="p">[</span><span class="n">inull</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">return</span><span class="p">(</span><span class="n">a_new</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BTB_rx"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.BTB_rx">[docs]</a><span class="k">def</span> <span class="nf">BTB_rx</span><span class="p">(</span><span class="n">a_g</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Produce a set of rotation matrices for passage between global and local frame</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    a_g  :</span>
<span class="sd">        angle in global reference frame   2 x N  :  (theta,phi) x N</span>
<span class="sd">    T    :</span>
<span class="sd">        Rx rotation matrix     3 x 3</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>

<span class="sd">    angledir</span>
<span class="sd">    SphericalBasis</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    N is the number or rays</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">SphericalBasis</span><span class="p">(</span><span class="n">a_g</span><span class="p">)</span>
    <span class="n">th_g</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">ph_g</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">B_g</span> <span class="o">=</span> <span class="n">dstack</span><span class="p">((</span><span class="n">th_g</span><span class="p">,</span> <span class="n">ph_g</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">s_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">G</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">al</span> <span class="o">=</span> <span class="n">angledir</span><span class="p">(</span><span class="n">s_l</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">SphericalBasis</span><span class="p">(</span><span class="n">al</span><span class="p">)</span>
    <span class="n">th_l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">ph_l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">B_lT</span> <span class="o">=</span> <span class="n">dstack</span><span class="p">((</span><span class="n">th_l</span><span class="p">,</span> <span class="n">ph_l</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">mul3</span><span class="p">(</span><span class="n">B_lT</span><span class="p">,</span> <span class="n">mul3</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">B_g</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">al</span>

</div>
<div class="viewcode-block" id="BTB_tx"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.BTB_tx">[docs]</a><span class="k">def</span> <span class="nf">BTB_tx</span><span class="p">(</span><span class="n">a_g</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Produce a set of rotation matrices for passage between global and local frame</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    a_g  :</span>
<span class="sd">        angle in global reference frame      2 x N  :  (theta,phi) x N</span>
<span class="sd">    T    :</span>
<span class="sd">        Tx rotation matrix     3 x 3</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">SphericalBasis</span><span class="p">(</span><span class="n">a_g</span><span class="p">)</span>
    <span class="n">th_g</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">ph_g</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">B_gT</span> <span class="o">=</span> <span class="n">dstack</span><span class="p">((</span><span class="n">th_g</span><span class="p">,</span> <span class="n">ph_g</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">s_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">G</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">al</span> <span class="o">=</span> <span class="n">angledir</span><span class="p">(</span><span class="n">s_l</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">SphericalBasis</span><span class="p">(</span><span class="n">al</span><span class="p">)</span>
    <span class="n">th_l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">ph_l</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">B_l</span> <span class="o">=</span> <span class="n">dstack</span><span class="p">((</span><span class="n">th_l</span><span class="p">,</span> <span class="n">ph_l</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">mul3</span><span class="p">(</span><span class="n">B_gT</span><span class="p">,</span> <span class="n">mul3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">B_l</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">R</span><span class="p">,</span> <span class="n">al</span>


</div>
<div class="viewcode-block" id="Plot_shapely"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely">[docs]</a><span class="k">class</span> <span class="nc">Plot_shapely</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;draw Shapely with matplotlib - pylab</span>
<span class="sd">     Plot_shapely.py</span>
<span class="sd">     Author : Martin Laloux 2010</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">coul</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">alph</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">         Parameters</span>
<span class="sd">         ----------</span>
<span class="sd">         ax :</span>
<span class="sd">             pylab Axes</span>
<span class="sd">         obj  : geometric object</span>
<span class="sd">         coul : matplotlib color</span>
<span class="sd">         alph : transparency</span>

<span class="sd">         Examples</span>
<span class="sd">         --------</span>

<span class="sd">         &gt;&gt;&gt; from shapely.wkt import loads</span>
<span class="sd">         &gt;&gt;&gt; import matplotlib.pylab as plt</span>
<span class="sd">         &gt;&gt;&gt; ax = plt.gca()</span>
<span class="sd">         &gt;&gt;&gt; ligne = loads(&#39;LINESTRING (3 1, 4 4, 5 5, 5 6)&#39;)</span>
<span class="sd">         &gt;&gt;&gt; a  = Plot_shapely(ligne,ax,&#39;r&#39;, 0.5)</span>
<span class="sd">         &gt;&gt;&gt; a.plot</span>
<span class="sd">         &gt;&gt;&gt; Plot_shapely(ligne,ax,&#39;#FFEC00&#39;).plot</span>
<span class="sd">         &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">geom_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coul</span> <span class="o">=</span> <span class="n">coul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alph</span> <span class="o">=</span> <span class="n">alph</span>

<div class="viewcode-block" id="Plot_shapely.plot_coords"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely.plot_coords">[docs]</a>    <span class="k">def</span> <span class="nf">plot_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coul</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plot_shapely.plot_ligne"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely.plot_ligne">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ligne</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;lines&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coul</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alph</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plot_shapely.plot_polygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely.plot_polygon">[docs]</a>    <span class="k">def</span> <span class="nf">plot_polygon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;polygons&quot;&quot;&quot;</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="n">PolygonPatch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coul</span><span class="p">,</span>
                             <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alph</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Plot_shapely.plot_multi"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely.plot_multi">[docs]</a>    <span class="k">def</span> <span class="nf">plot_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;multipoints, multilignes,multipolygones + GeometryCollection&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">:</span>
            <span class="n">Plot_shapely</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coul</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alph</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span>
</div>
    <span class="nd">@property</span>
<div class="viewcode-block" id="Plot_shapely.plot"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Plot_shapely.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;dessine en fonction du type geometrique&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;Point&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_coords</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;Polygon&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_polygon</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;LineString&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_ligne</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s">&quot;Multi&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;ex. MultiPolygon&quot;&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_multi</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;GeometryCollection&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_multi</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;LinearRing&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_line</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;inconnu au bataillon: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="plot_coords"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_coords">[docs]</a><span class="k">def</span> <span class="nf">plot_coords</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#999999&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plotting coord of a `shapely` object</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : matplotlib axes</span>
<span class="sd">    ob : shapely object</span>
<span class="sd">    color : string</span>
<span class="sd">        default &#39;#999999&#39;</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    `Shapely &lt;http://pypi.python.org/pypi/Shapely&gt;`_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c"># color=&#39;#999999&#39;</span>

</div>
<div class="viewcode-block" id="plot_bounds"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_bounds">[docs]</a><span class="k">def</span> <span class="nf">plot_bounds</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#000000&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : matplotlib axes</span>
<span class="sd">    ob : shapely object</span>
<span class="sd">    color : string</span>
<span class="sd">        default &#39;#999999&#39;</span>


<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    `Shapely &lt;http://pypi.python.org/pypi/Shapely&gt;`_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">boundary</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c"># &#39;#000000&#39;</span>
    <span class="c">#ax.plot(x, y, &#39;o&#39;, color=&#39;#000000&#39;, zorder=0.1)   #&#39;#000000&#39;</span>

</div>
<div class="viewcode-block" id="plot_line"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_line">[docs]</a><span class="k">def</span> <span class="nf">plot_line</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;#999999&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : matplotlib axes</span>
<span class="sd">    ob : shapely object</span>
<span class="sd">    color : string</span>
<span class="sd">        default &#39;#999999&#39;</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    `Shapely &lt;http://pypi.python.org/pypi/Shapely&gt;`_</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    color = v_color(ob)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    .. plot:</span>
<span class="sd">        :include-source:</span>

<span class="sd">    &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; seg = shg.LineString([(0,0),(1,1)])</span>
<span class="sd">    &gt;&gt;&gt; fig = plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; ax  = fig.gca()</span>
<span class="sd">    &gt;&gt;&gt; plot_line(ax,seg)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">solid_capstyle</span><span class="o">=</span><span class="s">&#39;round&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="v_color"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.v_color">[docs]</a><span class="k">def</span> <span class="nf">v_color</span><span class="p">(</span><span class="n">ob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">COLOR</span><span class="p">[</span><span class="n">ob</span><span class="o">.</span><span class="n">is_simple</span><span class="p">]</span>

<span class="c">#--------------------------------------------</span>
<span class="c">#   Functions used for calculation of Gv</span>
<span class="c">#-------------------------------------------</span>
</div>
<div class="viewcode-block" id="LineString"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.LineString">[docs]</a><span class="k">class</span> <span class="nc">LineString</span><span class="p">(</span><span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Overloaded shapely LineString class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">shg</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">shg</span><span class="o">.</span><span class="n">multipoint</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">):</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">])</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tu</span><span class="p">)</span>

<div class="viewcode-block" id="LineString.plot"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.LineString.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color :  string</span>
<span class="sd">            default #abcdef&quot;</span>
<span class="sd">        alpha :  float</span>
<span class="sd">            transparency   (default 0.8)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.util.geomutil import * </span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; l1 = np.array([[0,1,1,0],[0,0,1,1]])</span>
<span class="sd">            &gt;&gt;&gt; L1 = LineString(l1)</span>
<span class="sd">            &gt;&gt;&gt; l2 = [[3,4,4,3],[1,1,2,2]]</span>
<span class="sd">            &gt;&gt;&gt; L2 = LineString(l2)</span>
<span class="sd">            &gt;&gt;&gt; l3 = [np.array([10,10]),np.array([11,10]),np.array([11,11]),np.array([10,11])]</span>
<span class="sd">            &gt;&gt;&gt; L3 = LineString(l3)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L1.plot(color=&#39;red&#39;,alpha=0.3,linewidth=3)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L2.plot(fig=fig,ax=ax,color=&#39;blue&#39;,alpha=0.7,linewidth=2)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = L3.plot(fig=fig,ax=ax,color=&#39;green&#39;,alpha=1,linewidth=1)</span>
<span class="sd">            &gt;&gt;&gt; title = plt.title(&#39;test plotting LineString&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;#abcdef&#39;</span><span class="p">,</span>
                <span class="s">&#39;linewidth&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
                <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.8</span> <span class="p">,</span>
                <span class="s">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                 <span class="p">}</span>
        <span class="c">#</span>
        <span class="c"># update default values</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c">#</span>
        <span class="c"># getting fig and ax</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figsize&#39;</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;linewidth&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div></div>
<div class="viewcode-block" id="Polygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon">[docs]</a><span class="k">class</span> <span class="nc">Polygon</span><span class="p">(</span><span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Overloaded shapely Polygon class</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    plot</span>
<span class="sd">    ptconvex</span>
<span class="sd">    buildGv</span>
<span class="sd">    ndarray :</span>
<span class="sd">        get a ndarray from a Polygon</span>
<span class="sd">    signedarea :</span>
<span class="sd">        get the signed area of the polygon</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">vnodes</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            p : list</span>
<span class="sd">                2xNp np.array</span>
<span class="sd">                shg.MultiPoint</span>
<span class="sd">                shg.Polygon</span>
<span class="sd">            vnodes : list of alternating points and segments numbers</span>
<span class="sd">                default = [] in this case a regular ordered sequence</span>
<span class="sd">                is generated.</span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            A Polygon as an equal number of points and segments</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">shg</span><span class="o">.</span><span class="n">polygon</span><span class="o">.</span><span class="n">Polygon</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">shg</span><span class="o">.</span><span class="n">multipoint</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">):</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">])</span>
            <span class="n">tp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">tu</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span>
            <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tu</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vnodes</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vnodes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># create sequence</span>
            <span class="c">#</span>
            <span class="c"># -1 1 -2 2 -3 3 ... -(Np-1) (Np-1)</span>
            <span class="c">#</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Np</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
        <span class="n">pnew</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pnew</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pnew</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndarray</span><span class="p">()</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sh</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;)</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>

<div class="viewcode-block" id="Polygon.ndarray"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.ndarray">[docs]</a>    <span class="k">def</span> <span class="nf">ndarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get a ndarray from a Polygon</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            p : ndarray (2xNp)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pylayers.util.geomutil import *    </span>
<span class="sd">        &gt;&gt;&gt; p1 = np.array([[0,1,1,0],[0,0,1,1]])</span>
<span class="sd">        &gt;&gt;&gt; P1 = Polygon(p1)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exterior</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lring</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Polygon.signedarea"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.signedarea">[docs]</a>    <span class="k">def</span> <span class="nf">signedarea</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get the signed area of the polygon</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndarray</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">::],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span> <span class="o">/</span> <span class="mf">2.</span>
</div>
<div class="viewcode-block" id="Polygon.plot"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color :  string</span>
<span class="sd">            default #abcdef&quot;</span>
<span class="sd">        alpha :  float</span>
<span class="sd">            transparency   (default 0.8)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.util.geomutil import * </span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; p1 = np.array([[0,1,1,0],[0,0,1,1]])</span>
<span class="sd">            &gt;&gt;&gt; P1 = Polygon(p1)</span>
<span class="sd">            &gt;&gt;&gt; p2 = [[3,4,4,3],[1,1,2,2]]</span>
<span class="sd">            &gt;&gt;&gt; P2 = Polygon(p2)</span>
<span class="sd">            &gt;&gt;&gt; p3 = [np.array([10,10]),np.array([11,10]),np.array([11,11]),np.array([10,11])]</span>
<span class="sd">            &gt;&gt;&gt; P3 = Polygon(p3)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = P1.plot(color=&#39;red&#39;,alpha=0.3)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = P2.plot(fig=fig,ax=ax,color=&#39;blue&#39;,alpha=0.7)</span>
<span class="sd">            &gt;&gt;&gt; fig,ax = P3.plot(fig=fig,ax=ax,color=&#39;green&#39;,alpha=1)</span>
<span class="sd">            &gt;&gt;&gt; title = plt.title(&#39;test plotting polygons&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;#abcdef&#39;</span><span class="p">,</span>
                <span class="s">&#39;edgecolor&#39;</span><span class="p">:</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span>
                <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.8</span> <span class="p">,</span>
                <span class="s">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                 <span class="p">}</span>
        <span class="c">#</span>
        <span class="c"># update default values</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="c">#</span>
        <span class="c"># getting fig and ax</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figsize&#39;</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span>
                <span class="n">ec</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;edgecolor&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
</div>
<div class="viewcode-block" id="Polygon.simplify"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.simplify">[docs]</a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Simplify polygon - suppress adjacent colinear segments</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            poly2 : simplified polygon</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Before</span>


<span class="sd">        After</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">v1n</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v1</span><span class="p">))</span>
            <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1n</span><span class="p">,</span> <span class="n">v2n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="mf">0.98</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="n">vini</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">vin</span> <span class="o">=</span> <span class="n">vini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vini</span><span class="p">,</span> <span class="n">vini</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2n</span><span class="p">,</span> <span class="n">vin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mf">0.98</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">ls</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">asLineString</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">poly2</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Polygon.buildGv"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.buildGv">[docs]</a>    <span class="k">def</span> <span class="nf">buildGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create  visibility graph for a polygon</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display   : boolean</span>
<span class="sd">            default : False</span>
<span class="sd">        fig       : matplotlib.figure.pyplot</span>
<span class="sd">        ax        : axes</span>
<span class="sd">        udeg1     : np.array indexes of points of degree 1</span>
<span class="sd">            default = []</span>
<span class="sd">        udeg2     : np.array indexes of points of degree 2</span>
<span class="sd">            default = []</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            Topological error can be raised if the point coordinates accuracy</span>
<span class="sd">            is not limited.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">            &gt;&gt;&gt; import shapely.geometry as shg</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; points  = shg.MultiPoint([(0, 0), (0, 1), (2.5,1), (2.5, 2), \</span>
<span class="sd">                                          (2.8,2), (2.8, 1.1), (3.2, 1.1), \</span>
<span class="sd">                                          (3.2, 0.7), (0.4, 0.7), (0.4, 0)])</span>
<span class="sd">            &gt;&gt;&gt; polyg   = Polygon(points)</span>
<span class="sd">            &gt;&gt;&gt; Gv      = polyg.buildGv(show=True)</span>
<span class="sd">            &gt;&gt;&gt; plt.axis(&#39;off&#39;)</span>
<span class="sd">            (-0.5, 4.0, -0.5, 2.5)</span>
<span class="sd">            &gt;&gt;&gt; title = plt.title(&#39;Testing buildGv&#39;)</span>


<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Segment k and (k+1)%N share segment (k+1)%N</span>
<span class="sd">        The degree of a point is dependent from other polygons around</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;show&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;udeg1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([]),</span>
                    <span class="s">&#39;udeg2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
                    <span class="p">}</span>

<span class="c">##       initialize function attributes</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c">#self.args=args</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

        <span class="n">udeg1</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;udeg1&#39;</span><span class="p">]</span>
        <span class="n">udeg2</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;udeg2&#39;</span><span class="p">]</span>

        <span class="n">GRAY</span> <span class="o">=</span> <span class="s">&#39;#999999&#39;</span>
        <span class="n">Gv</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">lring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exterior</span>
        <span class="c">#</span>
        <span class="c"># Calculate interior normals</span>
        <span class="c">#</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lring</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="c">#</span>
        <span class="c"># determine convex points</span>
        <span class="c">#</span>
        <span class="n">tcc</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ptconvex</span><span class="p">()</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np</span>
        <span class="c">#</span>
        <span class="c"># retrieve</span>
        <span class="c">#  npt points label sequence</span>
        <span class="c">#  nseg segments label sequence </span>
        <span class="c">#</span>
        <span class="c"># vnodes do not necessarily start with a point</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ipt</span>  <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
            <span class="n">iseg</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ipt</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">iseg</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>

        <span class="n">npt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="n">ipt</span><span class="p">]</span>
        <span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="n">iseg</span><span class="p">]</span>

        <span class="k">assert</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">npt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;something wrong&quot;</span>
        <span class="k">assert</span>  <span class="nb">sum</span><span class="p">(</span><span class="n">nseg</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s">&quot;something wrong&quot;</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="c"># Create middle point on lring</span>
        <span class="c">#</span>
        <span class="c"># Warning lring recopy the node at the end of the sequence</span>
        <span class="c">#</span>
        <span class="c"># A problem comes from the fact that a vnodes sequence</span>
        <span class="c"># do no necessarily starts with a point (negative node)</span>
        <span class="c">#</span>
        <span class="c">#</span>
        <span class="n">tpm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ik</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lring</span><span class="o">.</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="p">(</span><span class="n">pt</span> <span class="o">+</span> <span class="n">pm1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vnodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nseg</span><span class="p">[</span><span class="n">ik</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">nseg</span><span class="p">[</span><span class="n">ik</span> <span class="o">%</span> <span class="n">Np</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">tpm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pm</span><span class="p">)</span>
                <span class="n">pm1</span> <span class="o">=</span> <span class="n">pt</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pm1</span> <span class="o">=</span> <span class="n">pt</span>
        <span class="c">#</span>
        <span class="c"># Update position of points in Gv</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">nk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="c">#nnode = -(nk+1)</span>
            <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="n">npt</span><span class="p">[</span><span class="n">nk</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">nk</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">nk</span><span class="p">])</span>

        <span class="n">xr</span><span class="p">,</span> <span class="n">yr</span> <span class="o">=</span> <span class="n">lring</span><span class="o">.</span><span class="n">xy</span>

        <span class="c">#</span>
        <span class="c"># Degree 1 points</span>
        <span class="c">#</span>
        <span class="c"># Determine diffraction points</span>
        <span class="c">#</span>
        <span class="c"># udeg1 :</span>
        <span class="c"># deg2 : if null the point is kept</span>
        <span class="c">#        if convexe the point is kept</span>
        <span class="c">#        else the point is not kept</span>
        <span class="c">#</span>
        <span class="n">uconvex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tcc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tcc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">udiffdoor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">intersect1d</span><span class="p">(</span><span class="n">uzero</span><span class="p">,</span> <span class="n">udeg2</span><span class="p">)</span>  <span class="c"># les points paralleles de degre 2 sont souvent des portes ou des fenetres</span>
        <span class="n">udiff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">uconvex</span><span class="p">,</span> <span class="n">udiffdoor</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;int&#39;</span><span class="p">)</span>
        <span class="c">#print &quot;vnodes&quot;,self.vnodes</span>
        <span class="c">#print &quot;tcc : &quot;,tcc</span>
        <span class="c">#print &quot;uzero : &quot;,uzero</span>
        <span class="c">#print &quot;udiffdoor : &quot;,udiffdoor</span>
        <span class="c">#print &quot;udiff&quot;,udiff</span>
        <span class="c">#print &quot;udeg2&quot;,udeg2</span>
        <span class="c">#print &quot;npt&quot;,npt</span>
        <span class="c">#if udiff!=[]:</span>
        <span class="c">#    print &quot;diff : &quot;,npt[udiff]</span>
        <span class="c">#if udeg2!=[]:</span>
        <span class="c">#    print &quot;deg2 : &quot;,npt[udeg2]</span>
        <span class="c">#if uzero!=[]:</span>
        <span class="c">#    print &quot;zero :&quot;,npt[uzero]</span>
        <span class="c">#</span>
        <span class="c"># display points and polygon</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">points1</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="n">lring</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">uconvex</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">udiffdoor</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">GRAY</span><span class="p">)</span>

            <span class="n">patch</span> <span class="o">=</span> <span class="n">PolygonPatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#6699cc&#39;</span><span class="p">,</span>
                                 <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#  1) Calculate node node visibility</span>
        <span class="c">#</span>

        <span class="c">#</span>
        <span class="c">#  Entre les combinaisons de points convexes</span>
        <span class="c">#  Il faut elargir aux portes points de degre 2</span>
        <span class="c">#  eventuellement non convexes cross product nul</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">nk</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">udiff</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">nk</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">nk</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">seg</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="p">(((</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">seg</span><span class="p">):</span>
                <span class="n">Gv</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">npt</span><span class="p">[</span><span class="n">nk</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">npt</span><span class="p">[</span><span class="n">nk</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">weight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c">#</span>
        <span class="c">#  2) Calculate edge-edge and node-edge visibility</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">nk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="n">ptk</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">nk</span><span class="p">]</span>
            <span class="n">phk</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="p">(</span><span class="n">nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span><span class="p">]</span>

            <span class="n">lk</span> <span class="o">=</span> <span class="n">phk</span> <span class="o">-</span> <span class="n">ptk</span>
            <span class="n">nlk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">lk</span><span class="p">,</span> <span class="n">lk</span><span class="p">))</span>
            <span class="n">lnk</span> <span class="o">=</span> <span class="n">lk</span> <span class="o">/</span> <span class="n">nlk</span>

            <span class="n">epsilonk</span> <span class="o">=</span> <span class="n">nlk</span> <span class="o">/</span> <span class="mf">1000.</span>

            <span class="n">pcornert</span> <span class="o">=</span> <span class="n">ptk</span> <span class="o">+</span> <span class="n">lnk</span> <span class="o">*</span> <span class="n">epsilonk</span>  <span class="c"># + n[:,nk]*epsilon</span>
            <span class="n">pcornerh</span> <span class="o">=</span> <span class="n">phk</span> <span class="o">-</span> <span class="n">lnk</span> <span class="o">*</span> <span class="n">epsilonk</span>  <span class="c"># + n[:,nk]*epsilon</span>

        <span class="c">#</span>
        <span class="c"># in any case no ray towark nk</span>
        <span class="c"># if nk is convex no ray toward (nk-1)%Np</span>
        <span class="c">#</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pcorner</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">pcornert</span><span class="p">,</span> <span class="n">pcornerh</span><span class="p">]):</span>
                <span class="c">#</span>
                <span class="c">#  si point tail</span>
                <span class="c">#           on retire de segment nk</span>
                <span class="c">#  et si le point est convexe on retire le segment precedent</span>
                <span class="c">#</span>
                <span class="c">#  si point head</span>
                <span class="c">#</span>
                <span class="n">listpoint</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
                <span class="n">listpoint</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nk</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nk</span> <span class="ow">in</span> <span class="n">uconvex</span><span class="p">:</span>
                        <span class="n">listpoint</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">nk</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span> <span class="ow">in</span> <span class="n">uconvex</span><span class="p">:</span>
                        <span class="n">listpoint</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">ns</span> <span class="ow">in</span> <span class="n">listpoint</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">ns</span><span class="p">]</span>
                    <span class="n">phs</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="p">(</span><span class="n">ns</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span><span class="p">]</span>
                    <span class="n">ls</span> <span class="o">=</span> <span class="n">phs</span> <span class="o">-</span> <span class="n">pts</span>
                    <span class="n">nls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ls</span><span class="p">,</span> <span class="n">ls</span><span class="p">))</span>
                    <span class="n">lns</span> <span class="o">=</span> <span class="n">ls</span> <span class="o">/</span> <span class="n">nls</span>
                    <span class="n">epsilons</span> <span class="o">=</span> <span class="n">nls</span> <span class="o">/</span> <span class="mf">1000.</span>
                    <span class="n">pte</span> <span class="o">=</span> <span class="n">pts</span> <span class="o">+</span> <span class="n">lns</span> <span class="o">*</span> <span class="n">epsilons</span>  <span class="c"># + n[:,ns]*epsilon</span>
                    <span class="n">phe</span> <span class="o">=</span> <span class="n">phs</span> <span class="o">-</span> <span class="n">lns</span> <span class="o">*</span> <span class="n">epsilons</span>  <span class="c"># + n[:,ns]*epsilon</span>
                    <span class="n">tbr</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">bitreverse</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mf">16.</span>
                    <span class="k">for</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="n">tbr</span><span class="p">:</span>
                        <span class="n">pa</span> <span class="o">=</span> <span class="n">pte</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">phe</span> <span class="o">-</span> <span class="n">pte</span><span class="p">)</span>
                        <span class="n">seg</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">pcorner</span><span class="p">,</span> <span class="n">pa</span><span class="p">))</span>
                        <span class="c">#print &quot;seg: &quot;,seg.xy</span>
                        <span class="c">#if npt[nk] == -3:</span>
                        <span class="c">#    plt.plot(np.array([pcorner[0],pa[0]]),np.array([pcorner[1],pa[1]]),linewidth=0.2,color=&#39;k&#39;)</span>
                        <span class="c">#    plt.draw()</span>
                        <span class="c"># topological error can be raised here</span>
                        <span class="n">seg2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span>
                        <span class="c">#if self.contains(seg):</span>
                        <span class="k">if</span> <span class="n">seg2</span><span class="o">.</span><span class="n">almost_equals</span><span class="p">(</span><span class="n">seg</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
                            <span class="c">#print alpha,nk,ns</span>
                            <span class="c">#plt.plot(np.array([pcorner[0],pa[0]]),np.array([pcorner[1],pa[1]]),linewidth=2,color=&#39;r&#39;)</span>
                            <span class="c">#Gv.add_edge(-(uconvex[nk]+1),ns+1,weight=10)</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">nk</span> <span class="ow">in</span> <span class="n">udiff</span><span class="p">:</span>
                                    <span class="n">Gv</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">npt</span><span class="p">[</span><span class="n">nk</span><span class="p">],</span> <span class="n">nseg</span><span class="p">[</span><span class="n">ns</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="c">#plt.plot(np.array([Gv.pos[npt[nk]][0],Gv.pos[nseg[ns]][0]]),np.array([Gv.pos[npt[nk]][1],Gv.pos[nseg[ns]][1]]),&#39;r&#39;)</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span><span class="n">nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span> <span class="ow">in</span> <span class="n">udiff</span><span class="p">:</span>
                                    <span class="n">Gv</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">npt</span><span class="p">[(</span><span class="n">nk</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Np</span><span class="p">],</span> <span class="n">nseg</span><span class="p">[</span><span class="n">ns</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                    <span class="c">#plt.plot(np.array([Gv.pos[npt[(nk+1)%Np]][0],Gv.pos[nseg[ns]][0]]),np.array([Gv.pos[npt[(nk+1)%Np]][1],Gv.pos[nseg[ns]][1]]),&#39;g&#39;)</span>
                                <span class="c">#plt.draw()</span>
                            <span class="c">#if i==1:</span>
                            <span class="k">if</span> <span class="n">nseg</span><span class="p">[</span><span class="n">nk</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nseg</span><span class="p">[</span><span class="n">ns</span><span class="p">]:</span>
                                <span class="n">Gv</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nseg</span><span class="p">[</span><span class="n">nk</span><span class="p">],</span> <span class="n">nseg</span><span class="p">[</span><span class="n">ns</span><span class="p">],</span> <span class="n">weight</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                                <span class="c">#if (((nseg[nk]==155) &amp; (nseg[ns]==164)) or ((nseg[nk]==164) &amp; (nseg[ns]==155))):</span>
                                    <span class="c">#plt.plot(np.array([Gv.pos[nseg[nk]][0],Gv.pos[nseg[ns]][0]]),np.array([Gv.pos[nseg[nk]][1],Gv.pos[nseg[ns]][1]]),&#39;b&#39;)</span>
                                    <span class="c">#plt.plot(np.array([pcorner[0],pa[0]]),np.array([pcorner[1],pa[1]]),&#39;b&#39;)</span>
                                    <span class="c">#print &quot;seg: &quot;,seg.xy</span>
                                    <span class="c">#print &quot;seg2: &quot;,seg2.xy</span>
                                    <span class="c">#print nseg[nk],nseg[ns]</span>
                                    <span class="c">#print pcorner , ptk</span>
                                    <span class="c">#print  alpha , pa ,pte</span>
                                    <span class="c">#plt.draw()</span>
                                    <span class="c">#raw_input()</span>
                            <span class="k">break</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Gv</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>
            <span class="n">uneg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">upos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">upos</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">uneg</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">ndnd</span><span class="p">,</span> <span class="n">nded</span><span class="p">,</span> <span class="n">eded</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">edgetype</span><span class="p">(</span><span class="n">Gv</span><span class="p">)</span>

            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">eded</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">ndnd</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">nded</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c">#label = {}</span>
            <span class="c">#for (u,v) in Gv.edges():</span>
            <span class="c">#    d = Gv.get_edge_data(u,v)</span>
            <span class="c">#    label[(u,v)]=d[&#39;weight&#39;]</span>

            <span class="c">#edge_label=nx.draw_networkx_edge_labels(Gv,Gv.pos,edge_labels=label)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">Gv</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Polygon.showGv"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.showGv">[docs]</a>    <span class="k">def</span> <span class="nf">showGv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show graph Gv</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display</span>
<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        ndnd    : boolean</span>
<span class="sd">            display node/node</span>
<span class="sd">        nded    : boolean</span>
<span class="sd">            display node/edge</span>
<span class="sd">        eded    : boolean</span>
<span class="sd">            display edge/edge</span>
<span class="sd">        linewidth: float</span>
<span class="sd">            default 2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;display&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;fig&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ax&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s">&#39;ndnd&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="s">&#39;nded&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;ndnd&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mi">2</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_frameon</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span>

        <span class="n">lring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exterior</span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">MultiPoint</span><span class="p">(</span><span class="n">lring</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">points</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tcc</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="n">Np</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">GRAY</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">patch</span> <span class="o">=</span> <span class="n">PolygonPatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;#6699cc&#39;</span><span class="p">,</span>
                             <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;#6699cc&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Gv</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

        <span class="n">uneg</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">upos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">nodes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">upos</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">nodelist</span><span class="o">=</span><span class="n">uneg</span><span class="p">,</span>
                                   <span class="n">node_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_labels</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>

            <span class="n">ndnd</span><span class="p">,</span> <span class="n">nded</span><span class="p">,</span> <span class="n">eded</span> <span class="o">=</span> <span class="n">gru</span><span class="o">.</span><span class="n">edgetype</span><span class="p">(</span><span class="n">Gv</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;eded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">eded</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ndnd&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">ndnd</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;nded&#39;</span><span class="p">]:</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">Gv</span><span class="p">,</span> <span class="n">Gv</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="n">nded</span><span class="p">,</span>
                                   <span class="n">edge_color</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Polygon.ptconvex"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.Polygon.ptconvex">[docs]</a>    <span class="k">def</span> <span class="nf">ptconvex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a list of booleans indicating points convexity</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        display : boolean</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tcc     : np.array (1x Nseg)</span>
<span class="sd">            1 if convex , -1 if concav , 0 if plane</span>
<span class="sd">        n       :  array(2xNseg)</span>
<span class="sd">            segments normals</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.util.geomutil import *</span>
<span class="sd">            &gt;&gt;&gt; import shapely.geometry as shg</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; points  = shg.MultiPoint([(0, 0), (0, 1), (3.2, 1), (3.2, 0.7), (0.4, 0.7), (0.4, 0)])</span>
<span class="sd">            &gt;&gt;&gt; N = len(points)</span>
<span class="sd">            &gt;&gt;&gt; polyg   = Polygon(points)</span>
<span class="sd">            &gt;&gt;&gt; tcc,n   = polyg.ptconvex()</span>
<span class="sd">            &gt;&gt;&gt; #k = 0</span>
<span class="sd">            &gt;&gt;&gt; #for p in points:</span>
<span class="sd">            &gt;&gt;&gt; #  if tcc[k] == 1 :</span>
<span class="sd">            &gt;&gt;&gt; #      plt.plot(p.x, p.y, &#39;o&#39;, color=&#39;red&#39;,alpha=1)</span>
<span class="sd">            &gt;&gt;&gt; #  else:</span>
<span class="sd">            &gt;&gt;&gt; #      plt.plot(p.x, p.y, &#39;o&#39;, color=&#39;blue&#39;,alpha=0.3)</span>
<span class="sd">            &gt;&gt;&gt; #  k = k+1</span>
<span class="sd">            &gt;&gt;&gt; #polyg.plot()</span>
<span class="sd">            &gt;&gt;&gt; #plt.figure()</span>
<span class="sd">            &gt;&gt;&gt; #points  = shg.MultiPoint([(0, 0), (1, 1), (2, 0), (1, 0)])</span>
<span class="sd">            &gt;&gt;&gt; #poly    = Polygon(points)</span>
<span class="sd">            &gt;&gt;&gt; #tcc,n   = polyg.ptconvex()</span>
<span class="sd">            &gt;&gt;&gt; #poly.plot()</span>


<span class="sd">        Notes</span>
<span class="sd">        ------</span>

<span class="sd">            This function determines the convex and concav points of a polygon.</span>
<span class="sd">            As there is no orientation convention for the polygon the sign of the cross</span>
<span class="sd">            product can&#39;t be directly interpreted. So we exploit the following</span>
<span class="sd">            property :</span>

<span class="sd">            Let N be the number of points of the Polygon. N  = Nx + Nc where</span>
<span class="sd">            Nx is the number of convex point and Nc the number of concav points</span>
<span class="sd">            We have Nx &gt;= Nc</span>

<span class="sd">            If a point is common to two parallel segments, the cross product is = 0</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">lring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exterior</span>

        <span class="c">#</span>
        <span class="c"># Calculate interior normals</span>
        <span class="c">#</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lring</span><span class="o">.</span><span class="n">xy</span>
        <span class="n">Np</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">Nseg</span> <span class="o">=</span> <span class="n">Np</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">Lr2n</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="n">tcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
        
        <span class="c">#</span>
        <span class="c"># cross product between two adjascent normals</span>
        <span class="c">#</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nseg</span><span class="p">):</span>
            <span class="n">nk</span> <span class="o">=</span> <span class="n">n</span><span class="p">[:,</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">Nseg</span><span class="p">]</span>
            <span class="n">nkp1</span> <span class="o">=</span> <span class="n">n</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">nk</span><span class="p">,</span> <span class="n">nkp1</span><span class="p">)</span>
            <span class="n">tcc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="c">#print &quot;ptseg tcc &quot;,tcc</span>
        <span class="c">#</span>
        <span class="c"># warning this test is fragile</span>
        <span class="c">#</span>
        <span class="n">upos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tcc</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">uneg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tcc</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e-3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">uneg</span><span class="p">):</span>
            <span class="n">nconvex</span> <span class="o">=</span> <span class="n">uneg</span>
            <span class="n">nconcav</span> <span class="o">=</span> <span class="n">upos</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upos</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">uneg</span><span class="p">):</span>
            <span class="n">nconvex</span> <span class="o">=</span> <span class="n">upos</span>
            <span class="n">nconcav</span> <span class="o">=</span> <span class="n">uneg</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">upos</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">uneg</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;error polygon is a star &quot;</span>
            <span class="k">print</span> <span class="s">&quot;tcc&quot;</span><span class="p">,</span><span class="n">tcc</span>
            <span class="k">print</span> <span class="s">&quot;upos&quot;</span><span class="p">,</span><span class="n">upos</span>
            <span class="k">print</span> <span class="s">&quot;uneg&quot;</span><span class="p">,</span><span class="n">uneg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>


        <span class="n">tcc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Np</span><span class="p">)</span>
        <span class="n">tcc</span><span class="p">[</span><span class="n">nconvex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">tcc</span><span class="p">[</span><span class="n">nconcav</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c">#print &quot;ptseg tcc &quot;,tcc</span>
        <span class="n">upos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">tcc</span> <span class="o">&gt;</span> <span class="mf">1e-4</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="n">tcc</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>


<span class="c">#def createPolygons(</span></div></div>
<div class="viewcode-block" id="plotPolygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plotPolygon">[docs]</a><span class="k">def</span> <span class="nf">plotPolygon</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&quot;#abcdef&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; plot a shapely Polygon</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    poly  : shapely poligon </span>
<span class="sd">    color : defauld #abcdef&quot;</span>
<span class="sd">    alpha : float </span>
<span class="sd">           transparency   (default 0.8)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="n">gax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gax</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">gax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">PolygonPatch</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="shrinkPolygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.shrinkPolygon">[docs]</a><span class="k">def</span> <span class="nf">shrinkPolygon</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; shrink polygon</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    poly  : shapely polygon</span>
<span class="sd">    d     : float</span>
<span class="sd">        0.1</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    poly</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">poly1</span> <span class="o">=</span> <span class="n">simplifyPolygon</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="n">poly1</span><span class="o">.</span><span class="n">area</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly1</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
    <span class="c"># enleve le dernier point</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">Lr2n</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">nrm</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">nrm</span>
        <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">nrm</span>
    <span class="n">q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">nrm</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">asLineString</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="n">poly2</span><span class="o">.</span><span class="n">area</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">A2</span> <span class="o">&gt;</span> <span class="n">A1</span><span class="p">):</span>
        <span class="n">poly2</span> <span class="o">=</span> <span class="n">shrinkPolygon</span><span class="p">(</span><span class="n">poly1</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="shrinkPolygon2"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.shrinkPolygon2">[docs]</a><span class="k">def</span> <span class="nf">shrinkPolygon2</span><span class="p">(</span><span class="n">poly1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    shrinkPolygon(poly1,d=0.1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">poly1</span> <span class="o">=</span> <span class="n">simplifyPolygon</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly1</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
    <span class="c"># enleve le dernier point</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">Lr2n</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">q</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">normold</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">norm1</span> <span class="o">=</span> <span class="n">norm</span>
        <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>       <span class="c"># changement de direction</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">norm</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">norm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">norm1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">norm</span>
        <span class="k">else</span><span class="p">:</span>           <span class="c"># meme direction</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">normold</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">norm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span> <span class="n">norm1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
                    <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">norm</span>

        <span class="n">normold</span> <span class="o">=</span> <span class="n">norm</span>
    <span class="c">#n2  = np.hstack((n1[:,-1].reshape(2,1),n1[:,0:-1]))</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">asLineString</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="simplifyPolygon"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.simplifyPolygon">[docs]</a><span class="k">def</span> <span class="nf">simplifyPolygon</span><span class="p">(</span><span class="n">poly1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplify polygon : suppress adjacent colinear segments</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    poly1</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">poly1</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">v1n</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v1</span><span class="p">))</span>
        <span class="n">v2n</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1n</span><span class="p">,</span> <span class="n">v2n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="mf">0.98</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="n">vini</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">vin</span> <span class="o">=</span> <span class="n">vini</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vini</span><span class="p">,</span> <span class="n">vini</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2n</span><span class="p">,</span> <span class="n">vin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mf">0.98</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">asLineString</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">poly2</span> <span class="o">=</span> <span class="n">shg</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>

<span class="c">#----------------------</span>
<span class="c"># Taguhi</span>
<span class="c">#----------------------</span>

</div>
<div class="viewcode-block" id="wall_delta"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.wall_delta">[docs]</a><span class="k">def</span> <span class="nf">wall_delta</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Identification of new points</span>

<span class="sd">    After defining a tolerance length those points which are situated in</span>
<span class="sd">    the extremities of the walls at a distance equivalent to the</span>
<span class="sd">    tolerance length are identified.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x1 :  float</span>
<span class="sd">        The x component of the point of the first extremity</span>
<span class="sd">    y1 :  float</span>
<span class="sd">        The x component of the point of the first extremity</span>
<span class="sd">    x2 :  float</span>
<span class="sd">        The x component of the point of the second extremity</span>
<span class="sd">    y2 :  float</span>
<span class="sd">        The x component of the point of the second extremity.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bx  :  float</span>
<span class="sd">        The x component of the new point of the first extremity</span>
<span class="sd">    by  :  float</span>
<span class="sd">        The y component of the new point of the first extremity</span>
<span class="sd">    cx  :  float</span>
<span class="sd">        The x component of the new point of the second extremity</span>
<span class="sd">    cy  :  float</span>
<span class="sd">        The y component of the new point of the second extremity.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    .. math:: bx=x1+(x2-x1) \\frac{\\delta}{mod(a)}.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pylayers.gis.layout import * </span>
<span class="sd">    &gt;&gt;&gt; L = Layout()</span>
<span class="sd">    &gt;&gt;&gt; L.loadstr(&#39;exemple.str&#39;)</span>
<span class="sd">    &gt;&gt;&gt; x1=-2.</span>
<span class="sd">    &gt;&gt;&gt; y1=2.</span>
<span class="sd">    &gt;&gt;&gt; x2=-1.</span>
<span class="sd">    &gt;&gt;&gt; y2=1.</span>
<span class="sd">    &gt;&gt;&gt; bx,by,cx,cy = wall_delta(x1,y1,x2,y2,delta=0.0001)</span>
<span class="sd">    &gt;&gt;&gt; assert bx==-1.9999292893218814,&#39;Mistake&#39;</span>
<span class="sd">    &gt;&gt;&gt; assert by==1.9999292893218814,&#39;Mistake&#39;</span>
<span class="sd">    &gt;&gt;&gt; assert cx==-1.0000707106781186,&#39;Mistake&#39;</span>
<span class="sd">    &gt;&gt;&gt; assert cy==1.0000707106781186,&#39;Mistake&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
    <span class="n">ay</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">a_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ax</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ay</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">a_ch_x</span> <span class="o">=</span> <span class="n">ax</span> <span class="o">/</span> <span class="n">a_mod</span>
    <span class="n">a_ch_y</span> <span class="o">=</span> <span class="n">ay</span> <span class="o">/</span> <span class="n">a_mod</span>

    <span class="n">bx</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">a_mod</span>
    <span class="n">by</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">a_mod</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">a_mod</span>
    <span class="n">cy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">/</span> <span class="n">a_mod</span>

    <span class="k">return</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_coords2"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_coords2">[docs]</a><span class="k">def</span> <span class="nf">plot_coords2</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;  plot point from coordinates</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#999999&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_bounds2"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_bounds2">[docs]</a><span class="k">def</span> <span class="nf">plot_bounds2</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">boundary</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_line2"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_line2">[docs]</a><span class="k">def</span> <span class="nf">plot_line2</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">v_color</span><span class="p">(</span>
        <span class="n">ob</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s">&#39;round&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_coords3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_coords3">[docs]</a><span class="k">def</span> <span class="nf">plot_coords3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_bounds3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_bounds3">[docs]</a><span class="k">def</span> <span class="nf">plot_bounds3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ob</span><span class="o">.</span><span class="n">boundary</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_line3"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.plot_line3">[docs]</a><span class="k">def</span> <span class="nf">plot_line3</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">ob</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://pypi.python.org/pypi/Shapely</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ob</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">solid_capstyle</span><span class="o">=</span><span class="s">&#39;round&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#</span>
<span class="c">## wedge functions</span>
<span class="c">##</span>

</div>
<div class="viewcode-block" id="valid_wedge"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.valid_wedge">[docs]</a><span class="k">def</span> <span class="nf">valid_wedge</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">pw</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">grazing</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; check set of N wedge sector validity for point ps</span>

<span class="sd">     Parameters</span>
<span class="sd">     ----------</span>
<span class="sd">     ps       : source point</span>
<span class="sd">     pw       : np.array (Nx2) wedge apex point</span>
<span class="sd">     p1       : np.array (Nx2) point 1 of wedge</span>
<span class="sd">     p2       : np.array (Nx2) point 2 of wedge</span>
<span class="sd">     grazing  : 0 (without grazing)</span>
<span class="sd">                1 (authorize grazing)</span>

<span class="sd">                         xps</span>

<span class="sd">            x pw</span>
<span class="sd">           / \</span>
<span class="sd">          /   \</span>
<span class="sd">         /     \</span>
<span class="sd">        x p1    x p2</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    valid : np.array (Nx1)</span>
<span class="sd">            valid = 1 if ps is in the convex sector</span>
<span class="sd">            valid = 0 if ps is in the concav sector</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; p1 = np.array([-2,-2]).reshape(1,2)</span>
<span class="sd">    &gt;&gt;&gt; p2 = np.array([2,-2]).reshape(1,2)</span>
<span class="sd">    &gt;&gt;&gt; pw = np.array([0,0]).reshape(1,2)</span>
<span class="sd">    &gt;&gt;&gt; ps1 = np.array([3,3]).reshape(1,2)</span>
<span class="sd">    &gt;&gt;&gt; ps2 = np.array([0,-3]).reshape(1,2)</span>
<span class="sd">    &gt;&gt;&gt; valid_wedge(ps1,pw,p1,p2,0)[0][0]</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; valid_wedge(ps2,pw,p1,p2,0)[0][0]</span>
<span class="sd">    1.0</span>


<span class="sd">    Authors</span>
<span class="sd">    -------</span>
<span class="sd">    Bernard.uguen@univ-rennes1.fr</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">p2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">ps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pw</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">aas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>

    <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)))</span>

    <span class="n">b1_I2</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">a2</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
    <span class="n">b2_I2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a1</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">a2</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>

    <span class="n">mu_I2</span> <span class="o">=</span> <span class="n">b2_I2</span> <span class="o">-</span> <span class="n">b1_I2</span>
    <span class="c">#</span>
    <span class="c"># un &gt;= ou &lt;= permet de valider les points qui sont sur une tangente au diedre</span>
    <span class="c">#</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">grazing</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">in_I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">(</span><span class="n">aas</span> <span class="o">&gt;</span> <span class="n">b1_I2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">aas</span> <span class="o">&lt;</span> <span class="n">b2_I2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_I2</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid</span><span class="p">[</span><span class="n">in_I2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">out_I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">((</span><span class="n">aas</span> <span class="o">&lt;</span> <span class="n">b1_I2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">aas</span> <span class="o">&gt;</span> <span class="n">b2_I2</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_I2</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid</span><span class="p">[</span><span class="n">out_I2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">grazing</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">in_I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">(</span><span class="n">aas</span> <span class="o">&gt;=</span> <span class="n">b1_I2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">aas</span> <span class="o">&lt;=</span> <span class="n">b2_I2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_I2</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid</span><span class="p">[</span><span class="n">in_I2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">out_I2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span>
            <span class="p">((</span><span class="n">aas</span> <span class="o">&lt;=</span> <span class="n">b1_I2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">aas</span> <span class="o">&gt;=</span> <span class="n">b2_I2</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">mu_I2</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">valid</span><span class="p">[</span><span class="n">out_I2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="sector"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.sector">[docs]</a><span class="k">def</span> <span class="nf">sector</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">pt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; angular sector  p1 pt p2</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p1 : np.array</span>
<span class="sd">        point</span>
<span class="sd">    p2 : np.array</span>
<span class="sd">        point</span>
<span class="sd">    pt : np.array</span>
<span class="sd">        point</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">         Useful for AAS calculation</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pt</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p1</span> <span class="o">-</span> <span class="n">pt</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">pt</span><span class="p">))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">pt</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p2</span> <span class="o">-</span> <span class="n">pt</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">pt</span><span class="p">))</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">sector</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span><span class="p">),</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">sector</span> <span class="o">-</span> <span class="n">sp</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">])</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">pi</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="dist"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.dist">[docs]</a><span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculates distance between two arrays along a given axis</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x : numpy.ndarray</span>
<span class="sd">            y : numpy.ndarray</span>
<span class="sd">            ax : integer (0,1)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            d : numpy.ndarray</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        .. plot::</span>
<span class="sd">            :include-source:</span>

<span class="sd">            &gt;&gt;&gt; import numpy as np</span>
<span class="sd">            &gt;&gt;&gt; x = np.array([[0., 0., 10., 10.],[0., 10., 10., 0.]])</span>
<span class="sd">            &gt;&gt;&gt; y = np.array([[5.],[5.]])</span>
<span class="sd">            &gt;&gt;&gt; ax = 0</span>
<span class="sd">            &gt;&gt;&gt; d = dist(x,y,ax)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="line_intersection"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.line_intersection">[docs]</a><span class="k">def</span> <span class="nf">line_intersection</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; intersection between two 2D lines using shapely</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        l1: numpy.ndarray</span>
<span class="sd">            coordinates of l1 points</span>
<span class="sd">        l2: numpy.ndarray</span>
<span class="sd">            coordinates of l2 points</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        p: numpy.ndarray</span>
<span class="sd">            coordinates of intersection point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shl1</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">l1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">l1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">shl2</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">l2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">l2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">shl1</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">shl2</span><span class="p">):</span>
        <span class="n">psh</span> <span class="o">=</span> <span class="n">shl1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">shl2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">psh</span><span class="o">.</span><span class="n">x</span><span class="p">],[</span><span class="n">psh</span><span class="o">.</span><span class="n">y</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="linepoly_intersection"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.linepoly_intersection">[docs]</a><span class="k">def</span> <span class="nf">linepoly_intersection</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">poly</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; intersection between a 2D line and a 2D polygon using shapely</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        l: numpy.ndarray</span>
<span class="sd">            coordinates of l points</span>
<span class="sd">        poly: numpy.ndarray</span>
<span class="sd">            coordinates of poly points</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        p: numpy.ndarray</span>
<span class="sd">            coordinates of intersection point</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shl</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">LineString</span><span class="p">((</span><span class="n">l</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">l</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">shpoly</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">polygon</span><span class="p">((</span><span class="n">poly</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">poly</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">poly</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">psh</span> <span class="o">=</span> <span class="n">shl</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">shpoly</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">psh</span><span class="o">.</span><span class="n">x</span><span class="p">],[</span><span class="n">psh</span><span class="o">.</span><span class="n">y</span><span class="p">]])</span>
</div>
<div class="viewcode-block" id="mirror"><a class="viewcode-back" href="../../../modules/util.geomutil.html#pylayers.util.geomutil.mirror">[docs]</a><span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">pa</span><span class="p">,</span><span class="n">pb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Compute the mirror of p with respect to the segment pa pb</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        p : numpy.ndarray</span>
<span class="sd">            point to image</span>
<span class="sd">        pa : numpy.ndarray</span>
<span class="sd">            segment tail</span>
<span class="sd">        pb : numpy.ndarray</span>
<span class="sd">            segment head </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        M : numpy.ndarray</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">        &gt;&gt;&gt; p = np.array([0,-1])</span>
<span class="sd">        &gt;&gt;&gt; pa  = np.array([-1,0])</span>
<span class="sd">        &gt;&gt;&gt; pb  = np.array([1,0])</span>
<span class="sd">        &gt;&gt;&gt; M = mirror(p,pa,pb) </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pa</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="mi">2</span><span class="p">,):</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pab</span> <span class="o">=</span> <span class="n">pb</span> <span class="o">-</span> <span class="n">pa</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pab</span> <span class="o">*</span> <span class="n">pab</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">zalpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">alpha</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">alpha</span><span class="p">[</span><span class="n">zalpha</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                        <span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
                        <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pb</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">pb</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>

    <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span>
    <span class="n">S</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">vc0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="o">-</span><span class="n">S</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">vc0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">v0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../../index.html">PyLayers Home </a> |&nbsp;</li>
        <li><a href="../../../notebooks/index.html">Documentation </a> |&nbsp;</li>
        <li><a href="../../../download.html">Download </a> |&nbsp; </li>
        <li><a href="https://github.com/pylayers/">Developer (Github)</a> </li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, PyLayers developer team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>